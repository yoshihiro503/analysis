
<!DOCTYPE html>
<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Module mathcomp.analysis.lebesgue_integral</title>
<meta name="description" content="Documentation of Coq module mathcomp.analysis.lebesgue_integral" />
<link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.css">
<script src="https://cdn.jsdelivr.net/npm/markdown-it/dist/markdown-it.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/markdown-it-texmath/texmath.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/darkmode-js@1.5.7/lib/darkmode-js.min.js"></script>
<link href="coq2html.css" rel="stylesheet" type="text/css" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script type="text/javascript" src="coq2html.js"> </script>
</head>

<body onload="init()">

  <main>
    <div class="sidebar">
      <h2>Files</h2>
      
    </div>

  <div class="coq">

    <div class="content">
      <p><a href="./index.html">Top</a></p>
      <h1 class="title">Module mathcomp.analysis.lebesgue_integral</h1>
<span class="vernacular">From</span><span class="id"> HB</span><span class="vernacular"> Require</span><span class="vernacular"> Import</span><span class="id"> structures</span>.<br/>
<span class="vernacular">From</span><span class="id"> mathcomp</span><span class="vernacular"> Require</span><span class="vernacular"> Import</span><span class="id"> all_ssreflect</span><span class="id"> ssralg</span><span class="id"> ssrnum</span><span class="id"> ssrint</span><span class="id"> interval</span><span class="id"> finmap</span>.<br/>
<span class="vernacular">From</span><span class="id"> mathcomp</span><span class="vernacular"> Require</span><span class="vernacular"> Import</span><span class="id"> archimedean</span>.<br/>
<span class="vernacular">From</span><span class="id"> mathcomp</span><span class="vernacular"> Require</span><span class="vernacular"> Import</span><span class="id"> boolp</span><span class="id"> classical_sets</span><span class="id"> functions</span>.<br/>
<span class="vernacular">From</span><span class="id"> mathcomp</span><span class="vernacular"> Require</span><span class="vernacular"> Import</span><span class="id"> cardinality</span><span class="id"> fsbigop</span><span class="id"> signed</span><span class="id"> reals</span><span class="id"> ereal</span><span class="id"> topology</span>.<br/>
<span class="vernacular">From</span><span class="id"> mathcomp</span><span class="vernacular"> Require</span><span class="vernacular"> Import</span><span class="id"> tvs</span><span class="id"> normedtype</span><span class="id"> sequences</span><span class="id"> real_interval</span><span class="id"> esum</span><span class="id"> measure</span>.<br/>
<span class="vernacular">From</span><span class="id"> mathcomp</span><span class="vernacular"> Require</span><span class="vernacular"> Import</span><span class="id"> lebesgue_measure</span><span class="id"> numfun</span><span class="id"> realfun</span><span class="id"> function_spaces</span>.<br/>
<br/>
<div class="ssrdoc md">
# Lebesgue Integral

This file contains a formalization of the Lebesgue integral. It starts
with simple functions and their integral, provides basic operations
(addition, etc.), and proves the properties of their integral (linearity,
non-decreasingness). It then defines the integral of measurable functions,
proves the approximation theorem, the properties of their integral
(linearity, non-decreasingness), the monotone convergence theorem, and
Fatou's lemma. Finally, it proves the linearity properties of the
integral, the dominated convergence theorem and Fubini's theorem, etc.
This file is further completed by related, standard lemmas such as the
Hardy–Littlewood maximal inequality and Lebesgue's differentiation
theorem.

Main notation:
| Coq notation          |  | Meaning                         |
|----------------------:|--|:--------------------------------
| \int[mu]_(x in D) f x |==| $\int_D f(x)\mathbf{d}\mu(x)$
| \int[mu]_x f x        |==| $\int f(x)\mathbf{d}\mu(x)$

Main reference:
- Daniel Li, Intégration et applications, 2016

About the local naming convention: Lemmas about the Lebesgue integral
often appears in two flavors, depending on whether they are about non-
negative functions or about integrable functions. Lemmas about non-
negative functions are prefixed with ge0_, lemmas about integrable
functions are not.

Detailed contents:
````
      {mfun aT &gt;-&gt; rT} == type of measurable functions
                          aT and rT are sigmaRingType's.
        {sfun T &gt;-&gt; R} == type of simple functions
      {nnsfun T &gt;-&gt; R} == type of non-negative simple functions
          cst_nnsfun r == constant simple function
               nnsfun0 := cst_nnsfun 0
        sintegral mu f == integral of the function f with the measure mu
 \int[mu]_(x in D) f x == integral of the measurable function f over the
                          domain D with measure mu
        \int[mu]_x f x := \int[mu]_(x in setT) f x
        dyadic_itv n k == the interval
                          `[(k%:R * 2 ^- n), (k.+1%:R * 2 ^- n)[
            approx D f == nondecreasing sequence of functions that
                          approximates f over D using dyadic intervals
      Rintegral mu D f := fine (\int[mu]_(x in D) f x).
    mu.-integrable D f == f is measurable over D and the integral of f
                          w.r.t. D is &lt; +oo
              m1 \x m2 == product measure over T1 * T2, m1 is a measure
                          measure over T1, and m2 is a sigma finite
                          measure over T2
             m1 \x^ m2 == product measure over T1 * T2, m2 is a measure
                          measure over T1, and m1 is a sigma finite
                          measure over T2
locally_integrable D f == the real number-valued function f is locally
                          integrable on D
              iavg f A := "average" of the real-valued function f over
                          the set A
            HL_maximal == the Hardy–Littlewood maximal operator
                          input: real number-valued function
                          output: extended real number-valued function
            davg f x r == "deviated average" of the real-valued function
                          f over ball x r
      lim_sup_davg f x := lime_sup (davg f x) 0
       lebesgue_pt f x == Lebesgue point at x of the real-valued
                          function f
  nicely_shrinking x E == the sequence of sets E is nicely shrinking to x
````

About the use of simple functions:
Because of a limitation of HB &lt;= 1.8.0, we need some care to be able to
use simple functions.
The structure SimpleFun (resp. NonNegSimpleFun) is located inside the
module HBSimple (resp. HBNNSimple).
As a consequence, we need to import HBSimple (resp. HBNNSimple) to use the
coercion from simple functions (resp. non-negative simple functions) to
Coq functions.
Also, assume that f (e.g., cst, indic) is equipped with the structure of
MeasurableFun. For f to be equipped with the structure of SimpleFun
(resp. NonNegSimpleFun), one need locally to import HBSimple (resp.
HBNNSimple) and to instantiate FiniteImage (resp. NonNegFun) locally.

</div>
<br/>
<span class="gallina-kwd">Set</span><span class="vernacular"> Implicit</span><span class="vernacular"> Arguments</span>.<br/>
<span class="vernacular">Unset</span><span class="vernacular"> Strict</span><span class="vernacular"> Implicit</span>.<br/>
<span class="vernacular">Unset</span><span class="vernacular"> Printing</span><span class="vernacular"> Implicit</span><span class="vernacular"> Defensive</span>.<br/>
<span class="vernacular">Import</span><span class="id"> Order</span>.<span class="id">TTheory</span><span class="id"> GRing</span>.<span class="id">Theory</span><span class="id"> Num</span>.<span class="id">Def</span><span class="id"> Num</span>.<span class="id">Theory</span>.<br/>
<span class="vernacular">Import</span><span class="id"> numFieldNormedType</span>.<span class="vernacular">Exports</span>.<br/>
<span class="vernacular">From</span><span class="id"> mathcomp</span><span class="vernacular"> Require</span><span class="vernacular"> Import</span><span class="id"> mathcomp_extra</span>.<br/>
<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> classical_set_scope</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ring_scope</span>.<br/>
<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;\int [ mu ]_ ( i 'in' D ) F&quot;</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">at</span><span class="id"> level</span><span class="id"> 36,</span><span class="id"> F</span><span class="gallina-kwd"> at</span><span class="id"> level</span><span class="id"> 36,</span><span class="id"> mu</span><span class="gallina-kwd"> at</span><span class="id"> level</span><span class="id"> 10,</span><span class="id"> i,</span><span class="id"> D</span><span class="gallina-kwd"> at</span><span class="id"> level</span><span class="id"> 50,</span><br/>
&nbsp;&nbsp;<span class="id">format</span> <span class="id">&quot;'[' \int [ mu ]_ ( i  'in'  D ) '/  '  F ']'&quot;</span>).<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;\int [ mu ]_ i F&quot;</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">at</span><span class="id"> level</span><span class="id"> 36,</span><span class="id"> F</span><span class="gallina-kwd"> at</span><span class="id"> level</span><span class="id"> 36,</span><span class="id"> mu</span><span class="gallina-kwd"> at</span><span class="id"> level</span><span class="id"> 10,</span><span class="id"> i</span><span class="gallina-kwd"> at</span><span class="id"> level</span><span class="id"> 0,</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">right</span><span class="id"> associativity,</span><span class="id"> format</span> <span class="id">&quot;'[' \int [ mu ]_ i '/  '  F ']'&quot;</span>).<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;mu .-integrable&quot;</span> (<span class="gallina-kwd">at</span><span class="id"> level</span><span class="id"> 2,</span><span class="id"> format</span> <span class="id">&quot;mu .-integrable&quot;</span>).<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;m1 '\x' m2&quot;</span> (<span class="gallina-kwd">at</span><span class="id"> level</span><span class="id"> 40,</span><span class="id"> left</span><span class="id"> associativity</span>).<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;m1 '\x^' m2&quot;</span> (<span class="gallina-kwd">at</span><span class="id"> level</span><span class="id"> 40,</span><span class="id"> left</span><span class="id"> associativity</span>).<br/>
<br/>
<span class="id">#[global]</span><br/>
<span class="vernacular">Hint</span><span class="id"> Extern</span><span class="id"> 0</span> (<span class="id">measurable</span><span class="id"> [set</span><span class="id"> _]</span>)<span class="id"> =&gt;</span><span class="id"> solve</span><span class="id"> [apply:</span><span class="id"> measurable_set1]</span><span class="id"> :</span><span class="id"> core</span>.<br/>
<br/>
<span class="id">HB</span>.<span class="id">mixin</span><span class="vernacular"> Record</span><span class="id"> isMeasurableFun</span><span class="id"> d</span><span class="id"> d'</span> (<span class="id">aT</span><span class="id"> :</span><span class="id"> sigmaRingType</span><span class="id"> d</span>) (<span class="id">rT</span><span class="id"> :</span><span class="id"> sigmaRingType</span><span class="id"> d'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">f</span><span class="id"> :</span><span class="id"> aT</span><span class="id"> -&gt;</span><span class="id"> rT</span>)<span class="id"> :=</span><span class="id"> {</span><br/>
&nbsp;&nbsp;<span class="id">measurable_funP</span><span class="id"> :</span><span class="id"> measurable_fun</span><span class="id"> [set:</span><span class="id"> aT]</span><span class="id"> f</span><br/>
<span class="id">}</span>.<br/>
<span class="id">HB</span>.<span class="id">structure</span><span class="vernacular"> Definition</span><span class="id"> MeasurableFun</span><span class="id"> d</span><span class="id"> d'</span><span class="id"> aT</span><span class="id"> rT</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">{f</span><span class="id"> of</span><span class="id"> @isMeasurableFun</span><span class="id"> d</span><span class="id"> d'</span><span class="id"> aT</span><span class="id"> rT</span><span class="id"> f}</span>.<br/>
<br/>
<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;{ 'mfun' aT &gt;-&gt; T }&quot;</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">at</span><span class="id"> level</span><span class="id"> 0,</span><span class="id"> format</span> <span class="id">&quot;{ 'mfun'  aT  &gt;-&gt;  T }&quot;</span>).<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;[ 'mfun' 'of' f ]&quot;</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">at</span><span class="id"> level</span><span class="id"> 0,</span><span class="id"> format</span> <span class="id">&quot;[ 'mfun'  'of'  f ]&quot;</span>).<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;{ 'mfun' aT &gt;-&gt; T }&quot;</span><span class="id"> :=</span> (<span class="id">@MeasurableFun</span>.<span class="id">type</span><span class="id"> _</span><span class="id"> _</span><span class="id"> aT</span><span class="id"> T</span>)<span class="id"> :</span><span class="id"> form_scope</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;[ 'mfun' 'of' f ]&quot;</span><span class="id"> :=</span><span class="id"> [the</span><span class="id"> {mfun</span><span class="id"> _</span><span class="id"> &gt;-&gt;</span><span class="id"> _}</span><span class="id"> of</span><span class="id"> f]</span><span class="id"> :</span><span class="id"> form_scope</span>.<br/>
<span class="id">#[global]</span><span class="vernacular"> Hint</span><span class="id"> Extern</span><span class="id"> 0</span> (<span class="id">measurable_fun</span><span class="id"> [set:</span><span class="id"> _]</span><span class="id"> _</span>)<span class="id"> =&gt;</span><br/>
&nbsp;&nbsp;<span class="id">solve</span><span class="id"> [apply:</span><span class="id"> measurable_funP]</span><span class="id"> :</span><span class="id"> core</span>.<br/>
<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;{ 'sfun' aT &gt;-&gt; T }&quot;</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">at</span><span class="id"> level</span><span class="id"> 0,</span><span class="id"> format</span> <span class="id">&quot;{ 'sfun'  aT  &gt;-&gt;  T }&quot;</span>).<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;[ 'sfun' 'of' f ]&quot;</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">at</span><span class="id"> level</span><span class="id"> 0,</span><span class="id"> format</span> <span class="id">&quot;[ 'sfun'  'of'  f ]&quot;</span>).<br/>
<br/>
<span class="vernacular">Module</span><span class="id"> HBSimple</span>.<br/>
<br/>
<span class="id">HB</span>.<span class="id">structure</span><span class="vernacular"> Definition</span><span class="id"> SimpleFun</span><span class="id"> d</span> (<span class="id">aT</span><span class="id"> :</span><span class="id"> sigmaRingType</span><span class="id"> d</span>) (<span class="id">rT</span><span class="id"> :</span><span class="id"> realType</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">{f</span><span class="id"> of</span><span class="id"> @isMeasurableFun</span><span class="id"> d</span><span class="id"> _</span><span class="id"> aT</span><span class="id"> rT</span><span class="id"> f</span><span class="id"> &amp;</span><span class="id"> @FiniteImage</span><span class="id"> aT</span><span class="id"> rT</span><span class="id"> f}</span>.<br/>
<br/>
<span class="vernacular">End</span><span class="id"> HBSimple</span>.<br/>
<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;{ 'sfun' aT &gt;-&gt; T }&quot;</span><span class="id"> :=</span> (<span class="id">@HBSimple</span>.<span class="id">SimpleFun</span>.<span class="id">type</span><span class="id"> _</span><span class="id"> aT</span><span class="id"> T</span>)<span class="id"> :</span><span class="id"> form_scope</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;[ 'sfun' 'of' f ]&quot;</span><span class="id"> :=</span><span class="id"> [the</span><span class="id"> {sfun</span><span class="id"> _</span><span class="id"> &gt;-&gt;</span><span class="id"> _}</span><span class="id"> of</span><span class="id"> f]</span><span class="id"> :</span><span class="id"> form_scope</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> measurable_sfunP</span><span class="id"> {d}</span><span class="id"> {aT</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d}</span><span class="id"> {rT</span><span class="id"> :</span><span class="id"> realType}</span><br/>
&nbsp;&nbsp;(<span class="id">f</span><span class="id"> :</span><span class="id"> {mfun</span><span class="id"> aT</span><span class="id"> &gt;-&gt;</span><span class="id"> rT}</span>) (<span class="id">Y</span><span class="id"> :</span><span class="id"> set</span><span class="id"> rT</span>)<span class="id"> :</span><span class="id"> measurable</span><span class="id"> Y</span><span class="id"> -&gt;</span><span class="id"> measurable</span> (<span class="id">f</span><span class="id"> @^-1`</span><span class="id"> Y</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> mY;</span><span class="id"> rewrite</span><span class="id"> -[f</span><span class="id"> @^-1`</span><span class="id"> _]setTI;</span><span class="id"> exact:</span><span class="id"> measurable_funP</span>. Qed.</div></details>
<br/>
<span class="id">HB</span>.<span class="id">mixin</span><span class="vernacular"> Record</span><span class="id"> isNonNegFun</span> (<span class="id">aT</span><span class="id"> :</span><span class="gallina-kwd"> Type</span>) (<span class="id">rT</span><span class="id"> :</span><span class="id"> numDomainType</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> aT</span><span class="id"> -&gt;</span><span class="id"> rT</span>)<span class="id"> :=</span><span class="id"> {</span><br/>
&nbsp;&nbsp;<span class="id">fun_ge0</span><span class="id"> :</span><span class="gallina-kwd"> forall</span><span class="id"> x,</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> f</span><span class="id"> x</span><br/>
<span class="id">}</span>.<br/>
<span class="id">HB</span>.<span class="id">structure</span><span class="vernacular"> Definition</span><span class="id"> NonNegFun</span><span class="id"> aT</span><span class="id"> rT</span><span class="id"> :=</span><span class="id"> {f</span><span class="id"> of</span><span class="id"> @isNonNegFun</span><span class="id"> aT</span><span class="id"> rT</span><span class="id"> f}</span>.<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;{ 'nnfun' aT &gt;-&gt; T }&quot;</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">at</span><span class="id"> level</span><span class="id"> 0,</span><span class="id"> format</span> <span class="id">&quot;{ 'nnfun'  aT  &gt;-&gt;  T }&quot;</span>).<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;[ 'nnfun' 'of' f ]&quot;</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">at</span><span class="id"> level</span><span class="id"> 0,</span><span class="id"> format</span> <span class="id">&quot;[ 'nnfun'  'of'  f ]&quot;</span>).<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;{ 'nnfun' aT &gt;-&gt; T }&quot;</span><span class="id"> :=</span> (<span class="id">@NonNegFun</span>.<span class="id">type</span><span class="id"> aT</span><span class="id"> T</span>)<span class="id"> :</span><span class="id"> form_scope</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;[ 'nnfun' 'of' f ]&quot;</span><span class="id"> :=</span><span class="id"> [the</span><span class="id"> {nnfun</span><span class="id"> _</span><span class="id"> &gt;-&gt;</span><span class="id"> _}</span><span class="id"> of</span><span class="id"> f]</span><span class="id"> :</span><span class="id"> form_scope</span>.<br/>
<span class="id">#[global]</span><span class="vernacular"> Hint</span><span class="id"> Extern</span><span class="id"> 0</span> (<span class="id">is_true</span> (<span class="id">0</span><span class="id"> &lt;=</span><span class="id"> _</span>))<span class="id"> =&gt;</span><span class="id"> solve</span><span class="id"> [apply:</span><span class="id"> fun_ge0]</span><span class="id"> :</span><span class="id"> core</span>.<br/>
<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;{ 'nnsfun' aT &gt;-&gt; T }&quot;</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">at</span><span class="id"> level</span><span class="id"> 0,</span><span class="id"> format</span> <span class="id">&quot;{ 'nnsfun'  aT  &gt;-&gt;  T }&quot;</span>).<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;[ 'nnsfun' 'of' f ]&quot;</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">at</span><span class="id"> level</span><span class="id"> 0,</span><span class="id"> format</span> <span class="id">&quot;[ 'nnsfun'  'of'  f ]&quot;</span>).<br/>
<br/>
<span class="vernacular">Module</span><span class="id"> HBNNSimple</span>.<br/>
<span class="vernacular">Import</span><span class="id"> HBSimple</span>.<br/>
<br/>
<span class="id">HB</span>.<span class="id">structure</span><span class="vernacular"> Definition</span><span class="id"> NonNegSimpleFun</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">d</span> (<span class="id">aT</span><span class="id"> :</span><span class="id"> sigmaRingType</span><span class="id"> d</span>) (<span class="id">rT</span><span class="id"> :</span><span class="id"> realType</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">{f</span><span class="id"> of</span><span class="id"> @SimpleFun</span><span class="id"> d</span><span class="id"> _</span><span class="id"> _</span><span class="id"> f</span><span class="id"> &amp;</span><span class="id"> @NonNegFun</span><span class="id"> aT</span><span class="id"> rT</span><span class="id"> f}</span>.<br/>
<br/>
<span class="vernacular">End</span><span class="id"> HBNNSimple</span>.<br/>
<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;{ 'nnsfun' aT &gt;-&gt; T }&quot;</span><span class="id"> :=</span> (<span class="id">@HBNNSimple</span>.<span class="id">NonNegSimpleFun</span>.<span class="id">type</span><span class="id"> _</span><span class="id"> aT%type</span><span class="id"> T</span>)<span class="id"> :</span><span class="id"> form_scope</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;[ 'nnsfun' 'of' f ]&quot;</span><span class="id"> :=</span><span class="id"> [the</span><span class="id"> {nnsfun</span><span class="id"> _</span><span class="id"> &gt;-&gt;</span><span class="id"> _}</span><span class="id"> of</span><span class="id"> f]</span><span class="id"> :</span><span class="id"> form_scope</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> mfun_pred</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {d</span><span class="id"> d'}</span><span class="id"> {aT</span><span class="id"> :</span><span class="id"> sigmaRingType</span><span class="id"> d}</span><span class="id"> {rT</span><span class="id"> :</span><span class="id"> sigmaRingType</span><span class="id"> d'}</span>.<br/>
<span class="vernacular">Definition</span><span class="id"> mfun</span><span class="id"> :</span><span class="id"> {pred</span><span class="id"> aT</span><span class="id"> -&gt;</span><span class="id"> rT}</span><span class="id"> :=</span><span class="id"> mem</span><span class="id"> [set</span><span class="id"> f</span><span class="id"> |</span><span class="id"> measurable_fun</span><span class="id"> setT</span><span class="id"> f]</span>.<br/>
<span class="vernacular">Definition</span><span class="id"> mfun_key</span><span class="id"> :</span><span class="id"> pred_key</span><span class="id"> mfun</span><br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id"> exact</span>. Qed.</div></details>
<span class="vernacular">Canonical</span><span class="id"> mfun_keyed</span><span class="id"> :=</span><span class="id"> KeyedPred</span><span class="id"> mfun_key</span>.<br/>
<span class="vernacular">End</span><span class="id"> mfun_pred</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> mfun</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {d</span><span class="id"> d'}</span><span class="id"> {aT</span><span class="id"> :</span><span class="id"> sigmaRingType</span><span class="id"> d}</span><span class="id"> {rT</span><span class="id"> :</span><span class="id"> sigmaRingType</span><span class="id"> d'}</span>.<br/>
<span class="vernacular">Notation</span><span class="id"> T</span><span class="id"> :=</span><span class="id"> {mfun</span><span class="id"> aT</span><span class="id"> &gt;-&gt;</span><span class="id"> rT}</span>.<br/>
<span class="vernacular">Notation</span><span class="id"> mfun</span><span class="id"> :=</span> (<span class="id">@mfun</span><span class="id"> _</span><span class="id"> _</span><span class="id"> aT</span><span class="id"> rT</span>).<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> Sub</span>.<br/>
<span class="vernacular">Context</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> aT</span><span class="id"> -&gt;</span><span class="id"> rT</span>) (<span class="id">fP</span><span class="id"> :</span><span class="id"> f</span><span class="id"> \in</span><span class="id"> mfun</span>).<br/>
<span class="vernacular">Definition</span><span class="id"> mfun_Sub_subproof</span><span class="id"> :=</span><span class="id"> @isMeasurableFun</span>.<span class="id">Build</span><span class="id"> d</span><span class="id"> _</span><span class="id"> aT</span><span class="id"> rT</span><span class="id"> f</span> (<span class="id">set_mem</span><span class="id"> fP</span>).<br/>
<span class="id">#[local]</span><span class="id"> HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> mfun_Sub_subproof</span>.<br/>
<span class="vernacular">Definition</span><span class="id"> mfun_Sub</span><span class="id"> :=</span><span class="id"> [mfun</span><span class="id"> of</span><span class="id"> f]</span>.<br/>
<span class="vernacular">End</span><span class="id"> Sub</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> mfun_rect</span> (<span class="id">K</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="gallina-kwd"> Type</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">forall</span><span class="id"> f</span> (<span class="id">Pf</span><span class="id"> :</span><span class="id"> f</span><span class="id"> \in</span><span class="id"> mfun</span>)<span class="id">,</span><span class="id"> K</span> (<span class="id">mfun_Sub</span><span class="id"> Pf</span>))<span class="id"> -&gt;</span><span class="gallina-kwd"> forall</span><span class="id"> u</span><span class="id"> :</span><span class="id"> T,</span><span class="id"> K</span><span class="id"> u</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> Ksub</span><span class="id"> [f</span><span class="id"> [[Pf]]]/=</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> suff</span><span class="id"> -&gt;</span><span class="id"> :</span><span class="id"> Pf</span><span class="id"> =</span> (<span class="id">set_mem</span> (<span class="id">@mem_set</span><span class="id"> _</span><span class="id"> [set</span><span class="id"> f</span><span class="id"> |</span><span class="id"> _]</span><span class="id"> f</span><span class="id"> Pf</span>))<span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> Ksub</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> mfun_valP</span><span class="id"> f</span> (<span class="id">Pf</span><span class="id"> :</span><span class="id"> f</span><span class="id"> \in</span><span class="id"> mfun</span>)<span class="id"> :</span><span class="id"> mfun_Sub</span><span class="id"> Pf</span><span class="id"> =</span><span class="id"> f</span><span class="id"> :&gt;</span> (_<span class="id"> -&gt;</span><span class="id"> _</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> []</span>. Qed.</div></details>
<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> isSub</span>.<span class="id">Build</span><span class="id"> _</span><span class="id"> _</span><span class="id"> T</span><span class="id"> mfun_rect</span><span class="id"> mfun_valP</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> mfuneqP</span> (<span class="id">f</span><span class="id"> g</span><span class="id"> :</span><span class="id"> {mfun</span><span class="id"> aT</span><span class="id"> &gt;-&gt;</span><span class="id"> rT}</span>)<span class="id"> :</span><span class="id"> f</span><span class="id"> =</span><span class="id"> g</span><span class="id"> &lt;-&gt;</span><span class="id"> f</span><span class="id"> =1</span><span class="id"> g</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> split=&gt;</span><span class="id"> [-&gt;//|fg];</span><span class="id"> apply/val_inj/funext</span>. Qed.</div></details>
<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> [Choice</span><span class="id"> of</span><span class="id"> {mfun</span><span class="id"> aT</span><span class="id"> &gt;-&gt;</span><span class="id"> rT}</span><span class="gallina-kwd"> by</span><span class="id"> &lt;:]</span>.<br/>
<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> x</span><span class="id"> :=</span><span class="id"> isMeasurableFun</span>.<span class="id">Build</span><span class="id"> d</span><span class="id"> _</span><span class="id"> aT</span><span class="id"> rT</span> (<span class="id">cst</span><span class="id"> x</span>)<br/>
&nbsp;&nbsp;(<span class="id">@measurable_cst</span><span class="id"> _</span><span class="id"> _</span><span class="id"> aT</span><span class="id"> rT</span><span class="id"> setT</span><span class="id"> x</span>).<br/>
<br/>
<span class="vernacular">End</span><span class="id"> mfun</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> mfun_realType</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {d}</span><span class="id"> {aT</span><span class="id"> :</span><span class="id"> sigmaRingType</span><span class="id"> d}</span><span class="id"> {rT</span><span class="id"> :</span><span class="id"> realType}</span>.<br/>
<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> @isMeasurableFun</span>.<span class="id">Build</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> rT</span><br/>
&nbsp;&nbsp;(<span class="id">@normr</span><span class="id"> rT</span><span class="id"> rT</span>) (<span class="id">@normr_measurable</span><span class="id"> rT</span><span class="id"> setT</span>).<br/>
<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">isMeasurableFun</span>.<span class="id">Build</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">@expR</span><span class="id"> rT</span>) (<span class="id">@measurable_expR</span><span class="id"> rT</span>).<br/>
<br/>
<span class="vernacular">End</span><span class="id"> mfun_realType</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> mfun_measurableType</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {d</span><span class="id"> d'}</span><span class="id"> {aT</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d}</span><span class="id"> {rT</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d'}</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> measurableT_comp_subproof</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {mfun</span><span class="id"> _</span><span class="id"> &gt;-&gt;</span><span class="id"> rT}</span>) (<span class="id">g</span><span class="id"> :</span><span class="id"> {mfun</span><span class="id"> aT</span><span class="id"> &gt;-&gt;</span><span class="id"> rT}</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">measurable_fun</span><span class="id"> setT</span> (<span class="id">f</span><span class="id"> \o</span><span class="id"> g</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id"> exact:</span><span class="id"> measurableT_comp</span>. Qed.</div></details>
<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {mfun</span><span class="id"> _</span><span class="id"> &gt;-&gt;</span><span class="id"> rT}</span>) (<span class="id">g</span><span class="id"> :</span><span class="id"> {mfun</span><span class="id"> aT</span><span class="id"> &gt;-&gt;</span><span class="id"> rT}</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">isMeasurableFun</span>.<span class="id">Build</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> \o</span><span class="id"> g</span>) (<span class="id">measurableT_comp_subproof</span><span class="id"> _</span><span class="id"> _</span>).<br/>
<br/>
<span class="vernacular">End</span><span class="id"> mfun_measurableType</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> ring</span>.<br/>
<span class="vernacular">Context</span><span class="id"> d</span> (<span class="id">aT</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d</span>) (<span class="id">rT</span><span class="id"> :</span><span class="id"> realType</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> mfun_subring_closed</span><span class="id"> :</span><span class="id"> subring_closed</span> (<span class="id">@mfun</span><span class="id"> _</span><span class="id"> _</span><span class="id"> aT</span><span class="id"> rT</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">split=&gt;</span><span class="id"> [|f</span><span class="id"> g|f</span><span class="id"> g];</span><span class="id"> rewrite</span><span class="id"> !inE/=</span>.<br/>
<span class="id">-</span><span class="id"> exact:</span><span class="id"> measurable_cst</span>.<br/>
<span class="id">-</span><span class="id"> exact:</span><span class="id"> measurable_funB</span>.<br/>
<span class="id">-</span><span class="id"> exact:</span><span class="id"> measurable_funM</span>.<br/>
Qed.</div></details>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> GRing</span>.<span class="id">isSubringClosed</span>.<span class="id">Build</span><span class="id"> _</span><br/>
&nbsp;&nbsp;(<span class="id">@mfun</span><span class="id"> d</span><span class="id"> default_measure_display</span><span class="id"> aT</span><span class="id"> rT</span>)<span class="id"> mfun_subring_closed</span>.<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> [SubChoice_isSubComRing</span><span class="id"> of</span><span class="id"> {mfun</span><span class="id"> aT</span><span class="id"> &gt;-&gt;</span><span class="id"> rT}</span><span class="gallina-kwd"> by</span><span class="id"> &lt;:]</span>.<br/>
<br/>
<span class="vernacular">Implicit</span><span class="id"> Types</span> (<span class="id">f</span><span class="id"> g</span><span class="id"> :</span><span class="id"> {mfun</span><span class="id"> aT</span><span class="id"> &gt;-&gt;</span><span class="id"> rT}</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> mfun0</span><span class="id"> :</span> (<span class="id">0</span><span class="id"> :</span><span class="id"> {mfun</span><span class="id"> aT</span><span class="id"> &gt;-&gt;</span><span class="id"> rT}</span>)<span class="id"> =1</span><span class="id"> cst</span><span class="id"> 0</span><span class="id"> :&gt;</span> (_<span class="id"> -&gt;</span><span class="id"> _</span>)<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> []</span>. Qed.</div></details>
<span class="vernacular">Lemma</span><span class="id"> mfun1</span><span class="id"> :</span> (<span class="id">1</span><span class="id"> :</span><span class="id"> {mfun</span><span class="id"> aT</span><span class="id"> &gt;-&gt;</span><span class="id"> rT}</span>)<span class="id"> =1</span><span class="id"> cst</span><span class="id"> 1</span><span class="id"> :&gt;</span> (_<span class="id"> -&gt;</span><span class="id"> _</span>)<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> []</span>. Qed.</div></details>
<span class="vernacular">Lemma</span><span class="id"> mfunN</span><span class="id"> f</span><span class="id"> :</span><span class="id"> -</span><span class="id"> f</span><span class="id"> =</span><span class="id"> \-</span><span class="id"> f</span><span class="id"> :&gt;</span> (_<span class="id"> -&gt;</span><span class="id"> _</span>)<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> []</span>. Qed.</div></details>
<span class="vernacular">Lemma</span><span class="id"> mfunD</span><span class="id"> f</span><span class="id"> g</span><span class="id"> :</span><span class="id"> f</span><span class="id"> +</span><span class="id"> g</span><span class="id"> =</span><span class="id"> f</span><span class="id"> \+</span><span class="id"> g</span><span class="id"> :&gt;</span> (_<span class="id"> -&gt;</span><span class="id"> _</span>)<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> []</span>. Qed.</div></details>
<span class="vernacular">Lemma</span><span class="id"> mfunB</span><span class="id"> f</span><span class="id"> g</span><span class="id"> :</span><span class="id"> f</span><span class="id"> -</span><span class="id"> g</span><span class="id"> =</span><span class="id"> f</span><span class="id"> \-</span><span class="id"> g</span><span class="id"> :&gt;</span> (_<span class="id"> -&gt;</span><span class="id"> _</span>)<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> []</span>. Qed.</div></details>
<span class="vernacular">Lemma</span><span class="id"> mfunM</span><span class="id"> f</span><span class="id"> g</span><span class="id"> :</span><span class="id"> f</span><span class="id"> *</span><span class="id"> g</span><span class="id"> =</span><span class="id"> f</span><span class="id"> \*</span><span class="id"> g</span><span class="id"> :&gt;</span> (_<span class="id"> -&gt;</span><span class="id"> _</span>)<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> []</span>. Qed.</div></details>
<span class="vernacular">Lemma</span><span class="id"> mfun_sum</span><span class="id"> I</span><span class="id"> r</span> (<span class="id">P</span><span class="id"> :</span><span class="id"> {pred</span><span class="id"> I}</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> I</span><span class="id"> -&gt;</span><span class="id"> {mfun</span><span class="id"> aT</span><span class="id"> &gt;-&gt;</span><span class="id"> rT}</span>) (<span class="id">x</span><span class="id"> :</span><span class="id"> aT</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;(<span class="id">\sum_</span>(<span class="id">i</span><span class="id"> &lt;-</span><span class="id"> r</span><span class="id"> |</span><span class="id"> P</span><span class="id"> i</span>)<span class="id"> f</span><span class="id"> i</span>)<span class="id"> x</span><span class="id"> =</span><span class="id"> \sum_</span>(<span class="id">i</span><span class="id"> &lt;-</span><span class="id"> r</span><span class="id"> |</span><span class="id"> P</span><span class="id"> i</span>)<span class="id"> f</span><span class="id"> i</span><span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> elim/big_rec2:</span><span class="id"> _</span><span class="id"> =&gt;</span><span class="id"> //=</span><span class="id"> i</span><span class="id"> y</span><span class="id"> ?</span><span class="id"> Pi</span><span class="id"> &lt;-</span>. Qed.</div></details>
<span class="vernacular">Lemma</span><span class="id"> mfun_prod</span><span class="id"> I</span><span class="id"> r</span> (<span class="id">P</span><span class="id"> :</span><span class="id"> {pred</span><span class="id"> I}</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> I</span><span class="id"> -&gt;</span><span class="id"> {mfun</span><span class="id"> aT</span><span class="id"> &gt;-&gt;</span><span class="id"> rT}</span>) (<span class="id">x</span><span class="id"> :</span><span class="id"> aT</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;(<span class="id">\sum_</span>(<span class="id">i</span><span class="id"> &lt;-</span><span class="id"> r</span><span class="id"> |</span><span class="id"> P</span><span class="id"> i</span>)<span class="id"> f</span><span class="id"> i</span>)<span class="id"> x</span><span class="id"> =</span><span class="id"> \sum_</span>(<span class="id">i</span><span class="id"> &lt;-</span><span class="id"> r</span><span class="id"> |</span><span class="id"> P</span><span class="id"> i</span>)<span class="id"> f</span><span class="id"> i</span><span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> elim/big_rec2:</span><span class="id"> _</span><span class="id"> =&gt;</span><span class="id"> //=</span><span class="id"> i</span><span class="id"> y</span><span class="id"> ?</span><span class="id"> Pi</span><span class="id"> &lt;-</span>. Qed.</div></details>
<span class="vernacular">Lemma</span><span class="id"> mfunX</span><span class="id"> f</span><span class="id"> n</span><span class="id"> :</span><span class="id"> f</span><span class="id"> ^+</span><span class="id"> n</span><span class="id"> =</span> (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> f</span><span class="id"> x</span><span class="id"> ^+</span><span class="id"> n</span>)<span class="id"> :&gt;</span> (_<span class="id"> -&gt;</span><span class="id"> _</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> apply/funext=&gt;</span><span class="id"> x;</span><span class="id"> elim:</span><span class="id"> n</span><span class="id"> =&gt;</span><span class="id"> [|n</span><span class="id"> IHn]//;</span><span class="id"> rewrite</span><span class="id"> !exprS</span><span class="id"> mfunM/=</span><span class="id"> IHn</span>. Qed.</div></details>
<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> f</span><span class="id"> g</span><span class="id"> :=</span><span class="id"> MeasurableFun</span>.<span class="id">copy</span> (<span class="id">f</span><span class="id"> \+</span><span class="id"> g</span>) (<span class="id">f</span><span class="id"> +</span><span class="id"> g</span>).<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> f</span><span class="id"> g</span><span class="id"> :=</span><span class="id"> MeasurableFun</span>.<span class="id">copy</span> (<span class="id">\-</span><span class="id"> f</span>) (<span class="id">-</span><span class="id"> f</span>).<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> f</span><span class="id"> g</span><span class="id"> :=</span><span class="id"> MeasurableFun</span>.<span class="id">copy</span> (<span class="id">f</span><span class="id"> \-</span><span class="id"> g</span>) (<span class="id">f</span><span class="id"> -</span><span class="id"> g</span>).<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> f</span><span class="id"> g</span><span class="id"> :=</span><span class="id"> MeasurableFun</span>.<span class="id">copy</span> (<span class="id">f</span><span class="id"> \*</span><span class="id"> g</span>) (<span class="id">f</span><span class="id"> *</span><span class="id"> g</span>).<br/>
<br/>
<span class="vernacular">Definition</span><span class="id"> mindic</span> (<span class="id">D</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT</span>)<span class="id"> of</span><span class="id"> measurable</span><span class="id"> D</span><span class="id"> :</span><span class="id"> aT</span><span class="id"> -&gt;</span><span class="id"> rT</span><span class="id"> :=</span><span class="id"> \1_D</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> mindicE</span> (<span class="id">D</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT</span>) (<span class="id">mD</span><span class="id"> :</span><span class="id"> measurable</span><span class="id"> D</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">mindic</span><span class="id"> mD</span><span class="id"> =</span> (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> =&gt;</span> (<span class="id">x</span><span class="id"> \in</span><span class="id"> D</span>)<span class="id">%:R</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> /mindic</span><span class="id"> funeqE</span><span class="id"> =&gt;</span><span class="id"> t;</span><span class="id"> rewrite</span><span class="id"> indicE</span>. Qed.</div></details>
<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> D</span><span class="id"> mD</span><span class="id"> :=</span><span class="id"> @isMeasurableFun</span>.<span class="id">Build</span><span class="id"> _</span><span class="id"> _</span><span class="id"> aT</span><span class="id"> rT</span> (<span class="id">mindic</span><span class="id"> mD</span>)<br/>
&nbsp;&nbsp;(<span class="id">@measurable_fun_indic</span><span class="id"> _</span><span class="id"> aT</span><span class="id"> rT</span><span class="id"> setT</span><span class="id"> D</span><span class="id"> mD</span>).<br/>
<br/>
<span class="vernacular">Definition</span><span class="id"> indic_mfun</span> (<span class="id">D</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT</span>) (<span class="id">mD</span><span class="id"> :</span><span class="id"> measurable</span><span class="id"> D</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">[the</span><span class="id"> {mfun</span><span class="id"> aT</span><span class="id"> &gt;-&gt;</span><span class="id"> rT}</span><span class="id"> of</span><span class="id"> mindic</span><span class="id"> mD]</span>.<br/>
<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> k</span><span class="id"> f</span><span class="id"> :=</span><span class="id"> MeasurableFun</span>.<span class="id">copy</span> (<span class="id">k</span><span class="id"> \o*</span><span class="id"> f</span>) (<span class="id">f</span><span class="id"> *</span><span class="id"> cst</span><span class="id"> k</span>).<br/>
<span class="vernacular">Definition</span><span class="id"> scale_mfun</span><span class="id"> k</span><span class="id"> f</span><span class="id"> :=</span><span class="id"> [the</span><span class="id"> {mfun</span><span class="id"> aT</span><span class="id"> &gt;-&gt;</span><span class="id"> rT}</span><span class="id"> of</span><span class="id"> k</span><span class="id"> \o*</span><span class="id"> f]</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> max_mfun_subproof</span><span class="id"> f</span><span class="id"> g</span><span class="id"> :</span><span class="id"> @isMeasurableFun</span><span class="id"> d</span><span class="id"> _</span><span class="id"> aT</span><span class="id"> rT</span> (<span class="id">f</span><span class="id"> \max</span><span class="id"> g</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> split;</span><span class="id"> apply:</span><span class="id"> measurable_maxr</span>. Qed.</div></details>
<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> f</span><span class="id"> g</span><span class="id"> :=</span><span class="id"> max_mfun_subproof</span><span class="id"> f</span><span class="id"> g</span>.<br/>
<br/>
<span class="vernacular">Definition</span><span class="id"> max_mfun</span><span class="id"> f</span><span class="id"> g</span><span class="id"> :=</span><span class="id"> [the</span><span class="id"> {mfun</span><span class="id"> aT</span><span class="id"> &gt;-&gt;</span><span class="id"> _}</span><span class="id"> of</span><span class="id"> f</span><span class="id"> \max</span><span class="id"> g]</span>.<br/>
<br/>
<span class="vernacular">End</span><span class="id"> ring</span>.<br/>
<span class="vernacular">Arguments</span><span class="id"> indic_mfun</span><span class="id"> {d</span><span class="id"> aT</span><span class="id"> rT}</span><span class="id"> _</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> measurable_indic</span><span class="id"> d</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">D</span><span class="id"> A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T</span>)<span class="id"> :</span><span class="id"> measurable</span><span class="id"> A</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">measurable_fun</span><span class="id"> D</span> (<span class="id">\1_A</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> R</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> mA;</span><span class="id"> apply/measurable_funTS;</span><span class="id"> rewrite</span> (_<span class="id"> :</span><span class="id"> \1__</span><span class="id"> =</span><span class="id"> mindic</span><span class="id"> R</span><span class="id"> mA</span>).<br/>
Qed.</div></details>
<span class="id">#[global]</span><span class="vernacular"> Hint</span><span class="id"> Extern</span><span class="id"> 0</span>  (<span class="id">measurable_fun</span><span class="id"> _</span> (<span class="id">\1__</span><span class="id"> :</span><span class="id"> _</span><span class="id"> -&gt;</span><span class="id"> _</span>))<span class="id"> =&gt;</span><br/>
&nbsp;&nbsp;(<span class="id">exact:</span><span class="id"> measurable_indic</span> )<span class="id"> :</span><span class="id"> core</span>.<br/>
<span class="id">#[deprecated</span>(<span class="id">since=</span><span class="id">&quot;mathcomp-analysis 0.6.3&quot;</span><span class="id">,</span><span class="id"> note=</span><span class="id">&quot;use `measurable_indic` instead&quot;</span>)<span class="id">]</span><br/>
<span class="vernacular">Notation</span><span class="id"> measurable_fun_indic</span><span class="id"> :=</span><span class="id"> measurable_indic</span> (<span class="id">only</span><span class="id"> parsing</span>).<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> sfun_pred</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {d}</span><span class="id"> {aT</span><span class="id"> :</span><span class="id"> sigmaRingType</span><span class="id"> d}</span><span class="id"> {rT</span><span class="id"> :</span><span class="id"> realType}</span>.<br/>
<span class="vernacular">Definition</span><span class="id"> sfun</span><span class="id"> :</span><span class="id"> {pred</span><span class="id"> _</span><span class="id"> -&gt;</span><span class="id"> _}</span><span class="id"> :=</span><span class="id"> [predI</span><span class="id"> @mfun</span><span class="id"> _</span><span class="id"> _</span><span class="id"> aT</span><span class="id"> rT</span><span class="id"> &amp;</span><span class="id"> fimfun]</span>.<br/>
<span class="vernacular">Definition</span><span class="id"> sfun_key</span><span class="id"> :</span><span class="id"> pred_key</span><span class="id"> sfun</span><br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id"> exact</span>. Qed.</div></details>
<span class="vernacular">Canonical</span><span class="id"> sfun_keyed</span><span class="id"> :=</span><span class="id"> KeyedPred</span><span class="id"> sfun_key</span>.<br/>
<span class="vernacular">Lemma</span><span class="id"> sub_sfun_mfun</span><span class="id"> :</span><span class="id"> {subset</span><span class="id"> sfun</span><span class="id"> &lt;=</span><span class="id"> mfun}</span><br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> /andP[]</span>. Qed.</div></details>
<span class="vernacular">Lemma</span><span class="id"> sub_sfun_fimfun</span><span class="id"> :</span><span class="id"> {subset</span><span class="id"> sfun</span><span class="id"> &lt;=</span><span class="id"> fimfun}</span><br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> /andP[]</span>. Qed.</div></details>
<span class="vernacular">End</span><span class="id"> sfun_pred</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> sfun</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {d}</span><span class="id"> {aT</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d}</span><span class="id"> {rT</span><span class="id"> :</span><span class="id"> realType}</span>.<br/>
<span class="vernacular">Notation</span><span class="id"> T</span><span class="id"> :=</span><span class="id"> {sfun</span><span class="id"> aT</span><span class="id"> &gt;-&gt;</span><span class="id"> rT}</span>.<br/>
<span class="vernacular">Notation</span><span class="id"> sfun</span><span class="id"> :=</span> (<span class="id">@sfun</span><span class="id"> _</span><span class="id"> aT</span><span class="id"> rT</span>).<br/>
<span class="vernacular">Section</span><span class="id"> Sub</span>.<br/>
<span class="vernacular">Context</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> aT</span><span class="id"> -&gt;</span><span class="id"> rT</span>) (<span class="id">fP</span><span class="id"> :</span><span class="id"> f</span><span class="id"> \in</span><span class="id"> sfun</span>).<br/>
<span class="vernacular">Definition</span><span class="id"> sfun_Sub1_subproof</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">@isMeasurableFun</span>.<span class="id">Build</span><span class="id"> d</span><span class="id"> _</span><span class="id"> aT</span><span class="id"> rT</span><span class="id"> f</span> (<span class="id">set_mem</span> (<span class="id">sub_sfun_mfun</span><span class="id"> fP</span>)).<br/>
<span class="id">#[local]</span><span class="id"> HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> sfun_Sub1_subproof</span>.<br/>
<span class="vernacular">Definition</span><span class="id"> sfun_Sub2_subproof</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">@FiniteImage</span>.<span class="id">Build</span><span class="id"> aT</span><span class="id"> rT</span><span class="id"> f</span> (<span class="id">set_mem</span> (<span class="id">sub_sfun_fimfun</span><span class="id"> fP</span>)).<br/>
<br/>
<span class="vernacular">Import</span><span class="id"> HBSimple</span>.<br/>
<br/>
<span class="id">#[local]</span><span class="id"> HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> sfun_Sub2_subproof</span>.<br/>
<span class="vernacular">Definition</span><span class="id"> sfun_Sub</span><span class="id"> :=</span><span class="id"> [sfun</span><span class="id"> of</span><span class="id"> f]</span>.<br/>
<span class="vernacular">End</span><span class="id"> Sub</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> sfun_rect</span> (<span class="id">K</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="gallina-kwd"> Type</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">forall</span><span class="id"> f</span> (<span class="id">Pf</span><span class="id"> :</span><span class="id"> f</span><span class="id"> \in</span><span class="id"> sfun</span>)<span class="id">,</span><span class="id"> K</span> (<span class="id">sfun_Sub</span><span class="id"> Pf</span>))<span class="id"> -&gt;</span><span class="gallina-kwd"> forall</span><span class="id"> u</span><span class="id"> :</span><span class="id"> T,</span><span class="id"> K</span><span class="id"> u</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> Ksub</span><span class="id"> [f</span><span class="id"> [[Pf1]</span><span class="id"> [Pf2]]];</span><span class="id"> have</span><span class="id"> Pf</span><span class="id"> :</span><span class="id"> f</span><span class="id"> \in</span><span class="id"> sfun</span><span class="gallina-kwd"> by</span><span class="id"> apply/andP;</span><span class="id"> rewrite</span><span class="id"> ?inE</span>.<br/>
<span class="id">have</span><span class="id"> -&gt;</span><span class="id"> :</span><span class="id"> Pf1</span><span class="id"> =</span><span class="id"> set_mem</span> (<span class="id">sub_sfun_mfun</span><span class="id"> Pf</span>)<span class="gallina-kwd"> by</span><span class="id"> []</span>.<br/>
<span class="id">have</span><span class="id"> -&gt;</span><span class="id"> :</span><span class="id"> Pf2</span><span class="id"> =</span><span class="id"> set_mem</span> (<span class="id">sub_sfun_fimfun</span><span class="id"> Pf</span>)<span class="gallina-kwd"> by</span><span class="id"> []</span>.<br/>
<span class="id">exact:</span><span class="id"> Ksub</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Import</span><span class="id"> HBSimple</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> sfun_valP</span><span class="id"> f</span> (<span class="id">Pf</span><span class="id"> :</span><span class="id"> f</span><span class="id"> \in</span><span class="id"> sfun</span>)<span class="id"> :</span><span class="id"> sfun_Sub</span><span class="id"> Pf</span><span class="id"> =</span><span class="id"> f</span><span class="id"> :&gt;</span> (_<span class="id"> -&gt;</span><span class="id"> _</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> []</span>. Qed.</div></details>
<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> isSub</span>.<span class="id">Build</span><span class="id"> _</span><span class="id"> _</span><span class="id"> T</span><span class="id"> sfun_rect</span><span class="id"> sfun_valP</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> sfuneqP</span> (<span class="id">f</span><span class="id"> g</span><span class="id"> :</span><span class="id"> {sfun</span><span class="id"> aT</span><span class="id"> &gt;-&gt;</span><span class="id"> rT}</span>)<span class="id"> :</span><span class="id"> f</span><span class="id"> =</span><span class="id"> g</span><span class="id"> &lt;-&gt;</span><span class="id"> f</span><span class="id"> =1</span><span class="id"> g</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> split=&gt;</span><span class="id"> [-&gt;//|fg];</span><span class="id"> apply/val_inj/funext</span>. Qed.</div></details>
<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> [Choice</span><span class="id"> of</span><span class="id"> {sfun</span><span class="id"> aT</span><span class="id"> &gt;-&gt;</span><span class="id"> rT}</span><span class="gallina-kwd"> by</span><span class="id"> &lt;:]</span>.<br/>
<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> x</span><span class="id"> :</span><span class="id"> @FImFun</span><span class="id"> aT</span><span class="id"> rT</span> (<span class="id">cst</span><span class="id"> x</span>)<span class="id"> :=</span><span class="id"> FImFun</span>.<span class="id">on</span> (<span class="id">cst</span><span class="id"> x</span>).<br/>
<br/>
<span class="vernacular">Definition</span><span class="id"> cst_sfun</span><span class="id"> x</span><span class="id"> :=</span><span class="id"> [the</span><span class="id"> {sfun</span><span class="id"> aT</span><span class="id"> &gt;-&gt;</span><span class="id"> rT}</span><span class="id"> of</span><span class="id"> cst</span><span class="id"> x]</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> cst_sfunE</span><span class="id"> x</span><span class="id"> :</span><span class="id"> @cst_sfun</span><span class="id"> x</span><span class="id"> =1</span><span class="id"> cst</span><span class="id"> x</span><br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> []</span>. Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> sfun</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> fctD</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> pointedType</span>) (<span class="id">K</span><span class="id"> :</span><span class="id"> ringType</span>) (<span class="id">f</span><span class="id"> g</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> K</span>)<span class="id"> :</span><span class="id"> f</span><span class="id"> +</span><span class="id"> g</span><span class="id"> =</span><span class="id"> f</span><span class="id"> \+</span><span class="id"> g</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> []</span>. Qed.</div></details>
<span class="vernacular">Lemma</span><span class="id"> fctN</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> pointedType</span>) (<span class="id">K</span><span class="id"> :</span><span class="id"> ringType</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> K</span>)<span class="id"> :</span><span class="id"> -</span><span class="id"> f</span><span class="id"> =</span><span class="id"> \-</span><span class="id"> f</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> []</span>. Qed.</div></details>
<span class="vernacular">Lemma</span><span class="id"> fctM</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> pointedType</span>) (<span class="id">K</span><span class="id"> :</span><span class="id"> ringType</span>) (<span class="id">f</span><span class="id"> g</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> K</span>)<span class="id"> :</span><span class="id"> f</span><span class="id"> *</span><span class="id"> g</span><span class="id"> =</span><span class="id"> f</span><span class="id"> \*</span><span class="id"> g</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> []</span>. Qed.</div></details>
<span class="vernacular">Lemma</span><span class="id"> fctZ</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> pointedType</span>) (<span class="id">K</span><span class="id"> :</span><span class="id"> ringType</span>) (<span class="id">L</span><span class="id"> :</span><span class="id"> lmodType</span><span class="id"> K</span>)<span class="id"> k</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> L</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id">k</span><span class="id"> *:</span><span class="id"> f</span><span class="id"> =</span><span class="id"> k</span><span class="id"> \*:</span><span class="id"> f</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> []</span>. Qed.</div></details>
<span class="vernacular">Arguments</span><span class="id"> cst</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> /</span>.<br/>
<span class="vernacular">Definition</span><span class="id"> fctWE</span><span class="id"> :=</span> (<span class="id">fctD,</span><span class="id"> fctN,</span><span class="id"> fctM,</span><span class="id"> fctZ</span>).<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> ring</span>.<br/>
<span class="vernacular">Context</span><span class="id"> d</span> (<span class="id">aT</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d</span>) (<span class="id">rT</span><span class="id"> :</span><span class="id"> realType</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> sfun_subring_closed</span><span class="id"> :</span><span class="id"> subring_closed</span> (<span class="id">@sfun</span><span class="id"> d</span><span class="id"> aT</span><span class="id"> rT</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd">by</span><span class="id"> split=&gt;</span><span class="id"> [|f</span><span class="id"> g|f</span><span class="id"> g];</span><span class="id"> rewrite</span><span class="id"> ?inE/=</span><span class="id"> ?rpred1//;</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> /andP[/=</span><span class="id"> mf</span><span class="id"> ff]</span><span class="id"> /andP[/=</span><span class="id"> mg</span><span class="id"> fg];</span><span class="id"> rewrite</span><span class="id"> !</span>(<span class="id">rpredB,</span><span class="id"> rpredM</span>).<br/>
Qed.</div></details>
<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> GRing</span>.<span class="id">isSubringClosed</span>.<span class="id">Build</span><span class="id"> _</span><span class="id"> sfun</span><br/>
&nbsp;&nbsp;<span class="id">sfun_subring_closed</span>.<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> [SubChoice_isSubComRing</span><span class="id"> of</span><span class="id"> {sfun</span><span class="id"> aT</span><span class="id"> &gt;-&gt;</span><span class="id"> rT}</span><span class="gallina-kwd"> by</span><span class="id"> &lt;:]</span>.<br/>
<br/>
<span class="vernacular">Implicit</span><span class="id"> Types</span> (<span class="id">f</span><span class="id"> g</span><span class="id"> :</span><span class="id"> {sfun</span><span class="id"> aT</span><span class="id"> &gt;-&gt;</span><span class="id"> rT}</span>).<br/>
<br/>
<span class="vernacular">Import</span><span class="id"> HBSimple</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> sfun0</span><span class="id"> :</span> (<span class="id">0</span><span class="id"> :</span><span class="id"> {sfun</span><span class="id"> aT</span><span class="id"> &gt;-&gt;</span><span class="id"> rT}</span>)<span class="id"> =1</span><span class="id"> cst</span><span class="id"> 0</span><br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> []</span>. Qed.</div></details>
<span class="vernacular">Lemma</span><span class="id"> sfun1</span><span class="id"> :</span> (<span class="id">1</span><span class="id"> :</span><span class="id"> {sfun</span><span class="id"> aT</span><span class="id"> &gt;-&gt;</span><span class="id"> rT}</span>)<span class="id"> =1</span><span class="id"> cst</span><span class="id"> 1</span><br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> []</span>. Qed.</div></details>
<span class="vernacular">Lemma</span><span class="id"> sfunN</span><span class="id"> f</span><span class="id"> :</span><span class="id"> -</span><span class="id"> f</span><span class="id"> =1</span><span class="id"> \-</span><span class="id"> f</span><br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> []</span>. Qed.</div></details>
<span class="vernacular">Lemma</span><span class="id"> sfunD</span><span class="id"> f</span><span class="id"> g</span><span class="id"> :</span><span class="id"> f</span><span class="id"> +</span><span class="id"> g</span><span class="id"> =1</span><span class="id"> f</span><span class="id"> \+</span><span class="id"> g</span><br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> []</span>. Qed.</div></details>
<span class="vernacular">Lemma</span><span class="id"> sfunB</span><span class="id"> f</span><span class="id"> g</span><span class="id"> :</span><span class="id"> f</span><span class="id"> -</span><span class="id"> g</span><span class="id"> =1</span><span class="id"> f</span><span class="id"> \-</span><span class="id"> g</span><br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> []</span>. Qed.</div></details>
<span class="vernacular">Lemma</span><span class="id"> sfunM</span><span class="id"> f</span><span class="id"> g</span><span class="id"> :</span><span class="id"> f</span><span class="id"> *</span><span class="id"> g</span><span class="id"> =1</span><span class="id"> f</span><span class="id"> \*</span><span class="id"> g</span><br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> []</span>. Qed.</div></details>
<span class="vernacular">Lemma</span><span class="id"> sfun_sum</span><span class="id"> I</span><span class="id"> r</span> (<span class="id">P</span><span class="id"> :</span><span class="id"> {pred</span><span class="id"> I}</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> I</span><span class="id"> -&gt;</span><span class="id"> {sfun</span><span class="id"> aT</span><span class="id"> &gt;-&gt;</span><span class="id"> rT}</span>) (<span class="id">x</span><span class="id"> :</span><span class="id"> aT</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;(<span class="id">\sum_</span>(<span class="id">i</span><span class="id"> &lt;-</span><span class="id"> r</span><span class="id"> |</span><span class="id"> P</span><span class="id"> i</span>)<span class="id"> f</span><span class="id"> i</span>)<span class="id"> x</span><span class="id"> =</span><span class="id"> \sum_</span>(<span class="id">i</span><span class="id"> &lt;-</span><span class="id"> r</span><span class="id"> |</span><span class="id"> P</span><span class="id"> i</span>)<span class="id"> f</span><span class="id"> i</span><span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> elim/big_rec2:</span><span class="id"> _</span><span class="id"> =&gt;</span><span class="id"> //=</span><span class="id"> i</span><span class="id"> y</span><span class="id"> ?</span><span class="id"> Pi</span><span class="id"> &lt;-</span>. Qed.</div></details>
<span class="vernacular">Lemma</span><span class="id"> sfun_prod</span><span class="id"> I</span><span class="id"> r</span> (<span class="id">P</span><span class="id"> :</span><span class="id"> {pred</span><span class="id"> I}</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> I</span><span class="id"> -&gt;</span><span class="id"> {sfun</span><span class="id"> aT</span><span class="id"> &gt;-&gt;</span><span class="id"> rT}</span>) (<span class="id">x</span><span class="id"> :</span><span class="id"> aT</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;(<span class="id">\sum_</span>(<span class="id">i</span><span class="id"> &lt;-</span><span class="id"> r</span><span class="id"> |</span><span class="id"> P</span><span class="id"> i</span>)<span class="id"> f</span><span class="id"> i</span>)<span class="id"> x</span><span class="id"> =</span><span class="id"> \sum_</span>(<span class="id">i</span><span class="id"> &lt;-</span><span class="id"> r</span><span class="id"> |</span><span class="id"> P</span><span class="id"> i</span>)<span class="id"> f</span><span class="id"> i</span><span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> elim/big_rec2:</span><span class="id"> _</span><span class="id"> =&gt;</span><span class="id"> //=</span><span class="id"> i</span><span class="id"> y</span><span class="id"> ?</span><span class="id"> Pi</span><span class="id"> &lt;-</span>. Qed.</div></details>
<span class="vernacular">Lemma</span><span class="id"> sfunX</span><span class="id"> f</span><span class="id"> n</span><span class="id"> :</span><span class="id"> f</span><span class="id"> ^+</span><span class="id"> n</span><span class="id"> =1</span> (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> f</span><span class="id"> x</span><span class="id"> ^+</span><span class="id"> n</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> x;</span><span class="id"> elim:</span><span class="id"> n</span><span class="id"> =&gt;</span><span class="id"> [|n</span><span class="id"> IHn]//;</span><span class="id"> rewrite</span><span class="id"> !exprS</span><span class="id"> sfunM/=</span><span class="id"> IHn</span>. Qed.</div></details>
<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> f</span><span class="id"> g</span><span class="id"> :=</span><span class="id"> MeasurableFun</span>.<span class="id">copy</span> (<span class="id">f</span><span class="id"> \+</span><span class="id"> g</span>) (<span class="id">f</span><span class="id"> +</span><span class="id"> g</span>).<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> f</span><span class="id"> g</span><span class="id"> :=</span><span class="id"> MeasurableFun</span>.<span class="id">copy</span> (<span class="id">\-</span><span class="id"> f</span>) (<span class="id">-</span><span class="id"> f</span>).<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> f</span><span class="id"> g</span><span class="id"> :=</span><span class="id"> MeasurableFun</span>.<span class="id">copy</span> (<span class="id">f</span><span class="id"> \-</span><span class="id"> g</span>) (<span class="id">f</span><span class="id"> -</span><span class="id"> g</span>).<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> f</span><span class="id"> g</span><span class="id"> :=</span><span class="id"> MeasurableFun</span>.<span class="id">copy</span> (<span class="id">f</span><span class="id"> \*</span><span class="id"> g</span>) (<span class="id">f</span><span class="id"> *</span><span class="id"> g</span>).<br/>
<br/>
<span class="vernacular">Import</span><span class="id"> HBSimple</span>.<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">D</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT</span>) (<span class="id">mD</span><span class="id"> :</span><span class="id"> measurable</span><span class="id"> D</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id">@FImFun</span><span class="id"> aT</span><span class="id"> rT</span> (<span class="id">mindic</span><span class="id"> _</span><span class="id"> mD</span>)<span class="id"> :=</span><span class="id"> FImFun</span>.<span class="id">on</span> (<span class="id">mindic</span><span class="id"> _</span><span class="id"> mD</span>).<br/>
<br/>
<span class="vernacular">Definition</span><span class="id"> indic_sfun</span> (<span class="id">D</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT</span>) (<span class="id">mD</span><span class="id"> :</span><span class="id"> measurable</span><span class="id"> D</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">[the</span><span class="id"> {sfun</span><span class="id"> aT</span><span class="id"> &gt;-&gt;</span><span class="id"> rT}</span><span class="id"> of</span><span class="id"> mindic</span><span class="id"> rT</span><span class="id"> mD]</span>.<br/>
<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> k</span><span class="id"> f</span><span class="id"> :=</span><span class="id"> MeasurableFun</span>.<span class="id">copy</span> (<span class="id">k</span><span class="id"> \o*</span><span class="id"> f</span>) (<span class="id">f</span><span class="id"> *</span><span class="id"> cst_sfun</span><span class="id"> k</span>).<br/>
<span class="vernacular">Definition</span><span class="id"> scale_sfun</span><span class="id"> k</span><span class="id"> f</span><span class="id"> :=</span><span class="id"> [the</span><span class="id"> {sfun</span><span class="id"> aT</span><span class="id"> &gt;-&gt;</span><span class="id"> rT}</span><span class="id"> of</span><span class="id"> k</span><span class="id"> \o*</span><span class="id"> f]</span>.<br/>
<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> f</span><span class="id"> g</span><span class="id"> :=</span><span class="id"> max_mfun_subproof</span><span class="id"> f</span><span class="id"> g</span>.<br/>
<span class="vernacular">Definition</span><span class="id"> max_sfun</span><span class="id"> f</span><span class="id"> g</span><span class="id"> :=</span><span class="id"> [the</span><span class="id"> {sfun</span><span class="id"> aT</span><span class="id"> &gt;-&gt;</span><span class="id"> _}</span><span class="id"> of</span><span class="id"> f</span><span class="id"> \max</span><span class="id"> g]</span>.<br/>
<br/>
<span class="vernacular">End</span><span class="id"> ring</span>.<br/>
<span class="vernacular">Arguments</span><span class="id"> indic_sfun</span><span class="id"> {d</span><span class="id"> aT</span><span class="id"> rT}</span><span class="id"> _</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> preimage_nnfun0</span><span class="id"> T</span> (<span class="id">R</span><span class="id"> :</span><span class="id"> realDomainType</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> {nnfun</span><span class="id"> T</span><span class="id"> &gt;-&gt;</span><span class="id"> R}</span>)<span class="id"> t</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">t</span><span class="id"> &lt;</span><span class="id"> 0</span><span class="id"> -&gt;</span><span class="id"> f</span><span class="id"> @^-1`</span><span class="id"> [set</span><span class="id"> t]</span><span class="id"> =</span><span class="id"> set0</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> t0</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply/preimage10</span><span class="id"> =&gt;</span><span class="id"> -[x</span><span class="id"> _];</span><span class="id"> apply:</span><span class="id"> contraPnot</span><span class="id"> t0</span><span class="id"> =&gt;</span><span class="id"> &lt;-;</span><span class="id"> rewrite</span><span class="id"> le_gtF</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> preimage_cstM</span><span class="id"> T</span> (<span class="id">R</span><span class="id"> :</span><span class="id"> realFieldType</span>) (<span class="id">x</span><span class="id"> y</span><span class="id"> :</span><span class="id"> R</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">x</span><span class="id"> !=</span><span class="id"> 0</span><span class="id"> -&gt;</span> (<span class="id">cst</span><span class="id"> x</span><span class="id"> \*</span><span class="id"> f</span>)<span class="id"> @^-1`</span><span class="id"> [set</span><span class="id"> y]</span><span class="id"> =</span><span class="id"> f</span><span class="id"> @^-1`</span><span class="id"> [set</span><span class="id"> y</span><span class="id"> /</span><span class="id"> x]</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> x0;</span><span class="id"> apply/seteqP</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> split=&gt;</span><span class="id"> [z/=</span><span class="id"> &lt;-|z/=</span><span class="id"> -&gt;];</span><span class="id"> rewrite</span><span class="id"> [x</span><span class="id"> *</span><span class="id"> _]mulrC</span> (<span class="id">mulfK,</span><span class="id"> divfK</span>).<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> preimage_add</span><span class="id"> T</span> (<span class="id">R</span><span class="id"> :</span><span class="id"> numDomainType</span>) (<span class="id">f</span><span class="id"> g</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> R</span>)<span class="id"> z</span><span class="id"> :</span><br/>
&nbsp;&nbsp;(<span class="id">f</span><span class="id"> \+</span><span class="id"> g</span>)<span class="id"> @^-1`</span><span class="id"> [set</span><span class="id"> z]</span><span class="id"> =</span><span class="id"> \bigcup_</span>(<span class="id">a</span><span class="gallina-kwd"> in</span><span class="id"> f</span><span class="id"> @`</span><span class="id"> setT</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;((<span class="id">f</span><span class="id"> @^-1`</span><span class="id"> [set</span><span class="id"> a]</span>)<span class="id"> `&amp;`</span> (<span class="id">g</span><span class="id"> @^-1`</span><span class="id"> [set</span><span class="id"> z</span><span class="id"> -</span><span class="id"> a]</span>)).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">apply/seteqP;</span><span class="id"> split=&gt;</span><span class="id"> [x</span><span class="id"> /=</span><span class="id"> fgz|x</span><span class="id"> [_</span><span class="id"> /=</span><span class="id"> [y</span><span class="id"> _</span><span class="id"> &lt;-]]</span><span class="id"> [fxfy</span><span class="id"> gzf]];</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> gzf</span><span class="id"> -fxfy</span><span class="id"> addrC</span><span class="id"> subrK</span>.<br/>
<span class="gallina-kwd">exists</span> (<span class="id">z</span><span class="id"> -</span><span class="id"> g</span><span class="id"> x</span>)<span class="id">;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="gallina-kwd"> exists</span><span class="id"> x;</span><span class="id"> rewrite</span><span class="id"> //</span><span class="id"> -fgz</span><span class="id"> addrK</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> split;</span><span class="id"> rewrite</span><span class="id"> 1?subKr</span><span class="id"> //</span><span class="id"> -fgz</span><span class="id"> addrK</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Section</span><span class="id"> simple_bounded</span>.<br/>
<span class="vernacular">Context</span><span class="id"> d</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> sigmaRingType</span><span class="id"> d</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>).<br/>
<br/>
<span class="vernacular">Import</span><span class="id"> HBSimple</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> simple_bounded</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {sfun</span><span class="id"> T</span><span class="id"> &gt;-&gt;</span><span class="id"> R}</span>)<span class="id"> :</span><span class="id"> bounded_fun</span><span class="id"> f</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">have</span><span class="id"> /finite_seqP[r</span><span class="id"> fr]</span><span class="id"> :=</span><span class="id"> fimfunP</span><span class="id"> f</span>.<br/>
<span class="gallina-kwd">exists</span> (<span class="id">fine</span> (<span class="id">\big[maxe/-oo%E]_</span>(<span class="id">i</span><span class="id"> &lt;-</span><span class="id"> r</span>)<span class="id"> `|i|%:E</span>)).<br/>
<span class="id">split;</span><span class="id"> rewrite</span><span class="id"> ?num_real//</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> mx</span><span class="id"> z</span><span class="id"> _;</span><span class="id"> apply/ltW/</span>(<span class="id">le_lt_trans</span><span class="id"> _</span><span class="id"> mx</span>).<br/>
<span class="id">have</span><span class="id"> ?</span><span class="id"> :</span><span class="id"> f</span><span class="id"> z</span><span class="id"> \in</span><span class="id"> r</span><span class="gallina-kwd"> by</span><span class="id"> have</span><span class="id"> :=</span><span class="id"> imageT</span><span class="id"> f</span><span class="id"> z;</span><span class="id"> rewrite</span><span class="id"> fr</span>.<br/>
<span class="id">rewrite</span><span class="id"> -[leLHS]/</span>(<span class="id">fine</span><span class="id"> `|f</span><span class="id"> z|%:E</span>)<span class="id"> fine_le//</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;TODO:&nbsp;generalize&nbsp;the&nbsp;statement&nbsp;of&nbsp;bigmaxe_fin_num&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> :=</span><span class="id"> @bigmaxe_fin_num</span><span class="id"> _</span> (<span class="id">map</span><span class="id"> normr</span><span class="id"> r</span>)<span class="id"> `|f</span><span class="id"> z|</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> big_map</span><span class="id"> =&gt;</span><span class="id"> -&gt;//;</span><span class="id"> apply/mapP;</span><span class="gallina-kwd"> exists</span> (<span class="id">f</span><span class="id"> z</span>).<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span> (<span class="id">bigmax_sup_seq</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">lexx</span><span class="id"> _</span>)).<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> simple_bounded</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> nnsfun_functions</span>.<br/>
<span class="vernacular">Context</span><span class="id"> d</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>).<br/>
<br/>
<span class="vernacular">Import</span><span class="id"> HBNNSimple</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> cst_nnfun_subproof</span> (<span class="id">x</span><span class="id"> :</span><span class="id"> {nonneg</span><span class="id"> R}</span>)<span class="id"> :</span><span class="gallina-kwd"> forall</span><span class="id"> t</span><span class="id"> :</span><span class="id"> T,</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> cst</span><span class="id"> x%:num</span><span class="id"> t</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> /=</span>. Qed.</div></details>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> x</span><span class="id"> :=</span><span class="id"> @isNonNegFun</span>.<span class="id">Build</span><span class="id"> T</span><span class="id"> R</span> (<span class="id">cst</span><span class="id"> x%:num</span>)<br/>
&nbsp;&nbsp;(<span class="id">cst_nnfun_subproof</span><span class="id"> x</span>).<br/>
<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> x</span><span class="id"> :</span><span class="id"> @FImFun</span><span class="id"> T</span><span class="id"> R</span> (<span class="id">cst</span><span class="id"> x</span>)<span class="id"> :=</span><span class="id"> FImFun</span>.<span class="id">on</span> (<span class="id">cst</span><span class="id"> x</span>).<br/>
<br/>
<span class="vernacular">Definition</span><span class="id"> cst_nnsfun</span> (<span class="id">r</span><span class="id"> :</span><span class="id"> {nonneg</span><span class="id"> R}</span>)<span class="id"> :=</span><span class="id"> [the</span><span class="id"> {nnsfun</span><span class="id"> T</span><span class="id"> &gt;-&gt;</span><span class="id"> R}</span><span class="id"> of</span><span class="id"> cst</span><span class="id"> r%:num]</span>.<br/>
<br/>
<span class="vernacular">Definition</span><span class="id"> nnsfun0</span><span class="id"> :</span><span class="id"> {nnsfun</span><span class="id"> T</span><span class="id"> &gt;-&gt;</span><span class="id"> R}</span><span class="id"> :=</span><span class="id"> cst_nnsfun</span><span class="id"> 0%R%:nng</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> indic_nnfun_subproof</span> (<span class="id">D</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T</span>)<span class="id"> :</span><span class="gallina-kwd"> forall</span><span class="id"> x,</span><span class="id"> 0</span><span class="id"> &lt;=</span> (<span class="id">\1_D</span>)<span class="id"> x</span><span class="id"> :&gt;</span><span class="id"> R</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> []</span>. Qed.</div></details>
<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> D</span><span class="id"> :=</span><span class="id"> @isNonNegFun</span>.<span class="id">Build</span><span class="id"> T</span><span class="id"> R</span><span class="id"> \1_D</span><br/>
&nbsp;&nbsp;(<span class="id">indic_nnfun_subproof</span><span class="id"> D</span>).<br/>
<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> D</span> (<span class="id">mD</span><span class="id"> :</span><span class="id"> measurable</span><span class="id"> D</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id">@NonNegFun</span><span class="id"> T</span><span class="id"> R</span> (<span class="id">mindic</span><span class="id"> R</span><span class="id"> mD</span>)<span class="id"> :=</span><span class="id"> NonNegFun</span>.<span class="id">on</span> (<span class="id">mindic</span><span class="id"> R</span><span class="id"> mD</span>).<br/>
<br/>
<span class="vernacular">End</span><span class="id"> nnsfun_functions</span>.<br/>
<span class="vernacular">Arguments</span><span class="id"> nnsfun0</span><span class="id"> {d</span><span class="id"> T</span><span class="id"> R}</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> nnfun_bin</span>.<br/>
<span class="vernacular">Variables</span> (<span class="id">T</span><span class="id"> :</span><span class="gallina-kwd"> Type</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> numDomainType</span>) (<span class="id">f</span><span class="id"> g</span><span class="id"> :</span><span class="id"> {nnfun</span><span class="id"> T</span><span class="id"> &gt;-&gt;</span><span class="id"> R}</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> add_nnfun_subproof</span><span class="id"> :</span><span class="id"> @isNonNegFun</span><span class="id"> T</span><span class="id"> R</span> (<span class="id">f</span><span class="id"> \+</span><span class="id"> g</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> x;</span><span class="id"> rewrite</span><span class="id"> addr_ge0//;</span><span class="id"> apply/fun_ge0</span>. Qed.</div></details>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> add_nnfun_subproof</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> mul_nnfun_subproof</span><span class="id"> :</span><span class="id"> @isNonNegFun</span><span class="id"> T</span><span class="id"> R</span> (<span class="id">f</span><span class="id"> \*</span><span class="id"> g</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> x;</span><span class="id"> rewrite</span><span class="id"> mulr_ge0//;</span><span class="id"> apply/fun_ge0</span>. Qed.</div></details>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> mul_nnfun_subproof</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> max_nnfun_subproof</span><span class="id"> :</span><span class="id"> @isNonNegFun</span><span class="id"> T</span><span class="id"> R</span> (<span class="id">f</span><span class="id"> \max</span><span class="id"> g</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> /maxr;</span><span class="id"> case:</span><span class="id"> ifPn</span><span class="id"> =&gt;</span><span class="id"> _;</span><span class="id"> apply:</span><span class="id"> fun_ge0</span>. Qed.</div></details>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> max_nnfun_subproof</span>.<br/>
<br/>
<span class="vernacular">End</span><span class="id"> nnfun_bin</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> nnsfun_bin</span>.<br/>
<span class="vernacular">Context</span><span class="id"> d</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>).<br/>
<span class="vernacular">Variables</span><span class="id"> f</span><span class="id"> g</span><span class="id"> :</span><span class="id"> {nnsfun</span><span class="id"> T</span><span class="id"> &gt;-&gt;</span><span class="id"> R}</span>.<br/>
<br/>
<span class="vernacular">Import</span><span class="id"> HBNNSimple</span>.<br/>
<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> MeasurableFun</span>.<span class="id">on</span> (<span class="id">f</span><span class="id"> \+</span><span class="id"> g</span>).<br/>
<span class="vernacular">Definition</span><span class="id"> add_nnsfun</span><span class="id"> :=</span><span class="id"> [the</span><span class="id"> {nnsfun</span><span class="id"> T</span><span class="id"> &gt;-&gt;</span><span class="id"> R}</span><span class="id"> of</span><span class="id"> f</span><span class="id"> \+</span><span class="id"> g]</span>.<br/>
<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> MeasurableFun</span>.<span class="id">on</span> (<span class="id">f</span><span class="id"> \*</span><span class="id"> g</span>).<br/>
<span class="vernacular">Definition</span><span class="id"> mul_nnsfun</span><span class="id"> :=</span><span class="id"> [the</span><span class="id"> {nnsfun</span><span class="id"> T</span><span class="id"> &gt;-&gt;</span><span class="id"> R}</span><span class="id"> of</span><span class="id"> f</span><span class="id"> \*</span><span class="id"> g]</span>.<br/>
<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> MeasurableFun</span>.<span class="id">on</span> (<span class="id">f</span><span class="id"> \max</span><span class="id"> g</span>).<br/>
<span class="vernacular">Definition</span><span class="id"> max_nnsfun</span><span class="id"> :=</span><span class="id"> [the</span><span class="id"> {nnsfun</span><span class="id"> T</span><span class="id"> &gt;-&gt;</span><span class="id"> R}</span><span class="id"> of</span><span class="id"> f</span><span class="id"> \max</span><span class="id"> g]</span>.<br/>
<br/>
<span class="vernacular">Definition</span><span class="id"> indic_nnsfun</span><span class="id"> A</span> (<span class="id">mA</span><span class="id"> :</span><span class="id"> measurable</span><span class="id"> A</span>)<span class="id"> :=</span><span class="id"> [the</span><span class="id"> {nnsfun</span><span class="id"> T</span><span class="id"> &gt;-&gt;</span><span class="id"> R}</span><span class="id"> of</span><span class="id"> mindic</span><span class="id"> R</span><span class="id"> mA]</span>.<br/>
<br/>
<span class="vernacular">End</span><span class="id"> nnsfun_bin</span>.<br/>
<span class="vernacular">Arguments</span><span class="id"> add_nnsfun</span><span class="id"> {d</span><span class="id"> T</span><span class="id"> R}</span><span class="id"> _</span><span class="id"> _</span>.<br/>
<span class="vernacular">Arguments</span><span class="id"> mul_nnsfun</span><span class="id"> {d</span><span class="id"> T</span><span class="id"> R}</span><span class="id"> _</span><span class="id"> _</span>.<br/>
<span class="vernacular">Arguments</span><span class="id"> max_nnsfun</span><span class="id"> {d</span><span class="id"> T</span><span class="id"> R}</span><span class="id"> _</span><span class="id"> _</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> nnsfun_iter</span>.<br/>
<span class="vernacular">Context</span><span class="id"> d</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>) (<span class="id">D</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T</span>).<br/>
<span class="vernacular">Variable</span><span class="id"> f</span><span class="id"> :</span><span class="id"> {nnsfun</span><span class="id"> T</span><span class="id"> &gt;-&gt;</span><span class="id"> R}^nat</span>.<br/>
<br/>
<span class="vernacular">Definition</span><span class="id"> sum_nnsfun</span><span class="id"> n</span><span class="id"> :=</span><span class="id"> \big[add_nnsfun/nnsfun0]_</span>(<span class="id">i</span><span class="id"> &lt;</span><span class="id"> n</span>)<span class="id"> f</span><span class="id"> i</span>.<br/>
<br/>
<span class="vernacular">Import</span><span class="id"> HBNNSimple</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> sum_nnsfunE</span><span class="id"> n</span><span class="id"> t</span><span class="id"> :</span><span class="id"> sum_nnsfun</span><span class="id"> n</span><span class="id"> t</span><span class="id"> =</span><span class="id"> \sum_</span>(<span class="id">i</span><span class="id"> &lt;</span><span class="id"> n</span>) (<span class="id">f</span><span class="id"> i</span><span class="id"> t</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> /sum_nnsfun;</span><span class="id"> elim/big_ind2</span><span class="id"> :</span><span class="id"> _</span><span class="id"> =&gt;</span><span class="id"> [|x</span><span class="id"> g</span><span class="id"> y</span><span class="id"> h</span><span class="id"> &lt;-</span><span class="id"> &lt;-|]</span>. Qed.</div></details>
<br/>
<span class="vernacular">Definition</span><span class="id"> bigmax_nnsfun</span><span class="id"> n</span><span class="id"> :=</span><span class="id"> \big[max_nnsfun/nnsfun0]_</span>(<span class="id">i</span><span class="id"> &lt;</span><span class="id"> n</span>)<span class="id"> f</span><span class="id"> i</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> bigmax_nnsfunE</span><span class="id"> n</span><span class="id"> t</span><span class="id"> :</span><span class="id"> bigmax_nnsfun</span><span class="id"> n</span><span class="id"> t</span><span class="id"> =</span><span class="id"> \big[maxr/0]_</span>(<span class="id">i</span><span class="id"> &lt;</span><span class="id"> n</span>) (<span class="id">f</span><span class="id"> i</span><span class="id"> t</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> /bigmax_nnsfun;</span><span class="id"> elim/big_ind2</span><span class="id"> :</span><span class="id"> _</span><span class="id"> =&gt;</span><span class="id"> [|x</span><span class="id"> g</span><span class="id"> y</span><span class="id"> h</span><span class="id"> &lt;-</span><span class="id"> &lt;-|]</span>. Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> nnsfun_iter</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> nnsfun_cover</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<span class="vernacular">Context</span><span class="id"> d</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>).<br/>
<span class="vernacular">Variable</span><span class="id"> f</span><span class="id"> :</span><span class="id"> {nnsfun</span><span class="id"> T</span><span class="id"> &gt;-&gt;</span><span class="id"> R}</span>.<br/>
<br/>
<span class="vernacular">Import</span><span class="id"> HBNNSimple</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> nnsfun_cover</span><span class="id"> :</span><span class="id"> \big[setU/set0]_</span>(<span class="id">i</span><span class="id"> \in</span><span class="id"> range</span><span class="id"> f</span>) (<span class="id">f</span><span class="id"> @^-1`</span><span class="id"> [set</span><span class="id"> i]</span>)<span class="id"> =</span><span class="id"> setT</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> fsbig_setU//=</span><span class="id"> -subTset</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> _;</span><span class="gallina-kwd"> exists</span> (<span class="id">f</span><span class="id"> x</span>). Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> nnsfun_coverT</span><span class="id"> :</span><span class="id"> \big[setU/set0]_</span>(<span class="id">i</span><span class="id"> \in</span><span class="id"> [set:</span><span class="id"> R]</span>)<span class="id"> f</span><span class="id"> @^-1`</span><span class="id"> [set</span><span class="id"> i]</span><span class="id"> =</span><span class="id"> setT</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -</span>(<span class="id">fsbig_widen</span> (<span class="id">range</span><span class="id"> f</span>))<span class="id"> ?nnsfun_cover//=</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> [_</span><span class="id"> /preimage10]</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> nnsfun_cover</span>.<br/>
<br/>
<span class="id">#[global]</span><span class="vernacular"> Hint</span><span class="id"> Extern</span><span class="id"> 0</span> (<span class="id">measurable</span> (_<span class="id"> @^-1`</span><span class="id"> [set</span><span class="id"> _]</span>))<span class="id"> =&gt;</span><br/>
&nbsp;&nbsp;<span class="id">solve</span><span class="id"> [apply:</span><span class="id"> measurable_sfunP;</span><span class="id"> exact:</span><span class="id"> measurable_set1]</span><span class="id"> :</span><span class="id"> core</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> measurable_sfun_inP</span><span class="id"> {d}</span><span class="id"> {aT</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d}</span><span class="id"> {rT</span><span class="id"> :</span><span class="id"> realType}</span><br/>
&nbsp;&nbsp;&nbsp;(<span class="id">f</span><span class="id"> :</span><span class="id"> {mfun</span><span class="id"> aT</span><span class="id"> &gt;-&gt;</span><span class="id"> rT}</span>)<span class="id"> D</span> (<span class="id">y</span><span class="id"> :</span><span class="id"> rT</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">measurable</span><span class="id"> D</span><span class="id"> -&gt;</span><span class="id"> measurable</span> (<span class="id">D</span><span class="id"> `&amp;`</span><span class="id"> f</span><span class="id"> @^-1`</span><span class="id"> [set</span><span class="id"> y]</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> Dm;</span><span class="id"> exact:</span><span class="id"> measurableI</span>. Qed.</div></details>
<br/>
<span class="id">#[global]</span><span class="vernacular"> Hint</span><span class="id"> Extern</span><span class="id"> 0</span> (<span class="id">measurable</span> (_<span class="id"> `&amp;`</span><span class="id"> _</span><span class="id"> @^-1`</span><span class="id"> [set</span><span class="id"> _]</span>))<span class="id"> =&gt;</span><br/>
&nbsp;&nbsp;<span class="id">solve</span><span class="id"> [apply:</span><span class="id"> measurable_sfun_inP;</span><span class="id"> assumption]</span><span class="id"> :</span><span class="id"> core</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> measure_fsbig</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<span class="vernacular">Context</span><span class="id"> d</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>).<br/>
<span class="vernacular">Variable</span><span class="id"> m</span><span class="id"> :</span><span class="id"> {measure</span><span class="id"> set</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R}</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> measure_fsbig</span> (<span class="id">I</span><span class="id"> :</span><span class="id"> choiceType</span>) (<span class="id">A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> I</span>) (<span class="id">F</span><span class="id"> :</span><span class="id"> I</span><span class="id"> -&gt;</span><span class="id"> set</span><span class="id"> T</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">finite_set</span><span class="id"> A</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">forall</span><span class="id"> i,</span><span class="id"> A</span><span class="id"> i</span><span class="id"> -&gt;</span><span class="id"> measurable</span> (<span class="id">F</span><span class="id"> i</span>))<span class="id"> -&gt;</span><span class="id"> trivIset</span><span class="id"> A</span><span class="id"> F</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">m</span> (<span class="id">\big[setU/set0]_</span>(<span class="id">i</span><span class="id"> \in</span><span class="id"> A</span>)<span class="id"> F</span><span class="id"> i</span>)<span class="id"> =</span><span class="id"> \sum_</span>(<span class="id">i</span><span class="id"> \in</span><span class="id"> A</span>)<span class="id"> m</span> (<span class="id">F</span><span class="id"> i</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> Afin</span><span class="id"> Fm</span><span class="id"> Ft</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> fsbig_finite//</span><span class="id"> -measure_fin_bigcup//</span><span class="id"> -bigsetU_fset_set</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Import</span><span class="id"> HBNNSimple</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> additive_nnsfunr</span> (<span class="id">g</span><span class="id"> f</span><span class="id"> :</span><span class="id"> {nnsfun</span><span class="id"> T</span><span class="id"> &gt;-&gt;</span><span class="id"> R}</span>)<span class="id"> x</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">\sum_</span>(<span class="id">i</span><span class="id"> \in</span><span class="id"> range</span><span class="id"> g</span>)<span class="id"> m</span> (<span class="id">f</span><span class="id"> @^-1`</span><span class="id"> [set</span><span class="id"> x]</span><span class="id"> `&amp;`</span> (<span class="id">g</span><span class="id"> @^-1`</span><span class="id"> [set</span><span class="id"> i]</span>))<span class="id"> =</span><br/>
&nbsp;&nbsp;<span class="id">m</span> (<span class="id">f</span><span class="id"> @^-1`</span><span class="id"> [set</span><span class="id"> x]</span><span class="id"> `&amp;`</span><span class="id"> \big[setU/set0]_</span>(<span class="id">i</span><span class="id"> \in</span><span class="id"> range</span><span class="id"> g</span>) (<span class="id">g</span><span class="id"> @^-1`</span><span class="id"> [set</span><span class="id"> i]</span>)).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> -?measure_fsbig//</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> !fsbig_finite//=</span><span class="id"> big_distrr</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> i</span><span class="id"> Ai;</span><span class="id"> apply:</span><span class="id"> measurableI</span>.<br/>
<span class="id">-</span><span class="id"> exact/trivIset_setIl/trivIset_preimage1</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> additive_nnsfunl</span> (<span class="id">g</span><span class="id"> f</span><span class="id"> :</span><span class="id"> {nnsfun</span><span class="id"> T</span><span class="id"> &gt;-&gt;</span><span class="id"> R}</span>)<span class="id"> x</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">\sum_</span>(<span class="id">i</span><span class="id"> \in</span><span class="id"> range</span><span class="id"> g</span>)<span class="id"> m</span> (<span class="id">g</span><span class="id"> @^-1`</span><span class="id"> [set</span><span class="id"> i]</span><span class="id"> `&amp;`</span> (<span class="id">f</span><span class="id"> @^-1`</span><span class="id"> [set</span><span class="id"> x]</span>))<span class="id"> =</span><br/>
&nbsp;&nbsp;<span class="id">m</span> (<span class="id">\big[setU/set0]_</span>(<span class="id">i</span><span class="id"> \in</span><span class="id"> range</span><span class="id"> g</span>) (<span class="id">g</span><span class="id"> @^-1`</span><span class="id"> [set</span><span class="id"> i]</span>)<span class="id"> `&amp;`</span><span class="id"> f</span><span class="id"> @^-1`</span><span class="id"> [set</span><span class="id"> x]</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> under</span><span class="id"> eq_fsbigr</span><span class="id"> do</span><span class="id"> rewrite</span><span class="id"> setIC;</span><span class="id"> rewrite</span><span class="id"> setIC</span><span class="id"> additive_nnsfunr</span>. Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> measure_fsbig</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> mulem_ge0</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<br/>
<span class="vernacular">Let</span><span class="id"> mulef_ge0</span> (<span class="id">R</span><span class="id"> :</span><span class="id"> realDomainType</span>)<span class="id"> x</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">0</span><span class="id"> &lt;=</span><span class="id"> f</span><span class="id"> x</span><span class="id"> -&gt;</span> ((<span class="id">x</span><span class="id"> &lt;</span><span class="id"> 0</span>)<span class="id">%R</span><span class="id"> -&gt;</span><span class="id"> f</span><span class="id"> x</span><span class="id"> =</span><span class="id"> 0</span>)<span class="id"> -&gt;</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> x%:E</span><span class="id"> *</span><span class="id"> f</span><span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">case:</span> (<span class="id">ltP</span><span class="id"> x</span><span class="id"> 0%R</span>)<span class="id"> =&gt;</span><span class="id"> [x_lt0</span><span class="id"> ?</span><span class="id"> -&gt;|x_ge0</span><span class="id"> fx_ge0</span><span class="id"> _]</span><span class="id"> //;</span><span class="id"> last</span><span class="id"> exact:</span><span class="id"> mule_ge0</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> mule0</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> nnfun_muleindic_ge0</span><span class="id"> d</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> sigmaRingType</span><span class="id"> d</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realDomainType</span>)<br/>
&nbsp;&nbsp;(<span class="id">f</span><span class="id"> :</span><span class="id"> {nnfun</span><span class="id"> T</span><span class="id"> &gt;-&gt;</span><span class="id"> R}</span>)<span class="id"> r</span><span class="id"> z</span><span class="id"> :</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> r%:E</span><span class="id"> *</span> (<span class="id">\1_</span>(<span class="id">f</span><span class="id"> @^-1`</span><span class="id"> [set</span><span class="id"> r]</span>)<span class="id"> z</span>)<span class="id">%:E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">apply:</span> (<span class="id">@mulef_ge0</span><span class="id"> _</span><span class="id"> _</span> (<span class="gallina-kwd">fun</span><span class="id"> r</span><span class="id"> =&gt;</span> (<span class="id">\1_</span>(<span class="id">f</span><span class="id"> @^-1`</span><span class="id"> [set</span><span class="id"> r]</span>)<span class="id"> z</span>)<span class="id">%:E</span>)).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> lee_fin//</span><span class="id"> indicE</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> r0;</span><span class="id"> rewrite</span><span class="id"> preimage_nnfun0//</span><span class="id"> indic0</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> mulemu_ge0</span><span class="id"> d</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> sigmaRingType</span><span class="id"> d</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">mu</span><span class="id"> :</span><span class="id"> {measure</span><span class="id"> set</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R}</span>)<span class="id"> x</span> (<span class="id">A</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> set</span><span class="id"> T</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;((<span class="id">x</span><span class="id"> &lt;</span><span class="id"> 0</span>)<span class="id">%R</span><span class="id"> -&gt;</span><span class="id"> A</span><span class="id"> x</span><span class="id"> =</span><span class="id"> set0</span>)<span class="id"> -&gt;</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> x%:E</span><span class="id"> *</span><span class="id"> mu</span> (<span class="id">A</span><span class="id"> x</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> xA;</span><span class="id"> rewrite</span> (<span class="id">@mulef_ge0</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">mu</span><span class="id"> \o</span><span class="id"> _</span>))<span class="id">//=</span><span class="id"> =&gt;</span><span class="id"> /xA</span><span class="id"> -&gt;;</span><span class="id"> rewrite</span><span class="id"> measure0</span>.<br/>
Qed.</div></details>
<span class="id">Global</span><span class="vernacular"> Arguments</span><span class="id"> mulemu_ge0</span><span class="id"> {d</span><span class="id"> T</span><span class="id"> R</span><span class="id"> mu</span><span class="id"> x}</span><span class="id"> A</span>.<br/>
<br/>
<span class="vernacular">Import</span><span class="id"> HBNNSimple</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> nnsfun_mulemu_ge0</span><span class="id"> d</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> sigmaRingType</span><span class="id"> d</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">mu</span><span class="id"> :</span><span class="id"> {measure</span><span class="id"> set</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R}</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> {nnsfun</span><span class="id"> T</span><span class="id"> &gt;-&gt;</span><span class="id"> R}</span>)<span class="id"> x</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">0</span><span class="id"> &lt;=</span><span class="id"> x%:E</span><span class="id"> *</span><span class="id"> mu</span> (<span class="id">f</span><span class="id"> @^-1`</span><span class="id"> [set</span><span class="id"> x]</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd">by</span><span class="id"> apply:</span> (<span class="id">mulemu_ge0</span> (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> f</span><span class="id"> @^-1`</span><span class="id"> [set</span><span class="id"> x]</span>))<span class="id">;</span><span class="id"> exact:</span><span class="id"> preimage_nnfun0</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> mulem_ge0</span>.<br/>
<br/>
<div class="doc">Definition of Simple Integrals </div>
<br/>
<span class="vernacular">Section</span><span class="id"> simple_fun_raw_integral</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<span class="vernacular">Variables</span> (<span class="id">T</span><span class="id"> :</span><span class="gallina-kwd"> Type</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> numDomainType</span>) (<span class="id">mu</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> R</span>).<br/>
<br/>
<span class="vernacular">Definition</span><span class="id"> sintegral</span><span class="id"> :=</span><span class="id"> \sum_</span>(<span class="id">x</span><span class="id"> \in</span><span class="id"> [set:</span><span class="id"> R]</span>)<span class="id"> x%:E</span><span class="id"> *</span><span class="id"> mu</span> (<span class="id">f</span><span class="id"> @^-1`</span><span class="id"> [set</span><span class="id"> x]</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> sintegralET</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">sintegral</span><span class="id"> =</span><span class="id"> \sum_</span>(<span class="id">x</span><span class="id"> \in</span><span class="id"> [set:</span><span class="id"> R]</span>)<span class="id"> x%:E</span><span class="id"> *</span><span class="id"> mu</span> (<span class="id">f</span><span class="id"> @^-1`</span><span class="id"> [set</span><span class="id"> x]</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> []</span>. Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> simple_fun_raw_integral</span>.<br/>
<br/>
<span class="id">#[global]</span><span class="vernacular"> Hint</span><span class="id"> Extern</span><span class="id"> 0</span> (<span class="id">is_true</span> (<span class="id">0</span><span class="id"> &lt;=</span> (_<span class="id"> :</span><span class="id"> {measure</span><span class="id"> set</span><span class="id"> _</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> _}</span>)<span class="id"> _</span>)<span class="id">%E</span>)<span class="id"> =&gt;</span><br/>
&nbsp;&nbsp;<span class="id">solve</span><span class="id"> [apply:</span><span class="id"> measure_ge0]</span><span class="id"> :</span><span class="id"> core</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> sintegral_lemmas</span>.<br/>
<span class="vernacular">Context</span><span class="id"> d</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> sigmaRingType</span><span class="id"> d</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>).<br/>
<span class="vernacular">Variable</span><span class="id"> mu</span><span class="id"> :</span><span class="id"> {measure</span><span class="id"> set</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R}</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> sintegralE</span><span class="id"> f</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">sintegral</span><span class="id"> mu</span><span class="id"> f</span><span class="id"> =</span><span class="id"> \sum_</span>(<span class="id">x</span><span class="id"> \in</span><span class="id"> range</span><span class="id"> f</span>)<span class="id"> x%:E</span><span class="id"> *</span><span class="id"> mu</span> (<span class="id">f</span><span class="id"> @^-1`</span><span class="id"> [set</span><span class="id"> x]</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span> (<span class="id">fsbig_widen</span> (<span class="id">range</span><span class="id"> f</span>)<span class="id"> setT</span>)<span class="id">//=</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> [_</span><span class="id"> Nfx]</span><span class="id"> /=</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> preimage10//</span><span class="id"> measure0</span><span class="id"> mule0</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> sintegral0</span><span class="id"> :</span><span class="id"> sintegral</span><span class="id"> mu</span> (<span class="id">cst</span><span class="id"> 0%R</span>)<span class="id"> =</span><span class="id"> 0</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> sintegralE</span><span class="id"> fsbig1//</span><span class="id"> =&gt;</span><span class="id"> r</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> preimage_cst</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> case:</span><span class="id"> ifPn</span><span class="id"> =&gt;</span><span class="id"> [/[!inE]</span><span class="id"> &lt;-|];</span><span class="id"> rewrite</span><span class="id"> ?mul0e//</span><span class="id"> measure0</span><span class="id"> mule0</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Import</span><span class="id"> HBNNSimple</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> sintegral_ge0</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {nnsfun</span><span class="id"> T</span><span class="id"> &gt;-&gt;</span><span class="id"> R}</span>)<span class="id"> :</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> sintegral</span><span class="id"> mu</span><span class="id"> f</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> sintegralE</span><span class="id"> fsume_ge0//</span><span class="id"> =&gt;</span><span class="id"> r</span><span class="id"> _;</span><span class="id"> exact:</span><span class="id"> nnsfun_mulemu_ge0</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> sintegral_indic</span> (<span class="id">A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T</span>)<span class="id"> :</span><span class="id"> sintegral</span><span class="id"> mu</span><span class="id"> \1_A</span><span class="id"> =</span><span class="id"> mu</span><span class="id"> A</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> sintegralE</span> (<span class="id">fsbig_widen</span><span class="id"> _</span><span class="id"> [set</span><span class="id"> 0%R;</span><span class="id"> 1%R]</span>)<span class="id"> =&gt;</span><span class="id"> //=;</span><span class="id"> last</span><span class="id"> 2</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> exact:</span><span class="id"> image_indic_sub</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> t</span><span class="id"> [[]</span><span class="id"> -&gt;</span><span class="id"> /=</span><span class="id"> /preimage10-&gt;];</span><span class="id"> rewrite</span><span class="id"> measure0</span><span class="id"> mule0</span>.<br/>
<span class="id">have</span><span class="id"> N01</span><span class="id"> :</span> (<span class="id">0</span><span class="id"> &lt;&gt;</span><span class="id"> 1:&gt;</span><span class="id"> R</span>)<span class="id">%R</span><span class="gallina-kwd"> by</span><span class="id"> apply/eqP;</span><span class="id"> rewrite</span><span class="id"> eq_sym</span><span class="id"> oner_eq0</span>.<br/>
<span class="id">rewrite</span><span class="id"> fsbigU//=;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> t</span><span class="id"> [-&gt;]</span>.<br/>
<span class="id">rewrite</span><span class="id"> !fsbig_set1</span><span class="id"> mul0e</span><span class="id"> add0e</span><span class="id"> mul1e</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> preimage_indic</span><span class="id"> ifT</span><span class="id"> ?inE//</span><span class="id"> ifN</span><span class="id"> ?notin_setE</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> sintegralEnnsfun</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {nnsfun</span><span class="id"> T</span><span class="id"> &gt;-&gt;</span><span class="id"> R}</span>)<span class="id"> :</span><span class="id"> sintegral</span><span class="id"> mu</span><span class="id"> f</span><span class="id"> =</span><br/>
&nbsp;&nbsp;(<span class="id">\sum_</span>(<span class="id">x</span><span class="id"> \in</span><span class="id"> [set</span><span class="id"> r</span><span class="id"> |</span><span class="id"> r</span><span class="id"> &gt;</span><span class="id"> 0]%R</span>) (<span class="id">x%:E</span><span class="id"> *</span><span class="id"> mu</span> (<span class="id">f</span><span class="id"> @^-1`</span><span class="id"> [set</span><span class="id"> x]</span>)))<span class="id">%E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span> (<span class="id">fsbig_widen</span><span class="id"> _</span><span class="id"> setT</span>)<span class="id"> ?sintegralET//</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> x</span><span class="id"> [_</span><span class="id"> /=];</span><span class="id"> case:</span><span class="id"> ltgtP</span><span class="id"> =&gt;</span><span class="id"> //=</span><span class="id"> [xlt0</span><span class="id"> _|&lt;-];</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> mul0e</span>.<br/>
<span class="id">rewrite</span><span class="id"> preimage10</span><span class="id"> ?measure0</span><span class="id"> ?mule0//=</span><span class="id"> =&gt;</span><span class="id"> -[t</span><span class="id"> _</span><span class="id"> xE]</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply/negP:</span><span class="id"> xlt0;</span><span class="id"> rewrite</span><span class="id"> -leNgt</span><span class="id"> -xE</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> sintegral_lemmas</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> eq_sintegral</span><span class="id"> d</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> sigmaRingType</span><span class="id"> d</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> numDomainType</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">mu</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id"> g</span><span class="id"> f</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">f</span><span class="id"> =1</span><span class="id"> g</span><span class="id"> -&gt;</span><span class="id"> sintegral</span><span class="id"> mu</span><span class="id"> f</span><span class="id"> =</span><span class="id"> sintegral</span><span class="id"> mu</span><span class="id"> g</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> /funext-&gt;</span>. Qed.</div></details>
<span class="vernacular">Arguments</span><span class="id"> eq_sintegral</span><span class="id"> {d</span><span class="id"> T</span><span class="id"> R</span><span class="id"> mu}</span><span class="id"> g</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> sintegralrM</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<span class="vernacular">Context</span><span class="id"> d</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> sigmaRingType</span><span class="id"> d</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>).<br/>
<span class="vernacular">Variables</span> (<span class="id">m</span><span class="id"> :</span><span class="id"> {measure</span><span class="id"> set</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R}</span>) (<span class="id">r</span><span class="id"> :</span><span class="id"> R</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> {nnsfun</span><span class="id"> T</span><span class="id"> &gt;-&gt;</span><span class="id"> R}</span>).<br/>
<br/>
<span class="vernacular">Import</span><span class="id"> HBNNSimple</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> sintegralrM</span><span class="id"> :</span><span class="id"> sintegral</span><span class="id"> m</span> (<span class="id">cst</span><span class="id"> r</span><span class="id"> \*</span><span class="id"> f</span>)<span class="id">%R</span><span class="id"> =</span><span class="id"> r%:E</span><span class="id"> *</span><span class="id"> sintegral</span><span class="id"> m</span><span class="id"> f</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">have</span><span class="id"> [-&gt;|r0]</span><span class="id"> :=</span><span class="id"> eqVneq</span><span class="id"> r</span><span class="id"> 0%R</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> mul0e</span> (<span class="id">eq_sintegral</span> (<span class="id">cst</span><span class="id"> 0%R</span>))<span class="id"> ?sintegral0//</span><span class="id"> =&gt;</span><span class="id"> x/=;</span><span class="id"> rewrite</span><span class="id"> mul0r</span>.<br/>
<span class="id">rewrite</span><span class="id"> !sintegralET</span><span class="id"> ge0_mule_fsumr;</span><span class="id"> last</span><span class="id"> exact:</span><span class="id"> nnsfun_mulemu_ge0</span>.<br/>
<span class="id">rewrite</span> (<span class="id">reindex_fsbigT</span> (<span class="id"> *%R</span><span class="id"> r</span>))<span class="id">/=;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="gallina-kwd"> exists</span> (<span class="id"> *%R</span><span class="id"> r^-1</span>)<span class="id">;</span><span class="id"> [exact:</span><span class="id"> mulKf|exact:</span><span class="id"> mulVKf]</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> eq_fsbigr</span><span class="id"> =&gt;</span><span class="id"> x;</span><span class="id"> rewrite</span><span class="id"> preimage_cstM//</span><span class="id"> [_</span><span class="id"> /</span><span class="id"> r]mulrC</span><span class="id"> mulKf//</span><span class="id"> muleA</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> sintegralrM</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> sintegralD</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<span class="vernacular">Context</span><span class="id"> d</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>).<br/>
<span class="vernacular">Variables</span> (<span class="id">m</span><span class="id"> :</span><span class="id"> {measure</span><span class="id"> set</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R}</span>).<br/>
<span class="vernacular">Variables</span> (<span class="id">D</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T</span>) (<span class="id">mD</span><span class="id"> :</span><span class="id"> measurable</span><span class="id"> D</span>) (<span class="id">f</span><span class="id"> g</span><span class="id"> :</span><span class="id"> {nnsfun</span><span class="id"> T</span><span class="id"> &gt;-&gt;</span><span class="id"> R}</span>).<br/>
<br/>
<span class="vernacular">Import</span><span class="id"> HBNNSimple</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> sintegralD</span><span class="id"> :</span><span class="id"> sintegral</span><span class="id"> m</span> (<span class="id">f</span><span class="id"> \+</span><span class="id"> g</span>)<span class="id">%R</span><span class="id"> =</span><span class="id"> sintegral</span><span class="id"> m</span><span class="id"> f</span><span class="id"> +</span><span class="id"> sintegral</span><span class="id"> m</span><span class="id"> g</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> !sintegralE;</span><span class="id"> set</span><span class="id"> F</span><span class="id"> :=</span><span class="id"> f</span><span class="id"> @`</span><span class="id"> _;</span><span class="id"> set</span><span class="id"> G</span><span class="id"> :=</span><span class="id"> g</span><span class="id"> @`</span><span class="id"> _;</span><span class="id"> set</span><span class="id"> FG</span><span class="id"> :=</span><span class="id"> _</span><span class="id"> @`</span><span class="id"> _</span>.<br/>
<span class="id">pose</span><span class="id"> pf</span><span class="id"> x</span><span class="id"> :=</span><span class="id"> f</span><span class="id"> @^-1`</span><span class="id"> [set</span><span class="id"> x];</span><span class="id"> pose</span><span class="id"> pg</span><span class="id"> y</span><span class="id"> :=</span><span class="id"> g</span><span class="id"> @^-1`</span><span class="id"> [set</span><span class="id"> y]</span>.<br/>
<span class="id">transitivity</span> (<span class="id">\sum_</span>(<span class="id">z</span><span class="id"> \in</span><span class="id"> FG</span>)<span class="id"> z%:E</span><span class="id"> *</span><span class="id"> \sum_</span>(<span class="id">a</span><span class="id"> \in</span><span class="id"> F</span>)<span class="id"> m</span> (<span class="id">pf</span><span class="id"> a</span><span class="id"> `&amp;`</span><span class="id"> pg</span> (<span class="id">z</span><span class="id"> -</span><span class="id"> a</span>)<span class="id">%R</span>)).<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> eq_fsbigr</span><span class="id"> =&gt;</span><span class="id"> z</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> preimage_add</span><span class="id"> -fsbig_setU//</span><span class="id"> measure_fsbig//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> Fx;</span><span class="id"> exact:</span><span class="id"> measurableI</span>.<br/>
&nbsp;&nbsp;<span class="id">exact/trivIset_setIr/trivIset_preimage1</span>.<br/>
<span class="id">under</span><span class="id"> eq_fsbigr</span><span class="id"> do</span><span class="id"> rewrite</span><span class="id"> ge0_mule_fsumr//;</span><span class="id"> rewrite</span><span class="id"> exchange_fsbig//=</span>.<br/>
<span class="id">transitivity</span> (<span class="id">\sum_</span>(<span class="id">x</span><span class="id"> \in</span><span class="id"> F</span>)<span class="id"> \sum_</span>(<span class="id">y</span><span class="id"> \in</span><span class="id"> G</span>) (<span class="id">x</span><span class="id"> +</span><span class="id"> y</span>)<span class="id">%:E</span><span class="id"> *</span><span class="id"> m</span> (<span class="id">pf</span><span class="id"> x</span><span class="id"> `&amp;`</span><span class="id"> pg</span><span class="id"> y</span>)).<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> eq_fsbigr</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> /pf</span><span class="id"> /pg</span> (<span class="id">fsbig_widen</span><span class="id"> G</span><span class="id"> setT</span>)<span class="id">//=;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> y</span><span class="id"> [_</span><span class="id"> /=</span><span class="id"> /preimage10-&gt;];</span><span class="id"> rewrite</span><span class="id"> setI0</span><span class="id"> measure0</span><span class="id"> mule0</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> (<span class="id">fsbig_widen</span><span class="id"> FG</span><span class="id"> setT</span>)<span class="id">//=;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> z</span><span class="id"> [_</span><span class="id"> /=</span><span class="id"> FGz];</span><span class="id"> rewrite</span><span class="id"> [X</span><span class="gallina-kwd"> in</span><span class="id"> m</span><span class="id"> X]</span>(_<span class="id"> :</span><span class="id"> _</span><span class="id"> =</span><span class="id"> set0</span>)<span class="id"> ?measure0</span><span class="id"> ?mule0//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -subset0</span><span class="id"> =&gt;</span><span class="id"> //=</span><span class="id"> {x}i</span><span class="id"> /=</span><span class="id"> [&lt;-]</span><span class="id"> /</span>(<span class="id">canLR</span> (<span class="id">@addrNK</span><span class="id"> _</span><span class="id"> _</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> contra_not</span><span class="id"> FGz</span><span class="id"> =&gt;</span><span class="id"> &lt;-;</span><span class="gallina-kwd"> exists</span><span class="id"> i;</span><span class="id"> rewrite</span><span class="id"> //=</span><span class="id"> addrC</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> (<span class="id">reindex_fsbigT</span> (<span class="id">+%R</span><span class="id"> x</span>))<span class="id">//=</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> eq_fsbigr</span><span class="id"> =&gt;</span><span class="id"> y;</span><span class="id"> rewrite</span><span class="id"> addrC</span><span class="id"> addrK</span>.<br/>
<span class="id">transitivity</span> (<span class="id">\sum_</span>(<span class="id">x</span><span class="id"> \in</span><span class="id"> F</span>)<span class="id"> \sum_</span>(<span class="id">y</span><span class="id"> \in</span><span class="id"> G</span>)<span class="id"> x%:E</span><span class="id"> *</span><span class="id"> m</span> (<span class="id">pf</span><span class="id"> x</span><span class="id"> `&amp;`</span><span class="id"> pg</span><span class="id"> y</span>)<span class="id"> +</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">\sum_</span>(<span class="id">x</span><span class="id"> \in</span><span class="id"> F</span>)<span class="id"> \sum_</span>(<span class="id">y</span><span class="id"> \in</span><span class="id"> G</span>)<span class="id"> y%:E</span><span class="id"> *</span><span class="id"> m</span> (<span class="id">pf</span><span class="id"> x</span><span class="id"> `&amp;`</span><span class="id"> pg</span><span class="id"> y</span>)).<br/>
&nbsp;&nbsp;<span class="id">do</span><span class="id"> 2![rewrite</span><span class="id"> -fsbig_split//;</span><span class="id"> apply:</span><span class="id"> eq_fsbigr</span><span class="id"> =&gt;</span><span class="id"> _</span><span class="id"> /set_mem</span><span class="id"> [?</span><span class="id"> _</span><span class="id"> &lt;-]]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> EFinD</span><span class="id"> ge0_muleDl//</span><span class="id"> ?lee_fin</span>.<br/>
<span class="id">congr</span> (_<span class="id"> +</span><span class="id"> _</span>)<span class="id">%E;</span><span class="id"> last</span><span class="id"> rewrite</span><span class="id"> exchange_fsbig//;</span><span class="id"> apply:</span><span class="id"> eq_fsbigr</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> _</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -ge0_mule_fsumr//</span><span class="id"> additive_nnsfunr</span><span class="id"> nnsfun_cover</span><span class="id"> setIT</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -ge0_mule_fsumr//</span><span class="id"> additive_nnsfunl</span><span class="id"> nnsfun_cover</span><span class="id"> setTI</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> sintegralD</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> le_sintegral</span>.<br/>
<span class="vernacular">Context</span><span class="id"> d</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>) (<span class="id">m</span><span class="id"> :</span><span class="id"> {measure</span><span class="id"> set</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R}</span>).<br/>
<span class="vernacular">Variables</span><span class="id"> f</span><span class="id"> g</span><span class="id"> :</span><span class="id"> {nnsfun</span><span class="id"> T</span><span class="id"> &gt;-&gt;</span><span class="id"> R}</span>.<br/>
<br/>
<span class="vernacular">Import</span><span class="id"> HBNNSimple</span>.<br/>
<br/>
<span class="vernacular">Hypothesis</span><span class="id"> fg</span><span class="id"> :</span><span class="gallina-kwd"> forall</span><span class="id"> x,</span><span class="id"> f</span><span class="id"> x</span><span class="id"> &lt;=</span><span class="id"> g</span><span class="id"> x</span>.<br/>
<br/>
<span class="vernacular">Let</span><span class="id"> fgnn</span><span class="id"> :</span><span class="id"> @isNonNegFun</span><span class="id"> T</span><span class="id"> R</span> (<span class="id">g</span><span class="id"> \-</span><span class="id"> f</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> split=&gt;</span><span class="id"> x;</span><span class="id"> rewrite</span><span class="id"> subr_ge0</span><span class="id"> fg</span>. Qed.</div></details>
<span class="id">#[local]</span><span class="id"> HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> fgnn</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> le_sintegral</span><span class="id"> :</span> (<span class="id">sintegral</span><span class="id"> m</span><span class="id"> f</span><span class="id"> &lt;=</span><span class="id"> sintegral</span><span class="id"> m</span><span class="id"> g</span>)<span class="id">%E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">have</span><span class="id"> gfgf</span><span class="id"> :</span><span class="id"> g</span><span class="id"> =1</span><span class="id"> f</span><span class="id"> \+</span> (<span class="id">g</span><span class="id"> \-</span><span class="id"> f</span>)<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> addrC</span><span class="id"> subrK</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span> (<span class="id">eq_sintegral</span><span class="id"> _</span><span class="id"> _</span><span class="id"> gfgf</span>)<span class="id"> sintegralD//</span><span class="id"> leeDl</span><span class="id"> //</span><span class="id"> sintegral_ge0</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> le_sintegral</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> is_cvg_sintegral</span>.<br/>
<span class="vernacular">Import</span><span class="id"> HBNNSimple</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> is_cvg_sintegral</span><span class="id"> d</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>)<br/>
&nbsp;&nbsp;(<span class="id">m</span><span class="id"> :</span><span class="id"> {measure</span><span class="id"> set</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R}</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> {nnsfun</span><span class="id"> T</span><span class="id"> &gt;-&gt;</span><span class="id"> R}^nat</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">forall</span><span class="id"> x,</span><span class="id"> nondecreasing_seq</span> (<span class="id">f</span><span class="id"> ^~</span><span class="id"> x</span>))<span class="id"> -&gt;</span><span class="id"> cvgn</span> (<span class="id">sintegral</span><span class="id"> m</span><span class="id"> \o</span><span class="id"> f</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> nd_f;</span><span class="id"> apply/cvg_ex;</span><span class="id"> eexists;</span><span class="id"> apply/ereal_nondecreasing_cvgn</span><span class="id"> =&gt;</span><span class="id"> a</span><span class="id"> b</span><span class="id"> ab</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> le_sintegral</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> =&gt;</span><span class="id"> x;</span><span class="id"> exact/nd_f</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> is_cvg_sintegral</span>.<br/>
<br/>
<span class="vernacular">Definition</span><span class="id"> proj_nnsfun</span><span class="id"> d</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">f</span><span class="id"> :</span><span class="id"> {nnsfun</span><span class="id"> T</span><span class="id"> &gt;-&gt;</span><span class="id"> R}</span>) (<span class="id">A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T</span>) (<span class="id">mA</span><span class="id"> :</span><span class="id"> measurable</span><span class="id"> A</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">mul_nnsfun</span><span class="id"> f</span> (<span class="id">indic_nnsfun</span><span class="id"> R</span><span class="id"> mA</span>).<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> mrestrict</span>.<br/>
<span class="vernacular">Import</span><span class="id"> HBNNSimple</span>.<br/>
<br/>
<span class="vernacular">Definition</span><span class="id"> mrestrict</span><span class="id"> d</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> {nnsfun</span><span class="id"> T</span><span class="id"> &gt;-&gt;</span><span class="id"> R}</span>)<br/>
&nbsp;&nbsp;<span class="id">A</span> (<span class="id">mA</span><span class="id"> :</span><span class="id"> measurable</span><span class="id"> A</span>)<span class="id"> :</span><span class="id"> f</span><span class="id"> \_</span><span class="id"> A</span><span class="id"> =</span><span class="id"> proj_nnsfun</span><span class="id"> f</span><span class="id"> mA</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">apply/funext</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> /patch</span><span class="id"> mindicE</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> case:</span><span class="id"> ifP;</span><span class="id"> rewrite</span> (<span class="id">mulr0,</span><span class="id"> mulr1</span>).<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> mrestrict</span>.<br/>
<br/>
<span class="vernacular">Definition</span><span class="id"> scale_nnsfun</span><span class="id"> d</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">f</span><span class="id"> :</span><span class="id"> {nnsfun</span><span class="id"> T</span><span class="id"> &gt;-&gt;</span><span class="id"> R}</span>) (<span class="id">k</span><span class="id"> :</span><span class="id"> R</span>) (<span class="id">k0</span><span class="id"> :</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> k</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">mul_nnsfun</span> (<span class="id">cst_nnsfun</span><span class="id"> T</span> (<span class="id">NngNum</span><span class="id"> k0</span>))<span class="id"> f</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> sintegral_nondecreasing_limit_lemma</span>.<br/>
<span class="vernacular">Context</span><span class="id"> d</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>).<br/>
<span class="vernacular">Variable</span><span class="id"> mu</span><span class="id"> :</span><span class="id"> {measure</span><span class="id"> set</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R}</span>.<br/>
<span class="vernacular">Variables</span> (<span class="id">g</span><span class="id"> :</span><span class="id"> {nnsfun</span><span class="id"> T</span><span class="id"> &gt;-&gt;</span><span class="id"> R}^nat</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> {nnsfun</span><span class="id"> T</span><span class="id"> &gt;-&gt;</span><span class="id"> R}</span>).<br/>
<br/>
<span class="vernacular">Import</span><span class="id"> HBNNSimple</span>.<br/>
<br/>
<span class="vernacular">Hypothesis</span><span class="id"> nd_g</span><span class="id"> :</span><span class="gallina-kwd"> forall</span><span class="id"> x,</span><span class="id"> nondecreasing_seq</span> (<span class="id">g^~</span><span class="id"> x</span>).<br/>
<span class="vernacular">Hypothesis</span><span class="id"> gf</span><span class="id"> :</span><span class="gallina-kwd"> forall</span><span class="id"> x,</span><span class="id"> cvgn</span> (<span class="id">g^~</span><span class="id"> x</span>)<span class="id"> -&gt;</span><span class="id"> f</span><span class="id"> x</span><span class="id"> &lt;=</span><span class="id"> limn</span> (<span class="id">g^~</span><span class="id"> x</span>).<br/>
<br/>
<span class="vernacular">Let</span><span class="id"> fleg</span><span class="id"> c</span><span class="id"> :</span> (<span class="id">set</span><span class="id"> T</span>)<span class="id">^nat</span><span class="id"> :=</span><span class="gallina-kwd"> fun</span><span class="id"> n</span><span class="id"> =&gt;</span><span class="id"> [set</span><span class="id"> x</span><span class="id"> |</span><span class="id"> c</span><span class="id"> *</span><span class="id"> f</span><span class="id"> x</span><span class="id"> &lt;=</span><span class="id"> g</span><span class="id"> n</span><span class="id"> x]</span>.<br/>
<br/>
<span class="vernacular">Let</span><span class="id"> nd_fleg</span><span class="id"> c</span><span class="id"> :</span><span class="id"> {homo</span><span class="id"> fleg</span><span class="id"> c</span><span class="id"> :</span><span class="id"> n</span><span class="id"> m</span><span class="id"> /</span> (<span class="id">n</span><span class="id"> &lt;=</span><span class="id"> m</span>)<span class="id">%N</span><span class="id"> &gt;-&gt;</span> (<span class="id">n</span><span class="id"> &lt;=</span><span class="id"> m</span>)<span class="id">%O}</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> n</span><span class="id"> m</span><span class="id"> nm;</span><span class="id"> rewrite</span><span class="id"> /fleg;</span><span class="id"> apply/subsetPset</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> /=</span><span class="id"> cfg</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> move:</span><span class="id"> cfg</span><span class="id"> =&gt;</span><span class="id"> /le_trans;</span><span class="id"> apply;</span><span class="id"> exact:</span><span class="id"> nd_g</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Let</span><span class="id"> mfleg</span><span class="id"> c</span><span class="id"> n</span><span class="id"> :</span><span class="id"> measurable</span> (<span class="id">fleg</span><span class="id"> c</span><span class="id"> n</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> /fleg</span><span class="id"> [X</span><span class="gallina-kwd"> in</span><span class="id"> _</span><span class="id"> X]</span>(_<span class="id"> :</span><span class="id"> _</span><span class="id"> =</span><span class="id"> \big[setU/set0]_</span>(<span class="id">y</span><span class="id"> &lt;-</span><span class="id"> fset_set</span> (<span class="id">range</span><span class="id"> f</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">\big[setU/set0]_</span>(<span class="id">x</span><span class="id"> &lt;-</span><span class="id"> fset_set</span> (<span class="id">range</span> (<span class="id">g</span><span class="id"> n</span>))<span class="id"> |</span><span class="id"> c</span><span class="id"> *</span><span class="id"> y</span><span class="id"> &lt;=</span><span class="id"> x</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">f</span><span class="id"> @^-1`</span><span class="id"> [set</span><span class="id"> y]</span><span class="id"> `&amp;`</span> (<span class="id">g</span><span class="id"> n</span><span class="id"> @^-1`</span><span class="id"> [set</span><span class="id"> x]</span>))).<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> bigsetU_measurable</span><span class="id"> =&gt;</span><span class="id"> r</span><span class="id"> _;</span><span class="id"> apply:</span><span class="id"> bigsetU_measurable</span><span class="id"> =&gt;</span><span class="id"> r'</span><span class="id"> crr'</span>.<br/>
&nbsp;&nbsp;<span class="id">exact/measurableI/measurable_sfunP</span>.<br/>
<span class="id">rewrite</span><span class="id"> predeqE</span><span class="id"> =&gt;</span><span class="id"> t;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> [/=</span><span class="id"> cfgn|]</span>.<br/>
<span class="id">-</span><span class="id"> rewrite</span><span class="id"> -bigcup_seq;</span><span class="gallina-kwd"> exists</span> (<span class="id">f</span><span class="id"> t</span>)<span class="id">;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> /=</span><span class="id"> in_fset_set//=</span><span class="id"> mem_set</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -bigcup_seq_cond;</span><span class="gallina-kwd"> exists</span> (<span class="id">g</span><span class="id"> n</span><span class="id"> t</span>)<span class="id"> =&gt;</span><span class="id"> //=</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> in_fset_set//</span><span class="id"> mem_set</span>.<br/>
<span class="id">-</span><span class="id"> rewrite</span><span class="id"> bigsetU_fset_set//</span><span class="id"> =&gt;</span><span class="id"> -[r</span><span class="id"> [x</span><span class="id"> _</span><span class="id"> fxr]]</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> bigsetU_fset_set_cond//</span><span class="id"> =&gt;</span><span class="id"> -[r'</span><span class="id"> [[x'</span><span class="id"> _</span><span class="id"> gnx'r']</span><span class="id"> crr']]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /preimage/=</span><span class="id"> =&gt;</span><span class="id"> -[-&gt;</span><span class="id"> -&gt;]</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Let</span><span class="id"> g1</span><span class="id"> c</span><span class="id"> n</span><span class="id"> :</span><span class="id"> {nnsfun</span><span class="id"> T</span><span class="id"> &gt;-&gt;</span><span class="id"> R}</span><span class="id"> :=</span><span class="id"> proj_nnsfun</span><span class="id"> f</span> (<span class="id">mfleg</span><span class="id"> c</span><span class="id"> n</span>).<br/>
<br/>
<span class="vernacular">Let</span><span class="id"> le_ffleg</span><span class="id"> c</span><span class="id"> :</span><span class="id"> {homo</span> (<span class="gallina-kwd">fun</span><span class="id"> p</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> g1</span><span class="id"> c</span><span class="id"> p</span><span class="id"> x</span>)<span class="id">:</span><span class="id"> m</span><span class="id"> n</span><span class="id"> /</span> (<span class="id">m</span><span class="id"> &lt;=</span><span class="id"> n</span>)<span class="id">%N</span><span class="id"> &gt;-&gt;</span> (<span class="id">m</span><span class="id"> &lt;=</span><span class="id"> n</span>)<span class="id">%O}</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> m</span><span class="id"> n</span><span class="id"> mn;</span><span class="id"> apply/asboolP</span><span class="id"> =&gt;</span><span class="id"> t;</span><span class="id"> rewrite</span><span class="id"> /g1/=</span><span class="id"> ler_pM//</span><span class="id"> 2!mindicE/=</span><span class="id"> ler_nat</span>.<br/>
<span class="id">have</span><span class="id"> [|//]</span><span class="id"> :=</span><span class="id"> boolP</span> (<span class="id">t</span><span class="id"> \in</span><span class="id"> fleg</span><span class="id"> c</span><span class="id"> m</span>)<span class="id">;</span><span class="id"> rewrite</span><span class="id"> inE</span><span class="id"> =&gt;</span><span class="id"> cnt</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> have</span><span class="id"> :=</span><span class="id"> nd_fleg</span><span class="id"> c</span><span class="id"> mn</span><span class="id"> =&gt;</span><span class="id"> /subsetPset/</span>(_<span class="id"> _</span><span class="id"> cnt</span>)<span class="id"> cmt;</span><span class="id"> rewrite</span><span class="id"> mem_set</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Let</span><span class="id"> bigcup_fleg</span><span class="id"> c</span><span class="id"> :</span><span class="id"> c</span><span class="id"> &lt;</span><span class="id"> 1</span><span class="id"> -&gt;</span><span class="id"> \bigcup_n</span><span class="id"> fleg</span><span class="id"> c</span><span class="id"> n</span><span class="id"> =</span><span class="id"> setT</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> c1;</span><span class="id"> rewrite</span><span class="id"> predeqE</span><span class="id"> =&gt;</span><span class="id"> x;</span><span class="id"> split=&gt;</span><span class="id"> //</span><span class="id"> _</span>.<br/>
<span class="id">have</span><span class="id"> :=</span><span class="id"> @fun_ge0</span><span class="id"> _</span><span class="id"> _</span><span class="id"> f</span><span class="id"> x;</span><span class="id"> rewrite</span><span class="id"> le_eqVlt</span><span class="id"> =&gt;</span><span class="id"> /predU1P[|]</span><span class="id"> gx0</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="gallina-kwd"> exists</span><span class="id"> O</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> rewrite</span><span class="id"> /fleg</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> -gx0</span><span class="id"> mulr0</span><span class="id"> fun_ge0</span>.<br/>
<span class="id">have</span><span class="id"> [cf|df]</span><span class="id"> :=</span><span class="id"> pselect</span> (<span class="id">cvgn</span> (<span class="id">g^~</span><span class="id"> x</span>)).<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> cfg</span><span class="id"> :</span><span class="id"> limn</span> (<span class="id">g^~</span><span class="id"> x</span>)<span class="id"> &gt;</span><span class="id"> c</span><span class="id"> *</span><span class="id"> f</span><span class="id"> x</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span> (<span class="id">lt_le_trans</span><span class="id"> _</span> (<span class="id">gf</span><span class="id"> cf</span>))<span class="id"> //</span><span class="id"> gtr_pMl</span>.<br/>
&nbsp;&nbsp;<span class="id">suff</span><span class="id"> [n</span><span class="id"> cfgn]</span><span class="id"> :</span><span class="gallina-kwd"> exists</span><span class="id"> n,</span><span class="id"> g</span><span class="id"> n</span><span class="id"> x</span><span class="id"> &gt;=</span><span class="id"> c</span><span class="id"> *</span><span class="id"> f</span><span class="id"> x</span><span class="gallina-kwd"> by</span><span class="gallina-kwd"> exists</span><span class="id"> n</span>.<br/>
&nbsp;&nbsp;<span class="id">move/</span>(<span class="id">@lt_lim</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">nd_g</span><span class="id"> x</span>)<span class="id"> cf</span>)<span class="id"> :</span><span class="id"> cfg</span><span class="id"> =&gt;</span><span class="id"> [n</span><span class="id"> _</span><span class="id"> nf]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="gallina-kwd"> exists</span><span class="id"> n;</span><span class="id"> apply:</span><span class="id"> nf</span><span class="id"> =&gt;</span><span class="id"> /=</span>.<br/>
<span class="id">have</span><span class="id"> /cvgryPge/</span>(_ (<span class="id">c</span><span class="id"> *</span><span class="id"> f</span><span class="id"> x</span>))<span class="id">[n</span><span class="id"> _</span><span class="id"> ncfgn]:=</span><span class="id"> nondecreasing_dvgn_lt</span> (<span class="id">nd_g</span><span class="id"> x</span>)<span class="id"> df</span>.<br/>
<span class="gallina-kwd">by</span><span class="gallina-kwd"> exists</span><span class="id"> n</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> rewrite</span><span class="id"> /fleg</span><span class="id"> /=;</span><span class="id"> apply:</span><span class="id"> ncfgn</span><span class="id"> =&gt;</span><span class="id"> /=</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> nd_sintegral_lim_lemma</span><span class="id"> :</span><span class="id"> sintegral</span><span class="id"> mu</span><span class="id"> f</span><span class="id"> &lt;=</span><span class="id"> limn</span> (<span class="id">sintegral</span><span class="id"> mu</span><span class="id"> \o</span><span class="id"> g</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">suff</span><span class="id"> ?</span><span class="id"> :</span><span class="gallina-kwd"> forall</span><span class="id"> c,</span> (<span class="id">0</span><span class="id"> &lt;</span><span class="id"> c</span><span class="id"> &lt;</span><span class="id"> 1</span>)<span class="id">%R</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">c%:E</span><span class="id"> *</span><span class="id"> sintegral</span><span class="id"> mu</span><span class="id"> f</span><span class="id"> &lt;=</span><span class="id"> limn</span> (<span class="id">sintegral</span><span class="id"> mu</span><span class="id"> \o</span><span class="id"> g</span>).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply/lee_mul01Pr</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> sintegral_ge0</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> c</span><span class="id"> /andP[c0</span><span class="id"> c1]</span>.<br/>
<span class="id">have</span><span class="id"> cg1g</span><span class="id"> n</span><span class="id"> :</span><span class="id"> c%:E</span><span class="id"> *</span><span class="id"> sintegral</span><span class="id"> mu</span> (<span class="id">g1</span><span class="id"> c</span><span class="id"> n</span>)<span class="id"> &lt;=</span><span class="id"> sintegral</span><span class="id"> mu</span> (<span class="id">g</span><span class="id"> n</span>).<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -sintegralrM</span> (_<span class="id"> :</span> (_<span class="id"> \*</span><span class="id"> _</span>)<span class="id">%R</span><span class="id"> =</span><span class="id"> scale_nnsfun</span> (<span class="id">g1</span><span class="id"> c</span><span class="id"> n</span>) (<span class="id">ltW</span><span class="id"> c0</span>))<span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> le_sintegral</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> t</span>.<br/>
&nbsp;&nbsp;<span class="id">suff</span><span class="id"> :</span><span class="gallina-kwd"> forall</span><span class="id"> m</span><span class="id"> x,</span> (<span class="id">c</span><span class="id"> *</span><span class="id"> g1</span><span class="id"> c</span><span class="id"> m</span><span class="id"> x</span><span class="id"> &lt;=</span><span class="id"> g</span><span class="id"> m</span><span class="id"> x</span>)<span class="id">%R</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> /</span>(_<span class="id"> n</span><span class="id"> t</span>).<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> m</span><span class="id"> x;</span><span class="id"> rewrite</span><span class="id"> /g1</span><span class="id"> /proj_nnsfun/=</span><span class="id"> mindicE</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> have</span><span class="id"> [|]</span><span class="id"> :=</span><span class="id"> boolP</span> (_<span class="id"> \in</span><span class="id"> _</span>)<span class="id">;</span><span class="id"> [rewrite</span><span class="id"> inE</span><span class="id"> mulr1|rewrite</span><span class="id"> 2!mulr0</span><span class="id"> fun_ge0]</span>.<br/>
<span class="id">suff</span><span class="id"> {cg1g}&lt;-</span><span class="id"> :</span><span class="id"> limn</span> (<span class="gallina-kwd">fun</span><span class="id"> n</span><span class="id"> =&gt;</span><span class="id"> sintegral</span><span class="id"> mu</span> (<span class="id">g1</span><span class="id"> c</span><span class="id"> n</span>))<span class="id"> =</span><span class="id"> sintegral</span><span class="id"> mu</span><span class="id"> f</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> is_cvg_g1</span><span class="id"> :</span><span class="id"> cvgn</span> (<span class="gallina-kwd">fun</span><span class="id"> n</span><span class="id"> =&gt;</span><span class="id"> sintegral</span><span class="id"> mu</span> (<span class="id">g1</span><span class="id"> c</span><span class="id"> n</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> is_cvg_sintegral</span><span class="id"> =&gt;</span><span class="id"> //=</span><span class="id"> x</span><span class="id"> m</span><span class="id"> n</span><span class="id"> /</span>(<span class="id">le_ffleg</span><span class="id"> c</span>)<span class="id">/lefP/</span>(_<span class="id"> x</span>).<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -limeMl</span><span class="id"> //</span><span class="id"> lee_lim//;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> is_cvgeMl</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> is_cvg_sintegral</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> m</span><span class="id"> n</span><span class="id"> mn;</span><span class="id"> apply/lefP</span><span class="id"> =&gt;</span><span class="id"> t;</span><span class="id"> apply:</span><span class="id"> nd_g</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> nearW;</span><span class="id"> exact:</span><span class="id"> cg1g</span>.<br/>
<span class="id">suff</span><span class="id"> :</span><span class="id"> sintegral</span><span class="id"> mu</span> (<span class="id">g1</span><span class="id"> c</span><span class="id"> n</span>)<span class="id"> @[n</span><span class="id"> \oo]</span><span class="id"> --&gt;</span><span class="id"> sintegral</span><span class="id"> mu</span><span class="id"> f</span><span class="gallina-kwd"> by</span><span class="id"> apply/cvg_lim</span>.<br/>
<span class="id">rewrite</span><span class="id"> [X</span><span class="gallina-kwd"> in</span><span class="id"> X</span><span class="id"> @</span><span class="id"> \oo</span><span class="id"> --&gt;</span><span class="id"> _]</span>(_<span class="id"> :</span><span class="id"> _</span><span class="id"> =</span><span class="gallina-kwd"> fun</span><span class="id"> n</span><span class="id"> =&gt;</span><span class="id"> \sum_</span>(<span class="id">x</span><span class="id"> &lt;-</span><span class="id"> fset_set</span> (<span class="id">range</span><span class="id"> f</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">x%:E</span><span class="id"> *</span><span class="id"> mu</span> (<span class="id">f</span><span class="id"> @^-1`</span><span class="id"> [set</span><span class="id"> x]</span><span class="id"> `&amp;`</span><span class="id"> fleg</span><span class="id"> c</span><span class="id"> n</span>))<span class="id">;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> funeqE</span><span class="id"> =&gt;</span><span class="id"> n;</span><span class="id"> rewrite</span><span class="id"> sintegralE</span>.<br/>
&nbsp;&nbsp;<span class="id">transitivity</span> (<span class="id">\sum_</span>(<span class="id">x</span><span class="id"> \in</span><span class="id"> range</span><span class="id"> f</span>)<span class="id"> x%:E</span><span class="id"> *</span><span class="id"> mu</span> (<span class="id">g1</span><span class="id"> c</span><span class="id"> n</span><span class="id"> @^-1`</span><span class="id"> [set</span><span class="id"> x]</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> eq_fbigl</span><span class="id"> =&gt;</span><span class="id"> r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span><span class="id"> 2</span> (<span class="id">rewrite</span><span class="id"> in_finite_support;</span><span class="id"> last</span><span class="id"> exact/finite_setIl</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply/idP/idP</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> in_setI</span><span class="id"> =&gt;</span><span class="id"> /andP[];</span><span class="id"> rewrite</span><span class="id"> inE/=</span><span class="id"> =&gt;</span><span class="id"> -[x</span><span class="id"> _];</span><span class="id"> rewrite</span><span class="id"> mindicE</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">have</span><span class="id"> [_|xcn]</span><span class="id"> :=</span><span class="id"> boolP</span> (_<span class="id"> \in</span><span class="id"> _</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> mulr1</span><span class="id"> =&gt;</span><span class="id"> &lt;-;</span><span class="id"> rewrite</span><span class="id"> !inE/=</span><span class="id"> =&gt;</span><span class="id"> ?;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="gallina-kwd"> exists</span><span class="id"> x</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> mulr0</span><span class="id"> =&gt;</span><span class="id"> /esym</span><span class="id"> -&gt;;</span><span class="id"> rewrite</span><span class="id"> !inE/=</span><span class="id"> mul0e</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> in_setI</span><span class="id"> =&gt;</span><span class="id"> /andP[];</span><span class="id"> rewrite</span><span class="id"> inE</span><span class="id"> =&gt;</span><span class="id"> -[x</span><span class="id"> _</span><span class="id"> &lt;-]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> !inE/=</span><span class="id"> =&gt;</span><span class="id"> h;</span><span class="id"> split=&gt;</span><span class="id"> //;</span><span class="id"> move:</span><span class="id"> h;</span><span class="id"> rewrite</span><span class="id"> mindicE</span><span class="id"> =&gt;</span><span class="id"> /eqP</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> mule_eq0</span><span class="id"> negb_or</span><span class="id"> =&gt;</span><span class="id"> /andP[_];</span><span class="id"> set</span><span class="id"> S</span><span class="id"> :=</span> (<span class="id">X</span><span class="gallina-kwd"> in</span><span class="id"> mu</span><span class="id"> X</span>)<span class="id"> =&gt;</span><span class="id"> mS0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">suff</span><span class="id"> :</span><span class="id"> S</span><span class="id"> !=set0</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> [y</span><span class="id"> yx];</span><span class="gallina-kwd"> exists</span><span class="id"> y</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply/set0P;</span><span class="id"> apply:</span><span class="id"> contra</span><span class="id"> mS0</span><span class="id"> =&gt;</span><span class="id"> /eqP</span><span class="id"> -&gt;;</span><span class="id"> rewrite</span><span class="id"> measure0</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> fsbig_finite//=;</span><span class="id"> apply:</span><span class="id"> eq_fbigr</span><span class="id"> =&gt;</span><span class="id"> r</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> in_fset_set//</span><span class="id"> inE</span><span class="id"> =&gt;</span><span class="id"> -[t</span><span class="id"> _</span><span class="id"> ftr</span><span class="id"> _]</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> [-&gt;|r0]</span><span class="id"> :=</span><span class="id"> eqVneq</span><span class="id"> r</span><span class="id"> 0%R;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> 2!mul0e</span>.<br/>
&nbsp;&nbsp;<span class="id">congr</span> (_<span class="id"> *</span><span class="id"> mu</span><span class="id"> _</span>)<span class="id">;</span><span class="id"> apply/seteqP;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> x</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> /preimage/=</span><span class="id"> mindicE</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">have</span><span class="id"> [|_]</span><span class="id"> :=</span><span class="id"> boolP</span> (_<span class="id"> \in</span><span class="id"> _</span>)<span class="id">;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> mulr1</span><span class="id"> inE</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> mulr0</span><span class="id"> =&gt;</span><span class="id"> /esym/eqP;</span><span class="id"> rewrite</span> (<span class="id">negbTE</span><span class="id"> r0</span>).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /preimage/=</span><span class="id"> =&gt;</span><span class="id"> -[fxr</span><span class="id"> cnx];</span><span class="id"> rewrite</span><span class="id"> mindicE</span><span class="id"> mem_set//</span><span class="id"> mulr1</span>.<br/>
<span class="id">rewrite</span><span class="id"> sintegralE</span><span class="id"> fsbig_finite//=</span>.<br/>
<span class="id">apply:</span><span class="id"> cvg_nnesum=&gt;</span><span class="id"> [r</span><span class="id"> _|r</span><span class="id"> _]</span>.<br/>
&nbsp;&nbsp;<span class="id">near=&gt;</span><span class="id"> A;</span><span class="id"> apply:</span> (<span class="id">mulemu_ge0</span> (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> f</span><span class="id"> @^-1`</span><span class="id"> [set</span><span class="id"> x]</span><span class="id"> `&amp;`</span><span class="id"> fleg</span><span class="id"> c</span><span class="id"> A</span>))<span class="id"> =&gt;</span><span class="id"> r0</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> preimage_nnfun0//</span><span class="id"> set0I</span>.<br/>
<span class="id">apply:</span><span class="id"> cvgeMl</span><span class="id"> =&gt;</span><span class="id"> //=;</span><span class="id"> rewrite</span><span class="id"> [X</span><span class="gallina-kwd"> in</span><span class="id"> _</span><span class="id"> --&gt;</span><span class="id"> X]</span>(_<span class="id"> :</span><span class="id"> _</span><span class="id"> =</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">mu</span> (<span class="id">\bigcup_n</span> (<span class="id">f</span><span class="id"> @^-1`</span><span class="id"> [set</span><span class="id"> r]</span><span class="id"> `&amp;`</span><span class="id"> fleg</span><span class="id"> c</span><span class="id"> n</span>)))<span class="id">;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -setI_bigcupr</span><span class="id"> bigcup_fleg//</span><span class="id"> setIT</span>.<br/>
<span class="id">have</span><span class="id"> ?</span><span class="id"> k</span><span class="id"> i</span><span class="id"> :</span><span class="id"> measurable</span> (<span class="id">f</span><span class="id"> @^-1`</span><span class="id"> [set</span><span class="id"> k]</span><span class="id"> `&amp;`</span><span class="id"> fleg</span><span class="id"> c</span><span class="id"> i</span>)<span class="gallina-kwd"> by</span><span class="id"> exact:</span><span class="id"> measurableI</span>.<br/>
<span class="id">apply:</span><span class="id"> nondecreasing_cvg_mu;</span><span class="id"> [by</span><span class="id"> []|exact:</span><span class="id"> bigcupT_measurable|]</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> n</span><span class="id"> m</span><span class="id"> nm;</span><span class="id"> apply/subsetPset;</span><span class="id"> apply:</span><span class="id"> setIS</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> move/</span>(<span class="id">nd_fleg</span><span class="id"> c</span>)<span class="id"> :</span><span class="id"> nm</span><span class="id"> =&gt;</span><span class="id"> /subsetPset</span>.<br/>
<span class="id">Unshelve</span>.<span class="id"> all:</span><span class="gallina-kwd"> by</span><span class="id"> end_near</span>. Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> sintegral_nondecreasing_limit_lemma</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> sintegral_nondecreasing_limit</span>.<br/>
<span class="vernacular">Context</span><span class="id"> d</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>).<br/>
<span class="vernacular">Variable</span><span class="id"> mu</span><span class="id"> :</span><span class="id"> {measure</span><span class="id"> set</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R}</span>.<br/>
<span class="vernacular">Variables</span> (<span class="id">g</span><span class="id"> :</span><span class="id"> {nnsfun</span><span class="id"> T</span><span class="id"> &gt;-&gt;</span><span class="id"> R}^nat</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> {nnsfun</span><span class="id"> T</span><span class="id"> &gt;-&gt;</span><span class="id"> R}</span>).<br/>
<br/>
<span class="vernacular">Import</span><span class="id"> HBNNSimple</span>.<br/>
<br/>
<span class="vernacular">Hypothesis</span><span class="id"> nd_g</span><span class="id"> :</span><span class="gallina-kwd"> forall</span><span class="id"> x,</span><span class="id"> nondecreasing_seq</span> (<span class="id">g^~</span><span class="id"> x</span>).<br/>
<span class="vernacular">Hypothesis</span><span class="id"> gf</span><span class="id"> :</span><span class="gallina-kwd"> forall</span><span class="id"> x,</span><span class="id"> g</span><span class="id"> ^~</span><span class="id"> x</span><span class="id"> @</span><span class="id"> \oo</span><span class="id"> --&gt;</span><span class="id"> f</span><span class="id"> x</span>.<br/>
<br/>
<span class="vernacular">Let</span><span class="id"> limg</span><span class="id"> x</span><span class="id"> :</span><span class="id"> limn</span> (<span class="id">g^~</span><span class="id"> x</span>)<span class="id"> =</span><span class="id"> f</span><span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> apply/cvg_lim</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> gf</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> nd_sintegral_lim</span><span class="id"> :</span><span class="id"> sintegral</span><span class="id"> mu</span><span class="id"> f</span><span class="id"> =</span><span class="id"> limn</span> (<span class="id">sintegral</span><span class="id"> mu</span><span class="id"> \o</span><span class="id"> g</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">apply/eqP;</span><span class="id"> rewrite</span><span class="id"> eq_le;</span><span class="id"> apply/andP;</span><span class="id"> split</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> nd_sintegral_lim_lemma</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> x;</span><span class="id"> rewrite</span><span class="id"> -limg</span>.<br/>
<span class="id">have</span><span class="id"> :</span><span class="id"> nondecreasing_seq</span> (<span class="id">sintegral</span><span class="id"> mu</span><span class="id"> \o</span><span class="id"> g</span>).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> m</span><span class="id"> n</span><span class="id"> mn;</span><span class="id"> apply:</span><span class="id"> le_sintegral</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> x;</span><span class="id"> exact/nd_g</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> /ereal_nondecreasing_cvgn/cvg_lim</span><span class="id"> -&gt;</span><span class="id"> //</span>.<br/>
<span class="id">apply:</span><span class="id"> ub_ereal_sup</span><span class="id"> =&gt;</span><span class="id"> _</span><span class="id"> [n</span><span class="id"> _</span><span class="id"> &lt;-]</span><span class="id"> /=;</span><span class="id"> apply:</span><span class="id"> le_sintegral</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> x</span>.<br/>
<span class="id">rewrite</span><span class="id"> -limg</span><span class="id"> //</span> (<span class="id">nondecreasing_cvgn_le</span> (<span class="id">nd_g</span><span class="id"> x</span>))<span class="id"> //</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply/cvg_ex;</span><span class="gallina-kwd"> exists</span> (<span class="id">f</span><span class="id"> x</span>)<span class="id">;</span><span class="id"> exact:</span><span class="id"> gf</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> sintegral_nondecreasing_limit</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> integral</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<span class="vernacular">Context</span><span class="id"> d</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>).<br/>
<span class="vernacular">Implicit</span><span class="id"> Types</span> (<span class="id">f</span><span class="id"> g</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>) (<span class="id">D</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T</span>).<br/>
<br/>
<span class="vernacular">Import</span><span class="id"> HBNNSimple</span>.<br/>
<br/>
<span class="vernacular">Let</span><span class="id"> nnintegral</span><span class="id"> mu</span><span class="id"> f</span><span class="id"> :=</span><span class="id"> ereal_sup</span><span class="id"> [set</span><span class="id"> sintegral</span><span class="id"> mu</span><span class="id"> h</span><span class="id"> |</span><br/>
&nbsp;&nbsp;<span class="id">h</span><span class="gallina-kwd"> in</span><span class="id"> [set</span><span class="id"> h</span><span class="id"> :</span><span class="id"> {nnsfun</span><span class="id"> T</span><span class="id"> &gt;-&gt;</span><span class="id"> R}</span><span class="id"> |</span><span class="gallina-kwd"> forall</span><span class="id"> x,</span> (<span class="id">h</span><span class="id"> x</span>)<span class="id">%:E</span><span class="id"> &lt;=</span><span class="id"> f</span><span class="id"> x]]</span>.<br/>
<br/>
<span class="vernacular">Definition</span><span class="id"> integral</span><span class="id"> mu</span><span class="id"> D</span><span class="id"> f</span> (<span class="id">g</span><span class="id"> :=</span><span class="id"> f</span><span class="id"> \_</span><span class="id"> D</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">nnintegral</span><span class="id"> mu</span> (<span class="id">g</span><span class="id"> ^\+</span>)<span class="id"> -</span><span class="id"> nnintegral</span><span class="id"> mu</span> (<span class="id">g</span><span class="id"> ^\-</span>).<br/>
<br/>
<span class="vernacular">Variable</span> (<span class="id">mu</span><span class="id"> :</span><span class="id"> {measure</span><span class="id"> set</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R}</span>).<br/>
<br/>
<span class="vernacular">Let</span><span class="id"> nnintegral_ge0</span><span class="id"> f</span><span class="id"> :</span> (<span class="gallina-kwd">forall</span><span class="id"> x,</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> f</span><span class="id"> x</span>)<span class="id"> -&gt;</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> nnintegral</span><span class="id"> mu</span><span class="id"> f</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> f0;</span><span class="id"> apply:</span><span class="id"> ereal_sup_ubound;</span><span class="gallina-kwd"> exists</span><span class="id"> nnsfun0</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> sintegral0</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Let</span><span class="id"> eq_nnintegral</span><span class="id"> g</span><span class="id"> f</span><span class="id"> :</span><span class="id"> f</span><span class="id"> =1</span><span class="id"> g</span><span class="id"> -&gt;</span><span class="id"> nnintegral</span><span class="id"> mu</span><span class="id"> f</span><span class="id"> =</span><span class="id"> nnintegral</span><span class="id"> mu</span><span class="id"> g</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> /funext-&gt;</span>. Qed.</div></details>
<br/>
<span class="vernacular">Let</span><span class="id"> nnintegral0</span><span class="id"> :</span><span class="id"> nnintegral</span><span class="id"> mu</span> (<span class="id">cst</span><span class="id"> 0</span>)<span class="id"> =</span><span class="id"> 0</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> /nnintegral</span><span class="id"> /=;</span><span class="id"> apply/eqP;</span><span class="id"> rewrite</span><span class="id"> eq_le;</span><span class="id"> apply/andP;</span><span class="id"> split;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply/ereal_sup_ubound;</span><span class="gallina-kwd"> exists</span><span class="id"> nnsfun0;</span><span class="id"> [|exact:</span><span class="id"> sintegral0]</span>.<br/>
<span class="id">apply/ub_ereal_sup</span><span class="id"> =&gt;</span><span class="id"> /=</span><span class="id"> x</span><span class="id"> [f</span><span class="id"> /=</span><span class="id"> f0</span><span class="id"> &lt;-];</span><span class="id"> have</span><span class="id"> {}f0</span><span class="id"> :</span><span class="gallina-kwd"> forall</span><span class="id"> x,</span><span class="id"> f</span><span class="id"> x</span><span class="id"> =</span><span class="id"> 0%R</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> y;</span><span class="id"> apply/eqP;</span><span class="id"> rewrite</span><span class="id"> eq_le</span><span class="id"> -2!lee_fin</span><span class="id"> f0</span><span class="id"> //=</span><span class="id"> lee_fin//</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span> (<span class="id">eq_sintegral</span> (<span class="id">@nnsfun0</span><span class="id"> _</span><span class="id"> T</span><span class="id"> R</span>))<span class="id"> ?sintegral0</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Let</span><span class="id"> nnintegral_nnsfun</span> (<span class="id">h</span><span class="id"> :</span><span class="id"> {nnsfun</span><span class="id"> T</span><span class="id"> &gt;-&gt;</span><span class="id"> R}</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">nnintegral</span><span class="id"> mu</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> h</span>)<span class="id"> =</span><span class="id"> sintegral</span><span class="id"> mu</span><span class="id"> h</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">apply/eqP;</span><span class="id"> rewrite</span><span class="id"> eq_le;</span><span class="id"> apply/andP;</span><span class="id"> split</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply/ub_ereal_sup</span><span class="id"> =&gt;</span><span class="id"> /=</span><span class="id"> _</span><span class="id"> -[g</span><span class="id"> /=</span><span class="id"> gh</span><span class="id"> &lt;-];</span><span class="id"> rewrite</span><span class="id"> le_sintegral</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> ereal_sup_ubound</span><span class="id"> =&gt;</span><span class="id"> /=;</span><span class="gallina-kwd"> exists</span><span class="id"> h</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Local</span><span class="vernacular"> Notation</span> <span class="id">&quot;\int_ ( x 'in' D ) F&quot;</span><span class="id"> :=</span> (<span class="id">integral</span><span class="id"> mu</span><span class="id"> D</span> (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> F</span>))<br/>
&nbsp;&nbsp;(<span class="gallina-kwd">at</span><span class="id"> level</span><span class="id"> 36,</span><span class="id"> F</span><span class="gallina-kwd"> at</span><span class="id"> level</span><span class="id"> 36,</span><span class="id"> x,</span><span class="id"> D</span><span class="gallina-kwd"> at</span><span class="id"> level</span><span class="id"> 50,</span><br/>
&nbsp;&nbsp;<span class="id">format</span> <span class="id">&quot;'[' \int_ ( x  'in'  D ) '/  '  F ']'&quot;</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> eq_integral</span><span class="id"> D</span><span class="id"> g</span><span class="id"> f</span><span class="id"> :</span><span class="id"> {in</span><span class="id"> D,</span><span class="id"> f</span><span class="id"> =1</span><span class="id"> g}</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">\int_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> f</span><span class="id"> x</span><span class="id"> =</span><span class="id"> \int_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> g</span><span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> /integral</span><span class="id"> =&gt;</span><span class="id"> /eq_restrictP-&gt;</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> ge0_integralE</span><span class="id"> D</span><span class="id"> f</span><span class="id"> :</span> (<span class="gallina-kwd">forall</span><span class="id"> x,</span><span class="id"> D</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> f</span><span class="id"> x</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">\int_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> f</span><span class="id"> x</span><span class="id"> =</span><span class="id"> nnintegral</span><span class="id"> mu</span> (<span class="id">f</span><span class="id"> \_</span><span class="id"> D</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> f0;</span><span class="id"> rewrite</span><span class="id"> /integral</span><span class="id"> funeneg_restrict</span><span class="id"> funepos_restrict</span>.<br/>
<span class="id">have</span><span class="id"> /eq_restrictP-&gt;</span><span class="id"> :=</span><span class="id"> ge0_funeposE</span><span class="id"> f0</span>.<br/>
<span class="id">have</span><span class="id"> /eq_restrictP-&gt;</span><span class="id"> :=</span><span class="id"> ge0_funenegE</span><span class="id"> f0</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> erestrict0</span><span class="id"> nnintegral0</span><span class="id"> sube0</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> ge0_integralTE</span><span class="id"> f</span><span class="id"> :</span> (<span class="gallina-kwd">forall</span><span class="id"> x,</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> f</span><span class="id"> x</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">\int_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> setT</span>)<span class="id"> f</span><span class="id"> x</span><span class="id"> =</span><span class="id"> nnintegral</span><span class="id"> mu</span><span class="id"> f</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> f0;</span><span class="id"> rewrite</span><span class="id"> ge0_integralE//</span><span class="id"> patch_setT</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> integralE</span><span class="id"> D</span><span class="id"> f</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">\int_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> f</span><span class="id"> x</span><span class="id"> =</span><span class="id"> \int_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>) (<span class="id">f</span><span class="id"> ^\+</span><span class="id"> x</span>)<span class="id"> -</span><span class="id"> \int_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> f</span><span class="id"> ^\-</span><span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> [in</span><span class="id"> LHS]/integral</span><span class="id"> funepos_restrict</span><span class="id"> funeneg_restrict</span><span class="id"> -!ge0_integralE</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> integral0</span><span class="id"> D</span><span class="id"> :</span><span class="id"> \int_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>) (<span class="id">cst</span><span class="id"> 0</span><span class="id"> x</span>)<span class="id"> =</span><span class="id"> 0</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> ge0_integralE//</span><span class="id"> erestrict0</span><span class="id"> nnintegral0</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> integral0_eq</span><span class="id"> D</span><span class="id"> f</span><span class="id"> :</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">forall</span><span class="id"> x,</span><span class="id"> D</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> f</span><span class="id"> x</span><span class="id"> =</span><span class="id"> 0</span>)<span class="id"> -&gt;</span><span class="id"> \int_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> f</span><span class="id"> x</span><span class="id"> =</span><span class="id"> 0</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> f0;</span><span class="id"> under</span><span class="id"> eq_integral;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> /[1!inE]</span><span class="id"> /f0</span><span class="id"> -&gt;;</span><span class="id"> over</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> integral0</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> integral_ge0</span><span class="id"> D</span><span class="id"> f</span><span class="id"> :</span> (<span class="gallina-kwd">forall</span><span class="id"> x,</span><span class="id"> D</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> f</span><span class="id"> x</span>)<span class="id"> -&gt;</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> \int_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> f</span><span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> f0;</span><span class="id"> rewrite</span><span class="id"> ge0_integralE//</span><span class="id"> nnintegral_ge0//</span><span class="id"> =&gt;</span><span class="id"> x</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /patch;</span><span class="id"> case:</span><span class="id"> ifP;</span><span class="id"> rewrite</span><span class="id"> //</span><span class="id"> inE</span><span class="id"> =&gt;</span><span class="id"> /f0-&gt;</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> integral_nnsfun</span><span class="id"> D</span> (<span class="id">mD</span><span class="id"> :</span><span class="id"> measurable</span><span class="id"> D</span>) (<span class="id">h</span><span class="id"> :</span><span class="id"> {nnsfun</span><span class="id"> T</span><span class="id"> &gt;-&gt;</span><span class="id"> R}</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">\int_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>) (<span class="id">h</span><span class="id"> x</span>)<span class="id">%:E</span><span class="id"> =</span><span class="id"> sintegral</span><span class="id"> mu</span> (<span class="id">h</span><span class="id"> \_</span><span class="id"> D</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> mrestrict</span><span class="id"> -nnintegral_nnsfun//</span><span class="id"> -mrestrict</span><span class="id"> ge0_integralE</span><span class="id"> ?comp_patch//</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> Dx</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> lee_fin;</span><span class="id"> exact:</span><span class="id"> fun_ge0</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> integral</span>.<br/>
<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;\int [ mu ]_ ( x 'in' D ) f&quot;</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;(<span class="id">integral</span><span class="id"> mu</span><span class="id"> D</span> (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> f</span>))<span class="id"> :</span><span class="id"> ereal_scope</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;\int [ mu ]_ x f&quot;</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;((<span class="id">integral</span><span class="id"> mu</span><span class="id"> setT</span> (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> f</span>)))<span class="id">%E</span><span class="id"> :</span><span class="id"> ereal_scope</span>.<br/>
<span class="vernacular">Arguments</span><span class="id"> eq_integral</span><span class="id"> {d</span><span class="id"> T</span><span class="id"> R</span><span class="id"> mu</span><span class="id"> D}</span><span class="id"> g</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> eq_measure_integral</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<span class="vernacular">Context</span><span class="id"> d</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>) (<span class="id">D</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T</span>).<br/>
<span class="vernacular">Implicit</span><span class="id"> Types</span><span class="id"> m</span><span class="id"> :</span><span class="id"> {measure</span><span class="id"> set</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R}</span>.<br/>
<br/>
<span class="vernacular">Import</span><span class="id"> HBNNSimple</span>.<br/>
<br/>
<span class="vernacular">Let</span><span class="id"> eq_measure_integral0</span><span class="id"> m2</span><span class="id"> m1</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">forall</span><span class="id"> A,</span><span class="id"> measurable</span><span class="id"> A</span><span class="id"> -&gt;</span><span class="id"> A</span><span class="id"> `&lt;=`</span><span class="id"> D</span><span class="id"> -&gt;</span><span class="id"> m1</span><span class="id"> A</span><span class="id"> =</span><span class="id"> m2</span><span class="id"> A</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">[set</span><span class="id"> sintegral</span><span class="id"> m1</span><span class="id"> h</span><span class="id"> |</span><span class="id"> h</span><span class="gallina-kwd"> in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">[set</span><span class="id"> h</span><span class="id"> :</span><span class="id"> {nnsfun</span><span class="id"> T</span><span class="id"> &gt;-&gt;</span><span class="id"> R}</span><span class="id"> |</span> (<span class="gallina-kwd">forall</span><span class="id"> x,</span> (<span class="id">h</span><span class="id"> x</span>)<span class="id">%:E</span><span class="id"> &lt;=</span> (<span class="id">f</span><span class="id"> \_</span><span class="id"> D</span>)<span class="id"> x</span>)<span class="id">]]</span><span class="id"> `&lt;=`</span><br/>
&nbsp;&nbsp;<span class="id">[set</span><span class="id"> sintegral</span><span class="id"> m2</span><span class="id"> h</span><span class="id"> |</span><span class="id"> h</span><span class="gallina-kwd"> in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">[set</span><span class="id"> h</span><span class="id"> :</span><span class="id"> {nnsfun</span><span class="id"> T</span><span class="id"> &gt;-&gt;</span><span class="id"> R}</span><span class="id"> |</span> (<span class="gallina-kwd">forall</span><span class="id"> x,</span> (<span class="id">h</span><span class="id"> x</span>)<span class="id">%:E</span><span class="id"> &lt;=</span> (<span class="id">f</span><span class="id"> \_</span><span class="id"> D</span>)<span class="id"> x</span>)<span class="id">]]</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> m12</span><span class="id"> _</span><span class="id"> [h</span><span class="id"> hfD</span><span class="id"> &lt;-]</span><span class="id"> /=;</span><span class="gallina-kwd"> exists</span><span class="id"> h</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> apply:</span><span class="id"> eq_fsbigr</span><span class="id"> =&gt;</span><span class="id"> r</span><span class="id"> _</span>.<br/>
<span class="id">have</span><span class="id"> [hrD|hrD]</span><span class="id"> :=</span><span class="id"> pselect</span> (<span class="id">h</span><span class="id"> @^-1`</span><span class="id"> [set</span><span class="id"> r]</span><span class="id"> `&lt;=`</span><span class="id"> D</span>)<span class="id">;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> m12</span>.<br/>
<span class="id">suff</span><span class="id"> :</span><span class="id"> r</span><span class="id"> =</span><span class="id"> 0%R</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> -&gt;;</span><span class="id"> rewrite</span><span class="id"> !mul0e</span>.<br/>
<span class="id">apply:</span><span class="id"> contra_notP</span><span class="id"> hrD</span><span class="id"> =&gt;</span><span class="id"> /eqP</span><span class="id"> r0</span><span class="id"> t/=</span><span class="id"> htr</span>.<br/>
<span class="id">have</span><span class="id"> :=</span><span class="id"> hfD</span><span class="id"> t</span>.<br/>
<span class="id">rewrite</span><span class="id"> /patch/=;</span><span class="id"> case:</span><span class="id"> ifPn;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> inE</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> tD</span>.<br/>
<span class="id">move:</span><span class="id"> r0;</span><span class="id"> rewrite</span><span class="id"> -htr</span><span class="id"> =&gt;</span><span class="id"> ht0</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> le_eqVlt</span><span class="id"> eqe</span> (<span class="id">negbTE</span><span class="id"> ht0</span>)<span class="id">/=</span><span class="id"> lte_fin//</span><span class="id"> ltNge//</span><span class="id"> fun_ge0</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> eq_measure_integral</span><span class="id"> m2</span><span class="id"> m1</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="gallina-kwd">forall</span><span class="id"> A,</span><span class="id"> measurable</span><span class="id"> A</span><span class="id"> -&gt;</span><span class="id"> A</span><span class="id"> `&lt;=`</span><span class="id"> D</span><span class="id"> -&gt;</span><span class="id"> m1</span><span class="id"> A</span><span class="id"> =</span><span class="id"> m2</span><span class="id"> A</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">\int[m1]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> f</span><span class="id"> x</span><span class="id"> =</span><span class="id"> \int[m2]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> f</span><span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> m12;</span><span class="id"> rewrite</span><span class="id"> /integral</span><span class="id"> funepos_restrict</span><span class="id"> funeneg_restrict</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> congr</span> (<span class="id">ereal_sup</span><span class="id"> _</span><span class="id"> -</span><span class="id"> ereal_sup</span><span class="id"> _</span>)<span class="id">%E;</span><span class="id"> rewrite</span><span class="id"> eqEsubset;</span><span class="id"> split;</span><br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> eq_measure_integral0</span><span class="id"> =&gt;</span><span class="id"> A</span><span class="id"> /m12</span><span class="id"> //</span><span class="id"> /[apply]</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> eq_measure_integral</span>.<br/>
<span class="vernacular">Arguments</span><span class="id"> eq_measure_integral</span><span class="id"> {d</span><span class="id"> T</span><span class="id"> R</span><span class="id"> D}</span><span class="id"> m2</span><span class="id"> {m1</span><span class="id"> f}</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> integral_measure_zero</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<span class="vernacular">Context</span><span class="id"> d</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>).<br/>
<br/>
<span class="vernacular">Let</span><span class="id"> sintegral_measure_zero</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> R</span>)<span class="id"> :</span><span class="id"> sintegral</span><span class="id"> mzero</span><span class="id"> f</span><span class="id"> =</span><span class="id"> 0</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> sintegralE</span><span class="id"> big1//</span><span class="id"> =&gt;</span><span class="id"> r</span><span class="id"> _</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> /mzero</span><span class="id"> mule0</span>. Qed.</div></details>
<br/>
<span class="vernacular">Import</span><span class="id"> HBNNSimple</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> integral_measure_zero</span> (<span class="id">D</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">\int[mzero]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> f</span><span class="id"> x</span><span class="id"> =</span><span class="id"> 0</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">have</span><span class="id"> h</span><span class="id"> g</span><span class="id"> :</span> (<span class="gallina-kwd">forall</span><span class="id"> x,</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> g</span><span class="id"> x</span>)<span class="id"> -&gt;</span><span class="id"> [set</span><span class="id"> sintegral</span><span class="id"> mzero</span><span class="id"> h</span><span class="id"> |</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">h</span><span class="gallina-kwd"> in</span><span class="id"> [set</span><span class="id"> h</span><span class="id"> :</span><span class="id"> {nnsfun</span><span class="id"> T</span><span class="id"> &gt;-&gt;</span><span class="id"> R}</span><span class="id"> |</span><span class="gallina-kwd"> forall</span><span class="id"> x,</span> (<span class="id">h</span><span class="id"> x</span>)<span class="id">%:E</span><span class="id"> &lt;=</span><span class="id"> g</span><span class="id"> x]]</span><span class="id"> =</span><span class="id"> [set</span><span class="id"> 0]</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> g0;</span><span class="id"> apply/seteqP;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> [_</span><span class="id"> [h/=</span><span class="id"> Dt</span><span class="id"> &lt;-]|x</span><span class="id"> -&gt;</span><span class="id"> /=]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> sintegral_measure_zero</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="gallina-kwd"> exists</span> (<span class="id">cst_nnsfun</span><span class="id"> _</span> (<span class="id">@NngNum</span><span class="id"> _</span><span class="id"> 0</span> (<span class="id">lexx</span><span class="id"> _</span>))).<br/>
<span class="id">rewrite</span><span class="id"> integralE</span><span class="id"> !ge0_integralE//=</span><span class="id"> h</span><span class="id"> ?ereal_sup1;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> r;</span><span class="id"> rewrite</span><span class="id"> erestrict_ge0</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> h</span><span class="id"> ?ereal_sup1</span><span class="id"> ?subee//</span><span class="id"> =&gt;</span><span class="id"> r;</span><span class="id"> rewrite</span><span class="id"> erestrict_ge0</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> integral_measure_zero</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> domain_change</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<span class="vernacular">Context</span><span class="id"> d</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>).<br/>
<span class="vernacular">Variable</span><span class="id"> mu</span><span class="id"> :</span><span class="id"> {measure</span><span class="id"> set</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R}</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> integral_mkcond</span><span class="id"> D</span><span class="id"> f</span><span class="id"> :</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> f</span><span class="id"> x</span><span class="id"> =</span><span class="id"> \int[mu]_x</span> (<span class="id">f</span><span class="id"> \_</span><span class="id"> D</span>)<span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> /integral</span><span class="id"> patch_setT</span>. Qed.</div></details>
<br/>
<span class="vernacular">Import</span><span class="id"> HBNNSimple</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> integralT_nnsfun</span> (<span class="id">h</span><span class="id"> :</span><span class="id"> {nnsfun</span><span class="id"> T</span><span class="id"> &gt;-&gt;</span><span class="id"> R}</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">\int[mu]_x</span> (<span class="id">h</span><span class="id"> x</span>)<span class="id">%:E</span><span class="id"> =</span><span class="id"> sintegral</span><span class="id"> mu</span><span class="id"> h</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> integral_nnsfun//</span><span class="id"> patch_setT</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> integral_mkcondr</span><span class="id"> D</span><span class="id"> P</span><span class="id"> f</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span><span class="id"> `&amp;`</span><span class="id"> P</span>)<span class="id"> f</span><span class="id"> x</span><span class="id"> =</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>) (<span class="id">f</span><span class="id"> \_</span><span class="id"> P</span>)<span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> integral_mkcond</span><span class="id"> [RHS]integral_mkcond</span><span class="id"> patch_setI</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> integral_mkcondl</span><span class="id"> D</span><span class="id"> P</span><span class="id"> f</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> P</span><span class="id"> `&amp;`</span><span class="id"> D</span>)<span class="id"> f</span><span class="id"> x</span><span class="id"> =</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>) (<span class="id">f</span><span class="id"> \_</span><span class="id"> P</span>)<span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> setIC</span><span class="id"> integral_mkcondr</span>. Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> domain_change</span>.<br/>
<span class="vernacular">Arguments</span><span class="id"> integral_mkcond</span><span class="id"> {d</span><span class="id"> T</span><span class="id"> R</span><span class="id"> mu}</span><span class="id"> D</span><span class="id"> f</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> integral_set0</span><span class="id"> d</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">mu</span><span class="id"> :</span><span class="id"> {measure</span><span class="id"> set</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R}</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;(<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> set0</span>)<span class="id"> f</span><span class="id"> x</span><span class="id"> =</span><span class="id"> 0</span>)<span class="id">%E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> integral_mkcond</span><span class="id"> integral0_eq//</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> _</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /restrict;</span><span class="id"> case:</span><span class="id"> ifPn</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> rewrite</span><span class="id"> in_set0</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Section</span><span class="id"> nondecreasing_integral_limit</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<span class="vernacular">Context</span><span class="id"> d</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>).<br/>
<span class="vernacular">Variables</span> (<span class="id">mu</span><span class="id"> :</span><span class="id"> {measure</span><span class="id"> set</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R}</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">g</span><span class="id"> :</span><span class="id"> {nnsfun</span><span class="id"> T</span><span class="id"> &gt;-&gt;</span><span class="id"> R}^nat</span>).<br/>
<span class="vernacular">Hypothesis</span><span class="id"> f0</span><span class="id"> :</span><span class="gallina-kwd"> forall</span><span class="id"> x,</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> f</span><span class="id"> x</span>.<br/>
<span class="vernacular">Hypothesis</span><span class="id"> mf</span><span class="id"> :</span><span class="id"> measurable_fun</span><span class="id"> setT</span><span class="id"> f</span>.<br/>
<br/>
<span class="vernacular">Import</span><span class="id"> HBNNSimple</span>.<br/>
<br/>
<span class="vernacular">Hypothesis</span><span class="id"> nd_g</span><span class="id"> :</span><span class="gallina-kwd"> forall</span><span class="id"> x,</span><span class="id"> nondecreasing_seq</span> (<span class="id">g^~x</span>).<br/>
<span class="vernacular">Hypothesis</span><span class="id"> gf</span><span class="id"> :</span><span class="gallina-kwd"> forall</span><span class="id"> x,</span><span class="id"> EFin</span><span class="id"> \o</span><span class="id"> g^~</span><span class="id"> x</span><span class="id"> @</span><span class="id"> \oo</span><span class="id"> --&gt;</span><span class="id"> f</span><span class="id"> x</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> nd_ge0_integral_lim</span><span class="id"> :</span><span class="id"> \int[mu]_x</span><span class="id"> f</span><span class="id"> x</span><span class="id"> =</span><span class="id"> limn</span> (<span class="id">sintegral</span><span class="id"> mu</span><span class="id"> \o</span><span class="id"> g</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> ge0_integralTE//</span>.<br/>
<span class="id">apply/eqP;</span><span class="id"> rewrite</span><span class="id"> eq_le;</span><span class="id"> apply/andP;</span><span class="id"> split;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> lime_le;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> is_cvg_sintegral</span>.<br/>
&nbsp;&nbsp;<span class="id">near=&gt;</span><span class="id"> n;</span><span class="id"> apply:</span><span class="id"> ereal_sup_ubound;</span><span class="gallina-kwd"> exists</span> (<span class="id">g</span><span class="id"> n</span>)<span class="id"> =&gt;</span><span class="id"> //=</span><span class="id"> =&gt;</span><span class="id"> x</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> &lt;-</span><span class="id"> :</span><span class="id"> limn</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> g</span><span class="id"> ^~</span><span class="id"> x</span>)<span class="id"> =</span><span class="id"> f</span><span class="id"> x</span><span class="gallina-kwd"> by</span><span class="id"> apply/cvg_lim</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> gf</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> :</span><span class="id"> EFin</span><span class="id"> \o</span><span class="id"> g</span><span class="id"> ^~</span><span class="id"> x</span><span class="id"> @</span><span class="id"> \oo</span><span class="id"> --&gt;</span><span class="id"> ereal_sup</span> (<span class="id">range</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> g</span><span class="id"> ^~</span><span class="id"> x</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> ereal_nondecreasing_cvgn</span><span class="id"> =&gt;</span><span class="id"> p</span><span class="id"> q</span><span class="id"> pq</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> lee_fin;</span><span class="id"> exact/nd_g</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move/cvg_lim</span><span class="id"> =&gt;</span><span class="id"> -&gt;</span><span class="id"> //;</span><span class="id"> apply:</span><span class="id"> ereal_sup_ubound;</span><span class="gallina-kwd"> exists</span><span class="id"> n</span>.<br/>
<span class="id">have</span><span class="id"> :=</span><span class="id"> leey</span> (<span class="id">\int[mu]_x</span> (<span class="id">f</span><span class="id"> x</span>)).<br/>
<span class="id">rewrite</span><span class="id"> [in</span><span class="id"> X</span><span class="gallina-kwd"> in</span><span class="id"> X</span><span class="id"> -&gt;</span><span class="id"> _]le_eqVlt</span><span class="id"> =&gt;</span><span class="id"> /predU1P[|]</span><span class="id"> mufoo;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> :</span><span class="id"> \int[mu]_x</span> (<span class="id">f</span><span class="id"> x</span>)<span class="id"> \is</span><span class="id"> a</span><span class="id"> fin_num</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> ge0_fin_numE//</span><span class="id"> integral_ge0</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> ge0_integralTE//</span><span class="id"> =&gt;</span><span class="id"> /ub_ereal_sup_adherent</span><span class="id"> h</span>.<br/>
&nbsp;&nbsp;<span class="id">apply/lee_addgt0Pr</span><span class="id"> =&gt;</span><span class="id"> _/posnumP[e]</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> {h}</span><span class="id"> [/=</span><span class="id"> _</span><span class="id"> [G</span><span class="id"> Gf</span><span class="id"> &lt;-]]</span><span class="id"> :=</span><span class="id"> h</span><span class="id"> _</span><span class="id"> [gt0</span><span class="id"> of</span><span class="id"> e%:num]</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> EFinN</span><span class="id"> lteBlDr//</span><span class="id"> =&gt;</span><span class="id"> fGe</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> :</span><span class="gallina-kwd"> forall</span><span class="id"> x,</span><span class="id"> cvgn</span> (<span class="id">g^~</span><span class="id"> x</span>)<span class="id"> -&gt;</span> (<span class="id">G</span><span class="id"> x</span><span class="id"> &lt;=</span><span class="id"> limn</span> (<span class="id">g</span><span class="id"> ^~</span><span class="id"> x</span>))<span class="id">%R</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> x</span><span class="id"> cg;</span><span class="id"> rewrite</span><span class="id"> -lee_fin</span><span class="id"> -</span>(<span class="id">EFin_lim</span><span class="id"> cg</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> have</span><span class="id"> /cvg_lim</span><span class="id"> gxfx</span><span class="id"> :=</span><span class="id"> @gf</span><span class="id"> x;</span><span class="id"> rewrite</span> (<span class="id">le_trans</span> (<span class="id">Gf</span><span class="id"> _</span>))<span class="id">//</span><span class="id"> gxfx</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> /</span>(<span class="id">nd_sintegral_lim_lemma</span><span class="id"> mu</span><span class="id"> nd_g</span>)<span class="id">/</span>(<span class="id">leeD2r</span><span class="id"> e%:num%:E</span>).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> le_trans;</span><span class="id"> exact:</span><span class="id"> ltW</span>.<br/>
<span class="id">suff</span><span class="id"> :</span><span class="id"> limn</span> (<span class="id">sintegral</span><span class="id"> mu</span><span class="id"> \o</span><span class="id"> g</span>)<span class="id"> =</span><span class="id"> +oo</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> -&gt;;</span><span class="id"> rewrite</span><span class="id"> -ge0_integralTE//</span><span class="id"> mufoo</span>.<br/>
<span class="id">apply/eqyP</span><span class="id"> =&gt;</span><span class="id"> r</span><span class="id"> r0</span>.<br/>
<span class="id">have</span><span class="id"> [G</span><span class="id"> [Gf</span><span class="id"> rG]]</span><span class="id"> :</span><span class="gallina-kwd"> exists</span><span class="id"> h</span><span class="id"> :</span><span class="id"> {nnsfun</span><span class="id"> T</span><span class="id"> &gt;-&gt;</span><span class="id"> R},</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="gallina-kwd">forall</span><span class="id"> x,</span> (<span class="id">h</span><span class="id"> x</span>)<span class="id">%:E</span><span class="id"> &lt;=</span><span class="id"> f</span><span class="id"> x</span>)<span class="id"> /\</span> (<span class="id">r%:E</span><span class="id"> &lt;=</span><span class="id"> sintegral</span><span class="id"> mu</span><span class="id"> h</span>).<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> :</span><span class="id"> r%:E</span><span class="id"> &lt;</span><span class="id"> \int[mu]_x</span> (<span class="id">f</span><span class="id"> x</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">move:</span> (<span class="id">mufoo</span>)<span class="id"> =&gt;</span><span class="id"> /eqyP/</span>(_<span class="id"> _</span> (<span class="id">addr_gt0</span><span class="id"> r0</span><span class="id"> r0</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> lt_le_trans</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> rewrite</span><span class="id"> lte_fin</span><span class="id"> ltrDr</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> ge0_integralTE//</span><span class="id"> =&gt;</span><span class="id"> /ereal_sup_gt[x</span><span class="id"> [/=</span><span class="id"> G</span><span class="id"> Gf</span><span class="id"> Gx</span><span class="id"> rx]]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="gallina-kwd"> exists</span><span class="id"> G;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> rewrite</span> (<span class="id">le_trans</span> (<span class="id">ltW</span><span class="id"> rx</span>))<span class="id"> //</span><span class="id"> Gx</span>.<br/>
<span class="id">have</span><span class="id"> :</span><span class="gallina-kwd"> forall</span><span class="id"> x,</span><span class="id"> cvgn</span> (<span class="id">g^~</span><span class="id"> x</span>)<span class="id"> -&gt;</span> (<span class="id">G</span><span class="id"> x</span><span class="id"> &lt;=</span><span class="id"> limn</span> (<span class="id">g^~</span><span class="id"> x</span>))<span class="id">%R</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> x</span><span class="id"> cg;</span><span class="id"> rewrite</span><span class="id"> -lee_fin</span><span class="id"> -</span>(<span class="id">EFin_lim</span><span class="id"> cg</span>).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> have</span><span class="id"> /cvg_lim</span><span class="id"> gxfx</span><span class="id"> :=</span><span class="id"> @gf</span><span class="id"> x;</span><span class="id"> rewrite</span> (<span class="id">le_trans</span> (<span class="id">Gf</span><span class="id"> _</span>))<span class="id"> //</span><span class="id"> gxfx</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> move/</span>(<span class="id">nd_sintegral_lim_lemma</span><span class="id"> mu</span><span class="id"> nd_g</span>)<span class="id"> =&gt;</span><span class="id"> Gg;</span><span class="id"> rewrite</span> (<span class="id">le_trans</span><span class="id"> rG</span>).<br/>
<span class="id">Unshelve</span>.<span class="id"> all:</span><span class="gallina-kwd"> by</span><span class="id"> end_near</span>. Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> nondecreasing_integral_limit</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> dyadic_interval</span>.<br/>
<span class="vernacular">Variable</span><span class="id"> R</span><span class="id"> :</span><span class="id"> realType</span>.<br/>
<br/>
<span class="vernacular">Definition</span><span class="id"> dyadic_itv</span><span class="id"> n</span><span class="id"> k</span><span class="id"> :</span><span class="id"> interval</span><span class="id"> R</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">`[</span>(<span class="id">k%:R</span><span class="id"> *</span><span class="id"> 2</span><span class="id"> ^-</span><span class="id"> n</span>)<span class="id">,</span> (<span class="id">k</span>.<span class="id">+1%:R</span><span class="id"> *</span><span class="id"> 2</span><span class="id"> ^-</span><span class="id"> n</span>)<span class="id">[</span>.<br/>
<br/>
<span class="vernacular">Local</span><span class="vernacular"> Notation</span><span class="id"> I</span><span class="id"> :=</span><span class="id"> dyadic_itv</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> dyadic_itv_subU</span><span class="id"> n</span><span class="id"> k</span><span class="id"> :</span><span class="id"> [set`</span><span class="id"> I</span><span class="id"> n</span><span class="id"> k]</span><span class="id"> `&lt;=`</span><br/>
&nbsp;&nbsp;<span class="id">[set`</span><span class="id"> I</span><span class="id"> n</span>.<span class="id">+1</span><span class="id"> k</span>.<span class="id">*2]</span><span class="id"> `|`</span><span class="id"> [set`</span><span class="id"> I</span><span class="id"> n</span>.<span class="id">+1</span><span class="id"> k</span>.<span class="id">*2</span>.<span class="id">+1]</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> r</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> in_itv</span><span class="id"> /=</span><span class="id"> =&gt;</span><span class="id"> /andP[Ir</span><span class="id"> rI]</span>.<br/>
<span class="id">have</span><span class="id"> [rk|rk]</span><span class="id"> :=</span><span class="id"> ltP</span><span class="id"> r</span> (<span class="id">k</span>.<span class="id">*2</span>.<span class="id">+1%:R</span><span class="id"> *</span> (<span class="id">2%:R</span><span class="id"> ^-</span><span class="id"> n</span>.<span class="id">+1</span>))<span class="id">;</span><span class="id"> [left|right]</span>.<br/>
<span class="id">-</span><span class="id"> rewrite</span><span class="id"> in_itv</span><span class="id"> /=</span><span class="id"> rk</span><span class="id"> andbT</span> (<span class="id">le_trans</span><span class="id"> _</span><span class="id"> Ir</span>)<span class="id">//</span><span class="id"> -muln2</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> natrM</span><span class="id"> exprS</span><span class="id"> invrM</span><span class="id"> ?unitfE//</span><span class="id"> ?expf_neq0//</span><span class="id"> -mulrA</span> (<span class="id">mulrCA</span><span class="id"> 2</span>).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> divrr</span><span class="id"> ?unitfE//</span><span class="id"> mulr1</span>.<br/>
<span class="id">-</span><span class="id"> rewrite</span><span class="id"> in_itv</span><span class="id"> /=</span><span class="id"> rk</span><span class="id"> /=</span> (<span class="id">lt_le_trans</span><span class="id"> rI</span>)<span class="id">//</span><span class="id"> -doubleS</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -muln2</span><span class="id"> natrM</span><span class="id"> exprS</span><span class="id"> invrM</span><span class="id"> ?unitfE//</span><span class="id"> ?expf_neq0//</span><span class="id"> -mulrA</span> (<span class="id">mulrCA</span><span class="id"> 2</span>).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> divrr</span><span class="id"> ?unitfE//</span><span class="id"> mulr1</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> bigsetU_dyadic_itv</span><span class="id"> n</span><span class="id"> :</span><span class="id"> `[n%:R,</span><span class="id"> n</span>.<span class="id">+1%:R[%classic</span><span class="id"> =</span><br/>
&nbsp;&nbsp;<span class="id">\big[setU/set0]_</span>(<span class="id">n</span><span class="id"> *</span><span class="id"> 2</span><span class="id"> ^</span><span class="id"> n</span>.<span class="id">+1</span><span class="id"> &lt;=</span><span class="id"> k</span><span class="id"> &lt;</span><span class="id"> n</span>.<span class="id">+1</span><span class="id"> *</span><span class="id"> 2</span><span class="id"> ^</span><span class="id"> n</span>.<span class="id">+1</span>)<span class="id"> [set`</span><span class="id"> I</span><span class="id"> n</span>.<span class="id">+1</span><span class="id"> k]</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> predeqE</span><span class="id"> =&gt;</span><span class="id"> r;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> [/=</span><span class="id"> /[!in_itv]/=</span><span class="id"> /andP[nr</span><span class="id"> rn1]|];</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -bigcup_seq</span><span class="id"> =&gt;</span><span class="id"> -[/=</span><span class="id"> k]</span><span class="id"> /[!mem_index_iota]</span><span class="id"> /andP[nk</span><span class="id"> kn]</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> !in_itv</span><span class="id"> /=</span><span class="id"> =&gt;</span><span class="id"> /andP[knr</span><span class="id"> rkn];</span><span class="id"> apply/andP;</span><span class="id"> split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span> (<span class="id">le_trans</span><span class="id"> _</span><span class="id"> knr</span>)<span class="id">//</span><span class="id"> ler_pdivlMr//</span><span class="id"> -natrX</span><span class="id"> -natrM</span><span class="id"> ler_nat</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span> (<span class="id">lt_le_trans</span><span class="id"> rkn</span>)<span class="id">//</span><span class="id"> ler_pdivrMr//</span><span class="id"> -natrX</span><span class="id"> -natrM</span><span class="id"> ler_nat</span>.<br/>
<span class="id">rewrite</span><span class="id"> -bigcup_seq</span><span class="id"> /=;</span><span class="gallina-kwd"> exists</span><span class="id"> `|floor</span> (<span class="id">r</span><span class="id"> *</span><span class="id"> 2</span><span class="id"> ^+</span><span class="id"> n</span>.<span class="id">+1</span>)<span class="id">|%N</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> /=</span><span class="id"> mem_index_iota</span><span class="id"> -ltz_nat</span><span class="id"> -lez_nat</span><span class="id"> gez0_abs;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> floor_ge0</span><span class="id"> mulr_ge0//</span> (<span class="id">le_trans</span><span class="id"> _</span><span class="id"> nr</span>).<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -floor_ge_int</span><span class="id"> -floor_lt_int</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> !PoszM</span><span class="id"> -!natrXE</span><span class="id"> !rmorphM</span><span class="id"> !rmorphXn</span><span class="id"> /=</span><span class="id"> ler_wpM2r</span><span class="id"> ?ltr_pM2r</span>.<br/>
<span class="id">rewrite</span><span class="id"> /=</span><span class="id"> in_itv</span><span class="id"> /=</span><span class="id"> ler_pdivrMr//</span><span class="id"> ltr_pdivlMr//</span>.<br/>
<span class="id">rewrite</span><span class="id"> pmulrn</span><span class="id"> [</span>(<span class="id">`|_|</span>.<span class="id">+1%:R</span>)<span class="id">]pmulrn</span><span class="id"> intS</span><span class="id"> addrC</span><span class="id"> gez0_abs;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> floor_ge0</span><span class="id"> mulr_ge0</span><span class="id"> ?exprn_ge0</span><span class="id"> //</span> (<span class="id">le_trans</span><span class="id"> _</span><span class="id"> nr</span>).<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> ge_floor</span><span class="id"> lt_succ_floor</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> dyadic_itv_image</span><span class="id"> n</span><span class="id"> T</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id"> x</span><span class="id"> :</span><br/>
&nbsp;&nbsp;(<span class="id">n%:R%:E</span><span class="id"> &lt;=</span><span class="id"> f</span><span class="id"> x</span><span class="id"> &lt;</span><span class="id"> n</span>.<span class="id">+1%:R%:E</span>)<span class="id">%E</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">exists</span><span class="id"> k,</span> (<span class="id">2</span><span class="id"> ^</span><span class="id"> n</span>.<span class="id">+1</span><span class="id"> *</span><span class="id"> n</span><span class="id"> &lt;=</span><span class="id"> k</span><span class="id"> &lt;</span><span class="id"> 2</span><span class="id"> ^</span><span class="id"> n</span>.<span class="id">+1</span><span class="id"> *</span><span class="id"> n</span>.<span class="id">+1</span>)<span class="id">%N</span><span class="id"> /\</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">f</span><span class="id"> x</span><span class="id"> \in</span><span class="id"> EFin</span><span class="id"> @`</span><span class="id"> [set`</span><span class="id"> I</span><span class="id"> n</span>.<span class="id">+1</span><span class="id"> k]</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> fxn;</span><span class="id"> have</span><span class="id"> fxfin</span><span class="id"> :</span><span class="id"> f</span><span class="id"> x</span><span class="id"> \is</span><span class="id"> a</span><span class="id"> fin_num</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> fin_numE;</span><span class="id"> move:</span><span class="id"> fxn;</span><span class="id"> case:</span> (<span class="id">f</span><span class="id"> x</span>)<span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> /andP[]</span>.<br/>
<span class="id">have</span><span class="id"> :</span><span class="id"> f</span><span class="id"> x</span><span class="id"> \in</span><span class="id"> EFin</span><span class="id"> @`</span><span class="id"> `[n%:R,</span><span class="id"> n</span>.<span class="id">+1%:R[%classic</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> inE</span><span class="id"> /=;</span><span class="gallina-kwd"> exists</span> (<span class="id">fine</span> (<span class="id">f</span><span class="id"> x</span>))<span class="id">;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> fineK</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> in_itv</span><span class="id"> /=</span><span class="id"> -lee_fin</span><span class="id"> -lte_fin</span> (<span class="id">fineK</span><span class="id"> fxfin</span>).<br/>
<span class="id">rewrite</span> (<span class="id">bigsetU_dyadic_itv</span><span class="id"> n</span>)<span class="id"> inE</span><span class="id"> /=</span><span class="id"> =&gt;</span><span class="id"> -[r];</span><span class="id"> rewrite</span><span class="id"> -bigcup_seq</span><span class="id"> =&gt;</span><span class="id"> -[k</span><span class="id"> /=]</span>.<br/>
<span class="id">rewrite</span><span class="id"> mem_index_iota</span><span class="id"> =&gt;</span><span class="id"> nk</span><span class="id"> Ir</span><span class="id"> rfx</span>.<br/>
<span class="gallina-kwd">by</span><span class="gallina-kwd"> exists</span><span class="id"> k;</span><span class="id"> split;</span><span class="id"> [rewrite</span><span class="id"> !</span>(<span class="id">mulnC</span> (<span class="id">2</span><span class="id"> ^</span><span class="id"> n</span>.<span class="id">+1</span>)<span class="id">%N</span>)<span class="id">|rewrite</span><span class="id"> !inE</span><span class="id"> /=;</span><span class="gallina-kwd"> exists</span><span class="id"> r]</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> dyadic_interval</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> approximation</span>.<br/>
<span class="vernacular">Context</span><span class="id"> d</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>).<br/>
<span class="vernacular">Variables</span> (<span class="id">D</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T</span>) (<span class="id">mD</span><span class="id"> :</span><span class="id"> measurable</span><span class="id"> D</span>).<br/>
<span class="vernacular">Variables</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>) (<span class="id">mf</span><span class="id"> :</span><span class="id"> measurable_fun</span><span class="id"> D</span><span class="id"> f</span>).<br/>
<br/>
<span class="vernacular">Local</span><span class="vernacular"> Notation</span><span class="id"> I</span><span class="id"> :=</span> (<span class="id">@dyadic_itv</span><span class="id"> R</span>).<br/>
<br/>
<span class="vernacular">Let</span><span class="id"> A</span><span class="id"> n</span><span class="id"> k</span><span class="id"> :=</span><span class="gallina-kwd"> if</span> (<span class="id">k</span><span class="id"> &lt;</span><span class="id"> n</span><span class="id"> *</span><span class="id"> 2</span><span class="id"> ^</span><span class="id"> n</span>)<span class="id">%N</span><span class="gallina-kwd"> then</span><br/>
&nbsp;&nbsp;<span class="id">D</span><span class="id"> `&amp;`</span><span class="id"> [set</span><span class="id"> x</span><span class="id"> |</span><span class="id"> f</span><span class="id"> x</span><span class="id"> \in</span><span class="id"> EFin</span><span class="id"> @`</span><span class="id"> [set`</span><span class="id"> I</span><span class="id"> n</span><span class="id"> k]]</span><span class="gallina-kwd"> else</span><span class="id"> set0</span>.<br/>
<br/>
<span class="vernacular">Let</span><span class="id"> B</span><span class="id"> n</span><span class="id"> :=</span><span class="id"> D</span><span class="id"> `&amp;`</span><span class="id"> [set</span><span class="id"> x</span><span class="id"> |</span><span class="id"> n%:R%:E</span><span class="id"> &lt;=</span><span class="id"> f</span><span class="id"> x]%E</span>.<br/>
<br/>
<span class="vernacular">Definition</span><span class="id"> approx</span><span class="id"> :</span> (<span class="id">T</span><span class="id"> -&gt;</span><span class="id"> R</span>)<span class="id">^nat</span><span class="id"> :=</span><span class="gallina-kwd"> fun</span><span class="id"> n</span><span class="id"> x</span><span class="id"> =&gt;</span><br/>
&nbsp;&nbsp;<span class="id">\sum_</span>(<span class="id">k</span><span class="id"> &lt;</span><span class="id"> n</span><span class="id"> *</span><span class="id"> 2</span><span class="id"> ^</span><span class="id"> n</span>)<span class="id"> k%:R</span><span class="id"> *</span><span class="id"> 2</span><span class="id"> ^-</span><span class="id"> n</span><span class="id"> *</span><span class="id"> \1_</span>(<span class="id">A</span><span class="id"> n</span><span class="id"> k</span>)<span class="id"> x</span><span class="id"> +</span><span class="id"> n%:R</span><span class="id"> *</span><span class="id"> \1_</span>(<span class="id">B</span><span class="id"> n</span>)<span class="id"> x</span>.<br/>
<br/>
<span class="vernacular">Let</span><span class="id"> mA</span><span class="id"> n</span><span class="id"> k</span><span class="id"> :</span><span class="id"> measurable</span> (<span class="id">A</span><span class="id"> n</span><span class="id"> k</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> /A;</span><span class="id"> case:</span><span class="id"> ifPn</span><span class="id"> =&gt;</span><span class="id"> [kn|_]//;</span><span class="id"> rewrite</span><span class="id"> -preimage_comp</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> mf</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> apply/measurable_image_EFin;</span><span class="id"> exact:</span><span class="id"> measurable_itv</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Let</span><span class="id"> trivIsetA</span><span class="id"> n</span><span class="id"> :</span><span class="id"> trivIset</span><span class="id"> setT</span> (<span class="id">A</span><span class="id"> n</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">apply/trivIsetP</span><span class="id"> =&gt;</span><span class="id"> i</span><span class="id"> j</span><span class="id"> _</span><span class="id"> _</span>.<br/>
<span class="id">wlog</span><span class="id"> :</span><span class="id"> i</span><span class="id"> j</span><span class="id"> /</span> (<span class="id">i</span><span class="id"> &lt;</span><span class="id"> j</span>)<span class="id">%N</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> h;</span><span class="id"> rewrite</span><span class="id"> neq_lt</span><span class="id"> =&gt;</span><span class="id"> /orP[ij|ji]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> h</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> rewrite</span><span class="id"> lt_eqF</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> setIC;</span><span class="id"> apply:</span><span class="id"> h</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> rewrite</span><span class="id"> lt_eqF</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> ij</span><span class="id"> _</span>.<br/>
<span class="id">rewrite</span><span class="id"> /A;</span><span class="id"> case:</span><span class="id"> ifPn</span><span class="id"> =&gt;</span><span class="id"> /=</span><span class="id"> ni;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> set0I</span>.<br/>
<span class="id">case:</span><span class="id"> ifPn</span><span class="id"> =&gt;</span><span class="id"> /=</span><span class="id"> nj;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> setI0</span>.<br/>
<span class="id">rewrite</span><span class="id"> predeqE</span><span class="id"> =&gt;</span><span class="id"> t;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> -[/=]</span><span class="id"> [_]</span>.<br/>
<span class="id">rewrite</span><span class="id"> inE</span><span class="id"> =&gt;</span><span class="id"> -[r</span><span class="id"> /=];</span><span class="id"> rewrite</span><span class="id"> in_itv</span><span class="id"> /=</span><span class="id"> =&gt;</span><span class="id"> /andP[r1</span><span class="id"> r2]</span><span class="id"> rft</span><span class="id"> [_]</span>.<br/>
<span class="id">rewrite</span><span class="id"> inE</span><span class="id"> =&gt;</span><span class="id"> -[s</span><span class="id"> /=];</span><span class="id"> rewrite</span><span class="id"> in_itv</span><span class="id"> /=</span><span class="id"> =&gt;</span><span class="id"> /andP[s1</span><span class="id"> s2]</span>.<br/>
<span class="id">rewrite</span><span class="id"> -rft</span><span class="id"> =&gt;</span><span class="id"> -[sr];</span><span class="id"> rewrite</span><span class="id"> {}sr</span><span class="id"> {s}</span><span class="gallina-kwd"> in</span><span class="id"> s1</span><span class="id"> s2</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> have</span><span class="id"> :=</span><span class="id"> le_lt_trans</span><span class="id"> s1</span><span class="id"> r2;</span><span class="id"> rewrite</span><span class="id"> ltr_pM2r//</span><span class="id"> ltr_nat</span><span class="id"> ltnS</span><span class="id"> leqNgt</span><span class="id"> ij</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Let</span><span class="id"> f0_A0</span><span class="id"> n</span> (<span class="id">i</span><span class="id"> :</span><span class="id"> 'I_</span>(<span class="id">n</span><span class="id"> *</span><span class="id"> 2</span><span class="id"> ^</span><span class="id"> n</span>))<span class="id"> x</span><span class="id"> :</span><span class="id"> f</span><span class="id"> x</span><span class="id"> =</span><span class="id"> 0%:E</span><span class="id"> -&gt;</span><span class="id"> i</span><span class="id"> !=</span><span class="id"> O</span><span class="id"> :&gt;</span><span class="id"> nat</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">\1_</span>(<span class="id">A</span><span class="id"> n</span><span class="id"> i</span>)<span class="id"> x</span><span class="id"> =</span><span class="id"> 0</span><span class="id"> :&gt;</span><span class="id"> R</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> fx0</span><span class="id"> i0;</span><span class="id"> rewrite</span><span class="id"> indicE</span><span class="id"> memNset//</span><span class="id"> /A</span><span class="id"> ltn_ord</span><span class="id"> =&gt;</span><span class="id"> -[Dx/=]</span><span class="id"> /[1!inE]/=</span><span class="id"> -[r]</span>.<br/>
<span class="id">rewrite</span><span class="id"> in_itv/=</span><span class="id"> fx0</span><span class="id"> =&gt;</span><span class="id"> +</span><span class="id"> r0;</span><span class="id"> move/eqP</span><span class="id"> :</span><span class="id"> r0</span><span class="id"> =&gt;</span><span class="id"> /[1!eqe]</span><span class="id"> /eqP</span><span class="id"> -&gt;</span><span class="id"> /andP[+</span><span class="id"> _]</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> ler_pdivrMr//</span><span class="id"> mul0r</span><span class="id"> lern0</span> (<span class="id">negbTE</span><span class="id"> i0</span>).<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Let</span><span class="id"> fgen_A0</span><span class="id"> n</span><span class="id"> x</span> (<span class="id">i</span><span class="id"> :</span><span class="id"> 'I_</span>(<span class="id">n</span><span class="id"> *</span><span class="id"> 2</span><span class="id"> ^</span><span class="id"> n</span>))<span class="id"> :</span> (<span class="id">n%:R%:E</span><span class="id"> &lt;=</span><span class="id"> f</span><span class="id"> x</span>)<span class="id">%E</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">\1_</span>(<span class="id">A</span><span class="id"> n</span><span class="id"> i</span>)<span class="id"> x</span><span class="id"> =</span><span class="id"> 0</span><span class="id"> :&gt;</span><span class="id"> R</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> fxn;</span><span class="id"> rewrite</span><span class="id"> indicE</span><span class="id"> /A</span><span class="id"> ltn_ord</span><span class="id"> memNset//</span><span class="id"> =&gt;</span><span class="id"> -[Dx/=]</span><span class="id"> /[1!inE]/=</span><span class="id"> -[r]</span>.<br/>
<span class="id">rewrite</span><span class="id"> in_itv/=</span><span class="id"> =&gt;</span><span class="id"> /andP[_</span><span class="id"> h]</span><span class="id"> rfx;</span><span class="id"> move:</span><span class="id"> fxn;</span><span class="id"> rewrite</span><span class="id"> -rfx</span><span class="id"> lee_fin;</span><span class="id"> apply/negP</span>.<br/>
<span class="id">rewrite</span><span class="id"> -ltNge</span> (<span class="id">lt_le_trans</span><span class="id"> h</span>)<span class="id">//</span><span class="id"> -natrX</span><span class="id"> ler_pdivrMr//</span><span class="id"> -natrM</span><span class="id"> ler_nat</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span> (<span class="id">leq_trans</span> (<span class="id">ltn_ord</span><span class="id"> i</span>)).<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Let</span><span class="id"> disj_A0</span><span class="id"> x</span><span class="id"> n</span> (<span class="id">i</span><span class="id"> k</span><span class="id"> :</span><span class="id"> 'I_</span>(<span class="id">n</span><span class="id"> *</span><span class="id"> 2</span><span class="id"> ^</span><span class="id"> n</span>))<span class="id"> :</span><span class="id"> i</span><span class="id"> !=</span><span class="id"> k</span><span class="id"> -&gt;</span><span class="id"> x</span><span class="id"> \in</span><span class="id"> A</span><span class="id"> n</span><span class="id"> k</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">\1_</span>(<span class="id">A</span><span class="id"> n</span><span class="id"> i</span>)<span class="id"> x</span><span class="id"> =</span><span class="id"> 0</span><span class="id"> :&gt;</span><span class="id"> R</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> ik</span><span class="id"> /[1!inE]</span><span class="id"> xAn1k;</span><span class="id"> rewrite</span><span class="id"> indicE</span><span class="id"> memNset//</span><span class="id"> =&gt;</span><span class="id"> xAi</span>.<br/>
<span class="id">have</span><span class="id"> /trivIsetP/</span>(_<span class="id"> _</span><span class="id"> _</span><span class="id"> Logic</span>.<span class="id">I</span><span class="id"> Logic</span>.<span class="id">I</span><span class="id"> ik</span>)<span class="id">/=</span><span class="id"> :=</span><span class="id"> @trivIsetA</span><span class="id"> n</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> predeqE</span><span class="id"> =&gt;</span><span class="id"> /</span>(_<span class="id"> x</span>)<span class="id">[+</span><span class="id"> _];</span><span class="id"> exact</span>.<br/>
Qed.</div></details>
<span class="vernacular">Arguments</span><span class="id"> disj_A0</span><span class="id"> {x</span><span class="id"> n</span><span class="id"> i}</span><span class="id"> k</span>.<br/>
<br/>
<span class="vernacular">Let</span><span class="id"> mB</span><span class="id"> n</span><span class="id"> :</span><span class="id"> measurable</span> (<span class="id">B</span><span class="id"> n</span>)<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id"> exact:</span><span class="id"> emeasurable_fun_c_infty</span>. Qed.</div></details>
<br/>
<span class="vernacular">Let</span><span class="id"> foo_B1</span><span class="id"> x</span><span class="id"> n</span><span class="id"> :</span><span class="id"> D</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> f</span><span class="id"> x</span><span class="id"> =</span><span class="id"> +oo%E</span><span class="id"> -&gt;</span><span class="id"> \1_</span>(<span class="id">B</span><span class="id"> n</span>)<span class="id"> x</span><span class="id"> =</span><span class="id"> 1</span><span class="id"> :&gt;</span><span class="id"> R</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> Dx</span><span class="id"> fxoo;</span><span class="id"> rewrite</span><span class="id"> indicE</span><span class="id"> mem_set//</span><span class="id"> /B/=</span><span class="id"> fxoo</span><span class="id"> leey</span>. Qed.</div></details>
<br/>
<span class="vernacular">Let</span><span class="id"> f0_B0</span><span class="id"> x</span><span class="id"> n</span><span class="id"> :</span><span class="id"> f</span><span class="id"> x</span><span class="id"> =</span><span class="id"> 0%:E</span><span class="id"> -&gt;</span><span class="id"> n</span><span class="id"> !=</span><span class="id"> 0%N</span><span class="id"> -&gt;</span><span class="id"> \1_</span>(<span class="id">B</span><span class="id"> n</span>)<span class="id"> x</span><span class="id"> =</span><span class="id"> 0</span><span class="id"> :&gt;</span><span class="id"> R</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> h</span><span class="id"> /negbTE</span><span class="id"> n0;</span><span class="id"> rewrite</span><span class="id"> indicE</span><span class="id"> memNset//</span><span class="id"> /B/=</span><span class="id"> h</span><span class="id"> lee_fin</span><span class="id"> lern0</span><span class="id"> n0</span><span class="id"> =&gt;</span><span class="id"> -[]</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Let</span><span class="id"> fgtn_B0</span><span class="id"> x</span><span class="id"> n</span><span class="id"> :</span> (<span class="id">f</span><span class="id"> x</span><span class="id"> &lt;</span><span class="id"> n%:R%:E</span>)<span class="id">%E</span><span class="id"> -&gt;</span><span class="id"> \1_</span>(<span class="id">B</span><span class="id"> n</span>)<span class="id"> x</span><span class="id"> =</span><span class="id"> 0</span><span class="id"> :&gt;</span><span class="id"> R</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> h;</span><span class="id"> rewrite</span><span class="id"> indicE</span><span class="id"> memNset//</span><span class="id"> =&gt;</span><span class="id"> -[_/=];</span><span class="id"> rewrite</span><span class="id"> leNgt</span><span class="id"> h</span>. Qed.</div></details>
<br/>
<span class="vernacular">Let</span><span class="id"> f0_approx0</span><span class="id"> n</span><span class="id"> x</span><span class="id"> :</span><span class="id"> f</span><span class="id"> x</span><span class="id"> =</span><span class="id"> 0%E</span><span class="id"> -&gt;</span><span class="id"> approx</span><span class="id"> n</span><span class="id"> x</span><span class="id"> =</span><span class="id"> 0</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> fx0;</span><span class="id"> rewrite</span><span class="id"> /approx;</span><span class="id"> have</span><span class="id"> [-&gt;|n0]</span><span class="id"> :=</span><span class="id"> eqVneq</span><span class="id"> n</span><span class="id"> O</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> mul0n</span><span class="id"> mul0r</span><span class="id"> addr0</span><span class="id"> big_ord0</span>.<br/>
<span class="id">rewrite</span><span class="id"> f0_B0//</span><span class="id"> mulr0</span><span class="id"> addr0</span><span class="id"> big1//</span><span class="id"> =&gt;</span><span class="id"> i</span><span class="id"> _</span>.<br/>
<span class="id">have</span><span class="id"> [-&gt;|i0]</span><span class="id"> :=</span><span class="id"> eqVneq</span> (<span class="id">nat_of_ord</span><span class="id"> i</span>)<span class="id"> 0%N;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> mul0r</span><span class="id"> mul0r</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> f0_A0</span><span class="id"> //</span><span class="id"> mulr0</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Let</span><span class="id"> fpos_approx_neq0</span><span class="id"> x</span><span class="id"> :</span><span class="id"> D</span><span class="id"> x</span><span class="id"> -&gt;</span> (<span class="id">0%E</span><span class="id"> &lt;</span><span class="id"> f</span><span class="id"> x</span><span class="id"> &lt;</span><span class="id"> +oo</span>)<span class="id">%E</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">\forall</span><span class="id"> n</span><span class="id"> \near</span><span class="id"> \oo,</span><span class="id"> approx</span><span class="id"> n</span><span class="id"> x</span><span class="id"> !=</span><span class="id"> 0</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> Dx</span><span class="id"> /andP[fx_gt0</span><span class="id"> fxoo]</span>.<br/>
<span class="id">have</span><span class="id"> fxfin</span><span class="id"> :</span><span class="id"> f</span><span class="id"> x</span><span class="id"> \is</span><span class="id"> a</span><span class="id"> fin_num</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> gt0_fin_numE</span>.<br/>
<span class="id">rewrite</span><span class="id"> -</span>(<span class="id">fineK</span><span class="id"> fxfin</span>)<span class="id"> lte_fin</span><span class="gallina-kwd"> in</span><span class="id"> fx_gt0;</span><span class="id"> near=&gt;</span><span class="id"> n</span>.<br/>
<span class="id">rewrite</span><span class="id"> /approx</span><span class="id"> paddr_eq0//;</span><span class="id"> last</span><span class="id"> 2</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> sumr_ge0</span><span class="id"> =&gt;</span><span class="id"> i</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> mulr_ge0</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> mulr_ge0</span>.<br/>
<span class="id">rewrite</span><span class="id"> psumr_eq0//;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> i</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> mulr_ge0</span>.<br/>
<span class="id">apply/negP</span><span class="id"> =&gt;</span><span class="id"> /andP[/allP</span><span class="id"> An0];</span><span class="id"> rewrite</span><span class="id"> mulf_eq0</span><span class="id"> =&gt;</span><span class="id"> /orP[|]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply/negP;</span><span class="id"> near:</span><span class="id"> n;</span><span class="gallina-kwd"> exists</span><span class="id"> 1%N</span><span class="id"> =&gt;</span><span class="id"> //=</span><span class="id"> m</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> lt0n</span><span class="id"> pnatr_eq0</span>.<br/>
<span class="id">rewrite</span><span class="id"> pnatr_eq0</span><span class="id"> =&gt;</span><span class="id"> /eqP</span>.<br/>
<span class="id">have</span><span class="id"> [//|]</span><span class="id"> :=</span><span class="id"> boolP</span> (<span class="id">x</span><span class="id"> \in</span><span class="id"> B</span><span class="id"> n</span>).<br/>
<span class="id">rewrite</span><span class="id"> notin_setE</span><span class="id"> /B</span><span class="id"> /setI</span><span class="id"> /=</span><span class="id"> =&gt;</span><span class="id"> /not_andP[]</span><span class="id"> //</span><span class="id"> /negP</span>.<br/>
<span class="id">rewrite</span><span class="id"> -ltNge</span><span class="id"> =&gt;</span><span class="id"> fxn</span><span class="id"> _</span>.<br/>
<span class="id">have</span><span class="id"> K</span><span class="id"> :</span> (<span class="id">`|floor</span> (<span class="id">fine</span> (<span class="id">f</span><span class="id"> x</span>)<span class="id"> *</span><span class="id"> 2</span><span class="id"> ^+</span><span class="id"> n</span>)<span class="id">|</span><span class="id"> &lt;</span><span class="id"> n</span><span class="id"> *</span><span class="id"> 2</span><span class="id"> ^</span><span class="id"> n</span>)<span class="id">%N</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -ltz_nat</span><span class="id"> gez0_abs;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> floor_ge0</span><span class="id"> mulr_ge0//</span><span class="id"> ltW</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -</span>(<span class="id">@ltr_int</span><span class="id"> R</span>)<span class="id">;</span><span class="id"> rewrite</span> (<span class="id">le_lt_trans</span> (<span class="id">ge_floor</span><span class="id"> _</span>))<span class="id">//</span><span class="id"> PoszM</span><span class="id"> intrM</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -natrX</span><span class="id"> ltr_pM2r//</span><span class="id"> -lte_fin</span> (<span class="id">fineK</span><span class="id"> fxfin</span>).<br/>
<span class="id">have</span><span class="id"> /[!mem_index_enum]/</span>(_<span class="id"> isT</span>)<span class="id"> :=</span><span class="id"> An0</span> (<span class="id">Ordinal</span><span class="id"> K</span>).<br/>
<span class="id">rewrite</span><span class="id"> implyTb</span><span class="id"> indicE</span><span class="id"> mem_set</span><span class="id"> ?mulr1;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> /A</span><span class="id"> K</span><span class="id"> /=</span><span class="id"> inE;</span><span class="id"> split=&gt;</span><span class="id"> //=;</span><span class="gallina-kwd"> exists</span> (<span class="id">fine</span> (<span class="id">f</span><span class="id"> x</span>))<span class="id">;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> fineK</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> in_itv</span><span class="id"> /=;</span><span class="id"> apply/andP;</span><span class="id"> split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> ler_pdivrMr//</span> (<span class="id">le_trans</span><span class="id"> _</span> (<span class="id">ge_floor</span><span class="id"> _</span>))<span class="id">//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -</span>(<span class="id">@gez0_abs</span> (<span class="id">floor</span><span class="id"> _</span>))<span class="id">//</span><span class="id"> floor_ge0</span><span class="id"> mulr_ge0//</span><span class="id"> ltW</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> ltr_pdivlMr//</span> (<span class="id">lt_le_trans</span> (<span class="id">lt_succ_floor</span><span class="id"> _</span>))<span class="id">//</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -[in</span><span class="id"> leRHS]natr1</span><span class="id"> -intrD1</span><span class="id"> lerD2r//</span><span class="id"> -{1}</span>(<span class="id">@gez0_abs</span> (<span class="id">floor</span><span class="id"> _</span>))<span class="id">//</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> floor_ge0//</span><span class="id"> mulr_ge0//</span><span class="id"> ltW</span>.<br/>
<span class="id">rewrite</span><span class="id"> mulf_eq0//</span><span class="id"> -exprVn;</span><span class="id"> apply/negP;</span><span class="id"> rewrite</span><span class="id"> negb_or</span><span class="id"> expf_neq0//=</span><span class="id"> andbT</span>.<br/>
<span class="id">rewrite</span><span class="id"> pnatr_eq0</span><span class="id"> -lt0n</span><span class="id"> absz_gt0</span><span class="id"> floor_neq0//</span><span class="id"> -ler_pdivrMr//</span>.<br/>
<span class="id">apply/orP;</span><span class="id"> right;</span><span class="id"> apply/ltW;</span><span class="id"> near:</span><span class="id"> n</span>.<br/>
<span class="id">exact:</span><span class="id"> near_infty_natSinv_expn_lt</span> (<span class="id">PosNum</span><span class="id"> fx_gt0</span>).<br/>
<span class="id">Unshelve</span>.<span class="id"> all:</span><span class="gallina-kwd"> by</span><span class="id"> end_near</span>. Qed.</div></details>
<br/>
<span class="vernacular">Let</span><span class="id"> f_ub_approx</span><span class="id"> n</span><span class="id"> x</span><span class="id"> :</span> (<span class="id">f</span><span class="id"> x</span><span class="id"> &lt;</span><span class="id"> n%:R%:E</span>)<span class="id">%E</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">approx</span><span class="id"> n</span><span class="id"> x</span><span class="id"> ==</span><span class="id"> 0</span><span class="id"> \/</span><span class="gallina-kwd"> exists</span><span class="id"> k,</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">[/\</span> (<span class="id">0</span><span class="id"> &lt;</span><span class="id"> k</span><span class="id"> &lt;</span><span class="id"> n</span><span class="id"> *</span><span class="id"> 2</span><span class="id"> ^</span><span class="id"> n</span>)<span class="id">%N,</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">x</span><span class="id"> \in</span><span class="id"> A</span><span class="id"> n</span><span class="id"> k,</span><span class="id"> approx</span><span class="id"> n</span><span class="id"> x</span><span class="id"> =</span><span class="id"> k%:R</span><span class="id"> /</span><span class="id"> 2</span><span class="id"> ^+</span><span class="id"> n</span><span class="id"> &amp;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">f</span><span class="id"> x</span><span class="id"> \in</span><span class="id"> EFin</span><span class="id"> @`</span><span class="id"> [set`</span><span class="id"> I</span><span class="id"> n</span><span class="id"> k]]</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> fxn;</span><span class="id"> rewrite</span><span class="id"> /approx</span><span class="id"> fgtn_B0</span><span class="id"> //</span><span class="id"> mulr0</span><span class="id"> addr0</span>.<br/>
<span class="id">set</span><span class="id"> lhs</span><span class="id"> :=</span> (<span class="id">X</span><span class="gallina-kwd"> in</span><span class="id"> X</span><span class="id"> ==</span><span class="id"> 0</span>)<span class="id">;</span><span class="id"> have</span><span class="id"> [|]</span><span class="id"> :=</span><span class="id"> eqVneq</span><span class="id"> lhs</span><span class="id"> 0;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> left</span>.<br/>
<span class="id">rewrite</span><span class="id"> {}/lhs</span><span class="id"> psumr_eq0;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> i</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> mulr_ge0</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> /allPn[/=</span><span class="id"> k</span><span class="id"> _]</span>.<br/>
<span class="id">rewrite</span><span class="id"> mulf_eq0</span><span class="id"> negb_or</span><span class="id"> mulf_eq0</span><span class="id"> negb_or</span><span class="id"> -andbA</span><span class="id"> =&gt;</span><span class="id"> /and3P[k_neq0</span><span class="id"> _]</span>.<br/>
<span class="id">rewrite</span><span class="id"> pnatr_eq0</span><span class="id"> eqb0</span><span class="id"> negbK</span><span class="id"> =&gt;</span><span class="id"> xAnk;</span><span class="id"> right</span>.<br/>
<span class="id">rewrite</span> (<span class="id">bigD1</span><span class="id"> k</span>)<span class="id"> //=</span><span class="id"> indicE</span><span class="id"> xAnk</span><span class="id"> mulr1</span><span class="id"> big1</span><span class="id"> ?addr0;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> i</span><span class="id"> ik;</span><span class="id"> rewrite</span> (<span class="id">disj_A0</span><span class="id"> k</span>)<span class="id">//</span><span class="id"> mulr0</span>.<br/>
<span class="gallina-kwd">exists</span><span class="id"> k;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> lt0n</span><span class="id"> -</span>(<span class="id">@pnatr_eq0</span><span class="id"> R</span>)<span class="id"> k_neq0/=</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> move:</span><span class="id"> xAnk;</span><span class="id"> rewrite</span><span class="id"> inE</span><span class="id"> /A</span><span class="id"> ltn_ord</span><span class="id"> /=</span><span class="id"> inE</span><span class="id"> /=</span><span class="id"> =&gt;</span><span class="id"> -[/[swap]</span><span class="id"> Dx]</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Let</span><span class="id"> notinD_approx0</span><span class="id"> x</span><span class="id"> n</span><span class="id"> :</span><span class="id"> ~</span><span class="id"> D</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> approx</span><span class="id"> n</span><span class="id"> x</span><span class="id"> =</span><span class="id"> 0</span><span class="id"> :&gt;</span><span class="id"> R</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> Dx;</span><span class="id"> rewrite</span><span class="id"> /approx</span><span class="id"> big1;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> i</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> indicE</span><span class="id"> memNset</span><span class="id"> ?mulr0//</span><span class="id"> /A;</span><span class="id"> case:</span><span class="id"> ifPn</span><span class="id"> =&gt;</span><span class="id"> [?</span><span class="id"> []|_]</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> indicE</span><span class="id"> memNset//</span><span class="id"> ?mulr0</span><span class="id"> ?addr0//</span><span class="id"> =&gt;</span><span class="id"> -[]</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> nd_approx</span><span class="id"> :</span><span class="id"> nondecreasing_seq</span><span class="id"> approx</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">apply/nondecreasing_seqP</span><span class="id"> =&gt;</span><span class="id"> n;</span><span class="id"> apply/lefP</span><span class="id"> =&gt;</span><span class="id"> x</span>.<br/>
<span class="id">have</span><span class="id"> [Dx|Dx]</span><span class="id"> :=</span><span class="id"> pselect</span> (<span class="id">D</span><span class="id"> x</span>)<span class="id">;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> ?notinD_approx0</span>.<br/>
<span class="id">have</span><span class="id"> [fxn|fxn]</span><span class="id"> :=</span><span class="id"> ltP</span> (<span class="id">f</span><span class="id"> x</span>)<span class="id"> n%:R%:E</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> {2}/approx</span><span class="id"> fgtn_B0</span><span class="id"> ?mulr0</span><span class="id"> ?addr0;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span> (<span class="id">lt_trans</span><span class="id"> fxn</span>)<span class="id"> //</span><span class="id"> lte_fin</span><span class="id"> ltr_nat</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> [/eqP</span><span class="id"> -&gt;|[k</span><span class="id"> [/andP[k0</span><span class="id"> kn]</span><span class="id"> xAnk</span><span class="id"> -&gt;</span><span class="id"> _]]]</span><span class="id"> :=</span><span class="id"> f_ub_approx</span><span class="id"> fxn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> sumr_ge0</span><span class="id"> =&gt;</span><span class="id"> i</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> mulr_ge0</span>.<br/>
&nbsp;&nbsp;<span class="id">move:</span> (<span class="id">xAnk</span>)<span class="id">;</span><span class="id"> rewrite</span><span class="id"> inE</span><span class="id"> {1}/A</span><span class="id"> kn</span><span class="id"> =&gt;</span><span class="id"> -[_]</span><span class="id"> /=</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> inE</span><span class="id"> =&gt;</span><span class="id"> -[r]</span><span class="id"> /dyadic_itv_subU[|]</span><span class="id"> rnk</span><span class="id"> rfx</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> have</span><span class="id"> k2n</span><span class="id"> :</span> (<span class="id">k</span>.<span class="id">*2</span><span class="id"> &lt;</span><span class="id"> n</span>.<span class="id">+1</span><span class="id"> *</span><span class="id"> 2</span><span class="id"> ^</span><span class="id"> n</span>.<span class="id">+1</span>)<span class="id">%N</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> expnS</span><span class="id"> mulnCA</span><span class="id"> mul2n</span><span class="id"> ltn_double</span> (<span class="id">ltn_trans</span><span class="id"> kn</span>)<span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> ltn_mul2r</span><span class="id"> expn_gt0</span><span class="id"> /=</span><span class="id"> ltnS</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> (<span class="id">bigD1</span> (<span class="id">Ordinal</span><span class="id"> k2n</span>))<span class="id"> //=</span><span class="id"> indicE</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">have</span><span class="id"> xAn1k</span><span class="id"> :</span><span class="id"> x</span><span class="id"> \in</span><span class="id"> A</span><span class="id"> n</span>.<span class="id">+1</span><span class="id"> k</span>.<span class="id">*2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> inE</span><span class="id"> /A</span><span class="id"> k2n;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //=;</span><span class="id"> rewrite</span><span class="id"> inE;</span><span class="gallina-kwd"> exists</span><span class="id"> r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> xAn1k</span><span class="id"> mulr1</span><span class="id"> big1</span><span class="id"> ?addr0;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> i</span><span class="id"> ik2n;</span><span class="id"> rewrite</span> (<span class="id">disj_A0</span> (<span class="id">Ordinal</span><span class="id"> k2n</span>))<span class="id"> ?mulr0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> exprS</span><span class="id"> invrM</span><span class="id"> ?unitfE//</span><span class="id"> -muln2</span><span class="id"> natrM</span><span class="id"> -mulrA</span> (<span class="id">mulrCA</span><span class="id"> 2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> divrr</span><span class="id"> ?mulr1</span><span class="id"> ?unitfE</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> have</span><span class="id"> k2n</span><span class="id"> :</span> (<span class="id">k</span>.<span class="id">*2</span>.<span class="id">+1</span><span class="id"> &lt;</span><span class="id"> n</span>.<span class="id">+1</span><span class="id"> *</span><span class="id"> 2</span><span class="id"> ^</span><span class="id"> n</span>.<span class="id">+1</span>)<span class="id">%N</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">move:</span><span class="id"> kn;</span><span class="id"> rewrite</span><span class="id"> -ltn_double</span><span class="id"> -</span>(<span class="id">ltn_add2r</span><span class="id"> 1</span>)<span class="id"> 2!addn1</span><span class="id"> =&gt;</span><span class="id"> /leq_trans;</span><span class="id"> apply</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -muln2</span><span class="id"> -mulnA</span><span class="id"> -expnSr</span><span class="id"> ltn_mul2r</span><span class="id"> expn_gt0</span><span class="id"> /=</span><span class="id"> ltnS</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> (<span class="id">bigD1</span> (<span class="id">Ordinal</span><span class="id"> k2n</span>))<span class="id"> //=</span><span class="id"> indicE</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">have</span><span class="id"> xAn1k</span><span class="id"> :</span><span class="id"> x</span><span class="id"> \in</span><span class="id"> A</span><span class="id"> n</span>.<span class="id">+1</span><span class="id"> k</span>.<span class="id">*2</span>.<span class="id">+1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /A</span><span class="id"> /=</span><span class="id"> k2n</span><span class="id"> inE;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //=;</span><span class="id"> rewrite</span><span class="id"> inE/=;</span><span class="gallina-kwd"> exists</span><span class="id"> r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> xAn1k</span><span class="id"> mulr1</span><span class="id"> big1</span><span class="id"> ?addr0;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> i</span><span class="id"> ik2n;</span><span class="id"> rewrite</span> (<span class="id">disj_A0</span> (<span class="id">Ordinal</span><span class="id"> k2n</span>))<span class="id"> //</span><span class="id"> mulr0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -</span>(<span class="id">@natr1</span><span class="id"> _</span><span class="id"> k</span>.<span class="id">*2</span>)<span class="id"> mulrDl</span><span class="id"> exprS</span><span class="id"> -mul2n</span><span class="id"> natrM</span><span class="id"> -mulf_div</span><span class="id"> divrr</span><span class="id"> ?unitfE//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> !mul1r</span><span class="id"> lerDl</span>.<br/>
<span class="id">have</span><span class="id"> /orP[{}fxn|{}fxn]</span><span class="id"> :</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;((<span class="id">n%:R%:E</span><span class="id"> &lt;=</span><span class="id"> f</span><span class="id"> x</span><span class="id"> &lt;</span><span class="id"> n</span>.<span class="id">+1%:R%:E</span>)<span class="id"> ||</span> (<span class="id">n</span>.<span class="id">+1%:R%:E</span><span class="id"> &lt;=</span><span class="id"> f</span><span class="id"> x</span>))<span class="id">%E</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move:</span><span class="id"> fxn;</span><span class="id"> case:</span><span class="id"> leP</span><span class="id"> =&gt;</span><span class="id"> /=</span><span class="id"> [_</span><span class="id"> _|_</span><span class="id"> -&gt;//];</span><span class="id"> rewrite</span><span class="id"> orbT</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> have</span><span class="id"> [k</span><span class="id"> [k1</span><span class="id"> k2]]</span><span class="id"> :=</span><span class="id"> dyadic_itv_image</span><span class="id"> fxn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">have</span><span class="id"> xBn</span><span class="id"> :</span><span class="id"> x</span><span class="id"> \in</span><span class="id"> B</span><span class="id"> n</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> /B</span><span class="id"> /=</span><span class="id"> inE</span><span class="id"> /=;</span><span class="id"> case/andP</span><span class="id"> :</span><span class="id"> fxn</span><span class="id"> =&gt;</span><span class="id"> -&gt;</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> /approx</span><span class="id"> indicE</span><span class="id"> xBn</span><span class="id"> mulr1</span><span class="id"> big1</span><span class="id"> ?add0r;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> /=</span><span class="id"> i</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> fgen_A0</span><span class="id"> ?mulr0//;</span><span class="id"> case/andP</span><span class="id"> :</span><span class="id"> fxn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> fgtn_B0</span><span class="id"> ?mulr0</span><span class="id"> ?addr0;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> case/andP</span><span class="id"> :</span><span class="id"> fxn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">have</span><span class="id"> kn2</span><span class="id"> :</span> (<span class="id">k</span><span class="id"> &lt;</span><span class="id"> n</span>.<span class="id">+1</span><span class="id"> *</span><span class="id"> 2</span><span class="id"> ^</span><span class="id"> n</span>.<span class="id">+1</span>)<span class="id">%N</span><span class="gallina-kwd"> by</span><span class="id"> case/andP</span><span class="id"> :</span><span class="id"> k1</span><span class="id"> =&gt;</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> mulnC</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> (<span class="id">bigD1</span> (<span class="id">Ordinal</span><span class="id"> kn2</span>))<span class="id"> //=</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">have</span><span class="id"> xAn1k</span><span class="id"> :</span><span class="id"> x</span><span class="id"> \in</span><span class="id"> A</span><span class="id"> n</span>.<span class="id">+1</span><span class="id"> k</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> inE</span><span class="id"> /A</span><span class="id"> kn2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> indicE</span><span class="id"> xAn1k</span><span class="id"> mulr1</span><span class="id"> big1</span><span class="id"> ?addr0;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> i</span><span class="id"> /=</span><span class="id"> ikn2;</span><span class="id"> rewrite</span> (<span class="id">disj_A0</span> (<span class="id">Ordinal</span><span class="id"> kn2</span>))<span class="id"> //</span><span class="id"> mulr0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -natrX</span><span class="id"> ler_pdivlMr//</span><span class="id"> mulrC</span><span class="id"> -natrM</span><span class="id"> ler_nat;</span><span class="id"> case/andP</span><span class="id"> :</span><span class="id"> k1</span>.<br/>
<span class="id">-</span><span class="id"> have</span><span class="id"> xBn</span><span class="id"> :</span><span class="id"> x</span><span class="id"> \in</span><span class="id"> B</span><span class="id"> n</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> /B</span><span class="id"> inE</span><span class="id"> /=</span> (<span class="id">le_trans</span><span class="id"> _</span><span class="id"> fxn</span>)<span class="id"> //</span><span class="id"> lee_fin</span><span class="id"> ler_nat</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> /approx</span><span class="id"> indicE</span><span class="id"> xBn</span><span class="id"> mulr1</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> xBn1</span><span class="id"> :</span><span class="id"> x</span><span class="id"> \in</span><span class="id"> B</span><span class="id"> n</span>.<span class="id">+1</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> /B</span><span class="id"> /=</span><span class="id"> inE</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> indicE</span><span class="id"> xBn1</span><span class="id"> mulr1</span><span class="id"> big1</span><span class="id"> ?add0r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> big1</span><span class="id"> ?add0r</span><span class="id"> ?ler_nat//</span><span class="id"> =&gt;</span><span class="id"> /=</span><span class="id"> i</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> fgen_A0//</span><span class="id"> mulr0</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> /=</span><span class="id"> i</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> fgen_A0</span><span class="id"> ?mulr0//</span> (<span class="id">le_trans</span><span class="id"> _</span><span class="id"> fxn</span>)<span class="id">//</span><span class="id"> lee_fin</span><span class="id"> ler_nat</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> cvg_approx</span><span class="id"> x</span> (<span class="id">f0</span><span class="id"> :</span><span class="gallina-kwd"> forall</span><span class="id"> x,</span><span class="id"> D</span><span class="id"> x</span><span class="id"> -&gt;</span> (<span class="id">0</span><span class="id"> &lt;=</span><span class="id"> f</span><span class="id"> x</span>)<span class="id">%E</span>)<span class="id"> :</span><span class="id"> D</span><span class="id"> x</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;(<span class="id">f</span><span class="id"> x</span><span class="id"> &lt;</span><span class="id"> +oo</span>)<span class="id">%E</span><span class="id"> -&gt;</span><span class="id"> approx^~</span><span class="id"> x</span><span class="id"> @</span><span class="id"> \oo</span><span class="id"> --&gt;</span><span class="id"> fine</span> (<span class="id">f</span><span class="id"> x</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> Dx</span><span class="id"> fxoo;</span><span class="id"> have</span><span class="id"> fxfin</span><span class="id"> :</span><span class="id"> f</span><span class="id"> x</span><span class="id"> \is</span><span class="id"> a</span><span class="id"> fin_num</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> ge0_fin_numE//</span><span class="id"> f0</span>.<br/>
<span class="id">apply/</span>(<span class="id">@cvgrPdist_lt</span><span class="id"> _</span><span class="id"> [the</span><span class="id"> normedModType</span><span class="id"> R</span><span class="id"> of</span><span class="id"> R^o]</span>)<span class="id"> =&gt;</span><span class="id"> _/posnumP[e]</span>.<br/>
<span class="id">have</span><span class="id"> [fx0|fx0]</span><span class="id"> :=</span><span class="id"> eqVneq</span> (<span class="id">f</span><span class="id"> x</span>)<span class="id"> 0%E</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> near=&gt;</span><span class="id"> n;</span><span class="id"> rewrite</span><span class="id"> f0_approx0</span><span class="id"> //</span><span class="id"> fx0</span><span class="id"> /=</span><span class="id"> subrr</span><span class="id"> normr0</span>.<br/>
<span class="id">have</span><span class="id"> /</span>(<span class="id">fpos_approx_neq0</span><span class="id"> Dx</span>)<span class="id">[m</span><span class="id"> _</span><span class="id"> Hm]</span><span class="id"> :</span> (<span class="id">0</span><span class="id"> &lt;</span><span class="id"> f</span><span class="id"> x</span><span class="id"> &lt;</span><span class="id"> +oo</span>)<span class="id">%E</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> lt0e</span><span class="id"> fx0</span><span class="id"> f0</span>.<br/>
<span class="id">near=&gt;</span><span class="id"> n</span>.<br/>
<span class="id">have</span><span class="id"> mn</span><span class="id"> :</span> (<span class="id">m</span><span class="id"> &lt;=</span><span class="id"> n</span>)<span class="id">%N</span><span class="gallina-kwd"> by</span><span class="id"> near:</span><span class="id"> n;</span><span class="gallina-kwd"> exists</span><span class="id"> m</span>.<br/>
<span class="id">have</span><span class="id"> :</span><span class="id"> fine</span> (<span class="id">f</span><span class="id"> x</span>)<span class="id"> &lt;</span><span class="id"> n%:R</span>.<br/>
&nbsp;&nbsp;<span class="id">near:</span><span class="id"> n</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">exists</span><span class="id"> `|floor</span> (<span class="id">fine</span> (<span class="id">f</span><span class="id"> x</span>))<span class="id">|</span>.<span class="id">+1%N</span><span class="id"> =&gt;</span><span class="id"> //=</span><span class="id"> p</span><span class="id"> /=</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -</span>(<span class="id">@ler_nat</span><span class="id"> R</span>)<span class="id">;</span><span class="id"> apply:</span><span class="id"> lt_le_trans</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -natr1</span> (_<span class="id"> :</span><span class="id"> `|</span><span class="id"> _</span><span class="id"> |%:R</span> <span class="id"> =</span> (<span class="id">floor</span> (<span class="id">fine</span> (<span class="id">f</span><span class="id"> x</span>)))<span class="id">%:~R</span>)<span class="id">;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -[in</span><span class="id"> RHS]</span>(<span class="id">@gez0_abs</span> (<span class="id">floor</span><span class="id"> _</span>))<span class="id">//</span><span class="id"> floor_ge0//;</span><span class="id"> exact/fine_ge0/f0</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> intrD1</span><span class="id"> lt_succ_floor</span>.<br/>
<span class="id">rewrite</span><span class="id"> -lte_fin</span> (<span class="id">fineK</span><span class="id"> fxfin</span>)<span class="id"> =&gt;</span><span class="id"> fxn</span>.<br/>
<span class="id">have</span><span class="id"> [approx_nx0|[k</span><span class="id"> [/andP[k0</span><span class="id"> kn2n]</span><span class="id"> ?</span><span class="id"> -&gt;]]]</span><span class="id"> :=</span><span class="id"> f_ub_approx</span><span class="id"> fxn</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> have</span><span class="id"> :=</span><span class="id"> Hm</span><span class="id"> _</span><span class="id"> mn;</span><span class="id"> rewrite</span><span class="id"> approx_nx0</span>.<br/>
<span class="id">rewrite</span><span class="id"> inE</span><span class="id"> /=</span><span class="id"> =&gt;</span><span class="id"> -[r</span><span class="id"> /=];</span><span class="id"> rewrite</span><span class="id"> in_itv</span><span class="id"> /=</span><span class="id"> =&gt;</span><span class="id"> /andP[k1</span><span class="id"> k2]</span><span class="id"> rfx</span>.<br/>
<span class="id">rewrite</span> (<span class="id">@le_lt_trans</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">1</span><span class="id"> /</span><span class="id"> 2</span><span class="id"> ^+</span><span class="id"> n</span>))<span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> ler_norml;</span><span class="id"> apply/andP;</span><span class="id"> split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> lerBrDl</span><span class="id"> -mulrBl</span><span class="id"> -lee_fin</span> (<span class="id">fineK</span><span class="id"> fxfin</span>)<span class="id"> -rfx</span><span class="id"> lee_fin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span> (<span class="id">le_trans</span><span class="id"> _</span><span class="id"> k1</span>)<span class="id">//</span><span class="id"> ler_pM2r//</span><span class="id"> lerBlDl</span><span class="id"> lerDr</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> lerBlDr</span><span class="id"> -mulrDl</span><span class="id"> -lee_fin</span><span class="id"> nat1r</span><span class="id"> fineK//</span><span class="id"> ltW//</span><span class="id"> -rfx</span><span class="id"> lte_fin</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> near:</span><span class="id"> n;</span><span class="id"> exact:</span><span class="id"> near_infty_natSinv_expn_lt</span>.<br/>
<span class="id">Unshelve</span>.<span class="id"> all:</span><span class="gallina-kwd"> by</span><span class="id"> end_near</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> le_approx</span><span class="id"> k</span><span class="id"> x</span> (<span class="id">f0</span><span class="id"> :</span><span class="gallina-kwd"> forall</span><span class="id"> x,</span><span class="id"> D</span><span class="id"> x</span><span class="id"> -&gt;</span> (<span class="id">0</span><span class="id"> &lt;=</span><span class="id"> f</span><span class="id"> x</span>)<span class="id">%E</span>)<span class="id"> :</span><span class="id"> D</span><span class="id"> x</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;((<span class="id">approx</span><span class="id"> k</span><span class="id"> x</span>)<span class="id">%:E</span><span class="id"> &lt;=</span><span class="id"> f</span><span class="id"> x</span>)<span class="id">%E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> Dx;</span><span class="id"> have</span><span class="id"> [fixoo|]</span><span class="id"> :=</span><span class="id"> ltP</span> (<span class="id">f</span><span class="id"> x</span>) (<span class="id">+oo%E</span>)<span class="id">;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> leye_eq</span><span class="id"> =&gt;</span><span class="id"> /eqP</span><span class="id"> -&gt;;</span><span class="id"> rewrite</span><span class="id"> leey</span>.<br/>
<span class="id">have</span><span class="id"> nd_ag</span><span class="id"> :</span><span class="id"> {homo</span><span class="id"> approx</span><span class="id"> ^~</span><span class="id"> x</span><span class="id"> :</span><span class="id"> n</span><span class="id"> m</span><span class="id"> /</span> (<span class="id">n</span><span class="id"> &lt;=</span><span class="id"> m</span>)<span class="id">%N</span><span class="id"> &gt;-&gt;</span><span class="id"> n</span><span class="id"> &lt;=</span><span class="id"> m}</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> m</span><span class="id"> n</span><span class="id"> mn;</span><span class="id"> exact/lefP/nd_approx</span>.<br/>
<span class="id">have</span><span class="id"> fi0</span><span class="id"> y</span><span class="id"> :</span><span class="id"> D</span><span class="id"> y</span><span class="id"> -&gt;</span> (<span class="id">0</span><span class="id"> &lt;=</span><span class="id"> f</span><span class="id"> y</span>)<span class="id">%E</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> ?;</span><span class="id"> exact:</span><span class="id"> f0</span>.<br/>
<span class="id">have</span><span class="id"> cvg_af</span><span class="id"> :=</span><span class="id"> cvg_approx</span><span class="id"> fi0</span><span class="id"> Dx</span><span class="id"> fixoo</span>.<br/>
<span class="id">have</span><span class="id"> is_cvg_af</span><span class="id"> :</span><span class="id"> cvgn</span> (<span class="id">approx</span><span class="id"> ^~</span><span class="id"> x</span>)<span class="gallina-kwd"> by</span><span class="id"> apply/cvg_ex;</span><span class="id"> eexists;</span><span class="id"> exact:</span><span class="id"> cvg_af</span>.<br/>
<span class="id">have</span><span class="id"> {is_cvg_af}</span><span class="id"> :=</span><span class="id"> nondecreasing_cvgn_le</span><span class="id"> nd_ag</span><span class="id"> is_cvg_af</span><span class="id"> k</span>.<br/>
<span class="id">rewrite</span><span class="id"> -lee_fin</span><span class="id"> =&gt;</span><span class="id"> /le_trans;</span><span class="id"> apply</span>.<br/>
<span class="id">rewrite</span><span class="id"> -</span>(<span class="id">@fineK</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> x</span>))<span class="id">;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> ge0_fin_numE//</span><span class="id"> f0</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> move/</span>(<span class="id">cvg_lim</span> (<span class="id">@Rhausdorff</span><span class="id"> R</span>))<span class="id"> :</span><span class="id"> cvg_af</span><span class="id"> =&gt;</span><span class="id"> -&gt;</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> dvg_approx</span><span class="id"> x</span><span class="id"> :</span><span class="id"> D</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> f</span><span class="id"> x</span><span class="id"> =</span><span class="id"> +oo%E</span><span class="id"> -&gt;</span><span class="id"> ~</span><span class="id"> cvgn</span> (<span class="id">approx^~</span><span class="id"> x</span><span class="id"> :</span><span class="id"> _</span><span class="id"> -&gt;</span><span class="id"> R^o</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> Dx</span><span class="id"> fxoo;</span><span class="id"> have</span><span class="id"> approx_x</span><span class="id"> n</span><span class="id"> :</span><span class="id"> approx</span><span class="id"> n</span><span class="id"> x</span><span class="id"> =</span><span class="id"> n%:R</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> /approx</span><span class="id"> foo_B1//</span><span class="id"> mulr1</span><span class="id"> big1</span><span class="id"> ?add0r//</span><span class="id"> =&gt;</span><span class="id"> /=</span><span class="id"> i</span><span class="id"> _</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> fgen_A0</span><span class="id"> //</span><span class="id"> ?mulr0</span><span class="id"> //</span><span class="id"> fxoo</span><span class="id"> leey</span>.<br/>
<span class="id">case/cvg_ex</span><span class="id"> =&gt;</span><span class="id"> /=</span><span class="id"> l;</span><span class="id"> have</span><span class="id"> [l0|l0]</span><span class="id"> :=</span><span class="id"> leP</span><span class="id"> 0%R</span><span class="id"> l</span>.<br/>
<span class="id">-</span><span class="id"> move=&gt;</span><span class="id"> /cvgrPdist_lt/</span>(_<span class="id"> _</span><span class="id"> ltr01</span>)<span class="id"> -[n</span><span class="id"> _]</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> /</span>(_ (<span class="id">`|ceil</span><span class="id"> l|</span>.<span class="id">+1</span><span class="id"> +</span><span class="id"> n</span>)<span class="id">%N</span>)<span class="id"> /=</span><span class="id"> /</span>(_ (<span class="id">leq_addl</span><span class="id"> _</span><span class="id"> _</span>)).<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> approx_x</span>.<br/>
&nbsp;&nbsp;<span class="id">apply/negP;</span><span class="id"> rewrite</span><span class="id"> -leNgt</span><span class="id"> distrC</span> (<span class="id">le_trans</span><span class="id"> _</span> (<span class="id">lerB_normD</span><span class="id"> _</span><span class="id"> _</span>))<span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> normrN</span><span class="id"> lerBrDl</span><span class="id"> addSnnS</span><span class="id"> [leRHS]ger0_norm</span><span class="id"> ?ler0n//</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> natrD</span><span class="id"> lerD//</span><span class="id"> ?ler1n//</span><span class="id"> ger0_norm</span><span class="id"> //</span> (<span class="id">le_trans</span> (<span class="id">ceil_ge</span><span class="id"> _</span>))<span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -</span>(<span class="id">@gez0_abs</span> (<span class="id">ceil</span><span class="id"> _</span>))<span class="id"> //</span><span class="id"> -ceil_ge0</span> (<span class="id">lt_le_trans</span><span class="id"> _</span><span class="id"> l0</span>).<br/>
<span class="id">-</span><span class="id"> move=&gt;</span><span class="id"> /cvgrPdist_lt/</span>(_<span class="id"> _</span><span class="id"> ltr01</span>)<span class="id">[n</span><span class="id"> _]</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> /</span>(_ (<span class="id">`|floor</span><span class="id"> l|</span>.<span class="id">+1</span><span class="id"> +</span><span class="id"> n</span>)<span class="id">%N</span>)<span class="id">/</span>(_ (<span class="id">leq_addl</span><span class="id"> _</span><span class="id"> _</span>))<span class="id">;</span><span class="id"> apply/negP</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> approx_x</span><span class="id"> -leNgt</span><span class="id"> distrC</span> (<span class="id">le_trans</span><span class="id"> _</span> (<span class="id">lerB_normD</span><span class="id"> _</span><span class="id"> _</span>))<span class="id">//</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> normrN</span><span class="id"> lerBrDl</span><span class="id"> addSnnS</span><span class="id"> [leRHS]ger0_norm</span><span class="id"> ?ler0n//</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> natrD</span><span class="id"> lerD</span><span class="id"> ?ler1n//</span><span class="id"> ltr0_norm//</span> (<span class="id">@le_trans</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">-</span><span class="id"> floor</span><span class="id"> l</span>)<span class="id">%:~R</span>)<span class="id">//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> mulrNz</span><span class="id"> lerNl</span><span class="id"> opprK</span><span class="id"> ge_floor</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -</span>(<span class="id">@lez0_abs</span> (<span class="id">floor</span><span class="id"> _</span>))<span class="id">//</span><span class="id"> -floor_le0//</span> (<span class="id">lt_le_trans</span><span class="id"> l0</span>).<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> ecvg_approx</span> (<span class="id">f0</span><span class="id"> :</span><span class="gallina-kwd"> forall</span><span class="id"> x,</span><span class="id"> D</span><span class="id"> x</span><span class="id"> -&gt;</span> (<span class="id">0</span><span class="id"> &lt;=</span><span class="id"> f</span><span class="id"> x</span>)<span class="id">%E</span>)<span class="id"> x</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">D</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> EFin</span><span class="id"> \o</span><span class="id"> approx^~x</span><span class="id"> @</span><span class="id"> \oo</span><span class="id"> --&gt;</span><span class="id"> f</span><span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> Dx;</span><span class="id"> have</span><span class="id"> :=</span><span class="id"> leey</span> (<span class="id">f</span><span class="id"> x</span>)<span class="id">;</span><span class="id"> rewrite</span><span class="id"> le_eqVlt</span><span class="id"> =&gt;</span><span class="id"> /predU1P[|]</span><span class="id"> fxoo</span>.<br/>
<span class="id">have</span><span class="id"> dvg_approx</span><span class="id"> :=</span><span class="id"> dvg_approx</span><span class="id"> Dx</span><span class="id"> fxoo</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> :</span><span class="id"> {homo</span><span class="id"> approx</span><span class="id"> ^~</span><span class="id"> x</span><span class="id"> :</span><span class="id"> n</span><span class="id"> m</span><span class="id"> /</span> (<span class="id">n</span><span class="id"> &lt;=</span><span class="id"> m</span>)<span class="id">%N</span><span class="id"> &gt;-&gt;</span><span class="id"> n</span><span class="id"> &lt;=</span><span class="id"> m}</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> m</span><span class="id"> n</span><span class="id"> mn;</span><span class="id"> have</span><span class="id"> :=</span><span class="id"> nd_approx</span><span class="id"> mn</span><span class="id"> =&gt;</span><span class="id"> /lefP;</span><span class="id"> exact</span>.<br/>
&nbsp;&nbsp;<span class="id">move/nondecreasing_dvgn_lt</span><span class="id"> =&gt;</span><span class="id"> /</span>(_<span class="id"> dvg_approx</span>).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> fxoo</span><span class="id"> =&gt;</span><span class="id"> ?;</span><span class="id"> apply/cvgeryP</span>.<br/>
<span class="id">rewrite</span><span class="id"> -</span>(<span class="id">@fineK</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> x</span>))<span class="id">;</span><span class="id"> first</span><span class="id"> exact:</span> (<span class="id">cvg_comp</span> (<span class="id">cvg_approx</span><span class="id"> f0</span><span class="id"> Dx</span><span class="id"> fxoo</span>)).<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> ge0_fin_numE//</span><span class="id"> f0</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Let</span><span class="id"> k2n_ge0</span><span class="id"> n</span> (<span class="id">k</span><span class="id"> :</span><span class="id"> 'I_</span>(<span class="id">n</span><span class="id"> *</span><span class="id"> 2</span><span class="id"> ^</span><span class="id"> n</span>))<span class="id"> :</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> k%:R</span><span class="id"> *</span><span class="id"> 2</span><span class="id"> ^-</span><span class="id"> n</span><span class="id"> :&gt;</span><span class="id"> R</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> []</span>. Qed.</div></details>
<br/>
<span class="vernacular">Definition</span><span class="id"> nnsfun_approx</span><span class="id"> :</span><span class="id"> {nnsfun</span><span class="id"> T</span><span class="id"> &gt;-&gt;</span><span class="id"> R}^nat</span><span class="id"> :=</span><span class="gallina-kwd"> fun</span><span class="id"> n</span><span class="id"> =&gt;</span><span class="id"> locked</span> (<span class="id">add_nnsfun</span><br/>
&nbsp;&nbsp;(<span class="id">sum_nnsfun</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="gallina-kwd">fun</span><span class="id"> k</span><span class="id"> =&gt;</span><span class="gallina-kwd"> match</span><span class="id"> Bool</span>.<span class="id">bool_dec</span> (<span class="id">k</span><span class="id"> &lt;</span> (<span class="id">n</span><span class="id"> *</span><span class="id"> 2</span><span class="id"> ^</span><span class="id"> n</span>))<span class="id">%N</span><span class="id"> true</span><span class="gallina-kwd"> with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">|</span><span class="id"> left</span><span class="id"> h</span><span class="id"> =&gt;</span><span class="id"> scale_nnsfun</span> (<span class="id">indic_nnsfun</span><span class="id"> _</span> (<span class="id">mA</span><span class="id"> n</span><span class="id"> k</span>)) (<span class="id">k2n_ge0</span> (<span class="id">Ordinal</span><span class="id"> h</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">|</span><span class="id"> right</span><span class="id"> _</span><span class="id"> =&gt;</span><span class="id"> nnsfun0</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">end</span>) (<span class="id">n</span><span class="id"> *</span><span class="id"> 2</span><span class="id"> ^</span><span class="id"> n</span>)<span class="id">%N</span>)<br/>
&nbsp;&nbsp;(<span class="id">scale_nnsfun</span> (<span class="id">indic_nnsfun</span><span class="id"> _</span> (<span class="id">mB</span><span class="id"> n</span>)) (<span class="id">ler0n</span><span class="id"> _</span><span class="id"> n</span>))).<br/>
<br/>
<span class="vernacular">Import</span><span class="id"> HBNNSimple</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> nnsfun_approxE</span><span class="id"> n</span><span class="id"> :</span><span class="id"> nnsfun_approx</span><span class="id"> n</span><span class="id"> =</span><span class="id"> approx</span><span class="id"> n</span><span class="id"> :&gt;</span> (<span class="id">T</span><span class="id"> -&gt;</span><span class="id"> R</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> funeqE</span><span class="id"> =&gt;</span><span class="id"> t</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> /nnsfun_approx;</span><span class="id"> unlock;</span><span class="id"> rewrite</span><span class="id"> /=</span>.<br/>
<span class="id">rewrite</span><span class="id"> sum_nnsfunE;</span><span class="id"> congr</span> (_<span class="id"> +</span><span class="id"> _</span>).<br/>
<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> eq_bigr</span><span class="id"> =&gt;</span><span class="id"> i</span><span class="id"> _;</span><span class="id"> case:</span><span class="id"> Bool</span>.<span class="id">bool_dec</span><span class="id"> =&gt;</span><span class="id"> [h|/negP];</span><span class="id"> [|rewrite</span><span class="id"> ltn_ord]</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> cvg_nnsfun_approx</span> (<span class="id">f0</span><span class="id"> :</span><span class="gallina-kwd"> forall</span><span class="id"> x,</span><span class="id"> D</span><span class="id"> x</span><span class="id"> -&gt;</span> (<span class="id">0</span><span class="id"> &lt;=</span><span class="id"> f</span><span class="id"> x</span>)<span class="id">%E</span>)<span class="id"> x</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">D</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> EFin</span><span class="id"> \o</span><span class="id"> nnsfun_approx^~x</span><span class="id"> @</span><span class="id"> \oo</span><span class="id"> --&gt;</span><span class="id"> f</span><span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> Dx;</span><span class="id"> under</span><span class="id"> eq_fun</span><span class="id"> do</span><span class="id"> rewrite</span><span class="id"> nnsfun_approxE;</span><span class="id"> exact:</span><span class="id"> ecvg_approx</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> nd_nnsfun_approx</span><span class="id"> :</span><span class="id"> nondecreasing_seq</span> (<span class="id">nnsfun_approx</span><span class="id"> :</span> (<span class="id">T</span><span class="id"> -&gt;</span><span class="id"> R</span>)<span class="id">^nat</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> m</span><span class="id"> n</span><span class="id"> mn;</span><span class="id"> rewrite</span> (<span class="id">nnsfun_approxE</span><span class="id"> n</span>) (<span class="id">nnsfun_approxE</span><span class="id"> m</span>).<br/>
<span class="id">exact:</span><span class="id"> nd_approx</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> approximation</span><span class="id"> :</span> (<span class="gallina-kwd">forall</span><span class="id"> t,</span><span class="id"> D</span><span class="id"> t</span><span class="id"> -&gt;</span> (<span class="id">0</span><span class="id"> &lt;=</span><span class="id"> f</span><span class="id"> t</span>)<span class="id">%E</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">exists</span><span class="id"> g</span><span class="id"> :</span><span class="id"> {nnsfun</span><span class="id"> T</span><span class="id"> &gt;-&gt;</span><span class="id"> R}^nat,</span><span class="id"> nondecreasing_seq</span> (<span class="id">g</span><span class="id"> :</span> (<span class="id">T</span><span class="id"> -&gt;</span><span class="id"> R</span>)<span class="id">^nat</span>)<span class="id"> /\</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="gallina-kwd">forall</span><span class="id"> x,</span><span class="id"> D</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> EFin</span><span class="id"> \o</span><span class="id"> g^~</span><span class="id"> x</span><span class="id"> @</span><span class="id"> \oo</span><span class="id"> --&gt;</span><span class="id"> f</span><span class="id"> x</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd">exists</span><span class="id"> nnsfun_approx;</span><span class="id"> split;</span><span class="id"> [exact:</span><span class="id"> nd_nnsfun_approx|]</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> Dx;</span><span class="id"> exact:</span><span class="id"> cvg_nnsfun_approx</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> approximation</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> ge0_linearityZ</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<span class="vernacular">Context</span><span class="id"> d</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>).<br/>
<span class="vernacular">Variables</span> (<span class="id">mu</span><span class="id"> :</span><span class="id"> {measure</span><span class="id"> set</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R}</span>) (<span class="id">D</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T</span>) (<span class="id">mD</span><span class="id"> :</span><span class="id"> measurable</span><span class="id"> D</span>).<br/>
<span class="vernacular">Variables</span><span class="id"> f1</span><span class="id"> f2</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>.<br/>
<span class="vernacular">Hypothesis</span><span class="id"> f10</span><span class="id"> :</span><span class="gallina-kwd"> forall</span><span class="id"> x,</span><span class="id"> D</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> f1</span><span class="id"> x</span>.<br/>
<span class="vernacular">Hypothesis</span><span class="id"> mf1</span><span class="id"> :</span><span class="id"> measurable_fun</span><span class="id"> D</span><span class="id"> f1</span>.<br/>
<br/>
<span class="vernacular">Import</span><span class="id"> HBNNSimple</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> ge0_integralZl_EFin</span><span class="id"> k</span><span class="id"> :</span> (<span class="id">0</span><span class="id"> &lt;=</span><span class="id"> k</span>)<span class="id">%R</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>) (<span class="id">k%:E</span><span class="id"> *</span><span class="id"> f1</span><span class="id"> x</span>)<span class="id"> =</span><span class="id"> k%:E</span><span class="id"> *</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> f1</span><span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> integral_mkcond</span><span class="id"> erestrict_scale</span><span class="id"> [in</span><span class="id"> RHS]integral_mkcond</span><span class="id"> =&gt;</span><span class="id"> k0</span>.<br/>
<span class="id">set</span><span class="id"> h1</span><span class="id"> :=</span><span class="id"> f1</span><span class="id"> \_</span><span class="id"> D</span>.<br/>
<span class="id">have</span><span class="id"> h10</span><span class="id"> x</span><span class="id"> :</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> h1</span><span class="id"> x</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> erestrict_ge0</span>.<br/>
<span class="id">have</span><span class="id"> mh1</span><span class="id"> :</span><span class="id"> measurable_fun</span><span class="id"> setT</span><span class="id"> h1</span><span class="gallina-kwd"> by</span><span class="id"> exact/</span>(<span class="id">measurable_restrictT</span><span class="id"> _</span><span class="id"> _</span>).<span class="id">1</span>.<br/>
<span class="id">have</span><span class="id"> [g</span><span class="id"> [nd_g</span><span class="id"> gh1]]</span><span class="id"> :=</span><span class="id"> approximation</span><span class="id"> measurableT</span><span class="id"> mh1</span> (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> _</span><span class="id"> =&gt;</span><span class="id"> h10</span><span class="id"> x</span>).<br/>
<span class="id">pose</span><span class="id"> kg</span><span class="id"> :=</span><span class="gallina-kwd"> fun</span><span class="id"> n</span><span class="id"> =&gt;</span><span class="id"> scale_nnsfun</span> (<span class="id">g</span><span class="id"> n</span>)<span class="id"> k0</span>.<br/>
<span class="id">rewrite</span> (<span class="id">@nd_ge0_integral_lim</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> mu</span> (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> k%:E</span><span class="id"> *</span><span class="id"> h1</span><span class="id"> x</span>)<span class="id"> kg</span>).<br/>
<span class="id">-</span><span class="id"> rewrite</span> (_<span class="id"> :</span><span class="id"> _</span><span class="id"> \o</span><span class="id"> _</span><span class="id"> =</span><span class="gallina-kwd"> fun</span><span class="id"> n</span><span class="id"> =&gt;</span><span class="id"> sintegral</span><span class="id"> mu</span> (<span class="id">scale_nnsfun</span> (<span class="id">g</span><span class="id"> n</span>)<span class="id"> k0</span>))<span class="id">//</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> (_<span class="id"> :</span> (<span class="gallina-kwd">fun</span><span class="id"> _</span><span class="id"> =&gt;</span><span class="id"> _</span>)<span class="id"> =</span> (<span class="gallina-kwd">fun</span><span class="id"> n</span><span class="id"> =&gt;</span><span class="id"> k%:E</span><span class="id"> *</span><span class="id"> sintegral</span><span class="id"> mu</span> (<span class="id">g</span><span class="id"> n</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> limeMl</span><span class="id"> //;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> is_cvg_sintegral</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> x</span><span class="id"> m</span><span class="id"> n</span><span class="id"> mn;</span><span class="id"> apply/</span>(<span class="id">lef_at</span><span class="id"> x</span><span class="id"> nd_g</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -</span>(<span class="id">nd_ge0_integral_lim</span><span class="id"> mu</span><span class="id"> h10</span>)<span class="id"> //</span><span class="id"> =&gt;</span><span class="id"> x;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">[exact/</span>(<span class="id">lef_at</span><span class="id"> x</span><span class="id"> nd_g</span>)<span class="id">|exact:</span><span class="id"> gh1]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> under</span><span class="id"> eq_fun</span><span class="id"> do</span><span class="id"> rewrite</span> (<span class="id">sintegralrM</span><span class="id"> mu</span><span class="id"> k</span> (<span class="id">g</span><span class="id"> _</span>)).<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> t;</span><span class="id"> rewrite</span><span class="id"> mule_ge0</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> m</span><span class="id"> n</span><span class="id"> mn;</span><span class="id"> rewrite</span><span class="id"> /kg</span><span class="id"> ler_pM//;</span><span class="id"> exact/lefP/nd_g</span>.<br/>
<span class="id">-</span><span class="id"> move=&gt;</span><span class="id"> x</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> [X</span><span class="gallina-kwd"> in</span><span class="id"> X</span><span class="id"> @</span><span class="id"> \oo</span><span class="id"> --&gt;</span><span class="id"> _]</span>(_<span class="id"> :</span><span class="id"> _</span><span class="id"> =</span> (<span class="gallina-kwd">fun</span><span class="id"> n</span><span class="id"> =&gt;</span><span class="id"> k%:E</span><span class="id"> *</span> (<span class="id">g</span><span class="id"> n</span><span class="id"> x</span>)<span class="id">%:E</span>))<span class="id"> ?funeqE//</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> cvgeMl</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> gh1</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> ge0_linearityZ</span>.<br/>
<span class="id">#[deprecated</span>(<span class="id">since=</span><span class="id">&quot;mathcomp-analysis 0.6.4&quot;</span><span class="id">,</span><span class="id"> note=</span><span class="id">&quot;use `ge0_integralZl_EFin` instead&quot;</span>)<span class="id">]</span><br/>
<span class="vernacular">Notation</span><span class="id"> ge0_integralM_EFin</span><span class="id"> :=</span><span class="id"> ge0_integralZl_EFin</span> (<span class="id">only</span><span class="id"> parsing</span>).<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> ge0_linearityD</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<span class="vernacular">Context</span><span class="id"> d</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>).<br/>
<span class="vernacular">Variable</span><span class="id"> mu</span><span class="id"> :</span><span class="id"> {measure</span><span class="id"> set</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R}</span>.<br/>
<span class="vernacular">Variables</span> (<span class="id">D</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T</span>) (<span class="id">mD</span><span class="id"> :</span><span class="id"> measurable</span><span class="id"> D</span>) (<span class="id">f1</span><span class="id"> f2</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>).<br/>
<span class="vernacular">Hypothesis</span><span class="id"> f10</span><span class="id"> :</span><span class="gallina-kwd"> forall</span><span class="id"> x,</span><span class="id"> D</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> f1</span><span class="id"> x</span>.<br/>
<span class="vernacular">Hypothesis</span><span class="id"> mf1</span><span class="id"> :</span><span class="id"> measurable_fun</span><span class="id"> D</span><span class="id"> f1</span>.<br/>
<span class="vernacular">Hypothesis</span><span class="id"> f20</span><span class="id"> :</span><span class="gallina-kwd"> forall</span><span class="id"> x,</span><span class="id"> D</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> f2</span><span class="id"> x</span>.<br/>
<span class="vernacular">Hypothesis</span><span class="id"> mf2</span><span class="id"> :</span><span class="id"> measurable_fun</span><span class="id"> D</span><span class="id"> f2</span>.<br/>
<br/>
<span class="vernacular">Import</span><span class="id"> HBNNSimple</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> ge0_integralD</span><span class="id"> :</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>) (<span class="id">f1</span><span class="id"> x</span><span class="id"> +</span><span class="id"> f2</span><span class="id"> x</span>)<span class="id"> =</span><br/>
&nbsp;&nbsp;<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> f1</span><span class="id"> x</span><span class="id"> +</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> f2</span><span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> !</span>(<span class="id">integral_mkcond</span><span class="id"> D</span>)<span class="id"> erestrictD</span>.<br/>
<span class="id">set</span><span class="id"> h1</span><span class="id"> :=</span><span class="id"> f1</span><span class="id"> \_</span><span class="id"> D;</span><span class="id"> set</span><span class="id"> h2</span><span class="id"> :=</span><span class="id"> f2</span><span class="id"> \_</span><span class="id"> D</span>.<br/>
<span class="id">have</span><span class="id"> h10</span><span class="id"> x</span><span class="id"> :</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> h1</span><span class="id"> x</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> erestrict_ge0</span>.<br/>
<span class="id">have</span><span class="id"> h20</span><span class="id"> x</span><span class="id"> :</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> h2</span><span class="id"> x</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> erestrict_ge0</span>.<br/>
<span class="id">have</span><span class="id"> mh1</span><span class="id"> :</span><span class="id"> measurable_fun</span><span class="id"> setT</span><span class="id"> h1</span><span class="gallina-kwd"> by</span><span class="id"> exact/</span>(<span class="id">measurable_restrictT</span><span class="id"> _</span><span class="id"> _</span>).<span class="id">1</span>.<br/>
<span class="id">have</span><span class="id"> mh2</span><span class="id"> :</span><span class="id"> measurable_fun</span><span class="id"> setT</span><span class="id"> h2</span><span class="gallina-kwd"> by</span><span class="id"> exact/</span>(<span class="id">measurable_restrictT</span><span class="id"> _</span><span class="id"> _</span>).<span class="id">1</span>.<br/>
<span class="id">have</span><span class="id"> [g1</span><span class="id"> [nd_g1</span><span class="id"> gh1]]</span><span class="id"> :=</span><span class="id"> approximation</span><span class="id"> measurableT</span><span class="id"> mh1</span> (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> _</span><span class="id"> =&gt;</span><span class="id"> h10</span><span class="id"> x</span>).<br/>
<span class="id">have</span><span class="id"> [g2</span><span class="id"> [nd_g2</span><span class="id"> gh2]]</span><span class="id"> :=</span><span class="id"> approximation</span><span class="id"> measurableT</span><span class="id"> mh2</span> (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> _</span><span class="id"> =&gt;</span><span class="id"> h20</span><span class="id"> x</span>).<br/>
<span class="id">pose</span><span class="id"> g12</span><span class="id"> :=</span><span class="gallina-kwd"> fun</span><span class="id"> n</span><span class="id"> =&gt;</span><span class="id"> add_nnsfun</span> (<span class="id">g1</span><span class="id"> n</span>) (<span class="id">g2</span><span class="id"> n</span>).<br/>
<span class="id">rewrite</span> (<span class="id">@nd_ge0_integral_lim</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> mu</span><span class="id"> _</span><span class="id"> g12</span>)<span class="id"> //;</span><span class="id"> last</span><span class="id"> 3</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> x;</span><span class="id"> rewrite</span><span class="id"> adde_ge0</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> nondecreasing_seqD</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> x;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">[exact/</span>(<span class="id">lef_at</span><span class="id"> x</span><span class="id"> nd_g1</span>)<span class="id">|exact/</span>(<span class="id">lef_at</span><span class="id"> x</span><span class="id"> nd_g2</span>)<span class="id">]</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> move=&gt;</span><span class="id"> x;</span><span class="id"> rewrite</span> (_<span class="id"> :</span><span class="id"> _</span><span class="id"> \o</span><span class="id"> _</span><span class="id"> =</span> (<span class="gallina-kwd">fun</span><span class="id"> n</span><span class="id"> =&gt;</span> (<span class="id">g1</span><span class="id"> n</span><span class="id"> x</span>)<span class="id">%:E</span><span class="id"> +</span> (<span class="id">g2</span><span class="id"> n</span><span class="id"> x</span>)<span class="id">%:E</span>))<span class="id">//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> cvgeD</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> [|exact:</span><span class="id"> gh1|exact:</span><span class="id"> gh2]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> ge0_adde_def</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> rewrite</span><span class="id"> !inE;</span><span class="id"> [exact:</span><span class="id"> h10|exact:</span><span class="id"> h20]</span>.<br/>
<span class="id">under</span><span class="id"> [_</span><span class="id"> \o</span><span class="id"> _]eq_fun</span><span class="id"> do</span><span class="id"> rewrite</span><span class="id"> sintegralD</span>.<br/>
<span class="id">rewrite</span> (<span class="id">nd_ge0_integral_lim</span><span class="id"> _</span><span class="id"> _</span> (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> lef_at</span><span class="id"> x</span><span class="id"> nd_g1</span>))<span class="id"> //;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> x;</span><span class="id"> exact:</span><span class="id"> gh1</span>.<br/>
<span class="id">rewrite</span> (<span class="id">nd_ge0_integral_lim</span><span class="id"> _</span><span class="id"> _</span> (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> lef_at</span><span class="id"> x</span><span class="id"> nd_g2</span>))<span class="id"> //;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> x;</span><span class="id"> exact:</span><span class="id"> gh2</span>.<br/>
<span class="id">rewrite</span><span class="id"> limeD</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> is_cvg_sintegral</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> x</span><span class="id"> Dx;</span><span class="id"> exact/</span>(<span class="id">lef_at</span><span class="id"> x</span><span class="id"> nd_g1</span>).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> is_cvg_sintegral</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> x</span><span class="id"> Dx;</span><span class="id"> exact/</span>(<span class="id">lef_at</span><span class="id"> x</span><span class="id"> nd_g2</span>).<br/>
<span class="id">rewrite</span><span class="id"> ge0_adde_def</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> rewrite</span><span class="id"> inE;</span><span class="id"> apply:</span><span class="id"> lime_ge</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> is_cvg_sintegral</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> x</span><span class="id"> Dx;</span><span class="id"> exact/</span>(<span class="id">lef_at</span><span class="id"> x</span><span class="id"> nd_g1</span>).<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> nearW</span><span class="id"> =&gt;</span><span class="id"> n;</span><span class="id"> exact:</span><span class="id"> sintegral_ge0</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> is_cvg_sintegral</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> x</span><span class="id"> Dx;</span><span class="id"> exact/</span>(<span class="id">lef_at</span><span class="id"> x</span><span class="id"> nd_g2</span>).<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> nearW</span><span class="id"> =&gt;</span><span class="id"> n;</span><span class="id"> exact:</span><span class="id"> sintegral_ge0</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> ge0_le_integral</span><span class="id"> :</span> (<span class="gallina-kwd">forall</span><span class="id"> x,</span><span class="id"> D</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> f1</span><span class="id"> x</span><span class="id"> &lt;=</span><span class="id"> f2</span><span class="id"> x</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> f1</span><span class="id"> x</span><span class="id"> &lt;=</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> f2</span><span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> f12;</span><span class="id"> rewrite</span><span class="id"> !</span>(<span class="id">integral_mkcond</span><span class="id"> D</span>).<br/>
<span class="id">set</span><span class="id"> h1</span><span class="id"> :=</span><span class="id"> f1</span><span class="id"> \_</span><span class="id"> D;</span><span class="id"> set</span><span class="id"> h2</span><span class="id"> :=</span><span class="id"> f2</span><span class="id"> \_</span><span class="id"> D</span>.<br/>
<span class="id">have</span><span class="id"> h10</span><span class="id"> x</span><span class="id"> :</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> h1</span><span class="id"> x</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> erestrict_ge0</span>.<br/>
<span class="id">have</span><span class="id"> h20</span><span class="id"> x</span><span class="id"> :</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> h2</span><span class="id"> x</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> erestrict_ge0</span>.<br/>
<span class="id">have</span><span class="id"> mh1</span><span class="id"> :</span><span class="id"> measurable_fun</span><span class="id"> setT</span><span class="id"> h1</span><span class="gallina-kwd"> by</span><span class="id"> exact/</span>(<span class="id">measurable_restrictT</span><span class="id"> _</span><span class="id"> _</span>).<span class="id">1</span>.<br/>
<span class="id">have</span><span class="id"> mh2</span><span class="id"> :</span><span class="id"> measurable_fun</span><span class="id"> setT</span><span class="id"> h2</span><span class="gallina-kwd"> by</span><span class="id"> exact/</span>(<span class="id">measurable_restrictT</span><span class="id"> _</span><span class="id"> _</span>).<span class="id">1</span>.<br/>
<span class="id">have</span><span class="id"> h12</span><span class="id"> x</span><span class="id"> :</span><span class="id"> h1</span><span class="id"> x</span><span class="id"> &lt;=</span><span class="id"> h2</span><span class="id"> x</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> lee_restrict</span>.<br/>
<span class="id">have</span><span class="id"> [g1</span><span class="id"> [nd_g1</span><span class="id"> /</span>(_<span class="id"> _</span><span class="id"> Logic</span>.<span class="id">I</span>)<span class="id"> gh1]]</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">approximation</span><span class="id"> measurableT</span><span class="id"> mh1</span> (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> _</span><span class="id"> =&gt;</span><span class="id"> h10</span><span class="id"> _</span>).<br/>
<span class="id">rewrite</span> (<span class="id">nd_ge0_integral_lim</span><span class="id"> _</span><span class="id"> h10</span> (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> lef_at</span><span class="id"> x</span><span class="id"> nd_g1</span>)<span class="id"> gh1</span>)<span class="id">//</span>.<br/>
<span class="id">apply:</span><span class="id"> lime_le</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> is_cvg_sintegral</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> t</span><span class="id"> Dt;</span><span class="id"> exact/</span>(<span class="id">lef_at</span><span class="id"> t</span><span class="id"> nd_g1</span>).<br/>
<span class="id">near=&gt;</span><span class="id"> n;</span><span class="id"> rewrite</span><span class="id"> ge0_integralTE//;</span><span class="id"> apply:</span><span class="id"> ereal_sup_ubound</span><span class="id"> =&gt;</span><span class="id"> /=</span>.<br/>
<span class="gallina-kwd">exists</span> (<span class="id">g1</span><span class="id"> n</span>)<span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> t;</span><span class="id"> rewrite</span> (<span class="id">le_trans</span><span class="id"> _</span> (<span class="id">h12</span><span class="id"> _</span>))<span class="id"> //</span>.<br/>
<span class="id">have</span><span class="id"> :=</span><span class="id"> gh1</span><span class="id"> t</span>.<br/>
<span class="id">have</span><span class="id"> :=</span><span class="id"> leey</span> (<span class="id">h1</span><span class="id"> t</span>)<span class="id">;</span><span class="id"> rewrite</span><span class="id"> le_eqVlt</span><span class="id"> =&gt;</span><span class="id"> /predU1P[-&gt;|ftoo]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> leey</span>.<br/>
<span class="id">have</span><span class="id"> h1tfin</span><span class="id"> :</span><span class="id"> h1</span><span class="id"> t</span><span class="id"> \is</span><span class="id"> a</span><span class="id"> fin_num</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> fin_numE</span><span class="id"> gt_eqF/=</span><span class="id"> ?lt_eqF//</span> (<span class="id">lt_le_trans</span><span class="id"> _</span> (<span class="id">h10</span><span class="id"> t</span>)).<br/>
<span class="id">have</span><span class="id"> :=</span><span class="id"> gh1</span><span class="id"> t</span>.<br/>
<span class="id">rewrite</span><span class="id"> -</span>(<span class="id">fineK</span><span class="id"> h1tfin</span>)<span class="id"> =&gt;</span><span class="id"> /fine_cvgP[ft_near]</span>.<br/>
<span class="id">set</span><span class="id"> u_</span><span class="id"> :=</span> (<span class="id">X</span><span class="gallina-kwd"> in</span><span class="id"> X</span><span class="id"> --&gt;</span><span class="id"> _</span>)<span class="id"> =&gt;</span><span class="id"> u_h1</span><span class="id"> g1h1</span>.<br/>
<span class="id">have</span><span class="id"> &lt;-</span><span class="id"> :</span><span class="id"> lim</span><span class="id"> u_</span><span class="id"> =</span><span class="id"> fine</span> (<span class="id">h1</span><span class="id"> t</span>)<span class="gallina-kwd"> by</span><span class="id"> exact/cvg_lim</span>.<br/>
<span class="id">rewrite</span><span class="id"> lee_fin;</span><span class="id"> apply:</span><span class="id"> nondecreasing_cvgn_le</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> //</span><span class="id"> a</span><span class="id"> b</span><span class="id"> ab;</span><span class="id"> rewrite</span><span class="id"> /u_</span><span class="id"> /=;</span><span class="id"> exact/lefP/nd_g1</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply/cvg_ex;</span><span class="id"> eexists;</span><span class="id"> exact:</span><span class="id"> u_h1</span>.<br/>
<span class="id">Unshelve</span>.<span class="id"> all:</span><span class="gallina-kwd"> by</span><span class="id"> end_near</span>. Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> ge0_linearityD</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> approximation_sfun</span>.<br/>
<span class="vernacular">Context</span><span class="id"> d</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>).<br/>
<span class="vernacular">Variables</span> (<span class="id">D</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T</span>) (<span class="id">mD</span><span class="id"> :</span><span class="id"> measurable</span><span class="id"> D</span>) (<span class="id">mf</span><span class="id"> :</span><span class="id"> measurable_fun</span><span class="id"> D</span><span class="id"> f</span>).<br/>
<br/>
<span class="vernacular">Import</span><span class="id"> HBSimple</span>.<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> x</span><span class="id"> :</span><span class="id"> @FImFun</span><span class="id"> T</span><span class="id"> R</span> (<span class="id">cst</span><span class="id"> x</span>)<span class="id"> :=</span><span class="id"> FImFun</span>.<span class="id">on</span> (<span class="id">cst</span><span class="id"> x</span>).<br/>
<br/>
<span class="vernacular">Import</span><span class="id"> HBNNSimple</span>.<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> x</span><span class="id"> :</span><span class="id"> @NonNegFun</span><span class="id"> T</span><span class="id"> R</span> (<span class="id">cst</span><span class="id"> x%:num</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">NonNegFun</span>.<span class="id">on</span> (<span class="id">cst</span><span class="id"> x%:num</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> approximation_sfun</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">exists</span><span class="id"> g</span><span class="id"> :</span><span class="id"> {sfun</span><span class="id"> T</span><span class="id"> &gt;-&gt;</span><span class="id"> R}^nat,</span> (<span class="gallina-kwd">forall</span><span class="id"> x,</span><span class="id"> D</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> EFin</span><span class="id"> \o</span><span class="id"> g</span><span class="id"> ^~</span><span class="id"> x</span><span class="id"> @</span><span class="id"> \oo</span><span class="id"> --&gt;</span><span class="id"> f</span><span class="id"> x</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">have</span><span class="id"> [fp_</span><span class="id"> [fp_nd</span><span class="id"> fp_cvg]]</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">approximation</span><span class="id"> mD</span> (<span class="id">measurable_funepos</span><span class="id"> mf</span>) (<span class="id">fun=&gt;</span><span class="id"> ltac:</span>(<span class="gallina-kwd">by</span><span class="id"> []</span>)).<br/>
<span class="id">have</span><span class="id"> [fn_</span><span class="id"> [fn_nd</span><span class="id"> fn_cvg]]</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">approximation</span><span class="id"> mD</span> (<span class="id">measurable_funeneg</span><span class="id"> mf</span>) (<span class="id">fun=&gt;</span><span class="id"> ltac:</span>(<span class="gallina-kwd">by</span><span class="id"> []</span>)).<br/>
<span class="gallina-kwd">exists</span> (<span class="gallina-kwd">fun</span><span class="id"> n</span><span class="id"> =&gt;</span><span class="id"> [the</span><span class="id"> {sfun</span><span class="id"> T</span><span class="id"> &gt;-&gt;</span><span class="id"> R}</span><span class="id"> of</span><span class="id"> fp_</span><span class="id"> n</span><span class="id"> \+</span><span class="id"> cst</span> (<span class="id">-1</span>)<span class="id"> \*</span><span class="id"> fn_</span><span class="id"> n]</span>)<span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> /=</span>.<br/>
<span class="id">rewrite</span><span class="id"> [X</span><span class="gallina-kwd"> in</span><span class="id"> X</span><span class="id"> @</span><span class="id"> \oo</span><span class="id"> --&gt;</span><span class="id"> _]</span>(_<span class="id"> :</span><span class="id"> _</span><span class="id"> =</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">EFin</span><span class="id"> \o</span><span class="id"> fp_^~</span><span class="id"> x</span><span class="id"> \+</span> (<span class="id">-%E</span><span class="id"> \o</span><span class="id"> EFin</span><span class="id"> \o</span><span class="id"> fn_^~</span><span class="id"> x</span>))<span class="id">%E;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply/funext</span><span class="id"> =&gt;</span><span class="id"> n/=;</span><span class="id"> rewrite</span><span class="id"> EFinD</span><span class="id"> mulN1r</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> Dx;</span><span class="id"> rewrite</span> (<span class="id">funeposneg</span><span class="id"> f</span>)<span class="id">;</span><span class="id"> apply:</span><span class="id"> cvgeD;</span><br/>
&nbsp;&nbsp;<span class="id">[exact:</span><span class="id"> add_def_funeposneg|apply:</span><span class="id"> fp_cvg|apply:cvgeN;</span><span class="id"> exact:</span><span class="id"> fn_cvg]</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> approximation_sfun</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> lusin</span>.<br/>
<span class="vernacular">Hint</span><span class="id"> Extern</span><span class="id"> 0</span> (<span class="id">hausdorff_space</span><span class="id"> _</span>)<span class="id"> =&gt;</span> (<span class="id">exact:</span><span class="id"> Rhausdorff</span>)<span class="id"> :</span><span class="id"> core</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<span class="vernacular">Context</span> (<span class="id">rT</span><span class="id"> :</span><span class="id"> realType</span>) (<span class="id">A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> rT</span>).<br/>
<span class="vernacular">Let</span><span class="id"> mu</span><span class="id"> :=</span><span class="id"> [the</span><span class="id"> measure</span><span class="id"> _</span><span class="id"> _</span><span class="id"> of</span><span class="id"> @lebesgue_measure</span><span class="id"> rT]</span>.<br/>
<span class="vernacular">Let</span><span class="id"> R</span> <span class="id"> :=</span><span class="id"> [the</span><span class="id"> measurableType</span><span class="id"> _</span><span class="id"> of</span><span class="id"> measurableTypeR</span><span class="id"> rT]</span>.<br/>
<span class="vernacular">Hypothesis</span><span class="id"> mA</span><span class="id"> :</span><span class="id"> measurable</span><span class="id"> A</span>.<br/>
<span class="vernacular">Hypothesis</span><span class="id"> finA</span><span class="id"> :</span><span class="id"> mu</span><span class="id"> A</span><span class="id"> &lt;</span><span class="id"> +oo</span>.<br/>
<br/>
<span class="vernacular">Import</span><span class="id"> HBSimple</span>.<br/>
<br/>
<span class="vernacular">Let</span><span class="id"> lusin_simple</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {sfun</span><span class="id"> R</span><span class="id"> &gt;-&gt;</span><span class="id"> rT}</span>) (<span class="id">eps</span><span class="id"> :</span><span class="id"> rT</span>)<span class="id"> :</span> (<span class="id">0</span><span class="id"> &lt;</span><span class="id"> eps</span>)<span class="id">%R</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">exists</span><span class="id"> K,</span><span class="id"> [/\</span><span class="id"> compact</span><span class="id"> K,</span><span class="id"> K</span><span class="id"> `&lt;=`</span><span class="id"> A,</span><span class="id"> mu</span> (<span class="id">A</span><span class="id"> `\`</span><span class="id"> K</span>)<span class="id"> &lt;</span><span class="id"> eps%:E</span><span class="id"> &amp;</span><br/>
&nbsp;&nbsp;<span class="id">{within</span><span class="id"> K,</span><span class="id"> continuous</span><span class="id"> f}]</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move:</span><span class="id"> eps=&gt;</span><span class="id"> _/posnumP[eps];</span><span class="id"> have</span><span class="id"> [N</span><span class="id"> /card_fset_set</span><span class="id"> rfN]</span><span class="id"> :=</span><span class="id"> fimfunP</span><span class="id"> f</span>.<br/>
<span class="id">pose</span><span class="id"> Af</span><span class="id"> x</span><span class="id"> :</span><span class="id"> set</span><span class="id"> R</span><span class="id"> :=</span><span class="id"> A</span><span class="id"> `&amp;`</span><span class="id"> f</span><span class="id"> @^-1`</span><span class="id"> [set</span><span class="id"> x]</span>.<br/>
<span class="id">have</span><span class="id"> mAf</span><span class="id"> x</span><span class="id"> :</span><span class="id"> measurable</span> (<span class="id">Af</span><span class="id"> x</span>)<span class="gallina-kwd"> by</span><span class="id"> exact:</span><span class="id"> measurableI</span>.<br/>
<span class="id">have</span><span class="id"> finAf</span><span class="id"> x</span><span class="id"> :</span><span class="id"> mu</span> (<span class="id">Af</span><span class="id"> x</span>)<span class="id"> &lt;</span><span class="id"> +oo</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span> (<span class="id">le_lt_trans</span><span class="id"> _</span><span class="id"> finA</span>)<span class="id">//</span><span class="id"> le_measure//</span><span class="id"> ?inE//;</span><span class="id"> exact:</span><span class="id"> subIsetl</span>.<br/>
<span class="id">have</span><span class="id"> eNpos</span><span class="id"> :</span> (<span class="id">0</span><span class="id"> &lt;</span><span class="id"> eps%:num/N</span>.<span class="id">+1%:R</span>)<span class="id">%R</span><span class="gallina-kwd"> by</span><span class="id"> []</span>.<br/>
<span class="id">have</span><span class="id"> dK'</span><span class="id"> x</span><span class="id"> :=</span><span class="id"> lebesgue_regularity_inner</span> (<span class="id">mAf</span><span class="id"> x</span>) (<span class="id">finAf</span><span class="id"> x</span>)<span class="id"> eNpos</span>.<br/>
<span class="id">pose</span><span class="id"> dK</span><span class="id"> x</span><span class="id"> :</span><span class="id"> set</span><span class="id"> R</span><span class="id"> :=</span><span class="id"> projT1</span> (<span class="id">cid</span> (<span class="id">dK'</span><span class="id"> x</span>))<span class="id">;</span><span class="id"> pose</span><span class="id"> J</span><span class="id"> i</span><span class="id"> :</span><span class="id"> set</span><span class="id"> R</span><span class="id"> :=</span><span class="id"> Af</span><span class="id"> i</span><span class="id"> `\`</span><span class="id"> dK</span><span class="id"> i</span>.<br/>
<span class="id">have</span><span class="id"> dkP</span><span class="id"> x</span><span class="id"> :=</span><span class="id"> projT2</span> (<span class="id">cid</span> (<span class="id">dK'</span><span class="id"> x</span>)).<br/>
<span class="id">have</span><span class="id"> mdK</span><span class="id"> i</span><span class="id"> :</span><span class="id"> measurable</span> (<span class="id">dK</span><span class="id"> i</span>).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> closed_measurable;</span><span class="id"> apply:</span><span class="id"> compact_closed</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> case:</span> (<span class="id">dkP</span><span class="id"> i</span>).<br/>
<span class="id">have</span><span class="id"> mJ</span><span class="id"> i</span><span class="id"> :</span><span class="id"> measurable</span> (<span class="id">J</span><span class="id"> i</span>)<span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> measurableD</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> measurableI</span>.<br/>
<span class="id">have</span><span class="id"> dKsub</span><span class="id"> z</span><span class="id"> :</span><span class="id"> dK</span><span class="id"> z</span><span class="id"> `&lt;=`</span><span class="id"> f</span><span class="id"> @^-1`</span><span class="id"> [set</span><span class="id"> z]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> case:</span> (<span class="id">dkP</span><span class="id"> z</span>)<span class="id"> =&gt;</span><span class="id"> _</span><span class="id"> /subset_trans</span><span class="id"> +</span><span class="id"> _;</span><span class="id"> apply</span><span class="id"> =&gt;</span><span class="id"> ?</span><span class="id"> []</span>.<br/>
<span class="gallina-kwd">exists</span> (<span class="id">\bigcup_</span>(<span class="id">i</span><span class="gallina-kwd"> in</span><span class="id"> range</span><span class="id"> f</span>)<span class="id"> dK</span><span class="id"> i</span>)<span class="id">;</span><span class="id"> split</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> -bigsetU_fset_set//;</span><span class="id"> apply:</span><span class="id"> bigsetU_compact=&gt;//</span><span class="id"> i</span><span class="id"> _;</span><span class="id"> case:</span> (<span class="id">dkP</span><span class="id"> i</span>).<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> z</span><span class="id"> [y</span><span class="id"> _</span><span class="id"> dy];</span><span class="id"> have</span><span class="id"> [_</span><span class="id"> /</span>(_<span class="id"> _</span><span class="id"> dy</span>)<span class="id"> []]</span><span class="id"> :=</span><span class="id"> dkP</span><span class="id"> y</span>.<br/>
<span class="id">-</span><span class="id"> have</span><span class="id"> -&gt;</span><span class="id"> :</span><span class="id"> A</span><span class="id"> `\`</span><span class="id"> \bigcup_</span>(<span class="id">i</span><span class="gallina-kwd"> in</span><span class="id"> range</span><span class="id"> f</span>)<span class="id"> dK</span><span class="id"> i</span><span class="id"> =</span><span class="id"> \bigcup_</span>(<span class="id">i</span><span class="gallina-kwd"> in</span><span class="id"> range</span><span class="id"> f</span>)<span class="id"> J</span><span class="id"> i</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -bigcupDr</span><span class="id"> /=</span><span class="id"> ?eqEsubset;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="gallina-kwd"> exists</span> (<span class="id">f</span><span class="id"> point</span>)<span class="id">,</span><span class="id"> point</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split</span><span class="id"> =&gt;</span><span class="id"> z;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> /</span>(_ (<span class="id">f</span><span class="id"> z</span>))<span class="id"> [//|</span><span class="id"> ?</span><span class="id"> ?];</span><span class="gallina-kwd"> exists</span> (<span class="id">f</span><span class="id"> z</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">case</span><span class="id"> =&gt;</span><span class="id"> ?</span><span class="id"> [?</span><span class="id"> _</span><span class="id"> &lt;-]</span><span class="id"> [[zab</span><span class="id"> /=</span><span class="id"> &lt;-</span><span class="id"> nfz]]</span><span class="id"> ?</span><span class="id"> [r</span><span class="id"> _</span><span class="id"> &lt;-];</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move:</span><span class="id"> nfz;</span><span class="id"> apply:</span><span class="id"> contra_not</span><span class="id"> =&gt;</span><span class="id"> /[dup]</span><span class="id"> /dKsub</span><span class="id"> -&gt;</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span> (<span class="id">@le_lt_trans</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">\sum_</span>(<span class="id">i</span><span class="id"> \in</span><span class="id"> range</span><span class="id"> f</span>)<span class="id"> mu</span> (<span class="id">J</span><span class="id"> i</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> content_sub_fsum</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> fin_bigcup_measurable</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> le_lt_trans</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span> (<span class="id">@lee_fsum</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">fun=&gt;</span> (<span class="id">eps%:num</span><span class="id"> /</span><span class="id"> N</span>.<span class="id">+1%:R</span>)<span class="id">%:E</span><span class="id"> *</span><span class="id"> 1%:E</span>))<span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> i</span><span class="id"> ?;</span><span class="id"> rewrite</span><span class="id"> mule1;</span><span class="id"> apply:</span><span class="id"> ltW;</span><span class="id"> have</span><span class="id"> [_</span><span class="id"> _]</span><span class="id"> :=</span><span class="id"> dkP</span><span class="id"> i</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> /=-ge0_mule_fsumr</span><span class="id"> //</span><span class="id"> -esum_fset</span><span class="id"> //</span><span class="id"> finite_card_sum</span><span class="id"> //</span><span class="id"> -EFinM</span><span class="id"> lte_fin</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> rfN</span><span class="id"> -mulrA</span><span class="id"> gtr_pMr</span><span class="id"> //</span><span class="id"> mulrC</span><span class="id"> ltr_pdivrMr</span><span class="id"> //</span><span class="id"> mul1r</span><span class="id"> ltr_nat</span>.<br/>
<span class="id">-</span><span class="id"> suff</span><span class="id"> :</span><span class="id"> closed</span> (<span class="id">\bigcup_</span>(<span class="id">i</span><span class="gallina-kwd"> in</span><span class="id"> range</span><span class="id"> f</span>)<span class="id"> dK</span><span class="id"> i</span>)<span class="id"> /\</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">{within</span><span class="id"> \bigcup_</span>(<span class="id">i</span><span class="gallina-kwd"> in</span><span class="id"> range</span><span class="id"> f</span>)<span class="id"> dK</span><span class="id"> i,</span><span class="id"> continuous</span><span class="id"> f}</span><span class="gallina-kwd"> by</span><span class="id"> case</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -bigsetU_fset_set</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span> (<span class="id">@big_ind</span><span class="id"> _</span> (<span class="gallina-kwd">fun</span><span class="id"> U</span><span class="id"> =&gt;</span><span class="id"> closed</span><span class="id"> U</span><span class="id"> /\</span><span class="id"> {within</span><span class="id"> U,</span><span class="id"> continuous</span><span class="id"> f}</span>)).<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> split;</span><span class="id"> [exact:</span><span class="id"> closed0</span><span class="id"> |</span><span class="id"> exact:</span><span class="id"> continuous_subspace0]</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> ?</span><span class="id"> ?</span><span class="id"> [?</span><span class="id"> ?][?</span><span class="id"> ?];</span><span class="id"> split;</span><span class="id"> [exact:</span><span class="id"> closedU|exact:</span><span class="id"> withinU_continuous]</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="id"> move=&gt;</span><span class="id"> i</span><span class="id"> _;</span><span class="id"> split;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> compact_closed;</span><span class="id"> have</span><span class="id"> []</span><span class="id"> :=</span><span class="id"> dkP</span><span class="id"> i</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span> (<span class="id">continuous_subspaceW</span> (<span class="id">dKsub</span><span class="id"> i</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span> (<span class="id">@subspace_eq_continuous</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">fun=&gt;</span><span class="id"> i</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> ?</span><span class="id"> /set_mem</span><span class="id"> -&gt;</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> continuous_subspaceT</span><span class="id"> =&gt;</span><span class="id"> ?;</span><span class="id"> exact:</span><span class="id"> cvg_cst</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Let</span><span class="id"> measurable_almost_continuous'</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> rT</span><span class="id"> -&gt;</span><span class="id"> rT</span>) (<span class="id">eps</span><span class="id"> :</span><span class="id"> rT</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;(<span class="id">0</span><span class="id"> &lt;</span><span class="id"> eps</span>)<span class="id">%R</span><span class="id"> -&gt;</span><span class="id"> measurable_fun</span><span class="id"> A</span><span class="id"> f</span><span class="id"> -&gt;</span><span class="gallina-kwd"> exists</span><span class="id"> K,</span><br/>
&nbsp;&nbsp;<span class="id">[/\</span><span class="id"> measurable</span><span class="id"> K,</span><span class="id"> K</span><span class="id"> `&lt;=`</span><span class="id"> A,</span><span class="id"> mu</span> (<span class="id">A</span><span class="id"> `\`</span><span class="id"> K</span>)<span class="id"> &lt;</span><span class="id"> eps%:E</span><span class="id"> &amp;</span><br/>
&nbsp;&nbsp;<span class="id">{within</span><span class="id"> K,</span><span class="id"> continuous</span><span class="id"> f}]</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move:</span><span class="id"> eps=&gt;</span><span class="id"> _/posnumP[eps]</span><span class="id"> mf;</span><span class="id"> pose</span><span class="id"> f'</span><span class="id"> :=</span><span class="id"> EFin</span><span class="id"> \o</span><span class="id"> f</span>.<br/>
<span class="id">have</span><span class="id"> mf'</span><span class="id"> :</span><span class="id"> measurable_fun</span><span class="id"> A</span><span class="id"> f'</span><span class="gallina-kwd"> by</span><span class="id"> exact/measurable_EFinP</span>.<br/>
<span class="id">have</span><span class="id"> [/=</span><span class="id"> g_</span><span class="id"> gf']</span><span class="id"> :=</span><span class="id"> @approximation_sfun</span><span class="id"> _</span><span class="id"> R</span><span class="id"> rT</span><span class="id"> _</span><span class="id"> _</span><span class="id"> mA</span><span class="id"> mf'</span>.<br/>
<span class="id">pose</span><span class="id"> e2n</span><span class="id"> n</span><span class="id"> :=</span> (<span class="id">eps%:num</span><span class="id"> /</span><span class="id"> 2</span>)<span class="id"> /</span> (<span class="id">2</span><span class="id"> ^</span><span class="id"> n</span>.<span class="id">+1</span>)<span class="id">%:R</span>.<br/>
<span class="id">have</span><span class="id"> e2npos</span><span class="id"> n</span><span class="id"> :</span> (<span class="id">0</span><span class="id"> &lt;</span><span class="id"> e2n</span><span class="id"> n</span>)<span class="id">%R</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> divr_gt0</span>.<br/>
<span class="id">have</span><span class="id"> gK'</span><span class="id"> n</span><span class="id"> :=</span><span class="id"> @lusin_simple</span> (<span class="id">g_</span><span class="id"> n</span>) (<span class="id">e2n</span><span class="id"> n</span>) (<span class="id">e2npos</span><span class="id"> n</span>).<br/>
<span class="id">pose</span><span class="id"> gK</span><span class="id"> n</span><span class="id"> :=</span><span class="id"> projT1</span> (<span class="id">cid</span> (<span class="id">gK'</span><span class="id"> n</span>))<span class="id">;</span><span class="id"> have</span><span class="id"> gKP</span><span class="id"> n</span><span class="id"> :=</span><span class="id"> projT2</span> (<span class="id">cid</span> (<span class="id">gK'</span><span class="id"> n</span>)).<br/>
<span class="id">pose</span><span class="id"> K</span><span class="id"> :=</span><span class="id"> \bigcap_i</span><span class="id"> gK</span><span class="id"> i;</span><span class="id"> have</span><span class="id"> mgK</span><span class="id"> n</span><span class="id"> :</span><span class="id"> measurable</span> (<span class="id">gK</span><span class="id"> n</span>).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> closed_measurable;</span><span class="id"> apply:</span><span class="id"> compact_closed</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> have</span><span class="id"> []</span><span class="id"> :=</span><span class="id"> gKP</span><span class="id"> n</span>.<br/>
<span class="id">have</span><span class="id"> mK</span><span class="id"> :</span><span class="id"> measurable</span><span class="id"> K</span><span class="gallina-kwd"> by</span><span class="id"> exact:</span><span class="id"> bigcap_measurable</span>.<br/>
<span class="id">have</span><span class="id"> Kab</span><span class="id"> :</span><span class="id"> K</span><span class="id"> `&lt;=`</span><span class="id"> A</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> z</span><span class="id"> /</span>(_<span class="id"> O</span><span class="id"> I</span>)<span class="id">;</span><span class="id"> have</span><span class="id"> [_</span><span class="id"> +</span><span class="id"> _</span><span class="id"> _]</span><span class="id"> :=</span><span class="id"> gKP</span><span class="id"> O;</span><span class="id"> apply</span>.<br/>
<span class="id">have</span><span class="id"> []//</span><span class="id"> :=</span><span class="id"> @pointwise_almost_uniform</span><span class="id"> _</span><span class="id"> rT</span><span class="id"> R</span><span class="id"> mu</span><span class="id"> g_</span><span class="id"> f</span><span class="id"> K</span> (<span class="id">eps%:num</span><span class="id"> /</span><span class="id"> 2</span>).<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> n;</span><span class="id"> apply:</span><span class="id"> measurable_funTS</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span> (<span class="id">@le_lt_trans</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">mu</span><span class="id"> A</span>))<span class="id">//</span><span class="id"> le_measure//</span><span class="id"> ?inE</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> z</span><span class="id"> Kz;</span><span class="id"> have</span><span class="id"> /fine_fcvg</span><span class="id"> :=</span><span class="id"> gf'</span><span class="id"> z</span> (<span class="id">Kab</span><span class="id"> _</span><span class="id"> Kz</span>)<span class="id">;</span><span class="id"> rewrite</span><span class="id"> -fmap_comp</span><span class="id"> compA</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> D</span><span class="id"> [/=</span><span class="id"> mD</span><span class="id"> Deps</span><span class="id"> KDf];</span><span class="gallina-kwd"> exists</span> (<span class="id">K</span><span class="id"> `\`</span><span class="id"> D</span>)<span class="id">;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
<span class="id">-</span><span class="id"> exact:</span><span class="id"> measurableD</span>.<br/>
<span class="id">-</span><span class="id"> exact:</span><span class="id"> subset_trans</span><span class="id"> Kab</span>.<br/>
<span class="id">-</span><span class="id"> rewrite</span><span class="id"> setDDr;</span><span class="id"> apply:</span><span class="id"> le_lt_trans</span><span class="id"> =&gt;</span><span class="id"> /=</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> measureU2</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> apply:</span><span class="id"> measurableI</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> apply:</span><span class="id"> measurableC</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> [_%:num]splitr</span><span class="id"> EFinD;</span><span class="id"> apply:</span><span class="id"> lee_ltD</span><span class="id"> =&gt;</span><span class="id"> //=;</span><span class="id"> first</span><span class="id"> 2</span><span class="id"> last</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span> (<span class="id">@le_lt_trans</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">mu</span><span class="id"> D</span>))<span class="id"> ?le_measure</span><span class="id"> ?inE//;</span><span class="id"> exact:</span><span class="id"> measurableI</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="id"> rewrite</span><span class="id"> ge0_fin_numE//</span> (<span class="id">@le_lt_trans</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">mu</span><span class="id"> A</span>))<span class="id">//</span><span class="id"> le_measure</span><span class="id"> ?inE//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> measurableD</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> setDE</span><span class="id"> setC_bigcap</span><span class="id"> setI_bigcupr</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span> (<span class="id">@le_trans</span><span class="id"> _</span><span class="id"> _</span>(<span class="id">\sum_</span>(<span class="id">k</span><span class="id"> &lt;oo</span>)<span class="id"> mu</span> (<span class="id">A</span><span class="id"> `\`</span><span class="id"> gK</span><span class="id"> k</span>))).<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> measure_sigma_subadditive</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> [|apply:</span><span class="id"> bigcup_measurable</span><span class="id"> =&gt;</span><span class="id"> +</span><span class="id"> _]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> k</span><span class="id"> /=;</span><span class="id"> apply:</span><span class="id"> measurableD</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> apply:</span><span class="id"> mgK</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> k</span><span class="id"> /=;</span><span class="id"> apply:</span><span class="id"> measurableD</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> apply:</span><span class="id"> mgK</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span> (<span class="id">@le_trans</span><span class="id"> _</span><span class="id"> _</span>(<span class="id">\sum_</span>(<span class="id">k</span><span class="id"> &lt;oo</span>) (<span class="id">e2n</span><span class="id"> k</span>)<span class="id">%:E</span>))<span class="id">;</span><span class="id"> last</span><span class="id"> exact:</span><span class="id"> epsilon_trick0</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> lee_nneseries</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> k</span><span class="id"> _;</span><span class="id"> apply:</span><span class="id"> ltW;</span><span class="id"> have</span><span class="id"> []</span><span class="id"> :=</span><span class="id"> gKP</span><span class="id"> k</span>.<br/>
<span class="id">apply:</span> (<span class="id">@uniform_limit_continuous_subspace</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">g_</span><span class="id"> @</span><span class="id"> \oo</span>))<span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
<span class="id">near_simpl;</span><span class="id"> apply:</span><span class="id"> nearW</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> n;</span><span class="id"> apply:</span> (<span class="id">@continuous_subspaceW</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">gK</span><span class="id"> n</span>)).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> z</span><span class="id"> [+</span><span class="id"> _];</span><span class="id"> apply</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> have</span><span class="id"> []</span><span class="id"> :=</span><span class="id"> projT2</span> (<span class="id">cid</span> (<span class="id">gK'</span><span class="id"> n</span>)).<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> measurable_almost_continuous</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> rT</span><span class="id"> -&gt;</span><span class="id"> rT</span>) (<span class="id">eps</span><span class="id"> :</span><span class="id"> rT</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;(<span class="id">0</span><span class="id"> &lt;</span><span class="id"> eps</span>)<span class="id">%R</span><span class="id"> -&gt;</span><span class="id"> measurable_fun</span><span class="id"> A</span><span class="id"> f</span><span class="id"> -&gt;</span><span class="gallina-kwd"> exists</span><span class="id"> K,</span><br/>
&nbsp;&nbsp;<span class="id">[/\</span><span class="id"> compact</span><span class="id"> K,</span><span class="id"> K</span><span class="id"> `&lt;=`</span><span class="id"> A,</span><span class="id"> mu</span> (<span class="id">A</span><span class="id"> `\`</span><span class="id"> K</span>)<span class="id"> &lt;</span><span class="id"> eps%:E</span><span class="id"> &amp;</span><br/>
&nbsp;&nbsp;<span class="id">{within</span><span class="id"> K,</span><span class="id"> continuous</span><span class="id"> f}]</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move:</span><span class="id"> eps=&gt;</span><span class="id"> _/posnumP[eps]</span><span class="id"> mf;</span><span class="id"> have</span><span class="id"> e2pos</span><span class="id"> :</span> (<span class="id">0</span><span class="id"> &lt;</span><span class="id"> eps%:num/2</span>)<span class="id">%R</span><span class="gallina-kwd"> by</span><span class="id"> []</span>.<br/>
<span class="id">have</span><span class="id"> [K</span><span class="id"> [mK</span><span class="id"> KA</span><span class="id"> ?</span><span class="id"> ?]]</span><span class="id"> :=</span><span class="id"> measurable_almost_continuous'</span><span class="id"> e2pos</span><span class="id"> mf</span>.<br/>
<span class="id">have</span><span class="id"> Kfin</span><span class="id"> :</span><span class="id"> mu</span><span class="id"> K</span><span class="id"> &lt;</span><span class="id"> +oo</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span> (<span class="id">le_lt_trans</span><span class="id"> _</span><span class="id"> finA</span>)<span class="id">//</span><span class="id"> le_measure</span><span class="id"> ?inE</span>.<br/>
<span class="id">have</span><span class="id"> [D</span><span class="id"> /=</span><span class="id"> [cD</span><span class="id"> DK</span><span class="id"> KDe]]</span><span class="id"> :=</span><span class="id"> lebesgue_regularity_inner</span><span class="id"> mK</span><span class="id"> Kfin</span><span class="id"> e2pos</span>.<br/>
<span class="gallina-kwd">exists</span><span class="id"> D;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> last</span><span class="id"> exact:</span> (<span class="id">continuous_subspaceW</span><span class="id"> DK</span>).<br/>
&nbsp;&nbsp;<span class="id">exact:</span> (<span class="id">subset_trans</span><span class="id"> DK</span>).<br/>
<span class="id">have</span><span class="id"> -&gt;</span><span class="id"> :</span><span class="id"> A</span><span class="id"> `\`</span><span class="id"> D</span><span class="id"> =</span> (<span class="id">A</span><span class="id"> `\`</span><span class="id"> K</span>)<span class="id"> `|`</span> (<span class="id">K</span><span class="id"> `\`</span><span class="id"> D</span>).<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> eqEsubset;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> z</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> case:</span> (<span class="id">pselect</span> (<span class="id">K</span><span class="id"> z</span>))<span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> ?</span><span class="id"> [?</span><span class="id"> ?];</span><span class="id"> [right</span><span class="id"> |</span><span class="id"> left]</span>.<br/>
&nbsp;&nbsp;<span class="id">case;</span><span class="id"> case=&gt;</span><span class="id"> az</span><span class="id"> nz;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> [by</span><span class="id"> move:</span><span class="id"> z</span><span class="id"> nz</span><span class="id"> {az};</span><span class="id"> apply/subsetC|]</span>.<br/>
&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> KA</span>.<br/>
<span class="id">apply:</span><span class="id"> le_lt_trans</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> measureU2;</span><span class="id"> apply:</span><span class="id"> measurableD</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> apply:</span><span class="id"> closed_measurable</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> compact_closed;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> Rhausdorff</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> [_</span><span class="id"> eps]splitr</span><span class="id"> EFinD</span><span class="id"> lteD</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> lusin</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> emeasurable_fun</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<span class="vernacular">Context</span><span class="id"> d</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>).<br/>
<span class="vernacular">Implicit</span><span class="id"> Types</span> (<span class="id">D</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T</span>) (<span class="id">f</span><span class="id"> g</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>).<br/>
<br/>
<span class="vernacular">Import</span><span class="id"> HBSimple</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> emeasurable_funD</span><span class="id"> D</span><span class="id"> f</span><span class="id"> g</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">measurable_fun</span><span class="id"> D</span><span class="id"> f</span><span class="id"> -&gt;</span><span class="id"> measurable_fun</span><span class="id"> D</span><span class="id"> g</span><span class="id"> -&gt;</span><span class="id"> measurable_fun</span><span class="id"> D</span> (<span class="id">f</span><span class="id"> \+</span><span class="id"> g</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> mf</span><span class="id"> mg</span><span class="id"> mD</span>.<br/>
<span class="id">have</span><span class="id"> Cnoom</span><span class="id"> :</span><span class="id"> measurable</span> (<span class="id">~`</span><span class="id"> [set</span><span class="id"> -oo]</span><span class="id"> :</span><span class="id"> set</span> (<span class="id">\bar</span><span class="id"> R</span>))<span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> measurableC</span>.<br/>
<span class="id">have</span><span class="id"> Cpoom</span><span class="id"> :</span><span class="id"> measurable</span> (<span class="id">~`</span><span class="id"> [set</span><span class="id"> +oo]</span><span class="id"> :</span><span class="id"> set</span> (<span class="id">\bar</span><span class="id"> R</span>))<span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> measurableC</span>.<br/>
<span class="id">have</span><span class="id"> mfg</span><span class="id"> :</span> <span class="id"> measurable</span> (<span class="id">D</span><span class="id"> `&amp;`</span><span class="id"> [set</span><span class="id"> x</span><span class="id"> |</span><span class="id"> f</span><span class="id"> x</span><span class="id"> +?</span><span class="id"> g</span><span class="id"> x]</span>).<br/>
&nbsp;&nbsp;<span class="id">suff</span><span class="id"> -&gt;</span><span class="id"> :</span><span class="id"> [set</span><span class="id"> x</span><span class="id"> |</span><span class="id"> f</span><span class="id"> x</span><span class="id"> +?</span><span class="id"> g</span><span class="id"> x]</span><span class="id"> =</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">f</span><span class="id"> @^-1`</span> (<span class="id">~`</span><span class="id"> [set</span><span class="id"> +oo]</span>)<span class="id"> `|`</span><span class="id"> g</span><span class="id"> @^-1`</span> (<span class="id">~`</span><span class="id"> [set</span><span class="id"> -oo]</span>))<span class="id"> `&amp;`</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">f</span><span class="id"> @^-1`</span> (<span class="id">~`</span><span class="id"> [set</span><span class="id"> -oo]</span>)<span class="id"> `|`</span><span class="id"> g</span><span class="id"> @^-1`</span> (<span class="id">~`</span><span class="id"> [set</span><span class="id"> +oo]</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> setIIr;</span><span class="id"> apply:</span><span class="id"> measurableI;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> setIUr;</span><span class="id"> apply:</span><span class="id"> measurableU;</span><span class="id"> do</span><span class="id"> ?[apply:</span><span class="id"> mf|apply:</span><span class="id"> mg]</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="id">apply/predeqP=&gt;</span><span class="id"> x;</span><span class="id"> rewrite</span><span class="id"> /preimage/=</span><span class="id"> /adde_def</span><span class="id"> !</span>(<span class="id">negb_and,</span><span class="id"> negb_or</span>).<br/>
&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> !</span>(<span class="id">rwP2</span><span class="id"> eqP</span><span class="id"> idP</span>)<span class="id"> !</span>(<span class="id">rwP2</span><span class="id"> negP</span><span class="id"> idP</span>)<span class="id"> !</span>(<span class="id">rwP2</span><span class="id"> orP</span><span class="id"> idP</span>)<span class="id"> !</span>(<span class="id">rwP2</span><span class="id"> andP</span><span class="id"> idP</span>).<br/>
<span class="id">wlog</span><span class="id"> fg</span><span class="id"> :</span><span class="id"> D</span><span class="id"> mD</span><span class="id"> mf</span><span class="id"> mg</span><span class="id"> mfg</span><span class="id"> /</span><span class="gallina-kwd"> forall</span><span class="id"> x,</span><span class="id"> D</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> f</span><span class="id"> x</span><span class="id"> +?</span><span class="id"> g</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> [hwlogD|];</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="id">have</span><span class="id"> [f_</span><span class="id"> f_cvg]</span><span class="id"> :=</span><span class="id"> approximation_sfun</span><span class="id"> mD</span><span class="id"> mf</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="id">have</span><span class="id"> [g_</span><span class="id"> g_cvg]</span><span class="id"> :=</span><span class="id"> approximation_sfun</span><span class="id"> mD</span><span class="id"> mg</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="id">apply:</span> (<span class="id">emeasurable_fun_cvg</span> (<span class="gallina-kwd">fun</span><span class="id"> n</span><span class="id"> x</span><span class="id"> =&gt;</span> (<span class="id">f_</span><span class="id"> n</span><span class="id"> x</span><span class="id"> +</span><span class="id"> g_</span><span class="id"> n</span><span class="id"> x</span>)<span class="id">%:E</span>))<span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> n;</span><span class="id"> exact/measurable_EFinP/measurable_funTS/measurable_funD</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> x</span><span class="id"> Dx;</span><span class="id"> under</span><span class="id"> eq_fun</span><span class="id"> do</span><span class="id"> rewrite</span><span class="id"> EFinD</span>.<br/>
&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> cvgeD</span> (<span class="id">fg</span><span class="id"> _</span><span class="id"> _</span>) (<span class="id">f_cvg</span><span class="id"> _</span><span class="id"> _</span>) (<span class="id">g_cvg</span><span class="id"> _</span><span class="id"> _</span>).<br/>
<span class="id">move=&gt;</span><span class="id"> A</span><span class="id"> mA;</span><span class="id"> wlog</span><span class="id"> NAnoo:</span><span class="id"> A</span><span class="id"> mD</span><span class="id"> mf</span><span class="id"> mg</span><span class="id"> mA</span><span class="id"> /</span><span class="id"> ~</span> (<span class="id">A</span><span class="id"> -oo</span>)<span class="id"> =&gt;</span><span class="id"> [hwlogA|]</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> []</span><span class="id"> :=</span><span class="id"> pselect</span> (<span class="id">A</span><span class="id"> -oo</span>)<span class="id">;</span><span class="id"> last</span><span class="id"> exact:</span><span class="id"> hwlogA</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> /</span>(<span class="id">@setD1K</span><span class="id"> _</span><span class="id"> -oo</span>)<span class="id">&lt;-;</span><span class="id"> rewrite</span><span class="id"> preimage_setU</span><span class="id"> setIUr</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> measurableU;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> hwlogA=&gt;</span><span class="id"> //;</span><span class="id"> [exact:</span><span class="id"> measurableD|case=&gt;/=]</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> -&gt;</span><span class="id"> :</span> (<span class="id">f</span><span class="id"> \+</span><span class="id"> g</span>)<span class="id"> @^-1`</span><span class="id"> [set</span><span class="id"> -oo]</span><span class="id"> =</span><span class="id"> f</span><span class="id"> @^-1`</span><span class="id"> [set</span><span class="id"> -oo]</span><span class="id"> `|`</span><span class="id"> g</span><span class="id"> @^-1`</span><span class="id"> [set</span><span class="id"> -oo]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply/seteqP;</span><span class="id"> split=&gt;</span><span class="id"> x</span><span class="id"> /=</span><span class="id"> =&gt;</span><span class="id"> [/eqP|[]];</span><span class="id"> rewrite</span><span class="id"> /preimage/=</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> adde_eq_ninfty</span><span class="id"> =&gt;</span><span class="id"> /orP[]</span><span class="id"> /eqP</span><span class="id"> -&gt;;</span><span class="id"> [left|right]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> -&gt;</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> -&gt;;</span><span class="id"> rewrite</span><span class="id"> addeC</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> setIUr;</span><span class="id"> apply:</span><span class="id"> measurableU;</span><span class="id"> [apply:</span><span class="id"> mf|apply:</span><span class="id"> mg]</span>.<br/>
<span class="id">have-&gt;</span><span class="id"> :</span><span class="id"> D</span><span class="id"> `&amp;`</span> (<span class="id">f</span><span class="id"> \+</span><span class="id"> g</span>)<span class="id"> @^-1`</span><span class="id"> A</span><span class="id"> =</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">D</span><span class="id"> `&amp;`</span><span class="id"> [set</span><span class="id"> x</span><span class="id"> |</span><span class="id"> f</span><span class="id"> x</span><span class="id"> +?</span><span class="id"> g</span><span class="id"> x]</span>)<span class="id"> `&amp;`</span> (<span class="id">f</span><span class="id"> \+</span><span class="id"> g</span>)<span class="id"> @^-1`</span><span class="id"> A</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -setIA;</span><span class="id"> congr</span> (_<span class="id"> `&amp;`</span><span class="id"> _</span>).<br/>
&nbsp;&nbsp;<span class="id">apply/seteqP;</span><span class="id"> split=&gt;</span><span class="id"> x;</span><span class="id"> rewrite</span><span class="id"> /preimage/=;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> case</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> Afgx;</span><span class="id"> split=&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> case:</span> (<span class="id">f</span><span class="id"> x</span>) (<span class="id">g</span><span class="id"> x</span>)<span class="id"> Afgx</span><span class="id"> =&gt;</span><span class="id"> [rf||]</span><span class="id"> [rg||]</span>.<br/>
<span class="id">have</span><span class="id"> Dfg</span><span class="id"> :</span><span class="id"> D</span><span class="id"> `&amp;`</span><span class="id"> [set</span><span class="id"> x</span><span class="id"> |</span><span class="id"> f</span><span class="id"> x</span><span class="id"> +?</span><span class="id"> g</span><span class="id"> x]</span><span class="id"> `&lt;=`</span><span class="id"> D</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> subIset;</span><span class="id"> left</span>.<br/>
<span class="id">apply:</span><span class="id"> hwlogD</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span> (<span class="id">measurable_funS</span><span class="id"> mD</span>)<span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> do</span><span class="id"> ?exact:</span><span class="id"> measurableI</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span> (<span class="id">measurable_funS</span><span class="id"> mD</span>)<span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> do</span><span class="id"> ?exact:</span><span class="id"> measurableI</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> -setIA</span><span class="id"> setIid</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> ?</span><span class="id"> []</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> emeasurable_fun_sum</span><span class="id"> D</span><span class="id"> I</span><span class="id"> s</span> (<span class="id">h</span><span class="id"> :</span><span class="id"> I</span><span class="id"> -&gt;</span> (<span class="id">T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>))<span class="id"> :</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">forall</span><span class="id"> n,</span><span class="id"> measurable_fun</span><span class="id"> D</span> (<span class="id">h</span><span class="id"> n</span>))<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">measurable_fun</span><span class="id"> D</span> (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> \sum_</span>(<span class="id">i</span><span class="id"> &lt;-</span><span class="id"> s</span>)<span class="id"> h</span><span class="id"> i</span><span class="id"> x</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">elim:</span><span class="id"> s</span><span class="id"> =&gt;</span><span class="id"> [|s</span><span class="id"> t</span><span class="id"> ih]</span><span class="id"> mf</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> under</span><span class="id"> eq_fun</span><span class="id"> do</span><span class="id"> rewrite</span><span class="id"> big_nil;</span><span class="id"> exact:</span><span class="id"> measurable_cst</span>.<br/>
<span class="id">under</span><span class="id"> eq_fun</span><span class="id"> do</span><span class="id"> rewrite</span><span class="id"> big_cons</span><span class="id"> //=;</span><span class="id"> apply:</span><span class="id"> emeasurable_funD</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
<span class="id">exact:</span><span class="id"> ih</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> emeasurable_fun_fsum</span><span class="id"> D</span> (<span class="id">I</span><span class="id"> :</span><span class="id"> choiceType</span>) (<span class="id">A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> I</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">h</span><span class="id"> :</span><span class="id"> I</span><span class="id"> -&gt;</span> (<span class="id">T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>))<span class="id"> :</span><span class="id"> finite_set</span><span class="id"> A</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="gallina-kwd">forall</span><span class="id"> n,</span><span class="id"> measurable_fun</span><span class="id"> D</span> (<span class="id">h</span><span class="id"> n</span>))<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">measurable_fun</span><span class="id"> D</span> (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> \sum_</span>(<span class="id">i</span><span class="id"> \in</span><span class="id"> A</span>)<span class="id"> h</span><span class="id"> i</span><span class="id"> x</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> fs</span><span class="id"> mh;</span><span class="id"> under</span><span class="id"> eq_fun</span><span class="id"> do</span><span class="id"> rewrite</span><span class="id"> fsbig_finite//</span>.<br/>
<span class="id">exact:</span><span class="id"> emeasurable_fun_sum</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> ge0_emeasurable_fun_sum</span><span class="id"> D</span> (<span class="id">h</span><span class="id"> :</span><span class="id"> nat</span><span class="id"> -&gt;</span> (<span class="id">T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>)) (<span class="id">P</span><span class="id"> :</span><span class="id"> pred</span><span class="id"> nat</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="gallina-kwd">forall</span><span class="id"> k</span><span class="id"> x,</span><span class="id"> D</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> P</span><span class="id"> k</span><span class="id"> -&gt;</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> h</span><span class="id"> k</span><span class="id"> x</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="gallina-kwd">forall</span><span class="id"> k,</span><span class="id"> P</span><span class="id"> k</span><span class="id"> -&gt;</span><span class="id"> measurable_fun</span><span class="id"> D</span> (<span class="id">h</span><span class="id"> k</span>))<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">measurable_fun</span><span class="id"> D</span> (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> \sum_</span>(<span class="id">i</span><span class="id"> &lt;oo</span><span class="id"> |</span><span class="id"> i</span><span class="id"> \in</span><span class="id"> P</span>)<span class="id"> h</span><span class="id"> i</span><span class="id"> x</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> h0</span><span class="id"> mh</span><span class="id"> mD;</span><span class="id"> move:</span> (<span class="id">mD</span>)<span class="id">;</span><span class="id"> apply/measurable_restrictT</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
<span class="id">rewrite</span><span class="id"> [X</span><span class="gallina-kwd"> in</span><span class="id"> measurable_fun</span><span class="id"> _</span><span class="id"> X]</span>(_<span class="id"> :</span><span class="id"> _</span><span class="id"> =</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> \sum_</span>(<span class="id">0</span><span class="id"> &lt;=</span><span class="id"> i</span><span class="id"> &lt;oo</span><span class="id"> |</span><span class="id"> i</span><span class="id"> \in</span><span class="id"> P</span>) (<span class="id">h</span><span class="id"> i</span><span class="id"> \_</span><span class="id"> D</span>)<span class="id"> x</span>))<span class="id">;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">apply/funext</span><span class="id"> =&gt;</span><span class="id"> x/=;</span><span class="id"> rewrite</span><span class="id"> /patch;</span><span class="id"> case:</span><span class="id"> ifPn</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> xD</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> eseries0</span>.<br/>
<span class="id">rewrite</span><span class="id"> [X</span><span class="gallina-kwd"> in</span><span class="id"> measurable_fun</span><span class="id"> _</span><span class="id"> X]</span>(_<span class="id"> :</span><span class="id"> _</span><span class="id"> =</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> limn_esup</span> (<span class="gallina-kwd">fun</span><span class="id"> n</span><span class="id"> =&gt;</span><span class="id"> \sum_</span>(<span class="id">0</span><span class="id"> &lt;=</span><span class="id"> i</span><span class="id"> &lt;</span><span class="id"> n</span><span class="id"> |</span><span class="id"> P</span><span class="id"> i</span>) (<span class="id">h</span><span class="id"> i</span>)<span class="id"> \_</span><span class="id"> D</span><span class="id"> x</span>)))<span class="id">;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">apply/funext=&gt;</span><span class="id"> x;</span><span class="id"> rewrite</span><span class="id"> is_cvg_limn_esupE//</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> is_cvg_nneseries_cond</span><span class="id"> =&gt;</span><span class="id"> n</span><span class="id"> Pn;</span><span class="id"> rewrite</span><span class="id"> patchE</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> case:</span><span class="id"> ifPn</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> xD;</span><span class="id"> rewrite</span><span class="id"> h0//;</span><span class="id"> exact/set_mem</span>.<br/>
<span class="id">apply:</span><span class="id"> measurable_fun_limn_esup</span><span class="id"> =&gt;</span><span class="id"> k</span>.<br/>
<span class="id">under</span><span class="id"> eq_fun</span><span class="id"> do</span><span class="id"> rewrite</span><span class="id"> big_mkcond</span>.<br/>
<span class="id">apply:</span><span class="id"> emeasurable_fun_sum</span><span class="id"> =&gt;</span><span class="id"> n</span>.<br/>
<span class="id">have</span><span class="id"> [|]</span><span class="id"> :=</span><span class="id"> boolP</span> (<span class="id">n</span><span class="id"> \in</span><span class="id"> P</span>)<span class="id">;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> /in_mem/=</span><span class="id"> =&gt;</span><span class="id"> /negbTE</span><span class="id"> -&gt;</span>.<br/>
<span class="id">rewrite</span><span class="id"> /in_mem/=</span><span class="id"> =&gt;</span><span class="id"> Pn;</span><span class="id"> rewrite</span><span class="id"> Pn</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply/</span>(<span class="id">measurable_restrictT</span><span class="id"> _</span><span class="id"> _</span>).<span class="id">1</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> mh</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> emeasurable_funB</span><span class="id"> D</span><span class="id"> f</span><span class="id"> g</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">measurable_fun</span><span class="id"> D</span><span class="id"> f</span><span class="id"> -&gt;</span><span class="id"> measurable_fun</span><span class="id"> D</span><span class="id"> g</span><span class="id"> -&gt;</span><span class="id"> measurable_fun</span><span class="id"> D</span> (<span class="id">f</span><span class="id"> \-</span><span class="id"> g</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> mf</span><span class="id"> mg</span><span class="id"> mD;</span><span class="id"> apply:</span><span class="id"> emeasurable_funD</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> measurableT_comp</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> emeasurable_funM</span><span class="id"> D</span><span class="id"> f</span><span class="id"> g</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">measurable_fun</span><span class="id"> D</span><span class="id"> f</span><span class="id"> -&gt;</span><span class="id"> measurable_fun</span><span class="id"> D</span><span class="id"> g</span><span class="id"> -&gt;</span><span class="id"> measurable_fun</span><span class="id"> D</span> (<span class="id">f</span><span class="id"> \*</span><span class="id"> g</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> mf</span><span class="id"> mg</span><span class="id"> mD</span>.<br/>
<span class="id">have</span><span class="id"> m0</span><span class="id"> :</span><span class="id"> measurable</span> (<span class="id">[set</span><span class="id"> 0]</span><span class="id"> :</span><span class="id"> set</span> (<span class="id">\bar</span><span class="id"> R</span>))<span class="gallina-kwd"> by</span><span class="id"> []</span>.<br/>
<span class="id">have</span><span class="id"> mC0</span><span class="id"> :</span><span class="id"> measurable</span> (<span class="id">[set~</span><span class="id"> 0]</span><span class="id"> :</span><span class="id"> set</span> (<span class="id">\bar</span><span class="id"> R</span>))<span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> measurableC</span>.<br/>
<span class="id">have</span><span class="id"> mCoo</span><span class="id"> :</span><span class="id"> measurable</span> (<span class="id">~`</span><span class="id"> [set</span><span class="id"> -oo;</span><span class="id"> +oo]</span><span class="id"> :</span><span class="id"> set</span> (<span class="id">\bar</span><span class="id"> R</span>)).<br/>
&nbsp;&nbsp;<span class="id">exact/measurableC/measurableU</span>.<br/>
<span class="id">have</span><span class="id"> mfg</span><span class="id"> :</span><span class="id"> measurable</span> (<span class="id">D</span><span class="id"> `&amp;`</span><span class="id"> [set</span><span class="id"> x</span><span class="id"> |</span><span class="id"> f</span><span class="id"> x</span><span class="id"> *?</span><span class="id"> g</span><span class="id"> x]</span>).<br/>
&nbsp;&nbsp;<span class="id">suff</span><span class="id"> -&gt;</span><span class="id"> :</span><span class="id"> [set</span><span class="id"> x</span><span class="id"> |</span><span class="id"> f</span><span class="id"> x</span><span class="id"> *?</span><span class="id"> g</span><span class="id"> x]</span><span class="id"> =</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">f</span><span class="id"> @^-1`</span> (<span class="id">~`</span><span class="id"> [set</span><span class="id"> 0]</span>)<span class="id"> `|`</span><span class="id"> g</span><span class="id"> @^-1`</span> (<span class="id">~`</span><span class="id"> [set</span><span class="id"> -oo;</span><span class="id"> +oo]</span>))<span class="id"> `&amp;`</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">g</span><span class="id"> @^-1`</span> (<span class="id">~`</span><span class="id"> [set</span><span class="id"> 0]</span>)<span class="id"> `|`</span><span class="id"> f</span><span class="id"> @^-1`</span> (<span class="id">~`</span><span class="id"> [set</span><span class="id"> -oo;</span><span class="id"> +oo]</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> setIIr;</span><span class="id"> apply:</span><span class="id"> measurableI;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> setIUr;</span><span class="id"> apply:</span><span class="id"> measurableU;</span><span class="id"> do</span><span class="id"> ?[apply:</span><span class="id"> mf|apply:</span><span class="id"> mg]</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="id">apply/predeqP=&gt;</span><span class="id"> x;</span><span class="id"> rewrite</span><span class="id"> /preimage/=</span><span class="id"> /mule_def</span><span class="id"> !</span>(<span class="id">negb_and,</span><span class="id"> negb_or</span>).<br/>
&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> !</span>(<span class="id">rwP2</span><span class="id"> eqP</span><span class="id"> idP</span>)<span class="id"> !</span>(<span class="id">rwP2</span><span class="id"> negP</span><span class="id"> idP</span>)<span class="id"> !</span>(<span class="id">rwP2</span><span class="id"> orP</span><span class="id"> idP</span>).<br/>
&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> !</span>(<span class="id">rwP2</span><span class="id"> negP</span><span class="id"> idP</span>)<span class="id"> !</span>(<span class="id">rwP2</span><span class="id"> orP</span><span class="id"> idP</span>)<span class="id"> !</span>(<span class="id">rwP2</span><span class="id"> andP</span><span class="id"> idP</span>).<br/>
&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> eqe_absl</span><span class="id"> leey</span><span class="id"> andbT</span> (<span class="id">orbC</span> (<span class="id">g</span><span class="id"> x</span><span class="id"> ==</span><span class="id"> +oo</span>)).<br/>
&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> eqe_absl</span><span class="id"> leey</span><span class="id"> andbT</span> (<span class="id">orbC</span> (<span class="id">f</span><span class="id"> x</span><span class="id"> ==</span><span class="id"> +oo</span>)).<br/>
<span class="id">wlog</span><span class="id"> fg</span><span class="id"> :</span><span class="id"> D</span><span class="id"> mD</span><span class="id"> mf</span><span class="id"> mg</span><span class="id"> mfg</span><span class="id"> /</span><span class="gallina-kwd"> forall</span><span class="id"> x,</span><span class="id"> D</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> f</span><span class="id"> x</span><span class="id"> *?</span><span class="id"> g</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> [hwlogM|];</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> [f_</span><span class="id"> f_cvg]</span><span class="id"> :=</span><span class="id"> approximation_sfun</span><span class="id"> mD</span><span class="id"> mf</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> [g_</span><span class="id"> g_cvg]</span><span class="id"> :=</span><span class="id"> approximation_sfun</span><span class="id"> mD</span><span class="id"> mg</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span> (<span class="id">emeasurable_fun_cvg</span> (<span class="gallina-kwd">fun</span><span class="id"> n</span><span class="id"> x</span><span class="id"> =&gt;</span> (<span class="id">f_</span><span class="id"> n</span><span class="id"> x</span><span class="id"> *</span><span class="id"> g_</span><span class="id"> n</span><span class="id"> x</span>)<span class="id">%:E</span>))<span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> n;</span><span class="id"> apply/measurable_EFinP</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> measurable_funM</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> measurable_funTS</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> x</span><span class="id"> Dx;</span><span class="id"> under</span><span class="id"> eq_fun</span><span class="id"> do</span><span class="id"> rewrite</span><span class="id"> EFinM</span>.<br/>
&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> cvgeM</span> (<span class="id">fg</span><span class="id"> _</span><span class="id"> _</span>) (<span class="id">f_cvg</span><span class="id"> _</span><span class="id"> _</span>) (<span class="id">g_cvg</span><span class="id"> _</span><span class="id"> _</span>).<br/>
<span class="id">move=&gt;</span><span class="id"> A</span><span class="id"> mA;</span><span class="id"> wlog</span><span class="id"> NA0:</span><span class="id"> A</span><span class="id"> mD</span><span class="id"> mf</span><span class="id"> mg</span><span class="id"> mA</span><span class="id"> /</span><span class="id"> ~</span> (<span class="id">A</span><span class="id"> 0</span>)<span class="id"> =&gt;</span><span class="id"> [hwlogA|]</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> []</span><span class="id"> :=</span><span class="id"> pselect</span> (<span class="id">A</span><span class="id"> 0</span>)<span class="id">;</span><span class="id"> last</span><span class="id"> exact:</span><span class="id"> hwlogA</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> /</span>(<span class="id">@setD1K</span><span class="id"> _</span><span class="id"> 0</span>)<span class="id">&lt;-;</span><span class="id"> rewrite</span><span class="id"> preimage_setU</span><span class="id"> setIUr</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> measurableU;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> hwlogA=&gt;</span><span class="id"> //;</span><span class="id"> [exact:</span><span class="id"> measurableD|case=&gt;/=]</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> -&gt;</span><span class="id"> :</span> (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> f</span><span class="id"> x</span><span class="id"> *</span><span class="id"> g</span><span class="id"> x</span>)<span class="id"> @^-1`</span><span class="id"> [set</span><span class="id"> 0]</span><span class="id"> =</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">f</span><span class="id"> @^-1`</span><span class="id"> [set</span><span class="id"> 0]</span><span class="id"> `|`</span><span class="id"> g</span><span class="id"> @^-1`</span><span class="id"> [set</span><span class="id"> 0]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply/seteqP;</span><span class="id"> split=&gt;</span><span class="id"> x</span><span class="id"> /=</span><span class="id"> =&gt;</span><span class="id"> [/eqP|[]];</span><span class="id"> rewrite</span><span class="id"> /preimage/=</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> mule_eq0</span><span class="id"> =&gt;</span><span class="id"> /orP[]</span><span class="id"> /eqP-&gt;;</span><span class="id"> [left|right]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> -&gt;;</span><span class="id"> rewrite</span><span class="id"> mul0e</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> -&gt;;</span><span class="id"> rewrite</span><span class="id"> mule0</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> setIUr;</span><span class="id"> apply:</span><span class="id"> measurableU;</span><span class="id"> [apply:</span><span class="id"> mf|apply:</span><span class="id"> mg]</span>.<br/>
<span class="id">have-&gt;</span><span class="id"> :</span><span class="id"> D</span><span class="id"> `&amp;`</span> (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> f</span><span class="id"> x</span><span class="id"> *</span><span class="id"> g</span><span class="id"> x</span>)<span class="id"> @^-1`</span><span class="id"> A</span><span class="id"> =</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">D</span><span class="id"> `&amp;`</span><span class="id"> [set</span><span class="id"> x</span><span class="id"> |</span><span class="id"> f</span><span class="id"> x</span><span class="id"> *?</span><span class="id"> g</span><span class="id"> x]</span>)<span class="id"> `&amp;`</span> (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> f</span><span class="id"> x</span><span class="id"> *</span><span class="id"> g</span><span class="id"> x</span>)<span class="id"> @^-1`</span><span class="id"> A</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -setIA;</span><span class="id"> congr</span> (_<span class="id"> `&amp;`</span><span class="id"> _</span>).<br/>
&nbsp;&nbsp;<span class="id">apply/seteqP;</span><span class="id"> split=&gt;</span><span class="id"> x;</span><span class="id"> rewrite</span><span class="id"> /preimage/=;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> case</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> Afgx;</span><span class="id"> split=&gt;</span><span class="id"> //;</span><span class="id"> apply:</span><span class="id"> neq0_mule_def</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> contra_notT</span><span class="id"> NA0;</span><span class="id"> rewrite</span><span class="id"> negbK</span><span class="id"> =&gt;</span><span class="id"> /eqP</span><span class="id"> &lt;-</span>.<br/>
<span class="id">have</span><span class="id"> Dfg</span><span class="id"> :</span><span class="id"> D</span><span class="id"> `&amp;`</span><span class="id"> [set</span><span class="id"> x</span><span class="id"> |</span><span class="id"> f</span><span class="id"> x</span><span class="id"> *?</span><span class="id"> g</span><span class="id"> x]</span><span class="id"> `&lt;=`</span><span class="id"> D</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> subIset;</span><span class="id"> left</span>.<br/>
<span class="id">apply:</span><span class="id"> hwlogM</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span> (<span class="id">measurable_funS</span><span class="id"> mD</span>)<span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> do</span><span class="id"> ?exact:</span><span class="id"> measurableI</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span> (<span class="id">measurable_funS</span><span class="id"> mD</span>)<span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> do</span><span class="id"> ?exact:</span><span class="id"> measurableI</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> -setIA</span><span class="id"> setIid</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> ?</span><span class="id"> []</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> measurable_funeM</span><span class="id"> D</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>) (<span class="id">k</span><span class="id"> :</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">measurable_fun</span><span class="id"> D</span><span class="id"> f</span><span class="id"> -&gt;</span><span class="id"> measurable_fun</span><span class="id"> D</span> (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> k</span><span class="id"> *</span><span class="id"> f</span><span class="id"> x</span>)<span class="id">%E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> mf;</span><span class="id"> exact/</span>(<span class="id">emeasurable_funM</span><span class="id"> _</span><span class="id"> mf</span>). Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> emeasurable_fun</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> measurable_fun_measurable2</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<span class="vernacular">Context</span><span class="id"> d</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>).<br/>
<span class="vernacular">Variables</span> (<span class="id">D</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T</span>) (<span class="id">mD</span><span class="id"> :</span><span class="id"> measurable</span><span class="id"> D</span>).<br/>
<span class="vernacular">Implicit</span><span class="id"> Types</span><span class="id"> f</span><span class="id"> g</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> emeasurable_fun_lt</span><span class="id"> f</span><span class="id"> g</span><span class="id"> :</span><span class="id"> measurable_fun</span><span class="id"> D</span><span class="id"> f</span><span class="id"> -&gt;</span><span class="id"> measurable_fun</span><span class="id"> D</span><span class="id"> g</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">measurable</span> (<span class="id">D</span><span class="id"> `&amp;`</span><span class="id"> [set</span><span class="id"> x</span><span class="id"> |</span><span class="id"> f</span><span class="id"> x</span><span class="id"> &lt;</span><span class="id"> g</span><span class="id"> x]</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> mf</span><span class="id"> mg;</span><span class="id"> under</span><span class="id"> eq_set</span><span class="id"> do</span><span class="id"> rewrite</span><span class="id"> -sube_gt0</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> emeasurable_fun_o_infty</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> emeasurable_funB</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> emeasurable_fun_le</span><span class="id"> f</span><span class="id"> g</span><span class="id"> :</span><span class="id"> measurable_fun</span><span class="id"> D</span><span class="id"> f</span><span class="id"> -&gt;</span><span class="id"> measurable_fun</span><span class="id"> D</span><span class="id"> g</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">measurable</span> (<span class="id">D</span><span class="id"> `&amp;`</span><span class="id"> [set</span><span class="id"> x</span><span class="id"> |</span><span class="id"> f</span><span class="id"> x</span><span class="id"> &lt;=</span><span class="id"> g</span><span class="id"> x]</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> mf</span><span class="id"> mg;</span><span class="id"> under</span><span class="id"> eq_set</span><span class="id"> do</span><span class="id"> rewrite</span><span class="id"> -sube_le0</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> emeasurable_fun_infty_c</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> emeasurable_funB</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> emeasurable_fun_eq</span><span class="id"> f</span><span class="id"> g</span><span class="id"> :</span><span class="id"> measurable_fun</span><span class="id"> D</span><span class="id"> f</span><span class="id"> -&gt;</span><span class="id"> measurable_fun</span><span class="id"> D</span><span class="id"> g</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">measurable</span> (<span class="id">D</span><span class="id"> `&amp;`</span><span class="id"> [set</span><span class="id"> x</span><span class="id"> |</span><span class="id"> f</span><span class="id"> x</span><span class="id"> =</span><span class="id"> g</span><span class="id"> x]</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> mf</span><span class="id"> mg;</span><span class="id"> rewrite</span><span class="id"> set_eq_le</span><span class="id"> setIIr</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> measurableI;</span><span class="id"> apply:</span><span class="id"> emeasurable_fun_le</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> emeasurable_fun_neq</span><span class="id"> f</span><span class="id"> g</span><span class="id"> :</span><span class="id"> measurable_fun</span><span class="id"> D</span><span class="id"> f</span><span class="id"> -&gt;</span><span class="id"> measurable_fun</span><span class="id"> D</span><span class="id"> g</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">measurable</span> (<span class="id">D</span><span class="id"> `&amp;`</span><span class="id"> [set</span><span class="id"> x</span><span class="id"> |</span><span class="id"> f</span><span class="id"> x</span><span class="id"> !=</span><span class="id"> g</span><span class="id"> x]</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> mf</span><span class="id"> mg;</span><span class="id"> rewrite</span><span class="id"> set_neq_lt</span><span class="id"> setIUr</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> measurableU;</span><span class="id"> exact:</span><span class="id"> emeasurable_fun_lt</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> measurable_fun_measurable2</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> ge0_integral_sum</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<span class="vernacular">Context</span><span class="id"> d</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>).<br/>
<span class="vernacular">Variables</span> (<span class="id">mu</span><span class="id"> :</span><span class="id"> {measure</span><span class="id"> set</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R}</span>) (<span class="id">D</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T</span>) (<span class="id">mD</span><span class="id"> :</span><span class="id"> measurable</span><span class="id"> D</span>).<br/>
<span class="vernacular">Variables</span> (<span class="id">I</span><span class="id"> :</span><span class="gallina-kwd"> Type</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> I</span><span class="id"> -&gt;</span> (<span class="id">T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>)).<br/>
<span class="vernacular">Hypothesis</span><span class="id"> mf</span><span class="id"> :</span><span class="gallina-kwd"> forall</span><span class="id"> n,</span><span class="id"> measurable_fun</span><span class="id"> D</span> (<span class="id">f</span><span class="id"> n</span>).<br/>
<span class="vernacular">Hypothesis</span><span class="id"> f0</span><span class="id"> :</span><span class="gallina-kwd"> forall</span><span class="id"> n</span><span class="id"> x,</span><span class="id"> D</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> f</span><span class="id"> n</span><span class="id"> x</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> ge0_integral_sum</span> (<span class="id">s</span><span class="id"> :</span><span class="id"> seq</span><span class="id"> I</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>) (<span class="id">\sum_</span>(<span class="id">k</span><span class="id"> &lt;-</span><span class="id"> s</span>)<span class="id"> f</span><span class="id"> k</span><span class="id"> x</span>)<span class="id"> =</span><br/>
&nbsp;&nbsp;<span class="id">\sum_</span>(<span class="id">k</span><span class="id"> &lt;-</span><span class="id"> s</span>)<span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>) (<span class="id">f</span><span class="id"> k</span><span class="id"> x</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">elim:</span><span class="id"> s</span><span class="id"> =&gt;</span><span class="id"> [|h</span><span class="id"> t</span><span class="id"> ih]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span> (<span class="id">under</span><span class="id"> eq_fun</span><span class="id"> do</span><span class="id"> rewrite</span><span class="id"> big_nil</span>)<span class="id">;</span><span class="id"> rewrite</span><span class="id"> big_nil</span><span class="id"> integral0</span>.<br/>
<span class="id">rewrite</span><span class="id"> big_cons</span><span class="id"> /=</span><span class="id"> -ih</span><span class="id"> -ge0_integralD//</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> eq_integral</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> Dx;</span><span class="id"> rewrite</span><span class="id"> big_cons</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> *;</span><span class="id"> exact:</span><span class="id"> f0</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> *;</span><span class="id"> apply:</span><span class="id"> sume_ge0</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> k</span><span class="id"> _;</span><span class="id"> exact:</span><span class="id"> f0</span>.<br/>
<span class="id">-</span><span class="id"> exact:</span><span class="id"> emeasurable_fun_sum</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> ge0_integral_sum</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> ge0_integral_fsum</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<span class="vernacular">Context</span><span class="id"> d</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>).<br/>
<span class="vernacular">Variables</span> (<span class="id">mu</span><span class="id"> :</span><span class="id"> {measure</span><span class="id"> set</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R}</span>) (<span class="id">D</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T</span>) (<span class="id">mD</span><span class="id"> :</span><span class="id"> measurable</span><span class="id"> D</span>).<br/>
<span class="vernacular">Variables</span> (<span class="id">I</span><span class="id"> :</span><span class="id"> choiceType</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> I</span><span class="id"> -&gt;</span> (<span class="id">T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>)).<br/>
<span class="vernacular">Hypothesis</span><span class="id"> mf</span><span class="id"> :</span><span class="gallina-kwd"> forall</span><span class="id"> n,</span><span class="id"> measurable_fun</span><span class="id"> D</span> (<span class="id">f</span><span class="id"> n</span>).<br/>
<span class="vernacular">Hypothesis</span><span class="id"> f0</span><span class="id"> :</span><span class="gallina-kwd"> forall</span><span class="id"> n</span><span class="id"> x,</span><span class="id"> D</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> f</span><span class="id"> n</span><span class="id"> x</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> ge0_integral_fsum</span> (<span class="id">A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> I</span>)<span class="id"> :</span><span class="id"> finite_set</span><span class="id"> A</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>) (<span class="id">\sum_</span>(<span class="id">k</span><span class="id"> \in</span><span class="id"> A</span>)<span class="id"> f</span><span class="id"> k</span><span class="id"> x</span>)<span class="id"> =</span><br/>
&nbsp;&nbsp;<span class="id">\sum_</span>(<span class="id">k</span><span class="id"> \in</span><span class="id"> A</span>)<span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> f</span><span class="id"> k</span><span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> fs;</span><span class="id"> rewrite</span><span class="id"> fsbig_finite//=</span><span class="id"> -ge0_integral_sum//</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> eq_integral</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> xD;</span><span class="id"> rewrite</span><span class="id"> fsbig_finite</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> ge0_integral_fsum</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> monotone_convergence_theorem</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<span class="vernacular">Context</span><span class="id"> d</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>).<br/>
<span class="vernacular">Variable</span><span class="id"> mu</span><span class="id"> :</span><span class="id"> {measure</span><span class="id"> set</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R}</span>.<br/>
<span class="vernacular">Variables</span> (<span class="id">D</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T</span>) (<span class="id">mD</span><span class="id"> :</span><span class="id"> measurable</span><span class="id"> D</span>) (<span class="id">g'</span><span class="id"> :</span> (<span class="id">T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id">^nat</span>).<br/>
<span class="vernacular">Hypothesis</span><span class="id"> mg'</span><span class="id"> :</span><span class="gallina-kwd"> forall</span><span class="id"> n,</span><span class="id"> measurable_fun</span><span class="id"> D</span> (<span class="id">g'</span><span class="id"> n</span>).<br/>
<span class="vernacular">Hypothesis</span><span class="id"> g'0</span><span class="id"> :</span><span class="gallina-kwd"> forall</span><span class="id"> n</span><span class="id"> x,</span><span class="id"> D</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> g'</span><span class="id"> n</span><span class="id"> x</span>.<br/>
<span class="vernacular">Hypothesis</span><span class="id"> nd_g'</span><span class="id"> :</span><span class="gallina-kwd"> forall</span><span class="id"> x,</span><span class="id"> D</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> nondecreasing_seq</span> (<span class="id">g'^~</span><span class="id"> x</span>).<br/>
<span class="vernacular">Let</span><span class="id"> f'</span><span class="id"> :=</span><span class="gallina-kwd"> fun</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> limn</span> (<span class="id">g'^~</span><span class="id"> x</span>).<br/>
<br/>
<span class="vernacular">Let</span><span class="id"> g</span><span class="id"> n</span><span class="id"> :=</span> (<span class="id">g'</span><span class="id"> n</span><span class="id"> \_</span><span class="id"> D</span>).<br/>
<br/>
<span class="vernacular">Let</span><span class="id"> g0</span><span class="id"> n</span><span class="id"> x</span><span class="id"> :</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> g</span><span class="id"> n</span><span class="id"> x</span><br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id"> exact/erestrict_ge0/g'0</span>. Qed.</div></details>
<br/>
<span class="vernacular">Let</span><span class="id"> mg</span><span class="id"> n</span><span class="id"> :</span><span class="id"> measurable_fun</span><span class="id"> setT</span> (<span class="id">g</span><span class="id"> n</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id"> exact/</span>(<span class="id">measurable_restrictT</span><span class="id"> _</span><span class="id"> _</span>).<span class="id">1</span>. Qed.</div></details>
<br/>
<span class="vernacular">Let</span><span class="id"> nd_g</span><span class="id"> x</span><span class="id"> :</span><span class="id"> nondecreasing_seq</span> (<span class="id">g^~</span><span class="id"> x</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> m</span><span class="id"> n</span><span class="id"> mn;</span><span class="id"> rewrite</span><span class="id"> /g/patch;</span><span class="id"> case:</span><span class="id"> ifP</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> /set_mem</span><span class="id"> /nd_g'</span><span class="id"> -&gt;</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Let</span><span class="id"> f</span><span class="id"> :=</span><span class="gallina-kwd"> fun</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> limn</span> (<span class="id">g^~</span><span class="id"> x</span>).<br/>
<br/>
<span class="vernacular">Let</span><span class="id"> is_cvg_g</span><span class="id"> t</span><span class="id"> :</span><span class="id"> cvgn</span> (<span class="id">g^~</span><span class="id"> t</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> ?;</span><span class="id"> apply:</span><span class="id"> ereal_nondecreasing_is_cvgn</span><span class="id"> =&gt;</span><span class="id"> m</span><span class="id"> n</span><span class="id"> ?;</span><span class="id"> exact/nd_g</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Local</span><span class="vernacular"> Definition</span><span class="id"> g2'</span><span class="id"> n</span><span class="id"> :</span> (<span class="id">T</span><span class="id"> -&gt;</span><span class="id"> R</span>)<span class="id">^nat</span><span class="id"> :=</span><span class="id"> approx</span><span class="id"> setT</span> (<span class="id">g</span><span class="id"> n</span>).<br/>
<span class="vernacular">Local</span><span class="vernacular"> Definition</span><span class="id"> g2</span><span class="id"> n</span><span class="id"> :</span><span class="id"> {nnsfun</span><span class="id"> T</span><span class="id"> &gt;-&gt;</span><span class="id"> R}^nat</span><span class="id"> :=</span><span class="id"> nnsfun_approx</span><span class="id"> measurableT</span> (<span class="id">mg</span><span class="id"> n</span>).<br/>
<br/>
<span class="vernacular">Local</span><span class="vernacular"> Definition</span><span class="id"> max_g2'</span><span class="id"> :</span> (<span class="id">T</span><span class="id"> -&gt;</span><span class="id"> R</span>)<span class="id">^nat</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">fun</span><span class="id"> k</span><span class="id"> t</span><span class="id"> =&gt;</span> (<span class="id">\big[maxr/0]_</span>(<span class="id">i</span><span class="id"> &lt;</span><span class="id"> k</span>) (<span class="id">g2'</span><span class="id"> i</span><span class="id"> k</span>)<span class="id"> t</span>)<span class="id">%R</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Definition</span><span class="id"> max_g2</span><span class="id"> :</span><span class="id"> {nnsfun</span><span class="id"> T</span><span class="id"> &gt;-&gt;</span><span class="id"> R}^nat</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">fun</span><span class="id"> k</span><span class="id"> =&gt;</span><span class="id"> bigmax_nnsfun</span> (<span class="id">g2^~</span><span class="id"> k</span>)<span class="id"> k</span>.<br/>
<br/>
<span class="vernacular">Import</span><span class="id"> HBNNSimple</span>.<br/>
<br/>
<span class="vernacular">Let</span><span class="id"> is_cvg_g2</span><span class="id"> n</span><span class="id"> t</span><span class="id"> :</span><span class="id"> cvgn</span> (<span class="id">EFin</span><span class="id"> \o</span> (<span class="id">g2</span><span class="id"> n</span><span class="id"> ^~</span><span class="id"> t</span>)).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">apply:</span><span class="id"> ereal_nondecreasing_is_cvgn</span><span class="id"> =&gt;</span><span class="id"> a</span><span class="id"> b</span><span class="id"> ab</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> lee_fin</span><span class="id"> 2!nnsfun_approxE;</span><span class="id"> exact/lefP/nd_approx</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Let</span><span class="id"> nd_max_g2</span><span class="id"> :</span><span class="id"> nondecreasing_seq</span> (<span class="id">max_g2</span><span class="id"> :</span> (<span class="id">T</span><span class="id"> -&gt;</span><span class="id"> R</span>)<span class="id">^nat</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">apply/nondecreasing_seqP</span><span class="id"> =&gt;</span><span class="id"> n;</span><span class="id"> apply/lefP</span><span class="id"> =&gt;</span><span class="id"> x;</span><span class="id"> rewrite</span><span class="id"> 2!bigmax_nnsfunE</span>.<br/>
<span class="id">rewrite</span> (<span class="id">@le_trans</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">\big[maxr/0]_</span>(<span class="id">i</span><span class="id"> &lt;</span><span class="id"> n</span>)<span class="id"> g2</span><span class="id"> i</span><span class="id"> n</span>.<span class="id">+1</span><span class="id"> x</span>)<span class="id">%R</span>)<span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> le_bigmax2</span><span class="id"> =&gt;</span><span class="id"> i</span><span class="id"> _;</span><span class="id"> apply:</span> (<span class="id">nondecreasing_seqP</span> (<span class="id">g2</span><span class="id"> i</span><span class="id"> ^~</span><span class="id"> x</span>)).<span class="id">2</span><span class="id"> =&gt;</span><span class="id"> a</span><span class="id"> b</span><span class="id"> ab</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> !nnsfun_approxE;</span><span class="id"> exact/lefP/nd_approx</span>.<br/>
<span class="id">rewrite</span> (<span class="id">bigmaxD1</span><span class="id"> ord_max</span>)<span class="id">//</span><span class="id"> le_max;</span><span class="id"> apply/orP;</span><span class="id"> right</span>.<br/>
<span class="id">rewrite</span><span class="id"> [leRHS]</span>(<span class="id">eq_bigl</span> (<span class="gallina-kwd">fun</span><span class="id"> i</span><span class="id"> =&gt;</span><span class="id"> nat_of_ord</span><span class="id"> i</span><span class="id"> &lt;</span><span class="id"> n</span>)<span class="id">%N</span>).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span> (<span class="id">big_ord_narrow</span> (<span class="id">leqnSn</span><span class="id"> n</span>)).<br/>
<span class="id">move=&gt;</span><span class="id"> i</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> neq_lt;</span><span class="id"> apply/orP/idP</span><span class="id"> =&gt;</span><span class="id"> [[//|]|];</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> left</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> /</span>(<span class="id">leq_trans</span> (<span class="id">ltn_ord</span><span class="id"> i</span>))<span class="id">;</span><span class="id"> rewrite</span><span class="id"> ltnn</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Let</span><span class="id"> is_cvg_max_g2</span><span class="id"> t</span><span class="id"> :</span><span class="id"> cvgn</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> max_g2</span><span class="id"> ^~</span><span class="id"> t</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">apply:</span><span class="id"> ereal_nondecreasing_is_cvgn</span><span class="id"> =&gt;</span><span class="id"> m</span><span class="id"> n</span><span class="id"> mn;</span><span class="id"> rewrite</span><span class="id"> lee_fin</span>.<br/>
<span class="id">exact/lefP/nd_max_g2</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Let</span><span class="id"> max_g2_g</span><span class="id"> k</span><span class="id"> x</span><span class="id"> :</span> ((<span class="id">max_g2</span><span class="id"> k</span><span class="id"> x</span>)<span class="id">%:E</span><span class="id"> &lt;=</span><span class="id"> g</span><span class="id"> k</span><span class="id"> x</span>)<span class="id">%O</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> bigmax_nnsfunE</span>.<br/>
<span class="id">apply:</span> (<span class="id">@le_trans</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">\big[maxe/0%:E]_</span>(<span class="id">i</span><span class="id"> &lt;</span><span class="id"> k</span>)<span class="id"> g</span><span class="id"> k</span><span class="id"> x</span>))<span class="id">;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply/bigmax_leP;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> apply:</span><span class="id"> g0D</span>.<br/>
<span class="id">rewrite</span> (<span class="id">big_morph</span><span class="id"> _</span> (<span class="id">@EFin_max</span><span class="id"> R</span>)<span class="id"> erefl</span>)<span class="id"> //</span>.<br/>
<span class="id">apply:</span><span class="id"> le_bigmax2</span><span class="id"> =&gt;</span><span class="id"> i</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> nnsfun_approxE</span><span class="id"> /=</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span> (<span class="id">le_trans</span> (<span class="id">le_approx</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span>))<span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact/nd_g/ltnW</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Let</span><span class="id"> lim_max_g2_f</span><span class="id"> t</span><span class="id"> :</span><span class="id"> limn</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> max_g2</span><span class="id"> ^~</span><span class="id"> t</span>)<span class="id"> &lt;=</span><span class="id"> f</span><span class="id"> t</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> lee_lim</span><span class="id"> =&gt;</span><span class="id"> //=;</span><span class="id"> near=&gt;</span><span class="id"> n;</span><span class="id"> exact/max_g2_g</span>.<br/>
<span class="id">Unshelve</span>.<span class="id"> all:</span><span class="gallina-kwd"> by</span><span class="id"> end_near</span>. Qed.</div></details>
<br/>
<span class="vernacular">Let</span><span class="id"> lim_g2_max_g2</span><span class="id"> t</span><span class="id"> n</span><span class="id"> :</span><span class="id"> limn</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> g2</span><span class="id"> n</span><span class="id"> ^~</span><span class="id"> t</span>)<span class="id"> &lt;=</span><span class="id"> limn</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> max_g2</span><span class="id"> ^~</span><span class="id"> t</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">apply:</span><span class="id"> lee_lim</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
<span class="id">near=&gt;</span><span class="id"> k;</span><span class="id"> rewrite</span><span class="id"> /=</span><span class="id"> bigmax_nnsfunE</span><span class="id"> lee_fin</span>.<br/>
<span class="id">have</span><span class="id"> nk</span><span class="id"> :</span> (<span class="id">n</span><span class="id"> &lt;</span><span class="id"> k</span>)<span class="id">%N</span><span class="gallina-kwd"> by</span><span class="id"> near:</span><span class="id"> k;</span><span class="gallina-kwd"> exists</span><span class="id"> n</span>.<span class="id">+1</span>.<br/>
<span class="id">exact:</span> (<span class="id">bigmax_sup</span> (<span class="id">Ordinal</span><span class="id"> nk</span>)).<br/>
<span class="id">Unshelve</span>.<span class="id"> all:</span><span class="gallina-kwd"> by</span><span class="id"> end_near</span>. Qed.</div></details>
<br/>
<span class="vernacular">Let</span><span class="id"> cvg_max_g2_f</span><span class="id"> t</span><span class="id"> :</span><span class="id"> EFin</span><span class="id"> \o</span><span class="id"> max_g2</span><span class="id"> ^~</span><span class="id"> t</span><span class="id"> @</span><span class="id"> \oo</span><span class="id"> --&gt;</span><span class="id"> f</span><span class="id"> t</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">have</span><span class="id"> /cvg_ex[l</span><span class="id"> g_l]</span><span class="id"> :=</span><span class="id"> @is_cvg_max_g2</span><span class="id"> t</span>.<br/>
<span class="id">suff</span><span class="id"> :</span><span class="id"> l</span><span class="id"> ==</span><span class="id"> f</span><span class="id"> t</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> /eqP</span><span class="id"> &lt;-</span>.<br/>
<span class="id">rewrite</span><span class="id"> eq_le;</span><span class="id"> apply/andP;</span><span class="id"> split</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /f</span> (<span class="id">le_trans</span><span class="id"> _</span> (<span class="id">lim_max_g2_f</span><span class="id"> _</span>))<span class="id"> //</span> (<span class="id">cvg_lim</span><span class="id"> _</span><span class="id"> g_l</span>).<br/>
<span class="id">have</span><span class="id"> :=</span><span class="id"> leey</span><span class="id"> l;</span><span class="id"> rewrite</span><span class="id"> [in</span><span class="id"> X</span><span class="gallina-kwd"> in</span><span class="id"> X</span><span class="id"> -&gt;</span><span class="id"> _]le_eqVlt</span><span class="id"> =&gt;</span><span class="id"> /predU1P[-&gt;|loo]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> leey</span>.<br/>
<span class="id">rewrite</span><span class="id"> -</span>(<span class="id">cvg_lim</span><span class="id"> _</span><span class="id"> g_l</span>)<span class="id"> //=</span><span class="id"> lime_le</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
<span class="id">near=&gt;</span><span class="id"> n</span>.<br/>
<span class="id">have</span><span class="id"> :=</span><span class="id"> leey</span> (<span class="id">g</span><span class="id"> n</span><span class="id"> t</span>)<span class="id">;</span><span class="id"> rewrite</span><span class="id"> le_eqVlt</span><span class="id"> =&gt;</span><span class="id"> /predU1P[|]</span><span class="id"> fntoo</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> h</span><span class="id"> :=</span><span class="id"> @dvg_approx</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> setT</span><span class="id"> _</span><span class="id"> t</span><span class="id"> Logic</span>.<span class="id">I</span><span class="id"> fntoo</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> g2oo</span><span class="id"> :</span><span class="id"> limn</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> g2</span><span class="id"> n</span><span class="id"> ^~</span><span class="id"> t</span>)<span class="id"> =</span><span class="id"> +oo</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply/cvg_lim</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> apply/cvgeryP</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">under</span><span class="id"> [in</span><span class="id"> X</span><span class="gallina-kwd"> in</span><span class="id"> X</span><span class="id"> --&gt;</span><span class="id"> _]eq_fun</span><span class="id"> do</span><span class="id"> rewrite</span><span class="id"> nnsfun_approxE</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">have</span><span class="id"> :</span><span class="id"> {homo</span> (<span class="id">approx</span><span class="id"> setT</span> (<span class="id">g</span><span class="id"> n</span>))<span class="id">^~</span><span class="id"> t</span><span class="id"> :</span><span class="id"> n0</span><span class="id"> m</span><span class="id"> /</span> (<span class="id">n0</span><span class="id"> &lt;=</span><span class="id"> m</span>)<span class="id">%N</span><span class="id"> &gt;-&gt;</span> (<span class="id">n0</span><span class="id"> &lt;=</span><span class="id"> m</span>)<span class="id">%R}</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exact/lef_at/nd_approx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move/nondecreasing_dvgn_lt</span><span class="id"> =&gt;</span><span class="id"> /</span>(_<span class="id"> h</span>).<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> -&gt;</span><span class="id"> :</span><span class="id"> limn</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> max_g2</span><span class="id"> ^~</span><span class="id"> t</span>)<span class="id"> =</span><span class="id"> +oo</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> have</span><span class="id"> :=</span><span class="id"> lim_g2_max_g2</span><span class="id"> t</span><span class="id"> n;</span><span class="id"> rewrite</span><span class="id"> g2oo</span><span class="id"> leye_eq</span><span class="id"> =&gt;</span><span class="id"> /eqP</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> leey</span>.<br/>
<span class="id">-</span><span class="id"> have</span><span class="id"> approx_g_g</span><span class="id"> :=</span><span class="id"> @cvg_approx</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> setT</span><span class="id"> _</span><span class="id"> t</span> (<span class="gallina-kwd">fun</span><span class="id"> t</span><span class="id"> _</span><span class="id"> =&gt;</span><span class="id"> g0</span><span class="id"> n</span><span class="id"> t</span>)<span class="id"> Logic</span>.<span class="id">I</span><span class="id"> fntoo</span>.<br/>
&nbsp;&nbsp;<span class="id">suff</span><span class="id"> :</span><span class="id"> limn</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> g2</span><span class="id"> n</span><span class="id"> ^~</span><span class="id"> t</span>)<span class="id"> =</span><span class="id"> g</span><span class="id"> n</span><span class="id"> t</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> &lt;-;</span><span class="id"> exact:</span> (<span class="id">le_trans</span><span class="id"> _</span> (<span class="id">lim_g2_max_g2</span><span class="id"> t</span><span class="id"> n</span>)).<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> /cvg_lim</span><span class="id"> &lt;-</span><span class="id"> //</span><span class="id"> :</span><span class="id"> EFin</span><span class="id"> \o</span> (<span class="id">approx</span><span class="id"> setT</span> (<span class="id">g</span><span class="id"> n</span>))<span class="id"> ^~</span><span class="id"> t</span><span class="id"> @</span><span class="id"> \oo</span><span class="id"> --&gt;</span><span class="id"> g</span><span class="id"> n</span><span class="id"> t</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">move/cvg_comp</span><span class="id"> :</span><span class="id"> approx_g_g;</span><span class="id"> apply</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -</span>(<span class="id">@fineK</span><span class="id"> _</span> (<span class="id">g</span><span class="id"> n</span><span class="id"> t</span>))<span class="id">//</span><span class="id"> ge0_fin_numE//</span><span class="id"> g0</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> (_<span class="id"> :</span><span class="id"> _</span><span class="id"> \o</span><span class="id"> _</span><span class="id"> =</span><span class="id"> EFin</span><span class="id"> \o</span><span class="id"> approx</span><span class="id"> setT</span> (<span class="id">g</span><span class="id"> n</span>)<span class="id"> ^~</span><span class="id"> t</span>)<span class="id">//</span><span class="id"> funeqE</span><span class="id"> =&gt;</span><span class="id"> m</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> [in</span><span class="id"> RHS]/=</span><span class="id"> -nnsfun_approxE</span>.<br/>
<span class="id">Unshelve</span>.<span class="id"> all:</span><span class="gallina-kwd"> by</span><span class="id"> end_near</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> monotone_convergence</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>) (<span class="id">f'</span><span class="id"> x</span>)<span class="id"> =</span><span class="id"> limn</span> (<span class="gallina-kwd">fun</span><span class="id"> n</span><span class="id"> =&gt;</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>) (<span class="id">g'</span><span class="id"> n</span><span class="id"> x</span>)).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> integral_mkcond</span>.<br/>
<span class="id">under</span><span class="id"> [in</span><span class="id"> RHS]eq_fun</span><span class="id"> do</span><span class="id"> rewrite</span><span class="id"> integral_mkcond</span><span class="id"> -/</span>(<span class="id">g</span><span class="id"> _</span>).<br/>
<span class="id">have</span><span class="id"> -&gt;</span><span class="id"> :</span><span class="id"> f'</span><span class="id"> \_</span><span class="id"> D</span><span class="id"> =</span><span class="id"> f</span>.<br/>
&nbsp;&nbsp;<span class="id">apply/funext</span><span class="id"> =&gt;</span><span class="id"> x;</span><span class="id"> rewrite</span><span class="id"> /f</span><span class="id"> /f'</span><span class="id"> /g</span><span class="id"> /patch</span><span class="id"> /=;</span><span class="id"> case:</span><span class="id"> ifPn</span><span class="id"> =&gt;</span><span class="id"> //=</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> lim_cst</span>.<br/>
<span class="id">apply/eqP;</span><span class="id"> rewrite</span><span class="id"> eq_le;</span><span class="id"> apply/andP;</span><span class="id"> split;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> nd_int_g</span><span class="id"> :</span><span class="id"> nondecreasing_seq</span> (<span class="gallina-kwd">fun</span><span class="id"> n</span><span class="id"> =&gt;</span><span class="id"> \int[mu]_x</span><span class="id"> g</span><span class="id"> n</span><span class="id"> x</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> m</span><span class="id"> n</span><span class="id"> mn;</span><span class="id"> apply:</span><span class="id"> ge0_le_integral</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> *;</span><span class="id"> exact:</span><span class="id"> nd_g</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> ub</span><span class="id"> n</span><span class="id"> :</span><span class="id"> \int[mu]_x</span><span class="id"> g</span><span class="id"> n</span><span class="id"> x</span><span class="id"> &lt;=</span><span class="id"> \int[mu]_x</span><span class="id"> f</span><span class="id"> x</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> ge0_le_integral</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> _;</span><span class="id"> apply:</span><span class="id"> lime_ge</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> nearW</span><span class="id"> =&gt;</span><span class="id"> k;</span><span class="id"> exact/g0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="id"> apply:</span><span class="id"> emeasurable_fun_cvg</span><span class="id"> mg</span><span class="id"> _</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> _</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> ereal_nondecreasing_is_cvgn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> Dx;</span><span class="id"> apply:</span><span class="id"> lime_ge</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">near=&gt;</span><span class="id"> m;</span><span class="id"> have</span><span class="id"> nm</span><span class="id"> :</span> (<span class="id">n</span><span class="id"> &lt;=</span><span class="id"> m</span>)<span class="id">%N</span><span class="gallina-kwd"> by</span><span class="id"> near:</span><span class="id"> m;</span><span class="gallina-kwd"> exists</span><span class="id"> n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exact/nd_g</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> lime_le</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> [exact:ereal_nondecreasing_is_cvgn|exact:nearW]</span>.<br/>
<span class="id">rewrite</span> (<span class="id">@nd_ge0_integral_lim</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> mu</span><span class="id"> _</span><span class="id"> max_g2</span>)<span class="id"> //;</span><span class="id"> last</span><span class="id"> 2</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> move=&gt;</span><span class="id"> t;</span><span class="id"> apply:</span><span class="id"> lime_ge</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> nearW</span><span class="id"> =&gt;</span><span class="id"> n;</span><span class="id"> exact:</span><span class="id"> g0</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> t</span><span class="id"> m</span><span class="id"> n</span><span class="id"> mn;</span><span class="id"> exact/lefP/nd_max_g2</span>.<br/>
<span class="id">apply:</span><span class="id"> lee_lim</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> is_cvg_sintegral</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> t</span><span class="id"> m</span><span class="id"> n</span><span class="id"> mn;</span><span class="id"> exact/lefP/nd_max_g2</span>.<br/>
<span class="id">-</span><span class="id"> apply:</span><span class="id"> ereal_nondecreasing_is_cvgn</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> n</span><span class="id"> m</span><span class="id"> nm;</span><span class="id"> apply:</span><span class="id"> ge0_le_integral</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> *;</span><span class="id"> exact/nd_g</span>.<br/>
<span class="id">-</span><span class="id"> apply:</span><span class="id"> nearW</span><span class="id"> =&gt;</span><span class="id"> n;</span><span class="id"> rewrite</span><span class="id"> ge0_integralTE//</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> ereal_sup_ubound;</span><span class="gallina-kwd"> exists</span> (<span class="id">max_g2</span><span class="id"> n</span>)<span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> t;</span><span class="id"> exact:</span><span class="id"> max_g2_g</span>.<br/>
<span class="id">Unshelve</span>.<span class="id"> all:</span><span class="gallina-kwd"> by</span><span class="id"> end_near</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> cvg_monotone_convergence</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> g'</span><span class="id"> n</span><span class="id"> x</span><span class="id"> @[n</span><span class="id"> \oo]</span><span class="id"> --&gt;</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> f'</span><span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> monotone_convergence;</span><span class="id"> apply:</span><span class="id"> ereal_nondecreasing_is_cvgn</span><span class="id"> =&gt;</span><span class="id"> m</span><span class="id"> n</span><span class="id"> mn</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> ge0_le_integral</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> t</span><span class="id"> Dt;</span><span class="id"> [exact:</span><span class="id"> g'0|exact:</span><span class="id"> g'0|exact:</span><span class="id"> nd_g']</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> monotone_convergence_theorem</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> integral_nneseries</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<span class="vernacular">Context</span><span class="id"> d</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>).<br/>
<span class="vernacular">Variables</span> (<span class="id">mu</span><span class="id"> :</span><span class="id"> {measure</span><span class="id"> set</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R}</span>) (<span class="id">D</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T</span>) (<span class="id">mD</span><span class="id"> :</span><span class="id"> measurable</span><span class="id"> D</span>).<br/>
<span class="vernacular">Variable</span><span class="id"> f</span><span class="id"> :</span> (<span class="id">T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id">^nat</span>.<br/>
<span class="vernacular">Hypothesis</span><span class="id"> mf</span><span class="id"> :</span><span class="gallina-kwd"> forall</span><span class="id"> n,</span><span class="id"> measurable_fun</span><span class="id"> D</span> (<span class="id">f</span><span class="id"> n</span>).<br/>
<span class="vernacular">Hypothesis</span><span class="id"> f0</span><span class="id"> :</span><span class="gallina-kwd"> forall</span><span class="id"> n</span><span class="id"> x,</span><span class="id"> D</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> f</span><span class="id"> n</span><span class="id"> x</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> integral_nneseries</span><span class="id"> :</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>) (<span class="id">\sum_</span>(<span class="id">n</span><span class="id"> &lt;oo</span>)<span class="id"> f</span><span class="id"> n</span><span class="id"> x</span>)<span class="id"> =</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">\sum_</span>(<span class="id">n</span><span class="id"> &lt;oo</span>) (<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>) (<span class="id">f</span><span class="id"> n</span><span class="id"> x</span>)).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> monotone_convergence</span><span class="id"> //</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> -lim_mkord;</span><span class="id"> under</span><span class="id"> eq_fun</span><span class="id"> do</span><span class="id"> rewrite</span><span class="id"> ge0_integral_sum//</span><span class="id"> big_mkord</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> n;</span><span class="id"> exact:</span><span class="id"> emeasurable_fun_sum</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> n</span><span class="id"> x</span><span class="id"> Dx;</span><span class="id"> apply:</span><span class="id"> sume_ge0</span><span class="id"> =&gt;</span><span class="id"> m</span><span class="id"> _;</span><span class="id"> exact:</span><span class="id"> f0</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> Dx</span><span class="id"> m</span><span class="id"> n</span><span class="id"> mn;</span><span class="id"> apply:</span><span class="id"> lee_sum_nneg_natr</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> k</span><span class="id"> _</span><span class="id"> _;</span><span class="id"> exact:</span><span class="id"> f0</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> integral_nneseries</span>.<br/>
<br/>
<div class="doc md"> Generalization of `ge0_integralZl_EFin` to a constant potentially $+\infty$
   using the monotone convergence theorem:</div>
<span class="vernacular">Section</span><span class="id"> ge0_integralZ</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<span class="vernacular">Context</span><span class="id"> d</span><span class="id"> {T</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d}</span><span class="id"> {R</span><span class="id"> :</span><span class="id"> realType}</span>.<br/>
<span class="vernacular">Variable</span><span class="id"> mu</span><span class="id"> :</span><span class="id"> {measure</span><span class="id"> set</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R}</span>.<br/>
<span class="vernacular">Variables</span> (<span class="id">D</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T</span>) (<span class="id">mD</span><span class="id"> :</span><span class="id"> measurable</span><span class="id"> D</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>).<br/>
<span class="vernacular">Hypothesis</span><span class="id"> mf</span><span class="id"> :</span><span class="id"> measurable_fun</span><span class="id"> D</span><span class="id"> f</span>.<br/>
<span class="vernacular">Implicit</span><span class="gallina-kwd"> Type</span><span class="id"> k</span><span class="id"> :</span><span class="id"> \bar</span><span class="id"> R</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> ge0_integralZl</span><span class="id"> k</span><span class="id"> :</span> (<span class="gallina-kwd">forall</span><span class="id"> x,</span><span class="id"> D</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> f</span><span class="id"> x</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">0</span><span class="id"> &lt;=</span><span class="id"> k</span><span class="id"> -&gt;</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>) (<span class="id">k</span><span class="id"> *</span><span class="id"> f</span><span class="id"> x</span>)<span class="id"> =</span><span class="id"> k</span><span class="id"> *</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>) (<span class="id">f</span><span class="id"> x</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> f0;</span><span class="id"> move:</span><span class="id"> k</span><span class="id"> =&gt;</span><span class="id"> [k|_|//];</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> ge0_integralZl_EFin</span>.<br/>
<span class="id">pose</span><span class="id"> g</span><span class="id"> :</span> (<span class="id">T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id">^nat</span><span class="id"> :=</span><span class="gallina-kwd"> fun</span><span class="id"> n</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> n%:R%:E</span><span class="id"> *</span><span class="id"> f</span><span class="id"> x</span>.<br/>
<span class="id">have</span><span class="id"> mg</span><span class="id"> n</span><span class="id"> :</span><span class="id"> measurable_fun</span><span class="id"> D</span> (<span class="id">g</span><span class="id"> n</span>)<span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> measurable_funeM</span>.<br/>
<span class="id">have</span><span class="id"> g0</span><span class="id"> n</span><span class="id"> x</span><span class="id"> :</span><span class="id"> D</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> g</span><span class="id"> n</span><span class="id"> x</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> Dx;</span><span class="id"> apply:</span><span class="id"> mule_ge0;</span><span class="id"> [rewrite</span><span class="id"> lee_fin|exact:f0]</span>.<br/>
<span class="id">have</span><span class="id"> nd_g</span><span class="id"> x</span><span class="id"> :</span><span class="id"> D</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> nondecreasing_seq</span> (<span class="id">g</span><span class="id"> ^~</span><span class="id"> x</span>).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> Dx</span><span class="id"> m</span><span class="id"> n</span><span class="id"> mn;</span><span class="id"> rewrite</span><span class="id"> lee_wpmul2r</span><span class="id"> ?f0//</span><span class="id"> lee_fin</span><span class="id"> ler_nat</span>.<br/>
<span class="id">pose</span><span class="id"> h</span><span class="id"> :=</span><span class="gallina-kwd"> fun</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> limn</span> (<span class="id">g^~</span><span class="id"> x</span>).<br/>
<span class="id">transitivity</span> (<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> limn</span> (<span class="id">g^~</span><span class="id"> x</span>)).<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> eq_integral</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> Dx;</span><span class="id"> apply/esym/cvg_lim</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> [fx0|fx0|fx0]</span><span class="id"> :=</span><span class="id"> ltgtP</span><span class="id"> 0</span> (<span class="id">f</span><span class="id"> x</span>).<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> rewrite</span><span class="id"> gt0_mulye//;</span><span class="id"> apply/cvgeyPgey;</span><span class="id"> near=&gt;</span><span class="id"> M</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">have</span><span class="id"> M0</span><span class="id"> :</span> (<span class="id">0</span><span class="id"> &lt;=</span><span class="id"> M</span>)<span class="id">%R</span><span class="gallina-kwd"> by</span><span class="id"> []</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> /g;</span><span class="id"> case:</span> (<span class="id">f</span><span class="id"> x</span>)<span class="id"> fx0</span><span class="id"> =&gt;</span><span class="id"> [r</span><span class="id"> r0|_|//];</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">exists</span><span class="id"> 1%N</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> m</span><span class="id"> /=</span><span class="id"> m0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> mulry</span><span class="id"> gtr0_sg//</span><span class="id"> ?mul1e</span><span class="id"> ?leey//</span><span class="id"> ltr0n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">near=&gt;</span><span class="id"> n;</span><span class="id"> rewrite</span><span class="id"> lee_fin</span><span class="id"> -ler_pdivrMr//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">near:</span><span class="id"> n;</span><span class="gallina-kwd"> exists</span><span class="id"> `|ceil</span> (<span class="id">M</span><span class="id"> /</span><span class="id"> r</span>)<span class="id">|%N</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> m</span><span class="id"> /=</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -</span>(<span class="id">ler_nat</span><span class="id"> R</span>)<span class="id">;</span><span class="id"> apply:</span><span class="id"> le_trans</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> natr_absz</span><span class="id"> ger0_norm</span><span class="id"> ?ceil_ge//</span><span class="id"> -ceil_ge0//</span> (<span class="id">lt_le_trans</span> (<span class="id">ltrN10</span><span class="id"> _</span>))<span class="id">//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> divr_ge0//</span><span class="id"> ?ltW</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> rewrite</span><span class="id"> lt0_mulye//;</span><span class="id"> apply/cvgeNyPleNy;</span><span class="id"> near=&gt;</span><span class="id"> M;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">have</span><span class="id"> M0</span><span class="id"> :</span> (<span class="id">M</span><span class="id"> &lt;=</span><span class="id"> 0</span>)<span class="id">%R</span><span class="gallina-kwd"> by</span><span class="id"> []</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> /g;</span><span class="id"> case:</span> (<span class="id">f</span><span class="id"> x</span>)<span class="id"> fx0</span><span class="id"> =&gt;</span><span class="id"> [r</span><span class="id"> r0|//|_];</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">exists</span><span class="id"> 1%N</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> m</span><span class="id"> /=</span><span class="id"> m0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> mulrNy</span><span class="id"> gtr0_sg//</span><span class="id"> ?ltr0n//</span><span class="id"> mul1e</span><span class="id"> ?leNye</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">near=&gt;</span><span class="id"> n;</span><span class="id"> rewrite</span><span class="id"> lee_fin</span><span class="id"> -ler_ndivrMr//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">near:</span><span class="id"> n;</span><span class="gallina-kwd"> exists</span><span class="id"> `|ceil</span> (<span class="id">M</span><span class="id"> /</span><span class="id"> r</span>)<span class="id">|%N</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> m</span><span class="id"> /=</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -</span>(<span class="id">ler_nat</span><span class="id"> R</span>)<span class="id">;</span><span class="id"> apply:</span><span class="id"> le_trans</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> natr_absz</span><span class="id"> ger0_norm</span><span class="id"> ?ceil_ge//</span><span class="id"> -ceil_ge0//</span> (<span class="id">lt_le_trans</span> (<span class="id">ltrN10</span><span class="id"> _</span>))<span class="id">//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -mulrNN</span><span class="id"> mulr_ge0//</span><span class="id"> lerNr</span><span class="id"> oppr0//</span><span class="id"> ltW//</span><span class="id"> invr_lt0</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> rewrite</span><span class="id"> -fx0</span><span class="id"> mule0</span><span class="id"> /g</span><span class="id"> -fx0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">under</span><span class="id"> eq_fun</span><span class="id"> do</span><span class="id"> rewrite</span><span class="id"> mule0/=</span>. <span class="comment">(*TODO:&nbsp;notation&nbsp;broken*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> cvg_cst</span>.<br/>
<span class="id">rewrite</span> (<span class="id">monotone_convergence</span><span class="id"> mu</span><span class="id"> mD</span><span class="id"> mg</span><span class="id"> g0</span><span class="id"> nd_g</span>).<br/>
<span class="id">under</span><span class="id"> eq_fun</span><span class="id"> do</span><span class="id"> rewrite</span><span class="id"> /g</span><span class="id"> ge0_integralZl_EFin//</span>.<br/>
<span class="id">have</span><span class="id"> :</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> f</span><span class="id"> x</span><span class="gallina-kwd"> by</span><span class="id"> exact:</span><span class="id"> integral_ge0</span>.<br/>
<span class="id">rewrite</span><span class="id"> le_eqVlt</span><span class="id"> =&gt;</span><span class="id"> /predU1P[&lt;-|if_gt0]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> mule0;</span><span class="id"> under</span><span class="id"> eq_fun</span><span class="id"> do</span><span class="id"> rewrite</span><span class="id"> mule0;</span><span class="id"> rewrite</span><span class="id"> lim_cst</span>.<br/>
<span class="id">rewrite</span><span class="id"> gt0_mulye//;</span><span class="id"> apply/cvg_lim</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> apply/cvgeyPgey;</span><span class="id"> near=&gt;</span><span class="id"> M</span>.<br/>
<span class="id">have</span><span class="id"> M0</span><span class="id"> :</span> (<span class="id">0</span><span class="id"> &lt;=</span><span class="id"> M</span>)<span class="id">%R</span><span class="gallina-kwd"> by</span><span class="id"> []</span>.<br/>
<span class="id">near=&gt;</span><span class="id"> n;</span><span class="id"> have</span><span class="id"> [ifoo|]</span><span class="id"> :=</span><span class="id"> ltP</span> (<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> f</span><span class="id"> x</span>)<span class="id"> +oo;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> leye_eq</span><span class="id"> =&gt;</span><span class="id"> /eqP</span><span class="id"> -&gt;;</span><span class="id"> rewrite</span><span class="id"> mulry</span><span class="id"> muleC</span><span class="id"> gt0_mulye</span><span class="id"> ?leey//</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> near:</span><span class="id"> n;</span><span class="gallina-kwd"> exists</span><span class="id"> 1%N</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> n</span><span class="id"> /=</span><span class="id"> n0;</span><span class="id"> rewrite</span><span class="id"> gtr0_sg//</span><span class="id"> ?lte_fin//</span><span class="id"> ltr0n</span>.<br/>
<span class="id">rewrite</span><span class="id"> -</span>(<span class="id">@fineK</span><span class="id"> _</span> (<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> f</span><span class="id"> x</span>))<span class="id">;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> fin_numElt</span><span class="id"> ifoo</span> (<span class="id">le_lt_trans</span><span class="id"> _</span><span class="id"> if_gt0</span>).<br/>
<span class="id">rewrite</span><span class="id"> -lee_pdivrMr//;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move:</span><span class="id"> if_gt0</span><span class="id"> ifoo;</span><span class="id"> case:</span> (<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> f</span><span class="id"> x</span>).<br/>
<span class="id">near:</span><span class="id"> n</span>.<br/>
<span class="gallina-kwd">exists</span><span class="id"> `|ceil</span> (<span class="id">M</span><span class="id"> *</span> (<span class="id">fine</span> (<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> f</span><span class="id"> x</span>))<span class="id">^-1</span>)<span class="id">|%N</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> n</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> -</span>(<span class="id">@ler_nat</span><span class="id"> R</span>)<span class="id"> -lee_fin;</span><span class="id"> apply:</span><span class="id"> le_trans</span>.<br/>
<span class="id">rewrite</span><span class="id"> lee_fin</span><span class="id"> natr_absz</span><span class="id"> ger0_norm</span><span class="id"> ?ceil_ge//</span><span class="id"> -ceil_ge0//</span>.<br/>
<span class="id">rewrite</span> (<span class="id">lt_le_trans</span> (<span class="id">ltrN10</span><span class="id"> _</span>))<span class="id">//</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> mulr_ge0//</span><span class="id"> ?invr_ge0//;</span><span class="id"> exact/fine_ge0/integral_ge0</span>.<br/>
<span class="id">Unshelve</span>.<span class="id"> all:</span><span class="gallina-kwd"> by</span><span class="id"> end_near</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> ge0_integralZr</span><span class="id"> k</span><span class="id"> :</span> (<span class="gallina-kwd">forall</span><span class="id"> x,</span><span class="id"> D</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> f</span><span class="id"> x</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">0</span><span class="id"> &lt;=</span><span class="id"> k</span><span class="id"> -&gt;</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>) (<span class="id">f</span><span class="id"> x</span><span class="id"> *</span><span class="id"> k</span>)<span class="id"> =</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>) (<span class="id">f</span><span class="id"> x</span>)<span class="id"> *</span><span class="id"> k</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> f0</span><span class="id"> k0;</span><span class="id"> under</span><span class="id"> eq_integral</span><span class="id"> do</span><span class="id"> rewrite</span><span class="id"> muleC</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> ge0_integralZl//</span><span class="id"> muleC</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> ge0_integralZ</span>.<br/>
<span class="id">#[deprecated</span>(<span class="id">since=</span><span class="id">&quot;mathcomp-analysis 0.6.4&quot;</span><span class="id">,</span><span class="id"> note=</span><span class="id">&quot;use `ge0_integralZl` instead&quot;</span>)<span class="id">]</span><br/>
<span class="vernacular">Notation</span><span class="id"> ge0_integralM</span><span class="id"> :=</span><span class="id"> ge0_integralZl</span> (<span class="id">only</span><span class="id"> parsing</span>).<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> integral_indic</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<span class="vernacular">Context</span><span class="id"> d</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">mu</span><span class="id"> :</span><span class="id"> {measure</span><span class="id"> set</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R}</span>) (<span class="id">D</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T</span>) (<span class="id">mD</span><span class="id"> :</span><span class="id"> measurable</span><span class="id"> D</span>).<br/>
<br/>
<span class="vernacular">Import</span><span class="id"> HBNNSimple</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> integral_indic</span> (<span class="id">E</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T</span>)<span class="id"> :</span><span class="id"> measurable</span><span class="id"> E</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>) (<span class="id">\1_E</span><span class="id"> x</span>)<span class="id">%:E</span><span class="id"> =</span><span class="id"> mu</span> (<span class="id">E</span><span class="id"> `&amp;`</span><span class="id"> D</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> mE;</span><span class="id"> rewrite</span> (_<span class="id"> :</span><span class="id"> \1_E</span><span class="id"> =</span><span class="id"> indic_nnsfun</span><span class="id"> R</span><span class="id"> mE</span>)<span class="id">//</span><span class="id"> integral_nnsfun//=</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> restrict_indic</span><span class="id"> sintegral_indic//;</span><span class="id"> exact:</span><span class="id"> measurableI</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> integral_indic</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> integralZl_indic</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<span class="vernacular">Context</span><span class="id"> d</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>).<br/>
<span class="vernacular">Variables</span> (<span class="id">m</span><span class="id"> :</span><span class="id"> {measure</span><span class="id"> set</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R}</span>) (<span class="id">D</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T</span>) (<span class="id">mD</span><span class="id"> :</span><span class="id"> measurable</span><span class="id"> D</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> integralZl_indic</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> set</span><span class="id"> T</span>) (<span class="id">k</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;((<span class="id">k</span><span class="id"> &lt;</span><span class="id"> 0</span>)<span class="id">%R</span><span class="id"> -&gt;</span><span class="id"> f</span><span class="id"> k</span><span class="id"> =</span><span class="id"> set0</span>)<span class="id"> -&gt;</span><span class="id"> measurable</span> (<span class="id">f</span><span class="id"> k</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">\int[m]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>) (<span class="id">k</span><span class="id"> *</span><span class="id"> \1_</span>(<span class="id">f</span><span class="id"> k</span>)<span class="id"> x</span>)<span class="id">%:E</span><span class="id"> =</span><br/>
&nbsp;&nbsp;<span class="id">k%:E</span><span class="id"> *</span><span class="id"> \int[m]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>) (<span class="id">\1_</span>(<span class="id">f</span><span class="id"> k</span>)<span class="id"> x</span>)<span class="id">%:E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> fk0</span><span class="id"> mfk;</span><span class="id"> have</span><span class="id"> [k0|k0]</span><span class="id"> :=</span><span class="id"> ltP</span><span class="id"> k</span><span class="id"> 0%R</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> integral0_eq//;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> fk0//</span><span class="id"> indic0</span><span class="id"> mulr0</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> integral0_eq</span><span class="id"> ?mule0//</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> fk0//</span><span class="id"> indic0</span>.<br/>
<span class="id">under</span><span class="id"> eq_integral</span><span class="id"> do</span><span class="id"> rewrite</span><span class="id"> EFinM</span>.<br/>
<span class="id">rewrite</span><span class="id"> ge0_integralZl//;</span><span class="id"> first</span><span class="id"> exact/measurable_EFinP</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> y</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> lee_fin</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Import</span><span class="id"> HBNNSimple</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> integralZl_indic_nnsfun</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {nnsfun</span><span class="id"> T</span><span class="id"> &gt;-&gt;</span><span class="id"> R}</span>) (<span class="id">k</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">\int[m]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>) (<span class="id">k</span><span class="id"> *</span><span class="id"> \1_</span>(<span class="id">f</span><span class="id"> @^-1`</span><span class="id"> [set</span><span class="id"> k]</span>)<span class="id"> x</span>)<span class="id">%:E</span><span class="id"> =</span><br/>
&nbsp;&nbsp;<span class="id">k%:E</span><span class="id"> *</span><span class="id"> \int[m]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>) (<span class="id">\1_</span>(<span class="id">f</span><span class="id"> @^-1`</span><span class="id"> [set</span><span class="id"> k]</span>)<span class="id"> x</span>)<span class="id">%:E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span> (<span class="id">@integralZl_indic</span> (<span class="gallina-kwd">fun</span><span class="id"> k</span><span class="id"> =&gt;</span><span class="id"> f</span><span class="id"> @^-1`</span><span class="id"> [set</span><span class="id"> k]</span>))<span class="id">//</span><span class="id"> =&gt;</span><span class="id"> k0</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> preimage_nnfun0</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> integralZl_indic</span>.<br/>
<span class="vernacular">Arguments</span><span class="id"> integralZl_indic</span><span class="id"> {d</span><span class="id"> T</span><span class="id"> R</span><span class="id"> m</span><span class="id"> D}</span><span class="id"> mD</span><span class="id"> f</span>.<br/>
<span class="id">#[deprecated</span>(<span class="id">since=</span><span class="id">&quot;mathcomp-analysis 0.6.4&quot;</span><span class="id">,</span><span class="id"> note=</span><span class="id">&quot;use `integralZl_indic` instead&quot;</span>)<span class="id">]</span><br/>
<span class="vernacular">Notation</span><span class="id"> integralM_indic</span><span class="id"> :=</span><span class="id"> integralZl_indic</span> (<span class="id">only</span><span class="id"> parsing</span>).<br/>
<span class="id">#[deprecated</span>(<span class="id">since=</span><span class="id">&quot;mathcomp-analysis 0.6.4&quot;</span><span class="id">,</span><span class="id"> note=</span><span class="id">&quot;use `integralZl_indic_nnsfun` instead&quot;</span>)<span class="id">]</span><br/>
<span class="vernacular">Notation</span><span class="id"> integralM_indic_nnsfun</span><span class="id"> :=</span><span class="id"> integralZl_indic_nnsfun</span> (<span class="id">only</span><span class="id"> parsing</span>).<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> integral_mscale</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<span class="vernacular">Context</span><span class="id"> d</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>).<br/>
<span class="vernacular">Variables</span> (<span class="id">m</span><span class="id"> :</span><span class="id"> {measure</span><span class="id"> set</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R}</span>) (<span class="id">D</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T</span>) (<span class="id">mD</span><span class="id"> :</span><span class="id"> measurable</span><span class="id"> D</span>).<br/>
<span class="vernacular">Variables</span> (<span class="id">k</span><span class="id"> :</span><span class="id"> {nonneg</span><span class="id"> R}</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>).<br/>
<br/>
<span class="vernacular">Let</span><span class="id"> integral_mscale_indic</span><span class="id"> E</span><span class="id"> :</span><span class="id"> measurable</span><span class="id"> E</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">\int[mscale</span><span class="id"> k</span><span class="id"> m]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>) (<span class="id">\1_E</span><span class="id"> x</span>)<span class="id">%:E</span><span class="id"> =</span><br/>
&nbsp;&nbsp;<span class="id">k%:num%:E</span><span class="id"> *</span><span class="id"> \int[m]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>) (<span class="id">\1_E</span><span class="id"> x</span>)<span class="id">%:E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> ?;</span><span class="id"> rewrite</span><span class="id"> !integral_indic</span>. Qed.</div></details>
<br/>
<span class="vernacular">Import</span><span class="id"> HBNNSimple</span>.<br/>
<br/>
<span class="vernacular">Let</span><span class="id"> integral_mscale_nnsfun</span> (<span class="id">h</span><span class="id"> :</span><span class="id"> {nnsfun</span><span class="id"> T</span><span class="id"> &gt;-&gt;</span><span class="id"> R}</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">\int[mscale</span><span class="id"> k</span><span class="id"> m]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>) (<span class="id">h</span><span class="id"> x</span>)<span class="id">%:E</span><span class="id"> =</span><span class="id"> k%:num%:E</span><span class="id"> *</span><span class="id"> \int[m]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>) (<span class="id">h</span><span class="id"> x</span>)<span class="id">%:E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">under</span><span class="id"> [LHS]eq_integral</span><span class="id"> do</span><span class="id"> rewrite</span><span class="id"> fimfunE</span><span class="id"> -fsumEFin//</span>.<br/>
<span class="id">rewrite</span><span class="id"> [LHS]ge0_integral_fsum//;</span><span class="id"> last</span><span class="id"> 2</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> r;</span><span class="id"> exact/measurable_EFinP/measurableT_comp</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> n</span><span class="id"> x</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> EFinM</span><span class="id"> nnfun_muleindic_ge0</span>.<br/>
<span class="id">rewrite</span><span class="id"> -[RHS]ge0_integralZl//;</span><span class="id"> last</span><span class="id"> 2</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> measurableT_comp</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> measurable_funTS</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> lee_fin</span>.<br/>
<span class="id">under</span><span class="id"> [RHS]eq_integral</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> x</span><span class="id"> xD;</span><span class="id"> rewrite</span><span class="id"> fimfunE</span><span class="id"> -fsumEFin//</span><span class="id"> ge0_mule_fsumr;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> r;</span><span class="id"> rewrite</span><span class="id"> EFinM</span><span class="id"> nnfun_muleindic_ge0</span>.<br/>
&nbsp;&nbsp;<span class="id">over</span>.<br/>
<span class="id">rewrite</span><span class="id"> [RHS]ge0_integral_fsum//;</span><span class="id"> last</span><span class="id"> 2</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> r;</span><span class="id"> apply/measurable_EFinP;</span><span class="id"> do</span><span class="id"> 2</span><span class="id"> apply/measurableT_comp</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> n</span><span class="id"> x</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> EFinM</span><span class="id"> mule_ge0//</span><span class="id"> nnfun_muleindic_ge0</span>.<br/>
<span class="id">apply:</span><span class="id"> eq_fsbigr</span><span class="id"> =&gt;</span><span class="id"> r</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> ge0_integralZl//</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> !integralZl_indic_nnsfun//=</span><span class="id"> integral_mscale_indic//</span><span class="id"> muleCA</span>.<br/>
<span class="id">-</span><span class="id"> exact/measurable_EFinP/measurableT_comp</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> t</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> nnfun_muleindic_ge0</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> ge0_integral_mscale</span> (<span class="id">mf</span><span class="id"> :</span><span class="id"> measurable_fun</span><span class="id"> D</span><span class="id"> f</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="gallina-kwd">forall</span><span class="id"> x,</span><span class="id"> D</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> f</span><span class="id"> x</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">\int[mscale</span><span class="id"> k</span><span class="id"> m]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> f</span><span class="id"> x</span><span class="id"> =</span><span class="id"> k%:num%:E</span><span class="id"> *</span><span class="id"> \int[m]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> f</span><span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> f0;</span><span class="id"> have</span><span class="id"> [f_</span><span class="id"> [ndf_</span><span class="id"> f_f]]</span><span class="id"> :=</span><span class="id"> approximation</span><span class="id"> mD</span><span class="id"> mf</span><span class="id"> f0</span>.<br/>
<span class="id">transitivity</span> (<span class="id">limn</span> (<span class="gallina-kwd">fun</span><span class="id"> n</span><span class="id"> =&gt;</span><span class="id"> \int[mscale</span><span class="id"> k</span><span class="id"> m]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>) (<span class="id">f_</span><span class="id"> n</span><span class="id"> x</span>)<span class="id">%:E</span>)).<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -monotone_convergence//=</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> eq_integral</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> /[!inE]</span><span class="id"> xD;</span><span class="id"> apply/esym/cvg_lim</span><span class="id"> =&gt;</span><span class="id"> //=;</span><span class="id"> exact:</span><span class="id"> f_f</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> n;</span><span class="id"> apply:</span><span class="id"> measurableT_comp</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> measurable_funTS</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> n</span><span class="id"> x</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> lee_fin</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> _</span><span class="id"> a</span><span class="id"> b</span><span class="id"> /ndf_</span><span class="id"> /lefP;</span><span class="id"> rewrite</span><span class="id"> lee_fin</span>.<br/>
<span class="id">rewrite</span> (_<span class="id"> :</span><span class="id"> \int[m]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> _</span><span class="id"> =</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">limn</span> (<span class="gallina-kwd">fun</span><span class="id"> n</span><span class="id"> =&gt;</span><span class="id"> \int[m]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>) (<span class="id">f_</span><span class="id"> n</span><span class="id"> x</span>)<span class="id">%:E</span>))<span class="id">;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -monotone_convergence//=</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> eq_integral</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> /[!inE]</span><span class="id"> xD;</span><span class="id"> apply/esym/cvg_lim</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> f_f</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> n;</span><span class="id"> exact/measurable_EFinP/measurable_funTS</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> n</span><span class="id"> x</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> lee_fin</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> _</span><span class="id"> a</span><span class="id"> b</span><span class="id"> /ndf_</span><span class="id"> /lefP;</span><span class="id"> rewrite</span><span class="id"> lee_fin</span>.<br/>
<span class="id">rewrite</span><span class="id"> -limeMl//</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> congr</span> (<span class="id">limn</span><span class="id"> _</span>)<span class="id">;</span><span class="id"> apply/funext</span><span class="id"> =&gt;</span><span class="id"> n</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> integral_mscale_nnsfun</span>.<br/>
<span class="id">apply/ereal_nondecreasing_is_cvgn</span><span class="id"> =&gt;</span><span class="id"> a</span><span class="id"> b</span><span class="id"> ab;</span><span class="id"> apply:</span><span class="id"> ge0_le_integral</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> lee_fin</span>.<br/>
<span class="id">-</span><span class="id"> exact/measurable_EFinP/measurable_funTS</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> lee_fin</span>.<br/>
<span class="id">-</span><span class="id"> exact/measurable_EFinP/measurable_funTS</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> lee_fin;</span><span class="id"> move/ndf_</span><span class="id"> :</span><span class="id"> ab</span><span class="id"> =&gt;</span><span class="id"> /lefP</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> integral_mscale</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> fatou</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<span class="vernacular">Context</span><span class="id"> d</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>).<br/>
<span class="vernacular">Variables</span> (<span class="id">mu</span><span class="id"> :</span><span class="id"> {measure</span><span class="id"> set</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R}</span>) (<span class="id">D</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T</span>) (<span class="id">mD</span><span class="id"> :</span><span class="id"> measurable</span><span class="id"> D</span>).<br/>
<span class="vernacular">Variable</span> (<span class="id">f</span><span class="id"> :</span> (<span class="id">T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id">^nat</span>).<br/>
<span class="vernacular">Hypothesis</span><span class="id"> mf</span><span class="id"> :</span><span class="gallina-kwd"> forall</span><span class="id"> n,</span><span class="id"> measurable_fun</span><span class="id"> D</span> (<span class="id">f</span><span class="id"> n</span>).<br/>
<span class="vernacular">Hypothesis</span><span class="id"> f0</span><span class="id"> :</span><span class="gallina-kwd"> forall</span><span class="id"> n</span><span class="id"> x,</span><span class="id"> D</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> f</span><span class="id"> n</span><span class="id"> x</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> fatou</span><span class="id"> :</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> limn_einf</span> (<span class="id">f^~</span><span class="id"> x</span>)<span class="id"> &lt;=</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">limn_einf</span> (<span class="gallina-kwd">fun</span><span class="id"> n</span><span class="id"> =&gt;</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> f</span><span class="id"> n</span><span class="id"> x</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">pose</span><span class="id"> g</span><span class="id"> n</span><span class="id"> :=</span><span class="gallina-kwd"> fun</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> einfs</span> (<span class="id">f</span><span class="id"> ^~</span><span class="id"> x</span>)<span class="id"> n</span>.<br/>
<span class="id">have</span><span class="id"> mg</span><span class="id"> :=</span><span class="id"> measurable_fun_einfs</span><span class="id"> mf</span>.<br/>
<span class="id">have</span><span class="id"> g0</span><span class="id"> n</span><span class="id"> x</span><span class="id"> :</span><span class="id"> D</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> g</span><span class="id"> n</span><span class="id"> x</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> Dx;</span><span class="id"> apply:</span><span class="id"> lb_ereal_inf</span><span class="id"> =&gt;</span><span class="id"> _</span><span class="id"> [m</span><span class="id"> /=</span><span class="id"> nm</span><span class="id"> &lt;-];</span><span class="id"> exact:</span><span class="id"> f0</span>.<br/>
<span class="id">under</span><span class="id"> eq_integral</span><span class="id"> do</span><span class="id"> rewrite</span><span class="id"> limn_einf_lim</span>.<br/>
<span class="id">rewrite</span><span class="id"> limn_einf_lim</span><span class="id"> monotone_convergence</span><span class="id"> //;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> x</span><span class="id"> Dx</span><span class="id"> m</span><span class="id"> n</span><span class="id"> mn</span><span class="id"> /=;</span><span class="id"> apply:</span><span class="id"> le_ereal_inf</span><span class="id"> =&gt;</span><span class="id"> _</span><span class="id"> /=</span><span class="id"> [p</span><span class="id"> /=</span><span class="id"> np</span><span class="id"> &lt;-]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="gallina-kwd"> exists</span><span class="id"> p</span><span class="id"> =&gt;</span><span class="id"> //=;</span><span class="id"> rewrite</span> (<span class="id">leq_trans</span><span class="id"> mn</span>).<br/>
<span class="id">apply:</span><span class="id"> lee_lim</span>.<br/>
<span class="id">-</span><span class="id"> apply/cvg_ex;</span><span class="id"> eexists;</span><span class="id"> apply/ereal_nondecreasing_cvgn</span><span class="id"> =&gt;</span><span class="id"> a</span><span class="id"> b</span><span class="id"> ab</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> ge0_le_integral</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> [exact:</span><span class="id"> g0|</span><span class="id"> exact:</span><span class="id"> mg|</span><span class="id"> exact:</span><span class="id"> g0|</span><span class="id"> exact:</span><span class="id"> mg|]</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> x</span><span class="id"> Dx;</span><span class="id"> apply:</span><span class="id"> le_ereal_inf</span><span class="id"> =&gt;</span><span class="id"> _</span><span class="id"> [n</span><span class="id"> /=</span><span class="id"> bn</span><span class="id"> &lt;-]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="gallina-kwd"> exists</span><span class="id"> n</span><span class="id"> =&gt;</span><span class="id"> //=;</span><span class="id"> rewrite</span> (<span class="id">leq_trans</span><span class="id"> ab</span>).<br/>
<span class="id">-</span><span class="id"> apply/cvg_ex;</span><span class="id"> eexists;</span><span class="id"> apply/ereal_nondecreasing_cvgn</span><span class="id"> =&gt;</span><span class="id"> a</span><span class="id"> b</span><span class="id"> ab</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> le_ereal_inf</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> _</span><span class="id"> [n</span><span class="id"> /=</span><span class="id"> bn</span><span class="id"> &lt;-]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="gallina-kwd"> exists</span><span class="id"> n</span><span class="id"> =&gt;</span><span class="id"> //=;</span><span class="id"> rewrite</span> (<span class="id">leq_trans</span><span class="id"> ab</span>).<br/>
<span class="id">-</span><span class="id"> apply:</span><span class="id"> nearW</span><span class="id"> =&gt;</span><span class="id"> m</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> :</span><span class="gallina-kwd"> forall</span><span class="id"> n</span><span class="id"> p,</span> (<span class="id">p</span><span class="id"> &gt;=</span><span class="id"> n</span>)<span class="id">%N</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> g</span><span class="id"> n</span><span class="id"> x</span><span class="id"> &lt;=</span><span class="id"> einfs</span> (<span class="gallina-kwd">fun</span><span class="id"> k</span><span class="id"> =&gt;</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> f</span><span class="id"> k</span><span class="id"> x</span>)<span class="id"> n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> n</span><span class="id"> p</span><span class="id"> np;</span><span class="id"> apply:</span><span class="id"> lb_ereal_inf</span><span class="id"> =&gt;</span><span class="id"> /=</span><span class="id"> _</span><span class="id"> [k</span><span class="id"> /=</span><span class="id"> nk</span><span class="id"> &lt;-]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> ge0_le_integral</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> [exact:</span><span class="id"> g0|exact:</span><span class="id"> mg|exact:</span><span class="id"> f0|]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> Dx;</span><span class="id"> apply:</span><span class="id"> ereal_inf_lbound;</span><span class="gallina-kwd"> exists</span><span class="id"> k</span>.<br/>
&nbsp;&nbsp;<span class="id">exact</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> fatou</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> integralN</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<span class="vernacular">Context</span><span class="id"> d</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">mu</span><span class="id"> :</span><span class="id"> {measure</span><span class="id"> set</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R}</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> integralN</span><span class="id"> D</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> f^\+</span><span class="id"> x</span><span class="id"> +?</span> (<span class="id">-</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> f^\-</span><span class="id"> x</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> -</span><span class="id"> f</span><span class="id"> x</span><span class="id"> =</span><span class="id"> -</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> f</span><span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">have</span><span class="id"> [f_fin</span><span class="id"> _|]</span><span class="id"> :=</span><span class="id"> boolP</span> (<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> f^\-</span><span class="id"> x</span><span class="id"> \is</span><span class="id"> a</span><span class="id"> fin_num</span>).<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> integralE//</span><span class="id"> [in</span><span class="id"> RHS]integralE//</span><span class="id"> fin_num_oppeD</span><span class="id"> ?fin_numN//</span><span class="id"> oppeK</span><span class="id"> addeC</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> funenegN</span>.<br/>
<span class="id">rewrite</span><span class="id"> fin_numE</span><span class="id"> negb_and</span><span class="id"> 2!negbK</span><span class="id"> =&gt;</span><span class="id"> /orP[nfoo|/eqP</span><span class="id"> nfoo]</span>.<br/>
&nbsp;&nbsp;<span class="id">exfalso;</span><span class="id"> move/negP</span><span class="id"> :</span><span class="id"> nfoo;</span><span class="id"> apply;</span><span class="id"> rewrite</span><span class="id"> -leeNy_eq;</span><span class="id"> apply/negP</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -ltNge</span> (<span class="id">lt_le_trans</span><span class="id"> _</span> (<span class="id">integral_ge0</span><span class="id"> _</span><span class="id"> _</span>)).<br/>
<span class="id">rewrite</span><span class="id"> nfoo</span><span class="id"> adde_defEninfty</span><span class="id"> -leye_eq</span><span class="id"> -ltNge</span><span class="id"> ltey_eq</span><span class="id"> =&gt;</span><span class="id"> /orP[f_fin|/eqP</span><span class="id"> pfoo]</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> integralE</span><span class="id"> [in</span><span class="id"> RHS]integralE</span><span class="id"> nfoo</span><span class="id"> [in</span><span class="id"> RHS]addeC/=</span><span class="id"> funenegN</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> addye//</span><span class="id"> eqe_oppLR/=</span> (<span class="id">andP</span> (<span class="id">eqbLR</span> (<span class="id">fin_numE</span><span class="id"> _</span>)<span class="id"> f_fin</span>)).<span class="id">2</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> integralE//</span><span class="id"> [in</span><span class="id"> RHS]integralE//</span><span class="id"> funeposN</span><span class="id"> funenegN</span><span class="id"> nfoo</span><span class="id"> pfoo</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> integral_ge0N</span> (<span class="id">D</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">forall</span><span class="id"> x,</span><span class="id"> D</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> f</span><span class="id"> x</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> -</span><span class="id"> f</span><span class="id"> x</span><span class="id"> =</span><span class="id"> -</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> f</span><span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> f0;</span><span class="id"> rewrite</span><span class="id"> integralN</span><span class="id"> //</span> (<span class="id">eq_integral</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">ge0_funenegE</span><span class="id"> _</span>))<span class="id">//</span><span class="id"> integral0</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> oppe0</span><span class="id"> fin_num_adde_defl</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> integralN</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> integral_cst</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<span class="vernacular">Context</span><span class="id"> d</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">mu</span><span class="id"> :</span><span class="id"> {measure</span><span class="id"> set</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R}</span>).<br/>
<span class="vernacular">Variables</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>) (<span class="id">D</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T</span>) (<span class="id">mD</span><span class="id"> :</span><span class="id"> measurable</span><span class="id"> D</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> sintegral_EFin_cst</span> (<span class="id">x</span><span class="id"> :</span><span class="id"> {nonneg</span><span class="id"> R}</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">sintegral</span><span class="id"> mu</span> (<span class="id">cst</span><span class="id"> x%:num</span><span class="id"> \_</span><span class="id"> D</span>)<span class="id"> =</span><span class="id"> x%:num%:E</span><span class="id"> *</span><span class="id"> mu</span><span class="id"> D</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> sintegralE</span> (<span class="id">fsbig_widen</span><span class="id"> _</span><span class="id"> [set</span><span class="id"> 0%R;</span><span class="id"> x%:num]</span>)<span class="id">/=</span>.<br/>
<span class="id">-</span><span class="id"> have</span><span class="id"> [-&gt;|x0]</span><span class="id"> :=</span><span class="id"> eqVneq</span><span class="id"> x%:num</span><span class="id"> 0%R;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> setUid</span><span class="id"> fsbig_set1</span><span class="id"> !mul0e</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> fsbigU0//=;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> y</span><span class="id"> [-&gt;]/esym;</span><span class="id"> apply/eqP</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> !fsbig_set1</span><span class="id"> mul0e</span><span class="id"> add0e</span><span class="id"> preimage_restrict//</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> ifN</span><span class="id"> ?set0U</span><span class="id"> ?setIidl//=</span><span class="id"> notin_setE</span><span class="id"> =&gt;</span><span class="id"> /esym;</span><span class="id"> exact/eqP</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> y</span><span class="id"> [t</span><span class="id"> _</span><span class="id"> &lt;-]</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> /patch;</span><span class="id"> case:</span><span class="id"> ifPn;</span><span class="id"> [right|left]</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> y</span><span class="id"> [_</span><span class="id"> /=/preimage10-&gt;];</span><span class="id"> rewrite</span><span class="id"> measure0</span><span class="id"> mule0</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Import</span><span class="id"> HBNNSimple</span>.<br/>
<br/>
<span class="vernacular">Local</span><span class="vernacular"> Lemma</span><span class="id"> integral_cstr</span><span class="id"> r</span><span class="id"> :</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> r%:E</span><span class="id"> =</span><span class="id"> r%:E</span><span class="id"> *</span><span class="id"> mu</span><span class="id"> D</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">wlog</span><span class="id"> r0</span><span class="id"> :</span><span class="id"> r</span><span class="id"> /</span> (<span class="id">0</span><span class="id"> &lt;=</span><span class="id"> r</span>)<span class="id">%R</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> h;</span><span class="id"> have</span><span class="id"> [|r0]</span><span class="id"> :=</span><span class="id"> leP</span><span class="id"> 0%R</span><span class="id"> r;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> h</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -[in</span><span class="id"> RHS]</span>(<span class="id">opprK</span><span class="id"> r</span>)<span class="id"> EFinN</span><span class="id"> mulNe</span><span class="id"> -h</span><span class="id"> ?oppr_ge0;</span><span class="id"> last</span><span class="id"> exact:</span><span class="id"> ltW</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -integral_ge0N//;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> t</span><span class="id"> ?;</span><span class="id"> rewrite</span><span class="id"> /=</span><span class="id"> lee_fin</span><span class="id"> oppr_ge0</span><span class="id"> ltW</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> under</span><span class="id"> [RHS]eq_integral</span><span class="id"> do</span><span class="id"> rewrite</span><span class="id"> /=</span><span class="id"> opprK</span>.<br/>
<span class="id">rewrite</span> (<span class="id">eq_integral</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> cst_nnsfun</span><span class="id"> T</span> (<span class="id">NngNum</span><span class="id"> r0</span>)))<span class="id">//</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> integral_nnsfun//</span><span class="id"> sintegral_EFin_cst</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Local</span><span class="vernacular"> Lemma</span><span class="id"> integral_csty</span><span class="id"> :</span><span class="id"> mu</span><span class="id"> D</span><span class="id"> !=</span><span class="id"> 0</span><span class="id"> -&gt;</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>) (<span class="id">cst</span><span class="id"> +oo</span>)<span class="id"> x</span><span class="id"> =</span><span class="id"> +oo</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> muD0;</span><span class="id"> pose</span><span class="id"> g</span><span class="id"> :</span> (<span class="id">T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id">^nat</span><span class="id"> :=</span><span class="gallina-kwd"> fun</span><span class="id"> n</span><span class="id"> =&gt;</span><span class="id"> cst</span><span class="id"> n%:R%:E</span>.<br/>
<span class="id">have</span><span class="id"> &lt;-</span><span class="id"> :</span> (<span class="gallina-kwd">fun</span><span class="id"> t</span><span class="id"> =&gt;</span><span class="id"> limn</span> (<span class="id">g^~</span><span class="id"> t</span>))<span class="id"> =</span><span class="id"> cst</span><span class="id"> +oo</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> funeqE</span><span class="id"> =&gt;</span><span class="id"> t;</span><span class="id"> apply/cvg_lim</span><span class="id"> =&gt;</span><span class="id"> //=</span>.<br/>
&nbsp;&nbsp;<span class="id">apply/cvgeryP/cvgryPge</span><span class="id"> =&gt;</span><span class="id"> M;</span><span class="gallina-kwd"> exists</span><span class="id"> `|ceil</span><span class="id"> M|%N</span><span class="id"> =&gt;</span><span class="id"> //=</span><span class="id"> m</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> /=</span><span class="id"> -</span>(<span class="id">ler_nat</span><span class="id"> R</span>)<span class="id">;</span><span class="id"> apply:</span><span class="id"> le_trans</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span> (<span class="id">le_trans</span> (<span class="id">ceil_ge</span><span class="id"> _</span>))<span class="id">//</span><span class="id"> natr_absz</span><span class="id"> ler_int</span><span class="id"> ler_norm</span>.<br/>
<span class="id">rewrite</span><span class="id"> monotone_convergence</span><span class="id"> //</span>.<br/>
<span class="id">-</span><span class="id"> under</span><span class="id"> [in</span><span class="id"> LHS]eq_fun</span><span class="id"> do</span><span class="id"> rewrite</span><span class="id"> integral_cstr</span>.<br/>
&nbsp;&nbsp;<span class="id">apply/cvg_lim</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> apply/cvgeyPge</span><span class="id"> =&gt;</span><span class="id"> M</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> [muDoo|muDoo]</span><span class="id"> :=</span><span class="id"> ltP</span> (<span class="id">mu</span><span class="id"> D</span>)<span class="id"> +oo;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">exists</span><span class="id"> 1%N</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> m</span><span class="id"> /=</span><span class="id"> m0;</span><span class="id"> move:</span><span class="id"> muDoo;</span><span class="id"> rewrite</span><span class="id"> leye_eq</span><span class="id"> =&gt;</span><span class="id"> /eqP</span><span class="id"> -&gt;</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> mulry</span><span class="id"> gtr0_sg</span><span class="id"> ?mul1e</span><span class="id"> ?leey//</span><span class="id"> ltr0n</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">exists</span><span class="id"> `|ceil</span> (<span class="id">M</span><span class="id"> /</span><span class="id"> fine</span> (<span class="id">mu</span><span class="id"> D</span>))<span class="id">|%N</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> m</span><span class="id"> /=</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -</span>(<span class="id">ler_nat</span><span class="id"> R</span>)<span class="id"> =&gt;</span><span class="id"> MDm;</span><span class="id"> rewrite</span><span class="id"> -</span>(<span class="id">@fineK</span><span class="id"> _</span> (<span class="id">mu</span><span class="id"> D</span>))<span class="id"> ?ge0_fin_numE//</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -lee_pdivrMr;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> fine_gt0//</span><span class="id"> lt0e</span><span class="id"> muD0</span><span class="id"> measure_ge0</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> lee_fin</span> (<span class="id">le_trans</span><span class="id"> _</span><span class="id"> MDm</span>)<span class="id">//</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> natr_absz</span> (<span class="id">le_trans</span> (<span class="id">ceil_ge</span><span class="id"> _</span>))<span class="id">//</span><span class="id"> ler_int</span><span class="id"> ler_norm</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> n;</span><span class="id"> exact:</span><span class="id"> measurable_cst</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> n</span><span class="id"> x</span><span class="id"> Dx;</span><span class="id"> rewrite</span><span class="id"> lee_fin</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> t</span><span class="id"> Dt</span><span class="id"> n</span><span class="id"> m</span><span class="id"> nm;</span><span class="id"> rewrite</span><span class="id"> /g</span><span class="id"> lee_fin</span><span class="id"> ler_nat</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Local</span><span class="vernacular"> Lemma</span><span class="id"> integral_cstNy</span><span class="id"> :</span><span class="id"> mu</span><span class="id"> D</span><span class="id"> !=</span><span class="id"> 0</span><span class="id"> -&gt;</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>) (<span class="id">cst</span><span class="id"> -oo</span>)<span class="id"> x</span><span class="id"> =</span><span class="id"> -oo</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> ?;</span><span class="id"> rewrite</span> (<span class="id">eq_integral</span> (<span class="id">\-</span><span class="id"> cst</span><span class="id"> +oo</span>))<span class="id"> ?integral_ge0N/=</span><span class="id"> ?integral_csty</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> integral_cst</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> transfer</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<span class="vernacular">Context</span><span class="id"> d1</span><span class="id"> d2</span> (<span class="id">X</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d1</span>) (<span class="id">Y</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d2</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>).<br/>
<span class="vernacular">Variables</span> (<span class="id">phi</span><span class="id"> :</span><span class="id"> X</span><span class="id"> -&gt;</span><span class="id"> Y</span>) (<span class="id">mphi</span><span class="id"> :</span><span class="id"> measurable_fun</span><span class="id"> setT</span><span class="id"> phi</span>).<br/>
<span class="vernacular">Variables</span> (<span class="id">mu</span><span class="id"> :</span><span class="id"> {measure</span><span class="id"> set</span><span class="id"> X</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R}</span>).<br/>
<br/>
<span class="vernacular">Import</span><span class="id"> HBNNSimple</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> ge0_integral_pushforward</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> Y</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">measurable_fun</span><span class="id"> setT</span><span class="id"> f</span><span class="id"> -&gt;</span> (<span class="gallina-kwd">forall</span><span class="id"> y,</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> f</span><span class="id"> y</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">\int[pushforward</span><span class="id"> mu</span><span class="id"> mphi]_y</span><span class="id"> f</span><span class="id"> y</span><span class="id"> =</span><span class="id"> \int[mu]_x</span> (<span class="id">f</span><span class="id"> \o</span><span class="id"> phi</span>)<span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> mf</span><span class="id"> f0</span>.<br/>
<span class="id">have</span><span class="id"> [f_</span><span class="id"> [ndf_</span><span class="id"> f_f]]</span><span class="id"> :=</span><span class="id"> approximation</span><span class="id"> measurableT</span><span class="id"> mf</span> (<span class="gallina-kwd">fun</span><span class="id"> t</span><span class="id"> _</span><span class="id"> =&gt;</span><span class="id"> f0</span><span class="id"> t</span>).<br/>
<span class="id">transitivity</span> (<span class="id">limn</span> (<span class="gallina-kwd">fun</span><span class="id"> n</span><span class="id"> =&gt;</span><span class="id"> \int[pushforward</span><span class="id"> mu</span><span class="id"> mphi]_x</span> (<span class="id">f_</span><span class="id"> n</span><span class="id"> x</span>)<span class="id">%:E</span>)).<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -monotone_convergence//</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> eq_integral</span><span class="id"> =&gt;</span><span class="id"> y</span><span class="id"> _;</span><span class="id"> apply/esym/cvg_lim</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> f_f</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> n;</span><span class="id"> exact/measurable_EFinP</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> n</span><span class="id"> y</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> lee_fin</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> y</span><span class="id"> _</span><span class="id"> m</span><span class="id"> n</span><span class="id"> mn;</span><span class="id"> rewrite</span><span class="id"> lee_fin;</span><span class="id"> apply/lefP/ndf_</span>.<br/>
<span class="id">rewrite</span> (_<span class="id"> :</span> (<span class="gallina-kwd">fun</span><span class="id"> _</span><span class="id"> =&gt;</span><span class="id"> _</span>)<span class="id"> =</span> (<span class="gallina-kwd">fun</span><span class="id"> n</span><span class="id"> =&gt;</span><span class="id"> \int[mu]_x</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> f_</span><span class="id"> n</span><span class="id"> \o</span><span class="id"> phi</span>)<span class="id"> x</span>)).<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -monotone_convergence//;</span><span class="id"> last</span><span class="id"> 3</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> n</span><span class="id"> /=;</span><span class="id"> apply:</span><span class="id"> measurableT_comp</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> measurableT_comp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> n</span><span class="id"> x</span><span class="id"> _</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> lee_fin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> _</span><span class="id"> m</span><span class="id"> n</span><span class="id"> mn;</span><span class="id"> rewrite</span><span class="id"> lee_fin;</span><span class="id"> exact/lefP/ndf_</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> eq_integral</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> _</span><span class="id"> /=;</span><span class="id"> apply/cvg_lim</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> f_f</span>.<br/>
<span class="id">apply/funext</span><span class="id"> =&gt;</span><span class="id"> n</span>.<br/>
<span class="id">have</span><span class="id"> mfnphi</span><span class="id"> r</span><span class="id"> :</span><span class="id"> measurable</span> (<span class="id">f_</span><span class="id"> n</span><span class="id"> @^-1`</span><span class="id"> [set</span><span class="id"> r]</span><span class="id"> \o</span><span class="id"> phi</span>).<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -[_</span><span class="id"> \o</span><span class="id"> _]/</span>(<span class="id">phi</span><span class="id"> @^-1`</span> (<span class="id">f_</span><span class="id"> n</span><span class="id"> @^-1`</span><span class="id"> [set</span><span class="id"> r]</span>))<span class="id"> -</span>(<span class="id">setTI</span> (_<span class="id"> @^-1`</span><span class="id"> _</span>)).<br/>
&nbsp;&nbsp;<span class="id">exact/mphi</span>.<br/>
<span class="id">transitivity</span> (<span class="id">\sum_</span>(<span class="id">k</span><span class="id"> \in</span><span class="id"> range</span> (<span class="id">f_</span><span class="id"> n</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">\int[mu]_x</span> (<span class="id">k</span><span class="id"> *</span><span class="id"> \1_</span>((<span class="id">f_</span><span class="id"> n</span><span class="id"> @^-1`</span><span class="id"> [set</span><span class="id"> k]</span>)<span class="id"> \o</span><span class="id"> phi</span>)<span class="id"> x</span>)<span class="id">%:E</span>).<br/>
&nbsp;&nbsp;<span class="id">under</span><span class="id"> eq_integral</span><span class="id"> do</span><span class="id"> rewrite</span><span class="id"> fimfunE</span><span class="id"> -fsumEFin//</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> ge0_integral_fsum//;</span><span class="id"> last</span><span class="id"> 2</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> y;</span><span class="id"> apply/measurable_EFinP;</span><span class="id"> exact:</span><span class="id"> measurable_funM</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> y</span><span class="id"> x</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> nnfun_muleindic_ge0</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> eq_fsbigr</span><span class="id"> =&gt;</span><span class="id"> r</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> integralZl_indic_nnsfun//</span><span class="id"> integral_indic//=</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> (<span class="id">integralZl_indic</span><span class="id"> _</span> (<span class="gallina-kwd">fun</span><span class="id"> r</span><span class="id"> =&gt;</span><span class="id"> f_</span><span class="id"> n</span><span class="id"> @^-1`</span><span class="id"> [set</span><span class="id"> r]</span><span class="id"> \o</span><span class="id"> phi</span>))<span class="id">//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> congr</span> (_<span class="id"> *</span><span class="id"> _</span>)<span class="id">;</span><span class="id"> rewrite</span><span class="id"> [RHS]</span>(<span class="id">@integral_indic</span>).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> r0;</span><span class="id"> rewrite</span><span class="id"> preimage_nnfun0</span>.<br/>
<span class="id">rewrite</span><span class="id"> -ge0_integral_fsum//;</span><span class="id"> last</span><span class="id"> 2</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> r;</span><span class="id"> apply/measurable_EFinP;</span><span class="id"> exact:</span><span class="id"> measurable_funM</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> r</span><span class="id"> x</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> nnfun_muleindic_ge0</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> eq_integral</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> fsumEFin//</span><span class="id"> -fimfunE</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> transfer</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> integral_dirac</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<span class="vernacular">Context</span><span class="id"> d</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d</span>) (<span class="id">a</span><span class="id"> :</span><span class="id"> T</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>).<br/>
<span class="vernacular">Variables</span> (<span class="id">D</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T</span>) (<span class="id">mD</span><span class="id"> :</span><span class="id"> measurable</span><span class="id"> D</span>).<br/>
<br/>
<span class="vernacular">Import</span><span class="id"> HBNNSimple</span>.<br/>
<br/>
<span class="vernacular">Let</span><span class="id"> ge0_integral_dirac</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>) (<span class="id">mf</span><span class="id"> :</span><span class="id"> measurable_fun</span><span class="id"> D</span><span class="id"> f</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">f0</span><span class="id"> :</span><span class="gallina-kwd"> forall</span><span class="id"> x,</span><span class="id"> D</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> f</span><span class="id"> x</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">D</span><span class="id"> a</span><span class="id"> -&gt;</span><span class="id"> \int[\d_a]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>) (<span class="id">f</span><span class="id"> x</span>)<span class="id"> =</span><span class="id"> f</span><span class="id"> a</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> Da;</span><span class="id"> have</span><span class="id"> [f_</span><span class="id"> [ndf_</span><span class="id"> f_f]]</span><span class="id"> :=</span><span class="id"> approximation</span><span class="id"> mD</span><span class="id"> mf</span><span class="id"> f0</span>.<br/>
<span class="id">transitivity</span> (<span class="id">limn</span> (<span class="gallina-kwd">fun</span><span class="id"> n</span><span class="id"> =&gt;</span><span class="id"> \int[\d_</span><span class="id"> a]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>) (<span class="id">f_</span><span class="id"> n</span><span class="id"> x</span>)<span class="id">%:E</span>)).<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -monotone_convergence//</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> apply:</span><span class="id"> eq_integral</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> Dx;</span><span class="id"> apply/esym/cvg_lim</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> apply:</span><span class="id"> f_f</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> inE</span><span class="gallina-kwd"> in</span><span class="id"> Dx</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> n;</span><span class="id"> apply/measurable_EFinP;</span><span class="id"> exact/measurable_funTS</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> *;</span><span class="id"> rewrite</span><span class="id"> lee_fin</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> _</span><span class="id"> m</span><span class="id"> n</span><span class="id"> mn;</span><span class="id"> rewrite</span><span class="id"> lee_fin;</span><span class="id"> exact/lefP/ndf_</span>.<br/>
<span class="id">rewrite</span> (_<span class="id"> :</span> (<span class="gallina-kwd">fun</span><span class="id"> _</span><span class="id"> =&gt;</span><span class="id"> _</span>)<span class="id"> =</span> (<span class="gallina-kwd">fun</span><span class="id"> n</span><span class="id"> =&gt;</span> (<span class="id">f_</span><span class="id"> n</span><span class="id"> a</span>)<span class="id">%:E</span>)).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply/cvg_lim</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> f_f</span>.<br/>
<span class="id">apply/funext</span><span class="id"> =&gt;</span><span class="id"> n</span>.<br/>
<span class="id">under</span><span class="id"> eq_integral</span><span class="id"> do</span><span class="id"> rewrite</span><span class="id"> fimfunE//</span><span class="id"> -fsumEFin//</span>.<br/>
<span class="id">rewrite</span><span class="id"> ge0_integral_fsum//</span>.<br/>
<span class="id">-</span><span class="id"> under</span><span class="id"> eq_fsbigr</span><span class="id"> do</span><span class="id"> rewrite</span><span class="id"> integralZl_indic_nnsfun//</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> /=</span> (<span class="id">fsbigD1</span> (<span class="id">f_</span><span class="id"> n</span><span class="id"> a</span>))<span class="id">//=;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="gallina-kwd"> exists</span><span class="id"> a</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> integral_indic//=</span><span class="id"> diracE</span><span class="id"> mem_set//</span><span class="id"> mule1</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> fsbig1</span><span class="id"> ?adde0//</span><span class="id"> =&gt;</span><span class="id"> r</span><span class="id"> /=</span><span class="id"> [_</span><span class="id"> rfna]</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> integral_indic//=</span><span class="id"> diracE</span><span class="id"> memNset</span><span class="id"> ?mule0//=</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply/not_andP;</span><span class="id"> left;</span><span class="id"> exact/nesym</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> r;</span><span class="id"> exact/measurable_EFinP/measurableT_comp</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> r</span><span class="id"> x</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> nnfun_muleindic_ge0</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> integral_dirac</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>) (<span class="id">mf</span><span class="id"> :</span><span class="id"> measurable_fun</span><span class="id"> D</span><span class="id"> f</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">\int[\d_</span><span class="id"> a]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> f</span><span class="id"> x</span><span class="id"> =</span><span class="id"> \d_a</span><span class="id"> D</span><span class="id"> *</span><span class="id"> f</span><span class="id"> a</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">have</span><span class="id"> [/[!inE]</span><span class="id"> aD|aD]</span><span class="id"> :=</span><span class="id"> boolP</span> (<span class="id">a</span><span class="id"> \in</span><span class="id"> D</span>).<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> integralE</span><span class="id"> ge0_integral_dirac//;</span><span class="id"> last</span><span class="id"> exact/measurable_funepos</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> ge0_integral_dirac//;</span><span class="id"> last</span><span class="id"> exact/measurable_funeneg</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> [in</span><span class="id"> RHS]</span>(<span class="id">funeposneg</span><span class="id"> f</span>)<span class="id"> diracE</span><span class="id"> mem_set//</span><span class="id"> mul1e</span>.<br/>
<span class="id">rewrite</span><span class="id"> diracE</span> (<span class="id">negbTE</span><span class="id"> aD</span>)<span class="id"> mul0e</span><span class="id"> -</span>(<span class="id">integral_measure_zero</span><span class="id"> D</span><span class="id"> f</span>)<span class="id">//</span>.<br/>
<span class="id">apply:</span><span class="id"> eq_measure_integral</span><span class="id"> =&gt;</span><span class="id"> //=</span><span class="id"> S</span><span class="id"> mS</span><span class="id"> DS;</span><span class="id"> rewrite</span><span class="id"> /dirac</span><span class="id"> indicE</span><span class="id"> memNset//</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> /DS/mem_set;</span><span class="id"> exact/negP</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> integral_dirac</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> integral_measure_sum_nnsfun</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<span class="vernacular">Context</span><span class="id"> d</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>).<br/>
<span class="vernacular">Variables</span> (<span class="id">m_</span><span class="id"> :</span><span class="id"> {measure</span><span class="id"> set</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R}^nat</span>) (<span class="id">N</span><span class="id"> :</span><span class="id"> nat</span>).<br/>
<span class="vernacular">Let</span><span class="id"> m</span><span class="id"> :=</span><span class="id"> msum</span><span class="id"> m_</span><span class="id"> N</span>.<br/>
<br/>
<span class="vernacular">Let</span><span class="id"> integral_measure_sum_indic</span> (<span class="id">E</span><span class="id"> D</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T</span>) (<span class="id">mE</span><span class="id"> :</span><span class="id"> measurable</span><span class="id"> E</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">mD</span><span class="id"> :</span><span class="id"> measurable</span><span class="id"> D</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">\int[m]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> E</span>) (<span class="id">\1_D</span><span class="id"> x</span>)<span class="id">%:E</span><span class="id"> =</span><span class="id"> \sum_</span>(<span class="id">n</span><span class="id"> &lt;</span><span class="id"> N</span>)<span class="id"> \int[m_</span><span class="id"> n]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> E</span>) (<span class="id">\1_D</span><span class="id"> x</span>)<span class="id">%:E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> integral_indic//=</span><span class="id"> /msum/=;</span><span class="id"> apply:</span><span class="id"> eq_bigr</span><span class="id"> =&gt;</span><span class="id"> i</span><span class="id"> _</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> integral_indic//</span><span class="id"> setIT</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Import</span><span class="id"> HBNNSimple</span>.<br/>
<br/>
<span class="vernacular">Let</span><span class="id"> integralT_measure_sum</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {nnsfun</span><span class="id"> T</span><span class="id"> &gt;-&gt;</span><span class="id"> R}</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">\int[m]_x</span> (<span class="id">f</span><span class="id"> x</span>)<span class="id">%:E</span><span class="id"> =</span><span class="id"> \sum_</span>(<span class="id">n</span><span class="id"> &lt;</span><span class="id"> N</span>)<span class="id"> \int[m_</span><span class="id"> n]_x</span> (<span class="id">f</span><span class="id"> x</span>)<span class="id">%:E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">under</span><span class="id"> eq_integral</span><span class="id"> do</span><span class="id"> rewrite</span><span class="id"> fimfunE</span><span class="id"> -fsumEFin//</span>.<br/>
<span class="id">rewrite</span><span class="id"> ge0_integral_fsum//;</span><span class="id"> last</span><span class="id"> 2</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> r</span><span class="id"> /=;</span><span class="id"> apply:</span><span class="id"> measurableT_comp</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> measurableT_comp</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> r</span><span class="id"> t</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> EFinM</span><span class="id"> nnfun_muleindic_ge0</span>.<br/>
<span class="id">transitivity</span> (<span class="id">\sum_</span>(<span class="id">i</span><span class="id"> \in</span><span class="id"> range</span><span class="id"> f</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">\sum_</span>(<span class="id">n</span><span class="id"> &lt;</span><span class="id"> N</span>)<span class="id"> i%:E</span><span class="id"> *</span><span class="id"> \int[m_</span><span class="id"> n]_x</span> (<span class="id">\1_</span>(<span class="id">f</span><span class="id"> @^-1`</span><span class="id"> [set</span><span class="id"> i]</span>)<span class="id"> x</span>)<span class="id">%:E</span>)).<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> eq_fsbigr</span><span class="id"> =&gt;</span><span class="id"> r</span><span class="id"> _</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> integralZl_indic_nnsfun//</span><span class="id"> integral_measure_sum_indic//</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> ge0_sume_distrr//</span><span class="id"> =&gt;</span><span class="id"> n</span><span class="id"> _;</span><span class="id"> apply:</span><span class="id"> integral_ge0</span><span class="id"> =&gt;</span><span class="id"> t</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> lee_fin</span>.<br/>
<span class="id">rewrite</span><span class="id"> fsbig_finite//=</span><span class="id"> exchange_big/=;</span><span class="id"> apply:</span><span class="id"> eq_bigr</span><span class="id"> =&gt;</span><span class="id"> i</span><span class="id"> _</span>.<br/>
<span class="id">rewrite</span><span class="id"> integralT_nnsfun</span><span class="id"> sintegralE</span><span class="id"> fsbig_finite//=;</span><span class="id"> apply:</span><span class="id"> eq_bigr</span><span class="id"> =&gt;</span><span class="id"> r</span><span class="id"> _</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> congr</span> (_<span class="id"> *</span><span class="id"> _</span>)<span class="id">;</span><span class="id"> rewrite</span><span class="id"> integral_indic//</span><span class="id"> setIT</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> integral_measure_sum_nnsfun</span> (<span class="id">D</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T</span>) (<span class="id">mD</span><span class="id"> :</span><span class="id"> measurable</span><span class="id"> D</span>)<br/>
&nbsp;&nbsp;(<span class="id">f</span><span class="id"> :</span><span class="id"> {nnsfun</span><span class="id"> T</span><span class="id"> &gt;-&gt;</span><span class="id"> R}</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">\int[m]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>) (<span class="id">f</span><span class="id"> x</span>)<span class="id">%:E</span><span class="id"> =</span><span class="id"> \sum_</span>(<span class="id">n</span><span class="id"> &lt;</span><span class="id"> N</span>)<span class="id"> \int[m_</span><span class="id"> n]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>) (<span class="id">f</span><span class="id"> x</span>)<span class="id">%:E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> integral_mkcond</span>.<br/>
<span class="id">transitivity</span> (<span class="id">\int[m]_x</span> (<span class="id">proj_nnsfun</span><span class="id"> f</span><span class="id"> mD</span><span class="id"> x</span>)<span class="id">%:E</span>).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> eq_integral</span><span class="id"> =&gt;</span><span class="id"> t</span><span class="id"> _</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> /patch</span><span class="id"> mindicE;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">case:</span><span class="id"> ifPn</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> tD;</span><span class="id"> rewrite</span><span class="id"> ?mulr1</span><span class="id"> ?mulr0</span>.<br/>
<span class="id">rewrite</span><span class="id"> integralT_measure_sum;</span><span class="id"> apply:</span><span class="id"> eq_bigr</span><span class="id"> =&gt;</span><span class="id"> i</span><span class="id"> _</span>.<br/>
<span class="id">rewrite</span><span class="id"> [RHS]integral_mkcond;</span><span class="id"> apply:</span><span class="id"> eq_integral</span><span class="id"> =&gt;</span><span class="id"> t</span><span class="id"> _</span>.<br/>
<span class="id">rewrite</span><span class="id"> /=</span><span class="id"> /patch</span><span class="id"> /mindic</span><span class="id"> indicE</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> case:</span> (<span class="id">boolP</span> (<span class="id">t</span><span class="id"> \in</span><span class="id"> D</span>))<span class="id"> =&gt;</span><span class="id"> tD;</span><span class="id"> rewrite</span><span class="id"> ?mulr1</span><span class="id"> ?mulr0</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> integral_measure_sum_nnsfun</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> integral_measure_add_nnsfun</span>.<br/>
<span class="vernacular">Import</span><span class="id"> HBNNSimple</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> integral_measure_add_nnsfun</span><span class="id"> d</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">m1</span><span class="id"> m2</span><span class="id"> :</span><span class="id"> {measure</span><span class="id"> set</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R}</span>) (<span class="id">D</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T</span>) (<span class="id">mD</span><span class="id"> :</span><span class="id"> measurable</span><span class="id"> D</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">f</span><span class="id"> :</span><span class="id"> {nnsfun</span><span class="id"> T</span><span class="id"> &gt;-&gt;</span><span class="id"> R}</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;(<span class="id">\int[measure_add</span><span class="id"> m1</span><span class="id"> m2]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>) (<span class="id">f</span><span class="id"> x</span>)<span class="id">%:E</span><span class="id"> =</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id">\int[m1]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>) (<span class="id">f</span><span class="id"> x</span>)<span class="id">%:E</span><span class="id"> +</span><span class="id"> \int[m2]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>) (<span class="id">f</span><span class="id"> x</span>)<span class="id">%:E</span>)<span class="id">%E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> /measureD</span><span class="id"> integral_measure_sum_nnsfun//</span><span class="id"> 2!big_ord_recl/=</span><span class="id"> big_ord0</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> adde0</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> integral_measure_add_nnsfun</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> integral_mfun_measure_sum</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<span class="vernacular">Context</span><span class="id"> d</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>).<br/>
<span class="vernacular">Variable</span><span class="id"> m_</span><span class="id"> :</span><span class="id"> {measure</span><span class="id"> set</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R}^nat</span>.<br/>
<br/>
<span class="vernacular">Import</span><span class="id"> HBNNSimple</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> ge0_integral_measure_sum</span> (<span class="id">D</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T</span>) (<span class="id">mD</span><span class="id"> :</span><span class="id"> measurable</span><span class="id"> D</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">f</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="gallina-kwd">forall</span><span class="id"> x,</span><span class="id"> D</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> f</span><span class="id"> x</span>)<span class="id"> -&gt;</span><span class="id"> measurable_fun</span><span class="id"> D</span><span class="id"> f</span><span class="id"> -&gt;</span><span class="gallina-kwd"> forall</span><span class="id"> N,</span><br/>
&nbsp;&nbsp;<span class="id">\int[msum</span><span class="id"> m_</span><span class="id"> N]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> f</span><span class="id"> x</span><span class="id"> =</span><span class="id"> \sum_</span>(<span class="id">n</span><span class="id"> &lt;</span><span class="id"> N</span>)<span class="id"> \int[m_</span><span class="id"> n]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> f</span><span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> f0</span><span class="id"> mf</span>.<br/>
<span class="id">have</span><span class="id"> [f_</span><span class="id"> [f_nd</span><span class="id"> f_f]]</span><span class="id"> :=</span><span class="id"> approximation</span><span class="id"> mD</span><span class="id"> mf</span><span class="id"> f0</span>.<br/>
<span class="id">elim</span><span class="id"> =&gt;</span><span class="id"> [|N</span><span class="id"> ih];</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> big_ord0</span><span class="id"> msum_mzero</span><span class="id"> integral_measure_zero</span>.<br/>
<span class="id">rewrite</span><span class="id"> big_ord_recr/=</span><span class="id"> -ih</span>.<br/>
<span class="id">rewrite</span> (_<span class="id"> :</span><span class="id"> _</span><span class="id"> m_</span><span class="id"> N</span>.<span class="id">+1</span><span class="id"> =</span><span class="id"> measure_add</span> (<span class="id">msum</span><span class="id"> m_</span><span class="id"> N</span>) (<span class="id">m_</span><span class="id"> N</span>))<span class="id">;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply/funext</span><span class="id"> =&gt;</span><span class="id"> A;</span><span class="id"> rewrite</span><span class="id"> measure_addE</span><span class="id"> /msum/=</span><span class="id"> big_ord_recr</span>.<br/>
<span class="id">have</span><span class="id"> mf_</span><span class="id"> n</span><span class="id"> :</span><span class="id"> measurable_fun</span><span class="id"> D</span> (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> =&gt;</span> (<span class="id">f_</span><span class="id"> n</span><span class="id"> x</span>)<span class="id">%:E</span>).<br/>
&nbsp;&nbsp;<span class="id">exact/measurable_funTS/measurable_EFinP</span>.<br/>
<span class="id">have</span><span class="id"> f_ge0</span><span class="id"> n</span><span class="id"> x</span><span class="id"> :</span><span class="id"> D</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> 0</span><span class="id"> &lt;=</span> (<span class="id">f_</span><span class="id"> n</span><span class="id"> x</span>)<span class="id">%:E</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> Dx;</span><span class="id"> rewrite</span><span class="id"> lee_fin</span>.<br/>
<span class="id">have</span><span class="id"> cvg_f_</span> (<span class="id">m</span><span class="id"> :</span><span class="id"> {measure</span><span class="id"> set</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R}</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cvgn</span> (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> \int[m]_</span>(<span class="id">x0</span><span class="gallina-kwd"> in</span><span class="id"> D</span>) (<span class="id">f_</span><span class="id"> x</span><span class="id"> x0</span>)<span class="id">%:E</span>).<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> ereal_nondecreasing_is_cvgn</span><span class="id"> =&gt;</span><span class="id"> a</span><span class="id"> b</span><span class="id"> ab</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> ge0_le_integral</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> [exact:</span><span class="id"> f_ge0|exact:</span><span class="id"> f_ge0|]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> t</span><span class="id"> Dt;</span><span class="id"> rewrite</span><span class="id"> lee_fin;</span><span class="id"> apply/lefP/f_nd</span>.<br/>
<span class="id">transitivity</span> (<span class="id">limn</span> (<span class="gallina-kwd">fun</span><span class="id"> n</span><span class="id"> =&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">\int[measure_add</span> (<span class="id">msum</span><span class="id"> m_</span><span class="id"> N</span>) (<span class="id">m_</span><span class="id"> N</span>)<span class="id">]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>) (<span class="id">f_</span><span class="id"> n</span><span class="id"> x</span>)<span class="id">%:E</span>)).<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -monotone_convergence//;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> t</span><span class="id"> Dt</span><span class="id"> a</span><span class="id"> b</span><span class="id"> ab;</span><span class="id"> rewrite</span><span class="id"> lee_fin;</span><span class="id"> exact/lefP/f_nd</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> eq_integral</span><span class="id"> =&gt;</span><span class="id"> t</span><span class="id"> /[!inE]</span><span class="id"> Dt;</span><span class="id"> apply/esym/cvg_lim</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> f_f</span>.<br/>
<span class="id">transitivity</span> (<span class="id">limn</span> (<span class="gallina-kwd">fun</span><span class="id"> n</span><span class="id"> =&gt;</span><br/>
&nbsp;&nbsp;<span class="id">\int[msum</span><span class="id"> m_</span><span class="id"> N]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>) (<span class="id">f_</span><span class="id"> n</span><span class="id"> x</span>)<span class="id">%:E</span><span class="id"> +</span><span class="id"> \int[m_</span><span class="id"> N]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>) (<span class="id">f_</span><span class="id"> n</span><span class="id"> x</span>)<span class="id">%:E</span>)).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> congr</span> (<span class="id">limn</span><span class="id"> _</span>)<span class="id">;</span><span class="id"> apply/funext</span><span class="id"> =&gt;</span><span class="id"> n;</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> integral_measure_add_nnsfun</span>.<br/>
<span class="id">rewrite</span><span class="id"> limeD//;</span><span class="id"> do?[exact:</span><span class="id"> cvg_f_];</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> ge0_adde_def;</span><span class="id"> rewrite</span><span class="id"> inE;</span><span class="id"> apply:</span><span class="id"> lime_ge</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> do?[exact:</span><span class="id"> cvg_f_];</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> nearW</span><span class="id"> =&gt;</span><span class="id"> n;</span> <span class="id"> apply:</span><span class="id"> integral_ge0</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> f_ge0</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> congr</span> (_<span class="id"> +</span><span class="id"> _</span>)<span class="id">;</span> (<span class="id">rewrite</span><span class="id"> -monotone_convergence//;</span><span class="id"> [</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> eq_integral</span><span class="id"> =&gt;</span><span class="id"> t</span><span class="id"> /[!inE]</span><span class="id"> Dt;</span><span class="id"> apply/cvg_lim</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> f_f</span><span class="id"> |</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> t</span><span class="id"> Dt</span><span class="id"> a</span><span class="id"> b</span><span class="id"> ab;</span><span class="id"> rewrite</span><span class="id"> lee_fin;</span><span class="id"> exact/lefP/f_nd]</span>).<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> integral_mfun_measure_sum</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> ge0_integral_measure_add</span><span class="id"> d</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">m1</span><span class="id"> m2</span><span class="id"> :</span><span class="id"> {measure</span><span class="id"> set</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R}</span>) (<span class="id">D</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T</span>) (<span class="id">mD</span><span class="id"> :</span><span class="id"> measurable</span><span class="id"> D</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">f</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">forall</span><span class="id"> x,</span><span class="id"> D</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> f</span><span class="id"> x</span>)<span class="id">%E</span><span class="id"> -&gt;</span><span class="id"> measurable_fun</span><span class="id"> D</span><span class="id"> f</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;(<span class="id">\int[measure_add</span><span class="id"> m1</span><span class="id"> m2]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> f</span><span class="id"> x</span><span class="id"> =</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id">\int[m1]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> f</span><span class="id"> x</span><span class="id"> +</span><span class="id"> \int[m2]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> f</span><span class="id"> x</span>)<span class="id">%E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> f0</span><span class="id"> mf;</span><span class="id"> rewrite</span><span class="id"> /measureD</span><span class="id"> ge0_integral_measure_sum//</span><span class="id"> 2!big_ord_recl/=</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> big_ord0</span><span class="id"> adde0</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Section</span><span class="id"> integral_measure_series</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<span class="vernacular">Context</span><span class="id"> d</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>).<br/>
<span class="vernacular">Variable</span><span class="id"> m_</span><span class="id"> :</span><span class="id"> {measure</span><span class="id"> set</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R}^nat</span>.<br/>
<span class="vernacular">Let</span><span class="id"> m</span><span class="id"> :=</span><span class="id"> mseries</span><span class="id"> m_</span><span class="id"> O</span>.<br/>
<br/>
<span class="vernacular">Let</span><span class="id"> integral_measure_series_indic</span> (<span class="id">D</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T</span>) (<span class="id">mD</span><span class="id"> :</span><span class="id"> measurable</span><span class="id"> D</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">\int[m]_x</span> (<span class="id">\1_D</span><span class="id"> x</span>)<span class="id">%:E</span><span class="id"> =</span><span class="id"> \sum_</span>(<span class="id">n</span><span class="id"> &lt;oo</span>)<span class="id"> \int[m_</span><span class="id"> n]_x</span> (<span class="id">\1_D</span><span class="id"> x</span>)<span class="id">%:E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> integral_indic//</span><span class="id"> setIT</span><span class="id"> /m/=</span><span class="id"> /mseries;</span><span class="id"> apply:</span><span class="id"> eq_eseriesr</span><span class="id"> =&gt;</span><span class="id"> i</span><span class="id"> _</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> integral_indic//</span><span class="id"> setIT</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Import</span><span class="id"> HBNNSimple</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> integral_measure_series_nnsfun</span> (<span class="id">D</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T</span>) (<span class="id">mD</span><span class="id"> :</span><span class="id"> measurable</span><span class="id"> D</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">f</span><span class="id"> :</span><span class="id"> {nnsfun</span><span class="id"> T</span><span class="id"> &gt;-&gt;</span><span class="id"> R}</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">\int[m]_x</span> (<span class="id">f</span><span class="id"> x</span>)<span class="id">%:E</span><span class="id"> =</span><span class="id"> \sum_</span>(<span class="id">n</span><span class="id"> &lt;oo</span>)<span class="id"> \int[m_</span><span class="id"> n]_x</span> (<span class="id">f</span><span class="id"> x</span>)<span class="id">%:E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">under</span><span class="id"> eq_integral</span><span class="id"> do</span><span class="id"> rewrite</span><span class="id"> fimfunE</span><span class="id"> -fsumEFin//</span>.<br/>
<span class="id">rewrite</span><span class="id"> ge0_integral_fsum//;</span><span class="id"> last</span><span class="id"> 2</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> r</span><span class="id"> /=;</span><span class="id"> apply:</span><span class="id"> measurableT_comp</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> measurableT_comp</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> r</span><span class="id"> t</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> EFinM</span><span class="id"> nnfun_muleindic_ge0</span>.<br/>
<span class="id">transitivity</span> (<span class="id">\sum_</span>(<span class="id">i</span><span class="id"> \in</span><span class="id"> range</span><span class="id"> f</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">\sum_</span>(<span class="id">n</span><span class="id"> &lt;oo</span>)<span class="id"> i%:E</span><span class="id"> *</span><span class="id"> \int[m_</span><span class="id"> n]_x</span> (<span class="id">\1_</span>(<span class="id">f</span><span class="id"> @^-1`</span><span class="id"> [set</span><span class="id"> i]</span>)<span class="id"> x</span>)<span class="id">%:E</span>)).<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> eq_fsbigr</span><span class="id"> =&gt;</span><span class="id"> r</span><span class="id"> _</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> integralZl_indic_nnsfun//</span><span class="id"> integral_measure_series_indic//</span><span class="id"> nneseriesZl//</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> n</span><span class="id"> _;</span><span class="id"> apply:</span><span class="id"> integral_ge0</span><span class="id"> =&gt;</span><span class="id"> t</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> lee_fin</span>.<br/>
<span class="id">rewrite</span><span class="id"> fsbig_finite//=</span><span class="id"> -nneseries_sum;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> r</span><span class="id"> j</span><span class="id"> _</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> [r0|r0]</span><span class="id"> :=</span><span class="id"> leP</span><span class="id"> 0%R</span><span class="id"> r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> mule_ge0//;</span><span class="id"> apply:</span><span class="id"> integral_ge0</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> t</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> lee_fin</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> integral0_eq</span><span class="id"> ?mule0//</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> _</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> preimage_nnfun0//</span><span class="id"> indicE</span><span class="id"> in_set0</span>.<br/>
<span class="id">apply:</span><span class="id"> eq_eseriesr</span><span class="id"> =&gt;</span><span class="id"> k</span><span class="id"> _</span>.<br/>
<span class="id">rewrite</span><span class="id"> integralT_nnsfun</span><span class="id"> sintegralE</span><span class="id"> fsbig_finite//=;</span><span class="id"> apply:</span><span class="id"> eq_bigr</span><span class="id"> =&gt;</span><span class="id"> r</span><span class="id"> _</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> congr</span> (_<span class="id"> *</span><span class="id"> _</span>)<span class="id">;</span><span class="id"> rewrite</span><span class="id"> integral_indic//</span><span class="id"> setIT</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> integral_measure_series</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> ge0_integral_measure_series</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<span class="vernacular">Context</span><span class="id"> d</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>).<br/>
<span class="vernacular">Variable</span><span class="id"> m_</span><span class="id"> :</span><span class="id"> {measure</span><span class="id"> set</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R}^nat</span>.<br/>
<span class="vernacular">Let</span><span class="id"> m</span><span class="id"> :=</span><span class="id"> mseries</span><span class="id"> m_</span><span class="id"> O</span>.<br/>
<br/>
<span class="vernacular">Import</span><span class="id"> HBNNSimple</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> ge0_integral_measure_series</span> (<span class="id">D</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T</span>) (<span class="id">mD</span><span class="id"> :</span><span class="id"> measurable</span><span class="id"> D</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">forall</span><span class="id"> t,</span><span class="id"> D</span><span class="id"> t</span><span class="id"> -&gt;</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> f</span><span class="id"> t</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">measurable_fun</span><span class="id"> D</span><span class="id"> f</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">\int[m]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> f</span><span class="id"> x</span><span class="id"> =</span><span class="id"> \sum_</span>(<span class="id">n</span><span class="id"> &lt;oo</span>)<span class="id"> \int[m_</span><span class="id"> n]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> f</span><span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> f0</span><span class="id"> mf</span>.<br/>
<span class="id">apply/eqP;</span><span class="id"> rewrite</span><span class="id"> eq_le;</span><span class="id"> apply/andP;</span><span class="id"> split;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">suff</span><span class="id"> :</span><span class="gallina-kwd"> forall</span><span class="id"> n,</span><span class="id"> \sum_</span>(<span class="id">k</span><span class="id"> &lt;</span><span class="id"> n</span>)<span class="id"> \int[m_</span><span class="id"> k]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> f</span><span class="id"> x</span><span class="id"> &lt;=</span><span class="id"> \int[m]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> f</span><span class="id"> x</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> n;</span><span class="id"> apply:</span><span class="id"> lime_le</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> is_cvg_ereal_nneg_natsum</span><span class="id"> =&gt;</span><span class="id"> k</span><span class="id"> _;</span><span class="id"> exact:</span><span class="id"> integral_ge0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> nearW</span><span class="id"> =&gt;</span><span class="id"> x;</span><span class="id"> rewrite</span><span class="id"> big_mkord</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> n</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> [X</span><span class="gallina-kwd"> in</span><span class="id"> _</span><span class="id"> &lt;=</span><span class="id"> X]</span>(_<span class="id"> :</span><span class="id"> _</span><span class="id"> =</span><span class="id"> \sum_</span>(<span class="id">k</span><span class="id"> &lt;</span><span class="id"> n</span>)<span class="id"> \int[m_</span><span class="id"> k]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> f</span><span class="id"> x</span><span class="id"> +</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">\int[mseries</span><span class="id"> m_</span><span class="id"> n]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> f</span><span class="id"> x</span>)<span class="id">;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">transitivity</span> (<span class="id">\int[measure_add</span> (<span class="id">msum</span><span class="id"> m_</span><span class="id"> n</span>) (<span class="id">mseries</span><span class="id"> m_</span><span class="id"> n</span>)<span class="id">]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> f</span><span class="id"> x</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">congr</span> (<span class="id">\int[_]_</span>(_<span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> _</span>)<span class="id">;</span><span class="id"> apply/funext</span><span class="id"> =&gt;</span><span class="id"> A</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> measure_addE/=</span><span class="id"> /msum</span><span class="id"> -</span>(<span class="id">big_mkord</span><span class="id"> xpredT</span> (<span class="id">m_</span><span class="id"> ^~</span><span class="id"> A</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> nneseries_split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> ge0_integral_measure_add//</span><span class="id"> -ge0_integral_measure_sum</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> leeDl;</span><span class="id"> exact:</span><span class="id"> integral_ge0</span>.<br/>
<span class="id">rewrite</span><span class="id"> ge0_integralE//=;</span><span class="id"> apply:</span><span class="id"> ub_ereal_sup</span><span class="id"> =&gt;</span><span class="id"> /=</span><span class="id"> _</span><span class="id"> [g</span><span class="id"> /=</span><span class="id"> gf]</span><span class="id"> &lt;-</span>.<br/>
<span class="id">rewrite</span><span class="id"> -integralT_nnsfun</span> (<span class="id">integral_measure_series_nnsfun</span><span class="id"> _</span><span class="id"> mD</span>).<br/>
<span class="id">apply:</span><span class="id"> lee_nneseries</span><span class="id"> =&gt;</span><span class="id"> n</span><span class="id"> _</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> integral_ge0</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> x</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> lee_fin</span>.<br/>
<span class="id">rewrite</span><span class="id"> [leRHS]integral_mkcond;</span><span class="id"> apply:</span><span class="id"> ge0_le_integral</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> lee_fin</span>.<br/>
<span class="id">-</span><span class="id"> exact/measurable_EFinP</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> erestrict_ge0</span>.<br/>
<span class="id">-</span><span class="id"> exact/</span>(<span class="id">measurable_restrictT</span><span class="id"> _</span><span class="id"> mD</span>).<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> ge0_integral_measure_series</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> subset_integral</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<span class="vernacular">Context</span><span class="id"> d</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">mu</span><span class="id"> :</span><span class="id"> {measure</span><span class="id"> set</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R}</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> ge0_integral_setU</span> (<span class="id">A</span><span class="id"> B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T</span>) (<span class="id">mA</span><span class="id"> :</span><span class="id"> measurable</span><span class="id"> A</span>) (<span class="id">mB</span><span class="id"> :</span><span class="id"> measurable</span><span class="id"> B</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">f</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id"> :</span><span class="id"> measurable_fun</span> (<span class="id">A</span><span class="id"> `|`</span><span class="id"> B</span>)<span class="id"> f</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">forall</span><span class="id"> x,</span> (<span class="id">A</span><span class="id"> `|`</span><span class="id"> B</span>)<span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> f</span><span class="id"> x</span>)<span class="id"> -&gt;</span><span class="id"> [disjoint</span><span class="id"> A</span><span class="id"> &amp;</span><span class="id"> B]</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> A</span><span class="id"> `|`</span><span class="id"> B</span>)<span class="id"> f</span><span class="id"> x</span><span class="id"> =</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> A</span>)<span class="id"> f</span><span class="id"> x</span><span class="id"> +</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> B</span>)<span class="id"> f</span><span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> mf</span><span class="id"> f0</span><span class="id"> AB</span>.<br/>
<span class="id">transitivity</span> (<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> A</span><span class="id"> `|`</span><span class="id"> B</span>) ((<span class="id">f</span><span class="id"> \_</span><span class="id"> A</span>)<span class="id"> x</span><span class="id"> +</span> (<span class="id">f</span><span class="id"> \_</span><span class="id"> B</span>)<span class="id"> x</span>)).<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> eq_integral</span><span class="id"> =&gt;</span><span class="id"> x;</span><span class="id"> rewrite</span><span class="id"> inE</span><span class="id"> =&gt;</span><span class="id"> -[xA|xB]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> /patch</span><span class="id"> mem_set//</span><span class="id"> ifF</span><span class="id"> ?adde0//;</span><span class="id"> apply/negbTE/negP;</span><span class="id"> rewrite</span><span class="id"> inE</span><span class="id"> =&gt;</span><span class="id"> xB</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move:</span><span class="id"> AB;</span><span class="id"> rewrite</span><span class="id"> disj_set2E</span><span class="id"> =&gt;</span><span class="id"> /eqP;</span><span class="id"> apply/eqP/set0P;</span><span class="gallina-kwd"> exists</span><span class="id"> x</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> /patch</span><span class="id"> addeC</span><span class="id"> mem_set//</span><span class="id"> ifF</span><span class="id"> ?adde0//;</span><span class="id"> apply/negbTE/negP;</span><span class="id"> rewrite</span><span class="id"> inE</span><span class="id"> =&gt;</span><span class="id"> xA</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move:</span><span class="id"> AB;</span><span class="id"> rewrite</span><span class="id"> disj_set2E</span><span class="id"> =&gt;</span><span class="id"> /eqP;</span><span class="id"> apply/eqP/set0P;</span><span class="gallina-kwd"> exists</span><span class="id"> x</span>.<br/>
<span class="id">rewrite</span><span class="id"> ge0_integralD//;</span><span class="id"> last</span><span class="id"> 5</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> exact:</span><span class="id"> measurableU</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> _;</span><span class="id"> apply:</span><span class="id"> erestrict_ge0</span><span class="id"> =&gt;</span><span class="id"> y</span><span class="id"> Ay;</span><span class="id"> apply:</span><span class="id"> f0;</span><span class="id"> left</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> apply/measurable_restrict</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> measurableU</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> measurable_funS</span><span class="id"> mf;</span><span class="id"> [exact:</span><span class="id"> measurableU|exact:</span><span class="id"> subIsetl]</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> _;</span><span class="id"> apply:</span><span class="id"> erestrict_ge0</span><span class="id"> =&gt;</span><span class="id"> y</span><span class="id"> By;</span><span class="id"> apply:</span><span class="id"> f0;</span><span class="id"> right</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> apply/measurable_restrict</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> measurableU</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> measurable_funS</span><span class="id"> mf;</span><span class="id"> [exact:</span><span class="id"> measurableU|exact:</span><span class="id"> subIsetl]</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -integral_mkcondl</span><span class="id"> setIC</span><span class="id"> setUK</span><span class="id"> -integral_mkcondl</span><span class="id"> setKU</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> ge0_subset_integral</span> (<span class="id">A</span><span class="id"> B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T</span>) (<span class="id">mA</span><span class="id"> :</span><span class="id"> measurable</span><span class="id"> A</span>) (<span class="id">mB</span><span class="id"> :</span><span class="id"> measurable</span><span class="id"> B</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">f</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id"> :</span><span class="id"> measurable_fun</span><span class="id"> B</span><span class="id"> f</span><span class="id"> -&gt;</span> (<span class="gallina-kwd">forall</span><span class="id"> x,</span><span class="id"> B</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> f</span><span class="id"> x</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">A</span><span class="id"> `&lt;=`</span><span class="id"> B</span><span class="id"> -&gt;</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> A</span>)<span class="id"> f</span><span class="id"> x</span><span class="id"> &lt;=</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> B</span>)<span class="id"> f</span><span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> mf</span><span class="id"> f0</span><span class="id"> AB;</span><span class="id"> rewrite</span><span class="id"> -</span>(<span class="id">setDUK</span><span class="id"> AB</span>)<span class="id"> ge0_integral_setU//;</span><span class="id"> last</span><span class="id"> 4</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> exact:</span><span class="id"> measurableD</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> setDUK</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> x;</span><span class="id"> rewrite</span><span class="id"> setDUK//;</span><span class="id"> exact:</span><span class="id"> f0</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> disj_set2E</span><span class="id"> setDIK</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> leeDl;</span><span class="id"> apply:</span><span class="id"> integral_ge0</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> [Bx</span><span class="id"> _];</span><span class="id"> exact:</span><span class="id"> f0</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> ge0_integral_bigsetU</span> (<span class="id">I</span><span class="id"> :</span><span class="id"> eqType</span>) (<span class="id">F</span><span class="id"> :</span><span class="id"> I</span><span class="id"> -&gt;</span><span class="id"> set</span><span class="id"> T</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">s</span><span class="id"> :</span><span class="id"> seq</span><span class="id"> I</span>)<span class="id"> :</span> (<span class="gallina-kwd">forall</span><span class="id"> n,</span><span class="id"> measurable</span> (<span class="id">F</span><span class="id"> n</span>))<span class="id"> -&gt;</span><span class="id"> uniq</span><span class="id"> s</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">trivIset</span><span class="id"> [set`</span><span class="id"> s]</span><span class="id"> F</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">let</span><span class="id"> D</span><span class="id"> :=</span><span class="id"> \big[setU/set0]_</span>(<span class="id">i</span><span class="id"> &lt;-</span><span class="id"> s</span>)<span class="id"> F</span><span class="id"> i</span><span class="gallina-kwd"> in</span><br/>
&nbsp;&nbsp;<span class="id">measurable_fun</span><span class="id"> D</span><span class="id"> f</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">forall</span><span class="id"> x,</span><span class="id"> D</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> f</span><span class="id"> x</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> f</span><span class="id"> x</span><span class="id"> =</span><span class="id"> \sum_</span>(<span class="id">i</span><span class="id"> &lt;-</span><span class="id"> s</span>)<span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> F</span><span class="id"> i</span>)<span class="id"> f</span><span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> mF;</span><span class="id"> elim:</span><span class="id"> s</span><span class="id"> =&gt;</span><span class="id"> [|h</span><span class="id"> t</span><span class="id"> ih]</span><span class="id"> us</span><span class="id"> tF</span><span class="id"> D</span><span class="id"> mf</span><span class="id"> f0</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /D</span><span class="id"> 2!big_nil</span><span class="id"> integral_set0</span>.<br/>
<span class="id">rewrite</span><span class="id"> /D</span><span class="id"> big_cons</span><span class="id"> ge0_integral_setU//</span>.<br/>
<span class="id">-</span><span class="id"> rewrite</span><span class="id"> big_cons</span><span class="id"> ih//</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> move:</span><span class="id"> us</span><span class="id"> =&gt;</span><span class="id"> /=</span><span class="id"> /andP[]</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> sub_trivIset</span><span class="id"> tF</span><span class="id"> =&gt;</span><span class="id"> /=</span><span class="id"> i</span><span class="id"> /=</span><span class="id"> it;</span><span class="id"> rewrite</span><span class="id"> inE</span><span class="id"> it</span><span class="id"> orbT</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="id"> apply:</span><span class="id"> measurable_funS</span><span class="id"> mf</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> bigsetU_measurable</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /D</span><span class="id"> big_cons;</span><span class="id"> exact:</span><span class="id"> subsetUr</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> UFx;</span><span class="id"> apply:</span><span class="id"> f0;</span><span class="id"> rewrite</span><span class="id"> /D</span><span class="id"> big_cons;</span><span class="id"> right</span>.<br/>
<span class="id">-</span><span class="id"> exact:</span><span class="id"> bigsetU_measurable</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move:</span><span class="id"> mf;</span><span class="id"> rewrite</span><span class="id"> /D</span><span class="id"> big_cons</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move:</span><span class="id"> f0;</span><span class="id"> rewrite</span><span class="id"> /D</span><span class="id"> big_cons</span>.<br/>
<span class="id">-</span><span class="id"> apply/eqP;</span><span class="id"> rewrite</span><span class="id"> big_distrr/=</span><span class="id"> big_seq</span><span class="id"> big1//</span><span class="id"> =&gt;</span><span class="id"> i</span><span class="id"> it</span>.<br/>
&nbsp;&nbsp;<span class="id">move/trivIsetP</span><span class="id"> :</span><span class="id"> tF;</span><span class="id"> apply</span><span class="id"> =&gt;</span><span class="id"> //=;</span><span class="id"> rewrite</span><span class="id"> ?mem_head//</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> inE</span><span class="id"> it</span><span class="id"> orbT</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> apply/eqP</span><span class="id"> =&gt;</span><span class="id"> hi;</span><span class="id"> move:</span><span class="id"> us</span><span class="id"> =&gt;</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> hi</span><span class="id"> it</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> le_integral_abse</span> (<span class="id">D</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T</span>) (<span class="id">mD</span><span class="id"> :</span><span class="id"> measurable</span><span class="id"> D</span>) (<span class="id">g</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id"> a</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">measurable_fun</span><span class="id"> D</span><span class="id"> g</span><span class="id"> -&gt;</span> (<span class="id">0</span><span class="id"> &lt;</span><span class="id"> a</span>)<span class="id">%R</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">a%:E</span><span class="id"> *</span><span class="id"> mu</span> (<span class="id">D</span><span class="id"> `&amp;`</span><span class="id"> [set</span><span class="id"> x</span><span class="id"> |</span><span class="id"> `|g</span><span class="id"> x|</span><span class="id"> &gt;=</span><span class="id"> a%:E]</span>)<span class="id"> &lt;=</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> `|g</span><span class="id"> x|</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> mg</span><span class="id"> a0;</span><span class="id"> have</span><span class="id"> ?</span><span class="id"> :</span><span class="id"> measurable</span> (<span class="id">D</span><span class="id"> `&amp;`</span><span class="id"> [set</span><span class="id"> x</span><span class="id"> |</span><span class="id"> a%:E</span><span class="id"> &lt;=</span><span class="id"> `|g</span><span class="id"> x|]</span>).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> emeasurable_fun_c_infty</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> measurableT_comp</span>.<br/>
<span class="id">apply:</span> (<span class="id">@le_trans</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span><span class="id"> `&amp;`</span><span class="id"> [set</span><span class="id"> x</span><span class="id"> |</span><span class="id"> `|g</span><span class="id"> x|</span><span class="id"> &gt;=</span><span class="id"> a%:E]</span>)<span class="id"> `|g</span><span class="id"> x|</span>)).<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -integral_cstr//;</span><span class="id"> apply:</span><span class="id"> ge0_le_integral</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> _</span><span class="id"> /=;</span><span class="id"> exact/ltW</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> measurableT_comp</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> measurable_funS</span><span class="id"> mg</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> /=</span><span class="id"> []</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> ge0_subset_integral</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> measurableT_comp</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> subset_integral</span>.<br/>
<span class="id">#[deprecated</span>(<span class="id">since=</span><span class="id">&quot;mathcomp-analysis 1.0.1&quot;</span><span class="id">,</span><span class="id"> note=</span><span class="id">&quot;use `ge0_integral_setU` instead&quot;</span>)<span class="id">]</span><br/>
<span class="vernacular">Notation</span><span class="id"> integral_setU</span><span class="id"> :=</span><span class="id"> ge0_integral_setU</span> (<span class="id">only</span><span class="id"> parsing</span>).<br/>
<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<span class="vernacular">Lemma</span><span class="id"> integral_setU_EFin</span><span class="id"> d</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>)<br/>
&nbsp;&nbsp;(<span class="id">mu</span><span class="id"> :</span><span class="id"> {measure</span><span class="id"> set</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R}</span>) (<span class="id">A</span><span class="id"> B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">measurable</span><span class="id"> A</span><span class="id"> -&gt;</span><span class="id"> measurable</span><span class="id"> B</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">measurable_fun</span> (<span class="id">A</span><span class="id"> `|`</span><span class="id"> B</span>)<span class="id"> f</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">[disjoint</span><span class="id"> A</span><span class="id"> &amp;</span><span class="id"> B]</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span> (<span class="id">A</span><span class="id"> `|`</span><span class="id"> B</span>)) (<span class="id">f</span><span class="id"> x</span>)<span class="id">%:E</span><span class="id"> =</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> A</span>) (<span class="id">f</span><span class="id"> x</span>)<span class="id">%:E</span><span class="id"> +</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> B</span>) (<span class="id">f</span><span class="id"> x</span>)<span class="id">%:E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> mA</span><span class="id"> mB</span><span class="id"> ABf</span><span class="id"> AB</span>.<br/>
<span class="id">rewrite</span><span class="id"> integralE/=</span>.<br/>
<span class="id">rewrite</span><span class="id"> ge0_integral_setU//;</span><span class="id"> last</span><span class="id"> exact/measurable_funepos/measurable_EFinP</span>.<br/>
<span class="id">rewrite</span><span class="id"> ge0_integral_setU//;</span><span class="id"> last</span><span class="id"> exact/measurable_funeneg/measurable_EFinP</span>.<br/>
<span class="id">rewrite</span><span class="id"> [X</span><span class="gallina-kwd"> in</span><span class="id"> _</span><span class="id"> =</span><span class="id"> X</span><span class="id"> +</span><span class="id"> _]integralE/=</span>.<br/>
<span class="id">rewrite</span><span class="id"> [X</span><span class="gallina-kwd"> in</span><span class="id"> _</span><span class="id"> =</span><span class="id"> _</span><span class="id"> +</span><span class="id"> X]integralE/=</span>.<br/>
<span class="id">set</span><span class="id"> ap</span><span class="id"> :</span><span class="id"> \bar</span><span class="id"> R</span><span class="id"> :=</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> A</span>)<span class="id"> _;</span><span class="id"> set</span><span class="id"> an</span><span class="id"> :</span><span class="id"> \bar</span><span class="id"> R</span><span class="id"> :=</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> A</span>)<span class="id"> _</span>.<br/>
<span class="id">set</span><span class="id"> bp</span><span class="id"> :</span><span class="id"> \bar</span><span class="id"> R</span><span class="id"> :=</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> B</span>)<span class="id"> _;</span><span class="id"> set</span><span class="id"> bn</span><span class="id"> :</span><span class="id"> \bar</span><span class="id"> R</span><span class="id"> :=</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> B</span>)<span class="id"> _</span>.<br/>
<span class="id">rewrite</span><span class="id"> oppeD</span><span class="id"> 1?addeACA//</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> ge0_adde_def//</span><span class="id"> inE</span><span class="id"> integral_ge0</span>.<br/>
Qed.</div></details>
<span class="vernacular">Local</span><span class="vernacular"> Close</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> Rintegral</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<span class="vernacular">Context</span><span class="id"> d</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">mu</span><span class="id"> :</span><span class="id"> {measure</span><span class="id"> set</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R}</span>).<br/>
<br/>
<span class="vernacular">Definition</span><span class="id"> Rintegral</span> (<span class="id">D</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> R</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">fine</span> (<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>) (<span class="id">f</span><span class="id"> x</span>)<span class="id">%:E</span>).<br/>
<br/>
<span class="vernacular">End</span><span class="id"> Rintegral</span>.<br/>
<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;\int [ mu ]_ ( x 'in' D ) f&quot;</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;(<span class="id">Rintegral</span><span class="id"> mu</span><span class="id"> D</span> (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> f</span>))<span class="id"> :</span><span class="id"> ring_scope</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;\int [ mu ]_ x f&quot;</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;(<span class="id">Rintegral</span><span class="id"> mu</span><span class="id"> setT</span> (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> f</span>))<span class="id"> :</span><span class="id"> ring_scope</span>.<br/>
<br/>
<span class="id">HB</span>.<span class="id">lock</span><span class="vernacular"> Definition</span><span class="id"> integrable</span><span class="id"> {d}</span><span class="id"> {T</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d}</span><span class="id"> {R</span><span class="id"> :</span><span class="id"> realType}</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">mu</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id"> D</span><span class="id"> f</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">`[&lt;</span><span class="id"> measurable_fun</span><span class="id"> D</span><span class="id"> f</span><span class="id"> /\</span> (<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> `|f</span><span class="id"> x|</span><span class="id"> &lt;</span><span class="id"> +oo</span>)<span class="id">%E</span><span class="id"> &gt;]</span>.<br/>
<span class="vernacular">Canonical</span><span class="id"> integrable_unlockable</span><span class="id"> :=</span><span class="id"> Unlockable</span><span class="id"> integrable</span>.<span class="id">unlock</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> integrableP</span><span class="id"> d</span><span class="id"> T</span><span class="id"> R</span><span class="id"> mu</span><span class="id"> D</span><span class="id"> f</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">reflect</span> (<span class="id">measurable_fun</span><span class="id"> D</span><span class="id"> f</span><span class="id"> /\</span> (<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> `|f</span><span class="id"> x|</span><span class="id"> &lt;</span><span class="id"> +oo</span>)<span class="id">%E</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">@integrable</span><span class="id"> d</span><span class="id"> T</span><span class="id"> R</span><span class="id"> mu</span><span class="id"> D</span><span class="id"> f</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> unlock;</span><span class="id"> apply/</span>(<span class="id">iffP</span> (<span class="id">asboolP</span><span class="id"> _</span>)). Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> measurable_int</span><span class="id"> d</span><span class="id"> T</span><span class="id"> R</span><span class="id"> mu</span><span class="id"> D</span><span class="id"> f</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">@integrable</span><span class="id"> d</span><span class="id"> T</span><span class="id"> R</span><span class="id"> mu</span><span class="id"> D</span><span class="id"> f</span><span class="id"> -&gt;</span><span class="id"> measurable_fun</span><span class="id"> D</span><span class="id"> f</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> unlock</span><span class="id"> =&gt;</span><span class="id"> /asboolP[]</span>. Qed.</div></details>
<span class="vernacular">Arguments</span><span class="id"> measurable_int</span><span class="id"> {d</span><span class="id"> T</span><span class="id"> R}</span><span class="id"> mu</span><span class="id"> {D</span><span class="id"> f}</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> integrable_theory</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<span class="vernacular">Context</span><span class="id"> d</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>).<br/>
<span class="vernacular">Variables</span> (<span class="id">mu</span><span class="id"> :</span><span class="id"> {measure</span><span class="id"> set</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R}</span>).<br/>
<span class="vernacular">Variables</span> (<span class="id">D</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T</span>) (<span class="id">mD</span><span class="id"> :</span><span class="id"> measurable</span><span class="id"> D</span>).<br/>
<span class="vernacular">Implicit</span><span class="gallina-kwd"> Type</span><span class="id"> f</span><span class="id"> g</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>.<br/>
<br/>
<span class="vernacular">Notation</span><span class="id"> mu_int</span><span class="id"> :=</span> (<span class="id">integrable</span><span class="id"> mu</span><span class="id"> D</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> integrable0</span><span class="id"> :</span><span class="id"> mu_int</span> (<span class="id">cst</span><span class="id"> 0</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">apply/integrableP;</span><span class="id"> split=&gt;</span><span class="id"> //;</span><span class="id"> under</span><span class="id"> eq_integral</span><span class="id"> do</span><span class="id"> rewrite</span> (<span class="id">gee0_abs</span> (<span class="id">lexx</span><span class="id"> 0</span>)).<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> integral0</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> eq_integrable</span><span class="id"> f</span><span class="id"> g</span><span class="id"> :</span><span class="id"> {in</span><span class="id"> D,</span><span class="id"> f</span><span class="id"> =1</span><span class="id"> g}</span><span class="id"> -&gt;</span><span class="id"> mu_int</span><span class="id"> f</span><span class="id"> -&gt;</span><span class="id"> mu_int</span><span class="id"> g</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> fg</span><span class="id"> /integrableP[mf</span><span class="id"> fi];</span><span class="id"> apply/integrableP;</span><span class="id"> split</span>.<br/>
&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> eq_measurable_fun</span><span class="id"> mf</span>.<br/>
<span class="id">rewrite</span> (<span class="id">le_lt_trans</span><span class="id"> _</span><span class="id"> fi</span>)<span class="id">//;</span><span class="id"> apply:</span><span class="id"> ge0_le_integral=&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> measurableT_comp</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> eq_measurable_fun</span><span class="id"> mf</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> measurableT_comp</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> eq_measurable_fun</span><span class="id"> mf</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> Dx;</span><span class="id"> rewrite</span><span class="id"> fg//</span><span class="id"> inE</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> le_integrable</span><span class="id"> f</span><span class="id"> g</span><span class="id"> :</span><span class="id"> measurable_fun</span><span class="id"> D</span><span class="id"> f</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">forall</span><span class="id"> x,</span><span class="id"> D</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> `|f</span><span class="id"> x|</span><span class="id"> &lt;=</span><span class="id"> `|g</span><span class="id"> x|</span>)<span class="id"> -&gt;</span><span class="id"> mu_int</span><span class="id"> g</span><span class="id"> -&gt;</span><span class="id"> mu_int</span><span class="id"> f</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> mf</span><span class="id"> fg</span><span class="id"> /integrableP[mfg</span><span class="id"> goo];</span><span class="id"> apply/integrableP;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> le_lt_trans</span><span class="id"> goo;</span><span class="id"> apply:</span><span class="id"> ge0_le_integral</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> measurableT_comp</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> integrableN</span><span class="id"> f</span><span class="id"> :</span><span class="id"> mu_int</span><span class="id"> f</span><span class="id"> -&gt;</span><span class="id"> mu_int</span> (<span class="id">-%E</span><span class="id"> \o</span><span class="id"> f</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> /integrableP[mf</span><span class="id"> foo];</span><span class="id"> apply/integrableP;</span><span class="id"> split;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /comp;</span><span class="id"> under</span><span class="id"> eq_fun</span><span class="id"> do</span><span class="id"> rewrite</span><span class="id"> abseN</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /comp;</span><span class="id"> exact:</span><span class="id"> measurableT_comp</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> integrableZl</span> (<span class="id">k</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> f</span><span class="id"> :</span><span class="id"> mu_int</span><span class="id"> f</span><span class="id"> -&gt;</span><span class="id"> mu_int</span> (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> k%:E</span><span class="id"> *</span><span class="id"> f</span><span class="id"> x</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> /integrableP[mf</span><span class="id"> foo];</span><span class="id"> apply/integrableP;</span><span class="id"> split</span>.<br/>
&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> measurable_funeM</span>.<br/>
<span class="id">under</span><span class="id"> eq_fun</span><span class="id"> do</span><span class="id"> rewrite</span><span class="id"> abseM</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> ge0_integralZl//</span><span class="id"> ?lte_mul_pinfty//;</span><span class="id"> exact:</span><span class="id"> measurableT_comp</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> integrableZr</span> (<span class="id">k</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> f</span><span class="id"> :</span><span class="id"> mu_int</span><span class="id"> f</span><span class="id"> -&gt;</span><span class="id"> mu_int</span> (<span class="id">f</span><span class="id"> \*</span><span class="id"> cst</span><span class="id"> k%:E</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> mf;</span><span class="id"> apply:</span><span class="id"> eq_integrable</span> (<span class="id">integrableZl</span><span class="id"> k</span><span class="id"> mf</span>)<span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> x;</span><span class="id"> rewrite</span><span class="id"> muleC</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> integrableD</span><span class="id"> f</span><span class="id"> g</span><span class="id"> :</span><span class="id"> mu_int</span><span class="id"> f</span><span class="id"> -&gt;</span><span class="id"> mu_int</span><span class="id"> g</span><span class="id"> -&gt;</span><span class="id"> mu_int</span> (<span class="id">f</span><span class="id"> \+</span><span class="id"> g</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> /integrableP[mf</span><span class="id"> foo]</span><span class="id"> /integrableP[mg</span><span class="id"> goo];</span><span class="id"> apply/integrableP;</span><span class="id"> split</span>.<br/>
&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> emeasurable_funD</span>.<br/>
<span class="id">apply:</span> (<span class="id">@le_lt_trans</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>) (<span class="id">`|f</span><span class="id"> x|</span><span class="id"> +</span><span class="id"> `|g</span><span class="id"> x|</span>))).<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> ge0_le_integral</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> measurableT_comp</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> emeasurable_funD</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> ?</span><span class="id"> ?;</span><span class="id"> apply:</span><span class="id"> adde_ge0</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> emeasurable_funD;</span><span class="id"> apply:</span><span class="id"> measurableT_comp</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> *;</span><span class="id"> exact:</span><span class="id"> lee_abs_add</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> ge0_integralD</span><span class="id"> //;</span><span class="id"> [exact:</span><span class="id"> lte_add_pinfty|</span><br/>
&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> measurableT_comp|exact:</span><span class="id"> measurableT_comp]</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> integrable_sum</span> (<span class="id">s</span><span class="id"> :</span><span class="id"> seq</span> (<span class="id">T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>))<span class="id"> :</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">forall</span><span class="id"> h,</span><span class="id"> h</span><span class="id"> \in</span><span class="id"> s</span><span class="id"> -&gt;</span><span class="id"> mu_int</span><span class="id"> h</span>)<span class="id"> -&gt;</span><span class="id"> mu_int</span> (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> \sum_</span>(<span class="id">h</span><span class="id"> &lt;-</span><span class="id"> s</span>)<span class="id"> h</span><span class="id"> x</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">elim:</span><span class="id"> s</span><span class="id"> =&gt;</span><span class="id"> [_|h</span><span class="id"> s</span><span class="id"> ih</span><span class="id"> hs]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> under</span><span class="id"> eq_fun</span><span class="id"> do</span><span class="id"> rewrite</span><span class="id"> big_nil;</span><span class="id"> exact:</span><span class="id"> integrable0</span>.<br/>
<span class="id">under</span><span class="id"> eq_fun</span><span class="id"> do</span><span class="id"> rewrite</span><span class="id"> big_cons;</span><span class="id"> apply:</span><span class="id"> integrableD</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> hs;</span><span class="id"> rewrite</span><span class="id"> in_cons</span><span class="id"> eqxx</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> ih</span><span class="id"> =&gt;</span><span class="id"> k</span><span class="id"> ks;</span><span class="id"> apply:</span><span class="id"> hs;</span><span class="id"> rewrite</span><span class="id"> in_cons</span><span class="id"> ks</span><span class="id"> orbT</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> integrableB</span><span class="id"> f</span><span class="id"> g</span><span class="id"> :</span><span class="id"> mu_int</span><span class="id"> f</span><span class="id"> -&gt;</span><span class="id"> mu_int</span><span class="id"> g</span><span class="id"> -&gt;</span><span class="id"> mu_int</span> (<span class="id">f</span><span class="id"> \-</span><span class="id"> g</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> fi</span><span class="id"> gi;</span><span class="id"> exact/</span>(<span class="id">integrableD</span><span class="id"> fi</span>)<span class="id">/integrableN</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> integrable_add_def</span><span class="id"> f</span><span class="id"> :</span><span class="id"> mu_int</span><span class="id"> f</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> f^\+</span><span class="id"> x</span><span class="id"> +?</span><span class="id"> -</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> f^\-</span><span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> /integrableP[mf];</span><span class="id"> rewrite</span><span class="id"> -[fun</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> _]/</span>(<span class="id">abse</span><span class="id"> \o</span><span class="id"> f</span>)<span class="id"> fune_abse</span><span class="id"> =&gt;</span><span class="id"> foo</span>.<br/>
<span class="id">rewrite</span><span class="id"> ge0_integralD</span><span class="id"> //</span><span class="gallina-kwd"> in</span><span class="id"> foo;</span><span class="id"> last</span><span class="id"> 2</span><span class="id"> first</span>.<br/>
<span class="id">-</span><span class="id"> exact:</span><span class="id"> measurable_funepos</span>.<br/>
<span class="id">-</span><span class="id"> exact:</span><span class="id"> measurable_funeneg</span>.<br/>
<span class="id">apply:</span><span class="id"> ltpinfty_adde_def</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> le_lt_trans</span><span class="id"> foo;</span><span class="id"> rewrite</span><span class="id"> leeDl//</span><span class="id"> integral_ge0</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> inE</span> (<span class="id">@le_lt_trans</span><span class="id"> _</span><span class="id"> _</span><span class="id"> 0</span>)<span class="id">//</span><span class="id"> leeNl</span><span class="id"> oppe0</span><span class="id"> integral_ge0</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> integrable_funepos</span><span class="id"> f</span><span class="id"> :</span><span class="id"> mu_int</span><span class="id"> f</span><span class="id"> -&gt;</span><span class="id"> mu_int</span><span class="id"> f^\+</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> /integrableP[Df</span><span class="id"> foo];</span><span class="id"> apply/integrableP;</span><span class="id"> split</span>.<br/>
&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> measurable_funepos</span>.<br/>
<span class="id">apply:</span><span class="id"> le_lt_trans</span><span class="id"> foo;</span><span class="id"> apply:</span><span class="id"> ge0_le_integral</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> apply/measurableT_comp</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> measurable_funepos</span>.<br/>
<span class="id">-</span><span class="id"> exact/measurableT_comp</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> t</span><span class="id"> Dt;</span><span class="id"> rewrite</span><span class="id"> -/</span>((<span class="id">abse</span><span class="id"> \o</span><span class="id"> f</span>)<span class="id"> t</span>)<span class="id"> fune_abse</span><span class="id"> gee0_abs//</span><span class="id"> leeDl</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> integrable_funeneg</span><span class="id"> f</span><span class="id"> :</span><span class="id"> mu_int</span><span class="id"> f</span><span class="id"> -&gt;</span><span class="id"> mu_int</span><span class="id"> f^\-</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> /integrableP[Df</span><span class="id"> foo];</span><span class="id"> apply/integrableP;</span><span class="id"> split</span>.<br/>
&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> measurable_funeneg</span>.<br/>
<span class="id">apply:</span><span class="id"> le_lt_trans</span><span class="id"> foo;</span><span class="id"> apply:</span><span class="id"> ge0_le_integral</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> apply/measurableT_comp</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> measurable_funeneg</span>.<br/>
<span class="id">-</span><span class="id"> exact/measurableT_comp</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> t</span><span class="id"> Dt;</span><span class="id"> rewrite</span><span class="id"> -/</span>((<span class="id">abse</span><span class="id"> \o</span><span class="id"> f</span>)<span class="id"> t</span>)<span class="id"> fune_abse</span><span class="id"> gee0_abs//</span><span class="id"> leeDr</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> integral_funeneg_lt_pinfty</span><span class="id"> f</span><span class="id"> :</span><span class="id"> mu_int</span><span class="id"> f</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> f^\-</span><span class="id"> x</span><span class="id"> &lt;</span><span class="id"> +oo</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> /integrableP[mf];</span><span class="id"> apply:</span><span class="id"> le_lt_trans;</span><span class="id"> apply:</span><span class="id"> ge0_le_integral</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
<span class="id">-</span><span class="id"> exact:</span><span class="id"> measurable_funeneg</span>.<br/>
<span class="id">-</span><span class="id"> exact:</span><span class="id"> measurableT_comp</span>.<br/>
<span class="id">-</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> Dx;</span><span class="id"> have</span><span class="id"> [fx0|/ltW</span><span class="id"> fx0]</span><span class="id"> :=</span><span class="id"> leP</span> (<span class="id">f</span><span class="id"> x</span>)<span class="id"> 0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> lee0_abs//</span><span class="id"> /funeneg</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move:</span><span class="id"> fx0;</span><span class="id"> rewrite</span><span class="id"> -{1}oppe0</span><span class="id"> -leeNr</span><span class="id"> =&gt;</span><span class="id"> /max_idPl</span><span class="id"> -&gt;</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> gee0_abs//</span><span class="id"> /funeneg</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move:</span> (<span class="id">fx0</span>)<span class="id">;</span><span class="id"> rewrite</span><span class="id"> -{1}oppe0</span><span class="id"> -leeNl</span><span class="id"> =&gt;</span><span class="id"> /max_idPr</span><span class="id"> -&gt;</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> integral_funepos_lt_pinfty</span><span class="id"> f</span><span class="id"> :</span><span class="id"> mu_int</span><span class="id"> f</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> f^\+</span><span class="id"> x</span><span class="id"> &lt;</span><span class="id"> +oo</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> /integrableP[mf];</span><span class="id"> apply:</span><span class="id"> le_lt_trans;</span><span class="id"> apply:</span><span class="id"> ge0_le_integral</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
<span class="id">-</span><span class="id"> exact:</span><span class="id"> measurable_funepos</span>.<br/>
<span class="id">-</span><span class="id"> exact:</span><span class="id"> measurableT_comp</span>.<br/>
<span class="id">-</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> Dx;</span><span class="id"> have</span><span class="id"> [fx0|/ltW</span><span class="id"> fx0]</span><span class="id"> :=</span><span class="id"> leP</span> (<span class="id">f</span><span class="id"> x</span>)<span class="id"> 0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> lee0_abs//</span><span class="id"> /funepos</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move:</span> (<span class="id">fx0</span>)<span class="id"> =&gt;</span><span class="id"> /max_idPr</span><span class="id"> -&gt;;</span><span class="id"> rewrite</span><span class="id"> -leeNr</span><span class="id"> oppe0</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> gee0_abs//</span><span class="id"> /funepos;</span><span class="id"> move:</span> (<span class="id">fx0</span>)<span class="id"> =&gt;</span><span class="id"> /max_idPl</span><span class="id"> -&gt;</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> integrable_neg_fin_num</span><span class="id"> f</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">mu_int</span><span class="id"> f</span><span class="id"> -&gt;</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> f^\-</span><span class="id"> x</span><span class="id"> \is</span><span class="id"> a</span><span class="id"> fin_num</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> /integrableP</span><span class="id"> fi</span>.<br/>
<span class="id">rewrite</span><span class="id"> fin_numElt;</span><span class="id"> apply/andP;</span><span class="id"> split</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span> (<span class="id">@lt_le_trans</span><span class="id"> _</span><span class="id"> _</span><span class="id"> 0</span>)<span class="id"> ?lte_ninfty//;</span><span class="id"> exact:</span><span class="id"> integral_ge0</span>.<br/>
<span class="id">case:</span><span class="id"> fi</span><span class="id"> =&gt;</span><span class="id"> mf;</span><span class="id"> apply:</span><span class="id"> le_lt_trans;</span><span class="id"> apply:</span><span class="id"> ge0_le_integral</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
<span class="id">-</span><span class="id"> exact/measurable_funeneg</span>.<br/>
<span class="id">-</span><span class="id"> exact/measurableT_comp</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> Dx;</span><span class="id"> rewrite</span><span class="id"> -/</span>((<span class="id">abse</span><span class="id"> \o</span><span class="id"> f</span>)<span class="id"> x</span>) (<span class="id">fune_abse</span><span class="id"> f</span>)<span class="id"> leeDr</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> integrable_pos_fin_num</span><span class="id"> f</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">mu_int</span><span class="id"> f</span><span class="id"> -&gt;</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> f^\+</span><span class="id"> x</span><span class="id"> \is</span><span class="id"> a</span><span class="id"> fin_num</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> /integrableP</span><span class="id"> fi</span>.<br/>
<span class="id">rewrite</span><span class="id"> fin_numElt;</span><span class="id"> apply/andP;</span><span class="id"> split</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span> (<span class="id">@lt_le_trans</span><span class="id"> _</span><span class="id"> _</span><span class="id"> 0</span>)<span class="id"> ?lte_ninfty//;</span><span class="id"> exact:</span><span class="id"> integral_ge0</span>.<br/>
<span class="id">case:</span><span class="id"> fi</span><span class="id"> =&gt;</span><span class="id"> mf;</span><span class="id"> apply:</span><span class="id"> le_lt_trans;</span><span class="id"> apply:</span><span class="id"> ge0_le_integral</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
<span class="id">-</span><span class="id"> exact/measurable_funepos</span>.<br/>
<span class="id">-</span><span class="id"> exact/measurableT_comp</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> Dx;</span><span class="id"> rewrite</span><span class="id"> -/</span>((<span class="id">abse</span><span class="id"> \o</span><span class="id"> f</span>)<span class="id"> x</span>) (<span class="id">fune_abse</span><span class="id"> f</span>)<span class="id"> leeDl</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> integrableMr</span> (<span class="id">h</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> R</span>)<span class="id"> g</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">measurable_fun</span><span class="id"> D</span><span class="id"> h</span><span class="id"> -&gt;</span><span class="id"> [bounded</span><span class="id"> h</span><span class="id"> x</span><span class="id"> |</span><span class="id"> x</span><span class="gallina-kwd"> in</span><span class="id"> D]</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">mu_int</span><span class="id"> g</span><span class="id"> -&gt;</span><span class="id"> mu_int</span> ((<span class="id">EFin</span><span class="id"> \o</span><span class="id"> h</span>)<span class="id"> \*</span><span class="id"> g</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> mh</span><span class="id"> [M</span><span class="id"> [Mreal</span><span class="id"> Mh]]</span><span class="id"> gi;</span><span class="id"> apply/integrableP;</span><span class="id"> split</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> emeasurable_funM</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> [exact:</span><span class="id"> measurableT_comp|</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> measurable_int</span><span class="id"> gi]</span>.<br/>
<span class="id">under</span><span class="id"> eq_integral</span><span class="id"> do</span><span class="id"> rewrite</span><span class="id"> abseM</span>.<br/>
<span class="id">have:</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>) (<span class="id">`|M</span><span class="id"> +</span><span class="id"> 1|%:E</span><span class="id"> *</span><span class="id"> `|g</span><span class="id"> x|</span>)<span class="id"> &lt;</span><span class="id"> +oo</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> ge0_integralZl</span><span class="id"> ?lte_mul_pinfty//;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> case/integrableP</span><span class="id"> :</span><span class="id"> gi</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> measurableT_comp</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> measurable_int</span><span class="id"> gi</span>.<br/>
<span class="id">apply/le_lt_trans/ge0_le_integral</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
<span class="id">-</span><span class="id"> apply/emeasurable_funM;</span><span class="id"> last</span><span class="id"> exact/measurableT_comp/</span>(<span class="id">measurable_int</span><span class="id"> _</span><span class="id"> gi</span>).<br/>
&nbsp;&nbsp;<span class="id">exact/measurable_EFinP/measurableT_comp</span>.<br/>
<span class="id">-</span><span class="id"> apply/emeasurable_funM</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> apply/measurableT_comp</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> measurable_int</span><span class="id"> gi</span>.<br/>
<span class="id">-</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> Dx;</span><span class="id"> rewrite</span><span class="id"> lee_wpmul2r//=</span><span class="id"> lee_fin</span><span class="id"> Mh//=</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span> (<span class="id">lt_le_trans</span><span class="id"> _</span> (<span class="id">ler_norm</span><span class="id"> _</span>))<span class="id">//</span><span class="id"> ltrDl</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> integrableMl</span><span class="id"> f</span> (<span class="id">h</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">mu_int</span><span class="id"> f</span><span class="id"> -&gt;</span><span class="id"> measurable_fun</span><span class="id"> D</span><span class="id"> h</span><span class="id"> -&gt;</span><span class="id"> [bounded</span><span class="id"> h</span><span class="id"> x</span><span class="id"> |</span><span class="id"> x</span><span class="gallina-kwd"> in</span><span class="id"> D]</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">mu_int</span> (<span class="id">f</span><span class="id"> \*</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> h</span>)).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> fi</span><span class="id"> mh</span><span class="id"> mg;</span><span class="id"> rewrite</span><span class="id"> /is_true</span><span class="id"> -</span>(<span class="id">integrableMr</span><span class="id"> mh</span><span class="id"> mg</span><span class="id"> fi</span>).<br/>
<span class="gallina-kwd">by</span><span class="id"> apply/congr1/funext</span><span class="id"> =&gt;</span><span class="id"> ?;</span><span class="id"> rewrite</span><span class="id"> muleC</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> integrable_restrict</span> (<span class="id">E</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T</span>) (<span class="id">mE</span><span class="id"> :</span><span class="id"> d</span>.<span class="id">-measurable</span><span class="id"> E</span>)<span class="id"> f</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">integrable</span><span class="id"> mu</span> (<span class="id">E</span><span class="id"> `&amp;`</span><span class="id"> D</span>)<span class="id"> f</span><span class="id"> &lt;-&gt;</span><span class="id"> integrable</span><span class="id"> mu</span><span class="id"> E</span> (<span class="id">f</span><span class="id"> \_</span><span class="id"> D</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">split;</span><span class="id"> move=&gt;</span><span class="id"> /integrableP[mf</span><span class="id"> intfoo];</span><span class="id"> apply/integrableP;</span><span class="id"> split</span>.<br/>
<span class="id">-</span><span class="id"> exact/measurable_restrict</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move:</span><span class="id"> intfoo;</span><span class="id"> rewrite</span><span class="id"> integral_mkcondr/=</span><span class="id"> restrict_abse</span>.<br/>
<span class="id">-</span><span class="id"> exact/measurable_restrict</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move:</span><span class="id"> intfoo;</span><span class="id"> rewrite</span><span class="id"> integral_mkcondr/=</span><span class="id"> restrict_abse</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> le_integral</span><span class="id"> f</span><span class="id"> g</span><span class="id"> :</span><span class="id"> mu_int</span><span class="id"> f</span><span class="id"> -&gt;</span><span class="id"> mu_int</span><span class="id"> g</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">{in</span><span class="id"> D,</span><span class="gallina-kwd"> forall</span><span class="id"> x,</span><span class="id"> f</span><span class="id"> x</span><span class="id"> &lt;=</span><span class="id"> g</span><span class="id"> x}</span><span class="id"> -&gt;</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> f</span><span class="id"> x</span><span class="id"> &lt;=</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> g</span><span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> intf</span><span class="id"> intg</span><span class="id"> fg;</span><span class="id"> rewrite</span><span class="id"> integralE</span><span class="id"> [leRHS]integralE</span><span class="id"> leeB//</span>.<br/>
<span class="id">-</span><span class="id"> apply:</span><span class="id"> ge0_le_integral</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> move/integrableP</span><span class="id"> :</span><span class="id"> intf</span><span class="id"> =&gt;</span><span class="id"> [+</span><span class="id"> _];</span><span class="id"> exact:</span><span class="id"> measurable_funepos</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> move/integrableP</span><span class="id"> :</span><span class="id"> intg</span><span class="id"> =&gt;</span><span class="id"> [+</span><span class="id"> _];</span><span class="id"> exact:</span><span class="id"> measurable_funepos</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> /mem_set;</span><span class="id"> exact:</span><span class="id"> funepos_le</span>.<br/>
<span class="id">-</span><span class="id"> apply:</span><span class="id"> ge0_le_integral</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> move/integrableP</span><span class="id"> :</span><span class="id"> intg</span><span class="id"> =&gt;</span><span class="id"> [+</span><span class="id"> _];</span><span class="id"> exact:</span><span class="id"> measurable_funeneg</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> move/integrableP</span><span class="id"> :</span><span class="id"> intf</span><span class="id"> =&gt;</span><span class="id"> [+</span><span class="id"> _];</span><span class="id"> exact:</span><span class="id"> measurable_funeneg</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> /mem_set;</span><span class="id"> exact:</span><span class="id"> funeneg_le</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> integrable_theory</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;mu .-integrable&quot;</span><span class="id"> :=</span> (<span class="id">integrable</span><span class="id"> mu</span>)<span class="id"> :</span><span class="id"> type_scope</span>.<br/>
<span class="vernacular">Arguments</span><span class="id"> eq_integrable</span><span class="id"> {d</span><span class="id"> T</span><span class="id"> R</span><span class="id"> mu</span><span class="id"> D}</span><span class="id"> mD</span><span class="id"> f</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> sequence_measure</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<span class="vernacular">Context</span><span class="id"> d</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>).<br/>
<span class="vernacular">Variable</span><span class="id"> m_</span><span class="id"> :</span><span class="id"> {measure</span><span class="id"> set</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R}^nat</span>.<br/>
<span class="vernacular">Let</span><span class="id"> m</span><span class="id"> :=</span><span class="id"> mseries</span><span class="id"> m_</span><span class="id"> O</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> integral_measure_series</span> (<span class="id">D</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T</span>) (<span class="id">mD</span><span class="id"> :</span><span class="id"> measurable</span><span class="id"> D</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">forall</span><span class="id"> n,</span><span class="id"> integrable</span> (<span class="id">m_</span><span class="id"> n</span>)<span class="id"> D</span><span class="id"> f</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">measurable_fun</span><span class="id"> D</span><span class="id"> f</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">\sum_</span>(<span class="id">n</span><span class="id"> &lt;oo</span>)<span class="id"> `|\int[m_</span><span class="id"> n]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> f^\-</span><span class="id"> x</span><span class="id"> |</span><span class="id"> &lt;</span><span class="id"> +oo%E</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">\sum_</span>(<span class="id">n</span><span class="id"> &lt;oo</span>)<span class="id"> `|\int[m_</span><span class="id"> n]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> f^\+</span><span class="id"> x</span><span class="id"> |</span><span class="id"> &lt;</span><span class="id"> +oo%E</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">\int[m]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> f</span><span class="id"> x</span><span class="id"> =</span><span class="id"> \sum_</span>(<span class="id">n</span><span class="id"> &lt;oo</span>)<span class="id"> \int[m_</span><span class="id"> n]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> f</span><span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> fi</span><span class="id"> mf</span><span class="id"> fmoo</span><span class="id"> fpoo;</span><span class="id"> rewrite</span><span class="id"> integralE</span>.<br/>
<span class="id">rewrite</span><span class="id"> ge0_integral_measure_series//;</span><span class="id"> last</span><span class="id"> exact/measurable_funepos</span>.<br/>
<span class="id">rewrite</span><span class="id"> ge0_integral_measure_series//;</span><span class="id"> last</span><span class="id"> exact/measurable_funeneg</span>.<br/>
<span class="id">transitivity</span> (<span class="id">\sum_</span>(<span class="id">n</span><span class="id"> &lt;oo</span>) (<span class="id">fine</span> (<span class="id">\int[m_</span><span class="id"> n]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> f^\+</span><span class="id"> x</span>))<span class="id">%:E</span><span class="id"> -</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">\sum_</span>(<span class="id">n</span><span class="id"> &lt;oo</span>) (<span class="id">fine</span> (<span class="id">\int[m_</span><span class="id"> n]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> f^\-</span><span class="id"> x</span>))<span class="id">%:E</span>).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> congr</span> (_<span class="id"> -</span><span class="id"> _</span>)<span class="id">;</span><span class="id"> apply:</span><span class="id"> eq_eseriesr</span><span class="id"> =&gt;</span><span class="id"> n</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> fineK//;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">[exact:</span><span class="id"> integrable_pos_fin_num|exact:</span><span class="id"> integrable_neg_fin_num]</span>.<br/>
<span class="id">have</span><span class="id"> fineKn</span><span class="id"> :</span><span class="id"> \sum_</span>(<span class="id">n</span><span class="id"> &lt;oo</span>)<span class="id"> `|\int[m_</span><span class="id"> n]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> f^\-</span><span class="id"> x|</span><span class="id"> =</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">\sum_</span>(<span class="id">n</span><span class="id"> &lt;oo</span>)<span class="id"> `|</span>(<span class="id">fine</span> (<span class="id">\int[m_</span><span class="id"> n]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> f^\-</span><span class="id"> x</span>))<span class="id">%:E|</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> eq_eseriesr</span><span class="id"> =&gt;</span><span class="id"> n</span><span class="id"> _;</span><span class="id"> congr</span><span class="id"> abse;</span><span class="id"> rewrite</span><span class="id"> fineK//</span>.<br/>
&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> integrable_neg_fin_num</span>.<br/>
<span class="id">have</span><span class="id"> fineKp</span><span class="id"> :</span><span class="id"> \sum_</span>(<span class="id">n</span><span class="id"> &lt;oo</span>)<span class="id"> `|\int[m_</span><span class="id"> n]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> f^\+</span><span class="id"> x|</span><span class="id"> =</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">\sum_</span>(<span class="id">n</span><span class="id"> &lt;oo</span>)<span class="id"> `|</span>(<span class="id">fine</span> (<span class="id">\int[m_</span><span class="id"> n]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> f^\+</span><span class="id"> x</span>))<span class="id">%:E|</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> eq_eseriesr</span><span class="id"> =&gt;</span><span class="id"> n</span><span class="id"> _;</span><span class="id"> congr</span><span class="id"> abse;</span><span class="id"> rewrite</span><span class="id"> fineK//</span>.<br/>
&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> integrable_pos_fin_num</span>.<br/>
<span class="id">rewrite</span><span class="id"> nneseries_esum;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> n</span><span class="id"> _;</span><span class="id"> exact/fine_ge0/integral_ge0</span>.<br/>
<span class="id">rewrite</span><span class="id"> nneseries_esum;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> n</span><span class="id"> _;</span><span class="id"> exact/fine_ge0/integral_ge0</span>.<br/>
<span class="id">rewrite</span><span class="id"> -esumB//;</span><span class="id"> last</span><span class="id"> 4</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> /=</span><span class="id"> /summable</span><span class="id"> -nneseries_esum//</span><span class="id"> -fineKp</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> /summable</span><span class="id"> /=</span><span class="id"> -nneseries_esum//</span><span class="id"> -fineKn;</span><span class="id"> exact:</span><span class="id"> fmoo</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> n</span><span class="id"> _;</span><span class="id"> exact/fine_ge0/integral_ge0</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> n</span><span class="id"> _;</span><span class="id"> exact/fine_ge0/integral_ge0</span>.<br/>
<span class="id">rewrite</span><span class="id"> -summable_eseries_esum;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span> (<span class="id">@le_lt_trans</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">\esum_</span>(<span class="id">i</span><span class="gallina-kwd"> in</span> (<span class="id">fun=&gt;</span><span class="id"> true</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">`|</span>(<span class="id">fine</span> (<span class="id">\int[m_</span><span class="id"> i]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> f</span><span class="id"> x</span>))<span class="id">%:E|</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> le_esum</span><span class="id"> =&gt;</span><span class="id"> k</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> -EFinB</span><span class="id"> -fineB//</span><span class="id"> -?integralE//;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">[exact:</span><span class="id"> integrable_pos_fin_num|exact:</span><span class="id"> integrable_neg_fin_num]</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -nneseries_esum;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> []</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span> (<span class="id">@le_lt_trans</span><span class="id"> _</span><span class="id"> _</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">\sum_</span>(<span class="id">n</span><span class="id"> &lt;oo</span>)<span class="id"> `|</span>(<span class="id">fine</span> (<span class="id">\int[m_</span><span class="id"> n]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> f^\+</span><span class="id"> x</span>))<span class="id">%:E|</span><span class="id"> +</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">\sum_</span>(<span class="id">n</span><span class="id"> &lt;oo</span>)<span class="id"> `|</span>(<span class="id">fine</span> (<span class="id">\int[m_</span><span class="id"> n]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> f^\-</span><span class="id"> x</span>))<span class="id">%:E|</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -nneseriesD//;</span><span class="id"> apply:</span><span class="id"> lee_nneseries</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> n</span><span class="id"> _</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> integralE</span><span class="id"> fineB//</span><span class="id"> ?EFinB</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="id"> exact:</span> (<span class="id">le_trans</span> (<span class="id">lee_abs_sub</span><span class="id"> _</span><span class="id"> _</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="id"> exact:</span><span class="id"> integrable_pos_fin_num</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="id"> exact:</span><span class="id"> integrable_neg_fin_num</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> lte_add_pinfty;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> -fineKp</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -fineKn;</span><span class="id"> exact:</span><span class="id"> fmoo</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> eq_eseriesr</span><span class="id"> =&gt;</span><span class="id"> k</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> !fineK//</span><span class="id"> -?integralE//;</span><br/>
&nbsp;&nbsp;<span class="id">[exact:</span><span class="id"> integrable_neg_fin_num|exact:</span><span class="id"> integrable_pos_fin_num]</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> sequence_measure</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> integrable_lemmas</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<span class="vernacular">Context</span><span class="id"> d</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">mu</span><span class="id"> :</span><span class="id"> {measure</span><span class="id"> set</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R}</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> ge0_integral_bigcup</span> (<span class="id">F</span><span class="id"> :</span> (<span class="id">set</span><span class="id"> _</span>)<span class="id">^nat</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">forall</span><span class="id"> k,</span><span class="id"> measurable</span> (<span class="id">F</span><span class="id"> k</span>))<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">let</span><span class="id"> D</span><span class="id"> :=</span><span class="id"> \bigcup_k</span><span class="id"> F</span><span class="id"> k</span><span class="gallina-kwd"> in</span><br/>
&nbsp;&nbsp;<span class="id">measurable_fun</span><span class="id"> D</span><span class="id"> f</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">forall</span><span class="id"> x,</span><span class="id"> D</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> f</span><span class="id"> x</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">trivIset</span><span class="id"> setT</span><span class="id"> F</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> f</span><span class="id"> x</span><span class="id"> =</span><span class="id"> \sum_</span>(<span class="id">i</span><span class="id"> &lt;oo</span>)<span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> F</span><span class="id"> i</span>)<span class="id"> f</span><span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> mF</span><span class="id"> D</span><span class="id"> mf</span><span class="id"> f0</span><span class="id"> tF</span>.<br/>
<span class="id">pose</span><span class="id"> f_</span><span class="id"> N</span><span class="id"> :=</span><span class="id"> f</span><span class="id"> \_</span> (<span class="id">\big[setU/set0]_</span>(<span class="id">0</span><span class="id"> &lt;=</span><span class="id"> i</span><span class="id"> &lt;</span><span class="id"> N</span>)<span class="id"> F</span><span class="id"> i</span>).<br/>
<span class="id">have</span><span class="id"> lim_f_</span><span class="id"> t</span><span class="id"> :</span><span class="id"> f_</span><span class="id"> ^~</span><span class="id"> t</span><span class="id"> @</span><span class="id"> \oo</span><span class="id"> --&gt;</span> (<span class="id">f</span><span class="id"> \_</span><span class="id"> D</span>)<span class="id"> t</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> [X</span><span class="gallina-kwd"> in</span><span class="id"> _</span><span class="id"> --&gt;</span><span class="id"> X]</span>(_<span class="id"> :</span><span class="id"> _</span><span class="id"> =</span><span class="id"> ereal_sup</span> (<span class="id">range</span> (<span class="id">f_</span><span class="id"> ^~</span><span class="id"> t</span>)))<span class="id">;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply/eqP;</span><span class="id"> rewrite</span><span class="id"> eq_le;</span><span class="id"> apply/andP;</span><span class="id"> split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> /restrict;</span><span class="id"> case:</span><span class="id"> ifPn</span><span class="id"> =&gt;</span><span class="id"> [|_]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> in_setE</span><span class="id"> =&gt;</span><span class="id"> -[n</span><span class="id"> _</span><span class="id"> Fnt];</span><span class="id"> apply:</span><span class="id"> ereal_sup_ubound;</span><span class="gallina-kwd"> exists</span><span class="id"> n</span>.<span class="id">+1=&gt;//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /f_</span><span class="id"> big_mkord</span><span class="id"> patchT//</span><span class="id"> in_setE</span><span class="id"> big_ord_recr/=;</span><span class="id"> right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> (<span class="id">@le_trans</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">f_</span><span class="id"> O</span><span class="id"> t</span>))<span class="id">//</span><span class="id"> ?ereal_sup_ubound//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /f_</span><span class="id"> patchN//</span><span class="id"> big_mkord</span><span class="id"> big_ord0</span><span class="id"> inE/=</span><span class="id"> in_set0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> ub_ereal_sup</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> [n</span><span class="id"> _</span><span class="id"> &lt;-]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /f_</span><span class="id"> restrict_lee//</span><span class="id"> big_mkord;</span><span class="id"> exact:</span><span class="id"> bigsetU_bigcup</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> ereal_nondecreasing_cvgn</span><span class="id"> =&gt;</span><span class="id"> a</span><span class="id"> b</span><span class="id"> ab</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> /f_</span><span class="id"> !big_mkord</span><span class="id"> restrict_lee</span><span class="id"> //;</span><span class="id"> last</span><span class="id"> exact:</span><span class="id"> subset_bigsetU</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> Dx;</span><span class="id"> apply:</span><span class="id"> f0</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> bigsetU_bigcup</span><span class="id"> Dx</span>.<br/>
<span class="id">transitivity</span> (<span class="id">\int[mu]_x</span><span class="id"> limn</span> (<span class="id">f_</span><span class="id"> ^~</span><span class="id"> x</span>)).<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> integral_mkcond;</span><span class="id"> apply:</span><span class="id"> eq_integral</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> _</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply/esym/cvg_lim</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> lim_f_</span>.<br/>
<span class="id">rewrite</span><span class="id"> monotone_convergence//;</span><span class="id"> last</span><span class="id"> 3</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> move=&gt;</span><span class="id"> n;</span><span class="id"> apply/</span>(<span class="id">measurable_restrictT</span><span class="id"> f</span>)<span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> bigsetU_measurable</span><span class="id"> =&gt;</span><span class="id"> k</span><span class="id"> _;</span><span class="id"> exact:</span><span class="id"> mF</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">move:</span><span class="id"> mf;</span><span class="id"> apply/measurable_funS</span><span class="id"> =&gt;//;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> bigcup_measurable</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> big_mkord;</span><span class="id"> exact:</span><span class="id"> bigsetU_bigcup</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> move=&gt;</span><span class="id"> n</span><span class="id"> x</span><span class="id"> _;</span><span class="id"> apply:</span><span class="id"> erestrict_ge0</span><span class="id"> =&gt;</span><span class="id"> y;</span><span class="id"> rewrite</span><span class="id"> big_mkord</span><span class="id"> =&gt;</span><span class="id"> Dy;</span><span class="id"> apply:</span><span class="id"> f0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> bigsetU_bigcup</span><span class="id"> Dy</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> _</span><span class="id"> a</span><span class="id"> b</span><span class="id"> ab;</span><span class="id"> apply:</span><span class="id"> restrict_lee</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> y;</span><span class="id"> rewrite</span><span class="id"> big_mkord</span><span class="id"> =&gt;</span><span class="id"> Dy;</span><span class="id"> apply:</span><span class="id"> f0;</span><span class="id"> exact:</span><span class="id"> bigsetU_bigcup</span><span class="id"> Dy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> 2!big_mkord;</span><span class="id"> apply:</span><span class="id"> subset_bigsetU</span>.<br/>
<span class="id">transitivity</span> (<span class="id">limn</span> (<span class="gallina-kwd">fun</span><span class="id"> N</span><span class="id"> =&gt;</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> \big[setU/set0]_</span>(<span class="id">i</span><span class="id"> &lt;</span><span class="id"> N</span>)<span class="id"> F</span><span class="id"> i</span>)<span class="id"> f</span><span class="id"> x</span>)).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply/congr_lim/funext</span><span class="id"> =&gt;</span><span class="id"> n;</span><span class="id"> rewrite</span><span class="id"> /f_</span><span class="id"> [in</span><span class="id"> RHS]integral_mkcond</span><span class="id"> big_mkord</span>.<br/>
<span class="id">apply/congr_lim/funext</span><span class="id"> =&gt;</span><span class="id"> /=</span><span class="id"> n</span>.<br/>
<span class="id">rewrite</span><span class="id"> -</span>(<span class="id">big_mkord</span><span class="id"> xpredT</span>)<span class="id"> ge0_integral_bigsetU</span><span class="id"> ?big_mkord//</span>.<br/>
<span class="id">-</span><span class="id"> exact:</span><span class="id"> iota_uniq</span>.<br/>
<span class="id">-</span><span class="id"> exact:</span><span class="id"> sub_trivIset</span><span class="id"> tF</span>.<br/>
<span class="id">-</span><span class="id"> move:</span><span class="id"> mf;</span><span class="id"> apply:</span><span class="id"> measurable_funS</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> bigcup_measurable</span>.<br/>
&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> bigsetU_bigcup</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> y</span><span class="id"> Dy;</span><span class="id"> apply:</span><span class="id"> f0;</span><span class="id"> exact:</span><span class="id"> bigsetU_bigcup</span><span class="id"> Dy</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> integrableS</span> (<span class="id">E</span><span class="id"> D</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">measurable</span><span class="id"> E</span><span class="id"> -&gt;</span><span class="id"> measurable</span><span class="id"> D</span><span class="id"> -&gt;</span><span class="id"> D</span><span class="id"> `&lt;=`</span><span class="id"> E</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">mu</span>.<span class="id">-integrable</span><span class="id"> E</span><span class="id"> f</span><span class="id"> -&gt;</span><span class="id"> mu</span>.<span class="id">-integrable</span><span class="id"> D</span><span class="id"> f</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> mE</span><span class="id"> mD</span><span class="id"> DE</span><span class="id"> /integrableP[mf</span><span class="id"> ifoo];</span><span class="id"> apply/integrableP;</span><span class="id"> split</span>.<br/>
&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> measurable_funS</span><span class="id"> mf</span>.<br/>
<span class="id">apply:</span><span class="id"> le_lt_trans</span><span class="id"> ifoo;</span><span class="id"> apply:</span><span class="id"> ge0_subset_integral</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
<span class="id">exact:</span><span class="id"> measurableT_comp</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> integrable_mkcond</span><span class="id"> D</span><span class="id"> f</span><span class="id"> :</span><span class="id"> measurable</span><span class="id"> D</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">mu</span>.<span class="id">-integrable</span><span class="id"> D</span><span class="id"> f</span><span class="id"> &lt;-&gt;</span><span class="id"> mu</span>.<span class="id">-integrable</span><span class="id"> setT</span> (<span class="id">f</span><span class="id"> \_</span><span class="id"> D</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> mD</span>.<br/>
<span class="id">rewrite</span><span class="id"> unlock;</span><span class="id"> apply:</span><span class="id"> asbool_equiv;</span><span class="id"> rewrite</span><span class="id"> [in</span><span class="id"> X</span><span class="gallina-kwd"> in</span><span class="id"> X</span><span class="id"> &lt;-&gt;</span><span class="id"> _]integral_mkcond</span>.<br/>
<span class="id">under</span><span class="id"> [in</span><span class="id"> X</span><span class="gallina-kwd"> in</span><span class="id"> X</span><span class="id"> &lt;-&gt;</span><span class="id"> _]eq_integral</span><span class="id"> do</span><span class="id"> rewrite</span><span class="id"> restrict_abse</span>.<br/>
<span class="id">split</span><span class="id"> =&gt;</span><span class="id"> [|]</span><span class="id"> [mf</span><span class="id"> foo]</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> split;</span><span class="id"> [exact/</span>(<span class="id">measurable_restrictT</span><span class="id"> _</span><span class="id"> _</span>).<span class="id">1|</span><span class="id"> exact:</span><span class="id"> le_lt_trans</span><span class="id"> foo]</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> split;</span><span class="id"> [exact/</span>(<span class="id">measurable_restrictT</span><span class="id"> _</span><span class="id"> _</span>).<span class="id">2|</span><span class="id"> exact:</span><span class="id"> le_lt_trans</span><span class="id"> foo]</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> integrable_lemmas</span>.<br/>
<span class="vernacular">Arguments</span><span class="id"> integrable_mkcond</span><span class="id"> {d</span><span class="id"> T</span><span class="id"> R</span><span class="id"> mu</span><span class="id"> D}</span><span class="id"> f</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> finite_measure_integrable_cst</span><span class="id"> d</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">mu</span><span class="id"> :</span><span class="id"> {finite_measure</span><span class="id"> set</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R}</span>)<span class="id"> k</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">mu</span>.<span class="id">-integrable</span><span class="id"> [set:</span><span class="id"> T]</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> cst</span><span class="id"> k</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">apply/integrableP;</span><span class="id"> split;</span><span class="id"> first</span><span class="id"> exact/measurable_EFinP</span>.<br/>
<span class="id">have</span><span class="id"> [k0|k0]</span><span class="id"> :=</span><span class="id"> leP</span><span class="id"> 0</span><span class="id"> k</span>.<br/>
<span class="id">-</span><span class="id"> under</span><span class="id"> eq_integral</span><span class="id"> do</span><span class="id"> rewrite</span><span class="id"> /=</span><span class="id"> ger0_norm//</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> integral_cstr//=</span><span class="id"> lte_mul_pinfty//</span><span class="id"> fin_num_fun_lty//</span>.<br/>
&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> fin_num_measure</span>.<br/>
<span class="id">-</span><span class="id"> under</span><span class="id"> eq_integral</span><span class="id"> do</span><span class="id"> rewrite</span><span class="id"> /=</span><span class="id"> ltr0_norm//</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> integral_cstr//=</span><span class="id"> lte_mul_pinfty//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> lee_fin</span><span class="id"> lerNr</span><span class="id"> oppr0</span><span class="id"> ltW</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> fin_num_fun_lty//;</span><span class="id"> exact:</span><span class="id"> fin_num_measure</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Section</span><span class="id"> integrable_ae</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<span class="vernacular">Context</span><span class="id"> d</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>).<br/>
<span class="vernacular">Variables</span> (<span class="id">mu</span><span class="id"> :</span><span class="id"> {measure</span><span class="id"> set</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R}</span>) (<span class="id">D</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T</span>) (<span class="id">mD</span><span class="id"> :</span><span class="id"> measurable</span><span class="id"> D</span>).<br/>
<span class="vernacular">Variable</span><span class="id"> f</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>.<br/>
<span class="vernacular">Hypotheses</span><span class="id"> fint</span><span class="id"> :</span><span class="id"> mu</span>.<span class="id">-integrable</span><span class="id"> D</span><span class="id"> f</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> integrable_ae</span><span class="id"> :</span><span class="id"> {ae</span><span class="id"> mu,</span><span class="gallina-kwd"> forall</span><span class="id"> x,</span><span class="id"> D</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> f</span><span class="id"> x</span><span class="id"> \is</span><span class="id"> a</span><span class="id"> fin_num}</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">have</span><span class="id"> [muD0|muD0]</span><span class="id"> :=</span><span class="id"> eqVneq</span> (<span class="id">mu</span><span class="id"> D</span>)<span class="id"> 0</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="gallina-kwd"> exists</span><span class="id"> D;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> t</span><span class="id"> /=</span><span class="id"> /not_implyP[]</span>.<br/>
<span class="id">pose</span><span class="id"> E</span><span class="id"> :=</span><span class="id"> [set</span><span class="id"> x</span><span class="id"> |</span><span class="id"> `|f</span><span class="id"> x|</span><span class="id"> =</span><span class="id"> +oo</span><span class="id"> /\</span><span class="id"> D</span><span class="id"> x</span><span class="id"> ]</span>.<br/>
<span class="id">have</span><span class="id"> mE</span><span class="id"> :</span><span class="id"> measurable</span><span class="id"> E</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> (_<span class="id"> :</span><span class="id"> E</span><span class="id"> =</span><span class="id"> D</span><span class="id"> `&amp;`</span><span class="id"> f</span><span class="id"> @^-1`</span><span class="id"> [set</span><span class="id"> -oo;</span><span class="id"> +oo]</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span> (<span class="id">measurable_int</span><span class="id"> _</span><span class="id"> fint</span>)<span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> measurableU</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> /E</span><span class="id"> predeqE</span><span class="id"> =&gt;</span><span class="id"> t;</span><span class="id"> split=&gt;</span><span class="id"> [[/eqP]|[Dt</span><span class="id"> [|]/=</span><span class="id"> -&gt;//]]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> eqe_absl</span><span class="id"> leey</span><span class="id"> andbT</span><span class="id"> /preimage/=</span><span class="id"> =&gt;</span><span class="id"> /orP[|]/eqP;</span><span class="id"> tauto</span>.<br/>
<span class="id">have</span><span class="id"> [ET|ET]</span><span class="id"> :=</span><span class="id"> eqVneq</span><span class="id"> E</span><span class="id"> setT</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> foo</span><span class="id"> t</span><span class="id"> :</span><span class="id"> `|f</span><span class="id"> t|</span><span class="id"> =</span><span class="id"> +oo</span><span class="gallina-kwd"> by</span><span class="id"> have</span><span class="id"> []</span><span class="id"> :</span><span class="id"> E</span><span class="id"> t</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> ET</span>.<br/>
&nbsp;&nbsp;<span class="id">suff:</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> `|f</span><span class="id"> x|</span><span class="id"> =</span><span class="id"> +oo</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> case:</span> (<span class="id">integrableP</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> fint</span>)<span class="id"> =&gt;</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> ltey</span><span class="id"> =&gt;</span><span class="id"> /eqP</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -</span>(<span class="id">integral_csty</span><span class="id"> mD</span><span class="id"> muD0</span>)<span class="id">//;</span><span class="id"> exact:</span><span class="id"> eq_integral</span>.<br/>
<span class="id">suff:</span><span class="id"> mu</span><span class="id"> E</span><span class="id"> =</span><span class="id"> 0</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> muE0;</span><span class="gallina-kwd"> exists</span><span class="id"> E;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> t</span><span class="id"> /=</span><span class="id"> /not_implyP[Dt]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> fin_num_abs</span><span class="id"> =&gt;</span><span class="id"> /negP;</span><span class="id"> rewrite</span><span class="id"> -leNgt</span><span class="id"> leye_eq</span><span class="id"> =&gt;</span><span class="id"> /eqP</span>.<br/>
<span class="id">have</span><span class="id"> [-&gt;|/set0P</span><span class="id"> E0]</span><span class="id"> :=</span><span class="id"> eqVneq</span><span class="id"> E</span><span class="id"> set0;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> measure0</span>.<br/>
<span class="id">have</span><span class="id"> [M</span><span class="id"> M0</span><span class="id"> muM]</span><span class="id"> :</span><span class="gallina-kwd"> exists2</span><span class="id"> M,</span> (<span class="id">0</span><span class="id"> &lt;=</span><span class="id"> M</span>)<span class="id">%R</span><span class="id"> &amp;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">forall</span><span class="id"> n,</span><span class="id"> n%:R%:E</span><span class="id"> *</span><span class="id"> mu</span> (<span class="id">E</span><span class="id"> `&amp;`</span><span class="id"> D</span>)<span class="id"> &lt;=</span><span class="id"> M%:E</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">exists</span> (<span class="id">fine</span> (<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> `|f</span><span class="id"> x|</span>))<span class="id">;</span><span class="id"> first</span><span class="id"> exact/fine_ge0/integral_ge0</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> n;</span><span class="id"> rewrite</span><span class="id"> -integral_indic//</span><span class="id"> -ge0_integralZl//;</span><span class="id"> last</span><span class="id"> 2</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="id"> exact:</span><span class="id"> measurableT_comp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> *;</span><span class="id"> rewrite</span><span class="id"> lee_fin</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> fineK//;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">case:</span> (<span class="id">integrableP</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> fint</span>)<span class="id"> =&gt;</span><span class="id"> _</span><span class="id"> foo</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> ge0_fin_numE//</span><span class="id"> integral_ge0</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> ge0_le_integral</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> *;</span><span class="id"> rewrite</span><span class="id"> lee_fin</span><span class="id"> /indic</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> exact/measurable_EFinP/measurableT_comp</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> measurableT_comp</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> measurable_int</span><span class="id"> fint</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> Dx;</span><span class="id"> rewrite</span><span class="id"> /=</span><span class="id"> indicE</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">have</span><span class="id"> [|xE]</span><span class="id"> :=</span><span class="id"> boolP</span> (<span class="id">x</span><span class="id"> \in</span><span class="id"> E</span>)<span class="id">;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> mule0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /E</span><span class="id"> inE</span><span class="id"> /=</span><span class="id"> =&gt;</span><span class="id"> -[-&gt;];</span><span class="id"> rewrite</span><span class="id"> leey</span>.<br/>
<span class="id">apply/eqP/negPn/negP</span><span class="id"> =&gt;</span><span class="id"> /eqP</span><span class="id"> muED0;</span><span class="id"> move/not_forallP</span><span class="id"> :</span><span class="id"> muM;</span><span class="id"> apply</span>.<br/>
<span class="id">have</span><span class="id"> [muEDoo|]</span><span class="id"> :=</span><span class="id"> ltP</span> (<span class="id">mu</span> (<span class="id">E</span><span class="id"> `&amp;`</span><span class="id"> D</span>))<span class="id"> +oo;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> leye_eq</span><span class="id"> =&gt;</span><span class="id"> /eqP</span><span class="id"> -&gt;;</span><span class="gallina-kwd"> exists</span><span class="id"> 1%N;</span><span class="id"> rewrite</span><span class="id"> mul1e</span><span class="id"> leye_eq</span>.<br/>
<span class="gallina-kwd">exists</span><span class="id"> `|ceil</span> (<span class="id">M</span><span class="id"> *</span> (<span class="id">fine</span> (<span class="id">mu</span> (<span class="id">E</span><span class="id"> `&amp;`</span><span class="id"> D</span>)))<span class="id">^-1</span>)<span class="id">|%N</span>.<span class="id">+1</span>.<br/>
<span class="id">apply/negP;</span><span class="id"> rewrite</span><span class="id"> -ltNge</span>.<br/>
<span class="id">rewrite</span><span class="id"> -[X</span><span class="gallina-kwd"> in</span><span class="id"> _</span><span class="id"> *</span><span class="id"> X]</span>(<span class="id">@fineK</span><span class="id"> _</span> (<span class="id">mu</span> (<span class="id">E</span><span class="id"> `&amp;`</span><span class="id"> D</span>)))<span class="id">;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> fin_numElt</span><span class="id"> muEDoo</span> (<span class="id">lt_le_trans</span><span class="id"> _</span> (<span class="id">measure_ge0</span><span class="id"> _</span><span class="id"> _</span>)).<br/>
<span class="id">rewrite</span><span class="id"> lte_fin</span><span class="id"> -ltr_pdivrMr</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -natr1</span><span class="id"> natr_absz</span><span class="id"> ger0_norm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span> (<span class="id">le_lt_trans</span> (<span class="id">ceil_ge</span><span class="id"> _</span>))<span class="id">//</span><span class="id"> ltrDl</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -ceil_ge0//</span> (<span class="id">lt_le_trans</span> (<span class="id">ltrN10</span><span class="id"> _</span>))<span class="id">//</span><span class="id"> divr_ge0</span>.<br/>
<span class="id">rewrite</span><span class="id"> -lte_fin</span><span class="id"> fineK</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> lt0e</span><span class="id"> measure_ge0</span><span class="id"> andbT</span>.<br/>
&nbsp;&nbsp;<span class="id">suff:</span><span class="id"> E</span><span class="id"> `&amp;`</span><span class="id"> D</span><span class="id"> =</span><span class="id"> E</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> -&gt;;</span><span class="id"> exact/eqP</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> predeqE</span><span class="id"> =&gt;</span><span class="id"> t;</span><span class="id"> split=&gt;</span><span class="id"> -[]</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> ge0_fin_numE//</span><span class="id"> measure_ge0//;</span><span class="id"> exact:</span><span class="id"> measurableI</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> integrable_ae</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> linearityZ</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<span class="vernacular">Context</span><span class="id"> d</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>).<br/>
<span class="vernacular">Variables</span> (<span class="id">mu</span><span class="id"> :</span><span class="id"> {measure</span><span class="id"> set</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R}</span>) (<span class="id">D</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T</span>) (<span class="id">mD</span><span class="id"> :</span><span class="id"> measurable</span><span class="id"> D</span>).<br/>
<span class="vernacular">Variable</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>).<br/>
<span class="vernacular">Hypothesis</span><span class="id"> intf</span><span class="id"> :</span><span class="id"> mu</span>.<span class="id">-integrable</span><span class="id"> D</span><span class="id"> f</span>.<br/>
<br/>
<span class="vernacular">Let</span><span class="id"> mesf</span><span class="id"> :</span><span class="id"> measurable_fun</span><span class="id"> D</span><span class="id"> f</span><br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id"> exact:</span><span class="id"> measurable_int</span><span class="id"> intf</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> integralZl</span><span class="id"> r</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>) (<span class="id">r%:E</span><span class="id"> *</span><span class="id"> f</span><span class="id"> x</span>)<span class="id"> =</span><span class="id"> r%:E</span><span class="id"> *</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> f</span><span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">have</span><span class="id"> /orP[r0|r0]</span><span class="id"> :=</span><span class="id"> le_total</span><span class="id"> r</span><span class="id"> 0%R</span>.<br/>
<span class="id">-</span><span class="id"> rewrite</span><span class="id"> [in</span><span class="id"> LHS]integralE//</span><span class="id"> le0_funeposM//</span><span class="id"> le0_funenegM//</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> (<span class="id">ge0_integralZl_EFin</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">measurable_funeneg</span><span class="id"> _</span>))<span class="id"> ?oppr_ge0//</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> (<span class="id">ge0_integralZl_EFin</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">measurable_funepos</span><span class="id"> _</span>))<span class="id"> ?oppr_ge0//</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> !EFinN</span><span class="id"> addeC</span><span class="id"> !mulNe</span><span class="id"> oppeK</span><span class="id"> -muleBr</span><span class="id"> ?integrable_add_def//</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> [in</span><span class="id"> RHS]integralE</span>.<br/>
<span class="id">-</span><span class="id"> rewrite</span><span class="id"> [in</span><span class="id"> LHS]integralE//</span><span class="id"> ge0_funeposM//</span><span class="id"> ge0_funenegM//=</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> (<span class="id">ge0_integralZl_EFin</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">measurable_funepos</span><span class="id"> _</span>)<span class="id"> r0</span>)<span class="id">//</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> (<span class="id">ge0_integralZl_EFin</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">measurable_funeneg</span><span class="id"> _</span>)<span class="id"> r0</span>)<span class="id">//</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -muleBr</span><span class="id"> 1?[in</span><span class="id"> RHS]integralE//</span><span class="id"> integrable_add_def</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> integralZr</span><span class="id"> r</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>) (<span class="id">f</span><span class="id"> x</span><span class="id"> *</span><span class="id"> r%:E</span>)<span class="id"> =</span> (<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> f</span><span class="id"> x</span>)<span class="id"> *</span><span class="id"> r%:E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> muleC</span><span class="id"> -integralZl;</span><span class="id"> under</span><span class="id"> eq_integral</span><span class="id"> do</span><span class="id"> rewrite</span><span class="id"> muleC</span>. Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> linearityZ</span>.<br/>
<span class="id">#[deprecated</span>(<span class="id">since=</span><span class="id">&quot;mathcomp-analysis 0.6.4&quot;</span><span class="id">,</span><span class="id"> note=</span><span class="id">&quot;use `integralZl` instead&quot;</span>)<span class="id">]</span><br/>
<span class="vernacular">Notation</span><span class="id"> integralM</span><span class="id"> :=</span><span class="id"> integralZl</span> (<span class="id">only</span><span class="id"> parsing</span>).<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> linearityD_EFin</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<span class="vernacular">Context</span><span class="id"> d</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>).<br/>
<span class="vernacular">Variables</span> (<span class="id">mu</span><span class="id"> :</span><span class="id"> {measure</span><span class="id"> set</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R}</span>) (<span class="id">D</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T</span>) (<span class="id">mD</span><span class="id"> :</span><span class="id"> measurable</span><span class="id"> D</span>).<br/>
<span class="vernacular">Variables</span><span class="id"> f1</span><span class="id"> f2</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> R</span>.<br/>
<span class="vernacular">Let</span><span class="id"> g1</span><span class="id"> :=</span><span class="id"> EFin</span><span class="id"> \o</span><span class="id"> f1</span>.<br/>
<span class="vernacular">Let</span><span class="id"> g2</span><span class="id"> :=</span><span class="id"> EFin</span><span class="id"> \o</span><span class="id"> f2</span>.<br/>
<span class="vernacular">Hypothesis</span><span class="id"> if1</span><span class="id"> :</span><span class="id"> mu</span>.<span class="id">-integrable</span><span class="id"> D</span><span class="id"> g1</span>.<br/>
<span class="vernacular">Hypothesis</span><span class="id"> if2</span><span class="id"> :</span><span class="id"> mu</span>.<span class="id">-integrable</span><span class="id"> D</span><span class="id"> g2</span>.<br/>
<br/>
<span class="vernacular">Let</span><span class="id"> mf1</span><span class="id"> :</span><span class="id"> measurable_fun</span><span class="id"> D</span><span class="id"> g1</span><br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id"> exact:</span><span class="id"> measurable_int</span><span class="id"> if1</span>. Qed.</div></details>
<span class="vernacular">Let</span><span class="id"> mf2</span><span class="id"> :</span><span class="id"> measurable_fun</span><span class="id"> D</span><span class="id"> g2</span><br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id"> exact:</span><span class="id"> measurable_int</span><span class="id"> if2</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> integralD_EFin</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>) (<span class="id">g1</span><span class="id"> \+</span><span class="id"> g2</span>)<span class="id"> x</span><span class="id"> =</span><br/>
&nbsp;&nbsp;<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> g1</span><span class="id"> x</span><span class="id"> +</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> g2</span><span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">suff:</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>) ((<span class="id">g1</span><span class="id"> \+</span><span class="id"> g2</span>)<span class="id">^\+</span><span class="id"> x</span>)<span class="id"> +</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>) (<span class="id">g1^\-</span><span class="id"> x</span>)<span class="id"> +</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>) (<span class="id">g2^\-</span><span class="id"> x</span>)<span class="id"> =</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>) ((<span class="id">g1</span><span class="id"> \+</span><span class="id"> g2</span>)<span class="id">^\-</span><span class="id"> x</span>)<span class="id"> +</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>) (<span class="id">g1^\+</span><span class="id"> x</span>)<span class="id"> +</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>) (<span class="id">g2^\+</span><span class="id"> x</span>).<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> h;</span><span class="id"> rewrite</span><span class="id"> [in</span><span class="id"> LHS]integralE</span>.<br/>
&nbsp;&nbsp;<span class="id">move/eqP</span><span class="id"> :</span><span class="id"> h;</span><span class="id"> rewrite</span><span class="id"> -[in</span><span class="id"> eqbRHS]addeA</span><span class="id"> [in</span><span class="id"> eqbRHS]addeC</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> g12pos</span><span class="id"> :</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>) (<span class="id">g1^\+</span><span class="id"> x</span>)<span class="id"> +</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>) (<span class="id">g2^\+</span><span class="id"> x</span>)<span class="id"> \is</span><span class="id"> a</span><span class="id"> fin_num</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> ge0_fin_numE//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> lte_add_pinfty//;</span><span class="id"> exact:</span><span class="id"> integral_funepos_lt_pinfty</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> adde_ge0//</span><span class="id"> integral_ge0</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> g12neg</span><span class="id"> :</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>) (<span class="id">g1^\-</span><span class="id"> x</span>)<span class="id"> +</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>) (<span class="id">g2^\-</span><span class="id"> x</span>)<span class="id"> \is</span><span class="id"> a</span><span class="id"> fin_num</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> ge0_fin_numE//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> lte_add_pinfty//</span><span class="id"> ;</span><span class="id"> exact:</span><span class="id"> integral_funeneg_lt_pinfty</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> adde_ge0//</span><span class="id"> integral_ge0</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -sube_eq;</span><span class="id"> last</span><span class="id"> 2</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="id"> rewrite</span><span class="id"> ge0_fin_numE</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> lte_add_pinfty;</span><span class="id"> last</span><span class="id"> exact:</span><span class="id"> integral_funeneg_lt_pinfty</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> lte_add_pinfty;</span><span class="id"> last</span><span class="id"> exact:</span><span class="id"> integral_funeneg_lt_pinfty</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> integral_funepos_lt_pinfty</span> (<span class="id">integrableD</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> adde_ge0//;</span><span class="id"> last</span><span class="id"> exact:</span><span class="id"> integral_ge0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> adde_ge0//</span><span class="id"> integral_ge0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> fin_num_adde_defr</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -</span>(<span class="id">addeA</span> (<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>) (<span class="id">g1</span><span class="id"> \+</span><span class="id"> g2</span>)<span class="id">^\+</span><span class="id"> x</span>)).<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> (<span class="id">addeC</span> (<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>) (<span class="id">g1</span><span class="id"> \+</span><span class="id"> g2</span>)<span class="id">^\+</span><span class="id"> x</span>))<span class="id"> -[eqbLHS]addeA</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> (<span class="id">addeC</span> (<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> g1^\-</span><span class="id"> x</span><span class="id"> +</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> g2^\-</span><span class="id"> x</span>)).<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> eq_sym</span><span class="id"> -</span>(<span class="id">sube_eq</span><span class="id"> g12pos</span>)<span class="id"> ?fin_num_adde_defl//</span><span class="id"> =&gt;</span><span class="id"> /eqP</span><span class="id"> &lt;-</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> fin_num_oppeD;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> ge0_fin_numE;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> integral_funeneg_lt_pinfty</span><span class="id"> if2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> integral_ge0</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> addeACA</span> (<span class="id">integralE</span><span class="id"> _</span><span class="id"> _</span><span class="id"> g1</span>) (<span class="id">integralE</span><span class="id"> _</span><span class="id"> _</span><span class="id"> g2</span>).<br/>
<span class="id">have</span><span class="id"> :</span> (<span class="id">g1</span><span class="id"> \+</span><span class="id"> g2</span>)<span class="id">^\+</span><span class="id"> \+</span><span class="id"> g1^\-</span><span class="id"> \+</span><span class="id"> g2^\-</span><span class="id"> =</span> (<span class="id">g1</span><span class="id"> \+</span><span class="id"> g2</span>)<span class="id">^\-</span><span class="id"> \+</span><span class="id"> g1^\+</span><span class="id"> \+</span><span class="id"> g2^\+</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> funeqE</span><span class="id"> =&gt;</span><span class="id"> x</span>.<br/>
&nbsp;&nbsp;<span class="id">apply/eqP;</span><span class="id"> rewrite</span><span class="id"> -2!addeA</span><span class="id"> [in</span><span class="id"> eqbRHS]addeC</span><span class="id"> -sube_eq;</span><span class="id"> last</span><span class="id"> 2</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /funepos</span><span class="id"> /funeneg</span><span class="id"> -!fine_max</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /funepos</span><span class="id"> /funeneg</span><span class="id"> -!fine_max</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> addeAC</span><span class="id"> eq_sym</span><span class="id"> -sube_eq;</span><span class="id"> last</span><span class="id"> 2</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /funepos</span><span class="id"> /funeneg</span><span class="id"> -!fine_max</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /funepos</span><span class="id"> /funeneg</span><span class="id"> -!fine_max</span>.<br/>
&nbsp;&nbsp;<span class="id">apply/eqP</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -[LHS]/</span>((<span class="id">g1^\+</span><span class="id"> \+</span><span class="id"> g2^\+</span><span class="id"> \-</span> (<span class="id">g1^\-</span><span class="id"> \+</span><span class="id"> g2^\-</span>))<span class="id"> x</span>)<span class="id"> -funeD_posD</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -[RHS]/</span>((_<span class="id"> \-</span><span class="id"> _</span>)<span class="id"> x</span>)<span class="id"> -funeD_Dpos</span>.<br/>
<span class="id">move/</span>(<span class="id">congr1</span> (<span class="gallina-kwd">fun</span><span class="id"> y</span><span class="id"> =&gt;</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>) (<span class="id">y</span><span class="id"> x</span>) )).<br/>
<span class="id">rewrite</span> (<span class="id">ge0_integralD</span><span class="id"> mu</span><span class="id"> mD</span>)<span class="id">;</span><span class="id"> last</span><span class="id"> 4</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> adde_ge0</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> apply:</span><span class="id"> emeasurable_funD;</span><span class="id"> last</span><span class="id"> exact:</span><span class="id"> measurable_funeneg</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exact/measurable_funepos/emeasurable_funD</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> []</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> exact:</span><span class="id"> measurable_funeneg</span>.<br/>
<span class="id">rewrite</span> (<span class="id">ge0_integralD</span><span class="id"> mu</span><span class="id"> mD</span>)<span class="id">;</span><span class="id"> last</span><span class="id"> 4</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> []</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> exact/measurable_funepos/emeasurable_funD</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> []</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> exact/measurable_funepos/measurableT_comp</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> -&gt;</span>.<br/>
<span class="id">rewrite</span> (<span class="id">ge0_integralD</span><span class="id"> mu</span><span class="id"> mD</span>)<span class="id">;</span><span class="id"> last</span><span class="id"> 4</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> _;</span><span class="id"> exact:</span><span class="id"> adde_ge0</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> apply:</span><span class="id"> emeasurable_funD;</span><span class="id"> last</span><span class="id"> exact:</span><span class="id"> measurable_funepos</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exact/measurable_funeneg/emeasurable_funD</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> []</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> exact:</span><span class="id"> measurable_funepos</span>.<br/>
<span class="id">rewrite</span> (<span class="id">ge0_integralD</span><span class="id"> mu</span><span class="id"> mD</span>)<span class="id"> //;</span><span class="id"> last</span><span class="id"> exact:</span><span class="id"> measurable_funepos</span>.<br/>
<span class="id">exact/measurable_funeneg/emeasurable_funD</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> linearityD_EFin</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> integralB_EFin</span><span class="id"> d</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>)<br/>
&nbsp;&nbsp;(<span class="id">mu</span><span class="id"> :</span><span class="id"> {measure</span><span class="id"> set</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R}</span>) (<span class="id">D</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T</span>) (<span class="id">f1</span><span class="id"> f2</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> R</span>)<br/>
&nbsp;&nbsp;(<span class="id">mD</span><span class="id"> :</span><span class="id"> measurable</span><span class="id"> D</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">mu</span>.<span class="id">-integrable</span><span class="id"> D</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> f1</span>)<span class="id"> -&gt;</span><span class="id"> mu</span>.<span class="id">-integrable</span><span class="id"> D</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> f2</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;(<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>) ((<span class="id">f1</span><span class="id"> x</span>)<span class="id">%:E</span><span class="id"> -</span> (<span class="id">f2</span><span class="id"> x</span>)<span class="id">%:E</span>)<span class="id"> =</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>) (<span class="id">f1</span><span class="id"> x</span>)<span class="id">%:E</span><span class="id"> -</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>) (<span class="id">f2</span><span class="id"> x</span>)<span class="id">%:E</span>))<span class="id">%E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> if1</span><span class="id"> if2;</span><span class="id"> rewrite</span> (<span class="id">integralD_EFin</span><span class="id"> mD</span><span class="id"> if1</span>)<span class="id">;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span> (_<span class="id"> :</span><span class="id"> _</span><span class="id"> \o</span><span class="id"> _</span><span class="id"> =</span> (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> -</span> (<span class="id">f2</span><span class="id"> x</span>)<span class="id">%:E</span>))<span class="id">%E;</span><span class="id"> [exact:</span><span class="id"> integrableN|by</span><span class="id"> []]</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -integralN//;</span><span class="id"> exact:</span><span class="id"> integrable_add_def</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> le_abse_integral</span><span class="id"> d</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>)<br/>
&nbsp;&nbsp;(<span class="id">mu</span><span class="id"> :</span><span class="id"> {measure</span><span class="id"> set</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R}</span>) (<span class="id">D</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>)<br/>
&nbsp;&nbsp;(<span class="id">mD</span><span class="id"> :</span><span class="id"> measurable</span><span class="id"> D</span>)<span class="id"> :</span><span class="id"> measurable_fun</span><span class="id"> D</span><span class="id"> f</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;(<span class="id">`|</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>) (<span class="id">f</span><span class="id"> x</span>)<span class="id"> |</span><span class="id"> &lt;=</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> `|f</span><span class="id"> x|</span>)<span class="id">%E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> mf</span>.<br/>
<span class="id">rewrite</span><span class="id"> integralE</span> (<span class="id">le_trans</span> (<span class="id">lee_abs_sub</span><span class="id"> _</span><span class="id"> _</span>))<span class="id">//</span><span class="id"> gee0_abs;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> integral_ge0</span>.<br/>
<span class="id">rewrite</span><span class="id"> gee0_abs;</span><span class="id"> last</span><span class="id"> exact:</span><span class="id"> integral_ge0</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -ge0_integralD</span><span class="id"> //</span><span class="id"> -?fune_abse//;</span><br/>
&nbsp;&nbsp;<span class="id">[exact:</span><span class="id"> measurable_funepos</span><span class="id"> |</span><span class="id"> exact:</span><span class="id"> measurable_funeneg]</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> EFin_normr_Rintegral</span><span class="id"> d</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d</span>)<span class="id"> {R</span><span class="id"> :</span><span class="id"> realType}</span><br/>
&nbsp;&nbsp;(<span class="id">mu</span><span class="id"> :</span><span class="id"> {measure</span><span class="id"> set</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R}</span>) (<span class="id">A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> R</span>)<span class="id"> :</span><span class="id"> measurable</span><span class="id"> A</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">mu</span>.<span class="id">-integrable</span><span class="id"> A</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> f</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">`|</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> A</span>)<span class="id"> f</span><span class="id"> x</span><span class="id"> |%:E</span><span class="id"> =</span><span class="id"> `|</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> A</span>) (<span class="id">f</span><span class="id"> x</span>)<span class="id">%:E</span><span class="id"> |%E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> mA</span><span class="id"> /integrableP[mf</span><span class="id"> intfoo];</span><span class="id"> rewrite</span><span class="id"> -[RHS]fineK</span>.<br/>
<span class="id">-</span><span class="id"> rewrite</span><span class="id"> /=</span><span class="id"> fine_abse//</span><span class="id"> fin_num_abs</span>.<br/>
&nbsp;&nbsp;<span class="id">exact:</span> (<span class="id">le_lt_trans</span> (<span class="id">le_abse_integral</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span>)).<br/>
<span class="id">-</span><span class="id"> rewrite</span><span class="id"> abse_fin_num</span><span class="id"> fin_num_abs</span>.<br/>
&nbsp;&nbsp;<span class="id">exact:</span> (<span class="id">le_lt_trans</span> (<span class="id">le_abse_integral</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span>)).<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> abse_integralP</span><span class="id"> d</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">mu</span><span class="id"> :</span><span class="id"> {measure</span><span class="id"> set</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R}</span>) (<span class="id">D</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">measurable</span><span class="id"> D</span><span class="id"> -&gt;</span><span class="id"> measurable_fun</span><span class="id"> D</span><span class="id"> f</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;(<span class="id">`|</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> f</span><span class="id"> x</span><span class="id"> |</span><span class="id"> &lt;</span><span class="id"> +oo</span><span class="id"> &lt;-&gt;</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> `|f</span><span class="id"> x|</span><span class="id"> &lt;</span><span class="id"> +oo</span>)<span class="id">%E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> mD</span><span class="id"> mf;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> [|]</span><span class="id"> foo;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">exact:</span> (<span class="id">le_lt_trans</span> (<span class="id">le_abse_integral</span><span class="id"> mu</span><span class="id"> mD</span><span class="id"> mf</span>)<span class="id"> foo</span>).<br/>
<span class="id">under</span><span class="id"> eq_integral</span><span class="id"> do</span><span class="id"> rewrite</span><span class="id"> -/</span>((<span class="id">abse</span><span class="id"> \o</span><span class="id"> f</span>)<span class="id"> _</span>)<span class="id"> fune_abse</span>.<br/>
<span class="id">rewrite</span><span class="id"> ge0_integralD//;[|exact/measurable_funepos|exact/measurable_funeneg]</span>.<br/>
<span class="id">move:</span><span class="id"> foo;</span><span class="id"> rewrite</span><span class="id"> integralE/=</span><span class="id"> -fin_num_abs</span><span class="id"> fin_numB</span><span class="id"> =&gt;</span><span class="id"> /andP[fpoo</span><span class="id"> fnoo]</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> lte_add_pinfty//</span><span class="id"> ltey_eq</span><span class="id"> ?fpoo</span><span class="id"> ?fnoo</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Section</span><span class="id"> integral_patch</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<span class="vernacular">Context</span><span class="id"> d</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">mu</span><span class="id"> :</span><span class="id"> {measure</span><span class="id"> set</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R}</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> __deprecated__integral_setI_indic</span> (<span class="id">E</span><span class="id"> D</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T</span>) (<span class="id">mD</span><span class="id"> :</span><span class="id"> measurable</span><span class="id"> D</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">measurable</span><span class="id"> E</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> E</span><span class="id"> `&amp;`</span><span class="id"> D</span>)<span class="id"> f</span><span class="id"> x</span><span class="id"> =</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> E</span>) (<span class="id">f</span><span class="id"> x</span><span class="id"> *</span> (<span class="id">\1_D</span><span class="id"> x</span>)<span class="id">%:E</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> mE;</span><span class="id"> rewrite</span><span class="id"> integral_mkcondr</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> under</span><span class="id"> eq_integral</span><span class="id"> do</span><span class="id"> rewrite</span><span class="id"> epatch_indic</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> __deprecated__integralEindic</span> (<span class="id">D</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T</span>) (<span class="id">mD</span><span class="id"> :</span><span class="id"> measurable</span><span class="id"> D</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> f</span><span class="id"> x</span><span class="id"> =</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>) (<span class="id">f</span><span class="id"> x</span><span class="id"> *</span> (<span class="id">\1_D</span><span class="id"> x</span>)<span class="id">%:E</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> -__deprecated__integral_setI_indic//</span><span class="id"> setIid</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> integralEpatch</span> (<span class="id">D</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T</span>) (<span class="id">mD</span><span class="id"> :</span><span class="id"> measurable</span><span class="id"> D</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> f</span><span class="id"> x</span><span class="id"> =</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>) (<span class="id">f</span><span class="id"> \_</span><span class="id"> D</span>)<span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> -[in</span><span class="id"> LHS]</span>(<span class="id">setIid</span><span class="id"> D</span>)<span class="id"> integral_mkcondr</span>. Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> integral_patch</span>.<br/>
<span class="id">#[deprecated</span>(<span class="id">since=</span><span class="id">&quot;mathcomp-analysis 1.3.0&quot;</span><span class="id">,</span><span class="id"> note=</span><span class="id">&quot;use `integral_mkcondr` instead&quot;</span>)<span class="id">]</span><br/>
<span class="vernacular">Notation</span><span class="id"> integral_setI_indic</span><span class="id"> :=</span><span class="id"> __deprecated__integral_setI_indic</span> (<span class="id">only</span><span class="id"> parsing</span>).<br/>
<span class="id">#[deprecated</span>(<span class="id">since=</span><span class="id">&quot;mathcomp-analysis 1.3.0&quot;</span><span class="id">,</span><span class="id"> note=</span><span class="id">&quot;use `integralEpatch` instead&quot;</span>)<span class="id">]</span><br/>
<span class="vernacular">Notation</span><span class="id"> integralEindic</span><span class="id"> :=</span><span class="id"> __deprecated__integralEindic</span> (<span class="id">only</span><span class="id"> parsing</span>).<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> ae_eq_integral</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<span class="vernacular">Context</span><span class="id"> d</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">mu</span><span class="id"> :</span><span class="id"> {measure</span><span class="id"> set</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R}</span>).<br/>
<br/>
<span class="vernacular">Local</span><span class="vernacular"> Notation</span><span class="id"> ae_eq</span><span class="id"> :=</span> (<span class="id">ae_eq</span><span class="id"> mu</span>).<br/>
<br/>
<span class="vernacular">Let</span><span class="id"> ae_eq_integral_abs_bounded</span> (<span class="id">D</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T</span>) (<span class="id">mD</span><span class="id"> :</span><span class="id"> measurable</span><span class="id"> D</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">M</span><span class="id"> :</span><span class="id"> measurable_fun</span><span class="id"> D</span><span class="id"> f</span><span class="id"> -&gt;</span> (<span class="gallina-kwd">forall</span><span class="id"> x,</span><span class="id"> D</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> `|f</span><span class="id"> x|</span><span class="id"> &lt;=</span><span class="id"> M%:E</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">ae_eq</span><span class="id"> D</span><span class="id"> f</span> (<span class="id">cst</span><span class="id"> 0</span>)<span class="id"> -&gt;</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> `|f</span><span class="id"> x|%E</span> <span class="id"> =</span><span class="id"> 0</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> mf</span><span class="id"> fM</span><span class="id"> [N</span><span class="id"> [mA</span><span class="id"> mN0</span><span class="id"> Df0N]]</span>.<br/>
<span class="id">pose</span><span class="id"> Df_neq0</span><span class="id"> :=</span><span class="id"> D</span><span class="id"> `&amp;`</span><span class="id"> [set</span><span class="id"> x</span><span class="id"> |</span><span class="id"> f</span><span class="id"> x</span><span class="id"> !=</span><span class="id"> 0]</span>.<br/>
<span class="id">have</span><span class="id"> mDf_neq0</span><span class="id"> :</span><span class="id"> measurable</span><span class="id"> Df_neq0</span><span class="gallina-kwd"> by</span><span class="id"> exact:</span><span class="id"> emeasurable_neq</span>.<br/>
<span class="id">pose</span><span class="id"> f'</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> R</span><span class="id"> :=</span><span class="id"> indic</span><span class="id"> Df_neq0</span>.<br/>
<span class="id">have</span><span class="id"> le_f_M</span><span class="id"> t</span><span class="id"> :</span><span class="id"> D</span><span class="id"> t</span><span class="id"> -&gt;</span><span class="id"> `|f</span><span class="id"> t|</span><span class="id"> &lt;=</span><span class="id"> M%:E</span><span class="id"> *</span> (<span class="id">f'</span><span class="id"> t</span>)<span class="id">%:E</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> Dt;</span><span class="id"> rewrite</span><span class="id"> /f'</span><span class="id"> indicE;</span><span class="id"> have</span><span class="id"> [|]</span><span class="id"> :=</span><span class="id"> boolP</span> (<span class="id">t</span><span class="id"> \in</span><span class="id"> Df_neq0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> inE</span><span class="id"> =&gt;</span><span class="id"> -[_</span><span class="id"> _];</span><span class="id"> rewrite</span><span class="id"> mule1</span><span class="id"> fM</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> notin_setE=&gt;</span><span class="id"> /not_andP[//|/negP/negPn/eqP</span><span class="id"> -&gt;];</span><span class="id"> rewrite</span><span class="id"> abse0</span><span class="id"> mule0</span>.<br/>
<span class="id">have</span><span class="id"> :</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> `|f</span><span class="id"> x|</span> <span class="id"> &lt;=</span><span class="id"> `|M|%:E</span><span class="id"> *</span><span class="id"> mu</span><span class="id"> Df_neq0</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> integral_ge0//=</span><span class="id"> /Df_neq0</span><span class="id"> -{2}</span>(<span class="id">setIid</span><span class="id"> D</span>)<span class="id"> setIAC</span><span class="id"> -integral_indic//</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -/Df_neq0</span><span class="id"> -ge0_integralZl//;</span><span class="id"> last</span><span class="id"> 2</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="id"> exact:</span><span class="id"> measurableT_comp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> ?;</span><span class="id"> rewrite</span><span class="id"> lee_fin</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> ge0_le_integral</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> exact:</span><span class="id"> measurableT_comp</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> Dx;</span><span class="id"> rewrite</span><span class="id"> mule_ge0//</span><span class="id"> lee_fin</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> emeasurable_funM</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> measurableT_comp</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> Dx;</span><span class="id"> rewrite</span> (<span class="id">le_trans</span> (<span class="id">le_f_M</span><span class="id"> _</span><span class="id"> Dx</span>))<span class="id">//</span><span class="id"> lee_fin</span><span class="id"> /f'</span><span class="id"> indicE</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> case:</span> (_<span class="id"> \in</span><span class="id"> _</span>)<span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> rewrite</span><span class="id"> ?mulr1</span><span class="id"> ?mulr0//</span><span class="id"> ler_norm</span>.<br/>
<span class="id">have</span><span class="id"> -&gt;</span><span class="id"> :</span><span class="id"> mu</span><span class="id"> Df_neq0</span><span class="id"> =</span><span class="id"> 0</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span> (<span class="id">subset_measure0</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> mN0</span>)<span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> subset_trans</span><span class="id"> Df0N</span><span class="id"> =&gt;</span><span class="id"> /=</span><span class="id"> x</span><span class="id"> [/=</span><span class="id"> f0</span><span class="id"> Dx]</span><span class="id"> /=</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply/not_implyP;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact/eqP</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> mule0</span><span class="id"> -eq_le</span><span class="id"> =&gt;</span><span class="id"> /eqP</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> ae_eq_integral_abs</span> (<span class="id">D</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T</span>) (<span class="id">mD</span><span class="id"> :</span><span class="id"> measurable</span><span class="id"> D</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">measurable_fun</span><span class="id"> D</span><span class="id"> f</span><span class="id"> -&gt;</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> `|f</span><span class="id"> x|</span><span class="id"> =</span><span class="id"> 0</span><span class="id"> &lt;-&gt;</span><span class="id"> ae_eq</span><span class="id"> D</span><span class="id"> f</span> (<span class="id">cst</span><span class="id"> 0</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> mf;</span><span class="id"> split=&gt;</span><span class="id"> [iDf0|Df0]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">exists</span> (<span class="id">D</span><span class="id"> `&amp;`</span><span class="id"> [set</span><span class="id"> x</span><span class="id"> |</span><span class="id"> f</span><span class="id"> x</span><span class="id"> !=</span><span class="id"> 0]</span>)<span class="id">;</span><span class="id"> split;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">[exact:</span><span class="id"> emeasurable_neq|</span><span class="id"> |by</span><span class="id"> move=&gt;</span><span class="id"> t</span><span class="id"> /=</span><span class="id"> /not_implyP</span><span class="id"> [Dt</span><span class="id"> /eqP</span><span class="id"> ft0]]</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> muDf</span><span class="id"> a</span><span class="id"> :</span> (<span class="id">0</span><span class="id"> &lt;</span><span class="id"> a</span>)<span class="id">%R</span><span class="id"> -&gt;</span><span class="id"> mu</span> (<span class="id">D</span><span class="id"> `&amp;`</span><span class="id"> [set</span><span class="id"> x</span><span class="id"> |</span><span class="id"> a%:E</span><span class="id"> &lt;=</span><span class="id"> `|f</span><span class="id"> x|]</span>)<span class="id"> =</span><span class="id"> 0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> a0;</span><span class="id"> apply/eqP;</span><span class="id"> rewrite</span><span class="id"> -measure_le0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> have</span><span class="id"> :=</span><span class="id"> le_integral_abse</span><span class="id"> mu</span><span class="id"> mD</span><span class="id"> mf</span><span class="id"> a0;</span><span class="id"> rewrite</span><span class="id"> iDf0</span><span class="id"> pmule_rle0</span><span class="id"> ?lte_fin</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> [X</span><span class="gallina-kwd"> in</span><span class="id"> mu</span><span class="id"> X]</span>(_<span class="id"> :</span><span class="id"> _</span><span class="id"> =</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">\bigcup_n</span> (<span class="id">D</span><span class="id"> `&amp;`</span><span class="id"> [set</span><span class="id"> x</span><span class="id"> |</span><span class="id"> `|f</span><span class="id"> x|</span><span class="id"> &gt;=</span><span class="id"> n</span>.<span class="id">+1%:R^-1%:E]</span>))<span class="id">;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> predeqE</span><span class="id"> =&gt;</span><span class="id"> t;</span><span class="id"> split=&gt;</span><span class="id"> [[Dt</span><span class="id"> ft0]|[n</span><span class="id"> _</span><span class="id"> /=</span><span class="id"> [Dt</span><span class="id"> nft]]]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">have</span><span class="id"> [ftoo|ftoo]</span><span class="id"> :=</span><span class="id"> eqVneq</span><span class="id"> `|f</span><span class="id"> t|</span><span class="id"> +oo</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="gallina-kwd"> exists</span><span class="id"> 0%N</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //=;</span><span class="id"> rewrite</span><span class="id"> ftoo</span><span class="id"> /=</span><span class="id"> leey</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">pose</span><span class="id"> m</span><span class="id"> :=</span><span class="id"> `|ceil</span> (<span class="id">fine</span><span class="id"> `|f</span><span class="id"> t|</span>)<span class="id">^-1|%N</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">have</span><span class="id"> ftfin</span><span class="id"> :</span><span class="id"> `|f</span><span class="id"> t|%E</span><span class="id"> \is</span><span class="id"> a</span><span class="id"> fin_num</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> ge0_fin_numE//</span><span class="id"> ltey</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">exists</span><span class="id"> m</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //=</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -</span>(<span class="id">@fineK</span><span class="id"> _</span><span class="id"> `|f</span><span class="id"> t|</span>)<span class="id"> //</span><span class="id"> lee_fin</span><span class="id"> -ler_pV2;</span><span class="id"> last</span><span class="id"> 2</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="id"> rewrite</span><span class="id"> inE</span><span class="id"> unitfE</span><span class="id"> fine_eq0//</span><span class="id"> abse_eq0</span><span class="id"> ft0/=</span><span class="id"> fine_gt0//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> lt0e</span><span class="id"> abse_ge0</span><span class="id"> abse_eq0</span><span class="id"> ft0</span><span class="id"> ltey</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> inE</span><span class="id"> unitfE</span><span class="id"> invr_eq0</span><span class="id"> pnatr_eq0</span><span class="id"> /=</span><span class="id"> invr_gt0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> invrK</span><span class="id"> /m</span><span class="id"> -natr1</span><span class="id"> natr_absz</span><span class="id"> ger0_norm;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -ceil_ge0//</span> (<span class="id">lt_le_trans</span> (<span class="id">ltrN10</span><span class="id"> _</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> (<span class="id">@le_trans</span><span class="id"> _</span><span class="id"> _</span> ((<span class="id">fine</span><span class="id"> `|f</span><span class="id"> t|</span>)<span class="id">^-1</span><span class="id"> +</span><span class="id"> 1</span>)<span class="id">%R</span>)<span class="id"> ?lerDl//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> lerD2r//</span><span class="id"> ceil_ge</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> apply:</span><span class="id"> contraTN</span><span class="id"> nft</span><span class="id"> =&gt;</span><span class="id"> /eqP</span><span class="id"> -&gt;;</span><span class="id"> rewrite</span><span class="id"> abse0</span><span class="id"> -ltNge</span>.<br/>
&nbsp;&nbsp;<span class="id">transitivity</span> (<span class="id">limn</span> (<span class="gallina-kwd">fun</span><span class="id"> n</span><span class="id"> =&gt;</span><span class="id"> mu</span> (<span class="id">D</span><span class="id"> `&amp;`</span><span class="id"> [set</span><span class="id"> x</span><span class="id"> |</span><span class="id"> `|f</span><span class="id"> x|</span><span class="id"> &gt;=</span><span class="id"> n</span>.<span class="id">+1%:R^-1%:E]</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply/esym/cvg_lim</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> apply:</span><span class="id"> nondecreasing_cvg_mu</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="id"> move=&gt;</span><span class="id"> i;</span><span class="id"> apply:</span><span class="id"> emeasurable_fun_c_infty</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> measurableT_comp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="id"> apply:</span><span class="id"> bigcupT_measurable</span><span class="id"> =&gt;</span><span class="id"> i</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> emeasurable_fun_c_infty</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> measurableT_comp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="id"> move=&gt;</span><span class="id"> m</span><span class="id"> n</span><span class="id"> mn;</span><span class="id"> apply/subsetPset;</span><span class="id"> apply:</span><span class="id"> setIS</span><span class="id"> =&gt;</span><span class="id"> t</span><span class="id"> /=</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> le_trans;</span><span class="id"> rewrite</span><span class="id"> lee_fin</span><span class="id"> lef_pV2</span><span class="id"> //</span><span class="id"> ?ler_nat</span><span class="id"> //</span><span class="id"> posrE</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span> (_<span class="id"> :</span> (<span class="gallina-kwd">fun</span><span class="id"> _</span><span class="id"> =&gt;</span><span class="id"> _</span>)<span class="id"> =</span><span class="id"> cst</span><span class="id"> 0</span>)<span class="id"> ?lim_cst//=</span><span class="id"> funeqE</span><span class="id"> =&gt;</span><span class="id"> n</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> muDf</span>.<br/>
<span class="id">pose</span><span class="id"> f_</span><span class="id"> :=</span><span class="gallina-kwd"> fun</span><span class="id"> n</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> mine</span><span class="id"> `|f</span><span class="id"> x|</span><span class="id"> n%:R%:E</span>.<br/>
<span class="id">have</span><span class="id"> -&gt;</span><span class="id"> :</span> (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> `|f</span><span class="id"> x|</span>)<span class="id"> =</span> (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> limn</span> (<span class="id">f_^~</span><span class="id"> x</span>)).<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> funeqE</span><span class="id"> =&gt;</span><span class="id"> x;</span><span class="id"> apply/esym/cvg_lim</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> apply/cvg_ballP</span><span class="id"> =&gt;</span><span class="id"> _/posnumP[e]</span>.<br/>
&nbsp;&nbsp;<span class="id">near=&gt;</span><span class="id"> n;</span><span class="id"> rewrite</span><span class="id"> /ball</span><span class="id"> /=</span><span class="id"> /ereal_ball</span><span class="id"> /=</span><span class="id"> /f_</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> [-&gt;|fxoo]</span><span class="id"> :=</span><span class="id"> eqVneq</span><span class="id"> `|f</span><span class="id"> x|%E</span><span class="id"> +oo</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -[contract</span><span class="id"> +oo]</span>(<span class="id">@divrr</span><span class="id"> _</span> (<span class="id">1</span><span class="id"> +</span><span class="id"> n%:R</span>)<span class="id">%R</span>)<span class="id"> ?unitfE</span><span class="id"> ?nat1r//=</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> (<span class="id">@ger0_norm</span><span class="id"> _</span><span class="id"> n%:R</span>)<span class="id">//</span><span class="id"> nat1r</span><span class="id"> -mulrBl</span><span class="id"> -natrB//</span><span class="id"> subSnn</span><span class="id"> ger0_norm//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> div1r;</span><span class="id"> near:</span><span class="id"> n;</span><span class="id"> exact:</span><span class="id"> near_infty_natSinv_lt</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> fxn</span><span class="id"> :</span><span class="id"> `|f</span><span class="id"> x|</span><span class="id"> &lt;=</span><span class="id"> n%:R%:E</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -</span>(<span class="id">@fineK</span><span class="id"> _</span><span class="id"> `|f</span><span class="id"> x|</span>)<span class="id">;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> ge0_fin_numE//</span><span class="id"> ltey</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> lee_fin;</span><span class="id"> near:</span><span class="id"> n;</span><span class="gallina-kwd"> exists</span> (<span class="id">Num</span>.<span class="id">bound</span> (<span class="id">fine</span><span class="id"> `|f</span><span class="id"> x|</span>))<span class="id"> =&gt;</span><span class="id"> //=</span><span class="id"> n/=</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -</span>(<span class="id">ler_nat</span><span class="id"> R</span>)<span class="id">;</span><span class="id"> apply:</span><span class="id"> le_trans;</span><span class="id"> exact/ltW/archi_boundP</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> min_l//</span><span class="id"> subrr</span><span class="id"> normr0</span>.<br/>
<span class="id">transitivity</span> (<span class="id">limn</span> (<span class="gallina-kwd">fun</span><span class="id"> n</span><span class="id"> =&gt;</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>) (<span class="id">f_</span><span class="id"> n</span><span class="id"> x</span>) )).<br/>
&nbsp;&nbsp;<span class="id">apply/esym/cvg_lim</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> apply:</span><span class="id"> cvg_monotone_convergence</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> n;</span><span class="id"> apply:</span><span class="id"> measurable_mine</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> measurableT_comp</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> n</span><span class="id"> t</span><span class="id"> Dt;</span><span class="id"> rewrite</span><span class="id"> /f_</span><span class="id"> lexI</span><span class="id"> abse_ge0</span><span class="id"> //=</span><span class="id"> lee_fin</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> move=&gt;</span><span class="id"> t</span><span class="id"> Dt</span><span class="id"> m</span><span class="id"> n</span><span class="id"> mn;</span><span class="id"> rewrite</span><span class="id"> /f_</span><span class="id"> lexI</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">have</span><span class="id"> [ftm|ftm]</span><span class="id"> :=</span><span class="id"> leP</span><span class="id"> `|f</span><span class="id"> t|%E</span><span class="id"> m%:R%:E</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> lexx</span><span class="id"> /=</span> (<span class="id">le_trans</span><span class="id"> ftm</span>)<span class="id">//</span><span class="id"> lee_fin</span><span class="id"> ler_nat</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span> (<span class="id">ltW</span><span class="id"> ftm</span>)<span class="id"> /=</span><span class="id"> lee_fin</span><span class="id"> ler_nat</span>.<br/>
<span class="id">have</span><span class="id"> ae_eq_f_</span><span class="id"> n</span><span class="id"> :</span><span class="id"> ae_eq</span><span class="id"> D</span> (<span class="id">f_</span><span class="id"> n</span>) (<span class="id">cst</span><span class="id"> 0</span>).<br/>
&nbsp;&nbsp;<span class="id">case:</span><span class="id"> Df0</span><span class="id"> =&gt;</span><span class="id"> N</span><span class="id"> [mN</span><span class="id"> muN0</span><span class="id"> DfN]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">exists</span><span class="id"> N;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> t</span><span class="id"> /=</span><span class="id"> /not_implyP[Dt</span><span class="id"> fnt0]</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> DfN</span><span class="id"> =&gt;</span><span class="id"> /=;</span><span class="id"> apply/not_implyP;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> contra_not</span><span class="id"> fnt0</span><span class="id"> =&gt;</span><span class="id"> ft0</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /f_</span><span class="id"> ft0</span><span class="id"> /=</span><span class="id"> normr0</span><span class="id"> min_l//</span><span class="id"> lee_fin</span>.<br/>
<span class="id">have</span><span class="id"> f_bounded</span><span class="id"> n</span><span class="id"> x</span><span class="id"> :</span><span class="id"> D</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> `|f_</span><span class="id"> n</span><span class="id"> x|</span><span class="id"> &lt;=</span><span class="id"> n%:R%:E</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> Dx;</span><span class="id"> rewrite</span><span class="id"> /f_;</span><span class="id"> have</span><span class="id"> [|_]</span><span class="id"> :=</span><span class="id"> leP</span><span class="id"> `|f</span><span class="id"> x|</span><span class="id"> n%:R%:E</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> abse_id</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> gee0_abs//</span><span class="id"> lee_fin</span>.<br/>
<span class="id">have</span><span class="id"> if_0</span><span class="id"> n</span><span class="id"> :</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> `|f_</span><span class="id"> n</span><span class="id"> x|</span><span class="id"> =</span><span class="id"> 0</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span> (<span class="id">@ae_eq_integral_abs_bounded</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> n%:R</span>)<span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> measurable_mine</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> measurableT_comp</span>.<br/>
&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> f_bounded</span>.<br/>
<span class="id">rewrite</span> (_<span class="id"> :</span> (<span class="gallina-kwd">fun</span><span class="id"> _</span><span class="id"> =&gt;</span><span class="id"> _</span>)<span class="id"> =</span><span class="id"> cst</span><span class="id"> 0</span>)<span class="id"> //</span><span class="id"> ?lim_cst//</span><span class="id"> funeqE</span><span class="id"> =&gt;</span><span class="id"> n</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -</span>(<span class="id">if_0</span><span class="id"> n</span>)<span class="id">;</span><span class="id"> apply:</span><span class="id"> eq_integral</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> gee0_abs//</span><span class="id"> /f_</span>.<br/>
<span class="id">Unshelve</span>.<span class="id"> all:</span><span class="gallina-kwd"> by</span><span class="id"> end_near</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> integral_abs_eq0</span><span class="id"> D</span> (<span class="id">N</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">measurable</span><span class="id"> N</span><span class="id"> -&gt;</span><span class="id"> measurable</span><span class="id"> D</span><span class="id"> -&gt;</span><span class="id"> N</span><span class="id"> `&lt;=`</span><span class="id"> D</span><span class="id"> -&gt;</span><span class="id"> measurable_fun</span><span class="id"> D</span><span class="id"> f</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">mu</span><span class="id"> N</span><span class="id"> =</span><span class="id"> 0</span><span class="id"> -&gt;</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> N</span>)<span class="id"> `|f</span><span class="id"> x|</span><span class="id"> =</span><span class="id"> 0</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> mN</span><span class="id"> mD</span><span class="id"> ND</span><span class="id"> mf</span><span class="id"> muN0;</span><span class="id"> rewrite</span><span class="id"> integralEpatch//</span>.<br/>
<span class="id">rewrite</span> (<span class="id">eq_integral</span> (<span class="id">abse</span><span class="id"> \o</span> (<span class="id">f</span><span class="id"> \_</span><span class="id"> N</span>)))<span class="id">;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> t</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> restrict_abse</span>.<br/>
<span class="id">apply/ae_eq_integral_abs</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="id">apply/measurable_restrict</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> rewrite</span><span class="id"> setIidr//</span>.<br/>
&nbsp;&nbsp;<span class="id">exact:</span> (<span class="id">measurable_funS</span><span class="id"> mD</span>).<br/>
<span class="gallina-kwd">exists</span><span class="id"> N;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> t</span><span class="id"> /=</span><span class="id"> /not_implyP[_]</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> patchE;</span><span class="id"> case:</span><span class="id"> ifPn</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> rewrite</span><span class="id"> inE</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> negligible_integrable</span> (<span class="id">D</span><span class="id"> N</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">measurable</span><span class="id"> N</span><span class="id"> -&gt;</span><span class="id"> measurable</span><span class="id"> D</span><span class="id"> -&gt;</span><span class="id"> measurable_fun</span><span class="id"> D</span><span class="id"> f</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">mu</span><span class="id"> N</span><span class="id"> =</span><span class="id"> 0</span><span class="id"> -&gt;</span><span class="id"> mu</span>.<span class="id">-integrable</span><span class="id"> D</span><span class="id"> f</span><span class="id"> &lt;-&gt;</span><span class="id"> mu</span>.<span class="id">-integrable</span> (<span class="id">D</span><span class="id"> `\`</span><span class="id"> N</span>)<span class="id"> f</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> mN</span><span class="id"> mD</span><span class="id"> mf</span><span class="id"> muN0</span>.<br/>
<span class="id">pose</span><span class="id"> mCN</span><span class="id"> :=</span><span class="id"> measurableC</span><span class="id"> mN</span>.<br/>
<span class="id">have</span><span class="id"> /integrableP</span><span class="id"> intone</span><span class="id"> :</span><span class="id"> mu</span>.<span class="id">-integrable</span><span class="id"> D</span> (<span class="id">f</span><span class="id"> \_</span><span class="id"> N</span>).<br/>
&nbsp;&nbsp;<span class="id">apply/integrableP;</span><span class="id"> split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply/measurable_restrict</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> measurable_funS</span><span class="id"> mf</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> (<span class="id">eq_integral</span> ((<span class="id">abse</span><span class="id"> \o</span><span class="id"> f</span>)<span class="id"> \_</span><span class="id"> N</span>))<span class="id">;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> t</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> restrict_abse</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -integral_mkcondr</span> (<span class="id">@integral_abs_eq0</span><span class="id"> D</span>)<span class="id">//;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> measurableI</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span> (<span class="id">subset_measure0</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> muN0</span>)<span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> measurableI</span>.<br/>
<span class="id">have</span><span class="id"> h1</span><span class="id"> :</span><span class="id"> mu</span>.<span class="id">-integrable</span><span class="id"> D</span><span class="id"> f</span><span class="id"> &lt;-&gt;</span><span class="id"> mu</span>.<span class="id">-integrable</span><span class="id"> D</span> (<span class="id">f</span><span class="id"> \_</span><span class="id"> ~`</span><span class="id"> N</span>).<br/>
&nbsp;&nbsp;<span class="id">split=&gt;</span><span class="id"> [/integrableP</span><span class="id"> intf|/integrableP</span><span class="id"> intCf]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply/integrableP;</span><span class="id"> split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply/measurable_restrict</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> measurable_funS</span><span class="id"> mf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> (<span class="id">eq_integral</span> ((<span class="id">abse</span><span class="id"> \o</span><span class="id"> f</span>)<span class="id"> \_</span><span class="id"> ~`</span><span class="id"> N</span>))<span class="id">;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> t</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> restrict_abse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -integral_mkcondr;</span><span class="id"> case:</span><span class="id"> intf</span><span class="id"> =&gt;</span><span class="id"> _;</span><span class="id"> apply:</span><span class="id"> le_lt_trans</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> ge0_subset_integral</span><span class="id"> =&gt;</span><span class="id"> //=;</span><span class="id"> [exact:measurableI|</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exact:measurableT_comp]</span>.<br/>
&nbsp;&nbsp;<span class="id">apply/integrableP;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> rewrite</span> (<span class="id">funID</span><span class="id"> N</span><span class="id"> f</span>).<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> ?</span><span class="id"> :</span><span class="id"> measurable_fun</span><span class="id"> D</span> (<span class="id">f</span><span class="id"> \_</span><span class="id"> ~`</span><span class="id"> N</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply/measurable_restrict</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> measurable_funS</span><span class="id"> mf</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> ?</span><span class="id"> :</span><span class="id"> measurable_fun</span><span class="id"> D</span> (<span class="id">f</span><span class="id"> \_</span><span class="id"> N</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply/measurable_restrict</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> measurable_funS</span><span class="id"> mf</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span> (<span class="id">@le_lt_trans</span><span class="id"> _</span><span class="id"> _</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>) (<span class="id">`|</span>(<span class="id">f</span><span class="id"> \_</span><span class="id"> ~`</span><span class="id"> N</span>)<span class="id"> x|</span><span class="id"> +</span><span class="id"> `|</span>(<span class="id">f</span><span class="id"> \_</span><span class="id"> N</span>)<span class="id"> x|</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> ge0_le_integral</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> measurableT_comp</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> emeasurable_funD</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> ?</span><span class="id"> ?;</span><span class="id"> apply:</span><span class="id"> adde_ge0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> emeasurable_funD;</span><span class="id"> exact:</span><span class="id"> measurableT_comp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> *;</span><span class="id"> rewrite</span><span class="id"> lee_abs_add</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> ge0_integralD//;</span><span class="id"> [|exact:</span><span class="id"> measurableT_comp|exact:</span><span class="id"> measurableT_comp]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> lte_add_pinfty;</span><span class="id"> [case:</span><span class="id"> intCf|case:</span><span class="id"> intone]</span>.<br/>
<span class="id">have</span><span class="id"> h2</span><span class="id"> :</span><span class="id"> mu</span>.<span class="id">-integrable</span> (<span class="id">D</span><span class="id"> `\`</span><span class="id"> N</span>)<span class="id"> f</span><span class="id"> &lt;-&gt;</span><span class="id"> mu</span>.<span class="id">-integrable</span><span class="id"> D</span> (<span class="id">f</span><span class="id"> \_</span><span class="id"> ~`</span><span class="id"> N</span>).<br/>
&nbsp;&nbsp;<span class="id">split=&gt;</span><span class="id"> [/integrableP</span><span class="id"> intCf|/integrableP</span><span class="id"> intCf];</span><span class="id"> apply/integrableP</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply/measurable_restrict</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> measurable_funS</span><span class="id"> mf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> (<span class="id">eq_integral</span> ((<span class="id">abse</span><span class="id"> \o</span><span class="id"> f</span>)<span class="id"> \_</span><span class="id"> ~`</span><span class="id"> N</span>))<span class="id">;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> t</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> restrict_abse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -integral_mkcondr</span><span class="id"> //;</span><span class="id"> case:</span><span class="id"> intCf</span><span class="id"> =&gt;</span><span class="id"> _;</span><span class="id"> apply:</span><span class="id"> le_lt_trans</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> ge0_subset_integral</span><span class="id"> =&gt;</span><span class="id"> //=;</span><span class="id"> [exact:</span><span class="id"> measurableI|exact:</span><span class="id"> measurableD|]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> measurableT_comp</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> apply:</span><span class="id"> measurable_funS</span><span class="id"> mf</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> ?</span><span class="id"> []</span>.<br/>
&nbsp;&nbsp;<span class="id">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> mDN</span><span class="id"> A</span><span class="id"> mA;</span><span class="id"> rewrite</span><span class="id"> setDE</span> (<span class="id">setIC</span><span class="id"> D</span>)<span class="id"> -setIA;</span><span class="id"> apply:</span><span class="id"> measurableI</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> mf</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> integral_mkcondr/=</span>.<br/>
&nbsp;&nbsp;<span class="id">under</span><span class="id"> eq_integral</span><span class="id"> do</span><span class="id"> rewrite</span><span class="id"> restrict_abse</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> case:</span><span class="id"> intCf</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply:</span> (<span class="id">iff_trans</span><span class="id"> h1</span>)<span class="id">;</span><span class="id"> exact:</span><span class="id"> iff_sym</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> ge0_negligible_integral</span> (<span class="id">D</span><span class="id"> N</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">measurable</span><span class="id"> N</span><span class="id"> -&gt;</span><span class="id"> measurable</span><span class="id"> D</span><span class="id"> -&gt;</span><span class="id"> measurable_fun</span><span class="id"> D</span><span class="id"> f</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">forall</span><span class="id"> x,</span><span class="id"> D</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> f</span><span class="id"> x</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">mu</span><span class="id"> N</span><span class="id"> =</span><span class="id"> 0</span><span class="id"> -&gt;</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> f</span><span class="id"> x</span><span class="id"> =</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span><span class="id"> `\`</span><span class="id"> N</span>)<span class="id"> f</span><span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> mN</span><span class="id"> mD</span><span class="id"> mf</span><span class="id"> f0</span><span class="id"> muN0</span>.<br/>
<span class="id">rewrite</span><span class="id"> {1}</span>(<span class="id">funID</span><span class="id"> N</span><span class="id"> f</span>)<span class="id"> ge0_integralD//;</span><span class="id"> last</span><span class="id"> 4</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> Dx;</span><span class="id"> rewrite</span><span class="id"> patchE;</span><span class="id"> case:</span><span class="id"> ifPn</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> _;</span><span class="id"> exact:</span><span class="id"> f0</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> apply/measurable_restrict</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> first</span><span class="id"> exact/measurableC</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> measurable_funS</span><span class="id"> mf</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> Dx;</span><span class="id"> rewrite</span><span class="id"> patchE;</span><span class="id"> case:</span><span class="id"> ifPn</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> _;</span><span class="id"> exact:</span><span class="id"> f0</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> apply/measurable_restrict</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> measurable_funS</span><span class="id"> mf</span>.<br/>
<span class="id">rewrite</span><span class="id"> -integral_mkcondr</span><span class="id"> [X</span><span class="gallina-kwd"> in</span><span class="id"> _</span><span class="id"> +</span><span class="id"> X</span><span class="id"> =</span><span class="id"> _]</span>(_<span class="id"> :</span><span class="id"> _</span><span class="id"> =</span><span class="id"> 0</span>)<span class="id"> ?adde0//</span>.<br/>
<span class="id">rewrite</span><span class="id"> -integral_mkcondr</span> (<span class="id">eq_integral</span> (<span class="id">abse</span><span class="id"> \o</span><span class="id"> f</span>))<span class="id">;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> x;</span><span class="id"> rewrite</span><span class="id"> in_setI</span><span class="id"> =&gt;</span><span class="id"> /andP[xD</span><span class="id"> xN]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /=</span><span class="id"> gee0_abs//</span><span class="id"> f0//;</span><span class="id"> rewrite</span><span class="id"> inE</span><span class="gallina-kwd"> in</span><span class="id"> xD</span>.<br/>
<span class="id">rewrite</span> (<span class="id">@integral_abs_eq0</span><span class="id"> D</span>)<span class="id">//;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> measurableI</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply:</span> (<span class="id">subset_measure0</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> muN0</span>)<span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> measurableI</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> ge0_ae_eq_integral</span> (<span class="id">D</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T</span>) (<span class="id">f</span><span class="id"> g</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">measurable</span><span class="id"> D</span><span class="id"> -&gt;</span><span class="id"> measurable_fun</span><span class="id"> D</span><span class="id"> f</span><span class="id"> -&gt;</span><span class="id"> measurable_fun</span><span class="id"> D</span><span class="id"> g</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">forall</span><span class="id"> x,</span><span class="id"> D</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> f</span><span class="id"> x</span>)<span class="id"> -&gt;</span> (<span class="gallina-kwd">forall</span><span class="id"> x,</span><span class="id"> D</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> g</span><span class="id"> x</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">ae_eq</span><span class="id"> D</span><span class="id"> f</span><span class="id"> g</span><span class="id"> -&gt;</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>) (<span class="id">f</span><span class="id"> x</span>)<span class="id"> =</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>) (<span class="id">g</span><span class="id"> x</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> mD</span><span class="id"> mf</span><span class="id"> mg</span><span class="id"> f0</span><span class="id"> g0</span><span class="id"> [N</span><span class="id"> [mN</span><span class="id"> N0</span><span class="id"> subN]]</span>.<br/>
<span class="id">rewrite</span><span class="id"> integralEpatch//</span><span class="id"> [RHS]integralEpatch//</span>.<br/>
<span class="id">rewrite</span> (<span class="id">ge0_negligible_integral</span><span class="id"> mN</span>)<span class="id">//;</span><span class="id"> last</span><span class="id"> 2</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> apply/measurable_restrict</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> rewrite</span><span class="id"> setIidr</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> Dx;</span><span class="id"> rewrite</span><span class="id"> /=</span><span class="id"> patchE</span> (<span class="id">mem_set</span><span class="id"> Dx</span>)<span class="id"> f0</span>.<br/>
<span class="id">rewrite</span><span class="id"> [RHS]</span>(<span class="id">ge0_negligible_integral</span><span class="id"> mN</span>)<span class="id">//;</span><span class="id"> last</span><span class="id"> 2</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> apply/measurable_restrict</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> rewrite</span><span class="id"> setIidr</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> Dx;</span><span class="id"> rewrite</span><span class="id"> /=</span><span class="id"> patchE</span> (<span class="id">mem_set</span><span class="id"> Dx</span>)<span class="id"> g0</span>.<br/>
<span class="id">apply:</span><span class="id"> eq_integral</span><span class="id"> =&gt;</span><span class="id"> x;rewrite</span><span class="id"> in_setD</span><span class="id"> =&gt;</span><span class="id"> /andP[_</span><span class="id"> xN]</span>.<br/>
<span class="id">apply:</span><span class="id"> contrapT;</span><span class="id"> rewrite</span><span class="id"> !patchE;</span><span class="id"> case:</span><span class="id"> ifPn</span><span class="id"> =&gt;</span><span class="id"> xD</span><span class="id"> //</span>.<br/>
<span class="id">move:</span><span class="id"> xN;</span><span class="id"> rewrite</span><span class="id"> notin_setE;</span><span class="id"> apply:</span><span class="id"> contra_not</span><span class="id"> =&gt;</span><span class="id"> fxgx;</span><span class="id"> apply:</span><span class="id"> subN</span><span class="id"> =&gt;</span><span class="id"> /=</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply/not_implyP;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact/set_mem</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> ae_eq_integral</span> (<span class="id">D</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T</span>) (<span class="id">g</span><span class="id"> f</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">measurable</span><span class="id"> D</span><span class="id"> -&gt;</span><span class="id"> measurable_fun</span><span class="id"> D</span><span class="id"> f</span><span class="id"> -&gt;</span><span class="id"> measurable_fun</span><span class="id"> D</span><span class="id"> g</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">ae_eq</span><span class="id"> D</span><span class="id"> f</span><span class="id"> g</span><span class="id"> -&gt;</span><span class="id"> integral</span><span class="id"> mu</span><span class="id"> D</span><span class="id"> f</span><span class="id"> =</span><span class="id"> integral</span><span class="id"> mu</span><span class="id"> D</span><span class="id"> g</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> mD</span><span class="id"> mf</span><span class="id"> mg</span><span class="id"> /ae_eq_funeposneg[Dfgp</span><span class="id"> Dfgn]</span>.<br/>
<span class="id">rewrite</span><span class="id"> integralE//</span><span class="id"> [in</span><span class="id"> RHS]integralE//;</span><span class="id"> congr</span> (_<span class="id"> -</span><span class="id"> _</span>).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> ge0_ae_eq_integral</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> [exact:</span><span class="id"> measurable_funepos|</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> measurable_funepos]</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> ge0_ae_eq_integral</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> [exact:</span><span class="id"> measurable_funeneg|</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> measurable_funeneg]</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> ae_eq_integral</span>.<br/>
<span class="vernacular">Arguments</span><span class="id"> ae_eq_integral</span><span class="id"> {d</span><span class="id"> T</span><span class="id"> R</span><span class="id"> mu</span><span class="id"> D}</span><span class="id"> g</span>.<br/>
<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> integral_cst</span><span class="id"> d</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">mu</span><span class="id"> :</span><span class="id"> {measure</span><span class="id"> set</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R}</span>) (<span class="id">D</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T</span>)<span class="id"> :</span><span class="id"> d</span>.<span class="id">-measurable</span><span class="id"> D</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">forall</span><span class="id"> r,</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>) (<span class="id">cst</span><span class="id"> r</span>)<span class="id"> x</span><span class="id"> =</span><span class="id"> r</span><span class="id"> *</span><span class="id"> mu</span><span class="id"> D</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> mD;</span><span class="id"> have</span><span class="id"> [D0</span><span class="id"> r|D0</span><span class="id"> [r|</span><span class="id"> |]]</span><span class="id"> :=</span><span class="id"> eqVneq</span> (<span class="id">mu</span><span class="id"> D</span>)<span class="id"> 0</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span> (<span class="id">ae_eq_integral</span> (<span class="id">cst</span><span class="id"> 0</span>))<span class="id">//</span><span class="id"> ?integral0</span><span class="id"> ?D0</span><span class="id"> ?mule0//;</span><span class="id"> exact:</span><span class="id"> ae_eq0</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> integral_cstr</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> integral_csty//</span><span class="id"> gt0_mulye//</span><span class="id"> lt0e</span><span class="id"> D0/=</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> integral_cstNy//</span><span class="id"> gt0_mulNye//</span><span class="id"> lt0e</span><span class="id"> D0/=</span>.<br/>
Qed.</div></details>
<span class="id">Add</span><span class="id"> Search</span><span class="id"> Blacklist</span> <span class="id">&quot;integral_cstr&quot;</span> <span class="id">&quot;integral_csty&quot;</span> <span class="id">&quot;integral_cstNy&quot;</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> le_integral_comp_abse</span><span class="id"> d</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">mu</span><span class="id"> :</span><span class="id"> {measure</span><span class="id"> set</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R}</span>)  (<span class="id">D</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T</span>) (<span class="id">mD</span><span class="id"> :</span><span class="id"> measurable</span><span class="id"> D</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">g</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id"> a</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> \bar</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>) (<span class="id">mf</span><span class="id"> :</span><span class="id"> measurable_fun</span><span class="id"> setT</span><span class="id"> f</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">f0</span><span class="id"> :</span><span class="gallina-kwd"> forall</span><span class="id"> r,</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> r</span><span class="id"> -&gt;</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> f</span><span class="id"> r</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">f_nd</span><span class="id"> :</span><span class="id"> {in</span><span class="id"> `[0,</span><span class="id"> +oo[%classic</span><span class="id"> &amp;,</span><span class="id"> {homo</span><span class="id"> f</span><span class="id"> :</span><span class="id"> x</span><span class="id"> y</span><span class="id"> /</span><span class="id"> x</span><span class="id"> &lt;=</span><span class="id"> y}}</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">measurable_fun</span><span class="id"> D</span><span class="id"> g</span><span class="id"> -&gt;</span> (<span class="id">0</span><span class="id"> &lt;</span><span class="id"> a</span>)<span class="id">%R</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;(<span class="id">f</span><span class="id"> a%:E</span>)<span class="id"> *</span><span class="id"> mu</span> (<span class="id">D</span><span class="id"> `&amp;`</span><span class="id"> [set</span><span class="id"> x</span><span class="id"> |</span> (<span class="id">`|g</span><span class="id"> x|</span><span class="id"> &gt;=</span><span class="id"> a%:E</span>)<span class="id">%E]</span>)<span class="id"> &lt;=</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> f</span><span class="id"> `|g</span><span class="id"> x|</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> mg</span><span class="id"> a0;</span><span class="id"> have</span><span class="id"> ?</span><span class="id"> :</span><span class="id"> measurable</span> (<span class="id">D</span><span class="id"> `&amp;`</span><span class="id"> [set</span><span class="id"> x</span><span class="id"> |</span> (<span class="id">a%:E</span><span class="id"> &lt;=</span><span class="id"> `|g</span><span class="id"> x|</span>)<span class="id">%E]</span>).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> emeasurable_fun_c_infty</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> measurableT_comp</span>.<br/>
<span class="id">apply:</span> (<span class="id">@le_trans</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span><span class="id"> `&amp;`</span><span class="id"> [set</span><span class="id"> x</span><span class="id"> |</span><span class="id"> `|g</span><span class="id"> x|</span><span class="id"> &gt;=</span><span class="id"> a%:E]</span>)<span class="id"> f</span><span class="id"> `|g</span><span class="id"> x|</span>)).<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -integral_cst//;</span><span class="id"> apply:</span><span class="id"> ge0_le_integral</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> _</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> f0</span><span class="id"> //</span><span class="id"> lee_fin</span><span class="id"> ltW</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> _</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> f0</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> apply:</span><span class="id"> measurableT_comp</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> apply:</span><span class="id"> measurableT_comp</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> measurable_funS</span><span class="id"> mg</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> /=</span><span class="id"> [Dx];</span><span class="id"> apply:</span><span class="id"> f_nd;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> inE</span><span class="id"> /=</span><span class="id"> in_itv</span><span class="id"> /=</span><span class="id"> andbT//</span><span class="id"> lee_fin</span><span class="id"> ltW</span>.<br/>
<span class="id">apply:</span><span class="id"> ge0_subset_integral</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> _</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> f0</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> measurableT_comp</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> measurableT_comp</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Local</span><span class="vernacular"> Close</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> ae_measurable_fun</span>.<br/>
<span class="vernacular">Context</span><span class="id"> d</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">mu</span><span class="id"> :</span><span class="id"> {measure</span><span class="id"> set</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R}</span>).<br/>
<span class="vernacular">Hypothesis</span><span class="id"> cmu</span><span class="id"> :</span><span class="id"> measure_is_complete</span><span class="id"> mu</span>.<br/>
<span class="vernacular">Variables</span> (<span class="id">D</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T</span>) (<span class="id">f</span><span class="id"> g</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> ae_measurable_fun</span><span class="id"> :</span><span class="id"> ae_eq</span><span class="id"> mu</span><span class="id"> D</span><span class="id"> f</span><span class="id"> g</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">measurable_fun</span><span class="id"> D</span><span class="id"> f</span><span class="id"> -&gt;</span><span class="id"> measurable_fun</span><span class="id"> D</span><span class="id"> g</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> [N</span><span class="id"> [mN</span><span class="id"> N0</span><span class="id"> subN]]</span><span class="id"> mf</span><span class="id"> B</span><span class="id"> mB</span><span class="id"> mD</span>.<br/>
<span class="id">apply:</span> (<span class="id">measurability</span> (<span class="id">ErealGenOInfty</span>.<span class="id">measurableE</span><span class="id"> R</span>))<span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> _</span><span class="id"> [_</span><span class="id"> [x</span><span class="id"> -&gt;]</span><span class="id"> &lt;-]</span>.<br/>
<span class="id">rewrite</span><span class="id"> [X</span><span class="gallina-kwd"> in</span><span class="id"> measurable</span><span class="id"> X]</span>(_<span class="id"> :</span><span class="id"> _</span><span class="id"> =</span><span class="id"> D</span><span class="id"> `&amp;`</span><span class="id"> ~`</span><span class="id"> N</span><span class="id"> `&amp;`</span> (<span class="id">f</span><span class="id"> @^-1`</span><span class="id"> `]x%:E,</span><span class="id"> +oo[</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">`|`</span> (<span class="id">D</span><span class="id"> `&amp;`</span><span class="id"> N</span><span class="id"> `&amp;`</span><span class="id"> g</span><span class="id"> @^-1`</span><span class="id"> `]x%:E,</span><span class="id"> +oo[</span>))<span class="id">;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">apply/seteqP;</span><span class="id"> split=&gt;</span><span class="id"> [y</span><span class="id"> /=</span><span class="id"> [Dy</span><span class="id"> gyxoo]|y</span><span class="id"> /=</span><span class="id"> [[[Dy</span><span class="id"> Ny]</span><span class="id"> fyxoo]|]]</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> have</span><span class="id"> [-&gt;|fgy]</span><span class="id"> :=</span><span class="id"> eqVneq</span> (<span class="id">f</span><span class="id"> y</span>) (<span class="id">g</span><span class="id"> y</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">have</span><span class="id"> [yN|yN]</span><span class="id"> :=</span><span class="id"> boolP</span> (<span class="id">y</span><span class="id"> \in</span><span class="id"> N</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> right;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> rewrite</span><span class="id"> inE</span><span class="gallina-kwd"> in</span><span class="id"> yN</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> left;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> rewrite</span><span class="id"> notin_setE</span><span class="gallina-kwd"> in</span><span class="id"> yN</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> right;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> apply:</span><span class="id"> subN</span><span class="id"> =&gt;</span><span class="id"> /=</span><span class="id"> /</span>(_<span class="id"> Dy</span>)<span class="id">;</span><span class="id"> exact/eqP</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> have</span><span class="id"> [&lt;-//|fgy]</span><span class="id"> :=</span><span class="id"> eqVneq</span> (<span class="id">f</span><span class="id"> y</span>) (<span class="id">g</span><span class="id"> y</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> exfalso;</span><span class="id"> apply/Ny/subN</span><span class="id"> =&gt;</span><span class="id"> /=</span><span class="id"> /</span>(_<span class="id"> Dy</span>)<span class="id">;</span><span class="id"> exact/eqP</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> [[]]</span>.<br/>
<span class="id">apply:</span><span class="id"> measurableU</span>.<br/>
<span class="id">-</span><span class="id"> rewrite</span><span class="id"> setIAC;</span><span class="id"> apply:</span><span class="id"> measurableI;</span><span class="id"> last</span><span class="id"> exact/measurableC</span>.<br/>
&nbsp;&nbsp;<span class="id">exact/mf/emeasurable_itv</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> cmu;</span><span class="gallina-kwd"> exists</span><span class="id"> N;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> rewrite</span><span class="id"> setIAC;</span><span class="id"> apply:</span><span class="id"> subIset;</span><span class="id"> right</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> ae_measurable_fun</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> integralD</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<span class="vernacular">Context</span><span class="id"> d</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>).<br/>
<span class="vernacular">Variables</span> (<span class="id">mu</span><span class="id"> :</span><span class="id"> {measure</span><span class="id"> set</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R}</span>) (<span class="id">D</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T</span>) (<span class="id">mD</span><span class="id"> :</span><span class="id"> measurable</span><span class="id"> D</span>).<br/>
<span class="vernacular">Variables</span> (<span class="id">f1</span><span class="id"> f2</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>).<br/>
<span class="vernacular">Hypotheses</span> (<span class="id">if1</span><span class="id"> :</span><span class="id"> mu</span>.<span class="id">-integrable</span><span class="id"> D</span><span class="id"> f1</span>) (<span class="id">if2</span><span class="id"> :</span><span class="id"> mu</span>.<span class="id">-integrable</span><span class="id"> D</span><span class="id"> f2</span>).<br/>
<br/>
<span class="vernacular">Let</span><span class="id"> mf1</span><span class="id"> :</span><span class="id"> measurable_fun</span><span class="id"> D</span><span class="id"> f1</span><br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id"> exact:</span><span class="id"> measurable_int</span><span class="id"> if1</span>. Qed.</div></details>
<span class="vernacular">Let</span><span class="id"> mf2</span><span class="id"> :</span><span class="id"> measurable_fun</span><span class="id"> D</span><span class="id"> f2</span><br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id"> exact:</span><span class="id"> measurable_int</span><span class="id"> if2</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> integralD</span><span class="id"> :</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>) (<span class="id">f1</span><span class="id"> x</span><span class="id"> +</span><span class="id"> f2</span><span class="id"> x</span>)<span class="id"> =</span><br/>
&nbsp;&nbsp;<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> f1</span><span class="id"> x</span><span class="id"> +</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> f2</span><span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">pose</span><span class="id"> A</span><span class="id"> :=</span><span class="id"> D</span><span class="id"> `&amp;`</span><span class="id"> [set</span><span class="id"> x</span><span class="id"> |</span><span class="id"> f1</span><span class="id"> x</span><span class="id"> \is</span><span class="id"> a</span><span class="id"> fin_num]</span>.<br/>
<span class="id">pose</span><span class="id"> B</span><span class="id"> :=</span><span class="id"> D</span><span class="id"> `&amp;`</span><span class="id"> [set</span><span class="id"> x</span><span class="id"> |</span><span class="id"> f2</span><span class="id"> x</span><span class="id"> \is</span><span class="id"> a</span><span class="id"> fin_num]</span>.<br/>
<span class="id">have</span><span class="id"> mA</span><span class="id"> :</span><span class="id"> measurable</span><span class="id"> A</span><span class="gallina-kwd"> by</span><span class="id"> exact:</span><span class="id"> emeasurable_fin_num</span>.<br/>
<span class="id">have</span><span class="id"> mB</span><span class="id"> :</span><span class="id"> measurable</span><span class="id"> B</span><span class="gallina-kwd"> by</span><span class="id"> exact:</span><span class="id"> emeasurable_fin_num</span>.<br/>
<span class="id">have</span><span class="id"> mAB</span><span class="id"> :</span><span class="id"> measurable</span> (<span class="id">A</span><span class="id"> `&amp;`</span><span class="id"> B</span>)<span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> measurableI</span>.<br/>
<span class="id">pose</span><span class="id"> g1</span><span class="id"> :=</span> (<span class="id">fine</span><span class="id"> \o</span><span class="id"> f1</span><span class="id"> \_</span> (<span class="id">A</span><span class="id"> `&amp;`</span><span class="id"> B</span>))<span class="id">%R</span>.<br/>
<span class="id">pose</span><span class="id"> g2</span><span class="id"> :=</span> (<span class="id">fine</span><span class="id"> \o</span><span class="id"> f2</span><span class="id"> \_</span> (<span class="id">A</span><span class="id"> `&amp;`</span><span class="id"> B</span>))<span class="id">%R</span>.<br/>
<span class="id">have</span><span class="id"> ig1</span><span class="id"> :</span><span class="id"> mu</span>.<span class="id">-integrable</span><span class="id"> D</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> g1</span>).<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> (_<span class="id"> :</span><span class="id"> _</span><span class="id"> \o</span><span class="id"> _</span><span class="id"> =</span><span class="id"> f1</span><span class="id"> \_</span> (<span class="id">A</span><span class="id"> `&amp;`</span><span class="id"> B</span>))<span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span> (<span class="id">integrableS</span><span class="id"> measurableT</span>)<span class="id">=&gt;//;</span><span class="id"> apply/</span>(<span class="id">integrable_mkcond</span><span class="id"> _</span><span class="id"> _</span>).<span class="id">1</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> integrableS</span><span class="id"> if1=&gt;//;</span><span class="id"> rewrite</span><span class="id"> -setIAC</span><span class="id"> -setIA;</span><span class="id"> apply:</span><span class="id"> subIset;</span><span class="id"> left</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> /g1</span><span class="id"> funeqE</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> //=;</span><span class="id"> rewrite</span><span class="id"> !/restrict;</span><span class="id"> case:</span><span class="id"> ifPn</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> 2!in_setI</span><span class="id"> =&gt;</span><span class="id"> /andP[/andP[xA</span><span class="id"> f1xfin]</span><span class="id"> _]</span><span class="id"> /=</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> fineK//;</span><span class="id"> rewrite</span><span class="id"> inE</span><span class="gallina-kwd"> in</span><span class="id"> f1xfin</span>.<br/>
<span class="id">have</span><span class="id"> mg1</span><span class="id"> :=</span><span class="id"> measurable_int</span><span class="id"> _</span><span class="id"> ig1</span>.<br/>
<span class="id">have</span><span class="id"> ig2</span><span class="id"> :</span><span class="id"> mu</span>.<span class="id">-integrable</span><span class="id"> D</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> g2</span>).<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> (_<span class="id"> :</span><span class="id"> _</span><span class="id"> \o</span><span class="id"> _</span><span class="id"> =</span><span class="id"> f2</span><span class="id"> \_</span> (<span class="id">A</span><span class="id"> `&amp;`</span><span class="id"> B</span>))<span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span> (<span class="id">integrableS</span><span class="id"> measurableT</span>)<span class="id">=&gt;//;</span><span class="id"> apply/</span>(<span class="id">integrable_mkcond</span><span class="id"> _</span><span class="id"> _</span>).<span class="id">1</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> integrableS</span><span class="id"> if2=&gt;//;</span><span class="id"> rewrite</span><span class="id"> -setIAC</span><span class="id"> -setIA;</span><span class="id"> apply:</span><span class="id"> subIset;</span><span class="id"> left</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> /g2</span><span class="id"> funeqE</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> //=;</span><span class="id"> rewrite</span><span class="id"> !/restrict;</span><span class="id"> case:</span><span class="id"> ifPn</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> in_setI</span><span class="id"> =&gt;</span><span class="id"> /andP[_];</span><span class="id"> rewrite</span><span class="id"> in_setI</span><span class="id"> =&gt;</span><span class="id"> /andP[xB</span><span class="id"> f2xfin]</span><span class="id"> /=</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> fineK//;</span><span class="id"> rewrite</span><span class="id"> inE</span><span class="gallina-kwd"> in</span><span class="id"> f2xfin</span>.<br/>
<span class="id">have</span><span class="id"> mg2</span><span class="id"> :=</span><span class="id"> measurable_int</span><span class="id"> _</span><span class="id"> ig2</span>.<br/>
<span class="id">transitivity</span> (<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>) (<span class="id">EFin</span><span class="id"> \o</span> (<span class="id">g1</span><span class="id"> \+</span><span class="id"> g2</span>)<span class="id">%R</span>)<span class="id"> x</span>).<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> ae_eq_integral</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> exact:</span><span class="id"> emeasurable_funD</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> rewrite</span> (_<span class="id"> :</span><span class="id"> _</span><span class="id"> \o</span><span class="id"> _</span><span class="id"> =</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> g1</span>)<span class="id"> \+</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> g2</span>))<span class="id">//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> emeasurable_funD</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> apply:</span> (<span class="id">filterS2</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">integrable_ae</span><span class="id"> mD</span><span class="id"> if1</span>) (<span class="id">integrable_ae</span><span class="id"> mD</span><span class="id"> if2</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> x</span><span class="id"> +</span><span class="id"> +</span><span class="id"> Dx</span><span class="id"> =&gt;</span><span class="id"> /</span>(_<span class="id"> Dx</span>)<span class="id"> f1fin</span><span class="id"> /</span>(_<span class="id"> Dx</span>)<span class="id"> f2fin</span><span class="id"> /=</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> EFinD</span><span class="id"> /g1</span><span class="id"> /g2</span><span class="id"> /restrict</span><span class="id"> /=;</span><span class="id"> have</span><span class="id"> [|]</span><span class="id"> :=</span><span class="id"> boolP</span> (<span class="id">x</span><span class="id"> \in</span><span class="id"> A</span><span class="id"> `&amp;`</span><span class="id"> B</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> in_setI</span><span class="id"> =&gt;</span><span class="id"> /andP[xA</span><span class="id"> xB]</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> !fineK</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> in_setI</span><span class="id"> negb_and</span><span class="id"> =&gt;</span><span class="id"> /orP[|];</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> in_setI</span><span class="id"> negb_and</span><span class="id"> /=</span> (<span class="id">mem_set</span><span class="id"> Dx</span>)<span class="id">/=</span><span class="id"> notin_setE/=</span>.<br/>
<span class="id">-</span><span class="id"> rewrite</span> (_<span class="id"> :</span><span class="id"> _</span><span class="id"> \o</span><span class="id"> _</span><span class="id"> =</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> g1</span>)<span class="id"> \+</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> g2</span>))<span class="id">//</span><span class="id"> integralD_EFin//</span>.<br/>
&nbsp;&nbsp;<span class="id">congr</span> (_<span class="id"> +</span><span class="id"> _</span>)<span class="id">;</span><span class="id"> apply:</span><span class="id"> ae_eq_integral</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="id"> apply:</span> (<span class="id">filterS2</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">integrable_ae</span><span class="id"> mD</span><span class="id"> if1</span>) (<span class="id">integrable_ae</span><span class="id"> mD</span><span class="id"> if2</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> x</span><span class="id"> +</span><span class="id"> +</span><span class="id"> Dx</span><span class="id"> =&gt;</span><span class="id"> /</span>(_<span class="id"> Dx</span>)<span class="id"> f1fin</span><span class="id"> /</span>(_<span class="id"> Dx</span>)<span class="id"> f2fin</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> /g1</span><span class="id"> /restrict</span><span class="id"> /=</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">have</span><span class="id"> [/=|]</span><span class="id"> :=</span><span class="id"> boolP</span> (<span class="id">x</span><span class="id"> \in</span><span class="id"> A</span><span class="id"> `&amp;`</span><span class="id"> B</span>)<span class="id">;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> fineK</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> in_setI</span><span class="id"> negb_and</span><span class="id"> =&gt;</span><span class="id"> /orP[|];</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> in_setI</span><span class="id"> negb_and</span><span class="id"> /=</span> (<span class="id">mem_set</span><span class="id"> Dx</span>)<span class="id"> /=</span><span class="id"> notin_setE/=</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="id"> apply:</span> (<span class="id">filterS2</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">integrable_ae</span><span class="id"> mD</span><span class="id"> if1</span>) (<span class="id">integrable_ae</span><span class="id"> mD</span><span class="id"> if2</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> x</span><span class="id"> +</span><span class="id"> +</span><span class="id"> Dx</span><span class="id"> =&gt;</span><span class="id"> /</span>(_<span class="id"> Dx</span>)<span class="id"> f1fin</span><span class="id"> /</span>(_<span class="id"> Dx</span>)<span class="id"> f2fin</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> /g2</span><span class="id"> /restrict</span><span class="id"> /=</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">have</span><span class="id"> [/=|]</span><span class="id"> :=</span><span class="id"> boolP</span> (<span class="id">x</span><span class="id"> \in</span><span class="id"> A</span><span class="id"> `&amp;`</span><span class="id"> B</span>)<span class="id">;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> fineK</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> in_setI</span><span class="id"> negb_and</span><span class="id"> =&gt;</span><span class="id"> /orP[|];</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> in_setI</span><span class="id"> negb_and</span><span class="id"> /=</span> (<span class="id">mem_set</span><span class="id"> Dx</span>)<span class="id"> /=</span><span class="id"> notin_setE</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> integralD</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> integralB</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<span class="vernacular">Context</span><span class="id"> d</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>).<br/>
<span class="vernacular">Variables</span> (<span class="id">mu</span><span class="id"> :</span><span class="id"> {measure</span><span class="id"> set</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R}</span>) (<span class="id">D</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T</span>).<br/>
<span class="vernacular">Variables</span> (<span class="id">mD</span><span class="id"> :</span><span class="id"> measurable</span><span class="id"> D</span>) (<span class="id">f1</span><span class="id"> f2</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>).<br/>
<span class="vernacular">Hypotheses</span> (<span class="id">if1</span><span class="id"> :</span><span class="id"> mu</span>.<span class="id">-integrable</span><span class="id"> D</span><span class="id"> f1</span>) (<span class="id">if2</span><span class="id"> :</span><span class="id"> mu</span>.<span class="id">-integrable</span><span class="id"> D</span><span class="id"> f2</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> integralB</span><span class="id"> :</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>) (<span class="id">f1</span><span class="id"> \-</span><span class="id"> f2</span>)<span class="id"> x</span><span class="id"> =</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> f1</span><span class="id"> x</span><span class="id"> -</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> f2</span><span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> -[in</span><span class="id"> RHS]</span>(<span class="id">@integralN</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> f2</span>)<span class="id">;</span><span class="id"> last</span><span class="id"> exact:</span><span class="id"> integrable_add_def</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -[in</span><span class="id"> RHS]integralD//;</span><span class="id"> exact:</span><span class="id"> integrableN</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> integralB</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> negligible_integral</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<span class="vernacular">Context</span><span class="id"> d</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">mu</span><span class="id"> :</span><span class="id"> {measure</span><span class="id"> set</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R}</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> negligible_integral</span> (<span class="id">D</span><span class="id"> N</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">measurable</span><span class="id"> N</span><span class="id"> -&gt;</span><span class="id"> measurable</span><span class="id"> D</span><span class="id"> -&gt;</span><span class="id"> mu</span>.<span class="id">-integrable</span><span class="id"> D</span><span class="id"> f</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">mu</span><span class="id"> N</span><span class="id"> =</span><span class="id"> 0</span><span class="id"> -&gt;</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> f</span><span class="id"> x</span><span class="id"> =</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span><span class="id"> `\`</span><span class="id"> N</span>)<span class="id"> f</span><span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> mN</span><span class="id"> mD</span><span class="id"> mf</span><span class="id"> muN0;</span><span class="id"> rewrite</span><span class="id"> [f]funeposneg</span><span class="id"> ?integralB</span><span class="id"> //;</span><span class="id"> first</span><span class="id"> last</span>.<br/>
<span class="id">-</span><span class="id"> exact:</span><span class="id"> integrable_funeneg</span>.<br/>
<span class="id">-</span><span class="id"> exact:</span><span class="id"> integrable_funepos</span>.<br/>
<span class="id">-</span><span class="id"> apply:</span> (<span class="id">integrableS</span><span class="id"> mD</span>)<span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> measurableD</span>.<br/>
&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> integrable_funeneg</span>.<br/>
<span class="id">-</span><span class="id"> apply:</span> (<span class="id">integrableS</span><span class="id"> mD</span>)<span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> measurableD</span>.<br/>
&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> integrable_funepos</span>.<br/>
<span class="id">-</span><span class="id"> exact:</span><span class="id"> measurableD</span>.<br/>
<span class="id">congr</span> (_<span class="id"> -</span><span class="id"> _</span>)<span class="id">;</span><span class="id"> apply:</span><span class="id"> ge0_negligible_integral</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> apply:</span> (<span class="id">measurable_int</span><span class="id"> mu</span>).<br/>
&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> integrable_funepos</span>.<br/>
<span class="id">exact:</span><span class="id"> integrable_funeneg</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> null_set_integral</span> (<span class="id">N</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">measurable</span><span class="id"> N</span><span class="id"> -&gt;</span><span class="id"> mu</span>.<span class="id">-integrable</span><span class="id"> N</span><span class="id"> f</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">mu</span><span class="id"> N</span><span class="id"> =</span><span class="id"> 0</span><span class="id"> -&gt;</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> N</span>)<span class="id"> f</span><span class="id"> x</span><span class="id"> =</span><span class="id"> 0</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> mN</span><span class="id"> intf</span><span class="id"> ?;</span><span class="id"> rewrite</span> (<span class="id">negligible_integral</span><span class="id"> mN</span><span class="id"> mN</span>)<span class="id">//</span><span class="id"> setDv</span><span class="id"> integral_set0</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> negligible_integral</span>.<br/>
<span class="id">Add</span><span class="id"> Search</span><span class="id"> Blacklist</span> <span class="id">&quot;ge0_negligible_integral&quot;</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> integrable_fune</span>.<br/>
<span class="vernacular">Context</span><span class="id"> d</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>).<br/>
<span class="vernacular">Variables</span> (<span class="id">mu</span><span class="id"> :</span><span class="id"> {measure</span><span class="id"> set</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R}</span>) (<span class="id">D</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T</span>) (<span class="id">mD</span><span class="id"> :</span><span class="id"> measurable</span><span class="id"> D</span>).<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> integral_fune_lt_pinfty</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">mu</span>.<span class="id">-integrable</span><span class="id"> D</span><span class="id"> f</span><span class="id"> -&gt;</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> f</span><span class="id"> x</span><span class="id"> &lt;</span><span class="id"> +oo</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> intf;</span><span class="id"> rewrite</span> (<span class="id">funeposneg</span><span class="id"> f</span>)<span class="id"> integralB//;</span><br/>
&nbsp;&nbsp;<span class="id">[|exact:</span><span class="id"> integrable_funepos|exact:</span><span class="id"> integrable_funeneg]</span>.<br/>
<span class="id">rewrite</span><span class="id"> lte_add_pinfty</span><span class="id"> ?integral_funepos_lt_pinfty//</span><span class="id"> lteNl</span><span class="id"> ltNye_eq</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> integrable_neg_fin_num</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> integral_fune_fin_num</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">mu</span>.<span class="id">-integrable</span><span class="id"> D</span><span class="id"> f</span><span class="id"> -&gt;</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> f</span><span class="id"> x</span><span class="id"> \is</span><span class="id"> a</span><span class="id"> fin_num</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> h;</span><span class="id"> apply/fin_numPlt;</span><span class="id"> rewrite</span><span class="id"> integral_fune_lt_pinfty//</span><span class="id"> andbC/=</span><span class="id"> -/</span>(<span class="id">-</span><span class="id"> +oo</span>).<br/>
<span class="id">rewrite</span><span class="id"> lteNl</span><span class="id"> -integralN;</span><span class="id"> first</span><span class="id"> exact/integral_fune_lt_pinfty/integrableN</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> fin_num_adde_defl//</span><span class="id"> fin_numN</span><span class="id"> integrable_neg_fin_num</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> integrable_fune</span>.<br/>
<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> integral_counting</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<span class="vernacular">Variable</span><span class="id"> R</span><span class="id"> :</span><span class="id"> realType</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> counting_dirac</span> (<span class="id">A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> nat</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">counting</span><span class="id"> A</span><span class="id"> =</span><span class="id"> \sum_</span>(<span class="id">n</span><span class="id"> &lt;oo</span>)<span class="id"> \d_</span><span class="id"> n</span><span class="id"> A</span><span class="id"> :&gt;</span><span class="id"> \bar</span><span class="id"> R</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">have</span><span class="id"> -&gt;</span><span class="id"> :</span><span class="id"> \sum_</span>(<span class="id">n</span><span class="id"> &lt;oo</span>)<span class="id"> \d_</span><span class="id"> n</span><span class="id"> A</span><span class="id"> =</span><span class="id"> \esum_</span>(<span class="id">i</span><span class="gallina-kwd"> in</span><span class="id"> A</span>)<span class="id"> \d_</span><span class="id"> i</span><span class="id"> A</span><span class="id"> :&gt;</span><span class="id"> \bar</span><span class="id"> R</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> nneseries_esum//</span> (_<span class="id"> :</span><span class="id"> [set</span><span class="id"> _</span><span class="id"> |</span><span class="id"> _]</span><span class="id"> =</span><span class="id"> setT</span>)<span class="id">;</span><span class="id"> last</span><span class="id"> exact/seteqP</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> [in</span><span class="id"> LHS]</span>(<span class="id">esumID</span><span class="id"> A</span>)<span class="id">//</span><span class="id"> !setTI</span><span class="id"> [X</span><span class="gallina-kwd"> in</span><span class="id"> _</span><span class="id"> +</span><span class="id"> X]</span>(_<span class="id"> :</span><span class="id"> _</span><span class="id"> =</span><span class="id"> 0</span>)<span class="id"> ?adde0//</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> esum1</span><span class="id"> =&gt;</span><span class="id"> i</span><span class="id"> Ai;</span><span class="id"> rewrite</span><span class="id"> /=</span><span class="id"> /dirac</span><span class="id"> indicE</span><span class="id"> memNset</span>.<br/>
<span class="id">rewrite</span><span class="id"> /counting/=;</span><span class="id"> case:</span><span class="id"> ifPn</span><span class="id"> =&gt;</span><span class="id"> /asboolP</span><span class="id"> finA</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -finite_card_dirac</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> infinite_card_dirac</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> summable_integral_dirac</span> (<span class="id">a</span><span class="id"> :</span><span class="id"> nat</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id"> :</span><span class="id"> summable</span><span class="id"> setT</span><span class="id"> a</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">\sum_</span>(<span class="id">n</span><span class="id"> &lt;oo</span>)<span class="id"> `|\int[\d_</span><span class="id"> n]_x</span><span class="id"> a</span><span class="id"> x|</span><span class="id"> &lt;</span><span class="id"> +oo</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> sa</span>.<br/>
<span class="id">apply:</span> (<span class="id">@le_lt_trans</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">\sum_</span>(<span class="id">i</span><span class="id"> &lt;oo</span>)<span class="id"> `|fine</span> (<span class="id">a</span><span class="id"> i</span>)<span class="id">|%:E</span>)).<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> lee_nneseries</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> n</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> integral_dirac//</span>.<br/>
&nbsp;&nbsp;<span class="id">move:</span> (<span class="id">@summable_pinfty</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> sa</span><span class="id"> n</span><span class="id"> Logic</span>.<span class="id">I</span>).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> case:</span> (<span class="id">a</span><span class="id"> n</span>)<span class="id"> =&gt;</span><span class="id"> //=</span><span class="id"> r</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> indicE/=</span><span class="id"> mem_set//</span><span class="id"> mul1r</span>.<br/>
<span class="id">move:</span> (<span class="id">sa</span>)<span class="id">;</span><span class="id"> rewrite</span><span class="id"> /summable</span><span class="id"> -fun_true</span><span class="id"> -nneseries_esum//;</span><span class="id"> apply:</span><span class="id"> le_lt_trans</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply</span><span class="id"> lee_nneseries</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> n</span><span class="id"> _</span><span class="id"> /=;</span><span class="id"> case:</span> (<span class="id">a</span><span class="id"> n</span>)<span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> rewrite</span><span class="id"> leey</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> integral_count</span> (<span class="id">a</span><span class="id"> :</span><span class="id"> nat</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id"> :</span><span class="id"> summable</span><span class="id"> setT</span><span class="id"> a</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">\int[counting]_t</span> (<span class="id">a</span><span class="id"> t</span>)<span class="id"> =</span><span class="id"> \sum_</span>(<span class="id">k</span><span class="id"> &lt;oo</span>) (<span class="id">a</span><span class="id"> k</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> sa</span>.<br/>
<span class="id">transitivity</span> (<span class="id">\int[mseries</span> (<span class="gallina-kwd">fun</span><span class="id"> n</span><span class="id"> =&gt;</span><span class="id"> [the</span><span class="id"> measure</span><span class="id"> _</span><span class="id"> _</span><span class="id"> of</span><span class="id"> \d_</span><span class="id"> n]</span>)<span class="id"> O]_t</span><span class="id"> a</span><span class="id"> t</span>).<br/>
&nbsp;&nbsp;<span class="id">congr</span> (<span class="id">integral</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span>)<span class="id">;</span><span class="id"> apply/funext</span><span class="id"> =&gt;</span><span class="id"> A</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /=</span><span class="id"> counting_dirac</span>.<br/>
<span class="id">rewrite</span> (<span class="id">@integral_measure_series</span><span class="id"> _</span><span class="id"> _</span><span class="id"> R</span> (<span class="gallina-kwd">fun</span><span class="id"> n</span><span class="id"> =&gt;</span><span class="id"> [the</span><span class="id"> measure</span><span class="id"> _</span><span class="id"> _</span><span class="id"> of</span><span class="id"> \d_</span><span class="id"> n]</span>)<span class="id"> setT</span>)<span class="id">//=</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> eq_eseriesr=&gt;</span><span class="id"> i</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> integral_dirac//=</span><span class="id"> diracT</span><span class="id"> mul1e</span>.<br/>
<span class="id">-</span><span class="id"> move=&gt;</span><span class="id"> n;</span><span class="id"> apply/integrableP;</span><span class="id"> split=&gt;</span><span class="id"> [//|]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> integral_dirac//=</span><span class="id"> diracT</span><span class="id"> mul1e</span> (<span class="id">summable_pinfty</span><span class="id"> sa</span>).<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> summable_integral_dirac</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> summable_funeneg</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> summable_integral_dirac</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> summable_funepos</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> ge0_integral_count</span> (<span class="id">a</span><span class="id"> :</span><span class="id"> nat</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id"> :</span> (<span class="gallina-kwd">forall</span><span class="id"> k,</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> a</span><span class="id"> k</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">\int[counting]_t</span> (<span class="id">a</span><span class="id"> t</span>)<span class="id"> =</span><span class="id"> \sum_</span>(<span class="id">k</span><span class="id"> &lt;oo</span>) (<span class="id">a</span><span class="id"> k</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> sa</span>.<br/>
<span class="id">transitivity</span> (<span class="id">\int[mseries</span> (<span class="gallina-kwd">fun</span><span class="id"> n</span><span class="id"> =&gt;</span><span class="id"> [the</span><span class="id"> measure</span><span class="id"> _</span><span class="id"> _</span><span class="id"> of</span><span class="id"> \d_</span><span class="id"> n]</span>)<span class="id"> O]_t</span><span class="id"> a</span><span class="id"> t</span>).<br/>
&nbsp;&nbsp;<span class="id">congr</span> (<span class="id">integral</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span>)<span class="id">;</span><span class="id"> apply/funext</span><span class="id"> =&gt;</span><span class="id"> A</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /=</span><span class="id"> counting_dirac</span>.<br/>
<span class="id">rewrite</span> (<span class="id">@ge0_integral_measure_series</span><span class="id"> _</span><span class="id"> _</span><span class="id"> R</span> (<span class="gallina-kwd">fun</span><span class="id"> n</span><span class="id"> =&gt;</span><span class="id"> \d_</span><span class="id"> n</span>)<span class="id"> setT</span>)<span class="id">//=</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> eq_eseriesr=&gt;</span><span class="id"> i</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> integral_dirac//=</span><span class="id"> diracT</span><span class="id"> mul1e</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> integral_counting</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> subadditive_countable</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<span class="vernacular">Context</span><span class="id"> d</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>).<br/>
<span class="vernacular">Variable</span> (<span class="id">mu</span><span class="id"> :</span><span class="id"> {measure</span><span class="id"> set</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R}</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> integrable_abse</span> (<span class="id">D</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">mu</span>.<span class="id">-integrable</span><span class="id"> D</span><span class="id"> f</span><span class="id"> -&gt;</span><span class="id"> mu</span>.<span class="id">-integrable</span><span class="id"> D</span> (<span class="id">abse</span><span class="id"> \o</span><span class="id"> f</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> /integrableP[mf</span><span class="id"> foo];</span><span class="id"> apply/integrableP;</span><span class="id"> split</span>.<br/>
&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> measurableT_comp</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> under</span><span class="id"> eq_integral</span><span class="id"> do</span><span class="id"> rewrite</span><span class="id"> abse_id</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> integrable_summable</span> (<span class="id">F</span><span class="id"> :</span> (<span class="id">set</span><span class="id"> T</span>)<span class="id">^nat</span>) (<span class="id">g</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id">:</span><br/>
&nbsp;&nbsp;<span class="id">trivIset</span><span class="id"> setT</span><span class="id"> F</span><span class="id"> -&gt;</span> (<span class="gallina-kwd">forall</span><span class="id"> k,</span><span class="id"> measurable</span> (<span class="id">F</span><span class="id"> k</span>))<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">mu</span>.<span class="id">-integrable</span> (<span class="id">\bigcup_k</span><span class="id"> F</span><span class="id"> k</span>)<span class="id"> g</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">summable</span><span class="id"> [set:</span><span class="id"> nat]</span> (<span class="gallina-kwd">fun</span><span class="id"> i</span><span class="id"> =&gt;</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> F</span><span class="id"> i</span>)<span class="id"> g</span><span class="id"> x</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> tF</span><span class="id"> mF</span><span class="id"> fi</span>.<br/>
<span class="id">rewrite</span><span class="id"> /summable</span><span class="id"> -</span>(_<span class="id"> :</span><span class="id"> [set</span><span class="id"> _</span><span class="id"> |</span><span class="id"> true]</span><span class="id"> =</span><span class="id"> setT</span>)<span class="id">;</span><span class="id"> last</span><span class="id"> exact/seteqP</span>.<br/>
<span class="id">rewrite</span><span class="id"> -nneseries_esum//</span>.<br/>
<span class="id">have</span><span class="id"> [mf</span><span class="id"> {fi}]</span><span class="id"> :=</span><span class="id"> integrableP</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> fi</span>.<br/>
<span class="id">rewrite</span><span class="id"> ge0_integral_bigcup//;</span><span class="id"> last</span><span class="id"> exact:</span><span class="id"> measurableT_comp</span>.<br/>
<span class="id">apply:</span><span class="id"> le_lt_trans;</span><span class="id"> apply:</span><span class="id"> lee_lim</span>.<br/>
<span class="id">-</span><span class="id"> exact:</span><span class="id"> is_cvg_ereal_nneg_natsum_cond</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> is_cvg_ereal_nneg_natsum_cond</span><span class="id"> =&gt;</span><span class="id"> n</span><span class="id"> _</span><span class="id"> _;</span><span class="id"> exact:</span><span class="id"> integral_ge0</span>.<br/>
<span class="id">-</span><span class="id"> apply:</span><span class="id"> nearW</span><span class="id"> =&gt;</span><span class="id"> n;</span><span class="id"> apply:</span><span class="id"> lee_sum</span><span class="id"> =&gt;</span><span class="id"> m</span><span class="id"> _;</span><span class="id"> apply:</span><span class="id"> le_abse_integral</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> measurable_funS</span><span class="id"> mf</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> [exact:</span><span class="id"> bigcup_measurable|]</span>.<br/>
&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> bigcup_sup</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> integral_bigcup</span> (<span class="id">F</span><span class="id"> :</span> (<span class="id">set</span><span class="id"> _</span>)<span class="id">^nat</span>) (<span class="id">g</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">trivIset</span><span class="id"> setT</span><span class="id"> F</span><span class="id"> -&gt;</span> (<span class="gallina-kwd">forall</span><span class="id"> k,</span><span class="id"> measurable</span> (<span class="id">F</span><span class="id"> k</span>))<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">mu</span>.<span class="id">-integrable</span> (<span class="id">\bigcup_k</span><span class="id"> F</span><span class="id"> k</span>)<span class="id"> g</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;(<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> \bigcup_i</span><span class="id"> F</span><span class="id"> i</span>)<span class="id"> g</span><span class="id"> x</span><span class="id"> =</span><span class="id"> \sum_</span>(<span class="id">i</span><span class="id"> &lt;oo</span>)<span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> F</span><span class="id"> i</span>)<span class="id"> g</span><span class="id"> x</span>)<span class="id">%E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> tF</span><span class="id"> mF</span><span class="id"> fi</span>.<br/>
<span class="id">have</span><span class="id"> ?</span><span class="id"> :</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> \bigcup_i</span><span class="id"> F</span><span class="id"> i</span>)<span class="id"> g</span><span class="id"> x</span><span class="id"> \is</span><span class="id"> a</span><span class="id"> fin_num</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> fin_numElt</span><span class="id"> -</span>(<span class="id">lte_absl</span><span class="id"> _</span><span class="id"> +oo</span>).<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> le_lt_trans</span> (<span class="id">integrableP</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> fi</span>).<span class="id">2;</span><span class="id"> apply:</span><span class="id"> le_abse_integral</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> bigcupT_measurable</span>.<br/>
&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> measurable_int</span><span class="id"> fi</span>.<br/>
<span class="id">transitivity</span> (<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> \bigcup_i</span><span class="id"> F</span><span class="id"> i</span>)<span class="id"> g^\+</span><span class="id"> x</span><span class="id"> -</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> \bigcup_i</span><span class="id"> F</span><span class="id"> i</span>)<span class="id"> g^\-</span><span class="id"> x</span>)<span class="id">%E</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -integralB;</span><span class="id"> last</span><span class="id"> 3</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="id"> exact:</span><span class="id"> bigcupT_measurable</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> integrable_funepos</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> bigcupT_measurable</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> integrable_funeneg</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> bigcupT_measurable</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> eq_integral</span><span class="id"> =&gt;</span><span class="id"> t</span><span class="id"> Ft;</span><span class="id"> rewrite</span><span class="id"> [in</span><span class="id"> LHS]</span>(<span class="id">funeposneg</span><span class="id"> g</span>).<br/>
<span class="id">transitivity</span> (<span class="id">\sum_</span>(<span class="id">i</span><span class="id"> &lt;oo</span>) (<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> F</span><span class="id"> i</span>)<span class="id"> g^\+</span><span class="id"> x</span><span class="id"> -</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> F</span><span class="id"> i</span>)<span class="id"> g^\-</span><span class="id"> x</span>))<span class="id">;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> eq_eseriesr</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> i;</span><span class="id"> rewrite</span><span class="id"> [RHS]integralE</span>.<br/>
<span class="id">transitivity</span> ((<span class="id">\sum_</span>(<span class="id">i</span><span class="id"> &lt;oo</span>)<span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> F</span><span class="id"> i</span>)<span class="id"> g^\+</span><span class="id"> x</span>)<span class="id"> -</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">\sum_</span>(<span class="id">i</span><span class="id"> &lt;oo</span>)<span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> F</span><span class="id"> i</span>)<span class="id"> g^\-</span><span class="id"> x</span>))<span class="id">%E</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> ge0_integral_bigcup//;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> measurable_funepos;</span><span class="id"> case/integrableP</span><span class="id"> :</span><span class="id"> fi</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> ge0_integral_bigcup//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> measurable_funepos;</span><span class="id"> apply:</span><span class="id"> measurableT_comp</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> case/integrableP</span><span class="id"> :</span><span class="id"> fi</span>.<br/>
<span class="id">rewrite</span><span class="id"> [X</span><span class="gallina-kwd"> in</span><span class="id"> X</span><span class="id"> -</span><span class="id"> _]nneseries_esum;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> n</span><span class="id"> _;</span><span class="id"> exact:</span><span class="id"> integral_ge0</span>.<br/>
<span class="id">rewrite</span><span class="id"> [X</span><span class="gallina-kwd"> in</span><span class="id"> _</span><span class="id"> -</span><span class="id"> X]nneseries_esum;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> n</span><span class="id"> _;</span><span class="id"> exact:</span><span class="id"> integral_ge0</span>.<br/>
<span class="id">rewrite</span><span class="id"> set_true</span><span class="id"> -esumB//=;</span><span class="id"> last</span><span class="id"> 4</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> apply:</span><span class="id"> integrable_summable</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> apply:</span><span class="id"> integrable_funepos</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> bigcup_measurable</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> apply:</span><span class="id"> integrable_summable</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> apply:</span><span class="id"> integrable_funepos</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> bigcup_measurable</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> exact:</span><span class="id"> integrableN</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> n</span><span class="id"> _;</span><span class="id"> exact:</span><span class="id"> integral_ge0</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> n</span><span class="id"> _;</span><span class="id"> exact:</span><span class="id"> integral_ge0</span>.<br/>
<span class="id">rewrite</span><span class="id"> summable_eseries;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">under</span><span class="id"> [X</span><span class="gallina-kwd"> in</span><span class="id"> summable</span><span class="id"> _</span><span class="id"> X]eq_fun</span><span class="id"> do</span><span class="id"> rewrite</span><span class="id"> -integralE</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> fun_true;</span><span class="id"> exact:</span><span class="id"> integrable_summable</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> congr</span> (_<span class="id"> -</span><span class="id"> _</span>)<span class="id">%E;</span><span class="id"> rewrite</span><span class="id"> nneseries_esum//</span><span class="id"> set_true</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> subadditive_countable</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> dominated_convergence_lemma</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<span class="vernacular">Context</span><span class="id"> d</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>).<br/>
<span class="vernacular">Variables</span> (<span class="id">mu</span><span class="id"> :</span><span class="id"> {measure</span><span class="id"> set</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R}</span>) (<span class="id">D</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T</span>) (<span class="id">mD</span><span class="id"> :</span><span class="id"> measurable</span><span class="id"> D</span>).<br/>
<span class="vernacular">Variables</span> (<span class="id">f_</span><span class="id"> :</span> (<span class="id">T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id">^nat</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>) (<span class="id">g</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>).<br/>
<span class="vernacular">Hypothesis</span><span class="id"> mf_</span><span class="id"> :</span><span class="gallina-kwd"> forall</span><span class="id"> n,</span><span class="id"> measurable_fun</span><span class="id"> D</span> (<span class="id">f_</span><span class="id"> n</span>).<br/>
<span class="vernacular">Hypothesis</span><span class="id"> f_f</span><span class="id"> :</span><span class="gallina-kwd"> forall</span><span class="id"> x,</span><span class="id"> D</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> f_</span><span class="id"> ^~</span><span class="id"> x</span><span class="id"> @</span><span class="id"> \oo</span><span class="id"> --&gt;</span><span class="id"> f</span><span class="id"> x</span>.<br/>
<span class="vernacular">Hypothesis</span><span class="id"> fing</span><span class="id"> :</span><span class="gallina-kwd"> forall</span><span class="id"> x,</span><span class="id"> D</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> g</span><span class="id"> x</span><span class="id"> \is</span><span class="id"> a</span><span class="id"> fin_num</span>.<br/>
<span class="vernacular">Hypothesis</span><span class="id"> ig</span><span class="id"> :</span><span class="id"> mu</span>.<span class="id">-integrable</span><span class="id"> D</span><span class="id"> g</span>.<br/>
<span class="vernacular">Hypothesis</span><span class="id"> absfg</span><span class="id"> :</span><span class="gallina-kwd"> forall</span><span class="id"> n</span><span class="id"> x,</span><span class="id"> D</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> `|f_</span><span class="id"> n</span><span class="id"> x|</span><span class="id"> &lt;=</span><span class="id"> g</span><span class="id"> x</span>.<br/>
<br/>
<span class="vernacular">Let</span><span class="id"> g0</span><span class="id"> x</span><span class="id"> :</span><span class="id"> D</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> g</span><span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> Dx;</span><span class="id"> rewrite</span> (<span class="id">le_trans</span><span class="id"> _</span> (<span class="id">@absfg</span><span class="id"> O</span><span class="id"> _</span><span class="id"> Dx</span>))<span class="id">//</span><span class="id"> lee_fin</span>. Qed.</div></details>
<br/>
<span class="vernacular">Let</span><span class="id"> mf</span><span class="id"> :</span><span class="id"> measurable_fun</span><span class="id"> D</span><span class="id"> f</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id"> exact:</span> (<span class="id">emeasurable_fun_cvg</span><span class="id"> _</span><span class="id"> _</span><span class="id"> mf_</span><span class="id"> f_f</span>). Qed.</div></details>
<br/>
<span class="vernacular">Local</span><span class="vernacular"> Lemma</span><span class="id"> dominated_integrable</span><span class="id"> :</span><span class="id"> mu</span>.<span class="id">-integrable</span><span class="id"> D</span><span class="id"> f</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">apply/integrableP;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> have</span><span class="id"> Dfg</span><span class="id"> x</span><span class="id"> :</span><span class="id"> D</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> `|</span><span class="id"> f</span><span class="id"> x</span><span class="id"> |</span><span class="id"> &lt;=</span><span class="id"> g</span><span class="id"> x</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> Dx;</span><span class="id"> have</span><span class="id"> /</span>(<span class="id">@cvg_lim</span><span class="id"> _</span>)<span class="id"> &lt;-</span><span class="id"> //</span><span class="id"> :</span><span class="id"> `|f_</span><span class="id"> n</span><span class="id"> x|</span><span class="id"> @[n</span><span class="id"> --&gt;</span><span class="id"> \oo]</span><span class="id"> --&gt;</span><span class="id"> `|f</span><span class="id"> x|</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> cvg_abse</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> f_f</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> lime_le</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> is_cvg_abse;</span><span class="id"> apply/cvg_ex;</span><span class="id"> eexists;</span><span class="id"> exact:</span><span class="id"> f_f</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> nearW</span><span class="id"> =&gt;</span><span class="id"> n;</span><span class="id"> exact:</span><span class="id"> absfg</span>.<br/>
<span class="id">move:</span><span class="id"> ig</span><span class="id"> =&gt;</span><span class="id"> /integrableP[mg];</span><span class="id"> apply:</span><span class="id"> le_lt_trans;</span><span class="id"> apply:</span><span class="id"> ge0_le_integral</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
<span class="id">-</span><span class="id"> exact:</span><span class="id"> measurableT_comp</span>.<br/>
<span class="id">-</span><span class="id"> exact:</span><span class="id"> measurableT_comp</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> Dx</span><span class="id"> /=;</span><span class="id"> rewrite</span> (<span class="id">gee0_abs</span> (<span class="id">g0</span><span class="id"> Dx</span>))<span class="id">;</span><span class="id"> exact:</span><span class="id"> Dfg</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Let</span><span class="id"> g_</span><span class="id"> n</span><span class="id"> x</span><span class="id"> :=</span><span class="id"> `|f_</span><span class="id"> n</span><span class="id"> x</span><span class="id"> -</span><span class="id"> f</span><span class="id"> x|</span>.<br/>
<br/>
<span class="vernacular">Let</span><span class="id"> cvg_g_</span><span class="id"> x</span><span class="id"> :</span><span class="id"> D</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> g_</span><span class="id"> ^~</span><span class="id"> x</span><span class="id"> @</span><span class="id"> \oo</span><span class="id"> --&gt;</span><span class="id"> 0</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> Dx;</span><span class="id"> rewrite</span><span class="id"> -abse0;</span><span class="id"> apply:</span><span class="id"> cvg_abse</span>.<br/>
<span class="id">move:</span> (<span class="id">f_f</span><span class="id"> Dx</span>)<span class="id">;</span><span class="id"> case:</span> (<span class="id">f</span><span class="id"> x</span>)<span class="id"> =&gt;</span><span class="id"> [r|/=|/=]</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> f_r;</span><span class="id"> apply/cvge_sub0</span>.<br/>
<span class="id">-</span><span class="id"> move/cvgeyPge/</span>(_ (<span class="id">fine</span> (<span class="id">g</span><span class="id"> x</span>)<span class="id"> +</span><span class="id"> 1</span>)<span class="id">%R</span>)<span class="id"> =&gt;</span><span class="id"> [n</span><span class="id"> _]/</span>(_<span class="id"> _</span> (<span class="id">leqnn</span><span class="id"> n</span>))<span class="id">/=</span><span class="id"> h</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> :</span> (<span class="id">fine</span> (<span class="id">g</span><span class="id"> x</span>)<span class="id"> +</span><span class="id"> 1</span>)<span class="id">%:E</span><span class="id"> &lt;=</span><span class="id"> g</span><span class="id"> x</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span> (<span class="id">le_trans</span><span class="id"> h</span>)<span class="id">//</span> (<span class="id">le_trans</span><span class="id"> _</span> (<span class="id">absfg</span><span class="id"> n</span><span class="id"> Dx</span>))<span class="id">//</span><span class="id"> lee_abs</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> case:</span> (<span class="id">g</span><span class="id"> x</span>) (<span class="id">fing</span><span class="id"> Dx</span>)<span class="id"> =&gt;</span><span class="id"> [r</span><span class="id"> _|</span><span class="id"> |]//;</span><span class="id"> rewrite</span><span class="id"> leNgt</span><span class="id"> EFinD</span><span class="id"> lteDl</span><span class="id"> ?lte01</span>.<br/>
<span class="id">-</span><span class="id"> move/cvgeNyPle/</span>(_ (<span class="id">-</span> (<span class="id">fine</span> (<span class="id">g</span><span class="id"> x</span>)<span class="id"> +</span><span class="id"> 1</span>))<span class="id">%R</span>)<span class="id"> =&gt;</span><span class="id"> [n</span><span class="id"> _]/</span>(_<span class="id"> _</span> (<span class="id">leqnn</span><span class="id"> n</span>))<span class="id"> h</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> :</span> (<span class="id">fine</span> (<span class="id">g</span><span class="id"> x</span>)<span class="id"> +</span><span class="id"> 1</span>)<span class="id">%:E</span><span class="id"> &lt;=</span><span class="id"> g</span><span class="id"> x</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">move:</span><span class="id"> h;</span><span class="id"> rewrite</span><span class="id"> EFinN</span><span class="id"> leeNr</span><span class="id"> =&gt;</span><span class="id"> /le_trans</span><span class="id"> -&gt;//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span> (<span class="id">le_trans</span><span class="id"> _</span> (<span class="id">absfg</span><span class="id"> n</span><span class="id"> Dx</span>))<span class="id">//</span><span class="id"> -abseN</span><span class="id"> lee_abs</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> case:</span> (<span class="id">g</span><span class="id"> x</span>) (<span class="id">fing</span><span class="id"> Dx</span>)<span class="id"> =&gt;</span><span class="id"> [r</span><span class="id"> _|</span><span class="id"> |]//;</span><span class="id"> rewrite</span><span class="id"> leNgt</span><span class="id"> EFinD</span><span class="id"> lteDl</span><span class="id"> ?lte01</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Let</span><span class="id"> gg_</span><span class="id"> n</span><span class="id"> x</span><span class="id"> :</span><span class="id"> D</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> 2%:E</span><span class="id"> *</span><span class="id"> g</span><span class="id"> x</span><span class="id"> -</span><span class="id"> g_</span><span class="id"> n</span><span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> Dx;</span><span class="id"> rewrite</span><span class="id"> subre_ge0;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> fin_numM//</span><span class="id"> fing</span>.<br/>
<span class="id">rewrite</span><span class="id"> -</span>(<span class="id">fineK</span> (<span class="id">fing</span><span class="id"> Dx</span>))<span class="id"> -EFinM</span><span class="id"> mulr_natl</span><span class="id"> mulr2n</span><span class="id"> /g_</span>.<br/>
<span class="id">rewrite</span> (<span class="id">le_trans</span> (<span class="id">lee_abs_sub</span><span class="id"> _</span><span class="id"> _</span>))<span class="id">//</span><span class="id"> [in</span><span class="id"> leRHS]EFinD</span><span class="id"> leeD//</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> fineK//</span><span class="id"> ?fing//</span><span class="id"> absfg</span>.<br/>
<span class="id">have</span><span class="id"> f_fx</span><span class="id"> :</span><span class="id"> `|</span>(<span class="id">f_</span><span class="id"> n</span><span class="id"> x</span>)<span class="id">|</span><span class="id"> @[n</span><span class="id"> --&gt;</span><span class="id"> \oo]</span><span class="id"> --&gt;</span><span class="id"> `|f</span><span class="id"> x|</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> cvg_abse;</span><span class="id"> exact:</span><span class="id"> f_f</span>.<br/>
<span class="id">move/cvg_lim</span><span class="id"> :</span> (<span class="id">f_fx</span>)<span class="id"> =&gt;</span><span class="id"> &lt;-//</span>.<br/>
<span class="id">apply:</span><span class="id"> lime_le;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> apply/cvg_ex;</span><span class="id"> eexists;</span><span class="id"> exact:</span><span class="id"> f_fx</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> nearW</span><span class="id"> =&gt;</span><span class="id"> k;</span><span class="id"> rewrite</span><span class="id"> fineK</span><span class="id"> ?fing//;</span><span class="id"> apply:</span><span class="id"> absfg</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Let</span><span class="id"> mgg</span><span class="id"> n</span><span class="id"> :</span><span class="id"> measurable_fun</span><span class="id"> D</span> (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> 2%:E</span><span class="id"> *</span><span class="id"> g</span><span class="id"> x</span><span class="id"> -</span><span class="id"> g_</span><span class="id"> n</span><span class="id"> x</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">apply/emeasurable_funB</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> [by</span><span class="id"> apply/measurable_funeM/</span>(<span class="id">measurable_int</span><span class="id"> _</span><span class="id"> ig</span>)<span class="id">|]</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply/measurableT_comp</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> emeasurable_funB</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Let</span><span class="id"> gg_ge0</span><span class="id"> n</span><span class="id"> x</span><span class="id"> :</span><span class="id"> D</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> 2%:E</span><span class="id"> *</span><span class="id"> g</span><span class="id"> x</span><span class="id"> -</span><span class="id"> g_</span><span class="id"> n</span><span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> Dx;</span><span class="id"> rewrite</span><span class="id"> gg_</span>. Qed.</div></details>
<br/>
<span class="vernacular">Local</span><span class="vernacular"> Lemma</span><span class="id"> dominated_cvg0</span><span class="id"> :</span><span class="id"> [sequence</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> g_</span><span class="id"> n</span><span class="id"> x]_n</span><span class="id"> @</span><span class="id"> \oo</span><span class="id"> --&gt;</span><span class="id"> 0</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">have</span><span class="id"> :=</span><span class="id"> fatou</span><span class="id"> mu</span><span class="id"> mD</span><span class="id"> mgg</span><span class="id"> gg_ge0</span>.<br/>
<span class="id">rewrite</span><span class="id"> [X</span><span class="gallina-kwd"> in</span><span class="id"> X</span><span class="id"> &lt;=</span><span class="id"> _</span><span class="id"> -&gt;</span><span class="id"> _]</span>(_<span class="id"> :</span><span class="id"> _</span><span class="id"> =</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>) (<span class="id">2%:E</span><span class="id"> *</span><span class="id"> g</span><span class="id"> x</span>) )<span class="id">;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> eq_integral</span><span class="id"> =&gt;</span><span class="id"> t;</span><span class="id"> rewrite</span><span class="id"> inE</span><span class="id"> =&gt;</span><span class="id"> Dt</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> limn_einf_shift//;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> fin_numM//</span><span class="id"> fing</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> is_cvg_limn_einfE//;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> is_cvgeN;</span><span class="id"> apply/cvg_ex;</span><span class="id"> eexists;</span><span class="id"> exact:</span><span class="id"> cvg_g_</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> [X</span><span class="gallina-kwd"> in</span><span class="id"> _</span><span class="id"> +</span><span class="id"> X]</span>(_<span class="id"> :</span><span class="id"> _</span><span class="id"> =</span><span class="id"> 0</span>)<span class="id"> ?adde0//;</span><span class="id"> apply/cvg_lim</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -oppe0;</span><span class="id"> apply:</span><span class="id"> cvgeN;</span><span class="id"> exact:</span><span class="id"> cvg_g_</span>.<br/>
<span class="id">have</span><span class="id"> i2g</span><span class="id"> :</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>) (<span class="id">2%:E</span><span class="id"> *</span><span class="id"> g</span><span class="id"> x</span>) <span class="id"> &lt;</span><span class="id"> +oo</span>.<br/>
<span class="id">rewrite</span><span class="id"> integralZl//</span><span class="id"> lte_mul_pinfty//</span><span class="id"> ?lee_fin//;</span><span class="id"> case:</span> (<span class="id">integrableP</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> ig</span>)<span class="id"> =&gt;</span><span class="id"> _</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> le_lt_trans;</span><span class="id"> rewrite</span><span class="id"> le_eqVlt;</span><span class="id"> apply/orP;</span><span class="id"> left;</span><span class="id"> apply/eqP</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> eq_integral</span><span class="id"> =&gt;</span><span class="id"> t</span><span class="id"> Dt;</span><span class="id"> rewrite</span><span class="id"> gee0_abs//</span><span class="id"> g0//;</span><span class="id"> rewrite</span><span class="id"> inE</span><span class="gallina-kwd"> in</span><span class="id"> Dt</span>.<br/>
<span class="id">have</span><span class="id"> ?</span><span class="id"> :</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>) (<span class="id">2%:E</span><span class="id"> *</span><span class="id"> g</span><span class="id"> x</span>) <span class="id"> \is</span><span class="id"> a</span><span class="id"> fin_num</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> ge0_fin_numE//</span><span class="id"> integral_ge0//</span><span class="id"> =&gt;</span><span class="id"> ?</span><span class="id"> ?;</span><span class="id"> rewrite</span><span class="id"> mule_ge0</span><span class="id"> ?lee_fin</span><span class="id"> ?g0</span>.<br/>
<span class="id">rewrite</span><span class="id"> [X</span><span class="gallina-kwd"> in</span><span class="id"> _</span><span class="id"> &lt;=</span><span class="id"> X</span><span class="id"> -&gt;</span><span class="id"> _]</span>(_<span class="id"> :</span><span class="id"> _</span><span class="id"> =</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>) (<span class="id">2%:E</span><span class="id"> *</span><span class="id"> g</span><span class="id"> x</span>) <span class="id"> +</span><span class="id"> -</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">limn_esup</span> (<span class="gallina-kwd">fun</span><span class="id"> n</span><span class="id"> =&gt;</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> g_</span><span class="id"> n</span><span class="id"> x</span>))<span class="id">;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> (_<span class="id"> :</span> (<span class="gallina-kwd">fun</span><span class="id"> _</span><span class="id"> =&gt;</span><span class="id"> _</span>)<span class="id"> =</span> (<span class="gallina-kwd">fun</span><span class="id"> n</span><span class="id"> =&gt;</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>) (<span class="id">2%:E</span><span class="id"> *</span><span class="id"> g</span><span class="id"> x</span>) <span class="id"> +</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> -</span><span class="id"> g_</span><span class="id"> n</span><span class="id"> x</span>))<span class="id">;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> funeqE</span><span class="id"> =&gt;</span><span class="id"> n;</span><span class="id"> rewrite</span><span class="id"> integralB//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> -integral_ge0N//</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> Dx//;</span><span class="id"> rewrite</span><span class="id"> /g_</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="id"> exact:</span><span class="id"> integrableZl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="id"> have</span><span class="id"> integrable_normfn</span><span class="id"> :</span><span class="id"> mu</span>.<span class="id">-integrable</span><span class="id"> D</span> (<span class="id">abse</span><span class="id"> \o</span><span class="id"> f_</span><span class="id"> n</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> le_integrable</span><span class="id"> ig</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> measurableT_comp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> Dx</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> abse_id</span> (<span class="id">le_trans</span> (<span class="id">absfg</span><span class="id"> _</span><span class="id"> Dx</span>))<span class="id">//</span><span class="id"> lee_abs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">suff:</span><span class="id"> mu</span>.<span class="id">-integrable</span><span class="id"> D</span> (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> `|f_</span><span class="id"> n</span><span class="id"> x|</span><span class="id"> +</span><span class="id"> `|f</span><span class="id"> x|</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> le_integrable</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> measurableT_comp</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> emeasurable_funB</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> Dx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /g_</span><span class="id"> abse_id</span> (<span class="id">le_trans</span> (<span class="id">lee_abs_sub</span><span class="id"> _</span><span class="id"> _</span>))<span class="id">//</span><span class="id"> lee_abs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> integrableD;</span><span class="id"> [by</span><span class="id"> []|</span><span class="gallina-kwd"> by</span><span class="id"> []|]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> le_integrable</span><span class="id"> dominated_integrable</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="id"> exact:</span><span class="id"> measurableT_comp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> Dx;</span><span class="id"> rewrite</span><span class="id"> /=</span><span class="id"> abse_id</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> limn_einf_shift</span><span class="id"> //</span><span class="id"> -limn_einfN;</span><span class="id"> congr</span> (_<span class="id"> +</span><span class="id"> limn_einf</span><span class="id"> _</span>).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> funeqE</span><span class="id"> =&gt;</span><span class="id"> n</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> -integral_ge0N//</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> Dx;</span><span class="id"> rewrite</span><span class="id"> /g_</span>.<br/>
<span class="id">rewrite</span><span class="id"> addeC</span><span class="id"> -leeBlDr//</span><span class="id"> subee//</span><span class="id"> leeNr</span><span class="id"> oppe0</span><span class="id"> =&gt;</span><span class="id"> lim_ge0</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply/limn_esup_le_cvg</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> n;</span><span class="id"> rewrite</span><span class="id"> integral_ge0//</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> /g_</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Local</span><span class="vernacular"> Lemma</span><span class="id"> dominated_cvg</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> f_</span><span class="id"> n</span><span class="id"> x</span><span class="id"> @[n</span><span class="id"> \oo]</span><span class="id"> --&gt;</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> f</span><span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">have</span><span class="id"> h</span><span class="id"> n</span><span class="id"> :</span><span class="id"> `|</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> f_</span><span class="id"> n</span><span class="id"> x</span><span class="id"> -</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> f</span><span class="id"> x</span><span class="id"> |</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">&lt;=</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> g_</span><span class="id"> n</span><span class="id"> x</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -</span>(<span class="id">integralB</span><span class="id"> _</span><span class="id"> _</span><span class="id"> dominated_integrable</span>)<span class="id">//;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> le_integrable</span><span class="id"> ig</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> x</span><span class="id"> Dx</span><span class="id"> /=;</span><span class="id"> rewrite</span> (<span class="id">gee0_abs</span> (<span class="id">g0</span><span class="id"> Dx</span>))<span class="id"> absfg</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> le_abse_integral</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> emeasurable_funB</span>.<br/>
<span class="id">suff:</span><span class="id"> `|</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> f_</span><span class="id"> n</span><span class="id"> x</span><span class="id"> -</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> f</span><span class="id"> x</span><span class="id"> |</span><span class="id"> @[n</span><span class="id"> \oo]</span><span class="id"> --&gt;</span><span class="id"> 0</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="id">move/cvg_abse0P/cvge_sub0;</span><span class="id"> apply</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> fin_numElt</span> (_<span class="id"> :</span><span class="id"> -oo</span><span class="id"> =</span><span class="id"> -</span><span class="id"> +oo</span>)<span class="id">//</span><span class="id"> -lte_absl</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="id">move:</span><span class="id"> dominated_integrable</span><span class="id"> =&gt;</span><span class="id"> /integrableP[?];</span><span class="id"> apply:</span><span class="id"> le_lt_trans</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span> (<span class="id">le_trans</span><span class="id"> _</span> (<span class="id">@le_abse_integral</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> mu</span><span class="id"> D</span><span class="id"> f</span><span class="id"> mD</span><span class="id"> _</span>)).<br/>
<span class="id">apply:</span> (<span class="id">@squeeze_cvge</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">cst</span><span class="id"> 0</span>)<span class="id"> _</span> (<span class="gallina-kwd">fun</span><span class="id"> n</span><span class="id"> =&gt;</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> g_</span><span class="id"> n</span><span class="id"> x</span>)).<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> nearW</span><span class="id"> =&gt;</span><span class="id"> n;</span><span class="id"> rewrite</span><span class="id"> abse_ge0//=;</span><span class="id"> exact:</span><span class="id"> h</span>.<br/>
<span class="id">-</span><span class="id"> exact:</span><span class="id"> cvg_cst</span>.<br/>
<span class="id">-</span><span class="id"> exact:</span><span class="id"> dominated_cvg0</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> dominated_convergence_lemma</span>.<br/>
<span class="vernacular">Arguments</span><span class="id"> dominated_integrable</span><span class="id"> {d</span><span class="id"> T</span><span class="id"> R</span><span class="id"> mu</span><span class="id"> D}</span><span class="id"> _</span><span class="id"> f_</span><span class="id"> f</span><span class="id"> g</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> dominated_convergence_theorem</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<span class="vernacular">Context</span><span class="id"> d</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>).<br/>
<span class="vernacular">Variables</span> (<span class="id">mu</span><span class="id"> :</span><span class="id"> {measure</span><span class="id"> set</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R}</span>) (<span class="id">D</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T</span>) (<span class="id">mD</span><span class="id"> :</span><span class="id"> measurable</span><span class="id"> D</span>).<br/>
<span class="vernacular">Variables</span> (<span class="id">f_</span><span class="id"> :</span> (<span class="id">T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id">^nat</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>) (<span class="id">g</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>).<br/>
<span class="vernacular">Hypothesis</span><span class="id"> mf_</span><span class="id"> :</span><span class="gallina-kwd"> forall</span><span class="id"> n,</span><span class="id"> measurable_fun</span><span class="id"> D</span> (<span class="id">f_</span><span class="id"> n</span>).<br/>
<span class="vernacular">Hypothesis</span><span class="id"> mf</span><span class="id"> :</span><span class="id"> measurable_fun</span><span class="id"> D</span><span class="id"> f</span>.<br/>
<span class="vernacular">Hypothesis</span><span class="id"> f_f</span><span class="id"> :</span><span class="id"> {ae</span><span class="id"> mu,</span><span class="gallina-kwd"> forall</span><span class="id"> x,</span><span class="id"> D</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> f_</span><span class="id"> ^~</span><span class="id"> x</span><span class="id"> @</span><span class="id"> \oo</span><span class="id"> --&gt;</span><span class="id"> f</span><span class="id"> x}</span>.<br/>
<span class="vernacular">Hypothesis</span><span class="id"> ig</span><span class="id"> :</span><span class="id"> mu</span>.<span class="id">-integrable</span><span class="id"> D</span><span class="id"> g</span>.<br/>
<span class="vernacular">Hypothesis</span><span class="id"> f_g</span><span class="id"> :</span><span class="id"> {ae</span><span class="id"> mu,</span><span class="gallina-kwd"> forall</span><span class="id"> x</span><span class="id"> n,</span><span class="id"> D</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> `|f_</span><span class="id"> n</span><span class="id"> x|</span><span class="id"> &lt;=</span><span class="id"> g</span><span class="id"> x}</span>.<br/>
<br/>
<span class="vernacular">Let</span><span class="id"> g_</span><span class="id"> n</span><span class="id"> x</span><span class="id"> :=</span><span class="id"> `|f_</span><span class="id"> n</span><span class="id"> x</span><span class="id"> -</span><span class="id"> f</span><span class="id"> x|</span>.<br/>
<br/>
<span class="vernacular">Theorem</span><span class="id"> dominated_convergence</span><span class="id"> :</span><span class="id"> [/\</span><span class="id"> mu</span>.<span class="id">-integrable</span><span class="id"> D</span><span class="id"> f,</span><br/>
&nbsp;&nbsp;<span class="id">[sequence</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>) (<span class="id">g_</span><span class="id"> n</span><span class="id"> x</span>)<span class="id">]_n</span><span class="id"> @</span><span class="id"> \oo</span><span class="id"> --&gt;</span><span class="id"> 0</span><span class="id"> &amp;</span><br/>
&nbsp;&nbsp;<span class="id">[sequence</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>) (<span class="id">f_</span><span class="id"> n</span><span class="id"> x</span>)<span class="id">]_n</span><span class="id"> @</span><span class="id"> \oo</span><span class="id"> --&gt;</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>) (<span class="id">f</span><span class="id"> x</span>)<span class="id"> ]</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">have</span><span class="id"> [N1</span><span class="id"> [mN1</span><span class="id"> N10</span><span class="id"> subN1]]</span><span class="id"> :=</span><span class="id"> f_f</span>.<br/>
<span class="id">have</span><span class="id"> [N2</span><span class="id"> [mN2</span><span class="id"> N20</span><span class="id"> subN2]]</span><span class="id"> :=</span><span class="id"> f_g</span>.<br/>
<span class="id">have</span><span class="id"> [N3</span><span class="id"> [mN3</span><span class="id"> N30</span><span class="id"> subN3]]</span><span class="id"> :=</span><span class="id"> integrable_ae</span><span class="id"> mD</span><span class="id"> ig</span>.<br/>
<span class="id">pose</span><span class="id"> N</span><span class="id"> :=</span><span class="id"> N1</span><span class="id"> `|`</span><span class="id"> N2</span><span class="id"> `|`</span><span class="id"> N3</span>.<br/>
<span class="id">have</span><span class="id"> mN</span><span class="id"> :</span><span class="id"> measurable</span><span class="id"> N</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> measurableU</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> measurableU</span>.<br/>
<span class="id">have</span><span class="id"> N0</span><span class="id"> :</span><span class="id"> mu</span><span class="id"> N</span><span class="id"> =</span><span class="id"> 0</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> null_set_setU//</span><span class="id"> ?null_set_setU//;</span><span class="id"> exact:</span><span class="id"> measurableU</span>.<br/>
<span class="id">pose</span><span class="id"> f'</span><span class="id"> :=</span><span class="id"> f</span><span class="id"> \_</span> (<span class="id">D</span><span class="id"> `\`</span><span class="id"> N</span>)<span class="id">;</span><span class="id"> pose</span><span class="id"> g'</span><span class="id"> :=</span><span class="id"> g</span><span class="id"> \_</span> (<span class="id">D</span><span class="id"> `\`</span><span class="id"> N</span>).<br/>
<span class="id">pose</span><span class="id"> f_'</span><span class="id"> :=</span><span class="gallina-kwd"> fun</span><span class="id"> n</span><span class="id"> =&gt;</span><span class="id"> f_</span><span class="id"> n</span><span class="id"> \_</span> (<span class="id">D</span><span class="id"> `\`</span><span class="id"> N</span>).<br/>
<span class="id">have</span><span class="id"> f_f'</span><span class="id"> x</span><span class="id"> :</span><span class="id"> D</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> f_'</span><span class="id"> ^~</span><span class="id"> x</span><span class="id"> @</span><span class="id"> \oo</span><span class="id"> --&gt;</span><span class="id"> f'</span><span class="id"> x</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> Dx;</span><span class="id"> rewrite</span><span class="id"> /f_'</span><span class="id"> /f'</span><span class="id"> /restrict</span><span class="id"> in_setD</span><span class="id"> mem_set//=</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> [/=</span><span class="id"> xN|/=</span><span class="id"> xN]</span><span class="id"> :=</span><span class="id"> boolP</span> (<span class="id">x</span><span class="id"> \in</span><span class="id"> N</span>)<span class="id">;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> cvg_cst</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> contraPP</span> (<span class="id">xN</span>)<span class="id"> =&gt;</span><span class="id"> h;</span><span class="id"> apply/negP;</span><span class="id"> rewrite</span><span class="id"> negbK</span><span class="id"> inE;</span><span class="id"> left;</span><span class="id"> left</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> subN1</span><span class="id"> =&gt;</span><span class="id"> /=</span><span class="id"> /</span>(_<span class="id"> Dx</span>)<span class="id">;</span><span class="id"> exact:</span><span class="id"> contra_not</span><span class="id"> h</span>.<br/>
<span class="id">have</span><span class="id"> f_g'</span><span class="id"> n</span><span class="id"> x</span><span class="id"> :</span><span class="id"> D</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> `|f_'</span><span class="id"> n</span><span class="id"> x|</span><span class="id"> &lt;=</span><span class="id"> g'</span><span class="id"> x</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> Dx;</span><span class="id"> rewrite</span><span class="id"> /f_'</span><span class="id"> /g'</span><span class="id"> /restrict</span><span class="id"> in_setD</span><span class="id"> mem_set//=</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> [/=|/=</span><span class="id"> xN]</span><span class="id"> :=</span><span class="id"> boolP</span> (<span class="id">x</span><span class="id"> \in</span><span class="id"> N</span>)<span class="id">;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> normr0</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> contrapT</span><span class="id"> =&gt;</span><span class="id"> fg;</span><span class="id"> move:</span><span class="id"> xN;</span><span class="id"> apply/negP;</span><span class="id"> rewrite</span><span class="id"> negbK</span><span class="id"> inE;</span><span class="id"> left;</span><span class="id"> right</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> subN2</span><span class="id"> =&gt;</span><span class="id"> /=</span><span class="id"> /</span>(_<span class="id"> n</span><span class="id"> Dx</span>).<br/>
<span class="id">have</span><span class="id"> mu_</span><span class="id"> n</span><span class="id"> :</span><span class="id"> measurable_fun</span><span class="id"> D</span> (<span class="id">f_'</span><span class="id"> n</span>).<br/>
&nbsp;&nbsp;<span class="id">apply/measurable_restrict</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> measurableD</span>.<br/>
&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> measurable_funS</span> (<span class="id">mf_</span><span class="id"> _</span>).<br/>
<span class="id">have</span><span class="id"> ig'</span><span class="id"> :</span><span class="id"> mu</span>.<span class="id">-integrable</span><span class="id"> D</span><span class="id"> g'</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span> (<span class="id">integrableS</span><span class="id"> measurableT</span>)<span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="id">apply/</span>(<span class="id">integrable_mkcond</span><span class="id"> g</span> (<span class="id">measurableD</span><span class="id"> mD</span><span class="id"> mN</span>)).<span class="id">1</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> integrableS</span><span class="id"> ig</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> measurableD</span>.<br/>
<span class="id">have</span><span class="id"> finv</span><span class="id"> x</span><span class="id"> :</span><span class="id"> D</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> g'</span><span class="id"> x</span><span class="id"> \is</span><span class="id"> a</span><span class="id"> fin_num</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> Dx;</span><span class="id"> rewrite</span><span class="id"> /g'</span><span class="id"> /restrict</span><span class="id"> in_setD//</span><span class="id"> mem_set//=</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> [//|xN</span><span class="id"> /=]</span><span class="id"> :=</span><span class="id"> boolP</span> (<span class="id">x</span><span class="id"> \in</span><span class="id"> N</span>).<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> contrapT</span><span class="id"> =&gt;</span><span class="id"> fing;</span><span class="id"> move:</span><span class="id"> xN;</span><span class="id"> apply/negP;</span><span class="id"> rewrite</span><span class="id"> negbK</span><span class="id"> inE;</span><span class="id"> right</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> subN3</span><span class="id"> =&gt;</span><span class="id"> /=</span><span class="id"> /</span>(_<span class="id"> Dx</span>).<br/>
<span class="id">split</span>.<br/>
<span class="id">-</span><span class="id"> have</span><span class="id"> /integrableP</span><span class="id"> if'</span><span class="id"> :</span><span class="id"> mu</span>.<span class="id">-integrable</span><span class="id"> D</span><span class="id"> f'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exact:</span> (<span class="id">dominated_integrable</span><span class="id"> _</span><span class="id"> f_'</span><span class="id"> _</span><span class="id"> g'</span>).<br/>
&nbsp;&nbsp;<span class="id">apply/integrableP;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="id">move:</span><span class="id"> if'</span><span class="id"> =&gt;</span><span class="id"> [?];</span><span class="id"> apply:</span><span class="id"> le_lt_trans</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> le_eqVlt;</span><span class="id"> apply/orP;</span><span class="id"> left;</span><span class="id"> apply/eqP/ae_eq_integral</span><span class="id"> =&gt;</span><span class="id"> //;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">[exact:</span><span class="id"> measurableT_comp|exact:</span><span class="id"> measurableT_comp|]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">exists</span><span class="id"> N;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> rewrite</span><span class="id"> -</span>(<span class="id">setCK</span><span class="id"> N</span>)<span class="id">;</span><span class="id"> apply:</span><span class="id"> subsetC</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> Nx</span><span class="id"> Dx</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /f'</span><span class="id"> /restrict</span><span class="id"> mem_set</span>.<br/>
<span class="id">-</span><span class="id"> have</span><span class="id"> :=</span><span class="id"> @dominated_cvg0</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> mD</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> mu_</span><span class="id"> f_f'</span><span class="id"> finv</span><span class="id"> ig'</span><span class="id"> f_g'</span>.<br/>
&nbsp;&nbsp;<span class="id">set</span><span class="id"> X</span><span class="id"> :=</span> (<span class="id">X</span><span class="gallina-kwd"> in</span><span class="id"> _</span><span class="id"> -&gt;</span><span class="id"> X</span><span class="id"> @</span><span class="id"> \oo</span><span class="id"> --&gt;</span><span class="id"> _</span>).<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> [X</span><span class="gallina-kwd"> in</span><span class="id"> X</span><span class="id"> @</span><span class="id"> \oo</span><span class="id"> --&gt;</span><span class="id"> _</span><span class="id"> -&gt;</span><span class="id"> _]</span>(_<span class="id"> :</span><span class="id"> _</span><span class="id"> =</span><span class="id"> X</span>)<span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="id">apply/funext</span><span class="id"> =&gt;</span><span class="id"> n;</span><span class="id"> apply:</span><span class="id"> ae_eq_integral</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="id"> apply:</span><span class="id"> measurableT_comp</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> apply:</span><span class="id"> emeasurable_funB</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply/measurable_restrict</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> measurableD</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exact:</span> (<span class="id">measurable_funS</span><span class="id"> mD</span>).<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> /g_;</span><span class="id"> apply:</span><span class="id"> measurableT_comp</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> emeasurable_funB</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> exists</span><span class="id"> N;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> rewrite</span><span class="id"> -</span>(<span class="id">setCK</span><span class="id"> N</span>)<span class="id">;</span><span class="id"> apply:</span><span class="id"> subsetC</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> /=</span><span class="id"> Nx</span><span class="id"> Dx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /f_'</span><span class="id"> /f'</span><span class="id"> /restrict</span><span class="id"> mem_set</span>.<br/>
<span class="id">-</span><span class="id"> have</span><span class="id"> :=</span><span class="id"> @dominated_cvg</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> mD</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> mu_</span><span class="id"> f_f'</span><span class="id"> finv</span><span class="id"> ig'</span><span class="id"> f_g'</span>.<br/>
&nbsp;&nbsp;<span class="id">set</span><span class="id"> X</span><span class="id"> :=</span> (<span class="id">X</span><span class="gallina-kwd"> in</span><span class="id"> _</span><span class="id"> -&gt;</span><span class="id"> X</span><span class="id"> @</span><span class="id"> \oo</span><span class="id"> --&gt;</span><span class="id"> _</span>).<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> [X</span><span class="gallina-kwd"> in</span><span class="id"> X</span><span class="id"> @</span><span class="id"> \oo</span><span class="id"> --&gt;</span><span class="id"> _</span><span class="id"> -&gt;</span><span class="id"> _]</span>(_<span class="id"> :</span><span class="id"> _</span><span class="id"> =</span><span class="id"> X</span>)<span class="id"> //;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply/funext</span><span class="id"> =&gt;</span><span class="id"> n;</span><span class="id"> apply:</span><span class="id"> ae_eq_integral</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">exists</span><span class="id"> N;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> rewrite</span><span class="id"> -</span>(<span class="id">setCK</span><span class="id"> N</span>)<span class="id">;</span><span class="id"> apply:</span><span class="id"> subsetC</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> /=</span><span class="id"> Nx</span><span class="id"> Dx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /f_'</span><span class="id"> /restrict</span><span class="id"> mem_set</span>.<br/>
&nbsp;&nbsp;<span class="id">set</span><span class="id"> Y</span><span class="id"> :=</span> (<span class="id">X</span><span class="gallina-kwd"> in</span><span class="id"> _</span><span class="id"> -&gt;</span><span class="id"> _</span><span class="id"> --&gt;</span><span class="id"> X</span>)<span class="id">;</span><span class="id"> rewrite</span><span class="id"> [X</span><span class="gallina-kwd"> in</span><span class="id"> _</span><span class="id"> --&gt;</span><span class="id"> X</span><span class="id"> -&gt;</span><span class="id"> _]</span>(_<span class="id"> :</span><span class="id"> _</span><span class="id"> =</span><span class="id"> Y</span>)<span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> ae_eq_integral</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply/measurable_restrict</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> measurableD</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exact:</span> (<span class="id">measurable_funS</span><span class="id"> mD</span>).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">exists</span><span class="id"> N;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> rewrite</span><span class="id"> -</span>(<span class="id">setCK</span><span class="id"> N</span>)<span class="id">;</span><span class="id"> apply:</span><span class="id"> subsetC</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> /=</span><span class="id"> Nx</span><span class="id"> Dx</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /f'</span><span class="id"> /restrict</span><span class="id"> mem_set</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> dominated_convergence_theorem</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> Rintegral</span>.<br/>
<span class="vernacular">Context</span><span class="id"> d</span><span class="id"> {T</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d}</span><span class="id"> {R</span><span class="id"> :</span><span class="id"> realType}</span>.<br/>
<span class="vernacular">Variable</span><span class="id"> mu</span><span class="id"> :</span><span class="id"> {measure</span><span class="id"> set</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R}</span>.<br/>
<span class="vernacular">Implicit</span><span class="id"> Types</span> (<span class="id">D</span><span class="id"> A</span><span class="id"> B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> R</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> eq_Rintegral</span><span class="id"> D</span><span class="id"> g</span><span class="id"> f</span><span class="id"> :</span><span class="id"> {in</span><span class="id"> D,</span><span class="id"> f</span><span class="id"> =1</span><span class="id"> g}</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> f</span><span class="id"> x</span><span class="id"> =</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> g</span><span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> fg;</span><span class="id"> congr</span><span class="id"> fine;</span><span class="id"> apply:</span><span class="id"> eq_integral</span><span class="id"> =&gt;</span><span class="id"> /=</span><span class="id"> x</span><span class="id"> xD;</span><span class="id"> rewrite</span><span class="id"> fg</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> Rintegral_mkcond</span><span class="id"> D</span><span class="id"> f</span><span class="id"> :</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> f</span><span class="id"> x</span><span class="id"> =</span><span class="id"> \int[mu]_x</span> (<span class="id">f</span><span class="id"> \_</span><span class="id"> D</span>)<span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> {1}/Rintegral</span><span class="id"> integral_mkcond/=</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> under</span><span class="id"> eq_integral</span><span class="id"> do</span><span class="id"> rewrite</span><span class="id"> restrict_EFin</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> Rintegral_mkcondr</span><span class="id"> D</span><span class="id"> P</span><span class="id"> f</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span><span class="id"> `&amp;`</span><span class="id"> P</span>)<span class="id"> f</span><span class="id"> x</span><span class="id"> =</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>) (<span class="id">f</span><span class="id"> \_</span><span class="id"> P</span>)<span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> {1}/Rintegral</span><span class="id"> integral_mkcondr</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> under</span><span class="id"> eq_integral</span><span class="id"> do</span><span class="id"> rewrite</span><span class="id"> restrict_EFin</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> Rintegral_mkcondl</span><span class="id"> D</span><span class="id"> P</span><span class="id"> f</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> P</span><span class="id"> `&amp;`</span><span class="id"> D</span>)<span class="id"> f</span><span class="id"> x</span><span class="id"> =</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>) (<span class="id">f</span><span class="id"> \_</span><span class="id"> P</span>)<span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> setIC</span><span class="id"> Rintegral_mkcondr</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> RintegralZl</span><span class="id"> D</span><span class="id"> f</span><span class="id"> r</span><span class="id"> :</span><span class="id"> measurable</span><span class="id"> D</span><span class="id"> -&gt;</span><span class="id"> mu</span>.<span class="id">-integrable</span><span class="id"> D</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> f</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>) (<span class="id">r</span><span class="id"> *</span><span class="id"> f</span><span class="id"> x</span>)<span class="id"> =</span><span class="id"> r</span><span class="id"> *</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> f</span><span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> mD</span><span class="id"> intf;</span><span class="id"> rewrite</span> (_<span class="id"> :</span><span class="id"> r</span><span class="id"> =</span><span class="id"> fine</span><span class="id"> r%:E</span>)<span class="id">//</span><span class="id"> -fineM//;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> integral_fune_fin_num</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> congr</span><span class="id"> fine;</span><span class="id"> under</span><span class="id"> eq_integral</span><span class="id"> do</span><span class="id"> rewrite</span><span class="id"> EFinM;</span><span class="id"> exact:</span><span class="id"> integralZl</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> RintegralZr</span><span class="id"> D</span><span class="id"> f</span><span class="id"> r</span><span class="id"> :</span><span class="id"> measurable</span><span class="id"> D</span><span class="id"> -&gt;</span><span class="id"> mu</span>.<span class="id">-integrable</span><span class="id"> D</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> f</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>) (<span class="id">f</span><span class="id"> x</span><span class="id"> *</span><span class="id"> r</span>)<span class="id"> =</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> f</span><span class="id"> x</span><span class="id"> *</span><span class="id"> r</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> mD</span><span class="id"> intf;</span><span class="id"> rewrite</span><span class="id"> mulrC</span><span class="id"> -RintegralZl//</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> under</span><span class="id"> eq_Rintegral</span><span class="id"> do</span><span class="id"> rewrite</span><span class="id"> mulrC</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> Rintegral_ge0</span><span class="id"> D</span><span class="id"> f</span><span class="id"> :</span> (<span class="gallina-kwd">forall</span><span class="id"> x,</span><span class="id"> D</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> f</span><span class="id"> x</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">0</span><span class="id"> &lt;=</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> f</span><span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> f0;</span><span class="id"> rewrite</span><span class="id"> fine_ge0//</span><span class="id"> integral_ge0</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> le_normr_integral</span><span class="id"> D</span><span class="id"> f</span><span class="id"> :</span><span class="id"> measurable</span><span class="id"> D</span><span class="id"> -&gt;</span><span class="id"> mu</span>.<span class="id">-integrable</span><span class="id"> D</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> f</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">`|\int[mu]_</span>(<span class="id">t</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> f</span><span class="id"> t|</span><span class="id"> &lt;=</span><span class="id"> \int[mu]_</span>(<span class="id">t</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> `|f</span><span class="id"> t|</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> mA</span><span class="id"> /integrableP[mf</span><span class="id"> ifoo]</span>.<br/>
<span class="id">rewrite</span><span class="id"> -lee_fin;</span><span class="id"> apply:</span><span class="id"> le_trans</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span> (<span class="id">le_trans</span><span class="id"> _</span> (<span class="id">le_abse_integral</span><span class="id"> mu</span><span class="id"> mA</span><span class="id"> mf</span>)).<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> /abse</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> [/fineK</span><span class="id"> &lt;-//|]</span><span class="id"> :=</span><span class="id"> boolP</span> (<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>) (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> f</span>)<span class="id"> x</span><span class="id"> \is</span><span class="id"> a</span><span class="id"> fin_num</span>)<span class="id">%E</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> fin_numEn</span><span class="id"> =&gt;</span><span class="id"> /orP[|]</span><span class="id"> /eqP</span><span class="id"> -&gt;;</span><span class="id"> rewrite</span><span class="id"> leey</span>.<br/>
<span class="id">rewrite</span><span class="id"> /Rintegral</span>.<br/>
<span class="id">move:</span><span class="id"> ifoo</span>.<br/>
<span class="id">rewrite</span><span class="id"> -ge0_fin_numE;</span><span class="id"> last</span><span class="id"> exact:</span><span class="id"> integral_ge0</span>.<br/>
<span class="id">move/fineK</span><span class="id"> -&gt;</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> ge0_le_integral</span><span class="id"> =&gt;</span><span class="id"> //=;</span><span class="id"> do</span><span class="id"> 2</span><span class="id"> apply:</span><span class="id"> measurableT_comp</span><span class="id"> =&gt;</span><span class="id"> //;</span><br/>
&nbsp;&nbsp;<span class="id">exact/measurable_EFinP</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> Rintegral_setU_EFin</span> (<span class="id">A</span><span class="id"> B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">d</span>.<span class="id">-measurable</span><span class="id"> A</span><span class="id"> -&gt;</span><span class="id"> d</span>.<span class="id">-measurable</span><span class="id"> B</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">mu</span>.<span class="id">-integrable</span> (<span class="id">A</span><span class="id"> `|`</span><span class="id"> B</span>) (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> f</span>)<span class="id"> -&gt;</span><span class="id"> [disjoint</span><span class="id"> A</span><span class="id"> &amp;</span><span class="id"> B]</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span> (<span class="id">A</span><span class="id"> `|`</span><span class="id"> B</span>))<span class="id"> f</span><span class="id"> x</span><span class="id"> =</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> A</span>)<span class="id"> f</span><span class="id"> x</span><span class="id"> +</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> B</span>)<span class="id"> f</span><span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> mA</span><span class="id"> mB</span><span class="id"> mf</span><span class="id"> AB;</span><span class="id"> rewrite</span><span class="id"> /Rintegral</span><span class="id"> integral_setU_EFin//;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">exact/measurable_EFinP/</span>(<span class="id">measurable_int</span><span class="id"> mu</span>).<br/>
<span class="id">have</span><span class="id"> mAf</span><span class="id"> :</span> <span class="id"> mu</span>.<span class="id">-integrable</span><span class="id"> A</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> f</span>).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span> <span class="id"> apply:</span><span class="id"> integrableS</span><span class="id"> mf</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> measurableU</span>.<br/>
<span class="id">have</span><span class="id"> mBf</span><span class="id"> :</span> <span class="id"> mu</span>.<span class="id">-integrable</span><span class="id"> B</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> f</span>).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> integrableS</span><span class="id"> mf</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> measurableU</span>.<br/>
<span class="id">move/integrableP</span><span class="id"> :</span><span class="id"> mAf</span><span class="id"> =&gt;</span><span class="id"> [mAf</span><span class="id"> itAfoo]</span>.<br/>
<span class="id">move/integrableP</span><span class="id"> :</span><span class="id"> mBf</span><span class="id"> =&gt;</span><span class="id"> [mBf</span><span class="id"> itBfoo]</span>.<br/>
<span class="id">rewrite</span><span class="id"> fineD//</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> fin_num_abs</span> (<span class="id">le_lt_trans</span><span class="id"> _</span><span class="id"> itAfoo</span>)<span class="id">//;</span><span class="id"> exact:</span><span class="id"> le_abse_integral</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> fin_num_abs</span> (<span class="id">le_lt_trans</span><span class="id"> _</span><span class="id"> itBfoo</span>)<span class="id">//;</span><span class="id"> exact:</span><span class="id"> le_abse_integral</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> Rintegral_set0</span><span class="id"> f</span><span class="id"> :</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> set0</span>)<span class="id"> f</span><span class="id"> x</span><span class="id"> =</span><span class="id"> 0</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> /Rintegral</span><span class="id"> integral_set0</span>. Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> Rintegral</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> ae_ge0_le_integral</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<span class="vernacular">Context</span><span class="id"> d</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>).<br/>
<span class="vernacular">Variable</span><span class="id"> mu</span><span class="id"> :</span><span class="id"> {measure</span><span class="id"> set</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R}</span>.<br/>
<span class="vernacular">Variables</span> (<span class="id">D</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T</span>) (<span class="id">mD</span><span class="id"> :</span><span class="id"> measurable</span><span class="id"> D</span>) (<span class="id">f1</span><span class="id"> f2</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>).<br/>
<span class="vernacular">Hypothesis</span><span class="id"> f10</span><span class="id"> :</span><span class="gallina-kwd"> forall</span><span class="id"> x,</span><span class="id"> D</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> f1</span><span class="id"> x</span>.<br/>
<span class="vernacular">Hypothesis</span><span class="id"> mf1</span><span class="id"> :</span><span class="id"> measurable_fun</span><span class="id"> D</span><span class="id"> f1</span>.<br/>
<span class="vernacular">Hypothesis</span><span class="id"> f20</span><span class="id"> :</span><span class="gallina-kwd"> forall</span><span class="id"> x,</span><span class="id"> D</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> f2</span><span class="id"> x</span>.<br/>
<span class="vernacular">Hypothesis</span><span class="id"> mf2</span><span class="id"> :</span><span class="id"> measurable_fun</span><span class="id"> D</span><span class="id"> f2</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> ae_ge0_le_integral</span><span class="id"> :</span><span class="id"> {ae</span><span class="id"> mu,</span><span class="gallina-kwd"> forall</span><span class="id"> x,</span><span class="id"> D</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> f1</span><span class="id"> x</span><span class="id"> &lt;=</span><span class="id"> f2</span><span class="id"> x}</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> f1</span><span class="id"> x</span><span class="id"> &lt;=</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> f2</span><span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> [N</span><span class="id"> [mN</span><span class="id"> muN</span><span class="id"> f1f2N]];</span><span class="id"> rewrite</span> (<span class="id">ge0_negligible_integral</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> muN</span>)<span class="id">//</span>.<br/>
<span class="id">rewrite</span><span class="id"> [leRHS]</span>(<span class="id">ge0_negligible_integral</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> muN</span>)<span class="id">//</span>.<br/>
<span class="id">apply:</span><span class="id"> ge0_le_integral;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> measurableD</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> t</span><span class="id"> [Dt</span><span class="id"> _];</span><span class="id"> exact:</span><span class="id"> f10</span>.<br/>
<span class="id">-</span><span class="id"> exact:</span><span class="id"> measurable_funS</span><span class="id"> mf1</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> t</span><span class="id"> [Dt</span><span class="id"> _];</span><span class="id"> exact:</span><span class="id"> f20</span>.<br/>
<span class="id">-</span><span class="id"> exact:</span><span class="id"> measurable_funS</span><span class="id"> mf2</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> t</span><span class="id"> [Dt</span><span class="id"> Nt];</span><span class="id"> move/subsetCl</span><span class="id"> :</span><span class="id"> f1f2N;</span><span class="id"> apply</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> ae_ge0_le_integral</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> integral_bounded</span>.<br/>
<span class="vernacular">Context</span><span class="id"> d</span><span class="id"> {T</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d}</span><span class="id"> {R</span><span class="id"> :</span><span class="id"> realType}</span>.<br/>
<span class="vernacular">Variable</span><span class="id"> mu</span><span class="id"> :</span><span class="id"> {measure</span><span class="id"> set</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R}</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> integral_le_bound</span> (<span class="id">D</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>) (<span class="id">M</span><span class="id"> :</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">measurable</span><span class="id"> D</span><span class="id"> -&gt;</span><span class="id"> measurable_fun</span><span class="id"> D</span><span class="id"> f</span><span class="id"> -&gt;</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> M</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">{ae</span><span class="id"> mu,</span><span class="gallina-kwd"> forall</span><span class="id"> x,</span><span class="id"> D</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> `|f</span><span class="id"> x|</span><span class="id"> &lt;=</span><span class="id"> M}</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> `|f</span><span class="id"> x|</span><span class="id"> &lt;=</span><span class="id"> M</span><span class="id"> *</span><span class="id"> mu</span><span class="id"> D</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> mD</span><span class="id"> mf</span><span class="id"> M0</span><span class="id"> dfx;</span><span class="id"> rewrite</span><span class="id"> -integral_cst</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> ae_ge0_le_integral</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> measurableT_comp</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> integral_bounded</span>.<br/>
<span class="vernacular">Arguments</span><span class="id"> integral_le_bound</span><span class="id"> {d</span><span class="id"> T</span><span class="id"> R</span><span class="id"> mu</span><span class="id"> D</span><span class="id"> f}</span><span class="id"> M</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> integral_ae_eq</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<span class="vernacular">Context</span><span class="id"> d</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>) (<span class="id">mu</span><span class="id"> :</span><span class="id"> {measure</span><span class="id"> set</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R}</span>).<br/>
<br/>
<span class="vernacular">Let</span><span class="id"> integral_measure_lt</span> (<span class="id">D</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T</span>) (<span class="id">mD</span><span class="id"> :</span><span class="id"> measurable</span><span class="id"> D</span>) (<span class="id">g</span><span class="id"> f</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">mu</span>.<span class="id">-integrable</span><span class="id"> D</span><span class="id"> f</span><span class="id"> -&gt;</span><span class="id"> mu</span>.<span class="id">-integrable</span><span class="id"> D</span><span class="id"> g</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">forall</span><span class="id"> E,</span><span class="id"> E</span><span class="id"> `&lt;=`</span><span class="id"> D</span><span class="id"> -&gt;</span><span class="id"> measurable</span><span class="id"> E</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> E</span>)<span class="id"> f</span><span class="id"> x</span><span class="id"> =</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> E</span>)<span class="id"> g</span><span class="id"> x</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">mu</span> (<span class="id">D</span><span class="id"> `&amp;`</span><span class="id"> [set</span><span class="id"> x</span><span class="id"> |</span><span class="id"> g</span><span class="id"> x</span><span class="id"> &lt;</span><span class="id"> f</span><span class="id"> x]</span>)<span class="id"> =</span><span class="id"> 0</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> itf</span><span class="id"> itg</span><span class="id"> fg;</span><span class="id"> pose</span><span class="id"> E</span><span class="id"> j</span><span class="id"> :=</span><span class="id"> D</span><span class="id"> `&amp;`</span><span class="id"> [set</span><span class="id"> x</span><span class="id"> |</span><span class="id"> f</span><span class="id"> x</span><span class="id"> -</span><span class="id"> g</span><span class="id"> x</span><span class="id"> &gt;=</span><span class="id"> j</span>.<span class="id">+1%:R^-1%:E]</span>.<br/>
<span class="id">have</span><span class="id"> msf</span><span class="id"> :=</span><span class="id"> measurable_int</span><span class="id"> _</span><span class="id"> itf</span>.<br/>
<span class="id">have</span><span class="id"> msg</span><span class="id"> :=</span><span class="id"> measurable_int</span><span class="id"> _</span><span class="id"> itg</span>.<br/>
<span class="id">have</span><span class="id"> mE</span><span class="id"> j</span><span class="id"> :</span><span class="id"> measurable</span> (<span class="id">E</span><span class="id"> j</span>).<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> /E;</span><span class="id"> apply:</span><span class="id"> emeasurable_fun_le</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply/</span>(<span class="id">emeasurable_funD</span><span class="id"> msf</span>)<span class="id">/measurableT_comp</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> case:</span><span class="id"> mg</span>.<br/>
<span class="id">have</span><span class="id"> muE</span><span class="id"> j</span><span class="id"> :</span><span class="id"> mu</span> (<span class="id">E</span><span class="id"> j</span>)<span class="id"> =</span><span class="id"> 0</span>.<br/>
&nbsp;&nbsp;<span class="id">apply/eqP;</span><span class="id"> rewrite</span><span class="id"> -measure_le0</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> fg0</span><span class="id"> :</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> E</span><span class="id"> j</span>) (<span class="id">f</span><span class="id"> \-</span><span class="id"> g</span>)<span class="id"> x</span><span class="id"> =</span><span class="id"> 0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> integralB//;</span><span class="id"> last</span><span class="id"> 2</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> integrableS</span><span class="id"> itf</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> subIsetl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> integrableS</span><span class="id"> itg</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> subIsetl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> fg//;</span><span class="id"> last</span><span class="id"> apply:</span><span class="id"> subIsetl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> subee//</span><span class="id"> fin_num_abs</span> (<span class="id">le_lt_trans</span> (<span class="id">le_abse_integral</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span>))<span class="id">//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> measurable_funS</span><span class="id"> msg</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> subIsetl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> le_lt_trans</span> (<span class="id">integrableP</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> itg</span>).<span class="id">2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> ge0_subset_integral</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> measurableT_comp</span><span class="id"> msg</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> subIsetl</span>.<br/>
&nbsp;&nbsp;<span class="id">suff</span><span class="id"> :</span><span class="id"> mu</span> (<span class="id">E</span><span class="id"> j</span>)<span class="id"> &lt;=</span><span class="id"> j</span>.<span class="id">+1%:R%:E</span><span class="id"> *</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> E</span><span class="id"> j</span>) (<span class="id">f</span><span class="id"> \-</span><span class="id"> g</span>)<span class="id"> x</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> fg0</span><span class="id"> mule0</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span> (<span class="id">@le_trans</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">j</span>.<span class="id">+1%:R%:E</span><span class="id"> *</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> E</span><span class="id"> j</span>)<span class="id"> j</span>.<span class="id">+1%:R^-1%:E</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> integral_cst//</span><span class="id"> muleA</span><span class="id"> -EFinM</span><span class="id"> divrr</span><span class="id"> ?unitfE//</span><span class="id"> mul1e</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> lee_pmul//;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> integral_ge0</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> ge0_le_integral</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> [|</span><span class="id"> |by</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> []]</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> [_/=];</span><span class="id"> exact:</span><span class="id"> le_trans</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> apply:</span><span class="id"> emeasurable_funB</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> measurable_funS</span><span class="id"> msf</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> subIsetl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> measurable_funS</span><span class="id"> msg</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> subIsetl</span>.<br/>
<span class="id">have</span><span class="id"> nd_E</span><span class="id"> :</span><span class="id"> {homo</span><span class="id"> E</span><span class="id"> :</span><span class="id"> n0</span><span class="id"> m</span><span class="id"> /</span> (<span class="id">n0</span><span class="id"> &lt;=</span><span class="id"> m</span>)<span class="id">%N</span><span class="id"> &gt;-&gt;</span> (<span class="id">n0</span><span class="id"> &lt;=</span><span class="id"> m</span>)<span class="id">%O}</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> i</span><span class="id"> j</span><span class="id"> ij;</span><span class="id"> apply/subsetPset</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> [Dx</span><span class="id"> /=</span><span class="id"> ifg];</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move:</span><span class="id"> ifg;</span><span class="id"> apply:</span><span class="id"> le_trans;</span><span class="id"> rewrite</span><span class="id"> lee_fin</span><span class="id"> lef_pV2//</span><span class="id"> ?posrE//</span><span class="id"> ler_nat</span>.<br/>
<span class="id">rewrite</span><span class="id"> set_lte_bigcup</span>.<br/>
<span class="id">have</span><span class="id"> /cvg_lim</span><span class="id"> h1</span><span class="id"> :</span> (<span class="id">mu</span><span class="id"> \o</span><span class="id"> E</span>)<span class="id"> x</span><span class="id"> @[x</span><span class="id"> --&gt;</span><span class="id"> \oo]--&gt;</span><span class="id"> 0</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> cvg_near_cst;</span><span class="id"> exact:</span><span class="id"> nearW</span>.<br/>
<span class="id">have</span><span class="id"> :=</span><span class="id"> @nondecreasing_cvg_mu</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> mu</span><span class="id"> E</span><span class="id"> mE</span> (<span class="id">bigcupT_measurable</span><span class="id"> E</span><span class="id"> mE</span>)<span class="id"> nd_E</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> move/cvg_lim</span><span class="id"> =&gt;</span><span class="id"> h2;</span><span class="id"> rewrite</span><span class="id"> setI_bigcupr</span><span class="id"> -h2//</span><span class="id"> h1</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> integral_ae_eq</span> (<span class="id">D</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T</span>) (<span class="id">mD</span><span class="id"> :</span><span class="id"> measurable</span><span class="id"> D</span>) (<span class="id">g</span><span class="id"> f</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">mu</span>.<span class="id">-integrable</span><span class="id"> D</span><span class="id"> f</span><span class="id"> -&gt;</span><span class="id"> measurable_fun</span><span class="id"> D</span><span class="id"> g</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">forall</span><span class="id"> E,</span><span class="id"> E</span><span class="id"> `&lt;=`</span><span class="id"> D</span><span class="id"> -&gt;</span><span class="id"> measurable</span><span class="id"> E</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> E</span>)<span class="id"> f</span><span class="id"> x</span><span class="id"> =</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> E</span>)<span class="id"> g</span><span class="id"> x</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">ae_eq</span><span class="id"> mu</span><span class="id"> D</span><span class="id"> f</span><span class="id"> g</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> fi</span><span class="id"> mg</span><span class="id"> fg;</span><span class="id"> have</span><span class="id"> mf</span><span class="id"> :=</span><span class="id"> measurable_int</span><span class="id"> _</span><span class="id"> fi;</span><span class="id"> have</span><span class="id"> gi</span><span class="id"> :</span><span class="id"> mu</span>.<span class="id">-integrable</span><span class="id"> D</span><span class="id"> g</span>.<br/>
&nbsp;&nbsp;<span class="id">apply/integrableP;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> apply/abse_integralP</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> rewrite</span><span class="id"> -fg//</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply/abse_integralP</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> case/integrableP</span><span class="id"> :</span><span class="id"> fi</span>.<br/>
<span class="id">have</span><span class="id"> mugf</span><span class="id"> :</span><span class="id"> mu</span> (<span class="id">D</span><span class="id"> `&amp;`</span><span class="id"> [set</span><span class="id"> x</span><span class="id"> |</span><span class="id"> g</span><span class="id"> x</span><span class="id"> &lt;</span><span class="id"> f</span><span class="id"> x]</span>)<span class="id"> =</span><span class="id"> 0</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> integral_measure_lt</span>.<br/>
<span class="id">have</span><span class="id"> mufg</span><span class="id"> :</span><span class="id"> mu</span> (<span class="id">D</span><span class="id"> `&amp;`</span><span class="id"> [set</span><span class="id"> x</span><span class="id"> |</span><span class="id"> f</span><span class="id"> x</span><span class="id"> &lt;</span><span class="id"> g</span><span class="id"> x]</span>)<span class="id"> =</span><span class="id"> 0</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> integral_measure_lt</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> E</span><span class="id"> ED</span><span class="id"> mE;</span><span class="id"> rewrite</span><span class="id"> fg</span>.<br/>
<span class="id">have</span><span class="id"> h</span><span class="id"> :</span><span class="id"> ~`</span><span class="id"> [set</span><span class="id"> x</span><span class="id"> |</span><span class="id"> D</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> f</span><span class="id"> x</span><span class="id"> =</span><span class="id"> g</span><span class="id"> x]</span><span class="id"> =</span><span class="id"> D</span><span class="id"> `&amp;`</span><span class="id"> [set</span><span class="id"> x</span><span class="id"> |</span><span class="id"> f</span><span class="id"> x</span><span class="id"> !=</span><span class="id"> g</span><span class="id"> x]</span>.<br/>
&nbsp;&nbsp;<span class="id">apply/seteqP;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> [x/=</span><span class="id"> /not_implyP[?</span><span class="id"> /eqP]//|x/=</span><span class="id"> [Dx</span><span class="id"> fgx]]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply/not_implyP;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact/eqP</span>.<br/>
<span class="id">apply/negligibleP</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> h;</span><span class="id"> apply:</span><span class="id"> emeasurable_fun_neq</span>.<br/>
<span class="id">rewrite</span><span class="id"> h</span><span class="id"> set_neq_lt</span><span class="id"> setIUr</span><span class="id"> measureU//</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> [X</span><span class="gallina-kwd"> in</span><span class="id"> X</span><span class="id"> +</span><span class="id"> _]mufg</span><span class="id"> add0e</span><span class="id"> [LHS]mugf</span>.<br/>
<span class="id">-</span><span class="id"> exact:</span><span class="id"> emeasurable_fun_lt</span>.<br/>
<span class="id">-</span><span class="id"> exact:</span><span class="id"> emeasurable_fun_lt</span>.<br/>
<span class="id">-</span><span class="id"> apply/seteqP;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> [x</span><span class="id"> [[Dx/=</span><span class="id"> +</span><span class="id"> [_]]]|//]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> /lt_trans</span><span class="id"> =&gt;</span><span class="id"> /[apply];</span><span class="id"> rewrite</span><span class="id"> ltxx</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> integral_ae_eq</span>.<br/>
<br/>
<div class="doc">Product measure </div>
<br/>
<span class="vernacular">Section</span><span class="id"> measurable_section</span>.<br/>
<span class="vernacular">Context</span><span class="id"> d1</span><span class="id"> d2</span> (<span class="id">T1</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d1</span>) (<span class="id">T2</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d2</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>).<br/>
<span class="vernacular">Implicit</span><span class="id"> Types</span> (<span class="id">A</span><span class="id"> :</span><span class="id"> set</span> (<span class="id">T1</span><span class="id"> *</span><span class="id"> T2</span>)).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> measurable_xsection</span><span class="id"> A</span><span class="id"> x</span><span class="id"> :</span><span class="id"> measurable</span><span class="id"> A</span><span class="id"> -&gt;</span><span class="id"> measurable</span> (<span class="id">xsection</span><span class="id"> A</span><span class="id"> x</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> mA;</span><span class="id"> rewrite</span> (<span class="id">xsection_indic</span><span class="id"> R</span>)<span class="id"> -</span>(<span class="id">setTI</span> (_<span class="id"> @^-1`</span><span class="id"> _</span>)).<br/>
<span class="id">exact:</span><span class="id"> measurableT_comp</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> measurable_ysection</span><span class="id"> A</span><span class="id"> y</span><span class="id"> :</span><span class="id"> measurable</span><span class="id"> A</span><span class="id"> -&gt;</span><span class="id"> measurable</span> (<span class="id">ysection</span><span class="id"> A</span><span class="id"> y</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> mA;</span><span class="id"> rewrite</span> (<span class="id">ysection_indic</span><span class="id"> R</span>)<span class="id"> -</span>(<span class="id">setTI</span> (_<span class="id"> @^-1`</span><span class="id"> _</span>)).<br/>
<span class="id">exact:</span><span class="id"> measurableT_comp</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> measurable_section</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> ndseq_closed_B</span>.<br/>
<span class="vernacular">Context</span><span class="id"> d1</span><span class="id"> d2</span> (<span class="id">T1</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d1</span>) (<span class="id">T2</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d2</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>).<br/>
<span class="vernacular">Implicit</span><span class="id"> Types</span><span class="id"> A</span><span class="id"> :</span><span class="id"> set</span> (<span class="id">T1</span><span class="id"> *</span><span class="id"> T2</span>).<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> xsection</span>.<br/>
<span class="vernacular">Variables</span> (<span class="id">pt2</span><span class="id"> :</span><span class="id"> T2</span>) (<span class="id">m2</span><span class="id"> :</span><span class="id"> T1</span><span class="id"> -&gt;</span><span class="id"> {measure</span><span class="id"> set</span><span class="id"> T2</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R}</span>).<br/>
<span class="vernacular">Let</span><span class="id"> phi</span><span class="id"> A</span><span class="id"> x</span><span class="id"> :=</span><span class="id"> m2</span><span class="id"> x</span> (<span class="id">xsection</span><span class="id"> A</span><span class="id"> x</span>).<br/>
<span class="vernacular">Let</span><span class="id"> B</span><span class="id"> :=</span><span class="id"> [set</span><span class="id"> A</span><span class="id"> |</span><span class="id"> measurable</span><span class="id"> A</span><span class="id"> /\</span><span class="id"> measurable_fun</span><span class="id"> setT</span> (<span class="id">phi</span><span class="id"> A</span>)<span class="id">]</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> xsection_ndseq_closed</span><span class="id"> :</span><span class="id"> ndseq_closed</span><span class="id"> B</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> F</span><span class="id"> ndF;</span><span class="id"> rewrite</span><span class="id"> /B</span><span class="id"> /=</span><span class="id"> =&gt;</span><span class="id"> BF;</span><span class="id"> split</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> bigcupT_measurable</span><span class="id"> =&gt;</span><span class="id"> n;</span><span class="id"> have</span><span class="id"> []</span><span class="id"> :=</span><span class="id"> BF</span><span class="id"> n</span>.<br/>
<span class="id">have</span><span class="id"> phiF</span><span class="id"> x</span><span class="id"> :</span><span class="id"> phi</span> (<span class="id">F</span><span class="id"> i</span>)<span class="id"> x</span><span class="id"> @[i</span><span class="id"> \oo]</span><span class="id"> --&gt;</span><span class="id"> phi</span> (<span class="id">\bigcup_i</span><span class="id"> F</span><span class="id"> i</span>)<span class="id"> x</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> /phi</span><span class="id"> /=</span><span class="id"> xsection_bigcup;</span><span class="id"> apply:</span><span class="id"> nondecreasing_cvg_mu</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> n;</span><span class="id"> apply:</span><span class="id"> measurable_xsection;</span><span class="id"> case:</span> (<span class="id">BF</span><span class="id"> n</span>).<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> bigcupT_measurable</span><span class="id"> =&gt;</span><span class="id"> i;</span><span class="id"> apply:</span><span class="id"> measurable_xsection;</span><span class="id"> case:</span> (<span class="id">BF</span><span class="id"> i</span>).<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> m</span><span class="id"> n</span><span class="id"> mn;</span><span class="id"> exact/subsetPset/le_xsection/subsetPset/ndF</span>.<br/>
<span class="id">apply:</span> (<span class="id">emeasurable_fun_cvg</span> (<span class="id">phi</span><span class="id"> \o</span><span class="id"> F</span>))<span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> i;</span><span class="id"> have</span><span class="id"> []</span><span class="id"> :=</span><span class="id"> BF</span><span class="id"> i</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> _;</span><span class="id"> exact:</span><span class="id"> phiF</span>.<br/>
Qed.</div></details>
<span class="vernacular">End</span><span class="id"> xsection</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> ysection</span>.<br/>
<span class="vernacular">Variable</span><span class="id"> m1</span><span class="id"> :</span><span class="id"> {measure</span><span class="id"> set</span><span class="id"> T1</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R}</span>.<br/>
<span class="vernacular">Let</span><span class="id"> psi</span><span class="id"> A</span><span class="id"> :=</span><span class="id"> m1</span><span class="id"> \o</span><span class="id"> ysection</span><span class="id"> A</span>.<br/>
<span class="vernacular">Let</span><span class="id"> B</span><span class="id"> :=</span><span class="id"> [set</span><span class="id"> A</span><span class="id"> |</span><span class="id"> measurable</span><span class="id"> A</span><span class="id"> /\</span><span class="id"> measurable_fun</span><span class="id"> setT</span> (<span class="id">psi</span><span class="id"> A</span>)<span class="id">]</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> ysection_ndseq_closed</span><span class="id"> :</span><span class="id"> ndseq_closed</span><span class="id"> B</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> F</span><span class="id"> ndF;</span><span class="id"> rewrite</span><span class="id"> /B</span><span class="id"> /=</span><span class="id"> =&gt;</span><span class="id"> BF;</span><span class="id"> split</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> bigcupT_measurable</span><span class="id"> =&gt;</span><span class="id"> n;</span><span class="id"> have</span><span class="id"> []</span><span class="id"> :=</span><span class="id"> BF</span><span class="id"> n</span>.<br/>
<span class="id">have</span><span class="id"> psiF</span><span class="id"> x</span><span class="id"> :</span><span class="id"> psi</span> (<span class="id">F</span><span class="id"> i</span>)<span class="id"> x</span><span class="id"> @[i</span><span class="id"> \oo]</span><span class="id"> --&gt;</span><span class="id"> psi</span> (<span class="id">\bigcup_i</span><span class="id"> F</span><span class="id"> i</span>)<span class="id"> x</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> /psi</span><span class="id"> /=</span><span class="id"> ysection_bigcup;</span><span class="id"> apply:</span><span class="id"> nondecreasing_cvg_mu</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> n;</span><span class="id"> apply:</span><span class="id"> measurable_ysection;</span><span class="id"> case:</span> (<span class="id">BF</span><span class="id"> n</span>).<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> bigcupT_measurable</span><span class="id"> =&gt;</span><span class="id"> i;</span><span class="id"> apply:</span><span class="id"> measurable_ysection;</span><span class="id"> case:</span> (<span class="id">BF</span><span class="id"> i</span>).<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> m</span><span class="id"> n</span><span class="id"> mn;</span><span class="id"> exact/subsetPset/le_ysection/subsetPset/ndF</span>.<br/>
<span class="id">apply:</span> (<span class="id">emeasurable_fun_cvg</span> (<span class="id">psi</span><span class="id"> \o</span><span class="id"> F</span>))<span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> i;</span><span class="id"> have</span><span class="id"> []</span><span class="id"> :=</span><span class="id"> BF</span><span class="id"> i</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> _;</span><span class="id"> exact:</span><span class="id"> psiF</span>.<br/>
Qed.</div></details>
<span class="vernacular">End</span><span class="id"> ysection</span>.<br/>
<br/>
<span class="vernacular">End</span><span class="id"> ndseq_closed_B</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> measurable_prod_subset</span>.<br/>
<span class="vernacular">Context</span><span class="id"> d1</span><span class="id"> d2</span> (<span class="id">T1</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d1</span>) (<span class="id">T2</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d2</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>).<br/>
<span class="vernacular">Implicit</span><span class="id"> Types</span><span class="id"> A</span><span class="id"> :</span><span class="id"> set</span> (<span class="id">T1</span><span class="id"> *</span><span class="id"> T2</span>).<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> xsection</span>.<br/>
<span class="vernacular">Variable</span> (<span class="id">m2</span><span class="id"> :</span><span class="id"> {measure</span><span class="id"> set</span><span class="id"> T2</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R}</span>) (<span class="id">D</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T2</span>) (<span class="id">mD</span><span class="id"> :</span><span class="id"> measurable</span><span class="id"> D</span>).<br/>
<span class="vernacular">Let</span><span class="id"> m2D</span><span class="id"> :=</span><span class="id"> mrestr</span><span class="id"> m2</span><span class="id"> mD</span>.<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> Measure</span>.<span class="id">on</span><span class="id"> m2D</span>.<br/>
<span class="vernacular">Let</span><span class="id"> phi</span><span class="id"> A</span><span class="id"> :=</span><span class="id"> m2D</span><span class="id"> \o</span><span class="id"> xsection</span><span class="id"> A</span>.<br/>
<span class="vernacular">Let</span><span class="id"> B</span><span class="id"> :=</span><span class="id"> [set</span><span class="id"> A</span><span class="id"> |</span><span class="id"> measurable</span><span class="id"> A</span><span class="id"> /\</span><span class="id"> measurable_fun</span><span class="id"> setT</span> (<span class="id">phi</span><span class="id"> A</span>)<span class="id">]</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> measurable_prod_subset_xsection</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">m2D_bounded</span><span class="id"> :</span><span class="gallina-kwd"> exists</span><span class="id"> M,</span><span class="gallina-kwd"> forall</span><span class="id"> X,</span><span class="id"> measurable</span><span class="id"> X</span><span class="id"> -&gt;</span> (<span class="id">m2D</span><span class="id"> X</span><span class="id"> &lt;</span><span class="id"> M%:E</span>)<span class="id">%E</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">measurable</span><span class="id"> `&lt;=`</span><span class="id"> B</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> measurable_prod_measurableType</span>.<br/>
<span class="id">set</span><span class="id"> C</span><span class="id"> :=</span><span class="id"> [set</span><span class="id"> A1</span><span class="id"> `*`</span><span class="id"> A2</span><span class="id"> |</span><span class="id"> A1</span><span class="gallina-kwd"> in</span><span class="id"> measurable</span><span class="id"> &amp;</span><span class="id"> A2</span><span class="gallina-kwd"> in</span><span class="id"> measurable]</span>.<br/>
<span class="id">have</span><span class="id"> CI</span><span class="id"> :</span><span class="id"> setI_closed</span><span class="id"> C</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> X</span><span class="id"> Y</span><span class="id"> [X1</span><span class="id"> mX1</span><span class="id"> [X2</span><span class="id"> mX2</span><span class="id"> &lt;-{X}]]</span><span class="id"> [Y1</span><span class="id"> mY1</span><span class="id"> [Y2</span><span class="id"> mY2</span><span class="id"> &lt;-{Y}]]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">exists</span> (<span class="id">X1</span><span class="id"> `&amp;`</span><span class="id"> Y1</span>)<span class="id">;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> measurableI</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="gallina-kwd"> exists</span> (<span class="id">X2</span><span class="id"> `&amp;`</span><span class="id"> Y2</span>)<span class="id">;</span><span class="id"> [exact:</span><span class="id"> measurableI|rewrite</span><span class="id"> setXI]</span>.<br/>
<span class="id">have</span><span class="id"> CT</span><span class="id"> :</span><span class="id"> C</span><span class="id"> setT</span><span class="gallina-kwd"> by</span><span class="gallina-kwd"> exists</span><span class="id"> setT</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="gallina-kwd"> exists</span><span class="id"> setT</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> rewrite</span><span class="id"> setXTT</span>.<br/>
<span class="id">have</span><span class="id"> CB</span><span class="id"> :</span><span class="id"> C</span><span class="id"> `&lt;=`</span><span class="id"> B</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> X</span><span class="id"> [X1</span><span class="id"> mX1</span><span class="id"> [X2</span><span class="id"> mX2</span><span class="id"> &lt;-{X}]];</span><span class="id"> split;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> measurableX</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> -&gt;</span><span class="id"> :</span><span class="id"> phi</span> (<span class="id">X1</span><span class="id"> `*`</span><span class="id"> X2</span>)<span class="id"> =</span> (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> m2D</span><span class="id"> X2</span><span class="id"> *</span> (<span class="id">\1_X1</span><span class="id"> x</span>)<span class="id">%:E</span>)<span class="id">%E</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> funeqE</span><span class="id"> =&gt;</span><span class="id"> x;</span><span class="id"> rewrite</span><span class="id"> indicE</span><span class="id"> /phi</span><span class="id"> /m2/=</span><span class="id"> /mrestr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">have</span><span class="id"> [xX1|xX1]</span><span class="id"> :=</span><span class="id"> boolP</span> (<span class="id">x</span><span class="id"> \in</span><span class="id"> X1</span>)<span class="id">;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> mule1</span><span class="id"> in_xsectionX</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> mule0</span><span class="id"> notin_xsectionX//</span><span class="id"> set0I</span><span class="id"> measure0</span>.<br/>
&nbsp;&nbsp;<span class="id">exact/measurable_funeM/measurable_EFinP</span>.<br/>
<span class="id">suff</span><span class="id"> lsystemB</span><span class="id"> :</span><span class="id"> lambda_system</span><span class="id"> setT</span><span class="id"> B</span><span class="gallina-kwd"> by</span><span class="id"> exact:</span><span class="id"> lambda_system_subset</span>.<br/>
<span class="id">split</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> [exact:</span><span class="id"> CB|</span><span class="id"> |exact:</span><span class="id"> xsection_ndseq_closed]</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> X</span><span class="id"> Y</span><span class="id"> XY</span><span class="id"> [mX</span><span class="id"> mphiX]</span><span class="id"> [mY</span><span class="id"> mphiY];</span><span class="id"> split;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> measurableD</span>.<br/>
<span class="id">have</span><span class="id"> -&gt;</span><span class="id"> :</span><span class="id"> phi</span> (<span class="id">X</span><span class="id"> `\`</span><span class="id"> Y</span>)<span class="id"> =</span> (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> phi</span><span class="id"> X</span><span class="id"> x</span><span class="id"> -</span><span class="id"> phi</span><span class="id"> Y</span><span class="id"> x</span>)<span class="id">%E</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> funeqE</span><span class="id"> =&gt;</span><span class="id"> x;</span><span class="id"> rewrite</span><span class="id"> /phi/=</span><span class="id"> xsectionD//</span><span class="id"> /m2D</span><span class="id"> measureD</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> setIidr//;</span><span class="id"> exact:</span><span class="id"> le_xsection</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> exact:</span><span class="id"> measurable_xsection</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> exact:</span><span class="id"> measurable_xsection</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> move:</span><span class="id"> m2D_bounded</span><span class="id"> =&gt;</span><span class="id"> [M</span><span class="id"> m2M]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> (<span class="id">lt_le_trans</span> (<span class="id">m2M</span> (<span class="id">xsection</span><span class="id"> X</span><span class="id"> x</span>)<span class="id"> _</span>))<span class="id">//</span><span class="id"> ?leey//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> measurable_xsection</span>.<br/>
<span class="id">exact:</span><span class="id"> emeasurable_funB</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> xsection</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> ysection</span>.<br/>
<span class="vernacular">Variable</span> (<span class="id">m1</span><span class="id"> :</span><span class="id"> {measure</span><span class="id"> set</span><span class="id"> T1</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R}</span>) (<span class="id">D</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T1</span>) (<span class="id">mD</span><span class="id"> :</span><span class="id"> measurable</span><span class="id"> D</span>).<br/>
<span class="vernacular">Let</span><span class="id"> m1D</span><span class="id"> :=</span><span class="id"> mrestr</span><span class="id"> m1</span><span class="id"> mD</span>.<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> Measure</span>.<span class="id">on</span><span class="id"> m1D</span>.<br/>
<span class="vernacular">Let</span><span class="id"> psi</span><span class="id"> A</span><span class="id"> :=</span><span class="id"> m1D</span><span class="id"> \o</span><span class="id"> ysection</span><span class="id"> A</span>.<br/>
<span class="vernacular">Let</span><span class="id"> B</span><span class="id"> :=</span><span class="id"> [set</span><span class="id"> A</span><span class="id"> |</span><span class="id"> measurable</span><span class="id"> A</span><span class="id"> /\</span><span class="id"> measurable_fun</span><span class="id"> setT</span> (<span class="id">psi</span><span class="id"> A</span>)<span class="id">]</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> measurable_prod_subset_ysection</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">m1_bounded</span><span class="id"> :</span><span class="gallina-kwd"> exists</span><span class="id"> M,</span><span class="gallina-kwd"> forall</span><span class="id"> X,</span><span class="id"> measurable</span><span class="id"> X</span><span class="id"> -&gt;</span> (<span class="id">m1D</span><span class="id"> X</span><span class="id"> &lt;</span><span class="id"> M%:E</span>)<span class="id">%E</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">measurable</span><span class="id"> `&lt;=`</span><span class="id"> B</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> measurable_prod_measurableType</span>.<br/>
<span class="id">set</span><span class="id"> C</span><span class="id"> :=</span><span class="id"> [set</span><span class="id"> A1</span><span class="id"> `*`</span><span class="id"> A2</span><span class="id"> |</span><span class="id"> A1</span><span class="gallina-kwd"> in</span><span class="id"> measurable</span><span class="id"> &amp;</span><span class="id"> A2</span><span class="gallina-kwd"> in</span><span class="id"> measurable]</span>.<br/>
<span class="id">have</span><span class="id"> CI</span><span class="id"> :</span><span class="id"> setI_closed</span><span class="id"> C</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> X</span><span class="id"> Y</span><span class="id"> [X1</span><span class="id"> mX1</span><span class="id"> [X2</span><span class="id"> mX2</span><span class="id"> &lt;-{X}]]</span><span class="id"> [Y1</span><span class="id"> mY1</span><span class="id"> [Y2</span><span class="id"> mY2</span><span class="id"> &lt;-{Y}]]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">exists</span> (<span class="id">X1</span><span class="id"> `&amp;`</span><span class="id"> Y1</span>)<span class="id">;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> measurableI</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="gallina-kwd"> exists</span> (<span class="id">X2</span><span class="id"> `&amp;`</span><span class="id"> Y2</span>)<span class="id">;</span><span class="id"> [exact:</span><span class="id"> measurableI|rewrite</span><span class="id"> setXI]</span>.<br/>
<span class="id">have</span><span class="id"> CT</span><span class="id"> :</span><span class="id"> C</span><span class="id"> setT</span><span class="gallina-kwd"> by</span><span class="gallina-kwd"> exists</span><span class="id"> setT</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="gallina-kwd"> exists</span><span class="id"> setT</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> rewrite</span><span class="id"> setXTT</span>.<br/>
<span class="id">have</span><span class="id"> CB</span><span class="id"> :</span><span class="id"> C</span><span class="id"> `&lt;=`</span><span class="id"> B</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> X</span><span class="id"> [X1</span><span class="id"> mX1</span><span class="id"> [X2</span><span class="id"> mX2</span><span class="id"> &lt;-{X}]];</span><span class="id"> split;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> measurableX</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> -&gt;</span><span class="id"> :</span><span class="id"> psi</span> (<span class="id">X1</span><span class="id"> `*`</span><span class="id"> X2</span>)<span class="id"> =</span> (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> m1D</span><span class="id"> X1</span><span class="id"> *</span> (<span class="id">\1_X2</span><span class="id"> x</span>)<span class="id">%:E</span>)<span class="id">%E</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> funeqE</span><span class="id"> =&gt;</span><span class="id"> y;</span><span class="id"> rewrite</span><span class="id"> indicE</span><span class="id"> /psi</span><span class="id"> /m1/=</span><span class="id"> /mrestr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">have</span><span class="id"> [yX2|yX2]</span><span class="id"> :=</span><span class="id"> boolP</span> (<span class="id">y</span><span class="id"> \in</span><span class="id"> X2</span>)<span class="id">;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> mule1</span><span class="id"> in_ysectionX</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> mule0</span><span class="id"> notin_ysectionX//</span><span class="id"> set0I</span><span class="id"> measure0</span>.<br/>
&nbsp;&nbsp;<span class="id">exact/measurable_funeM/measurable_EFinP</span>.<br/>
<span class="id">suff</span><span class="id"> lsystemB</span><span class="id"> :</span><span class="id"> lambda_system</span><span class="id"> setT</span><span class="id"> B</span><span class="gallina-kwd"> by</span><span class="id"> exact:</span><span class="id"> lambda_system_subset</span>.<br/>
<span class="id">split</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> [exact:</span><span class="id"> CB|</span><span class="id"> |exact:</span><span class="id"> ysection_ndseq_closed]</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> X</span><span class="id"> Y</span><span class="id"> XY</span><span class="id"> [mX</span><span class="id"> mphiX]</span><span class="id"> [mY</span><span class="id"> mphiY];</span><span class="id"> split;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> measurableD</span>.<br/>
<span class="id">rewrite</span> (_<span class="id"> :</span><span class="id"> psi</span><span class="id"> _</span><span class="id"> =</span> (<span class="id">psi</span><span class="id"> X</span><span class="id"> \-</span><span class="id"> psi</span><span class="id"> Y</span>)<span class="id">%E</span>)<span class="id">;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> emeasurable_funB</span>.<br/>
<span class="id">rewrite</span><span class="id"> funeqE</span><span class="id"> =&gt;</span><span class="id"> y;</span><span class="id"> rewrite</span><span class="id"> /psi/=</span><span class="id"> ysectionD//</span><span class="id"> /m1D</span><span class="id"> measureD</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> setIidr//;</span><span class="id"> exact:</span><span class="id"> le_ysection</span>.<br/>
<span class="id">-</span><span class="id"> exact:</span><span class="id"> measurable_ysection</span>.<br/>
<span class="id">-</span><span class="id"> exact:</span><span class="id"> measurable_ysection</span>.<br/>
<span class="id">-</span><span class="id"> have</span><span class="id"> [M</span><span class="id"> m1M]</span><span class="id"> :=</span><span class="id"> m1_bounded</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> (<span class="id">lt_le_trans</span> (<span class="id">m1M</span> (<span class="id">ysection</span><span class="id"> X</span><span class="id"> y</span>)<span class="id"> _</span>))<span class="id">//</span><span class="id"> ?leey//</span>.<br/>
&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> measurable_ysection</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> ysection</span>.<br/>
<br/>
<span class="vernacular">End</span><span class="id"> measurable_prod_subset</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> measurable_fun_xsection</span>.<br/>
<span class="vernacular">Context</span><span class="id"> d1</span><span class="id"> d2</span> (<span class="id">T1</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d1</span>) (<span class="id">T2</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d2</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>).<br/>
<span class="vernacular">Variable</span><span class="id"> m2</span><span class="id"> :</span><span class="id"> {sigma_finite_measure</span><span class="id"> set</span><span class="id"> T2</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R}</span>.<br/>
<span class="vernacular">Implicit</span><span class="id"> Types</span><span class="id"> A</span><span class="id"> :</span><span class="id"> set</span> (<span class="id">T1</span><span class="id"> *</span><span class="id"> T2</span>).<br/>
<br/>
<span class="vernacular">Let</span><span class="id"> phi</span><span class="id"> A</span><span class="id"> :=</span><span class="id"> m2</span><span class="id"> \o</span><span class="id"> xsection</span><span class="id"> A</span>.<br/>
<span class="vernacular">Let</span><span class="id"> B</span><span class="id"> :=</span><span class="id"> [set</span><span class="id"> A</span><span class="id"> |</span><span class="id"> measurable</span><span class="id"> A</span><span class="id"> /\</span><span class="id"> measurable_fun</span><span class="id"> setT</span> (<span class="id">phi</span><span class="id"> A</span>)<span class="id">]</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> measurable_fun_xsection</span><span class="id"> A</span><span class="id"> :</span><span class="id"> measurable</span><span class="id"> A</span><span class="id"> -&gt;</span><span class="id"> measurable_fun</span><span class="id"> setT</span> (<span class="id">phi</span><span class="id"> A</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move:</span><span class="id"> A;</span><span class="id"> suff</span><span class="id"> :</span><span class="id"> measurable</span><span class="id"> `&lt;=`</span><span class="id"> B</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> +</span><span class="id"> A</span><span class="id"> =&gt;</span><span class="id"> /[apply]</span><span class="id"> -[]</span>.<br/>
<span class="id">have</span><span class="id"> /sigma_finiteP</span><span class="id"> [F</span><span class="id"> [F_T</span><span class="id"> F_nd</span><span class="id"> F_oo]]</span><span class="id"> :=</span><span class="id"> sigma_finiteT</span><span class="id"> m2</span><span class="id"> =&gt;</span><span class="id"> X</span><span class="id"> mX</span>.<br/>
<span class="id">have</span><span class="id"> -&gt;</span><span class="id"> :</span><span class="id"> X</span><span class="id"> =</span><span class="id"> \bigcup_n</span> (<span class="id">X</span><span class="id"> `&amp;`</span> (<span class="id">setT</span><span class="id"> `*`</span><span class="id"> F</span><span class="id"> n</span>)).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -setI_bigcupr</span><span class="id"> -setX_bigcupr</span><span class="id"> -F_T</span><span class="id"> setXTT</span><span class="id"> setIT</span>.<br/>
<span class="id">apply:</span><span class="id"> xsection_ndseq_closed</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> m</span><span class="id"> n</span><span class="id"> mn;</span><span class="id"> apply/subsetPset;</span><span class="id"> apply:</span><span class="id"> setIS;</span><span class="id"> apply:</span><span class="id"> setSX</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="id">exact/subsetPset/F_nd</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> n;</span><span class="id"> rewrite</span><span class="id"> -/B;</span><span class="id"> have</span><span class="id"> [?</span><span class="id"> ?]</span><span class="id"> :=</span><span class="id"> F_oo</span><span class="id"> n</span>.<br/>
<span class="id">pose</span><span class="id"> m2Fn</span><span class="id"> :=</span><span class="id"> mrestr</span><span class="id"> m2</span> (<span class="id">F_oo</span><span class="id"> n</span>).<span class="id">1</span>.<br/>
<span class="id">have</span><span class="id"> m2Fn_bounded</span><span class="id"> :</span><span class="gallina-kwd"> exists</span><span class="id"> M,</span><span class="gallina-kwd"> forall</span><span class="id"> X,</span><span class="id"> measurable</span><span class="id"> X</span><span class="id"> -&gt;</span> (<span class="id">m2Fn</span><span class="id"> X</span><span class="id"> &lt;</span><span class="id"> M%:E</span>)<span class="id">%E</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">exists</span> (<span class="id">fine</span> (<span class="id">m2Fn</span> (<span class="id">F</span><span class="id"> n</span>))<span class="id"> +</span><span class="id"> 1</span>)<span class="id"> =&gt;</span><span class="id"> Y</span><span class="id"> mY</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> [in</span><span class="id"> ltRHS]EFinD</span><span class="id"> lte_spadder//</span><span class="id"> fineK;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> ge0_fin_numE</span><span class="id"> ?measure_ge0//=</span><span class="id"> /m2Fn</span><span class="id"> /mrestr</span><span class="id"> setIid</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /m2Fn</span><span class="id"> /mrestr/=</span><span class="id"> setIid</span><span class="id"> le_measure//</span><span class="id"> inE//;</span><span class="id"> exact:</span><span class="id"> measurableI</span>.<br/>
<span class="id">pose</span><span class="id"> phi'</span><span class="id"> A</span><span class="id"> :=</span><span class="id"> m2Fn</span><span class="id"> \o</span><span class="id"> xsection</span><span class="id"> A</span>.<br/>
<span class="id">pose</span><span class="id"> B'</span><span class="id"> :=</span><span class="id"> [set</span><span class="id"> A</span><span class="id"> |</span><span class="id"> measurable</span><span class="id"> A</span><span class="id"> /\</span><span class="id"> measurable_fun</span><span class="id"> setT</span> (<span class="id">phi'</span><span class="id"> A</span>)<span class="id">]</span>.<br/>
<span class="id">have</span><span class="id"> subset_B'</span><span class="id"> :</span><span class="id"> measurable</span><span class="id"> `&lt;=`</span><span class="id"> B'</span><span class="gallina-kwd"> by</span><span class="id"> exact:</span><span class="id"> measurable_prod_subset_xsection</span>.<br/>
<span class="id">split=&gt;</span><span class="id"> [|_</span><span class="id"> Y</span><span class="id"> mY];</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> measurableI</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> measurableX</span>.<br/>
<span class="id">have</span><span class="id"> [_</span><span class="id"> /</span>(_<span class="id"> measurableT</span><span class="id"> Y</span><span class="id"> mY</span>)<span class="id">]</span><span class="id"> :=</span><span class="id"> subset_B'</span><span class="id"> X</span><span class="id"> mX</span>.<br/>
<span class="id">have</span><span class="id"> -&gt;//</span><span class="id"> :</span><span class="id"> phi'</span><span class="id"> X</span><span class="id"> =</span><span class="id"> m2</span><span class="id"> \o</span><span class="id"> xsection</span> (<span class="id">X</span><span class="id"> `&amp;`</span><span class="id"> setT</span><span class="id"> `*`</span><span class="id"> F</span><span class="id"> n</span>).<br/>
<span class="gallina-kwd">by</span><span class="id"> apply/funext</span><span class="id"> =&gt;</span><span class="id"> x/=;</span><span class="id"> rewrite</span><span class="id"> /phi'</span><span class="id"> setTX</span><span class="id"> xsectionI</span><span class="id"> xsection_preimage_snd</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> measurable_fun_xsection</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> measurable_fun_ysection</span>.<br/>
<span class="vernacular">Context</span><span class="id"> d1</span><span class="id"> d2</span> (<span class="id">T1</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d1</span>) (<span class="id">T2</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d2</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>).<br/>
<span class="vernacular">Variable</span><span class="id"> m1</span><span class="id"> :</span><span class="id"> {sigma_finite_measure</span><span class="id"> set</span><span class="id"> T1</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R}</span>.<br/>
<span class="vernacular">Implicit</span><span class="id"> Types</span><span class="id"> A</span><span class="id"> :</span><span class="id"> set</span> (<span class="id">T1</span><span class="id"> *</span><span class="id"> T2</span>).<br/>
<br/>
<span class="vernacular">Let</span><span class="id"> phi</span><span class="id"> A</span><span class="id"> :=</span><span class="id"> m1</span><span class="id"> \o</span><span class="id"> ysection</span><span class="id"> A</span>.<br/>
<span class="vernacular">Let</span><span class="id"> B</span><span class="id"> :=</span><span class="id"> [set</span><span class="id"> A</span><span class="id"> |</span><span class="id"> measurable</span><span class="id"> A</span><span class="id"> /\</span><span class="id"> measurable_fun</span><span class="id"> setT</span> (<span class="id">phi</span><span class="id"> A</span>)<span class="id">]</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> measurable_fun_ysection</span><span class="id"> A</span><span class="id"> :</span><span class="id"> measurable</span><span class="id"> A</span><span class="id"> -&gt;</span><span class="id"> measurable_fun</span><span class="id"> setT</span> (<span class="id">phi</span><span class="id"> A</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move:</span><span class="id"> A;</span><span class="id"> suff</span><span class="id"> :</span><span class="id"> measurable</span><span class="id"> `&lt;=`</span><span class="id"> B</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> +</span><span class="id"> A</span><span class="id"> =&gt;</span><span class="id"> /[apply]</span><span class="id"> -[]</span>.<br/>
<span class="id">have</span><span class="id"> /sigma_finiteP[F</span><span class="id"> [F_T</span><span class="id"> F_nd</span><span class="id"> F_oo]]</span><span class="id"> :=</span><span class="id"> sigma_finiteT</span><span class="id"> m1</span><span class="id"> =&gt;</span><span class="id"> X</span><span class="id"> mX</span>.<br/>
<span class="id">have</span><span class="id"> -&gt;</span><span class="id"> :</span><span class="id"> X</span><span class="id"> =</span><span class="id"> \bigcup_n</span> (<span class="id">X</span><span class="id"> `&amp;`</span> (<span class="id">F</span><span class="id"> n</span><span class="id"> `*`</span><span class="id"> setT</span>)).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -setI_bigcupr</span><span class="id"> -setX_bigcupl</span><span class="id"> -F_T</span><span class="id"> setXTT</span><span class="id"> setIT</span>.<br/>
<span class="id">apply:</span><span class="id"> ysection_ndseq_closed</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> m</span><span class="id"> n</span><span class="id"> mn;</span><span class="id"> apply/subsetPset;</span><span class="id"> apply:</span><span class="id"> setIS;</span><span class="id"> apply:</span><span class="id"> setSX</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="id">exact/subsetPset/F_nd</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> n;</span><span class="id"> have</span><span class="id"> [?</span><span class="id"> ?]</span><span class="id"> :=</span><span class="id"> F_oo</span><span class="id"> n;</span><span class="id"> rewrite</span><span class="id"> -/B</span>.<br/>
<span class="id">pose</span><span class="id"> m1Fn</span><span class="id"> :=</span><span class="id"> mrestr</span><span class="id"> m1</span> (<span class="id">F_oo</span><span class="id"> n</span>).<span class="id">1</span>.<br/>
<span class="id">have</span><span class="id"> m1Fn_bounded</span><span class="id"> :</span><span class="gallina-kwd"> exists</span><span class="id"> M,</span><span class="gallina-kwd"> forall</span><span class="id"> X,</span><span class="id"> measurable</span><span class="id"> X</span><span class="id"> -&gt;</span> (<span class="id">m1Fn</span><span class="id"> X</span><span class="id"> &lt;</span><span class="id"> M%:E</span>)<span class="id">%E</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">exists</span> (<span class="id">fine</span> (<span class="id">m1Fn</span> (<span class="id">F</span><span class="id"> n</span>))<span class="id"> +</span><span class="id"> 1</span>)<span class="id"> =&gt;</span><span class="id"> Y</span><span class="id"> mY</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> [in</span><span class="id"> ltRHS]EFinD</span><span class="id"> lte_spadder//</span><span class="id"> fineK;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> ge0_fin_numE</span><span class="id"> ?measure_ge0//</span><span class="id"> /m1Fn/=</span><span class="id"> /mrestr</span><span class="id"> setIid</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /m1Fn/=</span><span class="id"> /mrestr</span><span class="id"> setIid</span><span class="id"> le_measure//</span><span class="id"> inE//=;</span><span class="id"> exact:</span><span class="id"> measurableI</span>.<br/>
<span class="id">pose</span><span class="id"> psi'</span><span class="id"> A</span><span class="id"> :=</span><span class="id"> m1Fn</span><span class="id"> \o</span><span class="id"> ysection</span><span class="id"> A</span>.<br/>
<span class="id">pose</span><span class="id"> B'</span><span class="id"> :=</span><span class="id"> [set</span><span class="id"> A</span><span class="id"> |</span><span class="id"> measurable</span><span class="id"> A</span><span class="id"> /\</span><span class="id"> measurable_fun</span><span class="id"> setT</span> (<span class="id">psi'</span><span class="id"> A</span>)<span class="id">]</span>.<br/>
<span class="id">have</span><span class="id"> subset_B'</span><span class="id"> :</span><span class="id"> measurable</span><span class="id"> `&lt;=`</span><span class="id"> B'</span><span class="gallina-kwd"> by</span><span class="id"> exact:</span><span class="id"> measurable_prod_subset_ysection</span>.<br/>
<span class="id">split=&gt;</span><span class="id"> [|_</span><span class="id"> Y</span><span class="id"> mY];</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> measurableI</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> measurableX</span>.<br/>
<span class="id">have</span><span class="id"> [_</span><span class="id"> /</span>(_<span class="id"> measurableT</span><span class="id"> Y</span><span class="id"> mY</span>)<span class="id">]</span><span class="id"> :=</span><span class="id"> subset_B'</span><span class="id"> X</span><span class="id"> mX</span>.<br/>
<span class="id">have</span><span class="id"> -&gt;//</span><span class="id"> :</span><span class="id"> psi'</span><span class="id"> X</span><span class="id"> =</span><span class="id"> m1</span><span class="id"> \o</span> (<span class="id">ysection</span> (<span class="id">X</span><span class="id"> `&amp;`</span><span class="id"> F</span><span class="id"> n</span><span class="id"> `*`</span><span class="id"> setT</span>)).<br/>
<span class="gallina-kwd">by</span><span class="id"> apply/funext</span><span class="id"> =&gt;</span><span class="id"> y/=;</span><span class="id"> rewrite</span><span class="id"> /psi'</span><span class="id"> setXT</span><span class="id"> ysectionI//</span><span class="id"> ysection_preimage_fst</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> measurable_fun_ysection</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> product_measures</span>.<br/>
<span class="vernacular">Context</span><span class="id"> d1</span><span class="id"> d2</span> (<span class="id">T1</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d1</span>) (<span class="id">T2</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d2</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>).<br/>
<span class="vernacular">Context</span> (<span class="id">m1</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T1</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>) (<span class="id">m2</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T2</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>).<br/>
<br/>
<span class="vernacular">Definition</span><span class="id"> product_measure1</span><span class="id"> :=</span> (<span class="gallina-kwd">fun</span><span class="id"> A</span><span class="id"> =&gt;</span><span class="id"> \int[m1]_x</span> (<span class="id">m2</span><span class="id"> \o</span><span class="id"> xsection</span><span class="id"> A</span>)<span class="id"> x</span>)<span class="id">%E</span>.<br/>
<span class="vernacular">Definition</span><span class="id"> product_measure2</span><span class="id"> :=</span> (<span class="gallina-kwd">fun</span><span class="id"> A</span><span class="id"> =&gt;</span><span class="id"> \int[m2]_x</span> (<span class="id">m1</span><span class="id"> \o</span><span class="id"> ysection</span><span class="id"> A</span>)<span class="id"> x</span>)<span class="id">%E</span>.<br/>
<br/>
<span class="vernacular">End</span><span class="id"> product_measures</span>.<br/>
<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;m1 '\x' m2&quot;</span><span class="id"> :=</span> (<span class="id">product_measure1</span><span class="id"> m1</span><span class="id"> m2</span>)<span class="id"> :</span><span class="id"> ereal_scope</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;m1 '\x^' m2&quot;</span><span class="id"> :=</span> (<span class="id">product_measure2</span><span class="id"> m1</span><span class="id"> m2</span>)<span class="id"> :</span><span class="id"> ereal_scope</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> product_measure1</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<span class="vernacular">Context</span><span class="id"> d1</span><span class="id"> d2</span> (<span class="id">T1</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d1</span>) (<span class="id">T2</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d2</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>).<br/>
<span class="vernacular">Variable</span><span class="id"> m1</span><span class="id"> :</span><span class="id"> {measure</span><span class="id"> set</span><span class="id"> T1</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R}</span>.<br/>
<span class="vernacular">Variable</span><span class="id"> m2</span><span class="id"> :</span><span class="id"> {sigma_finite_measure</span><span class="id"> set</span><span class="id"> T2</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R}</span>.<br/>
<span class="vernacular">Implicit</span><span class="id"> Types</span><span class="id"> A</span><span class="id"> :</span><span class="id"> set</span> (<span class="id">T1</span><span class="id"> *</span><span class="id"> T2</span>).<br/>
<br/>
<span class="vernacular">Let</span><span class="id"> pm10</span><span class="id"> :</span> (<span class="id">m1</span><span class="id"> \x</span><span class="id"> m2</span>)<span class="id"> set0</span><span class="id"> =</span><span class="id"> 0</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> [LHS]integral0_eq//</span><span class="id"> =&gt;</span><span class="id"> x/=</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> xsection0</span><span class="id"> measure0</span>. Qed.</div></details>
<br/>
<span class="vernacular">Let</span><span class="id"> pm1_ge0</span><span class="id"> A</span><span class="id"> :</span><span class="id"> 0</span><span class="id"> &lt;=</span> (<span class="id">m1</span><span class="id"> \x</span><span class="id"> m2</span>)<span class="id"> A</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> integral_ge0</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> *;</span><span class="id"> exact/measure_ge0/measurable_xsection</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Let</span><span class="id"> pm1_sigma_additive</span><span class="id"> :</span><span class="id"> semi_sigma_additive</span> (<span class="id">m1</span><span class="id"> \x</span><span class="id"> m2</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> F</span><span class="id"> mF</span><span class="id"> tF</span><span class="id"> mUF</span>.<br/>
<span class="id">rewrite</span><span class="id"> [X</span><span class="gallina-kwd"> in</span><span class="id"> _</span><span class="id"> --&gt;</span><span class="id"> X]</span>(_<span class="id"> :</span><span class="id"> _</span><span class="id"> =</span><span class="id"> \sum_</span>(<span class="id">n</span><span class="id"> &lt;oo</span>) (<span class="id">m1</span><span class="id"> \x</span><span class="id"> m2</span>) (<span class="id">F</span><span class="id"> n</span>)).<br/>
&nbsp;&nbsp;<span class="id">apply/cvg_closeP;</span><span class="id"> split;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> closeE</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> is_cvg_nneseries</span><span class="id"> =&gt;</span><span class="id"> *;</span><span class="id"> exact:</span><span class="id"> integral_ge0</span>.<br/>
<span class="id">rewrite</span><span class="id"> -integral_nneseries//;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> n;</span><span class="id"> exact:</span><span class="id"> measurable_fun_xsection</span>.<br/>
<span class="id">apply:</span><span class="id"> eq_integral</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> _;</span><span class="id"> apply/esym/cvg_lim</span><span class="id"> =&gt;</span><span class="id"> //=;</span><span class="id"> rewrite</span><span class="id"> xsection_bigcup</span>.<br/>
<span class="id">apply:</span> (<span class="id">measure_sigma_additive</span><span class="id"> _</span> (<span class="id">trivIset_xsection</span><span class="id"> tF</span>))<span class="id"> =&gt;</span><span class="id"> ?</span>.<br/>
<span class="id">exact:</span><span class="id"> measurable_xsection</span>.<br/>
Qed.</div></details>
<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> isMeasure</span>.<span class="id">Build</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">m1</span><span class="id"> \x</span><span class="id"> m2</span>)<br/>
&nbsp;&nbsp;<span class="id">pm10</span><span class="id"> pm1_ge0</span><span class="id"> pm1_sigma_additive</span>.<br/>
<br/>
<span class="vernacular">End</span><span class="id"> product_measure1</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> product_measure1E</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<span class="vernacular">Context</span><span class="id"> d1</span><span class="id"> d2</span> (<span class="id">T1</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d1</span>) (<span class="id">T2</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d2</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>).<br/>
<span class="vernacular">Variable</span><span class="id"> m1</span><span class="id"> :</span><span class="id"> {measure</span><span class="id"> set</span><span class="id"> T1</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R}</span>.<br/>
<span class="vernacular">Variable</span><span class="id"> m2</span><span class="id"> :</span><span class="id"> {sigma_finite_measure</span><span class="id"> set</span><span class="id"> T2</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R}</span>.<br/>
<span class="vernacular">Implicit</span><span class="id"> Types</span><span class="id"> A</span><span class="id"> :</span><span class="id"> set</span> (<span class="id">T1</span><span class="id"> *</span><span class="id"> T2</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> product_measure1E</span> (<span class="id">A1</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T1</span>) (<span class="id">A2</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T2</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">measurable</span><span class="id"> A1</span><span class="id"> -&gt;</span><span class="id"> measurable</span><span class="id"> A2</span><span class="id"> -&gt;</span> (<span class="id">m1</span><span class="id"> \x</span><span class="id"> m2</span>) (<span class="id">A1</span><span class="id"> `*`</span><span class="id"> A2</span>)<span class="id"> =</span><span class="id"> m1</span><span class="id"> A1</span><span class="id"> *</span><span class="id"> m2</span><span class="id"> A2</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> mA1</span><span class="id"> mA2</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> /product_measure1</span><span class="id"> /=</span>.<br/>
<span class="id">rewrite</span> (<span class="id">eq_integral</span> (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> =&gt;</span> (<span class="id">\1_A1</span><span class="id"> x</span>)<span class="id">%:E</span><span class="id"> *</span><span class="id"> m2</span><span class="id"> A2</span>))<span class="id">;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> indicE;</span><span class="id"> have</span><span class="id"> [xA1|xA1]</span><span class="id"> /=</span><span class="id"> :=</span><span class="id"> boolP</span> (<span class="id">x</span><span class="id"> \in</span><span class="id"> A1</span>)<span class="id">;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">[rewrite</span><span class="id"> in_xsectionX//</span><span class="id"> mul1e|rewrite</span><span class="id"> mul0e</span><span class="id"> notin_xsectionX]</span>.<br/>
<span class="id">rewrite</span><span class="id"> ge0_integralZr//;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> lee_fin</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> integral_indic//</span><span class="id"> setIT</span>.<br/>
<span class="id">-</span><span class="id"> exact:</span><span class="id"> measurableT_comp</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> product_measure1E</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> product_measure_unique</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<span class="vernacular">Context</span><span class="id"> d1</span><span class="id"> d2</span> (<span class="id">T1</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d1</span>) (<span class="id">T2</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d2</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>).<br/>
<span class="vernacular">Variable</span><span class="id"> m1</span><span class="id"> :</span><span class="id"> {sigma_finite_measure</span><span class="id"> set</span><span class="id"> T1</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R}</span>.<br/>
<span class="vernacular">Variable</span><span class="id"> m2</span><span class="id"> :</span><span class="id"> {sigma_finite_measure</span><span class="id"> set</span><span class="id"> T2</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R}</span>.<br/>
<br/>
<span class="vernacular">Let</span><span class="id"> product_measure_sigma_finite</span><span class="id"> :</span><span class="id"> sigma_finite</span><span class="id"> setT</span> (<span class="id">m1</span><span class="id"> \x</span><span class="id"> m2</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">have</span><span class="id"> /sigma_finiteP[F</span><span class="id"> [TF</span><span class="id"> ndF</span><span class="id"> Foo]]</span><span class="id"> :=</span><span class="id"> sigma_finiteT</span><span class="id"> m1</span>.<br/>
<span class="id">have</span><span class="id"> /sigma_finiteP[G</span><span class="id"> [TG</span><span class="id"> ndG</span><span class="id"> Goo]]</span><span class="id"> :=</span><span class="id"> sigma_finiteT</span><span class="id"> m2</span>.<br/>
<span class="gallina-kwd">exists</span> (<span class="gallina-kwd">fun</span><span class="id"> n</span><span class="id"> =&gt;</span><span class="id"> F</span><span class="id"> n</span><span class="id"> `*`</span><span class="id"> G</span><span class="id"> n</span>).<br/>
&nbsp;<span class="id">rewrite</span><span class="id"> -setXTT</span><span class="id"> TF</span><span class="id"> TG</span><span class="id"> predeqE</span><span class="id"> =&gt;</span><span class="id"> -[x</span><span class="id"> y];</span><span class="id"> split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> [/=</span><span class="id"> [n</span><span class="id"> _</span><span class="id"> Fnx]</span><span class="id"> [k</span><span class="id"> _</span><span class="id"> Gky]];</span><span class="gallina-kwd"> exists</span> (<span class="id">maxn</span><span class="id"> n</span><span class="id"> k</span>)<span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move:</span><span class="id"> x</span><span class="id"> Fnx;</span><span class="id"> exact/subsetPset/ndF/leq_maxl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move:</span><span class="id"> y</span><span class="id"> Gky;</span><span class="id"> exact/subsetPset/ndG/leq_maxr</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> [n</span><span class="id"> _</span><span class="id"> []/=</span><span class="id"> ?</span><span class="id"> ?];</span><span class="id"> split;</span><span class="gallina-kwd"> exists</span><span class="id"> n</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> k;</span><span class="id"> have</span><span class="id"> [?</span><span class="id"> ?]</span><span class="id"> :=</span><span class="id"> Foo</span><span class="id"> k;</span><span class="id"> have</span><span class="id"> [?</span><span class="id"> ?]</span><span class="id"> :=</span><span class="id"> Goo</span><span class="id"> k</span>.<br/>
<span class="id">split;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> measurableX</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> product_measure1E//</span><span class="id"> lte_mul_pinfty//</span><span class="id"> ge0_fin_numE</span>.<br/>
Qed.</div></details>
<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> Measure_isSigmaFinite</span>.<span class="id">Build</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">m1</span><span class="id"> \x</span><span class="id"> m2</span>)<br/>
&nbsp;&nbsp;<span class="id">product_measure_sigma_finite</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> product_measure_unique</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">m'</span><span class="id"> :</span><span class="id"> {measure</span><span class="id"> set</span><span class="id"> [the</span><span class="id"> semiRingOfSetsType</span><span class="id"> _</span><span class="id"> of</span><span class="id"> T1</span><span class="id"> *</span><span class="id"> T2]</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R}</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="gallina-kwd">forall</span><span class="id"> A1</span><span class="id"> A2,</span><span class="id"> measurable</span><span class="id"> A1</span><span class="id"> -&gt;</span><span class="id"> measurable</span><span class="id"> A2</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">m'</span> (<span class="id">A1</span><span class="id"> `*`</span><span class="id"> A2</span>)<span class="id"> =</span><span class="id"> m1</span><span class="id"> A1</span><span class="id"> *</span><span class="id"> m2</span><span class="id"> A2</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">forall</span><span class="id"> X</span><span class="id"> :</span><span class="id"> set</span> (<span class="id">T1</span><span class="id"> *</span><span class="id"> T2</span>)<span class="id">,</span><span class="id"> measurable</span><span class="id"> X</span><span class="id"> -&gt;</span> (<span class="id">m1</span><span class="id"> \x</span><span class="id"> m2</span>)<span class="id"> X</span><span class="id"> =</span><span class="id"> m'</span><span class="id"> X</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> m'E</span>.<br/>
<span class="id">have</span><span class="id"> /sigma_finiteP[F</span><span class="id"> [TF</span><span class="id"> ndF</span><span class="id"> Foo]]</span><span class="id"> :=</span><span class="id"> sigma_finiteT</span><span class="id"> m1</span>.<br/>
<span class="id">have</span><span class="id"> /sigma_finiteP[G</span><span class="id"> [TG</span><span class="id"> ndG</span><span class="id"> Goo]]</span><span class="id"> :=</span><span class="id"> sigma_finiteT</span><span class="id"> m2</span>.<br/>
<span class="id">have</span><span class="id"> UFGT</span><span class="id"> :</span><span class="id"> \bigcup_k</span> (<span class="id">F</span><span class="id"> k</span><span class="id"> `*`</span><span class="id"> G</span><span class="id"> k</span>)<span class="id"> =</span><span class="id"> setT</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -setXTT</span><span class="id"> TF</span><span class="id"> TG</span><span class="id"> predeqE</span><span class="id"> =&gt;</span><span class="id"> -[x</span><span class="id"> y];</span><span class="id"> split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> [n</span><span class="id"> _</span><span class="id"> []/=</span><span class="id"> ?</span><span class="id"> ?];</span><span class="id"> split;</span><span class="gallina-kwd"> exists</span><span class="id"> n</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> [/=</span><span class="id"> [n</span><span class="id"> _</span><span class="id"> Fnx]</span><span class="id"> [k</span><span class="id"> _</span><span class="id"> Gky]];</span><span class="gallina-kwd"> exists</span> (<span class="id">maxn</span><span class="id"> n</span><span class="id"> k</span>)<span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> split</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move:</span><span class="id"> x</span><span class="id"> Fnx;</span><span class="id"> exact/subsetPset/ndF/leq_maxl</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move:</span><span class="id"> y</span><span class="id"> Gky;</span><span class="id"> exact/subsetPset/ndG/leq_maxr</span>.<br/>
<span class="id">pose</span><span class="id"> C</span><span class="id"> :</span><span class="id"> set</span> (<span class="id">set</span> (<span class="id">T1</span><span class="id"> *</span><span class="id"> T2</span>))<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">[set</span><span class="id"> C</span><span class="id"> |</span><span class="gallina-kwd"> exists</span><span class="id"> A,</span><span class="id"> measurable</span><span class="id"> A</span><span class="id"> /\</span><span class="gallina-kwd"> exists</span><span class="id"> B,</span><span class="id"> measurable</span><span class="id"> B</span><span class="id"> /\</span><span class="id"> C</span><span class="id"> =</span><span class="id"> A</span><span class="id"> `*`</span><span class="id"> B]</span>.<br/>
<span class="id">have</span><span class="id"> CI</span><span class="id"> :</span><span class="id"> setI_closed</span><span class="id"> C</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> /=</span><span class="id"> _</span><span class="id"> _</span><span class="id"> [X1</span><span class="id"> [mX1</span><span class="id"> [X2</span><span class="id"> [mX2</span><span class="id"> -&gt;]]]]</span><span class="id"> [Y1</span><span class="id"> [mY1</span><span class="id"> [Y2</span><span class="id"> [mY2</span><span class="id"> -&gt;]]]]</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -setXI;</span><span class="gallina-kwd"> exists</span> (<span class="id">X1</span><span class="id"> `&amp;`</span><span class="id"> Y1</span>)<span class="id">;</span><span class="id"> split;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> measurableI</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="gallina-kwd"> exists</span> (<span class="id">X2</span><span class="id"> `&amp;`</span><span class="id"> Y2</span>)<span class="id">;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> measurableI</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> X</span><span class="id"> mX;</span><span class="id"> apply:</span> (<span class="id">measure_unique</span><span class="id"> C</span> (<span class="gallina-kwd">fun</span><span class="id"> n</span><span class="id"> =&gt;</span><span class="id"> F</span><span class="id"> n</span><span class="id"> `*`</span><span class="id"> G</span><span class="id"> n</span>))<span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
<span class="id">-</span><span class="id"> rewrite</span><span class="id"> measurable_prod_measurableType</span><span class="id"> //;</span><span class="id"> congr</span> (<span class="id">&lt;&lt;s</span><span class="id"> _</span><span class="id"> &gt;&gt;</span>).<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> predeqE;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> [[A</span><span class="id"> mA</span><span class="id"> [B</span><span class="id"> mB</span><span class="id"> &lt;-]]|[A</span><span class="id"> [mA</span><span class="id"> [B</span><span class="id"> [mB</span><span class="id"> -&gt;]]]]]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="gallina-kwd"> exists</span><span class="id"> A;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="gallina-kwd"> exists</span><span class="id"> B</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="gallina-kwd"> exists</span><span class="id"> A</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="gallina-kwd"> exists</span><span class="id"> B</span>.<br/>
<span class="id">-</span><span class="id"> move=&gt;</span><span class="id"> n;</span><span class="id"> rewrite</span><span class="id"> /C</span><span class="id"> /=;</span><span class="gallina-kwd"> exists</span> (<span class="id">F</span><span class="id"> n</span>)<span class="id">;</span><span class="id"> split;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> have</span><span class="id"> []</span><span class="id"> :=</span><span class="id"> Foo</span><span class="id"> n</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="gallina-kwd"> exists</span> (<span class="id">G</span><span class="id"> n</span>)<span class="id">;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> have</span><span class="id"> []</span><span class="id"> :=</span><span class="id"> Goo</span><span class="id"> n</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> A</span><span class="id"> [A1</span><span class="id"> [mA1</span><span class="id"> [A2</span><span class="id"> [mA2</span><span class="id"> -&gt;]]]];</span><span class="id"> rewrite</span><span class="id"> m'E//=</span><span class="id"> product_measure1E</span>.<br/>
<span class="id">-</span><span class="id"> move=&gt;</span><span class="id"> k;</span><span class="id"> have</span><span class="id"> [?</span><span class="id"> ?]</span><span class="id"> :=</span><span class="id"> Foo</span><span class="id"> k;</span><span class="id"> have</span><span class="id"> [?</span><span class="id"> ?]</span><span class="id"> :=</span><span class="id"> Goo</span><span class="id"> k</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /=</span><span class="id"> product_measure1E//</span><span class="id"> lte_mul_pinfty//</span><span class="id"> ge0_fin_numE</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> product_measure_unique</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> product_measure2</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<span class="vernacular">Context</span><span class="id"> d1</span><span class="id"> d2</span> (<span class="id">T1</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d1</span>) (<span class="id">T2</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d2</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>).<br/>
<span class="vernacular">Variable</span><span class="id"> m1</span><span class="id"> :</span><span class="id"> {sigma_finite_measure</span><span class="id"> set</span><span class="id"> T1</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R}</span>.<br/>
<span class="vernacular">Variable</span><span class="id"> m2</span><span class="id"> :</span><span class="id"> {measure</span><span class="id"> set</span><span class="id"> T2</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R}</span>.<br/>
<span class="vernacular">Implicit</span><span class="id"> Types</span><span class="id"> A</span><span class="id"> :</span><span class="id"> set</span> (<span class="id">T1</span><span class="id"> *</span><span class="id"> T2</span>).<br/>
<br/>
<span class="vernacular">Let</span><span class="id"> pm20</span><span class="id"> :</span> (<span class="id">m1</span><span class="id"> \x^</span><span class="id"> m2</span>)<span class="id"> set0</span><span class="id"> =</span><span class="id"> 0</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /</span>(_<span class="id"> \x^</span><span class="id"> _</span>)<span class="id"> integral0_eq//</span><span class="id"> =&gt;</span><span class="id"> y/=</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> ysection0</span><span class="id"> measure0</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Let</span><span class="id"> pm2_ge0</span><span class="id"> A</span><span class="id"> :</span><span class="id"> 0</span><span class="id"> &lt;=</span> (<span class="id">m1</span><span class="id"> \x^</span><span class="id"> m2</span>)<span class="id"> A</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> integral_ge0</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> *;</span><span class="id"> exact/measure_ge0/measurable_ysection</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Let</span><span class="id"> pm2_sigma_additive</span><span class="id"> :</span><span class="id"> semi_sigma_additive</span> (<span class="id">m1</span><span class="id"> \x^</span><span class="id"> m2</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> F</span><span class="id"> mF</span><span class="id"> tF</span><span class="id"> mUF</span>.<br/>
<span class="id">rewrite</span><span class="id"> [X</span><span class="gallina-kwd"> in</span><span class="id"> _</span><span class="id"> --&gt;</span><span class="id"> X]</span>(_<span class="id"> :</span><span class="id"> _</span><span class="id"> =</span><span class="id"> \sum_</span>(<span class="id">n</span><span class="id"> &lt;oo</span>) (<span class="id">m1</span><span class="id"> \x^</span><span class="id"> m2</span>) (<span class="id">F</span><span class="id"> n</span>)).<br/>
&nbsp;&nbsp;<span class="id">apply/cvg_closeP;</span><span class="id"> split;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> closeE</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> is_cvg_nneseries</span><span class="id"> =&gt;</span><span class="id"> *;</span><span class="id"> exact:</span><span class="id"> integral_ge0</span>.<br/>
<span class="id">rewrite</span><span class="id"> -integral_nneseries//;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> n;</span><span class="id"> apply:</span><span class="id"> measurable_fun_ysection</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> rewrite</span><span class="id"> inE</span>.<br/>
<span class="id">apply:</span><span class="id"> eq_integral</span><span class="id"> =&gt;</span><span class="id"> y</span><span class="id"> _;</span><span class="id"> apply/esym/cvg_lim</span><span class="id"> =&gt;</span><span class="id"> //=;</span><span class="id"> rewrite</span><span class="id"> ysection_bigcup</span>.<br/>
<span class="id">apply:</span> (<span class="id">measure_sigma_additive</span><span class="id"> _</span> (<span class="id">trivIset_ysection</span><span class="id"> tF</span>))<span class="id"> =&gt;</span><span class="id"> ?</span>.<br/>
<span class="id">exact:</span><span class="id"> measurable_ysection</span>.<br/>
Qed.</div></details>
<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> isMeasure</span>.<span class="id">Build</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">m1</span><span class="id"> \x^</span><span class="id"> m2</span>)<br/>
&nbsp;&nbsp;<span class="id">pm20</span><span class="id"> pm2_ge0</span><span class="id"> pm2_sigma_additive</span>.<br/>
<br/>
<span class="vernacular">End</span><span class="id"> product_measure2</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> product_measure2E</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<span class="vernacular">Context</span><span class="id"> d1</span><span class="id"> d2</span> (<span class="id">T1</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d1</span>) (<span class="id">T2</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d2</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>).<br/>
<span class="vernacular">Variable</span><span class="id"> m1</span><span class="id"> :</span><span class="id"> {sigma_finite_measure</span><span class="id"> set</span><span class="id"> T1</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R}</span>.<br/>
<span class="vernacular">Variable</span><span class="id"> m2</span><span class="id"> :</span><span class="id"> {measure</span><span class="id"> set</span><span class="id"> T2</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R}</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> product_measure2E</span> (<span class="id">A1</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T1</span>) (<span class="id">A2</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">mA1</span><span class="id"> :</span><span class="id"> measurable</span><span class="id"> A1</span>) (<span class="id">mA2</span><span class="id"> :</span><span class="id"> measurable</span><span class="id"> A2</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;(<span class="id">m1</span><span class="id"> \x^</span><span class="id"> m2</span>) (<span class="id">A1</span><span class="id"> `*`</span><span class="id"> A2</span>)<span class="id"> =</span><span class="id"> m1</span><span class="id"> A1</span><span class="id"> *</span><span class="id"> m2</span><span class="id"> A2</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">have</span><span class="id"> mA1A2</span><span class="id"> :</span><span class="id"> measurable</span> (<span class="id">A1</span><span class="id"> `*`</span><span class="id"> A2</span>)<span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> measurableX</span>.<br/>
<span class="id">transitivity</span> (<span class="id">\int[m2]_y</span> (<span class="id">m1</span><span class="id"> \o</span><span class="id"> ysection</span> (<span class="id">A1</span><span class="id"> `*`</span><span class="id"> A2</span>))<span class="id"> y</span>)<span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
<span class="id">rewrite</span> (_<span class="id"> :</span><span class="id"> _</span><span class="id"> \o</span><span class="id"> _</span><span class="id"> =</span><span class="gallina-kwd"> fun</span><span class="id"> y</span><span class="id"> =&gt;</span><span class="id"> m1</span><span class="id"> A1</span><span class="id"> *</span> (<span class="id">\1_A2</span><span class="id"> y</span>)<span class="id">%:E</span>).<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> ge0_integralZl//</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> integral_indic</span><span class="id"> ?setIT</span><span class="id"> ?mul1e</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> exact:</span><span class="id"> measurableT_comp</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> y</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> lee_fin</span>.<br/>
<span class="id">rewrite</span><span class="id"> funeqE</span><span class="id"> =&gt;</span><span class="id"> y;</span><span class="id"> rewrite</span><span class="id"> indicE</span>.<br/>
<span class="id">have</span><span class="id"> [yA2|yA2]</span><span class="id"> :=</span><span class="id"> boolP</span> (<span class="id">y</span><span class="id"> \in</span><span class="id"> A2</span>)<span class="id">;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> mule1</span><span class="id"> /=</span><span class="id"> in_ysectionX</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> mule0</span><span class="id"> /=</span><span class="id"> notin_ysectionX</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> product_measure2E</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> simple_density_L1</span>.<br/>
<span class="vernacular">Context</span><span class="id"> d</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>).<br/>
<span class="vernacular">Variables</span> (<span class="id">mu</span><span class="id"> :</span><span class="id"> {measure</span><span class="id"> set</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R}</span>) (<span class="id">E</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T</span>) (<span class="id">mE</span><span class="id"> :</span><span class="id"> measurable</span><span class="id"> E</span>).<br/>
<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> measurable_bounded_integrable</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> R^o</span>) <span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">mu</span><span class="id"> E</span><span class="id"> &lt;</span><span class="id"> +oo</span><span class="id"> -&gt;</span><span class="id"> measurable_fun</span><span class="id"> E</span><span class="id"> f</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">[bounded</span><span class="id"> f</span><span class="id"> x</span><span class="id"> |</span><span class="id"> x</span><span class="gallina-kwd"> in</span><span class="id"> E]</span><span class="id"> -&gt;</span><span class="id"> mu</span>.<span class="id">-integrable</span><span class="id"> E</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> f</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> Afin</span><span class="id"> mfA</span><span class="id"> bdA;</span><span class="id"> apply/integrableP;</span><span class="id"> split;</span><span class="id"> first</span><span class="id"> exact/measurable_EFinP</span>.<br/>
<span class="id">have</span><span class="id"> [M</span><span class="id"> [_</span><span class="id"> mrt]]</span><span class="id"> :=</span><span class="id"> bdA;</span><span class="id"> apply:</span><span class="id"> le_lt_trans</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span> (<span class="id">integral_le_bound</span> (<span class="id">`|M|</span><span class="id"> +</span><span class="id"> 1</span>)<span class="id">%:E</span>)<span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> measurableT_comp</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> aeW</span><span class="id"> =&gt;</span><span class="id"> z</span><span class="id"> Az;</span><span class="id"> rewrite</span><span class="id"> lee_fin</span><span class="id"> mrt//</span><span class="id"> ltr_pwDr//</span><span class="id"> ler_norm</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> lte_mul_pinfty</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Import</span><span class="id"> HBSimple</span>.<br/>
<br/>
<span class="vernacular">Let</span><span class="id"> sfun_dense_L1_pos</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">mu</span>.<span class="id">-integrable</span><span class="id"> E</span><span class="id"> f</span><span class="id"> -&gt;</span> (<span class="gallina-kwd">forall</span><span class="id"> x,</span><span class="id"> E</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> f</span><span class="id"> x</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">exists</span><span class="id"> g_</span><span class="id"> :</span><span class="id"> {sfun</span><span class="id"> T</span><span class="id"> &gt;-&gt;</span><span class="id"> R}^nat,</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">[/\</span><span class="gallina-kwd"> forall</span><span class="id"> n,</span><span class="id"> mu</span>.<span class="id">-integrable</span><span class="id"> E</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> g_</span><span class="id"> n</span>)<span class="id">,</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">forall</span><span class="id"> x,</span><span class="id"> E</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> EFin</span><span class="id"> \o</span><span class="id"> g_^~</span><span class="id"> x</span><span class="id"> @</span><span class="id"> \oo</span><span class="id"> --&gt;</span><span class="id"> f</span><span class="id"> x</span><span class="id"> &amp;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="gallina-kwd">fun</span><span class="id"> n</span><span class="id"> =&gt;</span><span class="id"> \int[mu]_</span>(<span class="id">z</span><span class="gallina-kwd"> in</span><span class="id"> E</span>)<span class="id"> `|f</span><span class="id"> z</span><span class="id"> -</span> (<span class="id">g_</span><span class="id"> n</span><span class="id"> z</span>)<span class="id">%:E|</span>)<span class="id"> @</span><span class="id"> \oo</span><span class="id"> --&gt;</span><span class="id"> 0]</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> intf</span><span class="id"> fpos;</span><span class="id"> case/integrableP:</span> (<span class="id">intf</span>)<span class="id"> =&gt;</span><span class="id"> mfE</span><span class="id"> _</span>.<br/>
<span class="id">pose</span><span class="id"> g_</span><span class="id"> n</span><span class="id"> :=</span><span class="id"> nnsfun_approx</span><span class="id"> mE</span><span class="id"> mfE</span><span class="id"> n</span>.<br/>
<br/>
<span class="vernacular">Import</span><span class="id"> HBNNSimple</span>.<br/>
<br/>
<span class="id">have</span><span class="id"> []</span><span class="id"> //</span><span class="id"> :=</span><span class="id"> @dominated_convergence</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> mu</span><span class="id"> _</span><span class="id"> mE</span> (<span class="gallina-kwd">fun</span><span class="id"> n</span><span class="id"> =&gt;</span><span class="id"> EFin</span><span class="id"> \o</span><span class="id"> g_</span><span class="id"> n</span>)<span class="id"> f</span><span class="id"> f</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> ?;</span><span class="id"> exact/measurable_EFinP/measurable_funTS</span>.<br/>
<span class="id">-</span><span class="id"> apply:</span><span class="id"> aeW</span><span class="id"> =&gt;</span><span class="id"> ?</span><span class="id"> ?;</span><span class="id"> under</span><span class="id"> eq_fun</span><span class="id"> =&gt;</span><span class="id"> ?</span><span class="id"> do</span><span class="id"> rewrite</span><span class="id"> /g_</span><span class="id"> nnsfun_approxE</span>.<br/>
&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> ecvg_approx</span>.<br/>
<span class="id">-</span><span class="id"> apply:</span><span class="id"> aeW</span><span class="id"> =&gt;</span><span class="id"> /=</span><span class="id"> ?</span><span class="id"> ?</span><span class="id"> ?;</span><span class="id"> rewrite</span><span class="id"> ger0_norm</span><span class="id"> //</span><span class="id"> /g_</span><span class="id"> nnsfun_approxE</span>.<br/>
&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> le_approx</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> _</span><span class="id"> /=</span><span class="id"> fg0</span><span class="id"> gfcvg;</span><span class="gallina-kwd"> exists</span><span class="id"> g_;</span><span class="id"> split</span>.<br/>
<span class="id">-</span><span class="id"> move=&gt;</span><span class="id"> n;</span><span class="id"> apply:</span> (<span class="id">le_integrable</span><span class="id"> mE</span><span class="id"> _</span><span class="id"> _</span><span class="id"> intf</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exact/measurable_EFinP/measurable_funTS</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> ?</span><span class="id"> ?;</span><span class="id"> rewrite</span><span class="id"> /g_</span><span class="id"> !gee0_abs</span><span class="id"> ?lee_fin//;</span><span class="id"> last</span><span class="id"> exact:</span><span class="id"> fpos</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /=</span><span class="id"> nnsfun_approxE</span><span class="id"> le_approx</span>.<br/>
<span class="id">-</span><span class="id"> exact:</span><span class="id"> cvg_nnsfun_approx</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> cvg_trans</span><span class="id"> fg0;</span><span class="id"> under</span><span class="id"> eq_fun</span><span class="id"> =&gt;</span><span class="id"> ?</span><span class="id"> do</span><span class="id"> under</span><span class="id"> eq_fun</span><span class="id"> =&gt;</span><span class="id"> t</span><span class="id"> do</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> EFinN</span><span class="id"> -[_</span><span class="id"> -</span><span class="id"> _]oppeK</span><span class="id"> fin_num_oppeB</span><span class="id"> //</span><span class="id"> abseN</span><span class="id"> addeC</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> approximation_sfun_integrable</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id">:</span><br/>
&nbsp;&nbsp;<span class="id">mu</span>.<span class="id">-integrable</span><span class="id"> E</span><span class="id"> f</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">exists</span><span class="id"> g_</span><span class="id"> :</span><span class="id"> {sfun</span><span class="id"> T</span><span class="id"> &gt;-&gt;</span><span class="id"> R}^nat,</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">[/\</span><span class="gallina-kwd"> forall</span><span class="id"> n,</span><span class="id"> mu</span>.<span class="id">-integrable</span><span class="id"> E</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> g_</span><span class="id"> n</span>)<span class="id">,</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">forall</span><span class="id"> x,</span><span class="id"> E</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> EFin</span><span class="id"> \o</span><span class="id"> g_^~</span><span class="id"> x</span><span class="id"> @</span><span class="id"> \oo</span><span class="id"> --&gt;</span><span class="id"> f</span><span class="id"> x</span><span class="id"> &amp;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="gallina-kwd">fun</span><span class="id"> n</span><span class="id"> =&gt;</span><span class="id"> \int[mu]_</span>(<span class="id">z</span><span class="gallina-kwd"> in</span><span class="id"> E</span>)<span class="id"> `|f</span><span class="id"> z</span><span class="id"> -</span> (<span class="id">g_</span><span class="id"> n</span><span class="id"> z</span>)<span class="id">%:E|</span>)<span class="id"> @</span><span class="id"> \oo</span><span class="id"> --&gt;</span><span class="id"> 0]</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> intf</span>.<br/>
<span class="id">have</span><span class="id"> [//|p_</span><span class="id"> [intp</span><span class="id"> pf</span><span class="id"> pl1]]</span><span class="id"> :=</span><span class="id"> sfun_dense_L1_pos</span> (<span class="id">integrable_funepos</span><span class="id"> mE</span><span class="id"> intf</span>).<br/>
<span class="id">have</span><span class="id"> [//|n_</span><span class="id"> [intn</span><span class="id"> nf</span><span class="id"> nl1]]</span><span class="id"> :=</span><span class="id"> sfun_dense_L1_pos</span> (<span class="id">integrable_funeneg</span><span class="id"> mE</span><span class="id"> intf</span>).<br/>
<span class="gallina-kwd">exists</span> (<span class="gallina-kwd">fun</span><span class="id"> n</span><span class="id"> =&gt;</span><span class="id"> p_</span><span class="id"> n</span><span class="id"> -</span><span class="id"> n_</span><span class="id"> n</span>)<span class="id">%R;</span><span class="id"> split</span>.<br/>
<span class="id">-</span><span class="id"> move=&gt;</span><span class="id"> n;</span><span class="id"> rewrite</span><span class="id"> /comp;</span><span class="id"> under</span><span class="id"> eq_fun</span><span class="id"> =&gt;</span><span class="id"> ?</span><span class="id"> do</span><span class="id"> rewrite</span><span class="id"> sfunB</span><span class="id"> /=</span><span class="id"> EFinB</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> integrableB</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> [exact:</span><span class="id"> intp</span><span class="id"> |</span><span class="id"> exact:</span><span class="id"> intn]</span>.<br/>
<span class="id">-</span><span class="id"> move=&gt;</span><span class="id"> ?</span><span class="id"> ?;</span><span class="id"> rewrite</span><span class="id"> /comp;</span><span class="id"> under</span><span class="id"> eq_fun</span><span class="id"> =&gt;</span><span class="id"> ?</span><span class="id"> do</span><span class="id"> rewrite</span><span class="id"> sfunB</span><span class="id"> /=</span><span class="id"> EFinB</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> [f]funeposneg;</span><span class="id"> apply:</span><span class="id"> cvgeB</span><span class="id"> =&gt;</span><span class="id"> //;[|exact:</span><span class="id"> pf|exact:nf]</span>.<br/>
&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> add_def_funeposneg</span>.<br/>
<span class="id">have</span><span class="id"> fpn</span><span class="id"> z</span><span class="id"> n</span><span class="id"> :</span><span class="id"> f</span><span class="id"> z</span><span class="id"> -</span> ((<span class="id">p_</span><span class="id"> n</span><span class="id"> -</span><span class="id"> n_</span><span class="id"> n</span>)<span class="id"> z</span>)<span class="id">%:E</span><span class="id"> =</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">f^\+</span><span class="id"> z</span><span class="id"> -</span> (<span class="id">p_</span><span class="id"> n</span><span class="id"> z</span>)<span class="id">%:E</span>)<span class="id"> -</span> (<span class="id">f^\-</span><span class="id"> z</span><span class="id"> -</span> (<span class="id">n_</span><span class="id"> n</span><span class="id"> z</span>)<span class="id">%:E</span>).<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> sfunB</span><span class="id"> EFinB</span><span class="id"> fin_num_oppeB</span><span class="id"> //</span><span class="id"> {1}[f]funeposneg</span><span class="id"> -addeACA</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> congr</span> (_<span class="id"> _</span>)<span class="id">;</span><span class="id"> rewrite</span><span class="id"> fin_num_oppeB</span>.<br/>
<span class="id">case/integrableP:</span> (<span class="id">intf</span>)<span class="id"> =&gt;</span><span class="id"> mf</span><span class="id"> _</span>.<br/>
<span class="id">have</span><span class="id"> mfpn</span><span class="id"> n</span><span class="id"> :</span><span class="id"> mu</span>.<span class="id">-integrable</span><span class="id"> E</span> (<span class="gallina-kwd">fun</span><span class="id"> z</span><span class="id"> =&gt;</span><span class="id"> f</span><span class="id"> z</span><span class="id"> -</span> ((<span class="id">p_</span><span class="id"> n</span><span class="id"> -</span><span class="id"> n_</span><span class="id"> n</span>)<span class="id"> z</span>)<span class="id">%:E</span>).<br/>
&nbsp;&nbsp;<span class="id">under</span><span class="id"> eq_fun</span><span class="id"> =&gt;</span><span class="id"> ?</span><span class="id"> do</span><span class="id"> rewrite</span><span class="id"> fpn;</span><span class="id"> apply:</span><span class="id"> integrableB</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> integrableB</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> [exact:</span><span class="id"> integrable_funepos</span><span class="id"> |</span><span class="id"> exact:</span><span class="id"> intp]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> integrableB</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> [exact:</span><span class="id"> integrable_funeneg</span><span class="id"> |</span><span class="id"> exact:</span><span class="id"> intn]</span>.<br/>
<span class="id">apply/fine_cvgP;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="id">near=&gt;</span><span class="id"> N;</span><span class="id"> case/integrableP:</span> (<span class="id">mfpn</span><span class="id"> N</span>)<span class="id"> =&gt;</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> ge0_fin_numE</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> integral_ge0</span>.<br/>
<span class="id">apply/cvg_ballP=&gt;</span><span class="id"> _/posnumP[eps];</span><span class="id"> have</span><span class="id"> e2p</span><span class="id"> :</span> (<span class="id">0</span><span class="id"> &lt;</span><span class="id"> eps%:num/2</span>)<span class="id">%R</span><span class="gallina-kwd"> by</span><span class="id"> []</span>.<br/>
<span class="id">case/fine_cvgP:</span><span class="id"> pl1</span><span class="id"> =&gt;</span><span class="id"> +</span><span class="id"> /cvg_ballP/</span>(_<span class="id"> _</span><span class="id"> e2p</span>)<span class="id">;</span><span class="id"> apply:</span><span class="id"> filter_app2</span>.<br/>
<span class="id">case/fine_cvgP:</span><span class="id"> nl1</span><span class="id"> =&gt;</span><span class="id"> +</span><span class="id"> /cvg_ballP/</span>(_<span class="id"> _</span><span class="id"> e2p</span>)<span class="id">;</span><span class="id"> apply:</span><span class="id"> filter_app2</span>.<br/>
<span class="id">near=&gt;</span><span class="id"> n;</span><span class="id"> rewrite</span><span class="id"> /ball</span><span class="id"> /=;</span><span class="id"> do</span><span class="id"> 3</span><span class="id"> rewrite</span><span class="id"> distrC</span><span class="id"> subr0</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> finfn</span><span class="id"> ne2</span><span class="id"> finfp</span><span class="id"> pe2;</span><span class="id"> rewrite</span><span class="id"> [_%:num]splitr</span>.<br/>
<span class="id">rewrite</span> (<span class="id">le_lt_trans</span><span class="id"> _</span> (<span class="id">ltrD</span><span class="id"> pe2</span><span class="id"> ne2</span>))<span class="id">//</span> (<span class="id">le_trans</span><span class="id"> _</span> (<span class="id">ler_normD</span><span class="id"> _</span><span class="id"> _</span>))<span class="id">//</span>.<br/>
<span class="id">under</span><span class="id"> [fun</span><span class="id"> z</span><span class="id"> =&gt;</span><span class="id"> _</span> (<span class="id">f^\+</span><span class="id"> z</span><span class="id"> +</span><span class="id"> _</span>)<span class="id">]eq_fun</span><span class="id"> =&gt;</span><span class="id"> ?</span><span class="id"> do</span><span class="id"> rewrite</span><span class="id"> EFinN</span>.<br/>
<span class="id">under</span><span class="id"> [fun</span><span class="id"> z</span><span class="id"> =&gt;</span><span class="id"> _</span> (<span class="id">f^\-</span><span class="id"> z</span><span class="id"> +</span><span class="id"> _</span>)<span class="id">]eq_fun</span><span class="id"> =&gt;</span><span class="id"> ?</span><span class="id"> do</span><span class="id"> rewrite</span><span class="id"> EFinN</span>.<br/>
<span class="id">have</span><span class="id"> mfp</span><span class="id"> :</span><span class="id"> mu</span>.<span class="id">-integrable</span><span class="id"> E</span> (<span class="gallina-kwd">fun</span><span class="id"> z</span><span class="id"> =&gt;</span><span class="id"> `|f^\+</span><span class="id"> z</span><span class="id"> -</span> (<span class="id">p_</span><span class="id"> n</span><span class="id"> z</span>)<span class="id">%:E|</span>).<br/>
&nbsp;&nbsp;<span class="id">apply/integrable_abse/integrableB</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> integrable_funepos</span>.<br/>
&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> intp</span>.<br/>
<span class="id">have</span><span class="id"> mfn</span><span class="id"> :</span><span class="id"> mu</span>.<span class="id">-integrable</span><span class="id"> E</span> (<span class="gallina-kwd">fun</span><span class="id"> z</span><span class="id"> =&gt;</span><span class="id"> `|f^\-</span><span class="id"> z</span><span class="id"> -</span> (<span class="id">n_</span><span class="id"> n</span><span class="id"> z</span>)<span class="id">%:E|</span>).<br/>
&nbsp;&nbsp;<span class="id">apply/integrable_abse/integrableB</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> integrable_funeneg</span>.<br/>
&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> intn</span>.<br/>
<span class="id">rewrite</span><span class="id"> -[x</span><span class="gallina-kwd"> in</span> (_<span class="id"> &lt;=</span><span class="id"> `|x|</span>)<span class="id">%R]fineD</span><span class="id"> //</span><span class="id"> -integralD</span><span class="id"> //</span>.<br/>
<span class="id">rewrite</span><span class="id"> !ger0_norm</span><span class="id"> ?fine_ge0</span><span class="id"> ?integral_ge0</span><span class="id"> ?fine_le//</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> integral_fune_fin_num</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact/integrable_abse/mfpn</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> integral_fune_fin_num</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> integrableD</span>.<br/>
<span class="id">-</span><span class="id"> apply:</span><span class="id"> ge0_le_integral</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> measurableT_comp</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> case/integrableP:</span> (<span class="id">mfpn</span><span class="id"> n</span>).<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> Ex;</span><span class="id"> rewrite</span><span class="id"> adde_ge0</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> emeasurable_funD;</span><span class="id"> [move:</span><span class="id"> mfp</span><span class="id"> |</span><span class="id"> move:</span><span class="id"> mfn];</span><span class="id"> case/integrableP</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> ?</span><span class="id"> ?;</span><span class="id"> rewrite</span><span class="id"> fpn;</span><span class="id"> exact:</span><span class="id"> lee_abs_sub</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> Ex;</span><span class="id"> rewrite</span><span class="id"> adde_ge0</span>.<br/>
<span class="id">Unshelve</span>.<span class="id"> all:</span><span class="gallina-kwd"> by</span><span class="id"> end_near</span>. Qed.</div></details>
<span class="vernacular">End</span><span class="id"> simple_density_L1</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> continuous_density_L1</span>.<br/>
<span class="vernacular">Context</span> (<span class="id">rT</span><span class="id"> :</span><span class="id"> realType</span>).<br/>
<span class="vernacular">Let</span><span class="id"> mu</span><span class="id"> :=</span><span class="id"> [the</span><span class="id"> measure</span><span class="id"> _</span><span class="id"> _</span><span class="id"> of</span><span class="id"> @lebesgue_measure</span><span class="id"> rT]</span>.<br/>
<span class="vernacular">Let</span><span class="id"> R</span> <span class="id"> :=</span><span class="id"> [the</span><span class="id"> measurableType</span><span class="id"> _</span><span class="id"> of</span><span class="id"> measurableTypeR</span><span class="id"> rT]</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> compact_finite_measure</span> (<span class="id">A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> R^o</span>)<span class="id"> :</span><span class="id"> compact</span><span class="id"> A</span><span class="id"> -&gt;</span><span class="id"> mu</span><span class="id"> A</span><span class="id"> &lt;</span><span class="id"> +oo</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> /[dup]/compact_measurable</span><span class="id"> =&gt;</span><span class="id"> mA</span><span class="id"> /compact_bounded[N</span><span class="id"> [_</span><span class="id"> N1x]]</span>.<br/>
<span class="id">have</span><span class="id"> AN1</span><span class="id"> :</span> (<span class="id">A</span><span class="id"> `&lt;=`</span><span class="id"> `[-</span> (<span class="id">`|N|</span><span class="id"> +</span><span class="id"> 1</span>)<span class="id">,</span><span class="id"> `|N|</span><span class="id"> +</span><span class="id"> 1]</span>)<span class="id">%R</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> z</span><span class="id"> Az;</span><span class="id"> rewrite</span><span class="id"> set_itvcc</span><span class="id"> /=</span><span class="id"> -ler_norml</span><span class="id"> N1x//</span><span class="id"> ltr_pwDr//</span><span class="id"> ler_norm</span>.<br/>
<span class="id">rewrite</span> (<span class="id">le_lt_trans</span> (<span class="id">le_measure</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> AN1</span>))<span class="id"> ?inE//=</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> lebesgue_measure_itv/=</span><span class="id"> lte_fin</span><span class="id"> gtrN//</span><span class="id"> EFinD</span><span class="id"> ltry</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> continuous_compact_integrable</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> R^o</span>) (<span class="id">A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> R^o</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">compact</span><span class="id"> A</span><span class="id"> -&gt;</span><span class="id"> {within</span><span class="id"> A,</span><span class="id"> continuous</span><span class="id"> f}</span><span class="id"> -&gt;</span><span class="id"> mu</span>.<span class="id">-integrable</span><span class="id"> A</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> f</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> cptA</span><span class="id"> ctsfA;</span><span class="id"> apply:</span><span class="id"> measurable_bounded_integrable</span>.<br/>
<span class="id">-</span><span class="id"> exact:</span><span class="id"> compact_measurable</span>.<br/>
<span class="id">-</span><span class="id"> exact:</span><span class="id"> compact_finite_measure</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> subspace_continuous_measurable_fun</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> compact_measurable</span>.<br/>
<span class="id">-</span><span class="id"> have</span><span class="id"> /compact_bounded[M</span><span class="id"> [_</span><span class="id"> mrt]]</span><span class="id"> :=</span><span class="id"> continuous_compact</span><span class="id"> ctsfA</span><span class="id"> cptA</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="gallina-kwd"> exists</span><span class="id"> M;</span><span class="id"> split;</span><span class="id"> rewrite</span><span class="id"> ?num_real</span><span class="id"> //</span><span class="id"> =&gt;</span><span class="id"> ?</span><span class="id"> ?</span><span class="id"> ?</span><span class="id"> ?;</span><span class="id"> exact:</span><span class="id"> mrt</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Import</span><span class="id"> HBSimple</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> approximation_continuous_integrable</span> (<span class="id">E</span><span class="id"> :</span><span class="id"> set</span><span class="id"> _</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> rT</span><span class="id"> -&gt;</span><span class="id"> rT</span>)<span class="id">:</span><br/>
&nbsp;&nbsp;<span class="id">measurable</span><span class="id"> E</span><span class="id"> -&gt;</span><span class="id"> mu</span><span class="id"> E</span><span class="id"> &lt;</span><span class="id"> +oo</span><span class="id"> -&gt;</span><span class="id"> mu</span>.<span class="id">-integrable</span><span class="id"> E</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> f</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">exists</span><span class="id"> g_</span><span class="id"> :</span> (<span class="id">rT</span><span class="id"> -&gt;</span><span class="id"> rT</span>)<span class="id">^nat,</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">[/\</span><span class="gallina-kwd"> forall</span><span class="id"> n,</span><span class="id"> continuous</span> (<span class="id">g_</span><span class="id"> n</span>)<span class="id">,</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">forall</span><span class="id"> n,</span><span class="id"> mu</span>.<span class="id">-integrable</span><span class="id"> E</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> g_</span><span class="id"> n</span>)<span class="id"> &amp;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">\int[mu]_</span>(<span class="id">z</span><span class="gallina-kwd"> in</span><span class="id"> E</span>)<span class="id"> `|</span>(<span class="id">f</span><span class="id"> z</span><span class="id"> -</span><span class="id"> g_</span><span class="id"> n</span><span class="id"> z</span>)<span class="id">%:E|</span><span class="id"> @[n</span><span class="id"> --&gt;</span><span class="id"> \oo]</span><span class="id"> --&gt;</span><span class="id"> 0]</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> mE</span><span class="id"> Efin</span><span class="id"> intf</span>.<br/>
<span class="id">have</span><span class="id"> mf</span><span class="id"> :</span><span class="id"> measurable_fun</span><span class="id"> E</span><span class="id"> f</span><span class="gallina-kwd"> by</span><span class="id"> case/integrableP</span><span class="id"> :</span><span class="id"> intf</span><span class="id"> =&gt;</span><span class="id"> /measurable_EFinP</span>.<br/>
<span class="id">suff</span><span class="id"> apxf</span><span class="id"> eps</span><span class="id"> :</span><span class="gallina-kwd"> exists</span><span class="id"> h</span><span class="id"> :</span><span class="id"> rT</span><span class="id"> -&gt;</span><span class="id"> rT,</span> (<span class="id">eps</span><span class="id"> &gt;</span><span class="id"> 0</span>)<span class="id">%R</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">[/\</span><span class="id"> continuous</span><span class="id"> h,</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">mu</span>.<span class="id">-integrable</span><span class="id"> E</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> h</span>)<span class="id"> &amp;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">\int[mu]_</span>(<span class="id">z</span><span class="gallina-kwd"> in</span><span class="id"> E</span>)<span class="id"> `|</span>(<span class="id">f</span><span class="id"> z</span><span class="id"> -</span><span class="id"> h</span><span class="id"> z</span>)<span class="id">%:E|</span><span class="id"> &lt;</span><span class="id"> eps%:E]</span>.<br/>
&nbsp;&nbsp;<span class="id">pose</span><span class="id"> g_</span><span class="id"> n</span><span class="id"> :=</span><span class="id"> projT1</span> (<span class="id">cid</span> (<span class="id">apxf</span><span class="id"> n</span>.<span class="id">+1%:R^-1</span>))<span class="id">;</span><span class="gallina-kwd"> exists</span><span class="id"> g_;</span><span class="id"> split</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> n;</span><span class="id"> have</span><span class="id"> []</span><span class="id"> :=</span><span class="id"> projT2</span> (<span class="id">cid</span> (<span class="id">apxf</span><span class="id"> n</span>.<span class="id">+1%:R^-1</span>)).<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> n;</span><span class="id"> have</span><span class="id"> []</span><span class="id"> :=</span><span class="id"> projT2</span> (<span class="id">cid</span> (<span class="id">apxf</span><span class="id"> n</span>.<span class="id">+1%:R^-1</span>)).<br/>
&nbsp;&nbsp;<span class="id">apply/cvg_ballP</span><span class="id"> =&gt;</span><span class="id"> eps</span><span class="id"> epspos</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> /cvg_ballP/</span>(_<span class="id"> eps</span><span class="id"> epspos</span>)<span class="id">[N</span><span class="id"> _</span><span class="id"> Nball]</span><span class="id"> :=</span><span class="id"> @cvge_harmonic</span><span class="id"> rT</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">exists</span><span class="id"> N</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> apply:</span> (<span class="id">subset_trans</span><span class="id"> Nball</span>)<span class="id"> =&gt;</span><span class="id"> n</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> /ball</span><span class="id"> /=</span><span class="id"> /ereal_ball</span><span class="id"> contract0</span><span class="id"> !sub0r</span><span class="id"> !normrN</span><span class="id"> =&gt;</span><span class="id"> /</span>(<span class="id">lt_trans</span><span class="id"> _</span>)<span class="id">;</span><span class="id"> apply</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> ?ger0_norm;</span><span class="id"> first</span><span class="id"> last</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> -le_expandLR</span><span class="id"> //</span><span class="id"> ?inE</span><span class="id"> ?normr0//</span><span class="id"> expand0</span><span class="id"> integral_ge0</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> -le_expandLR</span><span class="id"> //</span><span class="id"> ?inE</span><span class="id"> ?normr0//</span><span class="id"> expand0</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> []</span><span class="id"> :=</span><span class="id"> projT2</span> (<span class="id">cid</span> (<span class="id">apxf</span><span class="id"> n</span>.<span class="id">+1%:R^-1</span>))<span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> _</span><span class="id"> _</span><span class="id"> ipaxfn</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -lt_expandRL</span><span class="id"> ?contractK//</span><span class="id"> inE</span><span class="id"> contract_le1</span>.<br/>
<span class="id">have</span><span class="id"> [|]</span><span class="id"> :=</span><span class="id"> ltP</span><span class="id"> 0%R</span><span class="id"> eps;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="gallina-kwd"> exists</span><span class="id"> point</span>.<br/>
<span class="id">move:</span><span class="id"> eps</span><span class="id"> =&gt;</span><span class="id"> _/posnumP[eps]</span>.<br/>
<span class="id">have</span><span class="id"> [g</span><span class="id"> [gfe2</span><span class="id"> ig]]</span><span class="id"> :</span><span class="gallina-kwd"> exists</span><span class="id"> g</span><span class="id"> :</span><span class="id"> {sfun</span><span class="id"> R</span><span class="id"> &gt;-&gt;</span><span class="id"> rT},</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">\int[mu]_</span>(<span class="id">z</span><span class="gallina-kwd"> in</span><span class="id"> E</span>)<span class="id"> `|</span>(<span class="id">f</span><span class="id"> z</span><span class="id"> -</span><span class="id"> g</span><span class="id"> z</span>)<span class="id">%:E|</span><span class="id"> &lt;</span> (<span class="id">eps%:num</span><span class="id"> /</span><span class="id"> 2</span>)<span class="id">%:E</span><span class="id"> /\</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">mu</span>.<span class="id">-integrable</span><span class="id"> E</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> g</span>).<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> [g_</span><span class="id"> [intG</span><span class="id"> ?]]</span><span class="id"> :=</span><span class="id"> approximation_sfun_integrable</span><span class="id"> mE</span><span class="id"> intf</span>.<br/>
&nbsp;&nbsp;<span class="id">move/fine_fcvg/cvg_ballP/</span>(_ (<span class="id">eps%:num</span><span class="id"> /</span><span class="id"> 2</span>))<span class="id"> =&gt;</span><span class="id"> -[]</span><span class="id"> //</span><span class="id"> n</span><span class="id"> _</span><span class="id"> Nb;</span><span class="gallina-kwd"> exists</span> (<span class="id">g_</span><span class="id"> n</span>).<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> fg_fin_num</span><span class="id"> :</span><span class="id"> \int[mu]_</span>(<span class="id">z</span><span class="gallina-kwd"> in</span><span class="id"> E</span>)<span class="id"> `|</span>(<span class="id">f</span><span class="id"> z</span><span class="id"> -</span><span class="id"> g_</span><span class="id"> n</span><span class="id"> z</span>)<span class="id">%:E|</span><span class="id"> \is</span><span class="id"> a</span><span class="id"> fin_num</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> integral_fune_fin_num//</span><span class="id"> integrable_abse//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> under</span><span class="id"> eq_fun</span><span class="id"> do</span><span class="id"> rewrite</span><span class="id"> EFinB;</span><span class="id"> apply:</span><span class="id"> integrableB</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> intG</span>.<br/>
&nbsp;&nbsp;<span class="id">split;</span><span class="id"> last</span><span class="id"> exact:</span><span class="id"> intG</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> /=</span><span class="id"> :=</span><span class="id"> Nb</span><span class="id"> _</span> (<span class="id">leqnn</span><span class="id"> n</span>)<span class="id">;</span><span class="id"> rewrite</span><span class="id"> /ball/=</span><span class="id"> sub0r</span><span class="id"> normrN</span><span class="id"> -fine_abse//</span><span class="id"> -lte_fin</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> fineK</span><span class="id"> ?abse_fin_num//</span><span class="id"> =&gt;</span><span class="id"> /le_lt_trans;</span><span class="id"> apply;</span><span class="id"> exact:</span><span class="id"> lee_abs</span>.<br/>
<span class="id">have</span><span class="id"> mg</span><span class="id"> :</span><span class="id"> measurable_fun</span><span class="id"> E</span><span class="id"> g</span><span class="gallina-kwd"> by</span><span class="id"> exact:</span><span class="id"> measurable_funTS</span>.<br/>
<span class="id">have</span><span class="id"> [M</span><span class="id"> Mpos</span><span class="id"> Mbd]</span><span class="id"> :</span> (<span class="gallina-kwd">exists2</span><span class="id"> M,</span><span class="id"> 0</span><span class="id"> &lt;</span><span class="id"> M</span><span class="id"> &amp;</span><span class="gallina-kwd"> forall</span><span class="id"> x,</span><span class="id"> `|g</span><span class="id"> x|</span><span class="id"> &lt;=</span><span class="id"> M</span>)<span class="id">%R</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> [M</span><span class="id"> [_</span><span class="id"> /=</span><span class="id"> bdM]]</span><span class="id"> :=</span><span class="id"> simple_bounded</span><span class="id"> g</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">exists</span> (<span class="id">`|M|</span><span class="id"> +</span><span class="id"> 1</span>)<span class="id">%R;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> ltr_pwDr</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> x;</span><span class="id"> rewrite</span><span class="id"> bdM//</span><span class="id"> ltr_pwDr//</span><span class="id"> ler_norm</span>.<br/>
<span class="id">have</span><span class="id"> []</span><span class="id"> //</span><span class="id"> :=</span><span class="id"> @measurable_almost_continuous</span><span class="id"> _</span><span class="id"> _</span><span class="id"> mE</span><span class="id"> _</span><span class="id"> g</span> (<span class="id">eps%:num</span><span class="id"> /</span><span class="id"> 2</span><span class="id"> /</span> (<span class="id">M</span><span class="id"> *+</span><span class="id"> 2</span>)).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> divr_gt0//</span><span class="id"> mulrn_wgt0</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> A</span><span class="id"> [cptA</span><span class="id"> AE</span><span class="id"> /=</span><span class="id"> muAE</span><span class="id"> ctsAF]</span>.<br/>
<span class="id">have</span><span class="id"> []</span><span class="id"> :=</span><span class="id"> continuous_bounded_extension</span><span class="id"> _</span><span class="id"> _</span><span class="id"> Mpos</span><span class="id"> ctsAF</span>.<br/>
<span class="id">-</span><span class="id"> exact:</span><span class="id"> pseudometric_normal</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> compact_closed</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> Rhausdorff</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> ?</span><span class="id"> ?;</span><span class="id"> exact:</span><span class="id"> Mbd</span>.<br/>
<span class="id">have</span><span class="id"> mA</span><span class="id"> :</span><span class="id"> measurable</span><span class="id"> A</span><span class="id"> :=</span><span class="id"> compact_measurable</span><span class="id"> cptA</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> h</span><span class="id"> [gh</span><span class="id"> ctsh</span><span class="id"> hbdM];</span><span class="id"> have</span><span class="id"> mh</span><span class="id"> :</span><span class="id"> measurable_fun</span><span class="id"> E</span><span class="id"> h</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> subspace_continuous_measurable_fun=&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> continuous_subspaceT</span>.<br/>
<span class="id">have</span><span class="id"> intg</span><span class="id"> :</span><span class="id"> mu</span>.<span class="id">-integrable</span><span class="id"> E</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> h</span>).<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> measurable_bounded_integrable</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">exists</span><span class="id"> M;</span><span class="id"> split;</span><span class="id"> rewrite</span><span class="id"> ?num_real</span><span class="id"> //</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> Mx</span><span class="id"> y</span><span class="id"> _</span><span class="id"> /=</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span> (<span class="id">le_trans</span><span class="id"> _</span> (<span class="id">ltW</span><span class="id"> Mx</span>)).<br/>
<span class="gallina-kwd">exists</span><span class="id"> h;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> rewrite</span><span class="id"> [eps%:num]splitr;</span><span class="id"> apply:</span><span class="id"> le_lt_trans</span>.<br/>
&nbsp;&nbsp;<span class="id">pose</span><span class="id"> fgh</span><span class="id"> x</span><span class="id"> :=</span><span class="id"> `|</span>(<span class="id">f</span><span class="id"> x</span><span class="id"> -</span><span class="id"> g</span><span class="id"> x</span>)<span class="id">%:E|</span><span class="id"> +</span><span class="id"> `|</span>(<span class="id">g</span><span class="id"> x</span><span class="id"> -</span><span class="id"> h</span><span class="id"> x</span>)<span class="id">%:E|</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span> (<span class="id">@ge0_le_integral</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> mu</span><span class="id"> _</span><span class="id"> mE</span><span class="id"> _</span><span class="id"> fgh</span>)<span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> apply:</span> (<span class="id">measurable_funS</span><span class="id"> mE</span>)<span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> do</span><span class="id"> 2</span><span class="id"> apply:</span><span class="id"> measurableT_comp</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> measurable_funB</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> z</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> adde_ge0</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> apply:</span><span class="id"> measurableT_comp</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> apply:</span><span class="id"> measurable_funD</span><span class="id"> =&gt;</span><span class="id"> //;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span> (<span class="id">measurable_funS</span><span class="id"> mE</span>)<span class="id"> =&gt;</span><span class="id"> //;</span> (<span class="id">apply:</span><span class="id"> measurableT_comp</span><span class="id"> =&gt;</span><span class="id"> //</span>)<span class="id">;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> measurable_funB</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> -</span>(<span class="id">subrK</span> (<span class="id">g</span><span class="id"> x</span>) (<span class="id">f</span><span class="id"> x</span>))<span class="id"> -</span>(<span class="id">addrA</span> (_<span class="id"> +</span><span class="id"> _</span>)<span class="id">%R</span>)<span class="id"> lee_fin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> ler_normD</span>.<br/>
<span class="id">rewrite</span><span class="id"> integralD//;</span><span class="id"> first</span><span class="id"> last</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> integrable_abse;</span><span class="id"> under</span><span class="id"> eq_fun</span><span class="id"> do</span><span class="id"> rewrite</span><span class="id"> EFinB;</span><span class="id"> apply:</span><span class="id"> integrableB</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> integrable_abse;</span><span class="id"> under</span><span class="id"> eq_fun</span><span class="id"> do</span><span class="id"> rewrite</span><span class="id"> EFinB;</span><span class="id"> apply:</span><span class="id"> integrableB</span>.<br/>
<span class="id">rewrite</span><span class="id"> EFinD</span><span class="id"> lteD//</span><span class="id"> -</span>(<span class="id">setDKU</span><span class="id"> AE</span>)<span class="id"> ge0_integral_setU</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> first</span><span class="id"> last</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> /disj_set</span><span class="id"> setDKI</span>.<br/>
<span class="id">-</span><span class="id"> rewrite</span><span class="id"> setDKU</span><span class="id"> //;</span><span class="id"> do</span><span class="id"> 2</span><span class="id"> apply:</span><span class="id"> measurableT_comp</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> measurable_funB</span>.<br/>
<span class="id">-</span><span class="id"> exact:</span><span class="id"> measurableD</span>.<br/>
<span class="id">rewrite</span> (<span class="id">@ae_eq_integral</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> mu</span><span class="id"> A</span> (<span class="id">cst</span><span class="id"> 0</span>))<span class="id"> //;</span><span class="id"> first</span><span class="id"> last</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> aeW</span><span class="id"> =&gt;</span><span class="id"> z</span><span class="id"> Az;</span><span class="id"> rewrite</span> (<span class="id">gh</span><span class="id"> z</span>)<span class="id"> ?inE//</span><span class="id"> subrr</span><span class="id"> abse0</span>.<br/>
<span class="id">-</span><span class="id"> apply:</span> (<span class="id">measurable_funS</span><span class="id"> mE</span>)<span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> do</span><span class="id"> 2</span><span class="id"> apply:</span><span class="id"> measurableT_comp</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> measurable_funB</span>.<br/>
<span class="id">rewrite</span><span class="id"> integral0</span><span class="id"> adde0</span>.<br/>
<span class="id">apply:</span> (<span class="id">le_lt_trans</span> (<span class="id">integral_le_bound</span> (<span class="id">M</span><span class="id"> *+</span><span class="id"> 2</span>)<span class="id">%:E</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span>))<span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
<span class="id">-</span><span class="id"> exact:</span><span class="id"> measurableD</span>.<br/>
<span class="id">-</span><span class="id"> apply:</span> (<span class="id">measurable_funS</span><span class="id"> mE</span>)<span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> apply:</span><span class="id"> measurableT_comp</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> measurable_funB</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> lee_fin</span><span class="id"> mulrn_wge0//</span><span class="id"> ltW</span>.<br/>
<span class="id">-</span><span class="id"> apply:</span><span class="id"> aeW</span><span class="id"> =&gt;</span><span class="id"> z</span><span class="id"> [Ez</span><span class="id"> _];</span><span class="id"> rewrite</span><span class="id"> /=</span><span class="id"> lee_fin</span><span class="id"> mulr2n</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span> (<span class="id">le_trans</span> (<span class="id">ler_normB</span><span class="id"> _</span><span class="id"> _</span>))<span class="id">//</span><span class="id"> lerD</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -lte_pdivlMl</span><span class="id"> ?mulrn_wgt0//</span><span class="id"> muleC</span><span class="id"> -EFinM</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> continuous_density_L1</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> fubini_functions</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<span class="vernacular">Context</span><span class="id"> d1</span><span class="id"> d2</span> (<span class="id">T1</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d1</span>) (<span class="id">T2</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d2</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>).<br/>
<span class="vernacular">Variables</span> (<span class="id">m1</span><span class="id"> :</span><span class="id"> {measure</span><span class="id"> set</span><span class="id"> T1</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R}</span>) (<span class="id">m2</span><span class="id"> :</span><span class="id"> {measure</span><span class="id"> set</span><span class="id"> T2</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R}</span>).<br/>
<span class="vernacular">Variable</span><span class="id"> f</span><span class="id"> :</span><span class="id"> T1</span><span class="id"> *</span><span class="id"> T2</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>.<br/>
<br/>
<span class="vernacular">Definition</span><span class="id"> fubini_F</span><span class="id"> x</span><span class="id"> :=</span><span class="id"> \int[m2]_y</span><span class="id"> f</span> (<span class="id">x,</span><span class="id"> y</span>).<br/>
<span class="vernacular">Definition</span><span class="id"> fubini_G</span><span class="id"> y</span><span class="id"> :=</span><span class="id"> \int[m1]_x</span><span class="id"> f</span> (<span class="id">x,</span><span class="id"> y</span>).<br/>
<br/>
<span class="vernacular">End</span><span class="id"> fubini_functions</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> fubini_tonelli</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<span class="vernacular">Context</span><span class="id"> d1</span><span class="id"> d2</span> (<span class="id">T1</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d1</span>) (<span class="id">T2</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d2</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>).<br/>
<span class="vernacular">Variable</span><span class="id"> m1</span><span class="id"> :</span><span class="id"> {sigma_finite_measure</span><span class="id"> set</span><span class="id"> T1</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R}</span>.<br/>
<span class="vernacular">Variable</span><span class="id"> m2</span><span class="id"> :</span><span class="id"> {sigma_finite_measure</span><span class="id"> set</span><span class="id"> T2</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R}</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> indic_fubini_tonelli</span>.<br/>
<span class="vernacular">Variables</span> (<span class="id">A</span><span class="id"> :</span><span class="id"> set</span> (<span class="id">T1</span><span class="id"> *</span><span class="id"> T2</span>)) (<span class="id">mA</span><span class="id"> :</span><span class="id"> measurable</span><span class="id"> A</span>).<br/>
<span class="vernacular">Implicit</span><span class="id"> Types</span><span class="id"> A</span><span class="id"> :</span><span class="id"> set</span> (<span class="id">T1</span><span class="id"> *</span><span class="id"> T2</span>).<br/>
<span class="vernacular">Let</span><span class="id"> f</span><span class="id"> :</span> (<span class="id">T1</span><span class="id"> *</span><span class="id"> T2</span>)<span class="id"> -&gt;</span><span class="id"> R</span><span class="id"> :=</span><span class="id"> \1_A</span>.<br/>
<br/>
<span class="vernacular">Let</span><span class="id"> F</span><span class="id"> :=</span><span class="id"> fubini_F</span><span class="id"> m2</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> f</span>).<br/>
<span class="vernacular">Let</span><span class="id"> G</span><span class="id"> :=</span><span class="id"> fubini_G</span><span class="id"> m1</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> f</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> indic_fubini_tonelli_F_ge0</span><span class="id"> x</span><span class="id"> :</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> F</span><span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> integral_ge0</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> y</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> lee_fin</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> indic_fubini_tonelli_G_ge0</span><span class="id"> x</span><span class="id"> :</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> G</span><span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> integral_ge0</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> y</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> lee_fin</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> indic_fubini_tonelli_FE</span><span class="id"> :</span><span class="id"> F</span><span class="id"> =</span><span class="id"> m2</span><span class="id"> \o</span><span class="id"> xsection</span><span class="id"> A</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">apply/funext</span><span class="id"> =&gt;</span><span class="id"> x/=</span>.<br/>
<span class="id">rewrite</span><span class="id"> -[RHS]mul1e</span><span class="id"> -integral_cst//;</span><span class="id"> last</span><span class="id"> exact:</span><span class="id"> measurable_xsection</span>.<br/>
<span class="id">rewrite</span><span class="id"> /F</span><span class="id"> /fubini_F</span><span class="id"> /f</span><span class="id"> [in</span><span class="id"> RHS]integral_mkcond</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> eq_integral</span><span class="id"> =&gt;</span><span class="id"> y</span><span class="id"> _</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> patchE</span><span class="id"> mem_xsection</span><span class="id"> indicE;</span><span class="id"> case:</span><span class="id"> ifPn</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> indic_fubini_tonelli_GE</span><span class="id"> :</span><span class="id"> G</span><span class="id"> =</span><span class="id"> m1</span><span class="id"> \o</span><span class="id"> ysection</span><span class="id"> A</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">apply/funext</span><span class="id"> =&gt;</span><span class="id"> x/=</span>.<br/>
<span class="id">rewrite</span><span class="id"> -[RHS]mul1e</span><span class="id"> -integral_cst//;</span><span class="id"> last</span><span class="id"> exact:</span><span class="id"> measurable_ysection</span>.<br/>
<span class="id">rewrite</span><span class="id"> /G</span><span class="id"> /fubini_G</span><span class="id"> /f</span><span class="id"> [in</span><span class="id"> RHS]integral_mkcond</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> eq_integral</span><span class="id"> =&gt;</span><span class="id"> y</span><span class="id"> _</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> patchE</span><span class="id"> mem_ysection</span><span class="id"> indicE;</span><span class="id"> case:</span><span class="id"> ifPn</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> indic_measurable_fun_fubini_tonelli_F</span><span class="id"> :</span><span class="id"> measurable_fun</span><span class="id"> setT</span><span class="id"> F</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> indic_fubini_tonelli_FE//;</span><span class="id"> exact:</span><span class="id"> measurable_fun_xsection</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> indic_measurable_fun_fubini_tonelli_G</span><span class="id"> :</span><span class="id"> measurable_fun</span><span class="id"> setT</span><span class="id"> G</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> indic_fubini_tonelli_GE//;</span><span class="id"> exact:</span><span class="id"> measurable_fun_ysection</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> indic_fubini_tonelli1</span><span class="id"> :</span><span class="id"> \int[m1</span><span class="id"> \x</span><span class="id"> m2]_z</span> (<span class="id">f</span><span class="id"> z</span>)<span class="id">%:E</span><span class="id"> =</span><span class="id"> \int[m1]_x</span><span class="id"> F</span><span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> /f</span><span class="id"> integral_indic//</span><span class="id"> setIT</span><span class="id"> indic_fubini_tonelli_FE</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> indic_fubini_tonelli2</span><span class="id"> :</span><span class="id"> \int[m1</span><span class="id"> \x^</span><span class="id"> m2]_z</span> (<span class="id">f</span><span class="id"> z</span>)<span class="id">%:E</span><span class="id"> =</span><span class="id"> \int[m2]_y</span><span class="id"> G</span><span class="id"> y</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> /f</span><span class="id"> integral_indic//</span><span class="id"> setIT</span><span class="id"> indic_fubini_tonelli_GE</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> indic_fubini_tonelli</span><span class="id"> :</span><span class="id"> \int[m1]_x</span><span class="id"> F</span><span class="id"> x</span><span class="id"> =</span><span class="id"> \int[m2]_y</span><span class="id"> G</span><span class="id"> y</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> -indic_fubini_tonelli1//</span><span class="id"> -indic_fubini_tonelli2//</span><span class="id"> integral_indic//=</span>.<br/>
<span class="id">rewrite</span><span class="id"> integral_indic//=</span><span class="id"> !setIT</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> product_measure_unique</span><span class="id"> =&gt;</span><span class="id"> //=</span><span class="id"> ?</span><span class="id"> ?</span><span class="id"> ?</span><span class="id"> ?;</span><span class="id"> rewrite</span><span class="id"> product_measure2E</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> indic_fubini_tonelli</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> sfun_fubini_tonelli</span>.<br/>
<span class="vernacular">Variable</span><span class="id"> f</span><span class="id"> :</span><span class="id"> {nnsfun</span><span class="id"> [the</span><span class="id"> measurableType</span><span class="id"> _</span><span class="id"> of</span><span class="id"> T1</span><span class="id"> *</span><span class="id"> T2</span><span class="id"> :</span><span class="id"> Type]</span><span class="id"> &gt;-&gt;</span><span class="id"> R}</span>.<br/>
<br/>
<span class="vernacular">Import</span><span class="id"> HBNNSimple</span>.<br/>
<br/>
<span class="vernacular">Let</span><span class="id"> F</span><span class="id"> :=</span><span class="id"> fubini_F</span><span class="id"> m2</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> f</span>).<br/>
<span class="vernacular">Let</span><span class="id"> G</span><span class="id"> :=</span><span class="id"> fubini_G</span><span class="id"> m1</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> f</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> sfun_fubini_tonelli_FE</span><span class="id"> :</span><span class="id"> F</span><span class="id"> =</span><span class="gallina-kwd"> fun</span><span class="id"> x</span><span class="id"> =&gt;</span><br/>
&nbsp;&nbsp;<span class="id">\sum_</span>(<span class="id">k</span><span class="id"> \in</span><span class="id"> range</span><span class="id"> f</span>)<span class="id"> k%:E</span><span class="id"> *</span><span class="id"> m2</span> (<span class="id">xsection</span> (<span class="id">f</span><span class="id"> @^-1`</span><span class="id"> [set</span><span class="id"> k]</span>)<span class="id"> x</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> funeqE</span><span class="id"> =&gt;</span><span class="id"> x;</span><span class="id"> rewrite</span><span class="id"> /F</span><span class="id"> /fubini_F</span><span class="id"> [in</span><span class="id"> LHS]/=</span>.<br/>
<span class="id">under</span><span class="id"> eq_fun</span><span class="id"> do</span><span class="id"> rewrite</span><span class="id"> fimfunE</span><span class="id"> -fsumEFin//</span>.<br/>
<span class="id">rewrite</span><span class="id"> ge0_integral_fsum</span><span class="id"> //;</span><span class="id"> last</span><span class="id"> 2</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> move=&gt;</span><span class="id"> i;</span><span class="id"> apply/measurable_EFinP/measurableT_comp</span><span class="id"> =&gt;</span><span class="id"> //=</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> measurableT_comp</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> r</span><span class="id"> y</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> EFinM</span><span class="id"> nnfun_muleindic_ge0</span>.<br/>
<span class="id">apply:</span><span class="id"> eq_fsbigr</span><span class="id"> =&gt;</span><span class="id"> i;</span><span class="id"> rewrite</span><span class="id"> inE</span><span class="id"> =&gt;</span><span class="id"> -[/=</span><span class="id"> t</span><span class="id"> _</span><span class="id"> &lt;-{i}]</span>.<br/>
<span class="id">under</span><span class="id"> eq_fun</span><span class="id"> do</span><span class="id"> rewrite</span><span class="id"> EFinM</span>.<br/>
<span class="id">rewrite</span><span class="id"> ge0_integralZl//;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> lee_fin</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> -/</span>((<span class="id">m2</span><span class="id"> \o</span><span class="id"> xsection</span><span class="id"> _</span>)<span class="id"> x</span>)<span class="id"> -indic_fubini_tonelli_FE</span>.<br/>
<span class="id">-</span><span class="id"> exact/measurable_EFinP/measurableT_comp</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> y</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> lee_fin</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> sfun_measurable_fun_fubini_tonelli_F</span><span class="id"> :</span><span class="id"> measurable_fun</span><span class="id"> [set:</span><span class="id"> T1]</span><span class="id"> F</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> sfun_fubini_tonelli_FE//;</span><span class="id"> apply:</span><span class="id"> emeasurable_fun_fsum</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> r</span>.<br/>
<span class="id">exact/measurable_funeM/measurable_fun_xsection</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> sfun_fubini_tonelli_GE</span><span class="id"> :</span><span class="id"> G</span><span class="id"> =</span><span class="gallina-kwd"> fun</span><span class="id"> y</span><span class="id"> =&gt;</span><br/>
&nbsp;&nbsp;<span class="id">\sum_</span>(<span class="id">k</span><span class="id"> \in</span><span class="id"> range</span><span class="id"> f</span>)<span class="id"> k%:E</span><span class="id"> *</span><span class="id"> m1</span> (<span class="id">ysection</span> (<span class="id">f</span><span class="id"> @^-1`</span><span class="id"> [set</span><span class="id"> k]</span>)<span class="id"> y</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> funeqE</span><span class="id"> =&gt;</span><span class="id"> y;</span><span class="id"> rewrite</span><span class="id"> /G</span><span class="id"> /fubini_G</span><span class="id"> [in</span><span class="id"> LHS]/=</span>.<br/>
<span class="id">under</span><span class="id"> eq_fun</span><span class="id"> do</span><span class="id"> rewrite</span><span class="id"> fimfunE</span><span class="id"> -fsumEFin//</span>.<br/>
<span class="id">rewrite</span><span class="id"> ge0_integral_fsum</span><span class="id"> //;</span><span class="id"> last</span><span class="id"> 2</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> move=&gt;</span><span class="id"> i;</span><span class="id"> apply/measurable_EFinP/measurableT_comp</span><span class="id"> =&gt;</span><span class="id"> //=</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> measurableT_comp</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> r</span><span class="id"> x</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> EFinM</span><span class="id"> nnfun_muleindic_ge0</span>.<br/>
<span class="id">apply:</span><span class="id"> eq_fsbigr</span><span class="id"> =&gt;</span><span class="id"> i;</span><span class="id"> rewrite</span><span class="id"> inE</span><span class="id"> =&gt;</span><span class="id"> -[/=</span><span class="id"> t</span><span class="id"> _</span><span class="id"> &lt;-{i}]</span>.<br/>
<span class="id">under</span><span class="id"> eq_fun</span><span class="id"> do</span><span class="id"> rewrite</span><span class="id"> EFinM</span>.<br/>
<span class="id">rewrite</span><span class="id"> ge0_integralZl//;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> lee_fin</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> -/</span>((<span class="id">m1</span><span class="id"> \o</span><span class="id"> ysection</span><span class="id"> _</span>)<span class="id"> y</span>)<span class="id"> -indic_fubini_tonelli_GE</span>.<br/>
<span class="id">-</span><span class="id"> exact/measurable_EFinP/measurableT_comp</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> lee_fin</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> sfun_measurable_fun_fubini_tonelli_G</span><span class="id"> :</span><span class="id"> measurable_fun</span><span class="id"> setT</span><span class="id"> G</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> sfun_fubini_tonelli_GE//;</span><span class="id"> apply:</span><span class="id"> emeasurable_fun_fsum</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> r</span>.<br/>
<span class="id">exact/measurable_funeM/measurable_fun_ysection</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Let</span><span class="id"> EFinf</span><span class="id"> x</span><span class="id"> :</span> (<span class="id">f</span><span class="id"> x</span>)<span class="id">%:E</span><span class="id"> =</span><br/>
&nbsp;&nbsp;<span class="id">\sum_</span>(<span class="id">k</span><span class="id"> \in</span><span class="id"> range</span><span class="id"> f</span>)<span class="id"> k%:E</span><span class="id"> *</span> (<span class="id">\1_</span>(<span class="id">f</span><span class="id"> @^-1`</span><span class="id"> [set</span><span class="id"> k]</span>)<span class="id"> x</span>)<span class="id">%:E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> fsumEFin</span><span class="id"> //=</span><span class="id"> fimfunE</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> sfun_fubini_tonelli1</span><span class="id"> :</span><span class="id"> \int[m1</span><span class="id"> \x</span><span class="id"> m2]_z</span> (<span class="id">f</span><span class="id"> z</span>)<span class="id">%:E</span><span class="id"> =</span><span class="id"> \int[m1]_x</span><span class="id"> F</span><span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">under</span><span class="id"> [LHS]eq_integral</span><br/>
&nbsp;&nbsp;<span class="id">do</span><span class="id"> rewrite</span><span class="id"> EFinf;</span><span class="id"> rewrite</span><span class="id"> ge0_integral_fsum</span><span class="id"> //;</span><span class="id"> last</span><span class="id"> 2</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> r;</span><span class="id"> exact/measurable_EFinP/measurableT_comp</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> r</span><span class="id"> /=</span><span class="id"> z</span><span class="id"> _;</span><span class="id"> exact:</span><span class="id"> nnfun_muleindic_ge0</span>.<br/>
<span class="id">transitivity</span> (<span class="id">\sum_</span>(<span class="id">k</span><span class="id"> \in</span><span class="id"> range</span><span class="id"> f</span>)<br/>
&nbsp;&nbsp;<span class="id">\int[m1]_x</span> (<span class="id">k%:E</span><span class="id"> *</span><span class="id"> fubini_F</span><span class="id"> m2</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> \1_</span>(<span class="id">f</span><span class="id"> @^-1`</span><span class="id"> [set</span><span class="id"> k]</span>))<span class="id"> x</span>)).<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> eq_fsbigr</span><span class="id"> =&gt;</span><span class="id"> i;</span><span class="id"> rewrite</span><span class="id"> inE</span><span class="id"> =&gt;</span><span class="id"> -[z</span><span class="id"> _</span><span class="id"> &lt;-{i}]</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> ge0_integralZl//;</span><span class="id"> last</span><span class="id"> 3</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="id"> exact/measurable_EFinP</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> /=</span><span class="id"> x</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> lee_fin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> lee_fin</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> indic_fubini_tonelli1//</span><span class="id"> -ge0_integralZl//;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> lee_fin</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> exact:</span><span class="id"> indic_measurable_fun_fubini_tonelli_F</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> /=</span><span class="id"> x</span><span class="id"> _;</span><span class="id"> exact:</span><span class="id"> indic_fubini_tonelli_F_ge0</span>.<br/>
<span class="id">rewrite</span><span class="id"> -ge0_integral_fsum</span><span class="id"> //;</span><span class="id"> last</span><span class="id"> 2</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> r;</span><span class="id"> apply/measurable_funeM/indic_measurable_fun_fubini_tonelli_F</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> move=&gt;</span><span class="id"> r</span><span class="id"> x</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> /fubini_F</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">have</span><span class="id"> [r0|r0]</span><span class="id"> :=</span><span class="id"> leP</span><span class="id"> 0%R</span><span class="id"> r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> mule_ge0//;</span><span class="id"> exact:</span><span class="id"> indic_fubini_tonelli_F_ge0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> integral0_eq</span><span class="id"> ?mule0//</span><span class="id"> =&gt;</span><span class="id"> y</span><span class="id"> _</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> preimage_nnfun0//=</span><span class="id"> indicE</span><span class="id"> in_set0</span>.<br/>
<span class="id">apply:</span><span class="id"> eq_integral</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> sfun_fubini_tonelli_FE</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> under</span><span class="id"> eq_fsbigr</span><span class="id"> do</span><span class="id"> rewrite</span><span class="id"> indic_fubini_tonelli_FE//</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> sfun_fubini_tonelli2</span><span class="id"> :</span><span class="id"> \int[m1</span><span class="id"> \x^</span><span class="id"> m2]_z</span> (<span class="id">f</span><span class="id"> z</span>)<span class="id">%:E</span><span class="id"> =</span><span class="id"> \int[m2]_y</span><span class="id"> G</span><span class="id"> y</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">under</span><span class="id"> [LHS]eq_integral</span><br/>
&nbsp;&nbsp;<span class="id">do</span><span class="id"> rewrite</span><span class="id"> EFinf;</span><span class="id"> rewrite</span><span class="id"> ge0_integral_fsum</span><span class="id"> //;</span><span class="id"> last</span><span class="id"> 2</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> i;</span><span class="id"> exact/measurable_EFinP/measurableT_comp</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> r</span><span class="id"> /=</span><span class="id"> z</span><span class="id"> _;</span><span class="id"> exact:</span><span class="id"> nnfun_muleindic_ge0</span>.<br/>
<span class="id">transitivity</span> (<span class="id">\sum_</span>(<span class="id">k</span><span class="id"> \in</span><span class="id"> range</span><span class="id"> f</span>)<br/>
&nbsp;&nbsp;<span class="id">\int[m2]_x</span> (<span class="id">k%:E</span><span class="id"> *</span> (<span class="id">fubini_G</span><span class="id"> m1</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> \1_</span>(<span class="id">f</span><span class="id"> @^-1`</span><span class="id"> [set</span><span class="id"> k]</span>))<span class="id"> x</span>))).<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> eq_fsbigr</span><span class="id"> =&gt;</span><span class="id"> i;</span><span class="id"> rewrite</span><span class="id"> inE</span><span class="id"> =&gt;</span><span class="id"> -[z</span><span class="id"> _</span><span class="id"> &lt;-{i}]</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> ge0_integralZl//;</span><span class="id"> last</span><span class="id"> 3</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="id"> exact/measurable_EFinP</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> /=</span><span class="id"> x</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> lee_fin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> lee_fin</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> indic_fubini_tonelli2//</span><span class="id"> -ge0_integralZl//;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> lee_fin</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> exact:</span><span class="id"> indic_measurable_fun_fubini_tonelli_G</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> /=</span><span class="id"> x</span><span class="id"> _;</span><span class="id"> exact:</span><span class="id"> indic_fubini_tonelli_G_ge0</span>.<br/>
<span class="id">rewrite</span><span class="id"> -ge0_integral_fsum</span><span class="id"> //;</span><span class="id"> last</span><span class="id"> 2</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> r;</span><span class="id"> apply/measurable_funeM/indic_measurable_fun_fubini_tonelli_G</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> move=&gt;</span><span class="id"> r</span><span class="id"> y</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> /fubini_G</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">have</span><span class="id"> [r0|r0]</span><span class="id"> :=</span><span class="id"> leP</span><span class="id"> 0%R</span><span class="id"> r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> mule_ge0//;</span><span class="id"> exact:</span><span class="id"> indic_fubini_tonelli_G_ge0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> integral0_eq</span><span class="id"> ?mule0//</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> _</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> preimage_nnfun0//=</span><span class="id"> indicE</span><span class="id"> in_set0</span>.<br/>
<span class="id">apply:</span><span class="id"> eq_integral</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> sfun_fubini_tonelli_GE</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> under</span><span class="id"> eq_fsbigr</span><span class="id"> do</span><span class="id"> rewrite</span><span class="id"> indic_fubini_tonelli_GE//</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> sfun_fubini_tonelli</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">\int[m1</span><span class="id"> \x</span><span class="id"> m2]_z</span> (<span class="id">f</span><span class="id"> z</span>)<span class="id">%:E</span><span class="id"> =</span><span class="id"> \int[m1</span><span class="id"> \x^</span><span class="id"> m2]_z</span> (<span class="id">f</span><span class="id"> z</span>)<span class="id">%:E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">apply:</span><span class="id"> eq_measure_integral</span><span class="id"> =&gt;</span><span class="id"> /=</span><span class="id"> A</span><span class="id"> Ameasurable</span><span class="id"> _</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> product_measure_unique</span><span class="id"> =&gt;</span><span class="id"> //=</span><span class="id"> *;</span><span class="id"> rewrite</span><span class="id"> product_measure2E</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> sfun_fubini_tonelli</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> fubini_tonelli</span>.<br/>
<span class="vernacular">Variable</span><span class="id"> f</span><span class="id"> :</span><span class="id"> T1</span><span class="id"> *</span><span class="id"> T2</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>.<br/>
<span class="vernacular">Hypothesis</span><span class="id"> mf</span><span class="id"> :</span><span class="id"> measurable_fun</span><span class="id"> setT</span><span class="id"> f</span>.<br/>
<span class="vernacular">Hypothesis</span><span class="id"> f0</span><span class="id"> :</span><span class="gallina-kwd"> forall</span><span class="id"> x,</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> f</span><span class="id"> x</span>.<br/>
<span class="vernacular">Let</span><span class="id"> T</span><span class="id"> :=</span><span class="id"> [the</span><span class="id"> measurableType</span><span class="id"> _</span><span class="id"> of</span><span class="id"> T1</span><span class="id"> *</span><span class="id"> T2</span><span class="id"> :</span><span class="id"> Type]</span>.<br/>
<br/>
<span class="vernacular">Let</span><span class="id"> F</span><span class="id"> :=</span><span class="id"> fubini_F</span><span class="id"> m2</span><span class="id"> f</span>.<br/>
<span class="vernacular">Let</span><span class="id"> G</span><span class="id"> :=</span><span class="id"> fubini_G</span><span class="id"> m1</span><span class="id"> f</span>.<br/>
<br/>
<span class="vernacular">Import</span><span class="id"> HBNNSimple</span>.<br/>
<br/>
<span class="vernacular">Let</span><span class="id"> F_</span> (<span class="id">g</span><span class="id"> :</span><span class="id"> {nnsfun</span><span class="id"> T</span><span class="id"> &gt;-&gt;</span><span class="id"> R}^nat</span>)<span class="id"> n</span><span class="id"> x</span><span class="id"> :=</span><span class="id"> \int[m2]_y</span> (<span class="id">g</span><span class="id"> n</span> (<span class="id">x,</span><span class="id"> y</span>))<span class="id">%:E</span>.<br/>
<span class="vernacular">Let</span><span class="id"> G_</span> (<span class="id">g</span><span class="id"> :</span><span class="id"> {nnsfun</span><span class="id"> T</span><span class="id"> &gt;-&gt;</span><span class="id"> R}^nat</span>)<span class="id"> n</span><span class="id"> y</span><span class="id"> :=</span><span class="id"> \int[m1]_x</span> (<span class="id">g</span><span class="id"> n</span> (<span class="id">x,</span><span class="id"> y</span>))<span class="id">%:E</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> measurable_fun_fubini_tonelli_F</span><span class="id"> :</span><span class="id"> measurable_fun</span><span class="id"> setT</span><span class="id"> F</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">have</span><span class="id"> [g</span><span class="id"> [g_nd</span><span class="id"> /=</span><span class="id"> g_f]]</span><span class="id"> :=</span><span class="id"> approximation</span><span class="id"> measurableT</span><span class="id"> mf</span> (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> _</span><span class="id"> =&gt;</span><span class="id"> f0</span><span class="id"> x</span>).<br/>
<span class="id">apply:</span> (<span class="id">emeasurable_fun_cvg</span> (<span class="id">F_</span><span class="id"> g</span>))<span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> n;</span><span class="id"> exact:</span><span class="id"> sfun_measurable_fun_fubini_tonelli_F</span>.<br/>
<span class="id">-</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> _</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> /F_</span><span class="id"> /F</span><span class="id"> /fubini_F</span><span class="id"> [in</span><span class="id"> X</span><span class="gallina-kwd"> in</span><span class="id"> _</span><span class="id"> --&gt;</span><span class="id"> X]</span>(_<span class="id"> :</span> (<span class="gallina-kwd">fun</span><span class="id"> _</span><span class="id"> =&gt;</span><span class="id"> _</span>)<span class="id"> =</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">fun</span><span class="id"> y</span><span class="id"> =&gt;</span><span class="id"> limn</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> g</span><span class="id"> ^~</span> (<span class="id">x,</span><span class="id"> y</span>)))<span class="id">;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> funeqE</span><span class="id"> =&gt;</span><span class="id"> y;</span><span class="id"> apply/esym/cvg_lim</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> g_f</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> cvg_monotone_convergence</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> n;</span><span class="id"> apply/measurable_EFinP</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact/measurableT_comp</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> n</span><span class="id"> y</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> lee_fin//;</span><span class="id"> exact:</span><span class="id"> fun_ge0</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> y</span><span class="id"> _</span><span class="id"> a</span><span class="id"> b</span><span class="id"> ab;</span><span class="id"> rewrite</span><span class="id"> lee_fin;</span><span class="id"> exact/lefP/g_nd</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> measurable_fun_fubini_tonelli_G</span><span class="id"> :</span><span class="id"> measurable_fun</span><span class="id"> setT</span><span class="id"> G</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">have</span><span class="id"> [g</span><span class="id"> [g_nd</span><span class="id"> /=</span><span class="id"> g_f]]</span><span class="id"> :=</span><span class="id"> approximation</span><span class="id"> measurableT</span><span class="id"> mf</span> (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> _</span><span class="id"> =&gt;</span><span class="id"> f0</span><span class="id"> x</span>).<br/>
<span class="id">apply:</span> (<span class="id">emeasurable_fun_cvg</span> (<span class="id">G_</span><span class="id"> g</span>))<span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> n;</span><span class="id"> exact:</span><span class="id"> sfun_measurable_fun_fubini_tonelli_G</span>.<br/>
<span class="id">-</span><span class="id"> move=&gt;</span><span class="id"> y</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> /G_</span><span class="id"> /G</span><span class="id"> /fubini_G</span><span class="id"> [in</span><span class="id"> X</span><span class="gallina-kwd"> in</span><span class="id"> _</span><span class="id"> --&gt;</span><span class="id"> X]</span>(_<span class="id"> :</span> (<span class="gallina-kwd">fun</span><span class="id"> _</span><span class="id"> =&gt;</span><span class="id"> _</span>)<span class="id"> =</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> limn</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> g</span><span class="id"> ^~</span> (<span class="id">x,</span><span class="id"> y</span>)))<span class="id">;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> funeqE</span><span class="id"> =&gt;</span><span class="id"> x;</span><span class="id"> apply/esym/cvg_lim</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> g_f</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> cvg_monotone_convergence</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> n;</span><span class="id"> apply/measurable_EFinP</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact/measurableT_comp</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> n</span><span class="id"> x</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> lee_fin;</span><span class="id"> exact:</span><span class="id"> fun_ge0</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> _</span><span class="id"> a</span><span class="id"> b</span><span class="id"> ab;</span><span class="id"> rewrite</span><span class="id"> lee_fin;</span><span class="id"> exact/lefP/g_nd</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> fubini_tonelli1</span><span class="id"> :</span><span class="id"> \int[m1</span><span class="id"> \x</span><span class="id"> m2]_z</span><span class="id"> f</span><span class="id"> z</span><span class="id"> =</span><span class="id"> \int[m1]_x</span><span class="id"> F</span><span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">have</span><span class="id"> [g</span><span class="id"> [g_nd</span><span class="id"> /=</span><span class="id"> g_f]]</span><span class="id"> :=</span><span class="id"> approximation</span><span class="id"> measurableT</span><span class="id"> mf</span> (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> _</span><span class="id"> =&gt;</span><span class="id"> f0</span><span class="id"> x</span>).<br/>
<span class="id">have</span><span class="id"> F_F</span><span class="id"> x</span><span class="id"> :</span><span class="id"> F</span><span class="id"> x</span><span class="id"> =</span><span class="id"> limn</span> (<span class="id">F_</span><span class="id"> g</span><span class="id"> ^~</span><span class="id"> x</span>).<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> [RHS]</span>(_<span class="id"> :</span><span class="id"> _</span><span class="id"> =</span><span class="id"> limn</span> (<span class="gallina-kwd">fun</span><span class="id"> n</span><span class="id"> =&gt;</span><span class="id"> \int[m2]_y</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> g</span><span class="id"> n</span>) (<span class="id">x,</span><span class="id"> y</span>)))<span class="id">//</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -monotone_convergence//;</span><span class="id"> last</span><span class="id"> 3</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> n;</span><span class="id"> exact/measurable_EFinP/measurableT_comp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> n</span><span class="id"> /=</span><span class="id"> y</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> lee_fin;</span><span class="id"> exact:</span><span class="id"> fun_ge0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> y</span><span class="id"> /=</span><span class="id"> _</span><span class="id"> a</span><span class="id"> b;</span><span class="id"> rewrite</span><span class="id"> lee_fin</span><span class="id"> =&gt;</span><span class="id"> /g_nd/lefP;</span><span class="id"> exact</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> eq_integral</span><span class="id"> =&gt;</span><span class="id"> y</span><span class="id"> _;</span><span class="id"> apply/esym/cvg_lim</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> g_f</span>.<br/>
<span class="id">rewrite</span><span class="id"> [RHS]</span>(_<span class="id"> :</span><span class="id"> _</span><span class="id"> =</span><span class="id"> limn</span> (<span class="gallina-kwd">fun</span><span class="id"> n</span><span class="id"> =&gt;</span><span class="id"> \int[m1</span><span class="id"> \x</span><span class="id"> m2]_z</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> g</span><span class="id"> n</span>)<span class="id"> z</span>)).<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -monotone_convergence</span><span class="id"> //;</span><span class="id"> last</span><span class="id"> 3</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> n;</span><span class="id"> exact/measurable_EFinP</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> n</span><span class="id"> /=</span><span class="id"> x</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> lee_fin;</span><span class="id"> exact:</span><span class="id"> fun_ge0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> y</span><span class="id"> /=</span><span class="id"> _</span><span class="id"> a</span><span class="id"> b;</span><span class="id"> rewrite</span><span class="id"> lee_fin</span><span class="id"> =&gt;</span><span class="id"> /g_nd/lefP;</span><span class="id"> exact</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> eq_integral</span><span class="id"> =&gt;</span><span class="id"> /=</span><span class="id"> x</span><span class="id"> _;</span><span class="id"> apply/esym/cvg_lim</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> g_f</span>.<br/>
<span class="id">rewrite</span><span class="id"> [LHS]</span>(_<span class="id"> :</span><span class="id"> _</span><span class="id"> =</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">limn</span> (<span class="gallina-kwd">fun</span><span class="id"> n</span><span class="id"> =&gt;</span><span class="id"> \int[m1]_x</span> (<span class="id">\int[m2]_y</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> g</span><span class="id"> n</span>) (<span class="id">x,</span><span class="id"> y</span>)))).<br/>
&nbsp;&nbsp;<span class="id">set</span><span class="id"> r</span><span class="id"> :=</span><span class="gallina-kwd"> fun</span><span class="id"> _</span><span class="id"> =&gt;</span><span class="id"> _;</span><span class="id"> set</span><span class="id"> l</span><span class="id"> :=</span><span class="gallina-kwd"> fun</span><span class="id"> _</span><span class="id"> =&gt;</span><span class="id"> _;</span><span class="id"> have</span><span class="id"> -&gt;</span><span class="id"> //</span><span class="id"> :</span><span class="id"> l</span><span class="id"> =</span><span class="id"> r</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply/funext</span> <span class="id"> =&gt;</span><span class="id"> n;</span><span class="id"> rewrite</span><span class="id"> /l</span><span class="id"> /r</span><span class="id"> sfun_fubini_tonelli1</span>.<br/>
<span class="id">rewrite</span><span class="id"> [RHS]</span>(_<span class="id"> :</span><span class="id"> _</span><span class="id"> =</span><span class="id"> limn</span> (<span class="gallina-kwd">fun</span><span class="id"> n</span><span class="id"> =&gt;</span><span class="id"> \int[m1]_x</span><span class="id"> F_</span><span class="id"> g</span><span class="id"> n</span><span class="id"> x</span>))<span class="id">//</span>.<br/>
<span class="id">rewrite</span><span class="id"> -monotone_convergence</span><span class="id"> //;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> eq_integral</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> n;</span><span class="id"> exact:</span><span class="id"> sfun_measurable_fun_fubini_tonelli_F</span>.<br/>
<span class="id">-</span><span class="id"> move=&gt;</span><span class="id"> n</span><span class="id"> x</span><span class="id"> _;</span><span class="id"> apply:</span><span class="id"> integral_ge0</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> y</span><span class="id"> _</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> lee_fin</span>.<br/>
&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> fun_ge0</span>.<br/>
<span class="id">-</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> /=</span><span class="id"> _</span><span class="id"> a</span><span class="id"> b</span><span class="id"> ab;</span><span class="id"> apply:</span><span class="id"> ge0_le_integral</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> y</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> lee_fin;</span><span class="id"> exact:</span><span class="id"> fun_ge0</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="id"> exact/measurable_EFinP/measurableT_comp</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> *;</span><span class="id"> rewrite</span><span class="id"> lee_fin;</span><span class="id"> exact:</span><span class="id"> fun_ge0</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="id"> exact/measurable_EFinP/measurableT_comp</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> y</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> lee_fin;</span><span class="id"> move/g_nd</span><span class="id"> :</span><span class="id"> ab</span><span class="id"> =&gt;</span><span class="id"> /lefP;</span><span class="id"> exact</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> fubini_tonelli2</span><span class="id"> :</span><span class="id"> \int[m1</span><span class="id"> \x</span><span class="id"> m2]_z</span><span class="id"> f</span><span class="id"> z</span><span class="id"> =</span><span class="id"> \int[m2]_y</span><span class="id"> G</span><span class="id"> y</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">have</span><span class="id"> [g</span><span class="id"> [g_nd</span><span class="id"> /=</span><span class="id"> g_f]]</span><span class="id"> :=</span><span class="id"> approximation</span><span class="id"> measurableT</span><span class="id"> mf</span> (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> _</span><span class="id"> =&gt;</span><span class="id"> f0</span><span class="id"> x</span>).<br/>
<span class="id">have</span><span class="id"> G_G</span><span class="id"> y</span><span class="id"> :</span><span class="id"> G</span><span class="id"> y</span><span class="id"> =</span><span class="id"> limn</span> (<span class="id">G_</span><span class="id"> g</span><span class="id"> ^~</span><span class="id"> y</span>).<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> /G</span><span class="id"> /fubini_G</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> [RHS]</span>(_<span class="id"> :</span><span class="id"> _</span><span class="id"> =</span><span class="id"> limn</span> (<span class="gallina-kwd">fun</span><span class="id"> n</span><span class="id"> =&gt;</span><span class="id"> \int[m1]_x</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> g</span><span class="id"> n</span>) (<span class="id">x,</span><span class="id"> y</span>)))<span class="id">//</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -monotone_convergence//;</span><span class="id"> last</span><span class="id"> 3</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> n;</span><span class="id"> exact/measurable_EFinP/measurableT_comp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> n</span><span class="id"> /=</span><span class="id"> x</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> lee_fin;</span><span class="id"> exact:</span><span class="id"> fun_ge0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> /=</span><span class="id"> _</span><span class="id"> a</span><span class="id"> b;</span><span class="id"> rewrite</span><span class="id"> lee_fin</span><span class="id"> =&gt;</span><span class="id"> /g_nd/lefP;</span><span class="id"> exact</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> eq_integral</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> _;</span><span class="id"> apply/esym/cvg_lim</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> g_f</span>.<br/>
<span class="id">rewrite</span><span class="id"> [RHS]</span>(_<span class="id"> :</span><span class="id"> _</span><span class="id"> =</span><span class="id"> limn</span> (<span class="gallina-kwd">fun</span><span class="id"> n</span><span class="id"> =&gt;</span><span class="id"> \int[m1</span><span class="id"> \x</span><span class="id"> m2]_z</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> g</span><span class="id"> n</span>)<span class="id"> z</span>)).<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -monotone_convergence</span><span class="id"> //;</span><span class="id"> last</span><span class="id"> 3</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> n;</span><span class="id"> exact/measurable_EFinP</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> n</span><span class="id"> /=</span><span class="id"> x</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> lee_fin;</span><span class="id"> exact:</span><span class="id"> fun_ge0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> y</span><span class="id"> /=</span><span class="id"> _</span><span class="id"> a</span><span class="id"> b;</span><span class="id"> rewrite</span><span class="id"> lee_fin</span><span class="id"> =&gt;</span><span class="id"> /g_nd/lefP;</span><span class="id"> exact</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> eq_integral</span><span class="id"> =&gt;</span><span class="id"> /=</span><span class="id"> x</span><span class="id"> _;</span><span class="id"> apply/esym/cvg_lim</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> g_f</span>.<br/>
<span class="id">rewrite</span><span class="id"> [LHS]</span>(_<span class="id"> :</span><span class="id"> _</span><span class="id"> =</span><span class="id"> limn</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="gallina-kwd">fun</span><span class="id"> n</span><span class="id"> =&gt;</span><span class="id"> \int[m2]_y</span> (<span class="id">\int[m1]_x</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> g</span><span class="id"> n</span>) (<span class="id">x,</span><span class="id"> y</span>)))).<br/>
&nbsp;&nbsp;<span class="id">set</span><span class="id"> r</span><span class="id"> :=</span><span class="gallina-kwd"> fun</span><span class="id"> _</span><span class="id"> =&gt;</span><span class="id"> _;</span><span class="id"> set</span><span class="id"> l</span><span class="id"> :=</span><span class="gallina-kwd"> fun</span><span class="id"> _</span><span class="id"> =&gt;</span><span class="id"> _;</span><span class="id"> have</span><span class="id"> -&gt;</span><span class="id"> //</span><span class="id"> :</span><span class="id"> l</span><span class="id"> =</span><span class="id"> r</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply/funext</span><span class="id"> =&gt;</span><span class="id"> n;</span><span class="id"> rewrite</span><span class="id"> /l</span><span class="id"> /r</span><span class="id"> sfun_fubini_tonelli</span><span class="id"> sfun_fubini_tonelli2</span>.<br/>
<span class="id">rewrite</span><span class="id"> [RHS]</span>(_<span class="id"> :</span><span class="id"> _</span><span class="id"> =</span><span class="id"> limn</span> (<span class="gallina-kwd">fun</span><span class="id"> n</span><span class="id"> =&gt;</span><span class="id"> \int[m2]_y</span><span class="id"> G_</span><span class="id"> g</span><span class="id"> n</span><span class="id"> y</span>))<span class="id">//</span>.<br/>
<span class="id">rewrite</span><span class="id"> -monotone_convergence</span><span class="id"> //;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> eq_integral</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> n;</span><span class="id"> exact:</span><span class="id"> sfun_measurable_fun_fubini_tonelli_G</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> n</span><span class="id"> y</span><span class="id"> _;</span><span class="id"> apply:</span><span class="id"> integral_ge0</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> x</span><span class="id"> _</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> lee_fin</span><span class="id"> fun_ge0</span>.<br/>
<span class="id">-</span><span class="id"> move=&gt;</span><span class="id"> y</span><span class="id"> /=</span><span class="id"> _</span><span class="id"> a</span><span class="id"> b</span><span class="id"> ab;</span><span class="id"> apply:</span><span class="id"> ge0_le_integral</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> lee_fin</span><span class="id"> fun_ge0</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="id"> exact/measurable_EFinP/measurableT_comp</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> *;</span><span class="id"> rewrite</span><span class="id"> lee_fin</span><span class="id"> fun_ge0</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="id"> exact/measurable_EFinP/measurableT_comp</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> lee_fin;</span><span class="id"> move/g_nd</span><span class="id"> :</span><span class="id"> ab</span><span class="id"> =&gt;</span><span class="id"> /lefP;</span><span class="id"> exact</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> fubini_tonelli</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">\int[m1]_x</span><span class="id"> \int[m2]_y</span><span class="id"> f</span> (<span class="id">x,</span><span class="id"> y</span>)<span class="id"> =</span><span class="id"> \int[m2]_y</span><span class="id"> \int[m1]_x</span><span class="id"> f</span> (<span class="id">x,</span><span class="id"> y</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> -fubini_tonelli1//</span><span class="id"> fubini_tonelli2</span>. Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> fubini_tonelli</span>.<br/>
<br/>
<span class="vernacular">End</span><span class="id"> fubini_tonelli</span>.<br/>
<span class="vernacular">Arguments</span><span class="id"> fubini_tonelli1</span><span class="id"> {d1</span><span class="id"> d2</span><span class="id"> T1</span><span class="id"> T2</span><span class="id"> R</span><span class="id"> m1</span><span class="id"> m2}</span><span class="id"> f</span>.<br/>
<span class="vernacular">Arguments</span><span class="id"> fubini_tonelli2</span><span class="id"> {d1</span><span class="id"> d2</span><span class="id"> T1</span><span class="id"> T2</span><span class="id"> R</span><span class="id"> m1</span><span class="id"> m2}</span><span class="id"> f</span>.<br/>
<span class="vernacular">Arguments</span><span class="id"> fubini_tonelli</span><span class="id"> {d1</span><span class="id"> d2</span><span class="id"> T1</span><span class="id"> T2</span><span class="id"> R</span><span class="id"> m1</span><span class="id"> m2}</span><span class="id"> f</span>.<br/>
<span class="vernacular">Arguments</span><span class="id"> measurable_fun_fubini_tonelli_F</span><span class="id"> {d1</span><span class="id"> d2</span><span class="id"> T1</span><span class="id"> T2</span><span class="id"> R</span><span class="id"> m2}</span><span class="id"> f</span>.<br/>
<span class="vernacular">Arguments</span><span class="id"> measurable_fun_fubini_tonelli_G</span><span class="id"> {d1</span><span class="id"> d2</span><span class="id"> T1</span><span class="id"> T2</span><span class="id"> R</span><span class="id"> m1}</span><span class="id"> f</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> fubini</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<span class="vernacular">Context</span><span class="id"> d1</span><span class="id"> d2</span> (<span class="id">T1</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d1</span>) (<span class="id">T2</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d2</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>).<br/>
<span class="vernacular">Variable</span><span class="id"> m1</span><span class="id"> :</span><span class="id"> {sigma_finite_measure</span><span class="id"> set</span><span class="id"> T1</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R}</span>.<br/>
<span class="vernacular">Variable</span><span class="id"> m2</span><span class="id"> :</span><span class="id"> {sigma_finite_measure</span><span class="id"> set</span><span class="id"> T2</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R}</span>.<br/>
<span class="vernacular">Variable</span><span class="id"> f</span><span class="id"> :</span><span class="id"> T1</span><span class="id"> *</span><span class="id"> T2</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>.<br/>
<br/>
<span class="vernacular">Hypothesis</span><span class="id"> imf</span><span class="id"> :</span> (<span class="id">m1</span><span class="id"> \x</span><span class="id"> m2</span>).<span class="id">-integrable</span><span class="id"> setT</span><span class="id"> f</span>.<br/>
<span class="vernacular">Let</span><span class="id"> mf</span><span class="id"> :</span><span class="id"> measurable_fun</span><span class="id"> setT</span><span class="id"> f</span><br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id"> exact:</span><span class="id"> measurable_int</span><span class="id"> imf</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> fubini1a</span><span class="id"> :</span><br/>
&nbsp;&nbsp;(<span class="id">m1</span><span class="id"> \x</span><span class="id"> m2</span>).<span class="id">-integrable</span><span class="id"> setT</span><span class="id"> f</span><span class="id"> &lt;-&gt;</span><span class="id"> \int[m1]_x</span><span class="id"> \int[m2]_y</span><span class="id"> `|f</span> (<span class="id">x,</span><span class="id"> y</span>)<span class="id">|</span><span class="id"> &lt;</span><span class="id"> +oo</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">split=&gt;</span><span class="id"> [/integrableP[_]|]</span><span class="id"> ioo;</span><span class="id"> [|apply/integrableP;</span><span class="id"> split=&gt;</span><span class="id"> [//|]]</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> -</span>(<span class="id">fubini_tonelli1</span> (<span class="id">abse</span><span class="id"> \o</span><span class="id"> f</span>))<span class="id">//=;</span><span class="id"> exact:</span><span class="id"> measurableT_comp</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> fubini_tonelli1//;</span><span class="id"> exact:</span><span class="id"> measurableT_comp</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> fubini1b</span><span class="id"> :</span><br/>
&nbsp;&nbsp;(<span class="id">m1</span><span class="id"> \x</span><span class="id"> m2</span>).<span class="id">-integrable</span><span class="id"> setT</span><span class="id"> f</span><span class="id"> &lt;-&gt;</span><span class="id"> \int[m2]_y</span><span class="id"> \int[m1]_x</span><span class="id"> `|f</span> (<span class="id">x,</span><span class="id"> y</span>)<span class="id">|</span><span class="id"> &lt;</span><span class="id"> +oo</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">split=&gt;</span><span class="id"> [/integrableP[_]|]</span><span class="id"> ioo;</span><span class="id"> [|apply/integrableP;</span><span class="id"> split=&gt;</span><span class="id"> [//|]]</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> -</span>(<span class="id">fubini_tonelli2</span> (<span class="id">abse</span><span class="id"> \o</span><span class="id"> f</span>))<span class="id">//=;</span><span class="id"> exact:</span><span class="id"> measurableT_comp</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> fubini_tonelli2//;</span><span class="id"> exact:</span><span class="id"> measurableT_comp</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Let</span><span class="id"> measurable_fun1</span><span class="id"> :</span><span class="id"> measurable_fun</span><span class="id"> setT</span> (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> \int[m2]_y</span><span class="id"> `|f</span> (<span class="id">x,</span><span class="id"> y</span>)<span class="id">|</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">apply:</span> (<span class="id">measurable_fun_fubini_tonelli_F</span> (<span class="id">abse</span><span class="id"> \o</span><span class="id"> f</span>))<span class="id"> =&gt;</span><span class="id"> //=</span>.<br/>
<span class="id">exact:</span><span class="id"> measurableT_comp</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Let</span><span class="id"> measurable_fun2</span><span class="id"> :</span><span class="id"> measurable_fun</span><span class="id"> setT</span> (<span class="gallina-kwd">fun</span><span class="id"> y</span><span class="id"> =&gt;</span><span class="id"> \int[m1]_x</span><span class="id"> `|f</span> (<span class="id">x,</span><span class="id"> y</span>)<span class="id">|</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">apply:</span> (<span class="id">measurable_fun_fubini_tonelli_G</span> (<span class="id">abse</span><span class="id"> \o</span><span class="id"> f</span>))<span class="id"> =&gt;</span><span class="id"> //=</span>.<br/>
<span class="id">exact:</span><span class="id"> measurableT_comp</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> ae_integrable1</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">{ae</span><span class="id"> m1,</span><span class="gallina-kwd"> forall</span><span class="id"> x,</span><span class="id"> m2</span>.<span class="id">-integrable</span><span class="id"> setT</span> (<span class="gallina-kwd">fun</span><span class="id"> y</span><span class="id"> =&gt;</span><span class="id"> f</span> (<span class="id">x,</span><span class="id"> y</span>))<span class="id">}</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">have</span><span class="id"> :</span><span class="id"> m1</span>.<span class="id">-integrable</span><span class="id"> setT</span> (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> \int[m2]_y</span><span class="id"> `|f</span> (<span class="id">x,</span><span class="id"> y</span>)<span class="id">|</span>).<br/>
&nbsp;&nbsp;<span class="id">apply/integrableP;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> (<span class="id">le_lt_trans</span><span class="id"> _</span>  (<span class="id">fubini1a</span>.<span class="id">1</span><span class="id"> imf</span>))<span class="id">//</span><span class="id"> ge0_le_integral</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> exact:</span><span class="id"> measurableT_comp</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> *;</span><span class="id"> exact:</span><span class="id"> integral_ge0</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> *;</span><span class="id"> rewrite</span><span class="id"> gee0_abs//;</span><span class="id"> exact:</span><span class="id"> integral_ge0</span>.<br/>
<span class="id">move/integrable_ae</span><span class="id"> =&gt;</span><span class="id"> /</span>(_<span class="id"> measurableT</span>)<span class="id">;</span><span class="id"> apply:</span><span class="id"> filterS</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> /=</span><span class="id"> /</span>(_<span class="id"> I</span>)<span class="id"> im2f</span>.<br/>
<span class="id">apply/integrableP;</span><span class="id"> split;</span><span class="id"> first</span><span class="id"> exact/measurableT_comp</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> move/fin_numPlt</span><span class="id"> :</span><span class="id"> im2f</span><span class="id"> =&gt;</span><span class="id"> /andP[]</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> ae_integrable2</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">{ae</span><span class="id"> m2,</span><span class="gallina-kwd"> forall</span><span class="id"> y,</span><span class="id"> m1</span>.<span class="id">-integrable</span><span class="id"> setT</span> (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> f</span> (<span class="id">x,</span><span class="id"> y</span>))<span class="id">}</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">have</span><span class="id"> :</span><span class="id"> m2</span>.<span class="id">-integrable</span><span class="id"> setT</span> (<span class="gallina-kwd">fun</span><span class="id"> y</span><span class="id"> =&gt;</span><span class="id"> \int[m1]_x</span><span class="id"> `|f</span> (<span class="id">x,</span><span class="id"> y</span>)<span class="id">|</span>).<br/>
&nbsp;&nbsp;<span class="id">apply/integrableP;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> (<span class="id">le_lt_trans</span><span class="id"> _</span> (<span class="id">fubini1b</span>.<span class="id">1</span><span class="id"> imf</span>))<span class="id">//</span><span class="id"> ge0_le_integral</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> exact:</span><span class="id"> measurableT_comp</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> *;</span><span class="id"> exact:</span><span class="id"> integral_ge0</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> *;</span><span class="id"> rewrite</span><span class="id"> gee0_abs//;</span><span class="id"> exact:</span><span class="id"> integral_ge0</span>.<br/>
<span class="id">move/integrable_ae</span><span class="id"> =&gt;</span><span class="id"> /</span>(_<span class="id"> measurableT</span>)<span class="id">;</span><span class="id"> apply:</span><span class="id"> filterS</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> /=</span><span class="id"> /</span>(_<span class="id"> I</span>)<span class="id"> im2f</span>.<br/>
<span class="id">apply/integrableP;</span><span class="id"> split;</span><span class="id"> first</span><span class="id"> exact/measurableT_comp</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> move/fin_numPlt</span><span class="id"> :</span><span class="id"> im2f</span><span class="id"> =&gt;</span><span class="id"> /andP[]</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Let</span><span class="id"> F</span><span class="id"> :=</span><span class="id"> fubini_F</span><span class="id"> m2</span><span class="id"> f</span>.<br/>
<br/>
<span class="vernacular">Let</span><span class="id"> Fplus</span><span class="id"> x</span><span class="id"> :=</span><span class="id"> \int[m2]_y</span><span class="id"> f^\+</span> (<span class="id">x,</span><span class="id"> y</span>).<br/>
<span class="vernacular">Let</span><span class="id"> Fminus</span><span class="id"> x</span><span class="id"> :=</span><span class="id"> \int[m2]_y</span><span class="id"> f^\-</span> (<span class="id">x,</span><span class="id"> y</span>).<br/>
<br/>
<span class="vernacular">Let</span><span class="id"> FE</span><span class="id"> :</span><span class="id"> F</span><span class="id"> =</span><span class="id"> Fplus</span><span class="id"> \-</span><span class="id"> Fminus</span><br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id"> apply/funext=&gt;</span><span class="id"> x;</span><span class="id"> exact:</span><span class="id"> integralE</span>. Qed.</div></details>
<br/>
<span class="vernacular">Let</span><span class="id"> measurable_Fplus</span><span class="id"> :</span><span class="id"> measurable_fun</span><span class="id"> setT</span><span class="id"> Fplus</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> measurable_fun_fubini_tonelli_F</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> measurable_funepos</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Let</span><span class="id"> measurable_Fminus</span><span class="id"> :</span><span class="id"> measurable_fun</span><span class="id"> setT</span><span class="id"> Fminus</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> measurable_fun_fubini_tonelli_F</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> measurable_funeneg</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> measurable_fubini_F</span><span class="id"> :</span><span class="id"> measurable_fun</span><span class="id"> setT</span><span class="id"> F</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> FE</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> emeasurable_funB;</span><span class="id"> [exact:</span><span class="id"> measurable_Fplus|exact:</span><span class="id"> measurable_Fminus]</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Let</span><span class="id"> integrable_Fplus</span><span class="id"> :</span><span class="id"> m1</span>.<span class="id">-integrable</span><span class="id"> setT</span><span class="id"> Fplus</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">apply/integrableP;</span><span class="id"> split=&gt;</span><span class="id"> //</span>.<br/>
<span class="id">apply:</span><span class="id"> le_lt_trans</span> (<span class="id">fubini1a</span>.<span class="id">1</span><span class="id"> imf</span>)<span class="id">;</span><span class="id"> apply:</span><span class="id"> ge0_le_integral</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
<span class="id">-</span><span class="id"> exact:</span><span class="id"> measurableT_comp</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> _;</span><span class="id"> exact:</span><span class="id"> integral_ge0</span>.<br/>
<span class="id">-</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> _;</span><span class="id"> apply:</span><span class="id"> le_trans</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> le_abse_integral</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> apply:</span><span class="id"> measurable_funepos</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> measurableT_comp</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> ge0_le_integral</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> apply:</span><span class="id"> measurableT_comp</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> measurable_funepos</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> measurableT_comp</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> measurableT_comp</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact/measurableT_comp</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> y</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> gee0_abs//</span><span class="id"> -/</span>((<span class="id">abse</span><span class="id"> \o</span><span class="id"> f</span>) (<span class="id">x,</span><span class="id"> y</span>))<span class="id"> fune_abse</span><span class="id"> leeDl</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Let</span><span class="id"> integrable_Fminus</span><span class="id"> :</span><span class="id"> m1</span>.<span class="id">-integrable</span><span class="id"> setT</span><span class="id"> Fminus</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">apply/integrableP;</span><span class="id"> split=&gt;</span><span class="id"> //</span>.<br/>
<span class="id">apply:</span><span class="id"> le_lt_trans</span> (<span class="id">fubini1a</span>.<span class="id">1</span><span class="id"> imf</span>)<span class="id">;</span><span class="id"> apply:</span><span class="id"> ge0_le_integral</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
<span class="id">-</span><span class="id"> exact:</span><span class="id"> measurableT_comp</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> *;</span><span class="id"> exact:</span><span class="id"> integral_ge0</span>.<br/>
<span class="id">-</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> _;</span><span class="id"> apply:</span><span class="id"> le_trans</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> le_abse_integral</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> apply:</span><span class="id"> measurable_funeneg</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> measurableT_comp</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> ge0_le_integral</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="id"> apply:</span><span class="id"> measurableT_comp</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> apply:</span><span class="id"> measurable_funeneg</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> measurableT_comp</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> measurableT_comp</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> measurableT_comp</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> y</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> gee0_abs//</span><span class="id"> -/</span>((<span class="id">abse</span><span class="id"> \o</span><span class="id"> f</span>) (<span class="id">x,</span><span class="id"> y</span>))<span class="id"> fune_abse</span><span class="id"> leeDr</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> integrable_fubini_F</span><span class="id"> :</span><span class="id"> m1</span>.<span class="id">-integrable</span><span class="id"> setT</span><span class="id"> F</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> FE;</span><span class="id"> exact:</span><span class="id"> integrableB</span>. Qed.</div></details>
<br/>
<span class="vernacular">Let</span><span class="id"> G</span><span class="id"> :=</span><span class="id"> fubini_G</span><span class="id"> m1</span><span class="id"> f</span>.<br/>
<br/>
<span class="vernacular">Let</span><span class="id"> Gplus</span><span class="id"> y</span><span class="id"> :=</span><span class="id"> \int[m1]_x</span><span class="id"> f^\+</span> (<span class="id">x,</span><span class="id"> y</span>).<br/>
<span class="vernacular">Let</span><span class="id"> Gminus</span><span class="id"> y</span><span class="id"> :=</span><span class="id"> \int[m1]_x</span><span class="id"> f^\-</span> (<span class="id">x,</span><span class="id"> y</span>).<br/>
<br/>
<span class="vernacular">Let</span><span class="id"> GE</span><span class="id"> :</span><span class="id"> G</span><span class="id"> =</span><span class="id"> Gplus</span><span class="id"> \-</span><span class="id"> Gminus</span><br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id"> apply/funext=&gt;</span><span class="id"> x;</span><span class="id"> exact:</span><span class="id"> integralE</span>. Qed.</div></details>
<br/>
<span class="vernacular">Let</span><span class="id"> measurable_Gplus</span><span class="id"> :</span><span class="id"> measurable_fun</span><span class="id"> setT</span><span class="id"> Gplus</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> measurable_fun_fubini_tonelli_G</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> measurable_funepos</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Let</span><span class="id"> measurable_Gminus</span><span class="id"> :</span><span class="id"> measurable_fun</span><span class="id"> setT</span><span class="id"> Gminus</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> measurable_fun_fubini_tonelli_G</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> measurable_funeneg</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> measurable_fubini_G</span><span class="id"> :</span><span class="id"> measurable_fun</span><span class="id"> setT</span><span class="id"> G</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> GE;</span><span class="id"> exact:</span><span class="id"> emeasurable_funB</span>. Qed.</div></details>
<br/>
<span class="vernacular">Let</span><span class="id"> integrable_Gplus</span><span class="id"> :</span><span class="id"> m2</span>.<span class="id">-integrable</span><span class="id"> setT</span><span class="id"> Gplus</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">apply/integrableP;</span><span class="id"> split=&gt;</span><span class="id"> //</span>.<br/>
<span class="id">apply:</span><span class="id"> le_lt_trans</span> (<span class="id">fubini1b</span>.<span class="id">1</span><span class="id"> imf</span>)<span class="id">;</span><span class="id"> apply:</span><span class="id"> ge0_le_integral</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
<span class="id">-</span><span class="id"> exact:</span><span class="id"> measurableT_comp</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> *;</span><span class="id"> exact:</span><span class="id"> integral_ge0</span>.<br/>
<span class="id">-</span><span class="id"> move=&gt;</span><span class="id"> y</span><span class="id"> _;</span><span class="id"> apply:</span><span class="id"> le_trans</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> le_abse_integral</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> apply:</span><span class="id"> measurable_funepos</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> measurableT_comp</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> ge0_le_integral</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> apply:</span><span class="id"> measurableT_comp</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> measurable_funepos</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> measurableT_comp</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> measurableT_comp</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> measurableT_comp</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> gee0_abs//</span><span class="id"> -/</span>((<span class="id">abse</span><span class="id"> \o</span><span class="id"> f</span>) (<span class="id">x,</span><span class="id"> y</span>))<span class="id"> fune_abse</span><span class="id"> leeDl</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Let</span><span class="id"> integrable_Gminus</span><span class="id"> :</span><span class="id"> m2</span>.<span class="id">-integrable</span><span class="id"> setT</span><span class="id"> Gminus</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">apply/integrableP;</span><span class="id"> split=&gt;</span><span class="id"> //</span>.<br/>
<span class="id">apply:</span><span class="id"> le_lt_trans</span> (<span class="id">fubini1b</span>.<span class="id">1</span><span class="id"> imf</span>)<span class="id">;</span><span class="id"> apply:</span><span class="id"> ge0_le_integral</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
<span class="id">-</span><span class="id"> exact:</span><span class="id"> measurableT_comp</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> *;</span><span class="id"> exact:</span><span class="id"> integral_ge0</span>.<br/>
<span class="id">-</span><span class="id"> move=&gt;</span><span class="id"> y</span><span class="id"> _;</span><span class="id"> apply:</span><span class="id"> le_trans</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> le_abse_integral</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> apply:</span><span class="id"> measurable_funeneg</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> measurableT_comp</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> ge0_le_integral</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="id"> apply:</span><span class="id"> measurableT_comp</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> measurable_funeneg</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> measurableT_comp</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> measurableT_comp</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> measurableT_comp</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> gee0_abs//</span><span class="id"> -/</span>((<span class="id">abse</span><span class="id"> \o</span><span class="id"> f</span>) (<span class="id">x,</span><span class="id"> y</span>))<span class="id"> fune_abse</span><span class="id"> leeDr</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> fubini1</span><span class="id"> :</span><span class="id"> \int[m1]_x</span><span class="id"> F</span><span class="id"> x</span><span class="id"> =</span><span class="id"> \int[m1</span><span class="id"> \x</span><span class="id"> m2]_z</span><span class="id"> f</span><span class="id"> z</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> FE</span><span class="id"> integralB;</span><span class="id"> [|by[]|exact:</span><span class="id"> integrable_Fplus|exact:</span><span class="id"> integrable_Fminus]</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> [in</span><span class="id"> RHS]integralE</span><span class="id"> ?fubini_tonelli1//;</span><br/>
&nbsp;&nbsp;<span class="id">[exact:</span><span class="id"> measurable_funeneg|exact:</span><span class="id"> measurable_funepos]</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> fubini2</span><span class="id"> :</span><span class="id"> \int[m2]_x</span><span class="id"> G</span><span class="id"> x</span><span class="id"> =</span><span class="id"> \int[m1</span><span class="id"> \x</span><span class="id"> m2]_z</span><span class="id"> f</span><span class="id"> z</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> GE</span><span class="id"> integralB;</span><span class="id"> [|by[]|exact:</span><span class="id"> integrable_Gplus|exact:</span><span class="id"> integrable_Gminus]</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> [in</span><span class="id"> RHS]integralE</span><span class="id"> ?fubini_tonelli2//;</span><br/>
&nbsp;&nbsp;<span class="id">[exact:</span><span class="id"> measurable_funeneg|exact:</span><span class="id"> measurable_funepos]</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Theorem</span><span class="id"> Fubini</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">\int[m1]_x</span><span class="id"> \int[m2]_y</span><span class="id"> f</span> (<span class="id">x,</span><span class="id"> y</span>)<span class="id"> =</span><span class="id"> \int[m2]_y</span><span class="id"> \int[m1]_x</span><span class="id"> f</span> (<span class="id">x,</span><span class="id"> y</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> fubini1</span><span class="id"> -fubini2</span>. Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> fubini</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> sfinite_fubini</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<span class="vernacular">Context</span><span class="id"> d</span><span class="id"> d'</span> (<span class="id">X</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d</span>) (<span class="id">Y</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d'</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>).<br/>
<span class="vernacular">Variables</span> (<span class="id">m1</span><span class="id"> :</span><span class="id"> {sfinite_measure</span><span class="id"> set</span><span class="id"> X</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R}</span>).<br/>
<span class="vernacular">Variables</span> (<span class="id">m2</span><span class="id"> :</span><span class="id"> {sfinite_measure</span><span class="id"> set</span><span class="id"> Y</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R}</span>).<br/>
<span class="vernacular">Variables</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> X</span><span class="id"> *</span><span class="id"> Y</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>) (<span class="id">f0</span><span class="id"> :</span><span class="gallina-kwd"> forall</span><span class="id"> xy,</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> f</span><span class="id"> xy</span>).<br/>
<span class="vernacular">Hypothesis</span><span class="id"> mf</span><span class="id"> :</span><span class="id"> measurable_fun</span><span class="id"> setT</span><span class="id"> f</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> sfinite_Fubini</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">\int[m1]_x</span><span class="id"> \int[m2]_y</span><span class="id"> f</span> (<span class="id">x,</span><span class="id"> y</span>)<span class="id"> =</span><span class="id"> \int[m2]_y</span><span class="id"> \int[m1]_x</span><span class="id"> f</span> (<span class="id">x,</span><span class="id"> y</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">pose</span><span class="id"> s1</span><span class="id"> :=</span><span class="id"> sfinite_measure_seq</span><span class="id"> m1</span>.<br/>
<span class="id">pose</span><span class="id"> s2</span><span class="id"> :=</span><span class="id"> sfinite_measure_seq</span><span class="id"> m2</span>.<br/>
<span class="id">rewrite</span><span class="id"> [LHS]</span>(<span class="id">eq_measure_integral</span><span class="id"> [the</span><span class="id"> measure</span><span class="id"> _</span><span class="id"> _</span><span class="id"> of</span><span class="id"> mseries</span><span class="id"> s1</span><span class="id"> 0]</span>)<span class="id">;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> A</span><span class="id"> mA</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> /=;</span><span class="id"> exact:</span><span class="id"> sfinite_measure_seqP</span>.<br/>
<span class="id">transitivity</span> (<span class="id">\int[mseries</span><span class="id"> s1</span><span class="id"> 0]_x</span><span class="id"> \int[mseries</span><span class="id"> s2</span><span class="id"> 0]_y</span><span class="id"> f</span> (<span class="id">x,</span><span class="id"> y</span>)).<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> eq_integral</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> _;</span><span class="id"> apply:</span><span class="id"> eq_measure_integral</span><span class="id"> =&gt;</span><span class="id"> ?</span><span class="id"> ?</span><span class="id"> _</span>.<br/>
&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> sfinite_measure_seqP</span>.<br/>
<span class="id">transitivity</span> (<span class="id">\sum_</span>(<span class="id">n</span><span class="id"> &lt;oo</span>)<span class="id"> \int[s1</span><span class="id"> n]_x</span><span class="id"> \sum_</span>(<span class="id">m</span><span class="id"> &lt;oo</span>)<span class="id"> \int[s2</span><span class="id"> m]_y</span><span class="id"> f</span> (<span class="id">x,</span><span class="id"> y</span>)).<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> ge0_integral_measure_series;</span><span class="id"> [|by</span><span class="id"> []|</span><span class="id"> |];</span><span class="id"> last</span><span class="id"> 2</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> t</span><span class="id"> _;</span><span class="id"> exact:</span><span class="id"> integral_ge0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> [X</span><span class="gallina-kwd"> in</span><span class="id"> measurable_fun</span><span class="id"> _</span><span class="id"> X]</span>(_<span class="id"> :</span><span class="id"> _</span><span class="id"> =</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> \sum_</span>(<span class="id">n</span><span class="id"> &lt;oo</span>)<span class="id"> \int[s2</span><span class="id"> n]_y</span><span class="id"> f</span> (<span class="id">x,</span><span class="id"> y</span>))<span class="id">;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply/funext</span><span class="id"> =&gt;</span><span class="id"> x</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> ge0_integral_measure_series//;</span><span class="id"> exact/measurableT_comp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> ge0_emeasurable_fun_sum;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> k</span><span class="id"> x</span><span class="id"> *;</span><span class="id"> exact:</span><span class="id"> integral_ge0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> k</span><span class="id"> _;</span><span class="id"> exact:</span><span class="id"> measurable_fun_fubini_tonelli_F</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> eq_eseriesr</span><span class="id"> =&gt;</span><span class="id"> n</span><span class="id"> _;</span><span class="id"> apply:</span><span class="id"> eq_integral</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> _</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> ge0_integral_measure_series//;</span><span class="id"> exact/measurableT_comp</span>.<br/>
<span class="id">transitivity</span> (<span class="id">\sum_</span>(<span class="id">n</span><span class="id"> &lt;oo</span>)<span class="id"> \sum_</span>(<span class="id">m</span><span class="id"> &lt;oo</span>)<span class="id"> \int[s1</span><span class="id"> n]_x</span><span class="id"> \int[s2</span><span class="id"> m]_y</span><span class="id"> f</span> (<span class="id">x,</span><span class="id"> y</span>)).<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> eq_eseriesr</span><span class="id"> =&gt;</span><span class="id"> n</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> integral_nneseries//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> m;</span><span class="id"> exact:</span><span class="id"> measurable_fun_fubini_tonelli_F</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> m</span><span class="id"> x</span><span class="id"> _;</span><span class="id"> exact:</span><span class="id"> integral_ge0</span>.<br/>
<span class="id">transitivity</span> (<span class="id">\sum_</span>(<span class="id">n</span><span class="id"> &lt;oo</span>)<span class="id"> \sum_</span>(<span class="id">m</span><span class="id"> &lt;oo</span>)<span class="id"> \int[s2</span><span class="id"> m]_y</span><span class="id"> \int[s1</span><span class="id"> n]_x</span><span class="id"> f</span> (<span class="id">x,</span><span class="id"> y</span>)).<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> eq_eseriesr</span><span class="id"> =&gt;</span><span class="id"> n</span><span class="id"> _;</span><span class="id"> apply:</span><span class="id"> eq_eseriesr</span><span class="id"> =&gt;</span><span class="id"> m</span><span class="id"> _</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> fubini_tonelli//;</span><span class="id"> exact:</span><span class="id"> finite_measure_sigma_finite</span>.<br/>
<span class="id">transitivity</span> (<span class="id">\sum_</span>(<span class="id">n</span><span class="id"> &lt;oo</span>)<span class="id"> \int[mseries</span><span class="id"> s2</span><span class="id"> 0]_y</span><span class="id"> \int[s1</span><span class="id"> n]_x</span><span class="id"> f</span> (<span class="id">x,</span><span class="id"> y</span>)).<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> eq_eseriesr</span><span class="id"> =&gt;</span><span class="id"> n</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> ge0_integral_measure_series//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> y</span><span class="id"> _;</span><span class="id"> exact:</span><span class="id"> integral_ge0</span>.<br/>
&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> measurable_fun_fubini_tonelli_G</span>.<br/>
<span class="id">transitivity</span> (<span class="id">\int[mseries</span><span class="id"> s2</span><span class="id"> 0]_y</span><span class="id"> \sum_</span>(<span class="id">n</span><span class="id"> &lt;oo</span>)<span class="id"> \int[s1</span><span class="id"> n]_x</span><span class="id"> f</span> (<span class="id">x,</span><span class="id"> y</span>)).<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> integral_nneseries//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> n;</span><span class="id"> apply:</span><span class="id"> measurable_fun_fubini_tonelli_G</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> n</span><span class="id"> y</span><span class="id"> _;</span><span class="id"> exact:</span><span class="id"> integral_ge0</span>.<br/>
<span class="id">transitivity</span> (<span class="id">\int[mseries</span><span class="id"> s2</span><span class="id"> 0]_y</span><span class="id"> \int[mseries</span><span class="id"> s1</span><span class="id"> 0]_x</span><span class="id"> f</span> (<span class="id">x,</span><span class="id"> y</span>)).<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> eq_integral</span><span class="id"> =&gt;</span><span class="id"> y</span><span class="id"> _</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> ge0_integral_measure_series//;</span><span class="id"> exact/measurableT_comp</span>.<br/>
<span class="id">transitivity</span> (<span class="id">\int[m2]_y</span><span class="id"> \int[mseries</span><span class="id"> s1</span><span class="id"> 0]_x</span><span class="id"> f</span> (<span class="id">x,</span><span class="id"> y</span>)).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> eq_measure_integral</span><span class="id"> =&gt;</span><span class="id"> A</span><span class="id"> mA</span><span class="id"> _</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> sfinite_measure_seqP</span>.<br/>
<span class="id">apply:</span><span class="id"> eq_integral</span><span class="id"> =&gt;</span><span class="id"> y</span><span class="id"> _;</span><span class="id"> apply:</span><span class="id"> eq_measure_integral</span><span class="id"> =&gt;</span><span class="id"> A</span><span class="id"> mA</span><span class="id"> _</span><span class="id"> /=</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> sfinite_measure_seqP</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> sfinite_fubini</span>.<br/>
<span class="vernacular">Arguments</span><span class="id"> sfinite_Fubini</span><span class="id"> {d</span><span class="id"> d'</span><span class="id"> X</span><span class="id"> Y</span><span class="id"> R}</span><span class="id"> m1</span><span class="id"> m2</span><span class="id"> f</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> lebesgue_differentiation_continuous</span>.<br/>
<span class="vernacular">Context</span> (<span class="id">rT</span><span class="id"> :</span><span class="id"> realType</span>).<br/>
<span class="vernacular">Let</span><span class="id"> mu</span><span class="id"> :=</span><span class="id"> [the</span><span class="id"> measure</span><span class="id"> _</span><span class="id"> _</span><span class="id"> of</span><span class="id"> @lebesgue_measure</span><span class="id"> rT]</span>.<br/>
<span class="vernacular">Let</span><span class="id"> R</span> <span class="id"> :=</span><span class="id"> [the</span><span class="id"> measurableType</span><span class="id"> _</span><span class="id"> of</span><span class="id"> measurableTypeR</span><span class="id"> rT]</span>.<br/>
<br/>
<span class="vernacular">Let</span><span class="id"> ballE</span> (<span class="id">x</span><span class="id"> :</span><span class="id"> R</span>) (<span class="id">r</span><span class="id"> :</span><span class="id"> {posnum</span><span class="id"> rT}</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">ball</span><span class="id"> x</span><span class="id"> r%:num</span><span class="id"> =</span><span class="id"> `]</span>(<span class="id">x</span><span class="id"> -</span><span class="id"> r%:num</span>)<span class="id">,</span> (<span class="id">x</span><span class="id"> +</span><span class="id"> r%:num</span>)<span class="id">[%classic</span><span class="id"> :&gt;</span><span class="id"> set</span><span class="id"> rT</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> -ball_normE</span><span class="id"> /ball_</span><span class="id"> set_itvoo</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> under</span><span class="id"> eq_set</span><span class="id"> =&gt;</span><span class="id"> ?</span><span class="id"> do</span><span class="id"> rewrite</span><span class="id"> ltr_distlC</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> lebesgue_differentiation_continuous</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> rT^o</span>) (<span class="id">A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> R</span>) (<span class="id">x</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">open</span><span class="id"> A</span><span class="id"> -&gt;</span><span class="id"> mu</span>.<span class="id">-integrable</span><span class="id"> A</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> f</span>)<span class="id"> -&gt;</span><span class="id"> {for</span><span class="id"> x,</span><span class="id"> continuous</span><span class="id"> f}</span><span class="id"> -&gt;</span><span class="id"> A</span><span class="id"> x</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">fun</span><span class="id"> r</span><span class="id"> =&gt;</span><span class="id"> 1</span><span class="id"> /</span> (<span class="id">r</span><span class="id"> *+</span><span class="id"> 2</span>)<span class="id"> *</span><span class="id"> \int[mu]_</span>(<span class="id">z</span><span class="gallina-kwd"> in</span><span class="id"> ball</span><span class="id"> x</span><span class="id"> r</span>)<span class="id"> f</span><span class="id"> z</span>)<span class="id"> @</span><span class="id"> 0^'+</span><span class="id"> --&gt;</span><br/>
&nbsp;&nbsp;(<span class="id">f</span><span class="id"> x</span><span class="id"> :</span><span class="id"> R^o</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">have</span><span class="id"> ball_itvr</span><span class="id"> r</span><span class="id"> :</span><span class="id"> 0</span><span class="id"> &lt;</span><span class="id"> r</span><span class="id"> -&gt;</span><span class="id"> `[x</span><span class="id"> -</span><span class="id"> r,</span><span class="id"> x</span><span class="id"> +</span><span class="id"> r]</span><span class="id"> `\`</span><span class="id"> ball</span><span class="id"> x</span><span class="id"> r</span><span class="id"> =</span><span class="id"> [set</span><span class="id"> x</span><span class="id"> +</span><span class="id"> r;</span><span class="id"> x</span><span class="id"> -</span><span class="id"> r]</span>.<br/>
&nbsp;&nbsp;<span class="id">move:</span><span class="id"> r</span><span class="id"> =&gt;</span><span class="id"> _/posnumP[r]</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -setU1itv</span><span class="id"> ?bnd_simp</span><span class="id"> ?lerBlDr</span><span class="id"> -?addrA</span><span class="id"> ?ler_wpDr//</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -setUitv1</span><span class="id"> ?bnd_simp</span><span class="id"> ?ltrBlDr</span><span class="id"> -?addrA</span><span class="id"> ?ltr_pwDr//</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> setUA</span><span class="id"> setUC</span><span class="id"> setUA</span><span class="id"> setDUl</span><span class="id"> !ballE</span><span class="id"> setDv</span><span class="id"> setU0</span><span class="id"> setDidl//</span><span class="id"> -subset0</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> z</span><span class="id"> /=</span><span class="id"> [[]]</span><span class="id"> -&gt;;</span><span class="id"> rewrite</span><span class="id"> in_itv/=</span><span class="id"> ltxx//</span><span class="id"> andbF</span>.<br/>
<span class="id">have</span><span class="id"> ball_itv2</span><span class="id"> r</span><span class="id"> :</span><span class="id"> 0</span><span class="id"> &lt;</span><span class="id"> r</span><span class="id"> -&gt;</span><span class="id"> ball</span><span class="id"> x</span><span class="id"> r</span><span class="id"> =</span><span class="id"> `[x</span><span class="id"> -</span><span class="id"> r,</span><span class="id"> x</span><span class="id"> +</span><span class="id"> r]</span><span class="id"> `\`</span><span class="id"> [set</span><span class="id"> x</span><span class="id"> +</span><span class="id"> r;</span><span class="id"> x</span><span class="id"> -</span><span class="id"> r]</span>.<br/>
&nbsp;&nbsp;<span class="id">move:</span><span class="id"> r</span><span class="id"> =&gt;</span><span class="id"> _/posnumP[r]</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -ball_itvr</span><span class="id"> //</span><span class="id"> setDD</span><span class="id"> setIC;</span><span class="id"> apply/esym/setIidPl</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> ballE</span><span class="id"> set_itvcc</span><span class="id"> =&gt;</span><span class="id"> ?/=;</span><span class="id"> rewrite</span><span class="id"> in_itv</span><span class="id"> =&gt;</span><span class="id"> /andP</span><span class="id"> [/ltW</span><span class="id"> -&gt;</span><span class="id"> /ltW</span><span class="id"> -&gt;]</span>.<br/>
<span class="id">have</span><span class="id"> ritv</span><span class="id"> r</span><span class="id"> :</span><span class="id"> 0</span><span class="id"> &lt;</span><span class="id"> r</span><span class="id"> -&gt;</span><span class="id"> mu</span><span class="id"> `[x</span><span class="id"> -</span><span class="id"> r,</span><span class="id"> x</span><span class="id"> +</span><span class="id"> r]%classic</span><span class="id"> =</span> (<span class="id">r</span><span class="id"> *+</span><span class="id"> 2</span>)<span class="id">%:E</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> /gt0_cp</span><span class="id"> rE;</span><span class="id"> rewrite</span><span class="id"> /=</span><span class="id"> lebesgue_measure_itv/=</span><span class="id"> lte_fin</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> ler_ltD</span><span class="id"> //</span><span class="id"> ?rE</span><span class="id"> //</span><span class="id"> -EFinD;</span><span class="id"> congr</span> (_<span class="id"> _</span>).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> opprB</span><span class="id"> addrAC</span><span class="id"> [_</span><span class="id"> -</span><span class="id"> _]addrC</span><span class="id"> addrA</span><span class="id"> subrr</span><span class="id"> add0r</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> oA</span><span class="id"> intf</span><span class="id"> ctsfx</span><span class="id"> Ax</span>.<br/>
<span class="id">apply:</span><span class="id"> cvg_zero</span>.<br/>
<span class="id">apply/cvgrPdist_le</span><span class="id"> =&gt;</span><span class="id"> eps</span><span class="id"> epos;</span><span class="id"> apply:</span><span class="id"> filter_app</span> (<span class="id">@nbhs_right_gt</span><span class="id"> rT</span><span class="id"> 0</span>).<br/>
<span class="id">move/cvgrPdist_le/</span>(_<span class="id"> eps</span><span class="id"> epos</span>)<span class="id">/at_right_in_segment</span><span class="id"> :</span><span class="id"> ctsfx;</span><span class="id"> apply:</span><span class="id"> filter_app</span>.<br/>
<span class="id">apply:</span><span class="id"> filter_app</span> (<span class="id">open_itvcc_subset</span><span class="id"> oA</span><span class="id"> Ax</span>).<br/>
<span class="id">have</span><span class="id"> mA</span><span class="id"> :</span><span class="id"> measurable</span><span class="id"> A</span><span class="id"> :=</span><span class="id"> open_measurable</span><span class="id"> oA</span>.<br/>
<span class="id">near=&gt;</span><span class="id"> r</span><span class="id"> =&gt;</span><span class="id"> xrA;</span><span class="id"> rewrite</span><span class="id"> addrfctE</span><span class="id"> opprfctE</span><span class="id"> =&gt;</span><span class="id"> feps</span><span class="id"> rp</span>.<br/>
<span class="id">have</span><span class="id"> cptxr</span><span class="id"> :</span><span class="id"> compact</span><span class="id"> `[x</span><span class="id"> -</span><span class="id"> r,</span><span class="id"> x</span><span class="id"> +</span><span class="id"> r]</span><span class="id"> :=</span><span class="id"> @segment_compact</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span>.<br/>
<span class="id">rewrite</span><span class="id"> distrC</span><span class="id"> subr0</span>.<br/>
<span class="id">have</span><span class="id"> -&gt;</span><span class="id"> :</span><span class="id"> \int[mu]_</span>(<span class="id">z</span><span class="gallina-kwd"> in</span><span class="id"> ball</span><span class="id"> x</span><span class="id"> r</span>)<span class="id"> f</span><span class="id"> z</span><span class="id"> =</span><span class="id"> \int[mu]_</span>(<span class="id">z</span><span class="gallina-kwd"> in</span><span class="id"> `[x</span><span class="id"> -</span><span class="id"> r,</span><span class="id"> x</span><span class="id"> +</span><span class="id"> r]</span>)<span class="id"> f</span><span class="id"> z</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> ball_itv2</span><span class="id"> //;</span><span class="id"> congr</span> (<span class="id">fine</span><span class="id"> _</span>)<span class="id">;</span><span class="id"> rewrite</span><span class="id"> -negligible_integral</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> apply/measurableU;</span><span class="id"> exact:</span><span class="id"> measurable_set1</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> exact:</span> (<span class="id">integrableS</span><span class="id"> mA</span>).<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> measureU0//;</span><span class="id"> exact:</span><span class="id"> lebesgue_measure_set1</span>.<br/>
<span class="id">have</span><span class="id"> r20</span><span class="id"> :</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> 1</span><span class="id"> /</span> (<span class="id">r</span><span class="id"> *+</span><span class="id"> 2</span>)<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> ?divr_ge0</span><span class="id"> //</span><span class="id"> mulrn_wge0</span>.<br/>
<span class="id">have</span><span class="id"> -&gt;</span><span class="id"> :</span><span class="id"> f</span><span class="id"> x</span><span class="id"> =</span><span class="id"> 1</span><span class="id"> /</span> (<span class="id">r</span><span class="id"> *+</span><span class="id"> 2</span>)<span class="id"> *</span><span class="id"> \int[mu]_</span>(<span class="id">z</span><span class="gallina-kwd"> in</span><span class="id"> `[x</span><span class="id"> -</span><span class="id"> r,</span><span class="id"> x</span><span class="id"> +</span><span class="id"> r]</span>)<span class="id"> cst</span> (<span class="id">f</span><span class="id"> x</span>)<span class="id"> z</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> /Rintegral</span><span class="id"> /=</span><span class="id"> integral_cst</span><span class="id"> /=</span><span class="id"> ?ritv</span><span class="id"> //</span><span class="id"> mulrC</span><span class="id"> mul1r</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -mulrA</span><span class="id"> divff</span><span class="id"> ?mulr1//;</span><span class="id"> apply:</span><span class="id"> lt0r_neq0;</span><span class="id"> rewrite</span><span class="id"> mulrn_wgt0</span>.<br/>
<span class="id">have</span><span class="id"> intRf</span><span class="id"> :</span><span class="id"> mu</span>.<span class="id">-integrable</span><span class="id"> `[x</span><span class="id"> -</span><span class="id"> r,</span><span class="id"> x</span><span class="id"> +</span><span class="id"> r]</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> f</span>).<br/>
&nbsp;&nbsp;<span class="id">exact:</span> (<span class="id">@integrableS</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> mu</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> xrA</span><span class="id"> intf</span>).<br/>
<span class="id">rewrite</span><span class="id"> /=</span><span class="id"> -mulrBr</span><span class="id"> -fineB;</span><span class="id"> first</span><span class="id"> last</span>.<br/>
<span class="id">-</span><span class="id"> rewrite</span><span class="id"> integral_fune_fin_num//</span><span class="id"> continuous_compact_integrable//</span><span class="id"> =&gt;</span><span class="id"> ?</span>.<br/>
&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> cvg_cst</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> integral_fune_fin_num</span>.<br/>
<span class="id">rewrite</span><span class="id"> -integralB_EFin</span><span class="id"> //;</span><span class="id"> first</span><span class="id"> last</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> continuous_compact_integrable</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> ?;</span><span class="id"> exact:</span><span class="id"> cvg_cst</span>.<br/>
<span class="id">under</span><span class="id"> [fun</span><span class="id"> _</span><span class="id"> =&gt;</span><span class="id"> _</span><span class="id"> +</span><span class="id"> _</span><span class="id"> ]eq_fun</span><span class="id"> =&gt;</span><span class="id"> ?</span><span class="id"> do</span><span class="id"> rewrite</span><span class="id"> -EFinD</span>.<br/>
<span class="id">have</span><span class="id"> int_fx</span><span class="id"> :</span><span class="id"> mu</span>.<span class="id">-integrable</span><span class="id"> `[x</span><span class="id"> -</span><span class="id"> r,</span><span class="id"> x</span><span class="id"> +</span><span class="id"> r]</span> (<span class="gallina-kwd">fun</span><span class="id"> z</span><span class="id"> =&gt;</span> (<span class="id">f</span><span class="id"> z</span><span class="id"> -</span><span class="id"> f</span><span class="id"> x</span>)<span class="id">%:E</span>).<br/>
&nbsp;&nbsp;<span class="id">under</span><span class="id"> [fun</span><span class="id"> z</span><span class="id"> =&gt;</span> (<span class="id">f</span><span class="id"> z</span><span class="id"> -</span><span class="id"> _</span>)<span class="id">%:E]eq_fun</span><span class="id"> =&gt;</span><span class="id"> ?</span><span class="id"> do</span><span class="id"> rewrite</span><span class="id"> EFinB</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> integrableB//</span><span class="id"> continuous_compact_integrable//</span><span class="id"> =&gt;</span><span class="id"> ?</span>.<br/>
&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> cvg_cst</span>.<br/>
<span class="id">rewrite</span><span class="id"> normrM</span><span class="id"> [</span><span class="id"> `|_/_|</span><span class="id"> ]ger0_norm</span><span class="id"> //</span><span class="id"> -fine_abse</span><span class="id"> //;</span><span class="id"> first</span><span class="id"> last</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> integral_fune_fin_num</span>.<br/>
<span class="id">suff</span><span class="id"> :</span> (<span class="id">\int[mu]_</span>(<span class="id">z</span><span class="gallina-kwd"> in</span><span class="id"> `[</span>(<span class="id">x</span><span class="id"> -</span><span class="id"> r</span>)<span class="id">%R,</span> (<span class="id">x</span><span class="id"> +</span><span class="id"> r</span>)<span class="id">%R]</span>)<span class="id"> `|f</span><span class="id"> z</span><span class="id"> -</span><span class="id"> f</span><span class="id"> x|%:E</span><span class="id"> &lt;=</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">r</span><span class="id"> *+</span><span class="id"> 2</span><span class="id"> *</span><span class="id"> eps</span>)<span class="id">%:E</span>)<span class="id">%E</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> intfeps;</span><span class="id"> apply:</span><span class="id"> le_trans</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span> (<span class="id">ler_pM</span><span class="id"> r20</span><span class="id"> _</span> (<span class="id">le_refl</span><span class="id"> _</span>))<span class="id">;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> fine_ge0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> fine_le;</span><span class="id"> last</span><span class="id"> apply:</span><span class="id"> le_abse_integral</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> abse_fin_num</span><span class="id"> integral_fune_fin_num</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> integral_fune_fin_num//</span><span class="id"> integrable_abse</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> case/integrableP</span><span class="id"> :</span><span class="id"> int_fx</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> div1r</span><span class="id"> ler_pdivrMl</span><span class="id"> ?mulrn_wgt0</span><span class="id"> //</span><span class="id"> -[_</span><span class="id"> *</span><span class="id"> _]/</span>(<span class="id">fine</span> (<span class="id">_%:E</span>)).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> fine_le//</span><span class="id"> integral_fune_fin_num//</span><span class="id"> integrable_abse</span>.<br/>
<span class="id">apply:</span><span class="id"> le_trans</span>.<br/>
<span class="id">-</span><span class="id"> apply:</span> (<span class="id">@integral_le_bound</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span> (<span class="gallina-kwd">fun</span><span class="id"> z</span><span class="id"> =&gt;</span> (<span class="id">f</span><span class="id"> z</span><span class="id"> -</span><span class="id"> f</span><span class="id"> x</span>)<span class="id">%:E</span>)<span class="id"> eps%:E</span>)<span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> case/integrableP:</span><span class="id"> int_fx</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="id"> exact:</span><span class="id"> ltW</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> aeW</span><span class="id"> =&gt;</span><span class="id"> ?</span><span class="id"> ?;</span><span class="id"> rewrite</span><span class="id"> /=</span><span class="id"> lee_fin</span><span class="id"> distrC</span><span class="id"> feps</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> ritv</span><span class="id"> //=</span><span class="id"> -EFinM</span><span class="id"> lee_fin</span><span class="id"> mulrC</span>.<br/>
<span class="id">Unshelve</span>.<span class="id"> all:</span><span class="gallina-kwd"> by</span><span class="id"> end_near</span>. Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> lebesgue_differentiation_continuous</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> locally_integrable</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {R</span><span class="id"> :</span><span class="id"> realType}</span>.<br/>
<span class="vernacular">Implicit</span><span class="id"> Types</span> (<span class="id">D</span><span class="id"> :</span><span class="id"> set</span><span class="id"> R</span>) (<span class="id">f</span><span class="id"> g</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> R</span>).<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<br/>
<span class="vernacular">Local</span><span class="vernacular"> Notation</span><span class="id"> mu</span><span class="id"> :=</span><span class="id"> lebesgue_measure</span>.<br/>
<br/>
<span class="vernacular">Definition</span><span class="id"> locally_integrable</span><span class="id"> D</span><span class="id"> f</span><span class="id"> :=</span><span class="id"> [/\</span><span class="id"> measurable_fun</span><span class="id"> D</span><span class="id"> f,</span><span class="id"> open</span><span class="id"> D</span><span class="id"> &amp;</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">forall</span><span class="id"> K,</span><span class="id"> K</span><span class="id"> `&lt;=`</span><span class="id"> D</span><span class="id"> -&gt;</span><span class="id"> compact</span><span class="id"> K</span><span class="id"> -&gt;</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> K</span>)<span class="id"> `|f</span><span class="id"> x|%:E</span><span class="id"> &lt;</span><span class="id"> +oo]</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> open_integrable_locally</span><span class="id"> D</span><span class="id"> f</span><span class="id"> :</span><span class="id"> open</span><span class="id"> D</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">mu</span>.<span class="id">-integrable</span><span class="id"> D</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> f</span>)<span class="id"> -&gt;</span><span class="id"> locally_integrable</span><span class="id"> D</span><span class="id"> f</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> oD</span><span class="id"> /integrableP[mf</span><span class="id"> foo];</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> first</span><span class="id"> exact/measurable_EFinP</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> K</span><span class="id"> KD</span><span class="id"> cK;</span><span class="id"> rewrite</span> (<span class="id">le_lt_trans</span><span class="id"> _</span><span class="id"> foo</span>)<span class="id">//</span><span class="id"> ge0_subset_integral//=</span>.<br/>
<span class="id">-</span><span class="id"> exact:</span><span class="id"> compact_measurable</span>.<br/>
<span class="id">-</span><span class="id"> exact:</span><span class="id"> open_measurable</span>.<br/>
<span class="id">-</span><span class="id"> apply/measurable_EFinP;</span><span class="id"> apply:</span><span class="id"> measurableT_comp</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="id">exact/measurable_EFinP</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> locally_integrableN</span><span class="id"> D</span><span class="id"> f</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">locally_integrable</span><span class="id"> D</span><span class="id"> f</span><span class="id"> -&gt;</span><span class="id"> locally_integrable</span><span class="id"> D</span> (<span class="id">\-</span><span class="id"> f</span>)<span class="id">%R</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> [mf</span><span class="id"> oD</span><span class="id"> foo];</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> measurableT_comp</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> K</span><span class="id"> KD</span><span class="id"> cK;</span><span class="id"> under</span><span class="id"> eq_integral</span><span class="id"> do</span><span class="id"> rewrite</span><span class="id"> normrN;</span><span class="id"> exact:</span><span class="id"> foo</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> locally_integrableD</span><span class="id"> D</span><span class="id"> f</span><span class="id"> g</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">locally_integrable</span><span class="id"> D</span><span class="id"> f</span><span class="id"> -&gt;</span><span class="id"> locally_integrable</span><span class="id"> D</span><span class="id"> g</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">locally_integrable</span><span class="id"> D</span> (<span class="id">f</span><span class="id"> \+</span><span class="id"> g</span>)<span class="id">%R</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> [mf</span><span class="id"> oD</span><span class="id"> foo]</span><span class="id"> [mg</span><span class="id"> _</span><span class="id"> goo];</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> measurable_funD</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> K</span><span class="id"> KD</span><span class="id"> cK</span>.<br/>
<span class="id">suff</span><span class="id"> :</span><span class="id"> lebesgue_measure</span>.<span class="id">-integrable</span><span class="id"> K</span> ((<span class="id">EFin</span><span class="id"> \o</span><span class="id"> f</span>)<span class="id"> \+</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> g</span>)).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> case/integrableP</span>.<br/>
<span class="id">apply:</span><span class="id"> integrableD</span><span class="id"> =&gt;</span><span class="id"> //=;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> compact_measurable</span>.<br/>
<span class="id">-</span><span class="id"> apply/integrableP;</span><span class="id"> split;</span><span class="id"> last</span><span class="id"> exact:</span><span class="id"> foo</span>.<br/>
&nbsp;&nbsp;<span class="id">apply/measurable_EFinP;</span><span class="id"> apply:</span><span class="id"> measurable_funS</span><span class="id"> mf</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> open_measurable</span>.<br/>
<span class="id">-</span><span class="id"> apply/integrableP;</span><span class="id"> split;</span><span class="id"> last</span><span class="id"> exact:</span><span class="id"> goo</span>.<br/>
&nbsp;&nbsp;<span class="id">apply/measurable_EFinP;</span><span class="id"> apply:</span><span class="id"> measurable_funS</span><span class="id"> mg</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> open_measurable</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> locally_integrableB</span><span class="id"> D</span><span class="id"> f</span><span class="id"> g</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">locally_integrable</span><span class="id"> D</span><span class="id"> f</span><span class="id"> -&gt;</span><span class="id"> locally_integrable</span><span class="id"> D</span><span class="id"> g</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">locally_integrable</span><span class="id"> D</span> (<span class="id">f</span><span class="id"> \-</span><span class="id"> g</span>)<span class="id">%R</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> lf</span><span class="id"> lg;</span><span class="id"> apply:</span><span class="id"> locally_integrableD</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> locally_integrableN</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> locally_integrable_indic</span><span class="id"> D</span> (<span class="id">A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">open</span><span class="id"> D</span><span class="id"> -&gt;</span><span class="id"> measurable</span><span class="id"> A</span><span class="id"> -&gt;</span><span class="id"> locally_integrable</span><span class="id"> D</span><span class="id"> \1_A</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> oU</span><span class="id"> mA;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> K</span><span class="id"> KD_</span><span class="id"> cK</span>.<br/>
<span class="id">apply:</span> (<span class="id">@le_lt_trans</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> K</span>)<span class="id"> cst</span><span class="id"> 1</span><span class="id"> x</span>)).<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> ge0_le_integral</span><span class="id"> =&gt;</span><span class="id"> //=;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> compact_measurable</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> do</span><span class="id"> 2</span><span class="id"> apply:</span><span class="id"> measurableT_comp</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> move=&gt;</span><span class="id"> y</span><span class="id"> Kx;</span><span class="id"> rewrite</span><span class="id"> indicE</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> case:</span> (<span class="id">y</span><span class="id"> \in</span><span class="id"> A</span>)<span class="id"> =&gt;</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> ?</span>(<span class="id">normr1,normr0,lexx,lee01</span>).<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> integral_cst//=</span><span class="id"> ?mul1e;</span><span class="id"> [exact:</span><span class="id"> compact_finite_measure|</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> compact_measurable]</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> locally_integrableS</span> (<span class="id">A</span><span class="id"> B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> R</span>)<span class="id"> f</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">measurable</span><span class="id"> A</span><span class="id"> -&gt;</span><span class="id"> measurable</span><span class="id"> B</span><span class="id"> -&gt;</span><span class="id"> A</span><span class="id"> `&lt;=`</span><span class="id"> B</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">locally_integrable</span><span class="id"> setT</span> (<span class="id">f</span><span class="id"> \_</span><span class="id"> B</span>)<span class="id"> -&gt;</span><span class="id"> locally_integrable</span><span class="id"> setT</span> (<span class="id">f</span><span class="id"> \_</span><span class="id"> A</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> mA</span><span class="id"> mB</span><span class="id"> AB</span><span class="id"> [mfB</span><span class="id"> oT</span><span class="id"> ifB]</span>.<br/>
<span class="id">have</span><span class="id"> ?</span><span class="id"> :</span><span class="id"> measurable_fun</span><span class="id"> [set:</span><span class="id"> R]</span> (<span class="id">f</span><span class="id"> \_</span><span class="id"> A</span>).<br/>
&nbsp;&nbsp;<span class="id">apply/</span>(<span class="id">measurable_restrictT</span><span class="id"> _</span><span class="id"> _</span>).<span class="id">1</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> apply:</span> (<span class="id">measurable_funS</span><span class="id"> _</span><span class="id"> AB</span>)<span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="id">exact/</span>(<span class="id">measurable_restrictT</span><span class="id"> _</span><span class="id"> _</span>).<span class="id">2</span>.<br/>
<span class="id">split</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> K</span><span class="id"> KT</span><span class="id"> cK;</span><span class="id"> apply:</span><span class="id"> le_lt_trans</span> (<span class="id">ifB</span><span class="id"> _</span><span class="id"> KT</span><span class="id"> cK</span>).<br/>
<span class="id">apply:</span><span class="id"> ge0_le_integral</span><span class="id"> =&gt;</span><span class="id"> //=;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> compact_measurable</span>.<br/>
<span class="id">-</span><span class="id"> apply/measurable_EFinP;</span><span class="id"> apply/measurableT_comp</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="id">exact/measurable_funTS</span>.<br/>
<span class="id">-</span><span class="id"> apply/measurable_EFinP;</span><span class="id"> apply/measurableT_comp</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="id">exact/measurable_funTS</span>.<br/>
<span class="id">-</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> Kx;</span><span class="id"> rewrite</span><span class="id"> lee_fin</span><span class="id"> !patchE</span>.<br/>
&nbsp;&nbsp;<span class="id">case:</span><span class="id"> ifPn</span><span class="id"> =&gt;</span><span class="id"> xA;</span><span class="id"> case:</span><span class="id"> ifPn</span><span class="id"> =&gt;</span><span class="id"> xB</span><span class="id"> //;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> normr0</span>.<br/>
&nbsp;&nbsp;<span class="id">move:</span><span class="id"> AB</span><span class="id"> =&gt;</span><span class="id"> /</span>(_<span class="id"> x</span>).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move/set_mem</span><span class="id"> :</span><span class="id"> xA</span><span class="id"> =&gt;</span><span class="id"> /[swap]</span><span class="id"> /[apply]</span><span class="id"> /mem_set;</span><span class="id"> rewrite</span> (<span class="id">negbTE</span><span class="id"> xB</span>).<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> integrable_locally_restrict</span><span class="id"> f</span> (<span class="id">A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> R</span>)<span class="id"> :</span><span class="id"> measurable</span><span class="id"> A</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">mu</span>.<span class="id">-integrable</span><span class="id"> A</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> f</span>)<span class="id"> -&gt;</span><span class="id"> locally_integrable</span><span class="id"> [set:</span><span class="id"> R]</span> (<span class="id">f</span><span class="id"> \_</span><span class="id"> A</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> mA</span><span class="id"> intf;</span><span class="id"> split</span>.<br/>
<span class="id">-</span><span class="id"> move/integrableP</span><span class="id"> :</span><span class="id"> intf</span><span class="id"> =&gt;</span><span class="id"> [mf</span><span class="id"> _]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply/</span>(<span class="id">measurable_restrictT</span><span class="id"> _</span><span class="id"> _</span>).<span class="id">1</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact/measurable_EFinP</span>.<br/>
<span class="id">-</span><span class="id"> exact:</span><span class="id"> openT</span>.<br/>
<span class="id">-</span><span class="id"> move=&gt;</span><span class="id"> K</span><span class="id"> _</span><span class="id"> cK</span>.<br/>
&nbsp;&nbsp;<span class="id">move/integrableP</span><span class="id"> :</span><span class="id"> intf</span><span class="id"> =&gt;</span><span class="id"> [mf]</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> integral_mkcond/=</span>.<br/>
&nbsp;&nbsp;<span class="id">under</span><span class="id"> eq_integral</span><span class="id"> do</span><span class="id"> rewrite</span><span class="id"> restrict_EFin</span><span class="id"> restrict_normr</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> le_lt_trans</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> ge0_subset_integral</span><span class="id"> =&gt;</span><span class="id"> //=;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> compact_measurable</span>.<br/>
&nbsp;&nbsp;<span class="id">apply/measurable_EFinP/measurableT_comp/measurable_EFinP</span><span class="id"> =&gt;</span><span class="id"> //=</span>.<br/>
&nbsp;&nbsp;<span class="id">move/</span>(<span class="id">measurable_restrictT</span><span class="id"> _</span><span class="id"> _</span>).<span class="id">1</span><span class="id"> :</span><span class="id"> mf</span><span class="id"> =&gt;</span><span class="id"> /=</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> restrict_EFin;</span><span class="id"> exact</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> locally_integrable</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> iavg</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {R</span><span class="id"> :</span><span class="id"> realType}</span>.<br/>
<span class="vernacular">Implicit</span><span class="id"> Types</span> (<span class="id">D</span><span class="id"> A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> R</span>) (<span class="id">f</span><span class="id"> g</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> R</span>).<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<br/>
<span class="vernacular">Local</span><span class="vernacular"> Notation</span><span class="id"> mu</span><span class="id"> :=</span><span class="id"> lebesgue_measure</span>.<br/>
<br/>
<span class="vernacular">Definition</span><span class="id"> iavg</span><span class="id"> f</span><span class="id"> A</span><span class="id"> :=</span> (<span class="id">fine</span> (<span class="id">mu</span><span class="id"> A</span>))<span class="id">^-1%:E</span><span class="id"> *</span><span class="id"> \int[mu]_</span>(<span class="id">y</span><span class="gallina-kwd"> in</span><span class="id"> A</span>)<span class="id"> `|</span> (<span class="id">f</span><span class="id"> y</span>)<span class="id">%:E</span><span class="id"> |</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> iavg0</span><span class="id"> f</span><span class="id"> :</span><span class="id"> iavg</span><span class="id"> f</span><span class="id"> set0</span><span class="id"> =</span><span class="id"> 0</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> /iavg</span><span class="id"> integral_set0</span><span class="id"> mule0</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> iavg_ge0</span><span class="id"> f</span><span class="id"> A</span><span class="id"> :</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> iavg</span><span class="id"> f</span><span class="id"> A</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /iavg</span><span class="id"> mule_ge0</span><span class="id"> ?integral_ge0//</span><span class="id"> lee_fin</span><span class="id"> invr_ge0//</span><span class="id"> fine_ge0</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> iavg_restrict</span><span class="id"> f</span><span class="id"> D</span><span class="id"> A</span><span class="id"> :</span><span class="id"> measurable</span><span class="id"> D</span><span class="id"> -&gt;</span><span class="id"> measurable</span><span class="id"> A</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">iavg</span> (<span class="id">f</span><span class="id"> \_</span><span class="id"> D</span>)<span class="id"> A</span><span class="id"> =</span> ((<span class="id">fine</span> (<span class="id">mu</span><span class="id"> A</span>))<span class="id">^-1</span>)<span class="id">%:E</span><span class="id"> *</span><span class="id"> \int[mu]_</span>(<span class="id">y</span><span class="gallina-kwd"> in</span><span class="id"> D</span><span class="id"> `&amp;`</span><span class="id"> A</span>)<span class="id"> `|f</span><span class="id"> y|%:E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> mD</span><span class="id"> mA;</span><span class="id"> rewrite</span><span class="id"> /iavg</span><span class="id"> setIC</span><span class="id"> [in</span><span class="id"> RHS]integral_mkcondr/=;</span><span class="id"> congr</span><span class="id"> *%E</span>.<br/>
<span class="id">apply:</span><span class="id"> eq_integral</span><span class="id"> =&gt;</span><span class="id"> /=</span><span class="id"> y</span><span class="id"> yx1</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> [in</span><span class="id"> RHS]restrict_EFin/=</span><span class="id"> restrict_normr</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> iavgD</span><span class="id"> f</span><span class="id"> g</span><span class="id"> A</span><span class="id"> :</span><span class="id"> measurable</span><span class="id"> A</span><span class="id"> -&gt;</span><span class="id"> mu</span><span class="id"> A</span><span class="id"> &lt;</span><span class="id"> +oo</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">measurable_fun</span><span class="id"> A</span><span class="id"> f</span><span class="id"> -&gt;</span><span class="id"> measurable_fun</span><span class="id"> A</span><span class="id"> g</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">iavg</span> (<span class="id">f</span><span class="id"> \+</span><span class="id"> g</span>)<span class="id">%R</span><span class="id"> A</span><span class="id"> &lt;=</span><span class="id"> iavg</span><span class="id"> f</span><span class="id"> A</span><span class="id"> +</span><span class="id"> iavg</span><span class="id"> g</span><span class="id"> A</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> mA</span><span class="id"> Aoo</span><span class="id"> mf</span><span class="id"> mg;</span><span class="id"> have</span><span class="id"> [r0|r0]</span><span class="id"> :=</span><span class="id"> eqVneq</span> (<span class="id">mu</span><span class="id"> A</span>)<span class="id"> 0</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /iavg</span><span class="id"> r0/=</span><span class="id"> invr0</span><span class="id"> !mul0e</span><span class="id"> adde0</span>.<br/>
<span class="id">rewrite</span><span class="id"> -muleDr//=;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> ge0_adde_def//</span><span class="id"> inE</span><span class="id"> integral_ge0</span>.<br/>
<span class="id">rewrite</span><span class="id"> lee_pmul2l//;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> lte_fin</span><span class="id"> invr_gt0//</span><span class="id"> fine_gt0//</span><span class="id"> Aoo</span><span class="id"> andbC/=</span><span class="id"> lt0e</span><span class="id"> r0/=</span>.<br/>
<span class="id">rewrite</span><span class="id"> -ge0_integralD//=;</span><span class="id"> [|by</span><span class="id"> do</span><span class="id"> 2</span><span class="id"> apply:</span><span class="id"> measurableT_comp</span>..<span class="id">]</span>.<br/>
<span class="id">apply:</span><span class="id"> ge0_le_integral</span><span class="id"> =&gt;</span><span class="id"> //=</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> do</span><span class="id"> 2</span><span class="id"> apply:</span><span class="id"> measurableT_comp</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> measurable_funD</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> /=</span><span class="id"> x</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> adde_ge0</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> measurableT_comp</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> apply:</span><span class="id"> measurable_funD</span><span class="id"> =&gt;</span><span class="id"> //;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> measurableT_comp</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> /=</span><span class="id"> x</span><span class="id"> _;</span><span class="id"> exact:</span><span class="id"> ler_normD</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> iavg</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> hardy_littlewood</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {R</span><span class="id"> :</span><span class="id"> realType}</span>.<br/>
<span class="vernacular">Notation</span><span class="id"> mu</span><span class="id"> :=</span> (<span class="id">@lebesgue_measure</span><span class="id"> R</span>).<br/>
<span class="vernacular">Implicit</span><span class="id"> Types</span> (<span class="id">D</span><span class="id"> :</span><span class="id"> set</span><span class="id"> R</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> R</span>).<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<br/>
<span class="vernacular">Definition</span><span class="id"> HL_maximal</span><span class="id"> f</span> (<span class="id">x</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span><span class="id"> \bar</span><span class="id"> R</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">ereal_sup</span><span class="id"> [set</span><span class="id"> iavg</span><span class="id"> f</span> (<span class="id">ball</span><span class="id"> x</span><span class="id"> r</span>)<span class="id"> |</span><span class="id"> r</span><span class="gallina-kwd"> in</span><span class="id"> `]0,</span><span class="id"> +oo[%classic%R]</span>.<br/>
<br/>
<span class="vernacular">Local</span><span class="vernacular"> Notation</span><span class="id"> HL</span><span class="id"> :=</span><span class="id"> HL_maximal</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> HL_maximal_ge0</span><span class="id"> f</span><span class="id"> D</span><span class="id"> :</span><span class="id"> locally_integrable</span><span class="id"> D</span><span class="id"> f</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">forall</span><span class="id"> x,</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> HL</span> (<span class="id">f</span><span class="id"> \_</span><span class="id"> D</span>)<span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> Df</span><span class="id"> x;</span><span class="id"> apply:</span><span class="id"> ereal_sup_le</span><span class="id"> =&gt;</span><span class="id"> //=</span>.<br/>
<span class="id">pose</span><span class="id"> k</span><span class="id"> :=</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span><span class="id"> `&amp;`</span><span class="id"> ball</span><span class="id"> x</span><span class="id"> 1</span>)<span class="id"> `|f</span><span class="id"> x|%:E</span>.<br/>
<span class="gallina-kwd">exists</span> ((<span class="id">fine</span> (<span class="id">mu</span> (<span class="id">ball</span><span class="id"> x</span><span class="id"> 1</span>)))<span class="id">^-1%:E</span><span class="id"> *</span><span class="id"> k</span>)<span class="id">;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> mule_ge0//;</span><span class="id"> last</span><span class="id"> exact:</span><span class="id"> integral_ge0</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> lee_fin//</span><span class="id"> invr_ge0//</span><span class="id"> fine_ge0</span>.<br/>
<span class="gallina-kwd">exists</span><span class="id"> 1%R;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> in_itv/=</span><span class="id"> ltr01</span>.<br/>
<span class="id">rewrite</span><span class="id"> iavg_restrict//;</span><span class="id"> last</span><span class="id"> exact:</span><span class="id"> measurable_ball</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> case:</span><span class="id"> Df</span><span class="id"> =&gt;</span><span class="id"> _</span><span class="id"> /open_measurable</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> HL_maximalT_ge0</span><span class="id"> f</span><span class="id"> :</span><span class="id"> locally_integrable</span><span class="id"> setT</span><span class="id"> f</span><span class="id"> -&gt;</span><span class="gallina-kwd"> forall</span><span class="id"> x,</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> HL</span><span class="id"> f</span><span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> +</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> /HL_maximal_ge0</span><span class="id"> /</span>(_<span class="id"> x</span>)<span class="id">;</span><span class="id"> rewrite</span><span class="id"> patch_setT</span>. Qed.</div></details>
<br/>
<span class="vernacular">Let</span><span class="id"> locally_integrable_ltbally</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> R</span>) (<span class="id">x</span><span class="id"> r</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">locally_integrable</span><span class="id"> setT</span><span class="id"> f</span><span class="id"> -&gt;</span><span class="id"> \int[mu]_</span>(<span class="id">y</span><span class="gallina-kwd"> in</span><span class="id"> ball</span><span class="id"> x</span><span class="id"> r</span>)<span class="id"> `|</span>(<span class="id">f</span><span class="id"> y</span>)<span class="id">%:E|</span><span class="id"> &lt;</span><span class="id"> +oo</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> [mf</span><span class="id"> _</span><span class="id"> locf];</span><span class="id"> have</span><span class="id"> [r0|r0]</span><span class="id"> :=</span><span class="id"> leP</span><span class="id"> r</span><span class="id"> 0%R</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span> (<span class="id">ball0</span><span class="id"> _</span><span class="id"> _</span>).<span class="id">2//</span><span class="id"> integral_set0</span>.<br/>
<span class="id">rewrite</span> (<span class="id">le_lt_trans</span><span class="id"> _</span> (<span class="id">locf</span> (<span class="id">closed_ball</span><span class="id"> x</span><span class="id"> r</span>)<span class="id"> _</span> (<span class="id">closed_ballR_compact</span><span class="id"> _</span>)))<span class="id">//</span>.<br/>
<span class="id">apply:</span><span class="id"> ge0_subset_integral</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> measurable_ball</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> measurable_closed_ball;</span><span class="id"> exact/ltW</span>.<br/>
<span class="id">-</span><span class="id"> apply:</span><span class="id"> measurable_funTS;</span><span class="id"> apply/measurableT_comp</span><span class="id"> =&gt;</span><span class="id"> //=</span>.<br/>
&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> measurableT_comp</span>.<br/>
<span class="id">-</span><span class="id"> exact:</span><span class="id"> subset_closed_ball</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> lower_semicontinuous_HL_maximal</span><span class="id"> f</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">locally_integrable</span><span class="id"> setT</span><span class="id"> f</span><span class="id"> -&gt;</span><span class="id"> lower_semicontinuous</span> (<span class="id">HL</span><span class="id"> f</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> [mf</span><span class="id"> ?</span><span class="id"> locf];</span><span class="id"> apply/lower_semicontinuousP</span><span class="id"> =&gt;</span><span class="id"> a</span>.<br/>
<span class="id">have</span><span class="id"> [a0|a0]</span><span class="id"> :=</span><span class="id"> lerP</span><span class="id"> 0</span><span class="id"> a;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> [X</span><span class="gallina-kwd"> in</span><span class="id"> open</span><span class="id"> X]</span>(_<span class="id"> :</span><span class="id"> _</span><span class="id"> =</span><span class="id"> setT</span>)<span class="id">;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> openT</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply/seteqP;</span><span class="id"> split=&gt;</span><span class="id"> //</span><span class="id"> x</span><span class="id"> _;</span><span class="id"> exact:</span> (<span class="id">lt_le_trans</span><span class="id"> _</span> (<span class="id">HL_maximalT_ge0</span><span class="id"> _</span><span class="id"> _</span>)).<br/>
<span class="id">rewrite</span><span class="id"> openE</span><span class="id"> /=</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> /=</span><span class="id"> /ereal_sup_gt[_</span><span class="id"> [r</span><span class="id"> r0]</span><span class="id"> &lt;-]</span><span class="id"> afxr</span>.<br/>
<span class="id">rewrite</span><span class="id"> /=</span><span class="id"> in_itv</span><span class="id"> /=</span><span class="id"> andbT</span><span class="gallina-kwd"> in</span><span class="id"> r0</span>.<br/>
<span class="id">rewrite</span><span class="id"> /iavg</span><span class="gallina-kwd"> in</span><span class="id"> afxr;</span><span class="id"> set</span><span class="id"> k</span><span class="id"> :=</span><span class="id"> \int[_]_</span>(_<span class="gallina-kwd"> in</span><span class="id"> _</span>)<span class="id"> _</span><span class="gallina-kwd"> in</span><span class="id"> afxr</span>.<br/>
<span class="id">apply:</span><span class="id"> nbhs_singleton;</span><span class="id"> apply:</span><span class="id"> nbhs_interior;</span><span class="id"> rewrite</span><span class="id"> nbhsE</span><span class="id"> /=</span>.<br/>
<span class="id">have</span><span class="id"> k_gt0</span><span class="id"> :</span><span class="id"> 0</span><span class="id"> &lt;</span><span class="id"> k</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> lt0e</span><span class="id"> integral_ge0//</span><span class="id"> andbT;</span><span class="id"> apply/negP</span><span class="id"> =&gt;</span><span class="id"> /eqP</span><span class="id"> k0</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move:</span><span class="id"> afxr;</span><span class="id"> rewrite</span><span class="id"> k0</span><span class="id"> mule0</span><span class="id"> lte_fin</span><span class="id"> ltNge</span><span class="id"> a0</span>.<br/>
<span class="id">move:</span><span class="id"> a0;</span><span class="id"> rewrite</span><span class="id"> le_eqVlt</span><span class="id"> =&gt;</span><span class="id"> /predU1P[a0|a0]</span>.<br/>
&nbsp;&nbsp;<span class="id">move:</span><span class="id"> afxr;</span><span class="id"> rewrite</span><span class="id"> -{a}a0</span><span class="id"> =&gt;</span><span class="id"> xrk</span>.<br/>
&nbsp;&nbsp;<span class="id">near</span> (<span class="id">0%R</span><span class="id"> :</span><span class="id"> R</span>)<span class="id">^'+</span><span class="id"> =&gt;</span><span class="id"> d</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> xrdk</span><span class="id"> :</span><span class="id"> 0</span><span class="id"> &lt;</span> (<span class="id">fine</span> (<span class="id">mu</span> (<span class="id">ball</span><span class="id"> x</span> (<span class="id">r</span><span class="id"> +</span><span class="id"> d</span>))))<span class="id">^-1%:E</span><span class="id"> *</span><span class="id"> k</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> mule_gt0//</span><span class="id"> lte_fin</span><span class="id"> invr_gt0//</span><span class="id"> fine_gt0//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> lebesgue_measure_ball;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> addr_ge0//</span><span class="id"> ltW</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> ltry</span><span class="id"> andbT</span><span class="id"> lte_fin</span><span class="id"> pmulrn_lgt0//</span><span class="id"> addr_gt0</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">exists</span> (<span class="id">ball</span><span class="id"> x</span><span class="id"> d</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> split;</span><span class="id"> [exact:</span><span class="id"> ball_open|exact:</span><span class="id"> ballxx]</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> y;</span><span class="id"> rewrite</span><span class="id"> /ball/=</span><span class="id"> =&gt;</span><span class="id"> xyd</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> ?</span><span class="id"> :</span><span class="id"> ball</span><span class="id"> x</span><span class="id"> r</span><span class="id"> `&lt;=`</span><span class="id"> ball</span><span class="id"> y</span> (<span class="id">r</span><span class="id"> +</span><span class="id"> d</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> /=</span><span class="id"> z;</span><span class="id"> rewrite</span><span class="id"> /ball/=</span><span class="id"> =&gt;</span><span class="id"> xzr;</span><span class="id"> rewrite</span><span class="id"> -</span>(<span class="id">subrK</span><span class="id"> x</span><span class="id"> y</span>)<span class="id"> -</span>(<span class="id">addrA</span> (<span class="id">y</span><span class="id"> -</span><span class="id"> x</span>)<span class="id">%R</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span> (<span class="id">le_lt_trans</span> (<span class="id">ler_normD</span><span class="id"> _</span><span class="id"> _</span>))<span class="id">//</span><span class="id"> [ltLHS]addrC</span><span class="id"> ltrD//</span><span class="id"> distrC</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> ?</span><span class="id"> :</span><span class="id"> k</span><span class="id"> &lt;=</span><span class="id"> \int[mu]_</span>(<span class="id">y</span><span class="gallina-kwd"> in</span><span class="id"> ball</span><span class="id"> y</span> (<span class="id">r</span><span class="id"> +</span><span class="id"> d</span>))<span class="id"> `|</span>(<span class="id">f</span><span class="id"> y</span>)<span class="id">%:E|</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> ge0_subset_integral</span><span class="id"> =&gt;//;</span><span class="id"> [exact:measurable_ball|</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exact:measurable_ball|]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> measurable_funTS;</span><span class="id"> apply:</span><span class="id"> measurableT_comp</span><span class="id"> =&gt;</span><span class="id"> //=</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply/measurableT_comp</span><span class="id"> =&gt;</span><span class="id"> //=;</span><span class="id"> case:</span><span class="id"> locf</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> :</span><span class="id"> iavg</span><span class="id"> f</span> (<span class="id">ball</span><span class="id"> y</span> (<span class="id">r</span><span class="id"> +</span><span class="id"> d</span>))<span class="id"> &lt;=</span><span class="id"> HL</span><span class="id"> f</span><span class="id"> y</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> ereal_sup_ubound</span><span class="id"> =&gt;</span><span class="id"> /=;</span><span class="gallina-kwd"> exists</span> (<span class="id">r</span><span class="id"> +</span><span class="id"> d</span>)<span class="id">%R</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> in_itv/=</span><span class="id"> andbT</span><span class="id"> addr_gt0</span>.<br/>
&nbsp;&nbsp;<span class="id">apply/lt_le_trans/</span>(<span class="id">lt_le_trans</span><span class="id"> xrdk</span>)<span class="id">;</span><span class="id"> rewrite</span><span class="id"> /iavg</span>.<br/>
&nbsp;&nbsp;<span class="id">do</span><span class="id"> 2</span> (<span class="id">rewrite</span><span class="id"> lebesgue_measure_ball;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> addr_ge0//</span><span class="id"> ltW</span>).<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> lee_wpmul2l//</span><span class="id"> lee_fin</span><span class="id"> invr_ge0//</span><span class="id"> fine_ge0//</span><span class="id"> lee_fin</span><span class="id"> pmulrn_rge0//</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> addr_gt0</span>.<br/>
<span class="id">have</span><span class="id"> ka_pos</span><span class="id"> :</span><span class="id"> fine</span><span class="id"> k</span><span class="id"> /</span><span class="id"> a</span><span class="id"> \is</span><span class="id"> Num</span>.<span class="id">pos</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> posrE</span><span class="id"> divr_gt0//</span><span class="id"> fine_gt0</span><span class="id"> //</span><span class="id"> k_gt0/=</span><span class="id"> locally_integrable_ltbally</span>.<br/>
<span class="id">have</span><span class="id"> k_fin_num</span><span class="id"> :</span><span class="id"> k</span><span class="id"> \is</span><span class="id"> a</span><span class="id"> fin_num</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> ge0_fin_numE</span><span class="id"> ?locally_integrable_ltbally//</span><span class="id"> integral_ge0</span>.<br/>
<span class="id">have</span><span class="id"> kar</span><span class="id"> :</span> (<span class="id">0</span><span class="id"> &lt;</span><span class="id"> 2^-1</span><span class="id"> *</span> (<span class="id">fine</span><span class="id"> k</span><span class="id"> /</span><span class="id"> a</span>)<span class="id"> -</span><span class="id"> r</span>)<span class="id">%R</span>.<br/>
&nbsp;&nbsp;<span class="id">move:</span><span class="id"> afxr;</span><span class="id"> rewrite</span><span class="id"> -{1}</span>(<span class="id">fineK</span><span class="id"> k_fin_num</span>)<span class="id"> -lte_pdivrMr;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> fine_gt0//</span><span class="id"> k_gt0/=</span><span class="id"> ltey_eq</span><span class="id"> k_fin_num</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> (<span class="id">lebesgue_measure_ball</span><span class="id"> _</span> (<span class="id">ltW</span><span class="id"> r0</span>))<span class="id">//</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -!EFinM</span><span class="id"> !lte_fin</span><span class="id"> -invf_div</span><span class="id"> ltf_pV2</span><span class="id"> ?posrE</span><span class="id"> ?pmulrn_lgt0//</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> /=</span><span class="id"> -[in</span><span class="id"> X</span><span class="gallina-kwd"> in</span><span class="id"> X</span><span class="id"> -&gt;</span><span class="id"> _]mulr_natl</span><span class="id"> -ltr_pdivlMl//</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -[in</span><span class="id"> X</span><span class="gallina-kwd"> in</span><span class="id"> X</span><span class="id"> -&gt;</span><span class="id"> _]subr_gt0</span>.<br/>
<span class="id">near</span> (<span class="id">0%R</span><span class="id"> :</span><span class="id"> R</span>)<span class="id">^'+</span><span class="id"> =&gt;</span><span class="id"> d</span>.<br/>
<span class="id">have</span><span class="id"> axrdk</span><span class="id"> :</span><span class="id"> a%:E</span><span class="id"> &lt;</span> (<span class="id">fine</span> (<span class="id">mu</span> (<span class="id">ball</span><span class="id"> x</span> (<span class="id">r</span><span class="id"> +</span><span class="id"> d</span>))))<span class="id">^-1%:E</span><span class="id"> *</span><span class="id"> k</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> lebesgue_measure_ball//;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> addr_ge0//</span><span class="id"> ltW</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -</span>(<span class="id">fineK</span><span class="id"> k_fin_num</span>)<span class="id"> -lte_pdivrMr;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> fine_gt0//</span><span class="id"> k_gt0/=</span><span class="id"> locally_integrable_ltbally</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -!EFinM</span><span class="id"> !lte_fin</span><span class="id"> -invf_div</span><span class="id"> ltf_pV2//;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> posrE</span><span class="id"> fine_gt0//</span><span class="id"> ltry</span><span class="id"> andbT</span><span class="id"> lte_fin</span><span class="id"> pmulrn_lgt0//</span><span class="id"> addr_gt0</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -mulr_natl</span><span class="id"> -ltr_pdivlMl//</span><span class="id"> -ltrBrDl</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> near:</span><span class="id"> d;</span><span class="id"> exact:</span><span class="id"> nbhs_right_lt</span>.<br/>
<span class="gallina-kwd">exists</span> (<span class="id">ball</span><span class="id"> x</span><span class="id"> d</span>).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> split;</span><span class="id"> [exact:</span><span class="id"> ball_open|exact:</span><span class="id"> ballxx]</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> y;</span><span class="id"> rewrite</span><span class="id"> /ball/=</span><span class="id"> =&gt;</span><span class="id"> xyd</span>.<br/>
<span class="id">have</span><span class="id"> ?</span><span class="id"> :</span><span class="id"> ball</span><span class="id"> x</span><span class="id"> r</span><span class="id"> `&lt;=`</span><span class="id"> ball</span><span class="id"> y</span> (<span class="id">r</span><span class="id"> +</span><span class="id"> d</span>).<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> /=</span><span class="id"> z;</span><span class="id"> rewrite</span><span class="id"> /ball/=</span><span class="id"> =&gt;</span><span class="id"> xzr;</span><span class="id"> rewrite</span><span class="id"> -</span>(<span class="id">subrK</span><span class="id"> x</span><span class="id"> y</span>)<span class="id"> -</span>(<span class="id">addrA</span> (<span class="id">y</span><span class="id"> -</span><span class="id"> x</span>)<span class="id">%R</span>).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span> (<span class="id">le_lt_trans</span> (<span class="id">ler_normD</span><span class="id"> _</span><span class="id"> _</span>))<span class="id">//</span><span class="id"> [ltLHS]addrC</span><span class="id"> ltrD//</span><span class="id"> distrC</span>.<br/>
<span class="id">have</span><span class="id"> ?</span><span class="id"> :</span><span class="id"> k</span><span class="id"> &lt;=</span><span class="id"> \int[mu]_</span>(<span class="id">z</span><span class="gallina-kwd"> in</span><span class="id"> ball</span><span class="id"> y</span> (<span class="id">r</span><span class="id"> +</span><span class="id"> d</span>))<span class="id"> `|</span>(<span class="id">f</span><span class="id"> z</span>)<span class="id">%:E|</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> ge0_subset_integral</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> [exact:</span><span class="id"> measurable_ball|</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> measurable_ball|]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> measurable_funTS;</span><span class="id"> do</span><span class="id"> 2</span><span class="id"> apply:</span><span class="id"> measurableT_comp</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
<span class="id">have</span><span class="id"> afxrdi</span><span class="id"> :</span><span class="id"> a%:E</span><span class="id"> &lt;</span> (<span class="id">fine</span> (<span class="id">mu</span> (<span class="id">ball</span><span class="id"> x</span> (<span class="id">r</span><span class="id"> +</span><span class="id"> d</span>))))<span class="id">^-1%:E</span><span class="id"> *</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">\int[mu]_</span>(<span class="id">z</span><span class="gallina-kwd"> in</span><span class="id"> ball</span><span class="id"> y</span> (<span class="id">r</span><span class="id"> +</span><span class="id"> d</span>))<span class="id"> `|</span>(<span class="id">f</span><span class="id"> z</span>)<span class="id">%:E|</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span> (<span class="id">lt_le_trans</span><span class="id"> axrdk</span>)<span class="id">//</span><span class="id"> lee_wpmul2l//</span><span class="id"> lee_fin</span><span class="id"> invr_ge0//</span><span class="id"> fine_ge0</span>.<br/>
<span class="id">have</span><span class="id"> /lt_le_trans</span><span class="id"> :</span><span class="id"> a%:E</span><span class="id"> &lt;</span><span class="id"> iavg</span><span class="id"> f</span> (<span class="id">ball</span><span class="id"> y</span> (<span class="id">r</span><span class="id"> +</span><span class="id"> d</span>)).<br/>
&nbsp;&nbsp;<span class="id">apply:</span> (<span class="id">lt_le_trans</span><span class="id"> afxrdi</span>)<span class="id">;</span><span class="id"> rewrite</span><span class="id"> /iavg</span>.<br/>
&nbsp;&nbsp;<span class="id">do</span><span class="id"> 2</span> (<span class="id">rewrite</span><span class="id"> lebesgue_measure_ball;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> addr_ge0//</span><span class="id"> ltW</span>).<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> lee_wpmul2l//</span><span class="id"> lee_fin</span><span class="id"> invr_ge0//</span><span class="id"> fine_ge0//=</span><span class="id"> lee_fin</span><span class="id"> pmulrn_rge0//</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> addr_gt0</span>.<br/>
<span class="id">apply;</span><span class="id"> apply:</span><span class="id"> ereal_sup_ubound</span><span class="id"> =&gt;</span><span class="id"> /=</span>.<br/>
<span class="gallina-kwd">by</span><span class="gallina-kwd"> exists</span> (<span class="id">r</span><span class="id"> +</span><span class="id"> d</span>)<span class="id">%R</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> rewrite</span><span class="id"> in_itv/=</span><span class="id"> andbT</span><span class="id"> addr_gt0</span>.<br/>
<span class="id">Unshelve</span>.<span class="id"> all:</span><span class="gallina-kwd"> by</span><span class="id"> end_near</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> measurable_HL_maximal</span><span class="id"> f</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">locally_integrable</span><span class="id"> setT</span><span class="id"> f</span><span class="id"> -&gt;</span><span class="id"> measurable_fun</span><span class="id"> setT</span> (<span class="id">HL</span><span class="id"> f</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> lf;</span><span class="id"> apply:</span><span class="id"> lower_semicontinuous_measurable</span>.<br/>
<span class="id">exact:</span><span class="id"> lower_semicontinuous_HL_maximal</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Let</span><span class="id"> norm1</span><span class="id"> D</span><span class="id"> f</span><span class="id"> :=</span><span class="id"> \int[mu]_</span>(<span class="id">y</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> `|</span>(<span class="id">f</span><span class="id"> y</span>)<span class="id">%:E|</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> maximal_inequality</span><span class="id"> f</span><span class="id"> c</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">locally_integrable</span><span class="id"> setT</span><span class="id"> f</span><span class="id"> -&gt;</span> (<span class="id">0</span><span class="id"> &lt;</span><span class="id"> c</span>)<span class="id">%R</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">mu</span><span class="id"> [set</span><span class="id"> x</span><span class="id"> |</span><span class="id"> HL</span><span class="id"> f</span><span class="id"> x</span><span class="id"> &gt;</span><span class="id"> c%:E]</span><span class="id"> &lt;=</span> (<span class="id">3</span><span class="id"> /</span><span class="id"> c</span>)<span class="id">%:E</span><span class="id"> *</span><span class="id"> norm1</span><span class="id"> setT</span><span class="id"> f</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> /=</span><span class="id"> locf</span><span class="id"> c0</span>.<br/>
<span class="id">rewrite</span><span class="id"> lebesgue_regularity_inner_sup//;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -[X</span><span class="gallina-kwd"> in</span><span class="id"> measurable</span><span class="id"> X]setTI;</span><span class="id"> apply:</span><span class="id"> emeasurable_fun_o_infty</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> measurable_HL_maximal</span>.<br/>
<span class="id">apply:</span><span class="id"> ub_ereal_sup</span><span class="id"> =&gt;</span><span class="id"> /=</span><span class="id"> x</span><span class="id"> /=</span><span class="id"> [K</span><span class="id"> [cK</span><span class="id"> Kcmf</span><span class="id"> &lt;-{x}]]</span>.<br/>
<span class="id">have</span><span class="id"> r_proof</span><span class="id"> x</span><span class="id"> :</span><span class="id"> HL</span><span class="id"> f</span><span class="id"> x</span><span class="id"> &gt;</span><span class="id"> c%:E</span><span class="id"> -&gt;</span><span class="id"> {r</span><span class="id"> |</span> (<span class="id">0</span><span class="id"> &lt;</span><span class="id"> r</span>)<span class="id">%R</span><span class="id"> &amp;</span><span class="id"> iavg</span><span class="id"> f</span> (<span class="id">ball</span><span class="id"> x</span><span class="id"> r</span>)<span class="id"> &gt;</span><span class="id"> c%:E}</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> /ereal_sup_gt/cid2[y</span><span class="id"> /=</span><span class="id"> /cid2[r]]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> in_itv/=</span><span class="id"> andbT</span><span class="id"> =&gt;</span><span class="id"> rg0</span><span class="id"> &lt;-{y}</span><span class="id"> Hc;</span><span class="gallina-kwd"> exists</span><span class="id"> r</span>.<br/>
<span class="id">pose</span><span class="id"> r_</span><span class="id"> x</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">if</span><span class="id"> pselect</span> (<span class="id">HL</span><span class="id"> f</span><span class="id"> x</span><span class="id"> &gt;</span><span class="id"> c%:E</span>)<span class="id"> is</span><span class="id"> left</span><span class="id"> H</span><span class="gallina-kwd"> then</span><span class="id"> s2val</span> (<span class="id">r_proof</span><span class="id"> _</span><span class="id"> H</span>)<span class="gallina-kwd"> else</span><span class="id"> 1%R</span>.<br/>
<span class="id">have</span><span class="id"> r_pos</span> (<span class="id">x</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span> (<span class="id">0</span><span class="id"> &lt;</span><span class="id"> r_</span><span class="id"> x</span>)<span class="id">%R</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /r_;</span><span class="id"> case:</span><span class="id"> pselect</span><span class="id"> =&gt;</span><span class="id"> //=</span><span class="id"> cMfx;</span><span class="id"> case:</span> (<span class="id">r_proof</span><span class="id"> _</span><span class="id"> cMfx</span>).<br/>
<span class="id">have</span><span class="id"> cMfx_int</span><span class="id"> x</span><span class="id"> :</span><span class="id"> c%:E</span><span class="id"> &lt;</span><span class="id"> HL</span><span class="id"> f</span><span class="id"> x</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">\int[mu]_</span>(<span class="id">y</span><span class="gallina-kwd"> in</span><span class="id"> ball</span><span class="id"> x</span> (<span class="id">r_</span><span class="id"> x</span>))<span class="id"> `|</span>(<span class="id">f</span><span class="id"> y</span>)<span class="id">|%:E</span><span class="id"> &gt;</span><span class="id"> c%:E</span><span class="id"> *</span><span class="id"> mu</span> (<span class="id">ball</span><span class="id"> x</span> (<span class="id">r_</span><span class="id"> x</span>)).<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> cMfx;</span><span class="id"> rewrite</span><span class="id"> /r_;</span><span class="id"> case:</span><span class="id"> pselect</span><span class="id"> =&gt;</span><span class="id"> //=</span><span class="id"> =&gt;</span><span class="id"> {}cMfx</span>.<br/>
&nbsp;&nbsp;<span class="id">case:</span> (<span class="id">r_proof</span><span class="id"> _</span><span class="id"> cMfx</span>)<span class="id"> =&gt;</span><span class="id"> /=</span><span class="id"> r</span><span class="id"> r0</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> ?</span><span class="id"> :</span><span class="id"> 0%R</span><span class="id"> &lt;</span> (<span class="id">fine</span> (<span class="id">mu</span> (<span class="id">ball</span><span class="id"> x</span><span class="id"> r</span>)))<span class="id">%:E</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> lte_fin</span><span class="id"> fine_gt0//</span> (<span class="id">lebesgue_measure_ball</span><span class="id"> _</span> (<span class="id">ltW</span><span class="id"> r0</span>))<span class="id">//</span><span class="id"> ltry</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> lte_fin</span><span class="id"> mulrn_wgt0</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> /iavg</span><span class="id"> -</span>(<span class="id">@lte_pmul2r</span><span class="id"> _</span> (<span class="id">fine</span> (<span class="id">mu</span> (<span class="id">ball</span><span class="id"> x</span><span class="id"> r</span>)))<span class="id">%:E</span>)<span class="id">//</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> muleAC</span><span class="id"> -[in</span><span class="id"> X</span><span class="gallina-kwd"> in</span><span class="id"> _</span><span class="id"> &lt;</span><span class="id"> X]EFinM</span><span class="id"> mulVf</span><span class="id"> ?gt_eqF//</span><span class="id"> mul1e</span><span class="id"> fineK//</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> ge0_fin_numE//</span> (<span class="id">lebesgue_measure_ball</span><span class="id"> _</span> (<span class="id">ltW</span><span class="id"> r0</span>))<span class="id"> ltry</span>.<br/>
<span class="id">set</span><span class="id"> B</span><span class="id"> :=</span><span class="gallina-kwd"> fun</span><span class="id"> r</span><span class="id"> =&gt;</span><span class="id"> ball</span><span class="id"> r</span> (<span class="id">r_</span><span class="id"> r</span>).<br/>
<span class="id">have</span><span class="id"> {}Kcmf</span><span class="id"> :</span><span class="id"> K</span><span class="id"> `&lt;=`</span><span class="id"> cover</span><span class="id"> [set</span><span class="id"> i</span><span class="id"> |</span><span class="id"> HL</span><span class="id"> f</span><span class="id"> i</span><span class="id"> &gt;</span><span class="id"> c%:E]</span> (<span class="gallina-kwd">fun</span><span class="id"> i</span><span class="id"> =&gt;</span><span class="id"> ball</span><span class="id"> i</span> (<span class="id">r_</span><span class="id"> i</span>)).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> r</span><span class="id"> /Kcmf</span><span class="id"> /=</span><span class="id"> cMfr;</span><span class="gallina-kwd"> exists</span><span class="id"> r</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> ballxx</span>.<br/>
<span class="id">have</span><span class="id"> {Kcmf}[D</span><span class="id"> Dsub</span><span class="id"> Kcover]</span><span class="id"> :</span><span class="id"> finite_subset_cover</span><span class="id"> [set</span><span class="id"> i</span><span class="id"> |</span><span class="id"> c%:E</span><span class="id"> &lt;</span><span class="id"> HL</span><span class="id"> f</span><span class="id"> i]</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="gallina-kwd">fun</span><span class="id"> i</span><span class="id"> =&gt;</span><span class="id"> ball</span><span class="id"> i</span> (<span class="id">r_</span><span class="id"> i</span>))<span class="id"> K</span>.<br/>
&nbsp;&nbsp;<span class="id">move:</span><span class="id"> cK;</span><span class="id"> rewrite</span><span class="id"> compact_cover</span><span class="id"> =&gt;</span><span class="id"> /</span>(_<span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> Kcmf</span>)<span class="id">;</span><span class="id"> apply</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> /=</span><span class="id"> x</span><span class="id"> cMfx;</span><span class="id"> exact/ball_open/r_pos</span>.<br/>
<span class="id">have</span><span class="id"> KDB</span><span class="id"> :</span><span class="id"> K</span><span class="id"> `&lt;=`</span><span class="id"> cover</span><span class="id"> [set`</span><span class="id"> D]</span><span class="id"> B</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span> (<span class="id">subset_trans</span><span class="id"> Kcover</span>)<span class="id"> =&gt;</span><span class="id"> /=</span><span class="id"> x</span><span class="id"> [r</span><span class="id"> Dr]</span><span class="id"> rx;</span><span class="gallina-kwd"> exists</span><span class="id"> r</span>.<br/>
<span class="id">have</span><span class="id"> is_ballB</span><span class="id"> i</span><span class="id"> :</span><span class="id"> is_ball</span> (<span class="id">B</span><span class="id"> i</span>)<span class="gallina-kwd"> by</span><span class="id"> exact:</span><span class="id"> is_ball_ball</span>.<br/>
<span class="id">have</span><span class="id"> Bset0</span><span class="id"> i</span><span class="id"> :</span><span class="id"> B</span><span class="id"> i</span><span class="id"> !=set0</span><span class="gallina-kwd"> by</span><span class="gallina-kwd"> exists</span><span class="id"> i;</span><span class="id"> exact:</span><span class="id"> ballxx</span>.<br/>
<span class="id">have</span><span class="id"> [E</span><span class="id"> [uE</span><span class="id"> ED</span><span class="id"> tEB</span><span class="id"> DE]]</span><span class="id"> :=</span><span class="id"> @vitali_lemma_finite_cover</span><span class="id"> _</span><span class="id"> _</span><span class="id"> B</span><span class="id"> is_ballB</span><span class="id"> Bset0</span><span class="id"> D</span>.<br/>
<span class="id">rewrite</span> (<span class="id">@le_trans</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">3%:E</span><span class="id"> *</span><span class="id"> \sum_</span>(<span class="id">i</span><span class="id"> &lt;-</span><span class="id"> E</span>)<span class="id"> mu</span> (<span class="id">B</span><span class="id"> i</span>)))<span class="id">//</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> {}DE</span><span class="id"> :=</span><span class="id"> subset_trans</span><span class="id"> KDB</span><span class="id"> DE</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span> (<span class="id">le_trans</span> (<span class="id">@content_subadditive</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> mu</span><span class="id"> K</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="gallina-kwd">fun</span><span class="id"> i</span><span class="id"> =&gt;</span><span class="id"> 3</span><span class="id"> *`</span><span class="id"> B</span> (<span class="id">nth</span><span class="id"> 0%R</span><span class="id"> E</span><span class="id"> i</span>)) (<span class="id">size</span><span class="id"> E</span>)<span class="id"> _</span><span class="id"> _</span><span class="id"> _</span>))<span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> k</span><span class="id"> ?;</span><span class="id"> rewrite</span><span class="id"> scale_ballE//;</span><span class="id"> exact:</span><span class="id"> measurable_ball</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> closed_measurable;</span><span class="id"> apply:</span><span class="id"> compact_closed</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> Rhausdorff</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> apply:</span> (<span class="id">subset_trans</span><span class="id"> DE</span>)<span class="id">;</span><span class="id"> rewrite</span><span class="id"> /cover</span><span class="id"> bigcup_seq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span> (<span class="id">big_nth</span><span class="id"> 0%R</span>)<span class="id">//=</span><span class="id"> big_mkord</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> rewrite</span><span class="id"> ge0_sume_distrr//=</span> (<span class="id">big_nth</span><span class="id"> 0%R</span>)<span class="id"> big_mkord;</span><span class="id"> apply:</span><span class="id"> lee_sum</span><span class="id"> =&gt;</span><span class="id"> i</span><span class="id"> _</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> scale_ballE//</span><span class="id"> !lebesgue_measure_ball</span><span class="id"> ?mulr_ge0</span><span class="id"> ?</span>(<span class="id">ltW</span> (<span class="id">r_pos</span><span class="id"> _</span>))<span class="id">//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -mulrnAr</span><span class="id"> EFinM</span>.<br/>
<span class="id">rewrite</span><span class="id"> !EFinM</span><span class="id"> -muleA</span><span class="id"> lee_wpmul2l//=</span>.<br/>
<span class="id">apply:</span> (<span class="id">@le_trans</span><span class="id"> _</span><span class="id"> _</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">\sum_</span>(<span class="id">i</span><span class="id"> &lt;-</span><span class="id"> E</span>)<span class="id"> c^-1%:E</span><span class="id"> *</span><span class="id"> \int[mu]_</span>(<span class="id">y</span><span class="gallina-kwd"> in</span><span class="id"> B</span><span class="id"> i</span>)<span class="id"> `|</span>(<span class="id">f</span><span class="id"> y</span>)<span class="id">|%:E</span>)).<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> [in</span><span class="id"> leLHS]big_seq</span><span class="id"> [in</span><span class="id"> leRHS]big_seq;</span><span class="id"> apply:</span><span class="id"> lee_sum</span><span class="id"> =&gt;</span><span class="id"> r</span><span class="id"> /ED</span><span class="id"> /Dsub</span><span class="id"> /[!inE]</span><span class="id"> rD</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -lee_pdivrMl</span><span class="id"> ?invr_gt0//</span><span class="id"> invrK</span><span class="id"> /B/=;</span><span class="id"> exact/ltW/cMfx_int</span>.<br/>
<span class="id">rewrite</span><span class="id"> -ge0_sume_distrr//;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> integral_ge0</span>.<br/>
<span class="id">rewrite</span><span class="id"> lee_wpmul2l//;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> lee_fin</span><span class="id"> invr_ge0</span><span class="id"> ltW</span>.<br/>
<span class="id">rewrite</span><span class="id"> -ge0_integral_bigsetU//=</span>.<br/>
<span class="id">-</span><span class="id"> apply:</span><span class="id"> ge0_subset_integral</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> bigsetU_measurable</span><span class="id"> =&gt;</span><span class="id"> ?</span><span class="id"> ?;</span><span class="id"> exact:</span><span class="id"> measurable_ball</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> measurableT_comp</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> apply:</span><span class="id"> measurableT_comp</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> case:</span><span class="id"> locf</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> n;</span><span class="id"> exact:</span><span class="id"> measurable_ball</span>.<br/>
<span class="id">-</span><span class="id"> apply:</span><span class="id"> measurableT_comp</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> apply:</span><span class="id"> measurable_funTS</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> measurableT_comp</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> case:</span><span class="id"> locf</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> hardy_littlewood</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> davg</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {R</span><span class="id"> :</span><span class="id"> realType}</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Notation</span><span class="id"> mu</span><span class="id"> :=</span> (<span class="id">@lebesgue_measure</span><span class="id"> R</span>).<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<span class="vernacular">Implicit</span><span class="id"> Types</span><span class="id"> f</span><span class="id"> g</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> R</span>.<br/>
<br/>
<span class="vernacular">Definition</span><span class="id"> davg</span><span class="id"> f</span><span class="id"> x</span> (<span class="id">r</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :=</span><span class="id"> iavg</span> (<span class="id">center</span> (<span class="id">f</span><span class="id"> x</span>)<span class="id"> \o</span><span class="id"> f</span>) (<span class="id">ball</span><span class="id"> x</span><span class="id"> r</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> davg0</span><span class="id"> f</span><span class="id"> x</span> (<span class="id">r</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span> (<span class="id">r</span><span class="id"> &lt;=</span><span class="id"> 0</span>)<span class="id">%R</span><span class="id"> -&gt;</span><span class="id"> davg</span><span class="id"> f</span><span class="id"> x</span><span class="id"> r</span><span class="id"> =</span><span class="id"> 0</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> r0;</span><span class="id"> rewrite</span><span class="id"> /davg/=</span> (<span class="id">ball0</span><span class="id"> _</span><span class="id"> _</span>).<span class="id">2//=</span><span class="id"> iavg0</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> davg_ge0</span><span class="id"> f</span><span class="id"> x</span> (<span class="id">r</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> davg</span><span class="id"> f</span><span class="id"> x</span><span class="id"> r</span><br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id"> exact:</span><span class="id"> iavg_ge0</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> davgD</span><span class="id"> f</span><span class="id"> g</span> (<span class="id">x</span><span class="id"> r</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">measurable_fun</span> (<span class="id">ball</span><span class="id"> x</span><span class="id"> r</span>)<span class="id"> f</span><span class="id"> -&gt;</span><span class="id"> measurable_fun</span> (<span class="id">ball</span><span class="id"> x</span><span class="id"> r</span>)<span class="id"> g</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">davg</span> (<span class="id">f</span><span class="id"> \+</span><span class="id"> g</span>)<span class="id">%R</span><span class="id"> x</span><span class="id"> r</span><span class="id"> &lt;=</span> (<span class="id">davg</span><span class="id"> f</span><span class="id"> x</span><span class="id"> \+</span><span class="id"> davg</span><span class="id"> g</span><span class="id"> x</span>)<span class="id"> r</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> mf</span><span class="id"> mg;</span><span class="id"> rewrite</span> (<span class="id">le_trans</span><span class="id"> _</span> (<span class="id">iavgD</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span>))<span class="id"> //</span>.<br/>
<span class="id">-</span><span class="id"> rewrite</span><span class="id"> le_eqVlt;</span><span class="id"> apply/orP;</span><span class="id"> left;</span><span class="id"> apply/eqP</span><span class="id"> =&gt;</span><span class="id"> /=;</span><span class="id"> congr</span><span class="id"> iavg</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply/funext</span><span class="id"> =&gt;</span><span class="id"> e</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> opprD</span><span class="id"> addrACA</span>.<br/>
<span class="id">-</span><span class="id"> exact:</span><span class="id"> measurable_ball</span>.<br/>
<span class="id">-</span><span class="id"> have</span><span class="id"> [r0|r0]</span><span class="id"> :=</span><span class="id"> leP</span><span class="id"> r</span><span class="id"> 0%R;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span> (<span class="id">ball0</span><span class="id"> _</span><span class="id"> _</span>).<span class="id">2//</span><span class="id"> measure0</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span> (<span class="id">lebesgue_measure_ball</span><span class="id"> _</span> (<span class="id">ltW</span><span class="id"> r0</span>))<span class="id"> ltry</span>.<br/>
<span class="id">-</span><span class="id"> exact:</span><span class="id"> measurable_funB</span>.<br/>
<span class="id">-</span><span class="id"> exact:</span><span class="id"> measurable_funB</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> near_davg</span><span class="id"> f</span> (<span class="id">a</span><span class="id"> :</span><span class="id"> itv_bound</span><span class="id"> R</span>)<span class="id"> x</span> (<span class="id">u</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span> (<span class="id">x</span><span class="id"> &lt;</span><span class="id"> u</span>)<span class="id">%R</span><span class="id"> -&gt;</span> (<span class="id">a</span><span class="id"> &lt;</span><span class="id"> BRight</span><span class="id"> x</span>)<span class="id">%E</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">\forall</span><span class="id"> r</span><span class="id"> \near</span><span class="id"> 0^'+,</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">davg</span><span class="id"> f</span><span class="id"> x</span><span class="id"> r</span><span class="id"> =</span><span class="id"> davg</span> (<span class="id">f</span><span class="id"> \_</span><span class="id"> [set`</span><span class="id"> Interval</span><span class="id"> a</span> (<span class="id">BRight</span><span class="id"> u</span>)<span class="id">]</span>)<span class="id"> x</span><span class="id"> r</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> xu;</span><span class="id"> move:</span><span class="id"> a</span><span class="id"> =&gt;</span><span class="id"> [b</span><span class="id"> a</span><span class="id"> /=|[_|//]]</span>.<br/>
<span class="id">-</span><span class="id"> move=&gt;</span><span class="id"> ax;</span><span class="id"> near=&gt;</span><span class="id"> r</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> fauf</span><span class="id"> :</span><span class="id"> {in</span><span class="id"> ball</span><span class="id"> x</span><span class="id"> r</span><span class="id"> :</span><span class="id"> set</span><span class="id"> R,</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">f</span><span class="id"> \_</span><span class="id"> [set`</span><span class="id"> Interval</span> (<span class="id">BSide</span><span class="id"> b</span><span class="id"> a</span>) (<span class="id">BRight</span><span class="id"> u</span>)<span class="id">]</span><span class="id"> =1</span><span class="id"> f}</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> y</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> ball_itv/=</span><span class="id"> inE/=</span><span class="id"> =&gt;</span><span class="id"> yxr;</span><span class="id"> rewrite</span><span class="id"> patchE/=</span><span class="id"> mem_set//=</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> subset_itvW</span><span class="id"> yxr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> lerBrDl</span><span class="id"> -lerBrDr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> near:</span><span class="id"> r;</span><span class="id"> apply:</span><span class="id"> nbhs_right_ltW;</span><span class="id"> rewrite</span><span class="id"> subr_gt0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -lerBrDl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> near:</span><span class="id"> r;</span><span class="id"> apply:</span><span class="id"> nbhs_right_le;</span><span class="id"> rewrite</span><span class="id"> subr_gt0</span>.<br/>
&nbsp;&nbsp;<span class="id">congr</span><span class="id"> *%E;</span><span class="id"> apply:</span><span class="id"> eq_integral</span><span class="id"> =&gt;</span><span class="id"> y</span><span class="id"> yxr</span><span class="id"> /=</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> fauf//</span><span class="id"> fauf//</span><span class="id"> inE;</span><span class="id"> exact:</span><span class="id"> ballxx</span>.<br/>
<span class="id">-</span><span class="id"> near=&gt;</span><span class="id"> r</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> foouf</span><span class="id"> :</span><span class="id"> {in</span> (<span class="id">ball</span><span class="id"> x</span><span class="id"> r</span><span class="id"> :</span><span class="id"> set</span><span class="id"> R</span>)<span class="id">,</span><span class="id"> f</span><span class="id"> \_</span><span class="id"> `]-oo,</span><span class="id"> u]</span><span class="id"> =1</span><span class="id"> f}</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> y</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> ball_itv/=</span><span class="id"> inE/=</span><span class="id"> =&gt;</span><span class="id"> yxr;</span><span class="id"> rewrite</span><span class="id"> patchE/=</span><span class="id"> mem_set//=</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">move:</span><span class="id"> yxr;</span><span class="id"> rewrite</span><span class="id"> !in_itv/=</span><span class="id"> =&gt;</span><span class="id"> /andP[_</span><span class="id"> /ltW/le_trans];</span><span class="id"> apply</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -lerBrDl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> near:</span><span class="id"> r;</span><span class="id"> apply:</span><span class="id"> nbhs_right_ltW;</span><span class="id"> rewrite</span><span class="id"> subr_gt0</span>.<br/>
&nbsp;&nbsp;<span class="id">congr</span><span class="id"> *%E;</span><span class="id"> apply:</span><span class="id"> eq_integral</span><span class="id"> =&gt;</span><span class="id"> y</span><span class="id"> yxr</span><span class="id"> /=</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> foouf//</span><span class="id"> foouf//</span><span class="id"> inE;</span><span class="id"> exact:</span><span class="id"> ballxx</span>.<br/>
<span class="id">Unshelve</span>.<span class="id"> all:</span><span class="gallina-kwd"> by</span><span class="id"> end_near</span>. Qed.</div></details>
<br/>
<span class="vernacular">Section</span><span class="id"> continuous_cvg_davg</span>.<br/>
<span class="vernacular">Context</span><span class="id"> f</span> (<span class="id">x</span><span class="id"> :</span><span class="id"> R</span>) (<span class="id">U</span><span class="id"> :</span><span class="id"> set</span><span class="id"> R</span>).<br/>
<span class="vernacular">Hypotheses</span> (<span class="id">xU</span><span class="id"> :</span><span class="id"> open_nbhs</span><span class="id"> x</span><span class="id"> U</span>) (<span class="id">mU</span><span class="id"> :</span><span class="id"> measurable</span><span class="id"> U</span>) (<span class="id">mUf</span><span class="id"> :</span><span class="id"> measurable_fun</span><span class="id"> U</span><span class="id"> f</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">fx</span><span class="id"> :</span><span class="id"> {for</span><span class="id"> x,</span><span class="id"> continuous</span><span class="id"> f}</span>).<br/>
<br/>
<span class="vernacular">Let</span><span class="id"> continuous_integralB_fin_num</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">\forall</span><span class="id"> t</span><span class="id"> \near</span><span class="id"> 0%R,</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">\int[mu]_</span>(<span class="id">y</span><span class="gallina-kwd"> in</span><span class="id"> ball</span><span class="id"> x</span><span class="id"> t</span>)<span class="id"> `|</span>(<span class="id">f</span><span class="id"> y</span>)<span class="id">%:E</span><span class="id"> -</span> (<span class="id">f</span><span class="id"> x</span>)<span class="id">%:E|</span><span class="id"> \is</span><span class="id"> a</span><span class="id"> fin_num</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move:</span><span class="id"> fx</span><span class="id"> =&gt;</span><span class="id"> /cvgrPdist_le</span><span class="id"> /=</span><span class="id"> fx'</span>.<br/>
<span class="id">near</span> (<span class="id">0%R:R</span>)<span class="id">^'+</span><span class="id"> =&gt;</span><span class="id"> e</span>.<br/>
<span class="id">have</span><span class="id"> e0</span><span class="id"> :</span> (<span class="id">0</span><span class="id"> &lt;</span><span class="id"> e</span>)<span class="id">%R</span><span class="gallina-kwd"> by</span><span class="id"> near:</span><span class="id"> e;</span><span class="id"> exact:</span><span class="id"> nbhs_right_gt</span>.<br/>
<span class="id">have</span><span class="id"> [r</span><span class="id"> /=</span><span class="id"> r0</span><span class="id"> {}fx']</span><span class="id"> :=</span><span class="id"> fx'</span><span class="id"> _</span><span class="id"> e0</span>.<br/>
<span class="id">have</span><span class="id"> [d/=</span><span class="id"> d0</span><span class="id"> dxU]</span><span class="id"> :=</span><span class="id"> open_subball</span><span class="id"> xU</span>.<span class="id">1</span><span class="id"> xU</span>.<span class="id">2</span>.<br/>
<span class="id">near=&gt;</span><span class="id"> t;</span><span class="id"> rewrite</span><span class="id"> ge0_fin_numE</span><span class="id"> ?integral_ge0//</span>.<br/>
<span class="id">have</span><span class="id"> [t0|t0]</span><span class="id"> :=</span><span class="id"> leP</span><span class="id"> t</span><span class="id"> 0%R;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span> ((<span class="id">ball0</span><span class="id"> _</span><span class="id"> _</span>).<span class="id">2</span><span class="id"> t0</span>)<span class="id"> integral_set0</span>.<br/>
<span class="id">have</span><span class="id"> xtU</span><span class="id"> :</span><span class="id"> ball</span><span class="id"> x</span><span class="id"> t</span><span class="id"> `&lt;=`</span><span class="id"> U</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> dxU</span><span class="id"> =&gt;</span><span class="id"> //=</span>.<br/>
<span class="id">rewrite</span> (<span class="id">@le_lt_trans</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">\int[mu]_</span>(<span class="id">y</span><span class="gallina-kwd"> in</span><span class="id"> ball</span><span class="id"> x</span><span class="id"> t</span>)<span class="id"> e%:E</span>))<span class="id">//;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> integral_cst//=;</span><span class="id"> last</span><span class="id"> exact:</span><span class="id"> measurable_ball</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span> (<span class="id">lebesgue_measure_ball</span><span class="id"> _</span> (<span class="id">ltW</span><span class="id"> t0</span>))<span class="id"> ltry</span>.<br/>
<span class="id">apply:</span><span class="id"> ge0_le_integral</span><span class="id"> =&gt;</span><span class="id"> //=;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> measurable_ball</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> do</span><span class="id"> 2</span><span class="id"> apply:</span><span class="id"> measurableT_comp</span><span class="id"> =&gt;</span><span class="id"> //=;</span><span class="id"> apply:</span><span class="id"> measurable_funB;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">[exact:</span><span class="id"> measurable_funS</span><span class="id"> mUf|exact:</span><span class="id"> measurable_cst]</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> y</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> lee_fin</span>.<br/>
<span class="id">-</span><span class="id"> move=&gt;</span><span class="id"> y</span><span class="id"> xry;</span><span class="id"> rewrite</span><span class="id"> lee_fin</span><span class="id"> distrC</span><span class="id"> fx'//=;</span><span class="id"> apply:</span> (<span class="id">lt_le_trans</span><span class="id"> xry</span>).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> near:</span><span class="id"> t;</span><span class="id"> exact:</span><span class="id"> nbhs0_ltW</span>.<br/>
<span class="id">Unshelve</span>.<span class="id"> all:</span><span class="gallina-kwd"> by</span><span class="id"> end_near</span>. Qed.</div></details>
<br/>
<span class="vernacular">Let</span><span class="id"> continuous_davg_fin_num</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">\forall</span><span class="id"> A</span><span class="id"> \near</span><span class="id"> 0%R,</span><span class="id"> davg</span><span class="id"> f</span><span class="id"> x</span><span class="id"> A</span><span class="id"> \is</span><span class="id"> a</span><span class="id"> fin_num</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">have</span><span class="id"> [e</span><span class="id"> /=</span><span class="id"> e0</span><span class="id"> exf]</span><span class="id"> :=</span><span class="id"> continuous_integralB_fin_num</span>.<br/>
<span class="id">move:</span><span class="id"> fx</span><span class="id"> =&gt;</span><span class="id"> /cvgrPdist_le</span><span class="id"> fx'</span>.<br/>
<span class="id">near</span> (<span class="id">0%R:R</span>)<span class="id">^'+</span><span class="id"> =&gt;</span><span class="id"> r</span>.<br/>
<span class="id">have</span><span class="id"> r0</span><span class="id"> :</span> (<span class="id">0</span><span class="id"> &lt;</span><span class="id"> r</span>)<span class="id">%R</span><span class="gallina-kwd"> by</span><span class="id"> near:</span><span class="id"> r;</span><span class="id"> exact:</span><span class="id"> nbhs_right_gt</span>.<br/>
<span class="id">have</span><span class="id"> [d</span><span class="id"> /=</span><span class="id"> d0</span><span class="id"> {}fx']</span><span class="id"> :=</span><span class="id"> fx'</span><span class="id"> _</span><span class="id"> e0</span>.<br/>
<span class="id">near=&gt;</span><span class="id"> t;</span><span class="id"> have</span><span class="id"> [t0|t0]</span><span class="id"> :=</span><span class="id"> leP</span><span class="id"> t</span><span class="id"> 0%R;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> davg0</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> fin_numM//</span><span class="id"> exf/=</span>.<br/>
<span class="id">Unshelve</span>.<span class="id"> all:</span><span class="gallina-kwd"> by</span><span class="id"> end_near</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> continuous_cvg_davg</span><span class="id"> :</span><span class="id"> davg</span><span class="id"> f</span><span class="id"> x</span><span class="id"> r</span><span class="id"> @[r</span><span class="id"> --&gt;</span><span class="id"> 0%R]</span><span class="id"> --&gt;</span><span class="id"> 0</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">apply/fine_cvgP;</span><span class="id"> split;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> continuous_davg_fin_num</span>.<br/>
<span class="id">apply/cvgrPdist_le</span><span class="id"> =&gt;</span><span class="id"> e</span><span class="id"> e0</span>.<br/>
<span class="id">move:</span><span class="id"> fx</span><span class="id"> =&gt;</span><span class="id"> /cvgrPdist_le</span><span class="id"> /=</span><span class="id"> fx'</span>.<br/>
<span class="id">have</span><span class="id"> [r</span><span class="id"> /=</span><span class="id"> r0</span><span class="id"> {}fx']</span><span class="id"> :=</span><span class="id"> fx'</span><span class="id"> _</span><span class="id"> e0</span>.<br/>
<span class="id">have</span><span class="id"> [d</span><span class="id"> /=</span><span class="id"> d0</span><span class="id"> dfx]</span><span class="id"> :=</span><span class="id"> continuous_davg_fin_num</span>.<br/>
<span class="id">have</span><span class="id"> [l/=</span><span class="id"> l0</span><span class="id"> lxU]</span><span class="id"> :=</span><span class="id"> open_subball</span><span class="id"> xU</span>.<span class="id">1</span><span class="id"> xU</span>.<span class="id">2</span>.<br/>
<span class="id">near=&gt;</span><span class="id"> t</span>.<br/>
<span class="id">have</span><span class="id"> [t0|t0]</span><span class="id"> :=</span><span class="id"> leP</span><span class="id"> t</span><span class="id"> 0%R;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> /=</span><span class="id"> davg0//=</span><span class="id"> subrr</span><span class="id"> normr0</span><span class="id"> ltW</span>.<br/>
<span class="id">rewrite</span><span class="id"> sub0r</span><span class="id"> normrN</span><span class="id"> /=</span><span class="id"> ger0_norm;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> fine_ge0//</span><span class="id"> davg_ge0</span>.<br/>
<span class="id">rewrite</span><span class="id"> -lee_fin</span><span class="id"> fineK//;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> dfx//=</span><span class="id"> sub0r</span><span class="id"> normrN</span><span class="id"> gtr0_norm</span>.<br/>
<span class="id">rewrite</span><span class="id"> /davg/=</span><span class="id"> /iavg/=</span><span class="id"> lee_pdivrMl//;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> fine_gt0//</span><span class="id"> lebesgue_measure_ball//</span><span class="id"> ?ltry</span><span class="id"> ?lte_fin</span><span class="id"> ?mulrn_wgt0</span><span class="id"> ?ltW</span>.<br/>
<span class="id">rewrite</span> (<span class="id">@le_trans</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">\int[mu]_</span>(<span class="id">y</span><span class="gallina-kwd"> in</span><span class="id"> ball</span><span class="id"> x</span><span class="id"> t</span>)<span class="id"> e%:E</span>))<span class="id">//</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> ge0_le_integral</span><span class="id"> =&gt;</span><span class="id"> //=</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> exact:</span><span class="id"> measurable_ball</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> do</span><span class="id"> 2</span><span class="id"> apply:</span><span class="id"> measurableT_comp</span><span class="id"> =&gt;</span><span class="id"> //=;</span><span class="id"> apply:</span><span class="id"> measurable_funB</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> measurable_funS</span><span class="id"> mUf</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> apply:</span><span class="id"> lxU</span><span class="id"> =&gt;</span><span class="id"> //=</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> y</span><span class="id"> xty;</span><span class="id"> rewrite</span><span class="id"> lee_fin</span><span class="id"> ltW</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> move=&gt;</span><span class="id"> y</span><span class="id"> xty;</span><span class="id"> rewrite</span><span class="id"> lee_fin</span><span class="id"> distrC</span><span class="id"> fx'//;</span><span class="id"> apply:</span> (<span class="id">lt_le_trans</span><span class="id"> xty</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> near:</span><span class="id"> t;</span><span class="id"> exact:</span><span class="id"> nbhs0_ltW</span>.<br/>
<span class="id">rewrite</span><span class="id"> integral_cst//=;</span><span class="id"> last</span><span class="id"> exact:</span><span class="id"> measurable_ball</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> muleC</span><span class="id"> fineK//</span> (<span class="id">lebesgue_measure_ball</span><span class="id"> _</span> (<span class="id">ltW</span><span class="id"> t0</span>)).<br/>
<span class="id">Unshelve</span>.<span class="id"> all:</span><span class="gallina-kwd"> by</span><span class="id"> end_near</span>. Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> continuous_cvg_davg</span>.<br/>
<br/>
<span class="vernacular">End</span><span class="id"> davg</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> lim_sup_davg</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {R</span><span class="id"> :</span><span class="id"> realType}</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<span class="vernacular">Implicit</span><span class="id"> Types</span><span class="id"> f</span><span class="id"> g</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> R</span>.<br/>
<br/>
<span class="vernacular">Definition</span><span class="id"> lim_sup_davg</span><span class="id"> f</span><span class="id"> x</span><span class="id"> :=</span><span class="id"> lime_sup</span> (<span class="id">davg</span><span class="id"> f</span><span class="id"> x</span>)<span class="id"> 0</span>.<br/>
<br/>
<span class="vernacular">Local</span><span class="vernacular"> Notation</span> <span class="id">&quot;f ^*&quot;</span><span class="id"> :=</span> (<span class="id">lim_sup_davg</span><span class="id"> f</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> lim_sup_davg_ge0</span><span class="id"> f</span><span class="id"> x</span><span class="id"> :</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> f^*</span><span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> limf_esup_ge0</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> =&gt;</span><span class="id"> y;</span><span class="id"> exact:</span><span class="id"> iavg_ge0</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> lim_sup_davg_le</span><span class="id"> f</span><span class="id"> g</span><span class="id"> x</span> (<span class="id">U</span><span class="id"> :</span><span class="id"> set</span><span class="id"> R</span>)<span class="id"> :</span><span class="id"> open_nbhs</span><span class="id"> x</span><span class="id"> U</span><span class="id"> -&gt;</span><span class="id"> measurable</span><span class="id"> U</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">measurable_fun</span><span class="id"> U</span><span class="id"> f</span><span class="id"> -&gt;</span><span class="id"> measurable_fun</span><span class="id"> U</span><span class="id"> g</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;(<span class="id">f</span><span class="id"> \+</span><span class="id"> g</span>)<span class="id">%R^*</span><span class="id"> x</span><span class="id"> &lt;=</span> (<span class="id">f^*</span><span class="id"> \+</span><span class="id"> g^*</span>)<span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> xU</span><span class="id"> mY</span><span class="id"> mf</span><span class="id"> /=</span><span class="id"> mg;</span><span class="id"> apply:</span><span class="id"> le_trans</span> (<span class="id">lime_supD</span><span class="id"> _</span>)<span class="id">;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> ge0_adde_def//</span><span class="id"> inE;</span><span class="id"> exact:</span><span class="id"> lim_sup_davg_ge0</span>.<br/>
<span class="id">have</span><span class="id"> [e/=</span><span class="id"> e0</span><span class="id"> exU]</span><span class="id"> :=</span><span class="id"> open_subball</span><span class="id"> xU</span>.<span class="id">1</span><span class="id"> xU</span>.<span class="id">2</span>.<br/>
<span class="id">apply:</span><span class="id"> lime_sup_le;</span><span class="id"> near=&gt;</span><span class="id"> r</span><span class="id"> =&gt;</span><span class="id"> y;</span><span class="id"> rewrite</span><span class="id"> neq_lt</span><span class="id"> =&gt;</span><span class="id"> /orP[y0|y0</span><span class="id"> ry]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> !davg0</span><span class="id"> ?adde0//</span><span class="id"> ltW</span>.<br/>
<span class="id">apply:</span><span class="id"> davgD</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> measurable_funS</span><span class="id"> mf</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> apply:</span><span class="id"> exU</span><span class="id"> =&gt;</span><span class="id"> //=</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span> (<span class="id">lt_le_trans</span><span class="id"> ry</span>)<span class="id">//;</span><span class="id"> near:</span><span class="id"> r;</span><span class="id"> exact:</span><span class="id"> nbhs_right_le</span>.<br/>
<span class="id">apply:</span><span class="id"> measurable_funS</span><span class="id"> mg</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> apply:</span><span class="id"> exU</span><span class="id"> =&gt;</span><span class="id"> //=</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span> (<span class="id">lt_le_trans</span><span class="id"> ry</span>)<span class="id">//;</span><span class="id"> near:</span><span class="id"> r;</span><span class="id"> exact:</span><span class="id"> nbhs_right_le</span>.<br/>
<span class="id">Unshelve</span>.<span class="id"> all:</span><span class="gallina-kwd"> by</span><span class="id"> end_near</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> continuous_lim_sup_davg</span><span class="id"> f</span><span class="id"> x</span> (<span class="id">U</span><span class="id"> :</span><span class="id"> set</span><span class="id"> R</span>)<span class="id"> :</span><span class="id"> open_nbhs</span><span class="id"> x</span><span class="id"> U</span><span class="id"> -&gt;</span><span class="id"> measurable</span><span class="id"> U</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">measurable_fun</span><span class="id"> U</span><span class="id"> f</span><span class="id"> -&gt;</span><span class="id"> {for</span><span class="id"> x,</span><span class="id"> continuous</span><span class="id"> f}</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">f^*</span><span class="id"> x</span><span class="id"> =</span><span class="id"> 0</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> xU</span><span class="id"> mU</span><span class="id"> mUf</span><span class="id"> ctsf</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> have</span><span class="id"> /lim_lime_sup</span><span class="id"> :=</span><span class="id"> continuous_cvg_davg</span><span class="id"> xU</span><span class="id"> mU</span><span class="id"> mUf</span><span class="id"> ctsf</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> lim_sup_davgB</span><span class="id"> f</span><span class="id"> g</span><span class="id"> x</span> (<span class="id">U</span><span class="id"> :</span><span class="id"> set</span><span class="id"> R</span>)<span class="id"> :</span><span class="id"> open_nbhs</span><span class="id"> x</span><span class="id"> U</span><span class="id"> -&gt;</span><span class="id"> measurable</span><span class="id"> U</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">measurable_fun</span><span class="id"> U</span><span class="id"> f</span><span class="id"> -&gt;</span><span class="id"> {for</span><span class="id"> x,</span><span class="id"> continuous</span><span class="id"> g}</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">locally_integrable</span><span class="id"> [set:</span><span class="id"> R]</span><span class="id"> g</span><span class="id"> -&gt;</span> (<span class="id">f</span><span class="id"> \-</span><span class="id"> g</span>)<span class="id">%R^*</span><span class="id"> x</span><span class="id"> =</span><span class="id"> f^*</span><span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> xU</span><span class="id"> mU</span><span class="id"> mUf</span><span class="id"> cg</span><span class="id"> locg;</span><span class="id"> apply/eqP;</span><span class="id"> rewrite</span><span class="id"> eq_le;</span><span class="id"> apply/andP;</span><span class="id"> split</span>.<br/>
<span class="id">-</span><span class="id"> rewrite</span><span class="id"> [leRHS]</span>(_<span class="id"> :</span><span class="id"> _</span><span class="id"> =</span><span class="id"> f^*</span><span class="id"> x</span><span class="id"> +</span> (<span class="id">\-</span><span class="id"> g</span>)<span class="id">%R^*</span><span class="id"> x</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span> (<span class="id">lim_sup_davg_le</span><span class="id"> xU</span>)<span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply/</span>(<span class="id">measurable_comp</span><span class="id"> measurableT</span>)<span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> case:</span><span class="id"> locg</span><span class="id"> =&gt;</span><span class="id"> +</span><span class="id"> _</span><span class="id"> _;</span><span class="id"> exact:</span><span class="id"> measurable_funS</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> (<span class="id">@continuous_lim_sup_davg</span> (<span class="id">-</span><span class="id"> g</span>)<span class="id">%R</span><span class="id"> _</span><span class="id"> _</span><span class="id"> xU</span><span class="id"> mU</span>)<span class="id">;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> adde0</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> apply/</span>(<span class="id">measurable_comp</span><span class="id"> measurableT</span>)<span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> case:</span><span class="id"> locg</span><span class="id"> =&gt;</span><span class="id"> +</span><span class="id"> _</span><span class="id"> _;</span><span class="id"> apply:</span><span class="id"> measurable_funS</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> y;</span><span class="id"> exact/continuousN/cg</span>.<br/>
<span class="id">-</span><span class="id"> rewrite</span><span class="id"> [leRHS]</span>(_<span class="id"> :</span><span class="id"> _</span><span class="id"> =</span> ((<span class="id">f</span><span class="id"> \-</span><span class="id"> g</span>)<span class="id">%R^*</span><span class="id"> \+</span><span class="id"> g^*</span>)<span class="id"> x</span>)<span class="id">//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> {1}</span>(_<span class="id"> :</span><span class="id"> f</span><span class="id"> =</span><span class="id"> f</span><span class="id"> \-</span><span class="id"> g</span><span class="id"> +</span><span class="id"> g</span>)<span class="id">%R;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> apply/funext</span><span class="id"> =&gt;</span><span class="id"> y;</span><span class="id"> rewrite</span><span class="id"> subrK</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span> (<span class="id">lim_sup_davg_le</span><span class="id"> xU</span><span class="id"> mU</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> measurable_funB;</span><span class="id"> [exact:</span><span class="id"> mUf|]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> case:</span><span class="id"> locg</span><span class="id"> =&gt;</span><span class="id"> +</span><span class="id"> _</span><span class="id"> _;</span><span class="id"> exact:</span><span class="id"> measurable_funS</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> case:</span><span class="id"> locg</span><span class="id"> =&gt;</span><span class="id"> +</span><span class="id"> _</span><span class="id"> _;</span><span class="id"> exact:</span><span class="id"> measurable_funS</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> [X</span><span class="gallina-kwd"> in</span><span class="id"> _</span><span class="id"> +</span><span class="id"> X]</span>(<span class="id">@continuous_lim_sup_davg</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> xU</span><span class="id"> mU</span>)<span class="id">;</span><span class="id"> [by</span><span class="id"> rewrite</span><span class="id"> adde0|</span><span class="id"> |by[]]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> case:</span><span class="id"> locg</span><span class="id"> =&gt;</span><span class="id"> +</span><span class="id"> _</span><span class="id"> _;</span><span class="id"> exact:</span><span class="id"> measurable_funS</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Local</span><span class="vernacular"> Notation</span><span class="id"> mu</span><span class="id"> :=</span> (<span class="id">@lebesgue_measure</span><span class="id"> R</span>).<br/>
<br/>
<span class="vernacular">Let</span><span class="id"> is_cvg_ereal_sup_davg</span><span class="id"> f</span><span class="id"> x</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">cvg</span> (<span class="id">ereal_sup</span><span class="id"> [set</span><span class="id"> davg</span><span class="id"> f</span><span class="id"> x</span><span class="id"> y</span><span class="id"> |</span><span class="id"> y</span><span class="gallina-kwd"> in</span><span class="id"> ball</span><span class="id"> 0%R</span><span class="id"> e</span><span class="id"> `\</span><span class="id"> 0%R]</span><span class="id"> @[e</span><span class="id"> --&gt;</span><span class="id"> 0^'+]</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">apply:</span><span class="id"> nondecreasing_at_right_is_cvge;</span><span class="id"> near=&gt;</span><span class="id"> e</span><span class="id"> =&gt;</span><span class="id"> y</span><span class="id"> z</span>.<br/>
<span class="id">rewrite</span><span class="id"> !in_itv/=</span><span class="id"> =&gt;</span><span class="id"> /andP[y0</span><span class="id"> ye]</span><span class="id"> /andP[z0</span><span class="id"> ze]</span><span class="id"> yz</span>.<br/>
<span class="id">apply:</span><span class="id"> le_ereal_sup</span><span class="id"> =&gt;</span><span class="id"> _</span><span class="id"> /=</span><span class="id"> -[b</span><span class="id"> [yb</span><span class="id"> b0]]</span><span class="id"> &lt;-</span>.<br/>
<span class="gallina-kwd">by</span><span class="gallina-kwd"> exists</span><span class="id"> b</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> le_ball</span><span class="id"> yb</span>.<br/>
<span class="id">Unshelve</span>.<span class="id"> all:</span><span class="gallina-kwd"> by</span><span class="id"> end_near</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> lim_sup_davgT_HL_maximal</span><span class="id"> f</span> (<span class="id">x</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span><span class="id"> locally_integrable</span><span class="id"> setT</span><span class="id"> f</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">f^*</span><span class="id"> x</span><span class="id"> &lt;=</span><span class="id"> HL_maximal</span><span class="id"> f</span><span class="id"> x</span><span class="id"> +</span><span class="id"> `|f</span><span class="id"> x|%:E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> [mf</span><span class="id"> _</span><span class="id"> locf];</span><span class="id"> rewrite</span><span class="id"> /lim_sup_davg</span><span class="id"> lime_sup_lim;</span><span class="id"> apply:</span><span class="id"> lime_le</span>.<br/>
&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> is_cvg_ereal_sup_davg</span>.<br/>
<span class="id">near=&gt;</span><span class="id"> e</span>.<br/>
<span class="id">apply:</span><span class="id"> ub_ereal_sup</span><span class="id"> =&gt;</span><span class="id"> _</span><span class="id"> [b</span><span class="id"> [eb]</span><span class="id"> /=</span><span class="id"> b0]</span><span class="id"> &lt;-</span>.<br/>
<span class="id">suff</span><span class="id"> :</span><span class="gallina-kwd"> forall</span><span class="id"> r,</span><span class="id"> davg</span><span class="id"> f</span><span class="id"> x</span><span class="id"> r</span><span class="id"> &lt;=</span><span class="id"> HL_maximal</span><span class="id"> f</span><span class="id"> x</span><span class="id"> +</span><span class="id"> `|f</span><span class="id"> x|%:E</span><span class="gallina-kwd"> by</span><span class="id"> exact</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> r</span>.<br/>
<span class="id">apply:</span> (<span class="id">@le_trans</span><span class="id"> _</span><span class="id"> _</span> ((<span class="id">fine</span> (<span class="id">mu</span> (<span class="id">ball</span><span class="id"> x</span><span class="id"> r</span>)))<span class="id">^-1%:E</span><span class="id"> *</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">\int[mu]_</span>(<span class="id">y</span><span class="gallina-kwd"> in</span><span class="id"> ball</span><span class="id"> x</span><span class="id"> r</span>) (<span class="id">`|</span> (<span class="id">f</span><span class="id"> y</span>)<span class="id">%:E</span><span class="id"> |</span><span class="id"> +</span><span class="id"> `|</span>(<span class="id">f</span><span class="id"> x</span>)<span class="id">%:E|</span>))).<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> rewrite</span><span class="id"> /davg</span><span class="id"> lee_wpmul2l//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> lee_fin</span><span class="id"> invr_ge0</span><span class="id"> fine_ge0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> ge0_le_integral</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">+</span><span class="id"> exact:</span><span class="id"> measurable_ball</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">+</span><span class="id"> do</span><span class="id"> 2</span><span class="id"> apply:</span><span class="id"> measurableT_comp</span><span class="id"> =&gt;</span><span class="id"> //=;</span><span class="id"> apply:</span><span class="id"> measurable_funB</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> measurableT_comp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> *;</span><span class="id"> rewrite</span><span class="id"> adde_ge0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">+</span><span class="id"> apply:</span><span class="id"> emeasurable_funD</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> do</span><span class="id"> 2</span><span class="id"> apply:</span><span class="id"> measurableT_comp</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> measurable_funS</span><span class="id"> mf</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> /=</span><span class="id"> y</span><span class="id"> xry;</span><span class="id"> rewrite</span><span class="id"> -EFinD</span><span class="id"> lee_fin//</span><span class="id"> ler_normB</span>.<br/>
<span class="id">rewrite</span><span class="id"> [leLHS]</span>(_<span class="id"> :</span><span class="id"> _</span><span class="id"> =</span> (<span class="id">fine</span> (<span class="id">mu</span> (<span class="id">ball</span><span class="id"> x</span><span class="id"> r</span>)))<span class="id">^-1%:E</span><span class="id"> *</span><br/>
&nbsp;&nbsp;(<span class="id">\int[mu]_</span>(<span class="id">y</span><span class="gallina-kwd"> in</span><span class="id"> ball</span><span class="id"> x</span><span class="id"> r</span>)<span class="id"> `|</span>(<span class="id">f</span><span class="id"> y</span>)<span class="id">%:E|</span><span class="id"> +</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id">\int[mu]_</span>(<span class="id">y</span><span class="gallina-kwd"> in</span><span class="id"> ball</span><span class="id"> x</span><span class="id"> r</span>)<span class="id"> `|</span>(<span class="id">f</span><span class="id"> x</span>)<span class="id">%:E|</span>))<span class="id">;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">congr</span><span class="id"> *%E;</span><span class="id"> rewrite</span><span class="id"> ge0_integralD//=;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> measurable_ball</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> do</span><span class="id"> 2</span><span class="id"> apply:</span><span class="id"> measurableT_comp</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> measurable_funS</span><span class="id"> mf</span>.<br/>
<span class="id">have</span><span class="id"> [r0|r0]</span><span class="id"> :=</span><span class="id"> lerP</span><span class="id"> r</span><span class="id"> 0</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> (<span class="id">ball0</span><span class="id"> _</span><span class="id"> _</span>).<span class="id">2//</span><span class="id"> !integral_set0</span><span class="id"> adde0</span><span class="id"> mule0</span><span class="id"> adde_ge0//</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> HL_maximalT_ge0;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> openT</span>.<br/>
<span class="id">rewrite</span><span class="id"> muleDr//;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> ge0_adde_def//</span><span class="id"> inE</span><span class="id"> integral_ge0</span>.<br/>
<span class="id">rewrite</span><span class="id"> leeD//</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> ereal_sup_ubound</span><span class="id"> =&gt;</span><span class="id"> /=;</span><span class="gallina-kwd"> exists</span><span class="id"> r</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> rewrite</span><span class="id"> in_itv/=</span><span class="id"> r0</span>.<br/>
<span class="id">under</span><span class="id"> eq_integral</span><span class="id"> do</span><span class="id"> rewrite</span><span class="id"> -</span>(<span class="id">mule1</span><span class="id"> `|</span><span class="id"> _</span><span class="id"> |</span>).<br/>
<span class="id">rewrite</span><span class="id"> ge0_integralZl//;</span><span class="id"> last</span><span class="id"> exact:</span><span class="id"> measurable_ball</span>.<br/>
<span class="id">rewrite</span><span class="id"> integral_cst//;</span><span class="id"> last</span><span class="id"> exact:</span><span class="id"> measurable_ball</span>.<br/>
<span class="id">rewrite</span><span class="id"> mul1e</span><span class="id"> muleCA</span><span class="id"> !</span>(<span class="id">lebesgue_measure_ball</span><span class="id"> _</span> (<span class="id">ltW</span><span class="id"> r0</span>)).<br/>
<span class="id">rewrite</span><span class="id"> [X</span><span class="gallina-kwd"> in</span><span class="id"> _</span><span class="id"> *</span> (_<span class="id"> *</span><span class="id"> X</span>)<span class="id">]</span>(_<span class="id"> :</span><span class="id"> _</span><span class="id"> =</span><span class="id"> mu</span> (<span class="id">ball</span><span class="id"> x</span><span class="id"> r</span>))<span class="id">//</span>.<br/>
<span class="id">rewrite</span> (<span class="id">lebesgue_measure_ball</span><span class="id"> _</span> (<span class="id">ltW</span><span class="id"> r0</span>))<span class="id">//</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /=</span><span class="id"> -EFinM</span><span class="id"> mulVr</span><span class="id"> ?mulr1//</span><span class="id"> unitfE</span><span class="id"> mulrn_eq0/=</span><span class="id"> gt_eqF</span>.<br/>
<span class="id">Unshelve</span>.<span class="id"> all:</span><span class="gallina-kwd"> by</span><span class="id"> end_near</span>. Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> lim_sup_davg</span>.<br/>
<br/>
<span class="vernacular">Definition</span><span class="id"> lebesgue_pt</span><span class="id"> {R</span><span class="id"> :</span><span class="id"> realType}</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> R</span>) (<span class="id">x</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">davg</span><span class="id"> f</span><span class="id"> x</span><span class="id"> r</span><span class="id"> @[r</span><span class="id"> --&gt;</span> (<span class="id">0%R:R</span>)<span class="id">^'+]</span><span class="id"> --&gt;</span><span class="id"> 0%E</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> continuous_lebesgue_pt</span><span class="id"> {R</span><span class="id"> :</span><span class="id"> realType}</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> R</span>)<span class="id"> x</span> (<span class="id">U</span><span class="id"> :</span><span class="id"> set</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">open_nbhs</span><span class="id"> x</span><span class="id"> U</span><span class="id"> -&gt;</span><span class="id"> measurable</span><span class="id"> U</span><span class="id"> -&gt;</span><span class="id"> measurable_fun</span><span class="id"> U</span><span class="id"> f</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">{for</span><span class="id"> x,</span><span class="id"> continuous</span><span class="id"> f}</span><span class="id"> -&gt;</span><span class="id"> lebesgue_pt</span><span class="id"> f</span><span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> xU</span><span class="id"> mU</span><span class="id"> mUf</span><span class="id"> xf;</span><span class="id"> rewrite</span><span class="id"> /lebesgue_pt</span><span class="id"> -[X</span><span class="gallina-kwd"> in</span><span class="id"> _</span><span class="id"> --&gt;</span><span class="id"> X]</span>(<span class="id">@davg0</span><span class="id"> _</span><span class="id"> f</span><span class="id"> x</span><span class="id"> 0</span>)<span class="id">//</span>.<br/>
<span class="id">apply:</span><span class="id"> cvg_at_right_filter;</span><span class="id"> rewrite</span><span class="id"> davg0//</span>.<br/>
<span class="id">exact:</span> (<span class="id">continuous_cvg_davg</span><span class="id"> xU</span><span class="id"> mU</span><span class="id"> mUf</span>).<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> lebesgue_pt_restrict</span><span class="id"> {R</span><span class="id"> :</span><span class="id"> realType}</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> R</span>) (<span class="id">a</span><span class="id"> :</span><span class="id"> itv_bound</span><span class="id"> R</span>)<span class="id"> x</span><span class="id"> u</span><span class="id"> :</span><br/>
&nbsp;&nbsp;(<span class="id">x</span><span class="id"> &lt;</span><span class="id"> u</span>)<span class="id">%R</span><span class="id"> -&gt;</span> (<span class="id">a</span><span class="id"> &lt;</span><span class="id"> BRight</span><span class="id"> x</span>)<span class="id">%E</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">lebesgue_pt</span><span class="id"> f</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> lebesgue_pt</span> (<span class="id">f</span><span class="id"> \_</span><span class="id"> [set`</span><span class="id"> Interval</span><span class="id"> a</span> (<span class="id">BRight</span><span class="id"> u</span>)<span class="id">]</span>)<span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> xu</span><span class="id"> ax;</span><span class="id"> apply:</span><span class="id"> cvg_trans;</span><span class="id"> apply:</span><span class="id"> near_eq_cvg;</span><span class="id"> exact:</span><span class="id"> near_davg</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Section</span><span class="id"> lebesgue_measure_integral</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {R</span><span class="id"> :</span><span class="id"> realType}</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Notation</span><span class="id"> mu</span><span class="id"> :=</span> (<span class="id">@lebesgue_measure</span><span class="id"> R</span>).<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> integral_Sset1</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id"> A</span> (<span class="id">r</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span><span class="id"> A</span><span class="id"> `&lt;=`</span><span class="id"> [set</span><span class="id"> r]</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;(<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> A</span>)<span class="id"> f</span><span class="id"> x</span><span class="id"> =</span><span class="id"> 0</span>)<span class="id">%E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> Ar;</span><span class="id"> have</span><span class="id"> [-&gt;|-&gt;]</span><span class="id"> :=</span><span class="id"> subset_set1</span><span class="id"> Ar;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> integral_set0</span>.<br/>
<span class="id">rewrite</span> (<span class="id">eq_integral</span> (<span class="id">cst</span> (<span class="id">f</span><span class="id"> r</span>)))<span class="id">/=;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> x;</span><span class="id"> rewrite</span><span class="id"> inE/=</span><span class="id"> =&gt;</span><span class="id"> -&gt;</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> integral_cst//=</span><span class="id"> lebesgue_measure_set1</span><span class="id"> mule0</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> integral_set1</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>) (<span class="id">r</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> [set</span><span class="id"> r]</span>)<span class="id"> f</span><span class="id"> x</span><span class="id"> =</span><span class="id"> 0</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id"> exact:</span> (<span class="id">integral_Sset1</span><span class="id"> _</span> (<span class="id">@subset_refl</span><span class="id"> _</span><span class="id"> _</span>)). Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> ge0_integral_closed_ball</span><span class="id"> c</span> (<span class="id">r</span><span class="id"> :</span><span class="id"> R</span>) (<span class="id">r0</span><span class="id"> :</span> (<span class="id">0</span><span class="id"> &lt;</span><span class="id"> r</span>)<span class="id">%R</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">measurable_fun</span> (<span class="id">closed_ball</span><span class="id"> c</span><span class="id"> r</span><span class="id"> :</span><span class="id"> set</span><span class="id"> R</span>)<span class="id"> f</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">forall</span><span class="id"> x,</span><span class="id"> x</span><span class="id"> \in</span><span class="id"> closed_ball</span><span class="id"> c</span><span class="id"> r</span><span class="id"> -&gt;</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> f</span><span class="id"> x</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> closed_ball</span><span class="id"> c</span><span class="id"> r</span>)<span class="id"> f</span><span class="id"> x</span><span class="id"> =</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> ball</span><span class="id"> c</span><span class="id"> r</span>)<span class="id"> f</span><span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> mf</span><span class="id"> f0</span>.<br/>
<span class="id">rewrite</span><span class="id"> closed_ball_ball//=</span><span class="id"> ge0_integral_setU//=;</span><span class="id"> last</span><span class="id"> 4</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> measurableU</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> measurable_ball</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move:</span><span class="id"> mf;</span><span class="id"> rewrite</span><span class="id"> closed_ball_ball</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> xcr;</span><span class="id"> rewrite</span><span class="id"> f0//</span><span class="id"> closed_ball_ball//</span><span class="id"> inE</span>.<br/>
&nbsp;&nbsp;<span class="id">apply/disj_setPLR</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> [-&gt;|]/=;</span><span class="id"> rewrite</span><span class="id"> /ball/=</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply/eqP;</span><span class="id"> rewrite</span> (<span class="id">addrC</span><span class="id"> _</span><span class="id"> r</span>)<span class="id"> -subr_eq</span><span class="id"> -addrA</span><span class="id"> addrC</span><span class="id"> subrK</span><span class="id"> eqNr</span><span class="id"> gt_eqF</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> /[swap]</span><span class="id"> -&gt;;</span><span class="id"> rewrite</span><span class="id"> opprD</span><span class="id"> addrA</span><span class="id"> subrr</span><span class="id"> sub0r</span><span class="id"> normrN</span><span class="id"> gtr0_norm//</span><span class="id"> ltxx</span>.<br/>
<span class="id">rewrite</span><span class="id"> ge0_integral_setU//=</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> !integral_set1//=</span><span class="id"> add0e</span><span class="id"> adde0</span>.<br/>
<span class="id">-</span><span class="id"> exact:</span><span class="id"> measurable_ball</span>.<br/>
<span class="id">-</span><span class="id"> apply:</span><span class="id"> measurable_funS</span><span class="id"> mf;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> measurable_closed_ball</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> x;</span><span class="id"> rewrite</span><span class="id"> closed_ball_ball//;</span><span class="id"> left</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> H;</span><span class="id"> rewrite</span><span class="id"> f0//</span><span class="id"> closed_ball_ball//</span><span class="id"> inE/=;</span><span class="id"> left</span>.<br/>
<span class="id">-</span><span class="id"> apply/disj_setPRL</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> /[swap]</span><span class="id"> -&gt;</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /ball/=</span><span class="id"> opprB</span><span class="id"> addrCA</span><span class="id"> subrr</span><span class="id"> addr0</span><span class="id"> gtr0_norm//</span><span class="id"> ltxx</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> integral_setD1_EFin</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> R</span>)<span class="id"> r</span> (<span class="id">D</span><span class="id"> :</span><span class="id"> set</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">measurable</span> (<span class="id">D</span><span class="id"> `\</span><span class="id"> r</span>)<span class="id"> -&gt;</span><span class="id"> measurable_fun</span> (<span class="id">D</span><span class="id"> `\</span><span class="id"> r</span>)<span class="id"> f</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span><span class="id"> `\</span><span class="id"> r</span>) (<span class="id">f</span><span class="id"> x</span>)<span class="id">%:E</span><span class="id"> =</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> D</span>) (<span class="id">f</span><span class="id"> x</span>)<span class="id">%:E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> mD</span><span class="id"> mfl;</span><span class="id"> have</span><span class="id"> [Dr|NDr]</span><span class="id"> :=</span><span class="id"> pselect</span> (<span class="id">D</span><span class="id"> r</span>)<span class="id">;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> not_setD1</span>.<br/>
<span class="id">rewrite</span><span class="id"> -[in</span><span class="id"> RHS]</span>(<span class="id">@setD1K</span><span class="id"> _</span><span class="id"> r</span><span class="id"> D</span>)<span class="id">//</span><span class="id"> integral_setU_EFin//=</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> integral_set1//</span><span class="id"> add0e</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> apply/measurable_funU</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> measurable_fun_set1</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> disj_set2E</span><span class="id"> setDIK</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> integral_itv_bndo_bndc</span> (<span class="id">a</span><span class="id"> :</span><span class="id"> itv_bound</span><span class="id"> R</span>) (<span class="id">r</span><span class="id"> :</span><span class="id"> R</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">measurable_fun</span><span class="id"> [set`</span><span class="id"> Interval</span><span class="id"> a</span> (<span class="id">BLeft</span><span class="id"> r</span>)<span class="id">]</span><span class="id"> f</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> [set`</span><span class="id"> Interval</span><span class="id"> a</span> (<span class="id">BLeft</span><span class="id"> r</span>)<span class="id">]</span>) (<span class="id">f</span><span class="id"> x</span>)<span class="id">%:E</span><span class="id"> =</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> [set`</span><span class="id"> Interval</span><span class="id"> a</span> (<span class="id">BRight</span><span class="id"> r</span>)<span class="id">]</span>) (<span class="id">f</span><span class="id"> x</span>)<span class="id">%:E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> mf;</span><span class="id"> have</span><span class="id"> [ar|ar]</span><span class="id"> :=</span><span class="id"> leP</span><span class="id"> a</span> (<span class="id">BLeft</span><span class="id"> r</span>).<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> -[RHS]</span>(<span class="id">@integral_setD1_EFin</span><span class="id"> _</span><span class="id"> r</span>)<span class="id"> ?setDitv1r</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> !set_itv_ge//</span><span class="id"> -leNgt//</span><span class="id"> ltW</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> integral_itv_obnd_cbnd</span> (<span class="id">r</span><span class="id"> :</span><span class="id"> R</span>) (<span class="id">b</span><span class="id"> :</span><span class="id"> itv_bound</span><span class="id"> R</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">measurable_fun</span><span class="id"> [set`</span><span class="id"> Interval</span> (<span class="id">BRight</span><span class="id"> r</span>)<span class="id"> b]</span><span class="id"> f</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> [set`</span><span class="id"> Interval</span> (<span class="id">BRight</span><span class="id"> r</span>)<span class="id"> b]</span>) (<span class="id">f</span><span class="id"> x</span>)<span class="id">%:E</span><span class="id"> =</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> [set`</span><span class="id"> Interval</span> (<span class="id">BLeft</span><span class="id"> r</span>)<span class="id"> b]</span>) (<span class="id">f</span><span class="id"> x</span>)<span class="id">%:E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> mf;</span><span class="id"> have</span><span class="id"> [rb|rb]</span><span class="id"> :=</span><span class="id"> leP</span> (<span class="id">BRight</span><span class="id"> r</span>)<span class="id"> b</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> -[RHS]</span>(<span class="id">@integral_setD1_EFin</span><span class="id"> _</span><span class="id"> r</span>)<span class="id"> ?setDitv1l</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> !set_itv_ge//</span><span class="id"> -leNgt</span><span class="id"> -?ltBRight_leBLeft//</span><span class="id"> ltW</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> integral_itv_bndoo</span> (<span class="id">x</span><span class="id"> y</span><span class="id"> :</span><span class="id"> R</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> R</span>) (<span class="id">b0</span><span class="id"> b1</span><span class="id"> :</span><span class="id"> bool</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">measurable_fun</span><span class="id"> `]x,</span><span class="id"> y[</span><span class="id"> f</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">\int[mu]_</span>(<span class="id">z</span><span class="gallina-kwd"> in</span><span class="id"> [set`</span><span class="id"> Interval</span> (<span class="id">BSide</span><span class="id"> b0</span><span class="id"> x</span>) (<span class="id">BSide</span><span class="id"> b1</span><span class="id"> y</span>)<span class="id">]</span>) (<span class="id">f</span><span class="id"> z</span>)<span class="id">%:E</span><span class="id"> =</span><br/>
&nbsp;&nbsp;<span class="id">\int[mu]_</span>(<span class="id">z</span><span class="gallina-kwd"> in</span><span class="id"> `]x,</span><span class="id"> y[</span>) (<span class="id">f</span><span class="id"> z</span>)<span class="id">%:E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">have</span><span class="id"> [xy|yx</span><span class="id"> _|-&gt;</span><span class="id"> _]</span><span class="id"> :=</span><span class="id"> ltgtP</span><span class="id"> x</span><span class="id"> y;</span><span class="id"> last</span><span class="id"> 2</span><span class="id"> first</span>.<br/>
<span class="id">-</span><span class="id"> rewrite</span><span class="id"> !set_itv_ge</span><span class="id"> ?integral_set0//=</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> bnd_simp</span><span class="id"> le_gtF//</span><span class="id"> ltW</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> move:</span><span class="id"> b0</span><span class="id"> b1</span><span class="id"> =&gt;</span><span class="id"> [|]</span><span class="id"> [|];</span><span class="id"> rewrite</span><span class="id"> bnd_simp</span><span class="id"> ?lt_geF//</span><span class="id"> le_gtF//</span><span class="id"> ltW</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move:</span><span class="id"> b0</span><span class="id"> b1</span><span class="id"> =&gt;</span><span class="id"> [|]</span><span class="id"> [|];</span><span class="id"> rewrite</span><span class="id"> !set_itvE</span><span class="id"> ?integral_set0</span><span class="id"> ?integral_set1</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> mf</span>.<br/>
<span class="id">transitivity</span> (<span class="id">\int[mu]_</span>(<span class="id">z</span><span class="gallina-kwd"> in</span><span class="id"> [set`</span><span class="id"> Interval</span> (<span class="id">BSide</span><span class="id"> b0</span><span class="id"> x</span>) (<span class="id">BLeft</span><span class="id"> y</span>)<span class="id">]</span>) (<span class="id">f</span><span class="id"> z</span>)<span class="id">%:E</span>).<br/>
&nbsp;&nbsp;<span class="id">case:</span><span class="id"> b1</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> rewrite</span><span class="id"> -integral_itv_bndo_bndc//</span>.<br/>
&nbsp;&nbsp;<span class="id">case:</span><span class="id"> b0</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> measurable_fun_itv_co</span><span class="id"> mf</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> case:</span><span class="id"> b0</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> rewrite</span><span class="id"> -integral_itv_obnd_cbnd</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> eq_integral_itv_bounded</span> (<span class="id">x</span><span class="id"> y</span><span class="id"> :</span><span class="id"> R</span>) (<span class="id">g</span><span class="id"> f</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> R</span>) (<span class="id">b0</span><span class="id"> b1</span><span class="id"> :</span><span class="id"> bool</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">measurable_fun</span><span class="id"> `]x,</span><span class="id"> y[</span><span class="id"> f</span><span class="id"> -&gt;</span><span class="id"> measurable_fun</span><span class="id"> `]x,</span><span class="id"> y[</span><span class="id"> g</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">{in</span><span class="id"> `]x,</span><span class="id"> y[,</span><span class="id"> f</span><span class="id"> =1</span><span class="id"> g}</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">\int[mu]_</span>(<span class="id">z</span><span class="gallina-kwd"> in</span><span class="id"> [set`</span><span class="id"> Interval</span> (<span class="id">BSide</span><span class="id"> b0</span><span class="id"> x</span>) (<span class="id">BSide</span><span class="id"> b1</span><span class="id"> y</span>)<span class="id">]</span>) (<span class="id">f</span><span class="id"> z</span>)<span class="id">%:E</span><span class="id"> =</span><br/>
&nbsp;&nbsp;<span class="id">\int[mu]_</span>(<span class="id">z</span><span class="gallina-kwd"> in</span><span class="id"> [set`</span><span class="id"> Interval</span> (<span class="id">BSide</span><span class="id"> b0</span><span class="id"> x</span>) (<span class="id">BSide</span><span class="id"> b1</span><span class="id"> y</span>)<span class="id">]</span>) (<span class="id">g</span><span class="id"> z</span>)<span class="id">%:E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> mf</span><span class="id"> mg</span><span class="id"> fg</span>.<br/>
<span class="id">rewrite</span><span class="id"> integral_itv_bndoo//</span> (<span class="id">@integral_itv_bndoo</span><span class="id"> _</span><span class="id"> _</span><span class="id"> g</span>)<span class="id">//</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> eq_integral</span><span class="id"> =&gt;</span><span class="id"> z;</span><span class="id"> rewrite</span><span class="id"> inE/=</span><span class="id"> =&gt;</span><span class="id"> zxy;</span><span class="id"> congr</span><span class="id"> EFin;</span><span class="id"> exact:</span><span class="id"> fg</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> lebesgue_measure_integral</span>.<br/>
<span class="vernacular">Arguments</span><span class="id"> integral_Sset1</span><span class="id"> {R</span><span class="id"> f</span><span class="id"> A}</span><span class="id"> r</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> Rintegral_lebesgue_measure</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {R</span><span class="id"> :</span><span class="id"> realType}</span>.<br/>
<span class="vernacular">Notation</span><span class="id"> mu</span><span class="id"> :=</span> (<span class="id">@lebesgue_measure</span><span class="id"> R</span>).<br/>
<span class="vernacular">Implicit</span><span class="gallina-kwd"> Type</span><span class="id"> f</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> R</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> Rintegral_itv_bndo_bndc</span> (<span class="id">a</span><span class="id"> :</span><span class="id"> itv_bound</span><span class="id"> R</span>) (<span class="id">r</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> f</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">mu</span>.<span class="id">-integrable</span><span class="id"> [set`</span><span class="id"> Interval</span><span class="id"> a</span> (<span class="id">BLeft</span><span class="id"> r</span>)<span class="id">]</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> f</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> [set`</span><span class="id"> Interval</span><span class="id"> a</span> (<span class="id">BLeft</span><span class="id"> r</span>)<span class="id">]</span>) (<span class="id">f</span><span class="id"> x</span>)<span class="id"> =</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> [set`</span><span class="id"> Interval</span><span class="id"> a</span> (<span class="id">BRight</span><span class="id"> r</span>)<span class="id">]</span>) (<span class="id">f</span><span class="id"> x</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> mf;</span><span class="id"> rewrite</span><span class="id"> /Rintegral</span><span class="id"> integral_itv_bndo_bndc//</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply/measurable_EFinP;</span><span class="id"> exact:</span> (<span class="id">measurable_int</span><span class="id"> mu</span>).<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> Rintegral_itv_obnd_cbnd</span> (<span class="id">r</span><span class="id"> :</span><span class="id"> R</span>) (<span class="id">b</span><span class="id"> :</span><span class="id"> itv_bound</span><span class="id"> R</span>)<span class="id"> f</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">mu</span>.<span class="id">-integrable</span><span class="id"> [set`</span><span class="id"> Interval</span> (<span class="id">BRight</span><span class="id"> r</span>)<span class="id"> b]</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> f</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> [set`</span><span class="id"> Interval</span> (<span class="id">BRight</span><span class="id"> r</span>)<span class="id"> b]</span>) (<span class="id">f</span><span class="id"> x</span>)<span class="id"> =</span><br/>
&nbsp;&nbsp;<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> [set`</span><span class="id"> Interval</span> (<span class="id">BLeft</span><span class="id"> r</span>)<span class="id"> b]</span>) (<span class="id">f</span><span class="id"> x</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> mf;</span><span class="id"> rewrite</span><span class="id"> /Rintegral</span><span class="id"> integral_itv_obnd_cbnd//</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply/measurable_EFinP;</span><span class="id"> exact:</span> (<span class="id">measurable_int</span><span class="id"> mu</span>).<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> Rintegral_set1</span><span class="id"> f</span> (<span class="id">r</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> [set</span><span class="id"> r]</span>)<span class="id"> f</span><span class="id"> x</span><span class="id"> =</span><span class="id"> 0</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> /Rintegral</span><span class="id"> integral_set1</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> Rintegral_itvB</span><span class="id"> f</span> (<span class="id">a</span><span class="id"> b</span><span class="id"> :</span><span class="id"> itv_bound</span><span class="id"> R</span>)<span class="id"> x</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">mu</span>.<span class="id">-integrable</span><span class="id"> [set`</span> (<span class="id">Interval</span><span class="id"> a</span><span class="id"> b</span>)<span class="id">]</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> f</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;(<span class="id">a</span><span class="id"> &lt;=</span><span class="id"> BRight</span><span class="id"> x</span>)<span class="id">%O</span><span class="id"> -&gt;</span> (<span class="id">BRight</span><span class="id"> x</span><span class="id"> &lt;=</span><span class="id"> b</span>)<span class="id">%O</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">\int[mu]_</span>(<span class="id">t</span><span class="gallina-kwd"> in</span><span class="id"> [set`</span><span class="id"> Interval</span><span class="id"> a</span><span class="id"> b]</span>)<span class="id"> f</span><span class="id"> t</span><span class="id"> -</span><br/>
&nbsp;&nbsp;<span class="id">\int[mu]_</span>(<span class="id">t</span><span class="gallina-kwd"> in</span><span class="id"> [set`</span><span class="id"> Interval</span><span class="id"> a</span> (<span class="id">BRight</span><span class="id"> x</span>)<span class="id">]</span>)<span class="id"> f</span><span class="id"> t</span><span class="id"> =</span><br/>
&nbsp;&nbsp;<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> [set`</span><span class="id"> Interval</span> (<span class="id">BRight</span><span class="id"> x</span>)<span class="id"> b]</span>)<span class="id"> f</span><span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> itf;</span><span class="id"> rewrite</span><span class="id"> le_eqVlt</span><span class="id"> =&gt;</span><span class="id"> /predU1P[ax|ax</span><span class="id"> xb]</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> ax</span><span class="id"> =&gt;</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> [in</span><span class="id"> X</span><span class="gallina-kwd"> in</span><span class="id"> _</span><span class="id"> -</span><span class="id"> X]set_itv_ge</span><span class="id"> ?bnd_simp//</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> Rintegral_set0</span><span class="id"> subr0</span>.<br/>
<span class="id">rewrite</span> (<span class="id">@itv_bndbnd_setU</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">BLeft</span><span class="id"> x</span>))<span class="id">;</span><span class="id"> last</span><span class="id"> 2</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> case:</span><span class="id"> a</span><span class="id"> ax</span><span class="id"> {itf}</span><span class="id"> =&gt;</span><span class="id"> -[]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span> (<span class="id">le_trans</span><span class="id"> _</span><span class="id"> xb</span>)<span class="id">//</span><span class="id"> bnd_simp</span>.<br/>
<span class="id">rewrite</span><span class="id"> Rintegral_setU_EFin//=</span>.<br/>
<span class="id">-</span><span class="id"> rewrite</span><span class="id"> addrAC</span><span class="id"> Rintegral_itv_bndo_bndc//;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> integrableS</span><span class="id"> itf</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> apply:</span><span class="id"> subset_itvl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span> (<span class="id">le_trans</span><span class="id"> _</span><span class="id"> xb</span>)<span class="id">//</span><span class="id"> bnd_simp</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> subrr</span><span class="id"> add0r</span><span class="id"> Rintegral_itv_obnd_cbnd//</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> integrableS</span><span class="id"> itf</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact/subset_itvr/ltW</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> -itv_bndbnd_setU</span><span class="id"> -?ltBRight_leBLeft//</span><span class="id"> ltW</span>.<br/>
<span class="id">-</span><span class="id"> apply/disj_setPS</span><span class="id"> =&gt;</span><span class="id"> y</span><span class="id"> [/=];</span><span class="id"> rewrite</span><span class="id"> 2!in_itv/=</span><span class="id"> =&gt;</span><span class="id"> /andP[_</span><span class="id"> yx]</span><span class="id"> /andP[]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> leNgt</span><span class="id"> yx</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> Rintegral_lebesgue_measure</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> lebesgue_differentiation</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {R</span><span class="id"> :</span><span class="id"> realType}</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Notation</span><span class="id"> mu</span><span class="id"> :=</span> (<span class="id">@lebesgue_measure</span><span class="id"> R</span>).<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<span class="vernacular">Implicit</span><span class="id"> Types</span><span class="id"> f</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> R</span>.<br/>
<br/>
<span class="vernacular">Local</span><span class="vernacular"> Notation</span> <span class="id">&quot;f ^*&quot;</span><span class="id"> :=</span> (<span class="id">lim_sup_davg</span><span class="id"> f</span>).<br/>
<br/>
<span class="vernacular">Let</span><span class="id"> lebesgue_differentiation_suff</span> (<span class="id">E</span><span class="id"> :</span><span class="id"> set</span><span class="id"> R</span>)<span class="id"> f</span><span class="id"> :</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">forall</span><span class="id"> a,</span> (<span class="id">0</span><span class="id"> &lt;</span><span class="id"> a</span>)<span class="id">%R</span><span class="id"> -&gt;</span><span class="id"> mu</span>.<span class="id">-negligible</span> (<span class="id">E</span><span class="id"> `&amp;`</span><span class="id"> [set</span><span class="id"> x</span><span class="id"> |</span><span class="id"> a%:E</span><span class="id"> &lt;</span><span class="id"> f^*</span><span class="id"> x]</span>))<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">{ae</span><span class="id"> mu,</span><span class="gallina-kwd"> forall</span><span class="id"> x</span><span class="id"> :</span><span class="id"> R,</span><span class="id"> E</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> lebesgue_pt</span><span class="id"> f</span><span class="id"> x}</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> Ef;</span><span class="id"> have</span><span class="id"> {Ef}</span><span class="id"> :</span><span class="id"> mu</span>.<span class="id">-negligible</span> (<span class="id">E</span><span class="id"> `&amp;`</span><span class="id"> [set</span><span class="id"> x</span><span class="id"> |</span><span class="id"> 0</span><span class="id"> &lt;</span><span class="id"> f^*</span><span class="id"> x]</span>).<br/>
&nbsp;&nbsp;<span class="id">suff</span><span class="id"> -&gt;</span><span class="id"> :</span><span class="id"> E</span><span class="id"> `&amp;`</span><span class="id"> [set</span><span class="id"> x</span><span class="id"> |</span><span class="id"> 0</span><span class="id"> &lt;</span><span class="id"> f^*</span><span class="id"> x]</span><span class="id"> =</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">E</span><span class="id"> `&amp;`</span><span class="id"> \bigcup_n</span><span class="id"> [set</span><span class="id"> x</span><span class="id"> |</span><span class="id"> n</span>.<span class="id">+1%:R^-1%:E</span><span class="id"> &lt;</span><span class="id"> f^*</span><span class="id"> x]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> setI_bigcupr;</span> <span class="id"> apply:</span><span class="id"> negligible_bigcup</span><span class="id"> =&gt;</span><span class="id"> k/=</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> Ef;</span><span class="id"> rewrite</span><span class="id"> invr_gt0</span>.<br/>
&nbsp;&nbsp;<span class="id">apply/seteqP;</span><span class="id"> split;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> r</span><span class="id"> [Er]</span><span class="id"> [k</span><span class="id"> ?]</span><span class="id"> /=;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> le_lt_trans</span><span class="id"> q</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> x</span><span class="id"> /=</span><span class="id"> [Ex]</span><span class="id"> fx0;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> [fxoo|fxoo]</span><span class="id"> :=</span><span class="id"> eqVneq</span> (<span class="id">f^*</span><span class="id"> x</span>)<span class="id"> +oo</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="gallina-kwd"> exists</span><span class="id"> 1%N</span><span class="id"> =&gt;</span><span class="id"> //=;</span><span class="id"> rewrite</span><span class="id"> fxoo</span><span class="id"> ltry</span>.<br/>
&nbsp;&nbsp;<span class="id">near</span><span class="id"> \oo</span><span class="id"> =&gt;</span><span class="id"> m;</span><span class="gallina-kwd"> exists</span><span class="id"> m</span><span class="id"> =&gt;</span><span class="id"> //=</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -</span>(<span class="id">@fineK</span><span class="id"> _</span> (<span class="id">f^*</span><span class="id"> x</span>))<span class="id"> ?gt0_fin_numE</span><span class="id"> ?ltey//</span><span class="id"> lte_fin</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> invf_plt</span><span class="id"> ?posrE//;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> fine_gt0//</span><span class="id"> ltey</span><span class="id"> fx0</span>.<br/>
&nbsp;&nbsp;<span class="id">set</span><span class="id"> r</span><span class="id"> :=</span><span class="id"> _^-1;</span><span class="id"> rewrite</span> (<span class="id">@le_lt_trans</span><span class="id"> _</span><span class="id"> _</span><span class="id"> `|ceil</span><span class="id"> r|</span>.<span class="id">+1%:R</span>)<span class="id">//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span> (<span class="id">le_trans</span><span class="id"> _</span> (<span class="id">abs_ceil_ge</span><span class="id"> _</span>))<span class="id">//</span><span class="id"> ler_norm</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> ltr_nat</span><span class="id"> ltnS;</span><span class="id"> near:</span><span class="id"> m;</span><span class="id"> exact:</span><span class="id"> nbhs_infty_gt</span>.<br/>
<span class="id">apply:</span><span class="id"> negligibleS</span><span class="id"> =&gt;</span><span class="id"> z</span><span class="id"> /=</span><span class="id"> /not_implyP[Ez</span><span class="id"> H];</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
<span class="id">rewrite</span><span class="id"> ltNge;</span><span class="id"> apply:</span><span class="id"> contra_notN</span><span class="id"> H</span>.<br/>
<span class="id">rewrite</span><span class="id"> le_eqVlt</span><span class="id"> ltNge</span><span class="id"> limf_esup_ge0/=</span><span class="id"> ?orbF//;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> x;</span><span class="id"> exact:</span><span class="id"> iavg_ge0</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> /eqP</span><span class="id"> fz0</span>.<br/>
<span class="id">suff:</span><span class="id"> lime_inf</span> (<span class="id">davg</span><span class="id"> f</span><span class="id"> z</span>)<span class="id"> 0</span><span class="id"> =</span><span class="id"> 0</span><span class="gallina-kwd"> by</span><span class="id"> exact:</span><span class="id"> lime_sup_inf_at_right</span>.<br/>
<span class="id">apply/eqP;</span><span class="id"> rewrite</span><span class="id"> eq_le</span><span class="id"> -[X</span><span class="gallina-kwd"> in</span><span class="id"> _</span><span class="id"> &lt;=</span><span class="id"> X</span><span class="id"> &lt;=</span><span class="id"> _]fz0</span><span class="id"> lime_inf_sup/=</span><span class="id"> fz0</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> lime_inf_ge0</span><span class="id"> =&gt;</span><span class="id"> x;</span><span class="id"> exact:</span><span class="id"> iavg_ge0</span>.<br/>
<span class="id">Unshelve</span>.<span class="id"> all:</span><span class="gallina-kwd"> by</span><span class="id"> end_near</span>. Qed.</div></details>
<br/>
<span class="vernacular">Let</span><span class="id"> lebesgue_differentiation_bounded</span><span class="id"> f</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">let</span><span class="id"> B</span><span class="id"> k</span><span class="id"> :</span><span class="id"> set</span><span class="id"> R^o</span><span class="id"> :=</span><span class="id"> ball</span><span class="id"> 0%R</span><span class="id"> k</span>.<span class="id">+1</span>.<span class="id">*2%:R</span><span class="gallina-kwd"> in</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">let</span><span class="id"> f_</span><span class="id"> k</span><span class="id"> :=</span><span class="id"> f</span><span class="id"> \_</span> (<span class="id">B</span><span class="id"> k</span>)<span class="gallina-kwd"> in</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">forall</span><span class="id"> k,</span><span class="id"> mu</span>.<span class="id">-integrable</span><span class="id"> setT</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> f_</span><span class="id"> k</span>))<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">forall</span><span class="id"> k,</span><span class="id"> {ae</span><span class="id"> mu,</span><span class="gallina-kwd"> forall</span><span class="id"> x,</span><span class="id"> B</span><span class="id"> k</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> lebesgue_pt</span> (<span class="id">f_</span><span class="id"> k</span>)<span class="id"> x}</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> B</span><span class="id"> f_</span><span class="id"> intf_</span><span class="id"> k;</span><span class="id"> apply:</span><span class="id"> lebesgue_differentiation_suff</span><span class="id"> =&gt;</span><span class="id"> e</span><span class="id"> e0</span>.<br/>
<span class="id">have</span><span class="id"> mE</span><span class="id"> :</span><span class="id"> measurable</span> (<span class="id">B</span><span class="id"> k</span>)<span class="gallina-kwd"> by</span><span class="id"> exact:</span><span class="id"> measurable_ball</span>.<br/>
<span class="id">have</span><span class="id"> ex_g_</span><span class="id"> :</span><span class="gallina-kwd"> exists</span><span class="id"> g_</span><span class="id"> :</span> (<span class="id">R</span><span class="id"> -&gt;</span><span class="id"> R</span>)<span class="id">^nat,</span><br/>
&nbsp;&nbsp;<span class="id">[/\</span> (<span class="gallina-kwd">forall</span><span class="id"> n,</span><span class="id"> continuous</span> (<span class="id">g_</span><span class="id"> n</span>))<span class="id">,</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="gallina-kwd">forall</span><span class="id"> n,</span><span class="id"> mu</span>.<span class="id">-integrable</span> (<span class="id">B</span><span class="id"> k</span>) (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> g_</span><span class="id"> n</span>))<span class="id"> &amp;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">\int[mu]_</span>(<span class="id">z</span><span class="gallina-kwd"> in</span><span class="id"> B</span><span class="id"> k</span>)<span class="id"> `|f_</span><span class="id"> k</span><span class="id"> z</span><span class="id"> -</span><span class="id"> g_</span><span class="id"> n</span><span class="id"> z|%:E</span><span class="id"> @[n</span><span class="id"> --&gt;</span><span class="id"> \oo]</span><span class="id"> --&gt;</span><span class="id"> 0</span><span class="id"> ]</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> approximation_continuous_integrable</span><span class="id"> =&gt;</span><span class="id"> //=</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> lebesgue_measure_ball//=</span><span class="id"> ltry</span>.<br/>
&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> integrableS</span> (<span class="id">intf_</span><span class="id"> _</span>).<br/>
<span class="id">have</span><span class="id"> {ex_g_}</span><span class="id"> ex_gn</span><span class="id"> n</span><span class="id"> :</span><span class="gallina-kwd"> exists</span><span class="id"> gn</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> R,</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">[/\</span><span class="id"> continuous</span><span class="id"> gn,</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">mu</span>.<span class="id">-integrable</span> (<span class="id">B</span><span class="id"> k</span>) (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> gn</span>)<span class="id"> &amp;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">\int[mu]_</span>(<span class="id">z</span><span class="gallina-kwd"> in</span><span class="id"> B</span><span class="id"> k</span>)<span class="id"> `|f_</span><span class="id"> k</span><span class="id"> z</span><span class="id"> -</span><span class="id"> gn</span><span class="id"> z|%:E</span><span class="id"> &lt;=</span><span class="id"> n</span>.<span class="id">+1%:R^-1%:E]</span>.<br/>
&nbsp;&nbsp;<span class="id">case:</span><span class="id"> ex_g_</span><span class="id"> =&gt;</span><span class="id"> g_</span><span class="id"> [cg</span><span class="id"> intg]</span><span class="id"> /fine_cvgP[]</span><span class="id"> [m</span><span class="id"> _</span><span class="id"> fgfin]</span><span class="id"> /cvgrPdist_le</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> /</span>(_<span class="id"> n</span>.<span class="id">+1%:R^-1</span><span class="id"> ltac:</span>(<span class="gallina-kwd">by</span><span class="id"> []</span>))<span class="id">[p</span><span class="id"> _]</span><span class="id"> /</span>(_<span class="id"> _</span> (<span class="id">leq_addr</span><span class="id"> m</span><span class="id"> p</span>)).<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> sub0r</span><span class="id"> normrN</span><span class="id"> -lee_fin</span><span class="id"> =&gt;</span><span class="id"> /=</span><span class="id"> fg0</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">exists</span> (<span class="id">g_</span> (<span class="id">p</span><span class="id"> +</span><span class="id"> m</span>)<span class="id">%N</span>)<span class="id">;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> (<span class="id">le_trans</span><span class="id"> _</span><span class="id"> fg0</span>)<span class="id">//</span><span class="id"> ger0_norm</span><span class="id"> ?fine_ge0</span><span class="id"> ?integral_ge0//</span><span class="id"> fineK//</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> fgfin//=</span><span class="id"> leq_addl</span>.<br/>
<span class="id">pose</span><span class="id"> g_</span><span class="id"> n</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> R</span><span class="id"> :=</span><span class="id"> sval</span> (<span class="id">cid</span> (<span class="id">ex_gn</span><span class="id"> n</span>)).<br/>
<span class="id">have</span><span class="id"> cg_</span><span class="id"> n</span><span class="id"> :</span><span class="id"> continuous</span> (<span class="id">g_</span><span class="id"> n</span>)<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> /g_</span><span class="id"> /sval</span><span class="id"> /=;</span><span class="id"> case:</span><span class="id"> cid</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> x</span><span class="id"> []</span>.<br/>
<span class="id">have</span><span class="id"> intg</span><span class="id"> n</span><span class="id"> :</span><span class="id"> mu</span>.<span class="id">-integrable</span> (<span class="id">B</span><span class="id"> k</span>) (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> g_</span><span class="id"> n</span>).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /g_</span><span class="id"> /sval</span><span class="id"> /=;</span><span class="id"> case:</span><span class="id"> cid</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> x</span><span class="id"> []</span>.<br/>
<span class="id">have</span><span class="id"> ifg_ub</span><span class="id"> n</span><span class="id"> :</span><span class="id"> \int[mu]_</span>(<span class="id">z</span><span class="gallina-kwd"> in</span><span class="id"> B</span><span class="id"> k</span>)<span class="id"> `|f_</span><span class="id"> k</span><span class="id"> z</span><span class="id"> -</span><span class="id"> g_</span><span class="id"> n</span><span class="id"> z|%:E</span><span class="id"> &lt;=</span><span class="id"> n</span>.<span class="id">+1%:R^-1%:E</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /g_</span><span class="id"> /sval</span><span class="id"> /=;</span><span class="id"> case:</span><span class="id"> cid</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> x</span><span class="id"> []</span>.<br/>
<span class="id">pose</span><span class="id"> g_B</span><span class="id"> n</span><span class="id"> :=</span><span class="id"> g_</span><span class="id"> n</span><span class="id"> \_</span> (<span class="id">B</span><span class="id"> k</span>).<br/>
<span class="id">have</span><span class="id"> cg_B</span><span class="id"> n</span><span class="id"> :</span><span class="id"> {in</span><span class="id"> B</span><span class="id"> k,</span><span class="id"> continuous</span> (<span class="id">g_B</span><span class="id"> n</span>)<span class="id">}</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> x</span><span class="id"> xBk;</span><span class="id"> rewrite</span><span class="id"> /g_B</span><span class="id"> patch_indic/=</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> cvgM</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> [exact:</span><span class="id"> cg_|exact:</span><span class="id"> cvg_indic]</span>.<br/>
<span class="id">pose</span><span class="id"> f_g_Be</span><span class="id"> n</span><span class="id"> :</span><span class="id"> set</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> [set</span><span class="id"> x</span><span class="id"> |</span><span class="id"> `|</span> (<span class="id">f_</span><span class="id"> k</span><span class="id"> \-</span><span class="id"> g_B</span><span class="id"> n</span>)<span class="id"> x</span><span class="id"> |%:E</span><span class="id"> &gt;=</span> (<span class="id">e</span><span class="id"> /</span><span class="id"> 2</span>)<span class="id">%:E]</span>.<br/>
<span class="id">pose</span><span class="id"> HLf_g_Be</span><span class="id"> n</span><span class="id"> :</span><span class="id"> set</span><span class="id"> _</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">[set</span><span class="id"> x</span><span class="id"> |</span><span class="id"> HL_maximal</span> (<span class="id">f_</span><span class="id"> k</span><span class="id"> \-</span><span class="id"> g_B</span><span class="id"> n</span>)<span class="id">%R</span><span class="id"> x</span><span class="id"> &gt;</span> (<span class="id">e</span><span class="id"> /</span><span class="id"> 2</span>)<span class="id">%:E]</span>.<br/>
<span class="id">pose</span><span class="id"> Ee</span><span class="id"> :=</span><span class="id"> \bigcap_n</span> (<span class="id">B</span><span class="id"> k</span><span class="id"> `&amp;`</span> (<span class="id">HLf_g_Be</span><span class="id"> n</span><span class="id"> `|`</span><span class="id"> f_g_Be</span><span class="id"> n</span>)).<br/>
<span class="id">case/integrableP:</span> (<span class="id">intf_</span><span class="id"> k</span>)<span class="id"> =&gt;</span><span class="id"> mf</span><span class="id"> intf</span>.<br/>
<span class="id">have</span><span class="id"> mfg</span><span class="id"> n</span><span class="id"> :</span><span class="id"> measurable_fun</span><span class="id"> setT</span> (<span class="id">f_</span><span class="id"> k</span><span class="id"> \-</span><span class="id"> g_</span><span class="id"> n</span>)<span class="id">%R</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> measurable_funB;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> move/measurable_EFinP</span><span class="id"> :</span><span class="id"> mf</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> continuous_measurable_fun;</span><span class="id"> exact:</span><span class="id"> cg_</span>.<br/>
<span class="id">have</span><span class="id"> locg_B</span><span class="id"> n</span><span class="id"> :</span><span class="id"> locally_integrable</span><span class="id"> [set:</span><span class="id"> R]</span> (<span class="id">g_B</span><span class="id"> n</span>).<br/>
&nbsp;&nbsp;<span class="id">split;</span><span class="id"> [|exact:</span><span class="id"> openT|]</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> apply/</span>(<span class="id">measurable_restrictT</span><span class="id"> _</span><span class="id"> _</span>).<span class="id">1</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> measurable_funS</span> (<span class="id">continuous_measurable_fun</span> (<span class="id">cg_</span><span class="id"> n</span>)).<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> move=&gt;</span><span class="id"> K</span><span class="id"> _</span><span class="id"> cK</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> (<span class="id">@le_lt_trans</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> K</span>)<span class="id"> `|g_</span><span class="id"> n</span><span class="id"> x|%:E</span>))<span class="id">//;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">have</span><span class="id"> :</span><span class="id"> {within</span><span class="id"> K,</span><span class="id"> continuous</span> (<span class="id">g_</span><span class="id"> n</span>)<span class="id">}</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> continuous_subspaceT</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move/</span>(<span class="id">continuous_compact_integrable</span><span class="id"> cK</span>)<span class="id"> =&gt;</span><span class="id"> /integrableP[_</span><span class="id"> /=]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> ge0_le_integral</span><span class="id"> =&gt;</span><span class="id"> //=</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">+</span><span class="id"> exact:</span><span class="id"> compact_measurable</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">+</span><span class="id"> do</span><span class="id"> 2</span><span class="id"> apply:</span><span class="id"> measurableT_comp</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> apply/measurable_restrict</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> compact_measurable</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> measurable_funS</span> (<span class="id">continuous_measurable_fun</span> (<span class="id">cg_</span><span class="id"> n</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">+</span><span class="id"> do</span><span class="id"> 2</span><span class="id"> apply:</span><span class="id"> measurableT_comp</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> apply:</span><span class="id"> measurable_funTS</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> continuous_measurable_fun</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">+</span><span class="id"> move=&gt;</span><span class="id"> /=</span><span class="id"> x</span><span class="id"> Kx;</span><span class="id"> rewrite</span><span class="id"> /g_B</span><span class="id"> patchE;</span><span class="id"> case:</span><span class="id"> ifPn</span><span class="id"> =&gt;</span><span class="id"> //=</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> normr0</span><span class="id"> lee_fin</span>.<br/>
<span class="id">have</span><span class="id"> locf_g_B</span><span class="id"> n</span><span class="id"> :</span><span class="id"> locally_integrable</span><span class="id"> setT</span> (<span class="id">f_</span><span class="id"> k</span><span class="id"> \-</span><span class="id"> g_B</span><span class="id"> n</span>)<span class="id">%R</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> locally_integrableB</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> split</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move/measurable_EFinP</span><span class="id"> :</span><span class="id"> mf</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> exact:</span><span class="id"> openT</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> move=&gt;</span><span class="id"> K</span><span class="id"> _</span><span class="id"> cK;</span><span class="id"> rewrite</span> (<span class="id">le_lt_trans</span><span class="id"> _</span><span class="id"> intf</span>)<span class="id">//=</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> ge0_subset_integral</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">+</span><span class="id"> exact:</span><span class="id"> compact_measurable</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> do</span><span class="id"> 2</span><span class="id"> apply:</span><span class="id"> measurableT_comp</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> move/measurable_EFinP</span><span class="id"> :</span><span class="id"> mf</span>.<br/>
<span class="id">have</span><span class="id"> mEHL</span><span class="id"> i</span><span class="id"> :</span><span class="id"> measurable</span> (<span class="id">HLf_g_Be</span><span class="id"> i</span>).<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> /HLf_g_Be</span><span class="id"> -[X</span><span class="gallina-kwd"> in</span><span class="id"> measurable</span><span class="id"> X]setTI</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> emeasurable_fun_o_infty</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> measurable_HL_maximal;</span><span class="id"> exact:</span><span class="id"> locf_g_B</span>.<br/>
<span class="id">have</span><span class="id"> mfge</span><span class="id"> i</span><span class="id"> :</span><span class="id"> measurable</span> (<span class="id">f_g_Be</span><span class="id"> i</span>).<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> /f_g_Be</span><span class="id"> -[X</span><span class="gallina-kwd"> in</span><span class="id"> measurable</span><span class="id"> X]setTI</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> emeasurable_fun_c_infty</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> do</span><span class="id"> 2</span><span class="id"> apply:</span><span class="id"> measurableT_comp</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> case:</span> (<span class="id">locf_g_B</span><span class="id"> i</span>).<br/>
<span class="id">have</span><span class="id"> mEe</span><span class="id"> :</span><span class="id"> measurable</span><span class="id"> Ee</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> bigcapT_measurable</span><span class="id"> =&gt;</span><span class="id"> i</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> measurableI;</span><span class="id"> [exact:</span><span class="id"> measurable_ball|exact:</span><span class="id"> measurableU]</span>.<br/>
<span class="id">have</span><span class="id"> davgfEe</span><span class="id"> :</span><span class="id"> B</span><span class="id"> k</span><span class="id"> `&amp;`</span><span class="id"> [set</span><span class="id"> x</span><span class="id"> |</span> (<span class="id">f_</span><span class="id"> k</span>)<span class="id">^*</span><span class="id"> x</span><span class="id"> &gt;</span><span class="id"> e%:E]</span><span class="id"> `&lt;=`</span><span class="id"> Ee</span>.<br/>
&nbsp;&nbsp;<span class="id">suff:</span><span class="gallina-kwd"> forall</span><span class="id"> n,</span><span class="id"> B</span><span class="id"> k</span><span class="id"> `&amp;`</span><span class="id"> [set</span><span class="id"> x</span><span class="id"> |</span><span class="id"> e%:E</span><span class="id"> &lt;</span> (<span class="id">f_</span><span class="id"> k</span>)<span class="id">^*</span><span class="id"> x]</span><span class="id"> `&lt;=`</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">B</span><span class="id"> k</span><span class="id"> `&amp;`</span> (<span class="id">HLf_g_Be</span><span class="id"> n</span><span class="id"> `|`</span><span class="id"> f_g_Be</span><span class="id"> n</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> suf</span><span class="id"> r</span><span class="id"> /=</span><span class="id"> /suf</span><span class="id"> hr</span><span class="id"> n</span><span class="id"> _;</span><span class="id"> exact:</span><span class="id"> hr</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> n;</span><span class="id"> rewrite</span><span class="id"> [X</span><span class="gallina-kwd"> in</span><span class="id"> X</span><span class="id"> `&lt;=`_]</span>(_<span class="id"> :</span><span class="id"> _</span><span class="id"> =</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">B</span><span class="id"> k</span><span class="id"> `&amp;`</span><span class="id"> [set</span><span class="id"> x</span><span class="id"> |</span><span class="id"> e%:E</span><span class="id"> &lt;</span> (<span class="id">f_</span><span class="id"> k</span><span class="id"> \-</span><span class="id"> g_B</span><span class="id"> n</span>)<span class="id">%R^*</span><span class="id"> x]</span>)<span class="id">;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply/seteqP;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> [x</span><span class="id"> [Ex]</span><span class="id"> /=|x</span><span class="id"> [Ex]</span><span class="id"> /=]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> (<span class="id">@lim_sup_davgB</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">B</span><span class="id"> k</span>))<span class="id">//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> split;</span><span class="id"> [exact:</span><span class="id"> ball_open|exact:</span><span class="id"> Ex]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move/measurable_EFinP</span><span class="id"> :</span><span class="id"> mf;</span><span class="id"> apply:</span><span class="id"> measurable_funS</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> cg_B;</span><span class="id"> rewrite</span><span class="id"> inE</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> (<span class="id">@lim_sup_davgB</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">B</span><span class="id"> k</span>))<span class="id">//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> split;</span><span class="id"> [exact:</span><span class="id"> ball_open|exact:</span><span class="id"> Ex]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move/measurable_EFinP</span><span class="id"> :</span><span class="id"> mf;</span><span class="id"> apply:</span><span class="id"> measurable_funS</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> cg_B;</span><span class="id"> rewrite</span><span class="id"> inE</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> r</span><span class="id"> /=</span><span class="id"> [Er]</span><span class="id"> efgnr;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> {}efgnr</span><span class="id"> :=</span><span class="id"> lt_le_trans</span><span class="id"> efgnr</span> (<span class="id">lim_sup_davgT_HL_maximal</span><span class="id"> r</span> (<span class="id">locf_g_B</span><span class="id"> n</span>)).<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> [|h]</span><span class="id"> :=</span><span class="id"> ltP</span> (<span class="id">e</span><span class="id"> /</span><span class="id"> 2</span>)<span class="id">%:E</span> (<span class="id">HL_maximal</span> (<span class="id">f_</span><span class="id"> k</span><span class="id"> \-</span><span class="id"> g_B</span><span class="id"> n</span>)<span class="id">%R</span><span class="id"> r</span>)<span class="id">;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> left</span>.<br/>
&nbsp;&nbsp;<span class="id">right;</span><span class="id"> move:</span><span class="id"> efgnr</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> {1}</span>(<span class="id">splitr</span><span class="id"> e</span>)<span class="id"> EFinD</span><span class="id"> -lteBrDl//</span><span class="id"> =&gt;</span><span class="id"> /ltW/le_trans;</span><span class="id"> apply</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> leeBlDl//</span><span class="id"> leeD</span>.<br/>
<span class="id">suff:</span><span class="id"> mu</span><span class="id"> Ee</span><span class="id"> =</span><span class="id"> 0</span><span class="gallina-kwd"> by</span><span class="gallina-kwd"> exists</span><span class="id"> Ee</span>.<br/>
<span class="id">have</span><span class="id"> HL_null</span><span class="id"> n</span><span class="id"> :</span><span class="id"> mu</span> (<span class="id">HLf_g_Be</span><span class="id"> n</span>)<span class="id"> &lt;=</span> (<span class="id">3</span><span class="id"> /</span> (<span class="id">e</span><span class="id"> /</span><span class="id"> 2</span>))<span class="id">%:E</span><span class="id"> *</span><span class="id"> n</span>.<span class="id">+1%:R^-1%:E</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> (<span class="id">le_trans</span> (<span class="id">maximal_inequality</span><span class="id"> _</span><span class="id"> _</span> ))<span class="id"> ?divr_gt0//</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> lee_pmul2l</span><span class="id"> ?lte_fin</span><span class="id"> ?divr_gt0//</span>.<br/>
&nbsp;&nbsp;<span class="id">set</span><span class="id"> h</span><span class="id"> :=</span> (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> `|</span>(<span class="id">f_</span><span class="id"> k</span><span class="id"> \-</span><span class="id"> g_</span><span class="id"> n</span>)<span class="id"> x|%:E</span>)<span class="id"> \_</span> (<span class="id">B</span><span class="id"> k</span>).<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> (<span class="id">@eq_integral</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> mu</span><span class="id"> setT</span><span class="id"> h</span>)<span class="id">//=</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -integral_mkcond/=;</span><span class="id"> exact:</span><span class="id"> ifg_ub</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> x</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> /h</span><span class="id"> restrict_EFin</span><span class="id"> restrict_normr/=</span><span class="id"> /g_B</span><span class="id"> /f_</span><span class="id"> !patchE</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> case:</span><span class="id"> ifPn</span><span class="id"> =&gt;</span><span class="id"> /=;</span><span class="id"> [rewrite</span><span class="id"> patchE</span><span class="id"> =&gt;</span><span class="id"> -&gt;|rewrite</span><span class="id"> subrr]</span>.<br/>
<span class="id">have</span><span class="id"> fgn_null</span><span class="id"> n</span><span class="id"> :</span><span class="id"> mu</span><span class="id"> [set</span><span class="id"> x</span><span class="id"> |</span><span class="id"> `|</span>(<span class="id">f_</span><span class="id"> k</span><span class="id"> \-</span><span class="id"> g_B</span><span class="id"> n</span>)<span class="id"> x|%:E</span><span class="id"> &gt;=</span> (<span class="id">e</span><span class="id"> /</span><span class="id"> 2</span>)<span class="id">%:E]</span><span class="id"> &lt;=</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">e</span><span class="id"> /</span><span class="id"> 2</span>)<span class="id">^-1%:E</span><span class="id"> *</span><span class="id"> n</span>.<span class="id">+1%:R^-1%:E</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> lee_pdivlMl</span><span class="id"> ?invr_gt0</span><span class="id"> ?divr_gt0//</span><span class="id"> -[X</span><span class="gallina-kwd"> in</span><span class="id"> mu</span><span class="id"> X]setTI</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> le_trans</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span> (<span class="id">@le_integral_comp_abse</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> mu</span><span class="id"> _</span><span class="id"> measurableT</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">EFin</span><span class="id"> \o</span> (<span class="id">f_</span><span class="id"> k</span><span class="id"> \-</span><span class="id"> g_B</span><span class="id"> n</span>)<span class="id">%R</span>) (<span class="id">e</span><span class="id"> /</span><span class="id"> 2</span>)<span class="id"> id</span>)<span class="id"> =&gt;</span><span class="id"> //=</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> measurableT_comp</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> case:</span> (<span class="id">locf_g_B</span><span class="id"> n</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> divr_gt0</span>.<br/>
&nbsp;&nbsp;<span class="id">set</span><span class="id"> h</span><span class="id"> :=</span> (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> `|</span>(<span class="id">f_</span><span class="id"> k</span><span class="id"> \-</span><span class="id"> g_</span><span class="id"> n</span>)<span class="id"> x|%:E</span>)<span class="id"> \_</span> (<span class="id">B</span><span class="id"> k</span>).<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> (<span class="id">@eq_integral</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> mu</span><span class="id"> setT</span><span class="id"> h</span>)<span class="id">//=</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -integral_mkcond/=;</span><span class="id"> exact:</span><span class="id"> ifg_ub</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> x</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> /h</span><span class="id"> restrict_EFin</span><span class="id"> restrict_normr/=</span><span class="id"> /g_B</span><span class="id"> /f_</span><span class="id"> !patchE</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> case:</span><span class="id"> ifPn</span><span class="id"> =&gt;</span><span class="id"> /=;</span><span class="id"> [rewrite</span><span class="id"> patchE</span><span class="id"> =&gt;</span><span class="id"> -&gt;|rewrite</span><span class="id"> subrr]</span>.<br/>
<span class="id">apply/eqP;</span><span class="id"> rewrite</span><span class="id"> eq_le</span><span class="id"> measure_ge0</span><span class="id"> andbT</span>.<br/>
<span class="id">apply/lee_addgt0Pr</span><span class="id"> =&gt;</span><span class="id"> r</span><span class="id"> r0;</span><span class="id"> rewrite</span><span class="id"> add0e</span>.<br/>
<span class="id">have</span><span class="id"> incl</span><span class="id"> n</span><span class="id"> :</span><span class="id"> Ee</span><span class="id"> `&lt;=`</span><span class="id"> B</span><span class="id"> k</span><span class="id"> `&amp;`</span> (<span class="id">HLf_g_Be</span><span class="id"> n</span><span class="id"> `|`</span><span class="id"> f_g_Be</span><span class="id"> n</span>)<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> ?;</span><span class="id"> apply</span>.<br/>
<span class="id">near</span><span class="id"> \oo</span><span class="id"> =&gt;</span><span class="id"> n</span>.<br/>
<span class="id">rewrite</span> (<span class="id">@le_trans</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">mu</span> (<span class="id">B</span><span class="id"> k</span><span class="id"> `&amp;`</span> (<span class="id">HLf_g_Be</span><span class="id"> n</span><span class="id"> `|`</span><span class="id"> f_g_Be</span><span class="id"> n</span>))))<span class="id">//</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> le_measure//</span><span class="id"> inE//;</span><span class="id"> apply:</span><span class="id"> measurableI;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> measurable_ball</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> measurableU</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> [exact:</span><span class="id"> mEHL|exact:</span><span class="id"> mfge]</span>.<br/>
<span class="id">rewrite</span> (<span class="id">@le_trans</span><span class="id"> _</span><span class="id"> _</span> ((<span class="id">4</span><span class="id"> /</span> (<span class="id">e</span><span class="id"> /</span><span class="id"> 2</span>))<span class="id">%:E</span><span class="id"> *</span><span class="id"> n</span>.<span class="id">+1%:R^-1%:E</span>))<span class="id">//</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> (<span class="id">@le_trans</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">mu</span> (<span class="id">HLf_g_Be</span><span class="id"> n</span><span class="id"> `|`</span><span class="id"> f_g_Be</span><span class="id"> n</span>)))<span class="id">//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> le_measure//</span><span class="id"> inE//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> measurableI</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> measurableU</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> [exact:</span><span class="id"> mEHL|exact:</span><span class="id"> mfge]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> measurableU</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> [exact:</span><span class="id"> mEHL|exact:</span><span class="id"> mfge]</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> (<span class="id">le_trans</span> (<span class="id">measureU2</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span>))<span class="id">//=;</span><span class="id"> [exact:</span><span class="id"> mEHL|exact:</span><span class="id"> mfge|]</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> le_trans;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> leeD;</span><span class="id"> [exact:</span><span class="id"> HL_null|exact:</span><span class="id"> fgn_null]</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -muleDl//</span><span class="id"> lee_pmul2r//</span><span class="id"> -EFinD</span><span class="id"> lee_fin</span><span class="id"> -{2}</span>(<span class="id">mul1r</span> (<span class="id">_^-1</span>))<span class="id"> -div1r</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -mulrDl</span><span class="id"> natr1</span>.<br/>
<span class="id">rewrite</span><span class="id"> -lee_pdivlMl</span><span class="id"> ?divr_gt0//</span><span class="id"> -EFinM</span><span class="id"> lee_fin</span><span class="id"> -</span>(<span class="id">@invrK</span><span class="id"> _</span><span class="id"> r</span>).<br/>
<span class="id">rewrite</span><span class="id"> -invrM</span><span class="id"> ?unitfE</span><span class="id"> ?gt_eqF</span><span class="id"> ?invr_gt0</span><span class="id"> ?divr_gt0//</span>.<br/>
<span class="id">rewrite</span><span class="id"> lef_pV2</span><span class="id"> ?posrE</span><span class="id"> ?mulr_gt0</span><span class="id"> ?invr_gt0</span><span class="id"> ?divr_gt0//</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -</span>(<span class="id">@natr1</span><span class="id"> _</span><span class="id"> n</span>)<span class="id"> -lerBlDr;</span><span class="id"> near:</span><span class="id"> n;</span><span class="id"> exact:</span><span class="id"> nbhs_infty_ger</span>.<br/>
<span class="id">Unshelve</span>.<span class="id"> all:</span><span class="gallina-kwd"> by</span><span class="id"> end_near</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> lebesgue_differentiation</span><span class="id"> f</span><span class="id"> :</span><span class="id"> locally_integrable</span><span class="id"> setT</span><span class="id"> f</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">{ae</span><span class="id"> mu,</span><span class="gallina-kwd"> forall</span><span class="id"> x,</span><span class="id"> lebesgue_pt</span><span class="id"> f</span><span class="id"> x}</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> locf</span>.<br/>
<span class="id">pose</span><span class="id"> B</span><span class="id"> k</span><span class="id"> :</span><span class="id"> set</span><span class="id"> R^o</span><span class="id"> :=</span><span class="id"> ball</span><span class="id"> 0%R</span> (<span class="id">k</span>.<span class="id">+1</span>.<span class="id">*2</span>)<span class="id">%:R</span>.<br/>
<span class="id">pose</span><span class="id"> fk</span><span class="id"> k</span><span class="id"> :=</span><span class="id"> f</span><span class="id"> \_</span> (<span class="id">B</span><span class="id"> k</span>).<br/>
<span class="id">have</span><span class="id"> mfk</span><span class="id"> k</span><span class="id"> :</span><span class="id"> mu</span>.<span class="id">-integrable</span><span class="id"> setT</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> fk</span><span class="id"> k</span>).<br/>
&nbsp;&nbsp;<span class="id">case:</span><span class="id"> locf</span><span class="id"> =&gt;</span><span class="id"> mf</span><span class="id"> _</span><span class="id"> intf</span>.<br/>
&nbsp;&nbsp;<span class="id">apply/integrableP;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> /=</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply/measurable_EFinP/</span>(<span class="id">measurable_restrictT</span><span class="id"> _</span><span class="id"> _</span>).<span class="id">1</span><span class="id"> =&gt;</span><span class="id"> //=;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">[exact:</span><span class="id"> measurable_ball|exact:</span><span class="id"> measurable_funS</span><span class="id"> mf]</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> (_<span class="id"> :</span> (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> _</span>)<span class="id"> =</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> normr</span><span class="id"> \o</span><span class="id"> f</span>)<span class="id"> \_</span> (<span class="id">B</span><span class="id"> k</span>))<span class="id">;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply/funext</span><span class="id"> =&gt;</span><span class="id"> x;</span><span class="id"> rewrite</span><span class="id"> restrict_EFin/=</span><span class="id"> restrict_normr</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -integral_mkcond/=</span><span class="id"> -ge0_integral_closed_ball//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> intf//;</span><span class="id"> exact:</span><span class="id"> closed_ballR_compact</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> measurable_funTS;</span><span class="id"> do</span><span class="id"> 2</span><span class="id"> apply:</span><span class="id"> measurableT_comp</span>.<br/>
<span class="id">have</span><span class="id"> suf</span><span class="id"> k</span><span class="id"> :</span><span class="id"> {ae</span><span class="id"> mu,</span><span class="gallina-kwd"> forall</span><span class="id"> x,</span><span class="id"> B</span><span class="id"> k</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> lebesgue_pt</span> (<span class="id">fk</span><span class="id"> k</span>)<span class="id"> x}</span>.<br/>
&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> lebesgue_differentiation_bounded</span>.<br/>
<span class="id">pose</span><span class="id"> E</span><span class="id"> k</span><span class="id"> :</span><span class="id"> set</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> sval</span> (<span class="id">cid</span> (<span class="id">suf</span><span class="id"> k</span>)).<br/>
<span class="id">rewrite</span><span class="id"> /=</span><span class="gallina-kwd"> in</span><span class="id"> E</span>.<br/>
<span class="id">have</span><span class="id"> HE</span><span class="id"> k</span><span class="id"> :</span><span class="id"> mu</span> (<span class="id">E</span><span class="id"> k</span>)<span class="id"> =</span><span class="id"> 0</span><span class="id"> /\</span><span class="id"> ~`</span><span class="id"> [set</span><span class="id"> x</span><span class="id"> |</span><span class="id"> B</span><span class="id"> k</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> lebesgue_pt</span> (<span class="id">fk</span><span class="id"> k</span>)<span class="id"> x]</span><span class="id"> `&lt;=`</span><span class="id"> E</span><span class="id"> k</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /E</span><span class="id"> /sval;</span><span class="id"> case:</span><span class="id"> cid</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> A</span><span class="id"> []</span>.<br/>
<span class="id">suff:</span><span class="id"> ~`</span><span class="id"> [set</span><span class="id"> x</span><span class="id"> |</span><span class="id"> lebesgue_pt</span><span class="id"> f</span><span class="id"> x]</span><span class="id"> `&lt;=`</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">\bigcup_k</span> (<span class="id">~`</span><span class="id"> [set</span><span class="id"> x</span><span class="id"> |</span><span class="id"> B</span><span class="id"> k</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> lebesgue_pt</span> (<span class="id">fk</span><span class="id"> k</span>)<span class="id"> x]</span>).<br/>
&nbsp;&nbsp;<span class="id">move/</span>(<span class="id">@negligibleS</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> mu</span>)<span class="id">;</span><span class="id"> apply</span><span class="id"> =&gt;</span><span class="id"> /=</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> negligible_bigcup</span><span class="id"> =&gt;</span><span class="id"> k</span><span class="id"> /=;</span><span class="id"> exact:</span><span class="id"> suf</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> x</span><span class="id"> /=</span><span class="id"> fx;</span><span class="id"> rewrite</span><span class="id"> -setC_bigcap</span><span class="id"> =&gt;</span><span class="id"> h;</span><span class="id"> apply:</span><span class="id"> fx</span>.<br/>
<span class="id">have</span><span class="id"> fE</span><span class="id"> y</span><span class="id"> k</span><span class="id"> r</span><span class="id"> :</span> (<span class="id">ball</span><span class="id"> 0%R</span><span class="id"> k</span>.<span class="id">+1%:R</span>)<span class="id"> y</span><span class="id"> -&gt;</span> (<span class="id">r</span><span class="id"> &lt;</span><span class="id"> 1</span>)<span class="id">%R</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">forall</span><span class="id"> t,</span><span class="id"> ball</span><span class="id"> y</span><span class="id"> r</span><span class="id"> t</span><span class="id"> -&gt;</span><span class="id"> f</span><span class="id"> t</span><span class="id"> =</span><span class="id"> fk</span><span class="id"> k</span><span class="id"> t</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> /ball/=</span><span class="id"> sub0r</span><span class="id"> normrN</span><span class="id"> =&gt;</span><span class="id"> yk1</span><span class="id"> r1</span><span class="id"> t</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> ltr_distlC</span><span class="id"> =&gt;</span><span class="id"> /andP[xrt</span><span class="id"> txr]</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> /fk</span><span class="id"> patchE</span><span class="id"> mem_set//</span><span class="id"> /B</span><span class="id"> /ball/=</span><span class="id"> sub0r</span><span class="id"> normrN</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> [t0|t0]</span><span class="id"> :=</span><span class="id"> leP</span><span class="id"> 0%R</span><span class="id"> t</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> ger0_norm//</span> (<span class="id">lt_le_trans</span><span class="id"> txr</span>)<span class="id">//</span><span class="id"> -lerBrDr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> (<span class="id">le_trans</span> (<span class="id">ler_norm</span><span class="id"> _</span>))<span class="id">//</span> (<span class="id">le_trans</span> (<span class="id">ltW</span><span class="id"> yk1</span>))<span class="id">//</span><span class="id"> -lerBlDr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> opprK</span><span class="id"> -lerBrDl</span><span class="id"> -addnn</span><span class="id"> natrD</span><span class="id"> addrK</span> (<span class="id">le_trans</span> (<span class="id">ltW</span><span class="id"> r1</span>))<span class="id">//</span><span class="id"> ler1n</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -opprB</span><span class="id"> ltrNl</span><span class="gallina-kwd"> in</span><span class="id"> xrt</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> ltr0_norm//</span> (<span class="id">lt_le_trans</span><span class="id"> xrt</span>)<span class="id">//</span><span class="id"> lerBlDl</span> (<span class="id">le_trans</span> (<span class="id">ltW</span><span class="id"> r1</span>))<span class="id">//</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -lerBlDl</span><span class="id"> addrC</span><span class="id"> -lerBrDr</span> (<span class="id">le_trans</span> (<span class="id">ler_norm</span><span class="id"> _</span>))<span class="id">//</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -normrN</span><span class="gallina-kwd"> in</span><span class="id"> yk1</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span> (<span class="id">le_trans</span> (<span class="id">ltW</span><span class="id"> yk1</span>))<span class="id">//</span><span class="id"> lerBrDr</span><span class="id"> natr1</span><span class="id"> ler_nat</span><span class="id"> -muln2</span><span class="id"> ltn_Pmulr</span>.<br/>
<span class="id">have</span><span class="id"> :=</span><span class="id"> h</span><span class="id"> `|ceil</span><span class="id"> x|</span>.<span class="id">+1%N</span><span class="id"> Logic</span>.<span class="id">I</span>.<br/>
<span class="id">have</span><span class="id"> Bxx</span><span class="id"> :</span><span class="id"> B</span><span class="id"> `|ceil</span><span class="id"> x|</span>.<span class="id">+1</span><span class="id"> x</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> /B</span><span class="id"> /ball/=</span><span class="id"> sub0r</span><span class="id"> normrN</span> (<span class="id">le_lt_trans</span> (<span class="id">abs_ceil_ge</span><span class="id"> _</span>))<span class="id">//</span> <span class="id"> ltr_nat</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -addnn</span><span class="id"> addSnnS</span><span class="id"> ltn_addl</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> /</span>(_<span class="id"> Bxx</span>)<span class="id">/fine_cvgP[davg_fk_fin_num</span><span class="id"> davg_fk0]</span>.<br/>
<span class="id">have</span><span class="id"> f_fk_ceil</span><span class="id"> :</span><span class="id"> \forall</span><span class="id"> t</span><span class="id"> \near</span><span class="id"> 0^'+,</span><br/>
&nbsp;&nbsp;<span class="id">\int[mu]_</span>(<span class="id">y</span><span class="gallina-kwd"> in</span><span class="id"> ball</span><span class="id"> x</span><span class="id"> t</span>)<span class="id"> `|</span>(<span class="id">f</span><span class="id"> y</span>)<span class="id">%:E</span><span class="id"> -</span> (<span class="id">f</span><span class="id"> x</span>)<span class="id">%:E|</span><span class="id"> =</span><br/>
&nbsp;&nbsp;<span class="id">\int[mu]_</span>(<span class="id">y</span><span class="gallina-kwd"> in</span><span class="id"> ball</span><span class="id"> x</span><span class="id"> t</span>)<span class="id"> `|fk</span><span class="id"> `|ceil</span><span class="id"> x|</span>.<span class="id">+1</span><span class="id"> y</span><span class="id"> -</span><span class="id"> fk</span><span class="id"> `|ceil</span><span class="id"> x|</span>.<span class="id">+1</span><span class="id"> x|%:E</span>.<br/>
&nbsp;&nbsp;<span class="id">near=&gt;</span><span class="id"> t</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> eq_integral</span><span class="id"> =&gt;</span><span class="id"> /=</span><span class="id"> y</span><span class="id"> /[1!inE]</span><span class="id"> xty</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -</span>(<span class="id">fE</span><span class="id"> x</span><span class="id"> _</span><span class="id"> t</span>)<span class="id">//;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /ball/=</span><span class="id"> sub0r</span><span class="id"> normrN</span> (<span class="id">le_lt_trans</span> (<span class="id">abs_ceil_ge</span><span class="id"> _</span>))<span class="id">//</span><span class="id"> ltr_nat</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -</span>(<span class="id">fE</span><span class="id"> x</span><span class="id"> _</span><span class="id"> t</span>)<span class="id">//;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> ballxx;</span><span class="id"> near:</span><span class="id"> t;</span><span class="id"> exact:</span><span class="id"> nbhs_right_gt</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /ball/=</span><span class="id"> sub0r</span><span class="id"> normrN</span> (<span class="id">le_lt_trans</span> (<span class="id">abs_ceil_ge</span><span class="id"> _</span>))<span class="id">//</span><span class="id"> ltr_nat</span>.<br/>
<span class="id">apply/fine_cvgP;</span><span class="id"> split=&gt;</span><span class="id"> [{davg_fk0}|{davg_fk_fin_num}]</span>.<br/>
<span class="id">-</span><span class="id"> move:</span><span class="id"> davg_fk_fin_num</span><span class="id"> =&gt;</span><span class="id"> -[M</span><span class="id"> /=</span><span class="id"> M0]</span><span class="id"> davg_fk_fin_num</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> filter_app</span><span class="id"> f_fk_ceil;</span><span class="id"> near=&gt;</span><span class="id"> t</span><span class="id"> =&gt;</span><span class="id"> Ht</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /davg</span><span class="id"> /iavg</span><span class="id"> Ht</span><span class="id"> davg_fk_fin_num//=</span><span class="id"> sub0r</span><span class="id"> normrN</span><span class="id"> gtr0_norm</span>.<br/>
<span class="id">-</span><span class="id"> move/cvgrPdist_le</span><span class="gallina-kwd"> in</span><span class="id"> davg_fk0;</span><span class="id"> apply/cvgrPdist_le</span><span class="id"> =&gt;</span><span class="id"> e</span><span class="id"> e0</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> [M</span><span class="id"> /=</span><span class="id"> M0</span><span class="id"> {}davg_fk0]</span><span class="id"> :=</span><span class="id"> davg_fk0</span><span class="id"> _</span><span class="id"> e0</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> filter_app</span><span class="id"> f_fk_ceil;</span><span class="id"> near=&gt;</span><span class="id"> t;</span><span class="id"> move=&gt;</span><span class="id"> Ht</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /davg</span><span class="id"> /iavg</span><span class="id"> Ht//</span><span class="id"> davg_fk0//=</span><span class="id"> sub0r</span><span class="id"> normrN</span><span class="id"> gtr0_norm</span>.<br/>
<span class="id">Unshelve</span>.<span class="id"> all:</span><span class="gallina-kwd"> by</span><span class="id"> end_near</span>. Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> lebesgue_differentiation</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> density</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {R</span><span class="id"> :</span><span class="id"> realType}</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Notation</span><span class="id"> mu</span><span class="id"> :=</span><span class="id"> lebesgue_measure</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> lebesgue_density</span> (<span class="id">A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> R</span>)<span class="id"> :</span><span class="id"> measurable</span><span class="id"> A</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">{ae</span><span class="id"> mu,</span><span class="gallina-kwd"> forall</span><span class="id"> x,</span><span class="id"> mu</span> (<span class="id">A</span><span class="id"> `&amp;`</span><span class="id"> ball</span><span class="id"> x</span><span class="id"> r</span>)<span class="id"> *</span> (<span class="id">fine</span> (<span class="id">mu</span> (<span class="id">ball</span><span class="id"> x</span><span class="id"> r</span>)))<span class="id">^-1%:E</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">@[r</span><span class="id"> --&gt;</span><span class="id"> 0^'+]</span><span class="id"> --&gt;</span> (<span class="id">\1_A</span><span class="id"> x</span>)<span class="id">%:E}</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> mA;</span><span class="id"> have</span><span class="id"> :=</span><span class="id"> lebesgue_differentiation</span> (<span class="id">locally_integrable_indic</span><span class="id"> openT</span><span class="id"> mA</span>).<br/>
<span class="id">apply:</span><span class="id"> filter_app;</span><span class="id"> first</span><span class="id"> exact:</span> (<span class="id">ae_filter_ringOfSetsType</span><span class="id"> mu</span>).<br/>
<span class="id">apply:</span><span class="id"> aeW</span><span class="id"> =&gt;</span><span class="id"> /=</span><span class="id"> x</span><span class="id"> Ax</span>.<br/>
<span class="id">apply:</span> (<span class="id">cvge_sub0</span><span class="id"> _</span><span class="id"> _</span>).<span class="id">1</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
<span class="id">move:</span><span class="id"> Ax;</span><span class="id"> rewrite</span><span class="id"> /lebesgue_pt</span><span class="id"> /davg</span><span class="id"> /=</span><span class="id"> -/mu</span><span class="id"> =&gt;</span><span class="id"> Ax</span>.<br/>
<span class="id">have</span><span class="id"> :</span> (<span class="id">fine</span> (<span class="id">mu</span> (<span class="id">ball</span><span class="id"> x</span><span class="id"> r</span>)))<span class="id">^-1%:E</span><span class="id"> *</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">`|\int[mu]_</span>(<span class="id">y</span><span class="gallina-kwd"> in</span><span class="id"> ball</span><span class="id"> x</span><span class="id"> r</span>) (<span class="id">\1_A</span><span class="id"> y</span><span class="id"> -</span><span class="id"> \1_A</span><span class="id"> x</span>)<span class="id">%:E</span><span class="id"> |</span><span class="id"> @[r</span><span class="id"> --&gt;</span><span class="id"> 0^'+]</span><span class="id"> --&gt;</span><span class="id"> 0</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span> (<span class="id">@squeeze_cvge</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> R</span> (<span class="id">cst</span><span class="id"> 0</span>)<span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> Ax</span>)<span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> [|exact:</span><span class="id"> cvg_cst]</span>.<br/>
&nbsp;&nbsp;<span class="id">near=&gt;</span><span class="id"> a</span>.<br/>
&nbsp;&nbsp;<span class="id">apply/andP;</span><span class="id"> split;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> mule_ge0//</span><span class="id"> lee_fin</span><span class="id"> invr_ge0//</span><span class="id"> fine_ge0</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> lee_pmul2l//;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> lte_fin</span><span class="id"> invr_gt0//</span><span class="id"> fine_gt0//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> lebesgue_measure_ball//</span><span class="id"> ltry</span><span class="id"> andbT</span><span class="id"> lte_fin</span><span class="id"> mulrn_wgt0</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> le_abse_integral</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> measurable_ball</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply/measurable_EFinP;</span><span class="id"> exact:</span><span class="id"> measurable_funB</span>.<br/>
<span class="id">set</span><span class="id"> f</span><span class="id"> :=</span> (<span class="id">f</span><span class="gallina-kwd"> in</span><span class="id"> f</span><span class="id"> r</span><span class="id"> @[r</span><span class="id"> --&gt;</span><span class="id"> 0^'+]</span><span class="id"> --&gt;</span><span class="id"> _</span><span class="id"> -&gt;</span><span class="id"> _</span>).<br/>
<span class="id">rewrite</span> (_<span class="id"> :</span><span class="id"> f</span><span class="id"> =</span><span class="gallina-kwd"> fun</span><span class="id"> r</span><span class="id"> =&gt;</span> (<span class="id">fine</span> (<span class="id">mu</span> (<span class="id">ball</span><span class="id"> x</span><span class="id"> r</span>)))<span class="id">^-1%:E</span><span class="id"> *</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id">`|mu</span> (<span class="id">A</span><span class="id"> `&amp;`</span><span class="id"> ball</span><span class="id"> x</span><span class="id"> r</span>)<span class="id"> -</span> (<span class="id">\1_A</span><span class="id"> x</span>)<span class="id">%:E</span><span class="id"> *</span><span class="id"> mu</span> (<span class="id">ball</span><span class="id"> x</span><span class="id"> r</span>)<span class="id">|</span>)<span class="id">;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">apply/funext</span><span class="id"> =&gt;</span><span class="id"> r;</span><span class="id"> rewrite</span><span class="id"> /f</span><span class="id"> integralB_EFin//=;</span><span class="id"> last</span><span class="id"> 3</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="id"> exact:</span><span class="id"> measurable_ball</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="id"> apply/integrableP;</span><span class="id"> split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exact/measurable_EFinP/measurable_indic</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">under</span><span class="id"> eq_integral</span><span class="id"> do</span><span class="id"> rewrite</span><span class="id"> /=</span><span class="id"> ger0_norm//=</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> integral_indic//=;</span><span class="id"> last</span><span class="id"> exact:</span><span class="id"> measurable_ball</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -/mu</span> (<span class="id">@le_lt_trans</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">mu</span> (<span class="id">ball</span><span class="id"> x</span><span class="id"> r</span>)))<span class="id">//</span><span class="id"> ?le_measure//</span><span class="id"> ?inE</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> measurableI</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> measurable_ball</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">+</span><span class="id"> exact:</span><span class="id"> measurable_ball</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">+</span><span class="id"> have</span><span class="id"> [r0|r0]</span><span class="id"> :=</span><span class="id"> ltP</span><span class="id"> r</span><span class="id"> 0%R</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span> ((<span class="id">ball0</span><span class="id"> _</span><span class="id"> _</span>).<span class="id">2</span> (<span class="id">ltW</span><span class="id"> r0</span>))<span class="id">//</span><span class="id"> /mu</span><span class="id"> measure0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> lebesgue_measure_ball//=</span><span class="id"> ?ltry</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="id"> apply/integrableP;</span><span class="id"> split;</span><span class="id"> first</span><span class="id"> exact/measurable_EFinP/measurable_cst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> /=</span><span class="id"> integral_cst//=;</span><span class="id"> last</span><span class="id"> exact:</span><span class="id"> measurable_ball</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">have</span><span class="id"> [r0|r0]</span><span class="id"> :=</span><span class="id"> ltP</span><span class="id"> r</span><span class="id"> 0%R</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span> ((<span class="id">ball0</span><span class="id"> _</span><span class="id"> _</span>).<span class="id">2</span> (<span class="id">ltW</span><span class="id"> r0</span>))<span class="id">//</span><span class="id"> /mu</span><span class="id"> measure0</span><span class="id"> mule0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> lebesgue_measure_ball//=</span><span class="id"> ?ltry</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> integral_indic//=;</span><span class="id"> last</span><span class="id"> exact:</span><span class="id"> measurable_ball</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -/mu</span><span class="id"> integral_cst//;</span><span class="id"> exact:</span><span class="id"> measurable_ball</span>.<br/>
<span class="id">rewrite</span><span class="id"> indicE;</span><span class="id"> have</span><span class="id"> [xA</span><span class="id"> xrA0|xA]</span><span class="id"> :=</span><span class="id"> boolP</span> (<span class="id">x</span><span class="id"> \in</span><span class="id"> A</span>)<span class="id">;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> iffRL;</span><span class="id"> apply/propeqP;</span><span class="id"> apply:</span><span class="id"> eq_cvg</span><span class="id"> =&gt;</span><span class="id"> r</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -mulNrn</span><span class="id"> mulr0n</span><span class="id"> adde0</span><span class="id"> mul0e</span><span class="id"> sube0</span><span class="id"> gee0_abs//</span><span class="id"> muleC</span>.<br/>
<span class="id">have</span><span class="id"> {xrA0}</span><span class="id"> /cvgeN</span><span class="id"> :</span> (<span class="id">fine</span> (<span class="id">mu</span> (<span class="id">ball</span><span class="id"> x</span><span class="id"> r</span>)))<span class="id">^-1%:E</span><span class="id"> *</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">mu</span> (<span class="id">ball</span><span class="id"> x</span><span class="id"> r</span>)<span class="id"> -</span><span class="id"> mu</span> (<span class="id">A</span><span class="id"> `&amp;`</span><span class="id"> ball</span><span class="id"> x</span><span class="id"> r</span>))<span class="id"> @[r</span><span class="id"> --&gt;</span><span class="id"> 0^'+]</span><span class="id"> --&gt;</span><span class="id"> 0</span>.<br/>
&nbsp;&nbsp;<span class="id">move:</span><span class="id"> xrA0;</span><span class="id"> apply:</span><span class="id"> cvg_trans;</span><span class="id"> apply:</span><span class="id"> near_eq_cvg;</span><span class="id"> near=&gt;</span><span class="id"> r</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> mul1e</span><span class="id"> lee0_abs;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> sube_le0</span><span class="id"> le_measure//</span><span class="id"> ?inE/=;</span><span class="id"> last</span><span class="id"> exact:</span><span class="id"> measurable_ball</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> measurableI</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> measurable_ball</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> oppeB//;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> addeC</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> fin_num_adde_defl//</span><span class="id"> fin_numN</span><span class="id"> ge0_fin_numE//</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> lebesgue_measure_ball//</span><span class="id"> ltry</span>.<br/>
<span class="id">rewrite</span><span class="id"> oppe0;</span><span class="id"> apply:</span><span class="id"> cvg_trans;</span><span class="id"> apply:</span><span class="id"> near_eq_cvg;</span><span class="id"> near=&gt;</span><span class="id"> r</span>.<br/>
<span class="id">rewrite</span><span class="id"> -mulNrn</span><span class="id"> mulr1n</span><span class="id"> muleBr//;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> fin_num_adde_defr//</span><span class="id"> ge0_fin_numE//</span><span class="id"> lebesgue_measure_ball//=</span><span class="id"> ?ltry</span>.<br/>
<span class="id">rewrite</span> (_<span class="id"> :</span> (<span class="id">fine</span> (<span class="id">mu</span> (<span class="id">ball</span><span class="id"> x</span><span class="id"> r</span>)))<span class="id">^-1%:E</span><span class="id"> *</span><span class="id"> mu</span> (<span class="id">ball</span><span class="id"> x</span><span class="id"> r</span>)<span class="id"> =</span><span class="id"> 1</span>)<span class="id">;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -[X</span><span class="gallina-kwd"> in</span><span class="id"> _</span><span class="id"> *</span><span class="id"> X]</span>(<span class="id">@fineK</span><span class="id"> _</span> (<span class="id">mu</span> (<span class="id">ball</span><span class="id"> x</span><span class="id"> r</span>)))<span class="id">//;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> lebesgue_measure_ball//=</span><span class="id"> ?ltry</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -EFinM</span><span class="id"> mulVf//</span><span class="id"> lebesgue_measure_ball//=</span><span class="id"> gt_eqF//</span><span class="id"> mulrn_wgt0</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> oppeB//</span><span class="id"> addeC</span><span class="id"> EFinN</span><span class="id"> muleC</span>.<br/>
<span class="id">Unshelve</span>.<span class="id"> all:</span><span class="gallina-kwd"> by</span><span class="id"> end_near</span>. Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> density</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> nicely_shrinking</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {R</span><span class="id"> :</span><span class="id"> realType}</span>.<br/>
<span class="vernacular">Implicit</span><span class="id"> Types</span> (<span class="id">x</span><span class="id"> :</span><span class="id"> R</span>) (<span class="id">E</span><span class="id"> :</span> (<span class="id">set</span><span class="id"> R</span>)<span class="id">^nat</span>).<br/>
<span class="vernacular">Local</span><span class="vernacular"> Notation</span><span class="id"> mu</span><span class="id"> :=</span><span class="id"> lebesgue_measure</span>.<br/>
<br/>
<span class="vernacular">Definition</span><span class="id"> nicely_shrinking</span><span class="id"> x</span><span class="id"> E</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">forall</span><span class="id"> n,</span><span class="id"> measurable</span> (<span class="id">E</span><span class="id"> n</span>))<span class="id"> /\</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">exists</span><span class="id"> Cr</span><span class="id"> :</span><span class="id"> R</span><span class="id"> *</span><span class="id"> {posnum</span><span class="id"> R}^nat,</span><span class="id"> [/\</span><span class="id"> Cr</span>.<span class="id">1</span><span class="id"> &gt;</span><span class="id"> 0,</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">Cr</span>.<span class="id">2</span><span class="id"> n</span>)<span class="id">%:num</span><span class="id"> @[n</span><span class="id"> --&gt;</span><span class="id"> \oo]</span><span class="id"> --&gt;</span><span class="id"> 0,</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="gallina-kwd">forall</span><span class="id"> n,</span><span class="id"> E</span><span class="id"> n</span><span class="id"> `&lt;=`</span><span class="id"> ball</span><span class="id"> x</span> (<span class="id">Cr</span>.<span class="id">2</span><span class="id"> n</span>)<span class="id">%:num</span>)<span class="id"> &amp;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="gallina-kwd">forall</span><span class="id"> n,</span><span class="id"> mu</span> (<span class="id">ball</span><span class="id"> x</span> (<span class="id">Cr</span>.<span class="id">2</span><span class="id"> n</span>)<span class="id">%:num</span>)<span class="id"> &lt;=</span><span class="id"> Cr</span>.<span class="id">1%:E</span><span class="id"> *</span><span class="id"> mu</span> (<span class="id">E</span><span class="id"> n</span>))<span class="id">%E]</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> nicely_shrinking_gt0</span><span class="id"> x</span><span class="id"> E</span><span class="id"> :</span><span class="id"> nicely_shrinking</span><span class="id"> x</span><span class="id"> E</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">forall</span><span class="id"> n,</span> (<span class="id">0</span><span class="id"> &lt;</span><span class="id"> mu</span> (<span class="id">E</span><span class="id"> n</span>))<span class="id">%E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> [mE</span><span class="id"> [[C</span><span class="id"> r_]]]</span><span class="id"> [/=</span><span class="id"> C_gt0</span><span class="id"> _</span><span class="id"> _</span><span class="id"> +</span><span class="id"> ]</span><span class="id"> n</span><span class="id"> =&gt;</span><span class="id"> /</span>(_<span class="id"> n</span>).<br/>
<span class="id">rewrite</span><span class="id"> lebesgue_measure_ball//</span><span class="id"> -lee_pdivrMl//</span>.<br/>
<span class="id">apply:</span><span class="id"> lt_le_trans</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> mule_gt0//</span><span class="id"> lte_fin</span><span class="id"> invr_gt0</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> nicely_shrinking_lty</span><span class="id"> x</span><span class="id"> E</span><span class="id"> :</span><span class="id"> nicely_shrinking</span><span class="id"> x</span><span class="id"> E</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">forall</span><span class="id"> n,</span> (<span class="id">mu</span> (<span class="id">E</span><span class="id"> n</span>)<span class="id"> &lt;</span><span class="id"> +oo</span>)<span class="id">%E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> [mE</span><span class="id"> [[C</span><span class="id"> r_]]]</span><span class="id"> [/=</span><span class="id"> C_gt0</span><span class="id"> _</span><span class="id"> +</span><span class="id"> _]</span><span class="id"> n</span><span class="id"> =&gt;</span><span class="id"> /</span>(_<span class="id"> n</span>)<span class="id"> Er_</span>.<br/>
<span class="id">rewrite</span> (<span class="id">@le_lt_trans</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">lebesgue_measure</span> (<span class="id">ball</span><span class="id"> x</span> (<span class="id">r_</span><span class="id"> n</span>)<span class="id">%:num</span>)))<span class="id">//</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> le_measure//</span><span class="id"> inE;</span><span class="id"> [exact:</span><span class="id"> mE|exact:</span><span class="id"> measurable_ball]</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> lebesgue_measure_ball//</span><span class="id"> ltry</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> nicely_shrinking</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> nice_lebesgue_differentiation</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {R</span><span class="id"> :</span><span class="id"> realType}</span>.<br/>
<span class="vernacular">Variable</span><span class="id"> E</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span> (<span class="id">set</span><span class="id"> R</span>)<span class="id">^nat</span>.<br/>
<span class="vernacular">Hypothesis</span><span class="id"> hE</span><span class="id"> :</span><span class="gallina-kwd"> forall</span><span class="id"> x,</span><span class="id"> nicely_shrinking</span><span class="id"> x</span> (<span class="id">E</span><span class="id"> x</span>).<br/>
<span class="vernacular">Local</span><span class="vernacular"> Notation</span><span class="id"> mu</span><span class="id"> :=</span><span class="id"> lebesgue_measure</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> nice_lebesgue_differentiation</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">locally_integrable</span><span class="id"> setT</span><span class="id"> f</span><span class="id"> -&gt;</span><span class="gallina-kwd"> forall</span><span class="id"> x,</span><span class="id"> lebesgue_pt</span><span class="id"> f</span><span class="id"> x</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;(<span class="id">fine</span> (<span class="id">mu</span> (<span class="id">E</span><span class="id"> x</span><span class="id"> n</span>)))<span class="id">^-1%:E</span><span class="id"> *</span><span class="id"> \int[mu]_</span>(<span class="id">y</span><span class="gallina-kwd"> in</span><span class="id"> E</span><span class="id"> x</span><span class="id"> n</span>) (<span class="id">f</span><span class="id"> y</span>)<span class="id">%:E</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">@[n</span><span class="id"> --&gt;</span><span class="id"> \oo]</span><span class="id"> --&gt;</span> (<span class="id">f</span><span class="id"> x</span>)<span class="id">%:E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> locf</span><span class="id"> x</span><span class="id"> fx;</span><span class="id"> apply:</span> (<span class="id">cvge_sub0</span><span class="id"> _</span><span class="id"> _</span>).<span class="id">1</span><span class="id"> =&gt;</span><span class="id"> //=;</span><span class="id"> apply/cvg_abse0P</span>.<br/>
<span class="id">pose</span><span class="id"> r_</span><span class="id"> x</span><span class="id"> :</span><span class="id"> {posnum</span><span class="id"> R}</span><span class="id"> ^nat</span><span class="id"> :=</span> (<span class="id">sval</span> (<span class="id">cid</span> (<span class="id">hE</span><span class="id"> x</span>).<span class="id">2</span>)).<span class="id">2</span>.<br/>
<span class="id">pose</span><span class="id"> C</span><span class="id"> :=</span> (<span class="id">sval</span> (<span class="id">cid</span> (<span class="id">hE</span><span class="id"> x</span>).<span class="id">2</span>)).<span class="id">1</span>.<br/>
<span class="id">have</span><span class="id"> C_gt0</span><span class="id"> :</span> (<span class="id">0</span><span class="id"> &lt;</span><span class="id"> C</span>)<span class="id">%R</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> /C</span><span class="id"> /sval/=;</span><span class="id"> case:</span><span class="id"> cid</span><span class="id"> =&gt;</span><span class="id"> -[?</span><span class="id"> ?]</span><span class="id"> []</span>.<br/>
<span class="id">have</span><span class="id"> r_0</span><span class="id"> y</span><span class="id"> :</span> (<span class="id">r_</span><span class="id"> y</span><span class="id"> n</span>)<span class="id">%:num</span><span class="id"> @[n</span><span class="id"> --&gt;</span><span class="id"> \oo]</span><span class="id"> --&gt;</span> (<span class="id">0%R</span><span class="id"> :</span><span class="id"> R</span>).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /r_</span><span class="id"> /sval/=;</span><span class="id"> case:</span><span class="id"> cid</span><span class="id"> =&gt;</span><span class="id"> -[?</span><span class="id"> ?]</span><span class="id"> []</span>.<br/>
<span class="id">have</span><span class="id"> E_r_</span><span class="id"> n</span><span class="id"> :</span><span class="id"> E</span><span class="id"> x</span><span class="id"> n</span><span class="id"> `&lt;=`</span><span class="id"> ball</span><span class="id"> x</span> (<span class="id">r_</span><span class="id"> x</span><span class="id"> n</span>)<span class="id">%:num</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /r_</span><span class="id"> /sval/=;</span><span class="id"> case:</span><span class="id"> cid</span><span class="id"> =&gt;</span><span class="id"> -[?</span><span class="id"> ?]</span><span class="id"> []</span>.<br/>
<span class="id">have</span><span class="id"> muEr_</span><span class="id"> n</span><span class="id"> :</span><span class="id"> mu</span> (<span class="id">ball</span><span class="id"> x</span> (<span class="id">r_</span><span class="id"> x</span><span class="id"> n</span>)<span class="id">%:num</span>)<span class="id"> &lt;=</span><span class="id"> C%:E</span><span class="id"> *</span><span class="id"> mu</span> (<span class="id">E</span><span class="id"> x</span><span class="id"> n</span>).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /C</span><span class="id"> /r_</span><span class="id"> /sval/=;</span><span class="id"> case:</span><span class="id"> cid</span><span class="id"> =&gt;</span><span class="id"> -[?</span><span class="id"> ?]</span><span class="id"> []</span>.<br/>
<span class="id">apply:</span> (<span class="id">@squeeze_cvge</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">cst</span><span class="id"> 0</span>)<span class="id"> _</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">fun</span><span class="id"> n</span><span class="id"> =&gt;</span><span class="id"> C%:E</span><span class="id"> *</span><span class="id"> davg</span><span class="id"> f</span><span class="id"> x</span> (<span class="id">r_</span><span class="id"> x</span><span class="id"> n</span>)<span class="id">%:num</span>))<span class="id">;</span><span class="id"> last</span><span class="id"> 2</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> cvg_cst</span>.<br/>
&nbsp;&nbsp;<span class="id">move/cvge_at_rightP:</span><span class="id"> fx</span><span class="id"> =&gt;</span><span class="id"> /</span>(_ (<span class="gallina-kwd">fun</span><span class="id"> r</span><span class="id"> =&gt;</span> (<span class="id">r_</span><span class="id"> x</span><span class="id"> r</span>)<span class="id">%:num</span>))<span class="id"> fx</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -</span>(<span class="id">mule0</span><span class="id"> C%:E</span>)<span class="id">;</span><span class="id"> apply:</span><span class="id"> cvgeM</span><span class="id"> =&gt;</span><span class="id"> //;[exact:</span><span class="id"> mule_def_fin</span><span class="id"> |</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> cvg_cst</span><span class="id"> |</span><span class="id"> apply:</span><span class="id"> fx;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> r_0]</span>.<br/>
<span class="id">near=&gt;</span><span class="id"> n</span>.<br/>
<span class="id">apply/andP;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //=</span>.<br/>
<span class="id">apply:</span> (<span class="id">@le_trans</span><span class="id"> _</span><span class="id"> _</span> ((<span class="id">fine</span> (<span class="id">mu</span> (<span class="id">E</span><span class="id"> x</span><span class="id"> n</span>)))<span class="id">^-1%:E</span><span class="id"> *</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">`|</span><span class="id"> \int[mu]_</span>(<span class="id">y</span><span class="gallina-kwd"> in</span><span class="id"> E</span><span class="id"> x</span><span class="id"> n</span>) ((<span class="id">f</span><span class="id"> y</span>)<span class="id">%:E</span><span class="id"> +</span> (<span class="id">-</span><span class="id"> f</span><span class="id"> x</span>)<span class="id">%:E</span>)<span class="id"> |</span>)).<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> fxE</span><span class="id"> :</span> (<span class="id">-</span><span class="id"> f</span><span class="id"> x</span>)<span class="id">%:E</span><span class="id"> =</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">fine</span> (<span class="id">mu</span> (<span class="id">E</span><span class="id"> x</span><span class="id"> n</span>)))<span class="id">^-1%:E</span><span class="id"> *</span><span class="id"> \int[mu]_</span>(<span class="id">y</span><span class="gallina-kwd"> in</span><span class="id"> E</span><span class="id"> x</span><span class="id"> n</span>) (<span class="id">-</span><span class="id"> f</span><span class="id"> x</span>)<span class="id">%:E</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> integral_cst//=;</span><span class="id"> last</span><span class="id"> exact:</span> (<span class="id">hE</span><span class="id"> _</span>).<span class="id">1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> muleCA</span><span class="id"> -[X</span><span class="gallina-kwd"> in</span><span class="id"> _</span><span class="id"> *</span> (_<span class="id"> *</span><span class="id"> X</span>)<span class="id">]</span>(<span class="id">@fineK</span><span class="id"> _</span> (<span class="id">mu</span> (<span class="id">E</span><span class="id"> x</span><span class="id"> n</span>)))<span class="id">;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> ge0_fin_numE//</span> (<span class="id">nicely_shrinking_lty</span> (<span class="id">hE</span><span class="id"> x</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -EFinM</span><span class="id"> mulVf</span><span class="id"> ?mulr1//</span><span class="id"> neq_lt</span><span class="id"> fine_gt0</span><span class="id"> ?orbT//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span> (<span class="id">nicely_shrinking_gt0</span> (<span class="id">hE</span><span class="id"> x</span>))<span class="id">//=</span> (<span class="id">nicely_shrinking_lty</span> (<span class="id">hE</span><span class="id"> x</span>)).<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> [in</span><span class="id"> leLHS]fxE</span><span class="id"> -muleDr//;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> integral_cst//=;</span><span class="id"> last</span><span class="id"> exact:</span> (<span class="id">hE</span><span class="id"> _</span>).<span class="id">1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> fin_num_adde_defl//</span><span class="id"> fin_numM//</span><span class="id"> gt0_fin_numE</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span> (<span class="id">nicely_shrinking_lty</span> (<span class="id">hE</span><span class="id"> x</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span> (<span class="id">nicely_shrinking_gt0</span> (<span class="id">hE</span><span class="id"> x</span>)).<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> abseM</span><span class="id"> gee0_abs;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> lee_fin//</span><span class="id"> invr_ge0//</span><span class="id"> fine_ge0</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> lee_pmul//;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> lee_fin//</span><span class="id"> invr_ge0//</span><span class="id"> fine_ge0</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> integralD//=</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> exact:</span> (<span class="id">hE</span><span class="id"> x</span>).<span class="id">1</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> apply/integrableP;</span><span class="id"> split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply/measurable_EFinP;</span><span class="id"> case:</span><span class="id"> locf</span><span class="id"> =&gt;</span><span class="id"> +</span><span class="id"> _</span><span class="id"> _;</span><span class="id"> exact:</span><span class="id"> measurable_funS</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> (<span class="id">@le_lt_trans</span><span class="id"> _</span><span class="id"> _</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">\int[mu]_</span>(<span class="id">y</span><span class="gallina-kwd"> in</span><span class="id"> closed_ball</span><span class="id"> x</span> (<span class="id">r_</span><span class="id"> x</span><span class="id"> n</span>)<span class="id">%:num</span>)<span class="id"> `|</span>(<span class="id">f</span><span class="id"> y</span>)<span class="id">%:E|</span>))<span class="id">//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> ge0_subset_integral</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">+</span><span class="id"> exact:</span> (<span class="id">hE</span><span class="id"> _</span>).<span class="id">1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">+</span><span class="id"> exact:</span><span class="id"> measurable_closed_ball</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">+</span><span class="id"> apply:</span><span class="id"> measurableT_comp</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> apply/measurable_EFinP</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> case:</span><span class="id"> locf</span><span class="id"> =&gt;</span><span class="id"> +</span><span class="id"> _</span><span class="id"> _;</span><span class="id"> exact:</span><span class="id"> measurable_funS</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span> (<span class="id">subset_trans</span> (<span class="id">E_r_</span><span class="id"> n</span>))<span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> subset_closed_ball</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> case:</span><span class="id"> locf</span><span class="id"> =&gt;</span><span class="id"> _</span><span class="id"> _;</span><span class="id"> apply</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> closed_ballR_compact</span>.<br/>
&nbsp;&nbsp;<span class="id">apply/integrableP;</span><span class="id"> split;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> measurable_cst</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> integral_cst</span><span class="id"> //=;</span><span class="id"> last</span><span class="id"> exact:</span> (<span class="id">hE</span><span class="id"> _</span>).<span class="id">1</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> lte_mul_pinfty//</span> (<span class="id">nicely_shrinking_lty</span> (<span class="id">hE</span><span class="id"> x</span>)).<br/>
<span class="id">rewrite</span><span class="id"> muleA</span><span class="id"> lee_pmul//</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> lee_fin</span><span class="id"> invr_ge0//</span><span class="id"> fine_ge0</span>.<br/>
<span class="id">-</span><span class="id"> rewrite</span><span class="id"> -</span>(<span class="id">@invrK</span><span class="id"> _</span><span class="id"> C</span>)<span class="id"> -EFinM</span><span class="id"> -invfM</span><span class="id"> lee_fin</span><span class="id"> lef_pV2//;</span><span class="id"> last</span><span class="id"> 2</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> posrE</span><span class="id"> fine_gt0//</span> (<span class="id">nicely_shrinking_gt0</span> (<span class="id">hE</span><span class="id"> x</span>))<span class="id">//=</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span> (<span class="id">nicely_shrinking_lty</span> (<span class="id">hE</span><span class="id"> x</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> posrE</span><span class="id"> mulr_gt0//</span><span class="id"> ?invr_gt0//</span><span class="id"> fine_gt0//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> lebesgue_measure_ball//</span><span class="id"> ltry</span><span class="id"> andbT</span><span class="id"> lte_fin</span><span class="id"> mulrn_wgt0</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> lter_pdivrMl</span><span class="id"> //</span><span class="id"> -lee_fin</span><span class="id"> EFinM</span><span class="id"> fineK;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> lebesgue_measure_ball//</span><span class="id"> ltry</span><span class="id"> andbT</span><span class="id"> lte_fin</span><span class="id"> mulrn_wgt0</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> fineK;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> ge0_fin_numE//</span> (<span class="id">nicely_shrinking_lty</span> (<span class="id">hE</span><span class="id"> x</span>)).<br/>
&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> muEr_</span>.<br/>
<span class="id">-</span><span class="id"> apply:</span><span class="id"> le_trans</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="id"> apply:</span><span class="id"> le_abse_integral</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> first</span><span class="id"> exact:</span> (<span class="id">hE</span><span class="id"> x</span>).<span class="id">1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply/measurable_EFinP;</span><span class="id"> apply/measurable_funB</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> case:</span><span class="id"> locf</span><span class="id"> =&gt;</span><span class="id"> +</span><span class="id"> _</span><span class="id"> _;</span><span class="id"> exact:</span><span class="id"> measurable_funS</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="id"> apply:</span><span class="id"> ge0_subset_integral</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> first</span><span class="id"> exact:</span> (<span class="id">hE</span><span class="id"> x</span>).<span class="id">1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> measurable_ball</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="id"> apply/measurable_EFinP;</span><span class="id"> apply:</span><span class="id"> measurableT_comp</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply/measurable_funB</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> case:</span><span class="id"> locf</span><span class="id"> =&gt;</span><span class="id"> +</span><span class="id"> _</span><span class="id"> _;</span><span class="id"> exact:</span><span class="id"> measurable_funS</span>.<br/>
<span class="id">Unshelve</span>.<span class="id"> all:</span><span class="gallina-kwd"> by</span><span class="id"> end_near</span>. Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> nice_lebesgue_differentiation</span>.<br/>

      <div class="footer"><hr/>Generated by <a href="https://github.com/yoshihiro503/coq2html/">a fork of coq2html</a></div>
    </div>
  </div>
    </main>
</body>
</html>
