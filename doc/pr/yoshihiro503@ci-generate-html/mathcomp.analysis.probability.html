
<!DOCTYPE html>
<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Module mathcomp.analysis.probability</title>
<meta name="description" content="Documentation of Coq module mathcomp.analysis.probability" />
<link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.css">
<script src="https://cdn.jsdelivr.net/npm/markdown-it/dist/markdown-it.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/markdown-it-texmath/texmath.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/darkmode-js@1.5.7/lib/darkmode-js.min.js"></script>
<link href="coq2html.css" rel="stylesheet" type="text/css" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script type="text/javascript" src="coq2html.js"> </script>
</head>

<body onload="init()">

  <main>
    <div class="sidebar">
      <h2>Files</h2>
      
    </div>

  <div class="coq">

    <div class="content">
      <p><a href="./index.html">Top</a></p>
      <h1 class="title">Module mathcomp.analysis.probability</h1>
<span class="vernacular">From</span><span class="id"> mathcomp</span><span class="vernacular"> Require</span><span class="vernacular"> Import</span><span class="id"> all_ssreflect</span>.<br/>
<span class="vernacular">From</span><span class="id"> mathcomp</span><span class="vernacular"> Require</span><span class="vernacular"> Import</span><span class="id"> ssralg</span><span class="id"> poly</span><span class="id"> ssrnum</span><span class="id"> ssrint</span><span class="id"> interval</span><span class="id"> finmap</span>.<br/>
<span class="vernacular">From</span><span class="id"> mathcomp</span><span class="vernacular"> Require</span><span class="vernacular"> Import</span><span class="id"> mathcomp_extra</span><span class="id"> boolp</span><span class="id"> classical_sets</span><span class="id"> functions</span>.<br/>
<span class="vernacular">From</span><span class="id"> mathcomp</span><span class="vernacular"> Require</span><span class="vernacular"> Import</span><span class="id"> cardinality</span><span class="id"> fsbigop</span>.<br/>
<span class="vernacular">From</span><span class="id"> HB</span><span class="vernacular"> Require</span><span class="vernacular"> Import</span><span class="id"> structures</span>.<br/>
<span class="vernacular">From</span><span class="id"> mathcomp</span><span class="vernacular"> Require</span><span class="vernacular"> Import</span><span class="id"> exp</span><span class="id"> numfun</span><span class="id"> lebesgue_measure</span><span class="id"> lebesgue_integral</span>.<br/>
<span class="vernacular">From</span><span class="id"> mathcomp</span><span class="vernacular"> Require</span><span class="vernacular"> Import</span><span class="id"> reals</span><span class="id"> ereal</span><span class="id"> signed</span><span class="id"> topology</span><span class="id"> normedtype</span><span class="id"> sequences</span>.<br/>
<span class="vernacular">From</span><span class="id"> mathcomp</span><span class="vernacular"> Require</span><span class="vernacular"> Import</span><span class="id"> esum</span><span class="id"> measure</span><span class="id"> exp</span><span class="id"> numfun</span><span class="id"> lebesgue_measure</span>.<br/>
<span class="vernacular">From</span><span class="id"> mathcomp</span><span class="vernacular"> Require</span><span class="vernacular"> Import</span><span class="id"> lebesgue_integral</span><span class="id"> kernel</span>.<br/>
<br/>
<div class="ssrdoc md">
# Probability

This file provides basic notions of probability theory. See measure.v for
the type probability T R (a measure that sums to 1).

```
        {RV P &gt;-&gt; R} == real random variable: a measurable function from
                        the measurableType of the probability P to R
    distribution P X == measure image of the probability measure P by the
                        random variable X : {RV P -&gt; R}
                        P as type probability T R with T of type
                        measurableType.
                        Declared as an instance of probability measure.
             'E_P[X] == expectation of the real measurable function X
      covariance X Y == covariance between real random variable X and Y
             'V_P[X] == variance of the real random variable X
       mmt_gen_fun X == moment generating function of the random variable
                        X
     {dmfun T &gt;-&gt; R} == type of discrete real-valued measurable functions
       {dRV P &gt;-&gt; R} == real-valued discrete random variable
           dRV_dom X == domain of the discrete random variable X
          dRV_enum X == bijection between the domain and the range of X
            pmf X r := fine (P (X @^-1` [set r]))
       enum_prob X k == probability of the kth value in the range of X
```

```
     bernoulli_pmf p == Bernoulli pmf
         bernoulli p == Bernoulli probability measure when 0 &lt;= p &lt;= 1
                        and \d_false otherwise
    binomial_pmf n p == binomial pmf
   binomial_prob n p == binomial probability measure when 0 &lt;= p &lt;= 1
                        and \d_0%N otherwise
      bin_prob n k p == $\binom{n}{k}p^k (1-p)^(n-k)$
                        Computes a binomial distribution term for
                        k successes in n trials with success rate p
     uniform_pdf a b == uniform pdf
 uniform_prob a b ab == uniform probability over the interval [a,b]
                        with ab0 a proof that 0 &lt; b - a
```

</div>
<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;'{' 'RV' P &gt;-&gt; R '}'&quot;</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">at</span><span class="id"> level</span><span class="id"> 0,</span><span class="id"> format</span> <span class="id">&quot;'{' 'RV'  P  '&gt;-&gt;'  R '}'&quot;</span>).<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;''E_' P [ X ]&quot;</span> (<span class="id">format</span> <span class="id">&quot;''E_' P [ X ]&quot;</span><span class="id">,</span><span class="gallina-kwd"> at</span><span class="id"> level</span><span class="id"> 5</span>).<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;''V_' P [ X ]&quot;</span> (<span class="id">format</span> <span class="id">&quot;''V_' P [ X ]&quot;</span><span class="id">,</span><span class="gallina-kwd"> at</span><span class="id"> level</span><span class="id"> 5</span>).<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;{ 'dmfun' aT &gt;-&gt; T }&quot;</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">at</span><span class="id"> level</span><span class="id"> 0,</span><span class="id"> format</span> <span class="id">&quot;{ 'dmfun'  aT  &gt;-&gt;  T }&quot;</span>).<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;'{' 'dRV' P &gt;-&gt; R '}'&quot;</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">at</span><span class="id"> level</span><span class="id"> 0,</span><span class="id"> format</span> <span class="id">&quot;'{' 'dRV'  P  '&gt;-&gt;'  R '}'&quot;</span>).<br/>
<br/>
<span class="gallina-kwd">Set</span><span class="vernacular"> Implicit</span><span class="vernacular"> Arguments</span>.<br/>
<span class="vernacular">Unset</span><span class="vernacular"> Strict</span><span class="vernacular"> Implicit</span>.<br/>
<span class="vernacular">Unset</span><span class="vernacular"> Printing</span><span class="vernacular"> Implicit</span><span class="vernacular"> Defensive</span>.<br/>
<br/>
<span class="vernacular">Import</span><span class="id"> Order</span>.<span class="id">TTheory</span><span class="id"> GRing</span>.<span class="id">Theory</span><span class="id"> Num</span>.<span class="id">Def</span><span class="id"> Num</span>.<span class="id">Theory</span>.<br/>
<span class="vernacular">Import</span><span class="id"> numFieldTopology</span>.<span class="vernacular">Exports</span>.<br/>
<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> classical_set_scope</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ring_scope</span>.<br/>
<br/>
<span class="vernacular">Definition</span><span class="id"> random_variable</span> (<span class="id">d</span><span class="id"> :</span><span class="id"> _</span>) (<span class="id">T</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>)<br/>
&nbsp;&nbsp;(<span class="id">P</span><span class="id"> :</span><span class="id"> probability</span><span class="id"> T</span><span class="id"> R</span>)<span class="id"> :=</span><span class="id"> {mfun</span><span class="id"> T</span><span class="id"> &gt;-&gt;</span><span class="id"> R}</span>.<br/>
<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;{ 'RV' P &gt;-&gt; R }&quot;</span><span class="id"> :=</span> (<span class="id">@random_variable</span><span class="id"> _</span><span class="id"> _</span><span class="id"> R</span><span class="id"> P</span>)<span class="id"> :</span><span class="id"> form_scope</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> notin_range_measure</span><span class="id"> d</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">P</span><span class="id"> :</span><span class="id"> {measure</span><span class="id"> set</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R}</span>) (<span class="id">X</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> R</span>)<span class="id"> r</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">r</span><span class="id"> \notin</span><span class="id"> range</span><span class="id"> X</span><span class="id"> -&gt;</span><span class="id"> P</span> (<span class="id">X</span><span class="id"> @^-1`</span><span class="id"> [set</span><span class="id"> r]</span>)<span class="id"> =</span><span class="id"> 0%E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> notin_setE</span><span class="id"> =&gt;</span><span class="id"> hr;</span><span class="id"> rewrite</span><span class="id"> preimage10</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> probability_range</span><span class="id"> d</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>)<br/>
&nbsp;&nbsp;(<span class="id">P</span><span class="id"> :</span><span class="id"> probability</span><span class="id"> T</span><span class="id"> R</span>) (<span class="id">X</span><span class="id"> :</span><span class="id"> {RV</span><span class="id"> P</span><span class="id"> &gt;-&gt;</span><span class="id"> R}</span>)<span class="id"> :</span><span class="id"> P</span> (<span class="id">X</span><span class="id"> @^-1`</span><span class="id"> range</span><span class="id"> X</span>)<span class="id"> =</span><span class="id"> 1%E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> preimage_range</span><span class="id"> probability_setT</span>. Qed.</div></details>
<br/>
<span class="vernacular">Definition</span><span class="id"> distribution</span><span class="id"> d</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">P</span><span class="id"> :</span><span class="id"> probability</span><span class="id"> T</span><span class="id"> R</span>) (<span class="id">X</span><span class="id"> :</span><span class="id"> {mfun</span><span class="id"> T</span><span class="id"> &gt;-&gt;</span><span class="id"> R}</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">pushforward</span><span class="id"> P</span> (<span class="id">@measurable_funP</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> X</span>).<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> distribution_is_probability</span>.<br/>
<span class="vernacular">Context</span><span class="id"> d</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>) (<span class="id">P</span><span class="id"> :</span><span class="id"> probability</span><span class="id"> T</span><span class="id"> R</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">X</span><span class="id"> :</span><span class="id"> {mfun</span><span class="id"> T</span><span class="id"> &gt;-&gt;</span><span class="id"> R}</span>).<br/>
<br/>
<span class="vernacular">Let</span><span class="id"> distribution0</span><span class="id"> :</span><span class="id"> distribution</span><span class="id"> P</span><span class="id"> X</span><span class="id"> set0</span><span class="id"> =</span><span class="id"> 0%E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id"> exact:</span><span class="id"> measure0</span>. Qed.</div></details>
<br/>
<span class="vernacular">Let</span><span class="id"> distribution_ge0</span><span class="id"> A</span><span class="id"> :</span> (<span class="id">0</span><span class="id"> &lt;=</span><span class="id"> distribution</span><span class="id"> P</span><span class="id"> X</span><span class="id"> A</span>)<span class="id">%E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id"> exact:</span><span class="id"> measure_ge0</span>. Qed.</div></details>
<br/>
<span class="vernacular">Let</span><span class="id"> distribution_sigma_additive</span><span class="id"> :</span><span class="id"> semi_sigma_additive</span> (<span class="id">distribution</span><span class="id"> P</span><span class="id"> X</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id"> exact:</span><span class="id"> measure_semi_sigma_additive</span>. Qed.</div></details>
<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> isMeasure</span>.<span class="id">Build</span><span class="id"> _</span><span class="id"> _</span><span class="id"> R</span> (<span class="id">distribution</span><span class="id"> P</span><span class="id"> X</span>)<br/>
&nbsp;&nbsp;<span class="id">distribution0</span><span class="id"> distribution_ge0</span><span class="id"> distribution_sigma_additive</span>.<br/>
<br/>
<span class="vernacular">Let</span><span class="id"> distribution_is_probability</span><span class="id"> :</span><span class="id"> distribution</span><span class="id"> P</span><span class="id"> X</span><span class="id"> [set:</span><span class="id"> _]</span><span class="id"> =</span><span class="id"> 1%:E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /distribution</span><span class="id"> /=</span><span class="id"> /pushforward</span><span class="id"> /=</span><span class="id"> preimage_setT</span><span class="id"> probability_setT</span>.<br/>
Qed.</div></details>
<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> Measure_isProbability</span>.<span class="id">Build</span><span class="id"> _</span><span class="id"> _</span><span class="id"> R</span><br/>
&nbsp;&nbsp;(<span class="id">distribution</span><span class="id"> P</span><span class="id"> X</span>)<span class="id"> distribution_is_probability</span>.<br/>
<br/>
<span class="vernacular">End</span><span class="id"> distribution_is_probability</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> transfer_probability</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<span class="vernacular">Context</span><span class="id"> d</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>) (<span class="id">P</span><span class="id"> :</span><span class="id"> probability</span><span class="id"> T</span><span class="id"> R</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> probability_distribution</span> (<span class="id">X</span><span class="id"> :</span><span class="id"> {RV</span><span class="id"> P</span><span class="id"> &gt;-&gt;</span><span class="id"> R}</span>)<span class="id"> r</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">P</span><span class="id"> [set</span><span class="id"> x</span><span class="id"> |</span><span class="id"> X</span><span class="id"> x</span><span class="id"> =</span><span class="id"> r]</span><span class="id"> =</span><span class="id"> distribution</span><span class="id"> P</span><span class="id"> X</span><span class="id"> [set</span><span class="id"> r]</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> []</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> integral_distribution</span> (<span class="id">X</span><span class="id"> :</span><span class="id"> {RV</span><span class="id"> P</span><span class="id"> &gt;-&gt;</span><span class="id"> R}</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">measurable_fun</span><span class="id"> [set:</span><span class="id"> R]</span><span class="id"> f</span><span class="id"> -&gt;</span> (<span class="gallina-kwd">forall</span><span class="id"> y,</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> f</span><span class="id"> y</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">\int[distribution</span><span class="id"> P</span><span class="id"> X]_y</span><span class="id"> f</span><span class="id"> y</span><span class="id"> =</span><span class="id"> \int[P]_x</span> (<span class="id">f</span><span class="id"> \o</span><span class="id"> X</span>)<span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> mf</span><span class="id"> f0;</span><span class="id"> rewrite</span><span class="id"> ge0_integral_pushforward</span>. Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> transfer_probability</span>.<br/>
<br/>
<span class="id">HB</span>.<span class="id">lock</span><span class="vernacular"> Definition</span><span class="id"> expectation</span><span class="id"> {d}</span><span class="id"> {T</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d}</span><span class="id"> {R</span><span class="id"> :</span><span class="id"> realType}</span><br/>
&nbsp;&nbsp;(<span class="id">P</span><span class="id"> :</span><span class="id"> probability</span><span class="id"> T</span><span class="id"> R</span>) (<span class="id">X</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> R</span>)<span class="id"> :=</span> (<span class="id">\int[P]_w</span> (<span class="id">X</span><span class="id"> w</span>)<span class="id">%:E</span>)<span class="id">%E</span>.<br/>
<span class="vernacular">Canonical</span><span class="id"> expectation_unlockable</span><span class="id"> :=</span><span class="id"> Unlockable</span><span class="id"> expectation</span>.<span class="id">unlock</span>.<br/>
<span class="vernacular">Arguments</span><span class="id"> expectation</span><span class="id"> {d</span><span class="id"> T</span><span class="id"> R}</span><span class="id"> P</span><span class="id"> _%_R</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;''E_' P [ X ]&quot;</span><span class="id"> :=</span> (<span class="id">@expectation</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> P</span><span class="id"> X</span>)<span class="id"> :</span><span class="id"> ereal_scope</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> expectation_lemmas</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<span class="vernacular">Context</span><span class="id"> d</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>) (<span class="id">P</span><span class="id"> :</span><span class="id"> probability</span><span class="id"> T</span><span class="id"> R</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> expectation_fin_num</span> (<span class="id">X</span><span class="id"> :</span><span class="id"> {RV</span><span class="id"> P</span><span class="id"> &gt;-&gt;</span><span class="id"> R}</span>)<span class="id"> :</span><span class="id"> P</span>.<span class="id">-integrable</span><span class="id"> setT</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> X</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">'E_P[X]</span><span class="id"> \is</span><span class="id"> a</span><span class="id"> fin_num</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> ?;</span><span class="id"> rewrite</span><span class="id"> unlock</span><span class="id"> integral_fune_fin_num</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> expectation_cst</span><span class="id"> r</span><span class="id"> :</span><span class="id"> 'E_P[cst</span><span class="id"> r]</span><span class="id"> =</span><span class="id"> r%:E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> unlock/=</span><span class="id"> integral_cst//=</span><span class="id"> probability_setT</span><span class="id"> mule1</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> expectation_indic</span> (<span class="id">A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T</span>) (<span class="id">mA</span><span class="id"> :</span><span class="id"> measurable</span><span class="id"> A</span>)<span class="id"> :</span><span class="id"> 'E_P[\1_A]</span><span class="id"> =</span><span class="id"> P</span><span class="id"> A</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> unlock</span><span class="id"> integral_indic//</span><span class="id"> setIT</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> integrable_expectation</span> (<span class="id">X</span><span class="id"> :</span><span class="id"> {RV</span><span class="id"> P</span><span class="id"> &gt;-&gt;</span><span class="id"> R}</span>)<br/>
&nbsp;&nbsp;(<span class="id">iX</span><span class="id"> :</span><span class="id"> P</span>.<span class="id">-integrable</span><span class="id"> [set:</span><span class="id"> T]</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> X</span>))<span class="id"> :</span><span class="id"> `|</span><span class="id"> 'E_P[X]</span><span class="id"> |</span><span class="id"> &lt;</span><span class="id"> +oo</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move:</span><span class="id"> iX</span><span class="id"> =&gt;</span><span class="id"> /integrableP[?</span><span class="id"> Xoo];</span><span class="id"> rewrite</span> (<span class="id">le_lt_trans</span><span class="id"> _</span><span class="id"> Xoo</span>)<span class="id">//</span><span class="id"> unlock</span>.<br/>
<span class="id">exact:</span><span class="id"> le_trans</span> (<span class="id">le_abse_integral</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span>).<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> expectationM</span> (<span class="id">X</span><span class="id"> :</span><span class="id"> {RV</span><span class="id"> P</span><span class="id"> &gt;-&gt;</span><span class="id"> R}</span>) (<span class="id">iX</span><span class="id"> :</span><span class="id"> P</span>.<span class="id">-integrable</span><span class="id"> [set:</span><span class="id"> T]</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> X</span>))<br/>
&nbsp;&nbsp;(<span class="id">k</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span><span class="id"> 'E_P[k</span><span class="id"> \o*</span><span class="id"> X]</span><span class="id"> =</span><span class="id"> k%:E</span><span class="id"> *</span><span class="id"> 'E_P</span><span class="id"> [X]</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> unlock</span><span class="id"> muleC</span><span class="id"> -integralZr</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> expectation_ge0</span> (<span class="id">X</span><span class="id"> :</span><span class="id"> {RV</span><span class="id"> P</span><span class="id"> &gt;-&gt;</span><span class="id"> R}</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">forall</span><span class="id"> x,</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> X</span><span class="id"> x</span>)<span class="id">%R</span><span class="id"> -&gt;</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> 'E_P[X]</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> ?;</span><span class="id"> rewrite</span><span class="id"> unlock</span><span class="id"> integral_ge0//</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> lee_fin</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> expectation_le</span> (<span class="id">X</span><span class="id"> Y</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">measurable_fun</span><span class="id"> [set:</span><span class="id"> T]</span><span class="id"> X</span><span class="id"> -&gt;</span><span class="id"> measurable_fun</span><span class="id"> [set:</span><span class="id"> T]</span><span class="id"> Y</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="gallina-kwd">forall</span><span class="id"> x,</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> X</span><span class="id"> x</span>)<span class="id">%R</span><span class="id"> -&gt;</span> (<span class="gallina-kwd">forall</span><span class="id"> x,</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> Y</span><span class="id"> x</span>)<span class="id">%R</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">{ae</span><span class="id"> P,</span> (<span class="gallina-kwd">forall</span><span class="id"> x,</span><span class="id"> X</span><span class="id"> x</span><span class="id"> &lt;=</span><span class="id"> Y</span><span class="id"> x</span>)<span class="id">%R}</span><span class="id"> -&gt;</span><span class="id"> 'E_P[X]</span><span class="id"> &lt;=</span><span class="id"> 'E_P[Y]</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> mX</span><span class="id"> mY</span><span class="id"> X0</span><span class="id"> Y0</span><span class="id"> XY;</span><span class="id"> rewrite</span><span class="id"> unlock</span><span class="id"> ae_ge0_le_integral</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> t</span><span class="id"> _;</span><span class="id"> apply:</span><span class="id"> X0</span>.<br/>
<span class="id">-</span><span class="id"> exact/measurable_EFinP</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> t</span><span class="id"> _;</span><span class="id"> apply:</span><span class="id"> Y0</span>.<br/>
<span class="id">-</span><span class="id"> exact/measurable_EFinP</span>.<br/>
<span class="id">-</span><span class="id"> move:</span><span class="id"> XY</span><span class="id"> =&gt;</span><span class="id"> [N</span><span class="id"> [mN</span><span class="id"> PN</span><span class="id"> XYN]];</span><span class="gallina-kwd"> exists</span><span class="id"> N;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> t</span><span class="id"> /=</span><span class="id"> h</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> XYN</span><span class="id"> =&gt;</span><span class="id"> /=;</span><span class="id"> apply:</span><span class="id"> contra_not</span><span class="id"> h;</span><span class="id"> rewrite</span><span class="id"> lee_fin</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> expectationD</span> (<span class="id">X</span><span class="id"> Y</span><span class="id"> :</span><span class="id"> {RV</span><span class="id"> P</span><span class="id"> &gt;-&gt;</span><span class="id"> R}</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">P</span>.<span class="id">-integrable</span><span class="id"> [set:</span><span class="id"> T]</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> X</span>)<span class="id"> -&gt;</span><span class="id"> P</span>.<span class="id">-integrable</span><span class="id"> [set:</span><span class="id"> T]</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> Y</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">'E_P[X</span><span class="id"> \+</span><span class="id"> Y]</span><span class="id"> =</span><span class="id"> 'E_P[X]</span><span class="id"> +</span><span class="id"> 'E_P[Y]</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> ?</span><span class="id"> ?;</span><span class="id"> rewrite</span><span class="id"> unlock</span><span class="id"> integralD_EFin</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> expectationB</span> (<span class="id">X</span><span class="id"> Y</span><span class="id"> :</span><span class="id"> {RV</span><span class="id"> P</span><span class="id"> &gt;-&gt;</span><span class="id"> R}</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">P</span>.<span class="id">-integrable</span><span class="id"> [set:</span><span class="id"> T]</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> X</span>)<span class="id"> -&gt;</span><span class="id"> P</span>.<span class="id">-integrable</span><span class="id"> [set:</span><span class="id"> T]</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> Y</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">'E_P[X</span><span class="id"> \-</span><span class="id"> Y]</span><span class="id"> =</span><span class="id"> 'E_P[X]</span><span class="id"> -</span><span class="id"> 'E_P[Y]</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> ?</span><span class="id"> ?;</span><span class="id"> rewrite</span><span class="id"> unlock</span><span class="id"> integralB_EFin</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> expectation_sum</span> (<span class="id">X</span><span class="id"> :</span><span class="id"> seq</span><span class="id"> {RV</span><span class="id"> P</span><span class="id"> &gt;-&gt;</span><span class="id"> R}</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="gallina-kwd">forall</span><span class="id"> Xi,</span><span class="id"> Xi</span><span class="id"> \in</span><span class="id"> X</span><span class="id"> -&gt;</span><span class="id"> P</span>.<span class="id">-integrable</span><span class="id"> [set:</span><span class="id"> T]</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> Xi</span>))<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">'E_P[\sum_</span>(<span class="id">Xi</span><span class="id"> &lt;-</span><span class="id"> X</span>)<span class="id"> Xi]</span><span class="id"> =</span><span class="id"> \sum_</span>(<span class="id">Xi</span><span class="id"> &lt;-</span><span class="id"> X</span>)<span class="id"> 'E_P[Xi]</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">elim:</span><span class="id"> X</span><span class="id"> =&gt;</span><span class="id"> [|X0</span><span class="id"> X</span><span class="id"> IHX]</span><span class="id"> intX;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> !big_nil</span><span class="id"> expectation_cst</span>.<br/>
<span class="id">have</span><span class="id"> intX0</span><span class="id"> :</span><span class="id"> P</span>.<span class="id">-integrable</span><span class="id"> [set:</span><span class="id"> T]</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> X0</span>).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> intX;</span><span class="id"> rewrite</span><span class="id"> in_cons</span><span class="id"> eqxx</span>.<br/>
<span class="id">have</span><span class="id"> {}intX</span><span class="id"> Xi</span><span class="id"> :</span><span class="id"> Xi</span><span class="id"> \in</span><span class="id"> X</span><span class="id"> -&gt;</span><span class="id"> P</span>.<span class="id">-integrable</span><span class="id"> [set:</span><span class="id"> T]</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> Xi</span>).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> XiX;</span><span class="id"> apply:</span><span class="id"> intX;</span><span class="id"> rewrite</span><span class="id"> in_cons</span><span class="id"> XiX</span><span class="id"> orbT</span>.<br/>
<span class="id">rewrite</span><span class="id"> !big_cons</span><span class="id"> expectationD</span><span class="id"> ?IHX//</span> (_<span class="id"> :</span><span class="id"> _</span><span class="id"> \o</span><span class="id"> _</span><span class="id"> =</span><span class="gallina-kwd"> fun</span><span class="id"> x</span><span class="id"> =&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">\sum_</span>(<span class="id">f</span><span class="id"> &lt;-</span><span class="id"> map</span> (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> :</span><span class="id"> {RV</span><span class="id"> P</span><span class="id"> &gt;-&gt;</span><span class="id"> R}</span><span class="id"> =&gt;</span><span class="id"> EFin</span><span class="id"> \o</span><span class="id"> x</span>)<span class="id"> X</span>)<span class="id"> f</span><span class="id"> x</span>).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> integrable_sum</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> _</span><span class="id"> /mapP[h</span><span class="id"> hX</span><span class="id"> -&gt;];</span><span class="id"> exact:</span><span class="id"> intX</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply/funext</span><span class="id"> =&gt;</span><span class="id"> t/=;</span><span class="id"> rewrite</span><span class="id"> big_map</span><span class="id"> sumEFin</span><span class="id"> mfun_sum</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> expectation_lemmas</span>.<br/>
<br/>
<span class="id">HB</span>.<span class="id">lock</span><span class="vernacular"> Definition</span><span class="id"> covariance</span><span class="id"> {d}</span><span class="id"> {T</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d}</span><span class="id"> {R</span><span class="id"> :</span><span class="id"> realType}</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">P</span><span class="id"> :</span><span class="id"> probability</span><span class="id"> T</span><span class="id"> R</span>) (<span class="id">X</span><span class="id"> Y</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> R</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">'E_P[</span>(<span class="id">X</span><span class="id"> \-</span><span class="id"> cst</span> (<span class="id">fine</span><span class="id"> 'E_P[X]</span>))<span class="id"> *</span> (<span class="id">Y</span><span class="id"> \-</span><span class="id"> cst</span> (<span class="id">fine</span><span class="id"> 'E_P[Y]</span>))<span class="id">]%E</span>.<br/>
<span class="vernacular">Canonical</span><span class="id"> covariance_unlockable</span><span class="id"> :=</span><span class="id"> Unlockable</span><span class="id"> covariance</span>.<span class="id">unlock</span>.<br/>
<span class="vernacular">Arguments</span><span class="id"> covariance</span><span class="id"> {d</span><span class="id"> T</span><span class="id"> R}</span><span class="id"> P</span><span class="id"> _%_R</span><span class="id"> _%_R</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> covariance_lemmas</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<span class="vernacular">Context</span><span class="id"> d</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>) (<span class="id">P</span><span class="id"> :</span><span class="id"> probability</span><span class="id"> T</span><span class="id"> R</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> covarianceE</span> (<span class="id">X</span><span class="id"> Y</span><span class="id"> :</span><span class="id"> {RV</span><span class="id"> P</span><span class="id"> &gt;-&gt;</span><span class="id"> R}</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">P</span>.<span class="id">-integrable</span><span class="id"> setT</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> X</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">P</span>.<span class="id">-integrable</span><span class="id"> setT</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> Y</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">P</span>.<span class="id">-integrable</span><span class="id"> setT</span> (<span class="id">EFin</span><span class="id"> \o</span> (<span class="id">X</span><span class="id"> *</span><span class="id"> Y</span>)<span class="id">%R</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">covariance</span><span class="id"> P</span><span class="id"> X</span><span class="id"> Y</span><span class="id"> =</span><span class="id"> 'E_P[X</span><span class="id"> *</span><span class="id"> Y]</span><span class="id"> -</span><span class="id"> 'E_P[X]</span><span class="id"> *</span><span class="id"> 'E_P[Y]</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> X1</span><span class="id"> Y1</span><span class="id"> XY1</span>.<br/>
<span class="id">have</span><span class="id"> ?</span><span class="id"> :</span><span class="id"> 'E_P[X]</span><span class="id"> \is</span><span class="id"> a</span><span class="id"> fin_num</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> fin_num_abs//</span><span class="id"> integrable_expectation</span>.<br/>
<span class="id">have</span><span class="id"> ?</span><span class="id"> :</span><span class="id"> 'E_P[Y]</span><span class="id"> \is</span><span class="id"> a</span><span class="id"> fin_num</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> fin_num_abs//</span><span class="id"> integrable_expectation</span>.<br/>
<span class="id">rewrite</span><span class="id"> unlock</span><span class="id"> [X</span><span class="gallina-kwd"> in</span><span class="id"> 'E_P[X]]</span>(_<span class="id"> :</span><span class="id"> _</span><span class="id"> =</span> (<span class="id">X</span><span class="id"> \*</span><span class="id"> Y</span><span class="id"> \-</span><span class="id"> fine</span><span class="id"> 'E_P[X]</span><span class="id"> \o*</span><span class="id"> Y</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">\-</span><span class="id"> fine</span><span class="id"> 'E_P[Y]</span><span class="id"> \o*</span><span class="id"> X</span><span class="id"> \+</span><span class="id"> fine</span> (<span class="id">'E_P[X]</span><span class="id"> *</span><span class="id"> 'E_P[Y]</span>)<span class="id"> \o*</span><span class="id"> cst</span><span class="id"> 1</span>)<span class="id">%R</span>)<span class="id">;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">apply/funeqP</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> mulrDr</span><span class="id"> !mulrDl/=</span><span class="id"> mul1r</span><span class="id"> fineM//</span><span class="id"> mulrNN</span><span class="id"> addrA</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> mulrN</span><span class="id"> mulNr</span><span class="id"> [Z</span><span class="gallina-kwd"> in</span> (<span class="id">X</span><span class="id"> x</span><span class="id"> *</span><span class="id"> Y</span><span class="id"> x</span><span class="id"> -</span><span class="id"> Z</span>)<span class="id">%R]mulrC</span>.<br/>
<span class="id">have</span><span class="id"> ?</span><span class="id"> :</span><span class="id"> P</span>.<span class="id">-integrable</span><span class="id"> [set:</span><span class="id"> T]</span> (<span class="id">EFin</span><span class="id"> \o</span> (<span class="id">X</span><span class="id"> \*</span><span class="id"> Y</span><span class="id"> \-</span><span class="id"> fine</span><span class="id"> 'E_P[X]</span><span class="id"> \o*</span><span class="id"> Y</span>)<span class="id">%R</span>).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> compreBr</span><span class="id"> ?integrableB//</span><span class="id"> compre_scale</span><span class="id"> ?integrableZl</span>.<br/>
<span class="id">rewrite</span><span class="id"> expectationD/=;</span><span class="id"> last</span><span class="id"> 2</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> compreBr//</span><span class="id"> integrableB//</span><span class="id"> compre_scale</span><span class="id"> ?integrableZl</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> compre_scale//</span><span class="id"> integrableZl//</span><span class="id"> finite_measure_integrable_cst</span>.<br/>
<span class="id">rewrite</span><span class="id"> 2?expectationB//=</span><span class="id"> ?compre_scale//</span><span class="id"> ?integrableZl//</span>.<br/>
<span class="id">rewrite</span><span class="id"> 3?expectationM//=</span><span class="id"> ?finite_measure_integrable_cst//</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> expectation_cst</span><span class="id"> mule1</span><span class="id"> fineM//</span><span class="id"> EFinM</span><span class="id"> !fineK//</span><span class="id"> muleC</span><span class="id"> subeK</span><span class="id"> ?fin_numM</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> covarianceC</span> (<span class="id">X</span><span class="id"> Y</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> R</span>)<span class="id"> :</span><span class="id"> covariance</span><span class="id"> P</span><span class="id"> X</span><span class="id"> Y</span><span class="id"> =</span><span class="id"> covariance</span><span class="id"> P</span><span class="id"> Y</span><span class="id"> X</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> unlock;</span><span class="id"> congr</span><span class="id"> expectation;</span><span class="id"> apply/funeqP</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> mulrC</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> covariance_fin_num</span> (<span class="id">X</span><span class="id"> Y</span><span class="id"> :</span><span class="id"> {RV</span><span class="id"> P</span><span class="id"> &gt;-&gt;</span><span class="id"> R}</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">P</span>.<span class="id">-integrable</span><span class="id"> setT</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> X</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">P</span>.<span class="id">-integrable</span><span class="id"> setT</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> Y</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">P</span>.<span class="id">-integrable</span><span class="id"> setT</span> (<span class="id">EFin</span><span class="id"> \o</span> (<span class="id">X</span><span class="id"> *</span><span class="id"> Y</span>)<span class="id">%R</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">covariance</span><span class="id"> P</span><span class="id"> X</span><span class="id"> Y</span><span class="id"> \is</span><span class="id"> a</span><span class="id"> fin_num</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> X1</span><span class="id"> Y1</span><span class="id"> XY1;</span><span class="id"> rewrite</span><span class="id"> covarianceE//</span><span class="id"> fin_numB</span><span class="id"> fin_numM</span><span class="id"> expectation_fin_num</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> covariance_cst_l</span><span class="id"> c</span> (<span class="id">X</span><span class="id"> :</span><span class="id"> {RV</span><span class="id"> P</span><span class="id"> &gt;-&gt;</span><span class="id"> R}</span>)<span class="id"> :</span><span class="id"> covariance</span><span class="id"> P</span> (<span class="id">cst</span><span class="id"> c</span>)<span class="id"> X</span><span class="id"> =</span><span class="id"> 0</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> unlock</span><span class="id"> expectation_cst/=</span>.<br/>
<span class="id">rewrite</span><span class="id"> [X</span><span class="gallina-kwd"> in</span><span class="id"> 'E_P[X]]</span>(_<span class="id"> :</span><span class="id"> _</span><span class="id"> =</span><span class="id"> cst</span><span class="id"> 0%R</span>)<span class="id"> ?expectation_cst//</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply/funeqP</span><span class="id"> =&gt;</span><span class="id"> x;</span><span class="id"> rewrite</span><span class="id"> /GRing</span>.<span class="id">mul/=</span><span class="id"> subrr</span><span class="id"> mul0r</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> covariance_cst_r</span> (<span class="id">X</span><span class="id"> :</span><span class="id"> {RV</span><span class="id"> P</span><span class="id"> &gt;-&gt;</span><span class="id"> R}</span>)<span class="id"> c</span><span class="id"> :</span><span class="id"> covariance</span><span class="id"> P</span><span class="id"> X</span> (<span class="id">cst</span><span class="id"> c</span>)<span class="id"> =</span><span class="id"> 0</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> covarianceC</span><span class="id"> covariance_cst_l</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> covarianceZl</span><span class="id"> a</span> (<span class="id">X</span><span class="id"> Y</span><span class="id"> :</span><span class="id"> {RV</span><span class="id"> P</span><span class="id"> &gt;-&gt;</span><span class="id"> R}</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">P</span>.<span class="id">-integrable</span><span class="id"> setT</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> X</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">P</span>.<span class="id">-integrable</span><span class="id"> setT</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> Y</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">P</span>.<span class="id">-integrable</span><span class="id"> setT</span> (<span class="id">EFin</span><span class="id"> \o</span> (<span class="id">X</span><span class="id"> *</span><span class="id"> Y</span>)<span class="id">%R</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">covariance</span><span class="id"> P</span> (<span class="id">a</span><span class="id"> \o*</span><span class="id"> X</span>)<span class="id">%R</span><span class="id"> Y</span><span class="id"> =</span><span class="id"> a%:E</span><span class="id"> *</span><span class="id"> covariance</span><span class="id"> P</span><span class="id"> X</span><span class="id"> Y</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> X1</span><span class="id"> Y1</span><span class="id"> XY1</span>.<br/>
<span class="id">have</span><span class="id"> aXY</span><span class="id"> :</span> (<span class="id">a</span><span class="id"> \o*</span><span class="id"> X</span><span class="id"> *</span><span class="id"> Y</span><span class="id"> =</span><span class="id"> a</span><span class="id"> \o*</span> (<span class="id">X</span><span class="id"> *</span><span class="id"> Y</span>))<span class="id">%R</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply/funeqP</span><span class="id"> =&gt;</span><span class="id"> x;</span><span class="id"> rewrite</span><span class="id"> mulrAC</span>.<br/>
<span class="id">rewrite</span><span class="id"> [LHS]covarianceE</span><span class="id"> =&gt;</span><span class="id"> [||//|]</span><span class="id"> /=;</span><span class="id"> last</span><span class="id"> 2</span><span class="id"> first</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> compre_scale</span><span class="id"> ?integrableZl</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> aXY</span><span class="id"> compre_scale</span><span class="id"> ?integrableZl</span>.<br/>
<span class="id">rewrite</span><span class="id"> covarianceE//</span><span class="id"> aXY</span><span class="id"> !expectationM//</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -muleA</span><span class="id"> -muleBr//</span><span class="id"> fin_num_adde_defr//</span><span class="id"> expectation_fin_num</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> covarianceZr</span><span class="id"> a</span> (<span class="id">X</span><span class="id"> Y</span><span class="id"> :</span><span class="id"> {RV</span><span class="id"> P</span><span class="id"> &gt;-&gt;</span><span class="id"> R}</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">P</span>.<span class="id">-integrable</span><span class="id"> setT</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> X</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">P</span>.<span class="id">-integrable</span><span class="id"> setT</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> Y</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">P</span>.<span class="id">-integrable</span><span class="id"> setT</span> (<span class="id">EFin</span><span class="id"> \o</span> (<span class="id">X</span><span class="id"> *</span><span class="id"> Y</span>)<span class="id">%R</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">covariance</span><span class="id"> P</span><span class="id"> X</span> (<span class="id">a</span><span class="id"> \o*</span><span class="id"> Y</span>)<span class="id">%R</span><span class="id"> =</span><span class="id"> a%:E</span><span class="id"> *</span><span class="id"> covariance</span><span class="id"> P</span><span class="id"> X</span><span class="id"> Y</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> X1</span><span class="id"> Y1</span><span class="id"> XY1</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> [in</span><span class="id"> RHS]covarianceC</span><span class="id"> covarianceC</span><span class="id"> covarianceZl;</span><span class="id"> last</span><span class="id"> rewrite</span><span class="id"> mulrC</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> covarianceNl</span> (<span class="id">X</span><span class="id"> Y</span><span class="id"> :</span><span class="id"> {RV</span><span class="id"> P</span><span class="id"> &gt;-&gt;</span><span class="id"> R}</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">P</span>.<span class="id">-integrable</span><span class="id"> setT</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> X</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">P</span>.<span class="id">-integrable</span><span class="id"> setT</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> Y</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">P</span>.<span class="id">-integrable</span><span class="id"> setT</span> (<span class="id">EFin</span><span class="id"> \o</span> (<span class="id">X</span><span class="id"> *</span><span class="id"> Y</span>)<span class="id">%R</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">covariance</span><span class="id"> P</span> (<span class="id">\-</span><span class="id"> X</span>)<span class="id">%R</span><span class="id"> Y</span><span class="id"> =</span><span class="id"> -</span><span class="id"> covariance</span><span class="id"> P</span><span class="id"> X</span><span class="id"> Y</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> X1</span><span class="id"> Y1</span><span class="id"> XY1</span>.<br/>
<span class="id">have</span><span class="id"> -&gt;</span><span class="id"> :</span> (<span class="id">\-</span><span class="id"> X</span><span class="id"> =</span><span class="id"> -1</span><span class="id"> \o*</span><span class="id"> X</span>)<span class="id">%R</span><span class="gallina-kwd"> by</span><span class="id"> apply/funeqP</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> mulrN</span><span class="id"> mulr1</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> covarianceZl//</span><span class="id"> EFinN</span><span class="id"> mulNe</span><span class="id"> mul1e</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> covarianceNr</span> (<span class="id">X</span><span class="id"> Y</span><span class="id"> :</span><span class="id"> {RV</span><span class="id"> P</span><span class="id"> &gt;-&gt;</span><span class="id"> R}</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">P</span>.<span class="id">-integrable</span><span class="id"> setT</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> X</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">P</span>.<span class="id">-integrable</span><span class="id"> setT</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> Y</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">P</span>.<span class="id">-integrable</span><span class="id"> setT</span> (<span class="id">EFin</span><span class="id"> \o</span> (<span class="id">X</span><span class="id"> *</span><span class="id"> Y</span>)<span class="id">%R</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">covariance</span><span class="id"> P</span><span class="id"> X</span> (<span class="id">\-</span><span class="id"> Y</span>)<span class="id">%R</span><span class="id"> =</span><span class="id"> -</span><span class="id"> covariance</span><span class="id"> P</span><span class="id"> X</span><span class="id"> Y</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> X1</span><span class="id"> Y1</span><span class="id"> XY1;</span><span class="id"> rewrite</span><span class="id"> !</span>(<span class="id">covarianceC</span><span class="id"> X</span>)<span class="id"> covarianceNl</span><span class="id"> 1?mulrC</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> covarianceNN</span> (<span class="id">X</span><span class="id"> Y</span><span class="id"> :</span><span class="id"> {RV</span><span class="id"> P</span><span class="id"> &gt;-&gt;</span><span class="id"> R}</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">P</span>.<span class="id">-integrable</span><span class="id"> setT</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> X</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">P</span>.<span class="id">-integrable</span><span class="id"> setT</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> Y</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">P</span>.<span class="id">-integrable</span><span class="id"> setT</span> (<span class="id">EFin</span><span class="id"> \o</span> (<span class="id">X</span><span class="id"> *</span><span class="id"> Y</span>)<span class="id">%R</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">covariance</span><span class="id"> P</span> (<span class="id">\-</span><span class="id"> X</span>)<span class="id">%R</span> (<span class="id">\-</span><span class="id"> Y</span>)<span class="id">%R</span><span class="id"> =</span><span class="id"> covariance</span><span class="id"> P</span><span class="id"> X</span><span class="id"> Y</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> X1</span><span class="id"> Y1</span><span class="id"> XY1</span>.<br/>
<span class="id">have</span><span class="id"> NY</span><span class="id"> :</span><span class="id"> P</span>.<span class="id">-integrable</span><span class="id"> setT</span> (<span class="id">EFin</span><span class="id"> \o</span> (<span class="id">\-</span><span class="id"> Y</span>)<span class="id">%R</span>)<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> compreN</span><span class="id"> ?integrableN</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> covarianceNl</span><span class="id"> ?covarianceNr</span><span class="id"> ?oppeK//=</span><span class="id"> mulrN</span><span class="id"> compreN</span><span class="id"> ?integrableN</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> covarianceDl</span> (<span class="id">X</span><span class="id"> Y</span><span class="id"> Z</span><span class="id"> :</span><span class="id"> {RV</span><span class="id"> P</span><span class="id"> &gt;-&gt;</span><span class="id"> R}</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">P</span>.<span class="id">-integrable</span><span class="id"> setT</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> X</span>)<span class="id"> -&gt;</span><span class="id"> P</span>.<span class="id">-integrable</span><span class="id"> setT</span> (<span class="id">EFin</span><span class="id"> \o</span> (<span class="id">X</span><span class="id"> ^+</span><span class="id"> 2</span>)<span class="id">%R</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">P</span>.<span class="id">-integrable</span><span class="id"> setT</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> Y</span>)<span class="id"> -&gt;</span><span class="id"> P</span>.<span class="id">-integrable</span><span class="id"> setT</span> (<span class="id">EFin</span><span class="id"> \o</span> (<span class="id">Y</span><span class="id"> ^+</span><span class="id"> 2</span>)<span class="id">%R</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">P</span>.<span class="id">-integrable</span><span class="id"> setT</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> Z</span>)<span class="id"> -&gt;</span><span class="id"> P</span>.<span class="id">-integrable</span><span class="id"> setT</span> (<span class="id">EFin</span><span class="id"> \o</span> (<span class="id">Z</span><span class="id"> ^+</span><span class="id"> 2</span>)<span class="id">%R</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">P</span>.<span class="id">-integrable</span><span class="id"> setT</span> (<span class="id">EFin</span><span class="id"> \o</span> (<span class="id">X</span><span class="id"> *</span><span class="id"> Z</span>)<span class="id">%R</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">P</span>.<span class="id">-integrable</span><span class="id"> setT</span> (<span class="id">EFin</span><span class="id"> \o</span> (<span class="id">Y</span><span class="id"> *</span><span class="id"> Z</span>)<span class="id">%R</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">covariance</span><span class="id"> P</span> (<span class="id">X</span><span class="id"> \+</span><span class="id"> Y</span>)<span class="id">%R</span><span class="id"> Z</span><span class="id"> =</span><span class="id"> covariance</span><span class="id"> P</span><span class="id"> X</span><span class="id"> Z</span><span class="id"> +</span><span class="id"> covariance</span><span class="id"> P</span><span class="id"> Y</span><span class="id"> Z</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> X1</span><span class="id"> X2</span><span class="id"> Y1</span><span class="id"> Y2</span><span class="id"> Z1</span><span class="id"> Z2</span><span class="id"> XZ1</span><span class="id"> YZ1</span>.<br/>
<span class="id">rewrite</span><span class="id"> [LHS]covarianceE//=</span><span class="id"> ?mulrDl</span><span class="id"> ?compreDr//</span><span class="id"> ?integrableD//</span>.<br/>
<span class="id">rewrite</span><span class="id"> 2?expectationD//=</span>.<br/>
<span class="id">rewrite</span><span class="id"> muleDl</span><span class="id"> ?fin_num_adde_defr</span><span class="id"> ?expectation_fin_num//</span>.<br/>
<span class="id">rewrite</span><span class="id"> oppeD</span><span class="id"> ?fin_num_adde_defr</span><span class="id"> ?fin_numM</span><span class="id"> ?expectation_fin_num//</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> addeACA</span><span class="id"> 2?covarianceE</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> covarianceDr</span> (<span class="id">X</span><span class="id"> Y</span><span class="id"> Z</span><span class="id"> :</span><span class="id"> {RV</span><span class="id"> P</span><span class="id"> &gt;-&gt;</span><span class="id"> R}</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">P</span>.<span class="id">-integrable</span><span class="id"> setT</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> X</span>)<span class="id"> -&gt;</span><span class="id"> P</span>.<span class="id">-integrable</span><span class="id"> setT</span> (<span class="id">EFin</span><span class="id"> \o</span> (<span class="id">X</span><span class="id"> ^+</span><span class="id"> 2</span>)<span class="id">%R</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">P</span>.<span class="id">-integrable</span><span class="id"> setT</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> Y</span>)<span class="id"> -&gt;</span><span class="id"> P</span>.<span class="id">-integrable</span><span class="id"> setT</span> (<span class="id">EFin</span><span class="id"> \o</span> (<span class="id">Y</span><span class="id"> ^+</span><span class="id"> 2</span>)<span class="id">%R</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">P</span>.<span class="id">-integrable</span><span class="id"> setT</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> Z</span>)<span class="id"> -&gt;</span><span class="id"> P</span>.<span class="id">-integrable</span><span class="id"> setT</span> (<span class="id">EFin</span><span class="id"> \o</span> (<span class="id">Z</span><span class="id"> ^+</span><span class="id"> 2</span>)<span class="id">%R</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">P</span>.<span class="id">-integrable</span><span class="id"> setT</span> (<span class="id">EFin</span><span class="id"> \o</span> (<span class="id">X</span><span class="id"> *</span><span class="id"> Y</span>)<span class="id">%R</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">P</span>.<span class="id">-integrable</span><span class="id"> setT</span> (<span class="id">EFin</span><span class="id"> \o</span> (<span class="id">X</span><span class="id"> *</span><span class="id"> Z</span>)<span class="id">%R</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">covariance</span><span class="id"> P</span><span class="id"> X</span> (<span class="id">Y</span><span class="id"> \+</span><span class="id"> Z</span>)<span class="id">%R</span><span class="id"> =</span><span class="id"> covariance</span><span class="id"> P</span><span class="id"> X</span><span class="id"> Y</span><span class="id"> +</span><span class="id"> covariance</span><span class="id"> P</span><span class="id"> X</span><span class="id"> Z</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> X1</span><span class="id"> X2</span><span class="id"> Y1</span><span class="id"> Y2</span><span class="id"> Z1</span><span class="id"> Z2</span><span class="id"> XY1</span><span class="id"> XZ1</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> covarianceC</span><span class="id"> covarianceDl</span><span class="id"> ?</span>(<span class="id">covarianceC</span><span class="id"> X</span>)<span class="id"> 1?mulrC</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> covarianceBl</span> (<span class="id">X</span><span class="id"> Y</span><span class="id"> Z</span><span class="id"> :</span><span class="id"> {RV</span><span class="id"> P</span><span class="id"> &gt;-&gt;</span><span class="id"> R}</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">P</span>.<span class="id">-integrable</span><span class="id"> setT</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> X</span>)<span class="id"> -&gt;</span><span class="id"> P</span>.<span class="id">-integrable</span><span class="id"> setT</span> (<span class="id">EFin</span><span class="id"> \o</span> (<span class="id">X</span><span class="id"> ^+</span><span class="id"> 2</span>)<span class="id">%R</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">P</span>.<span class="id">-integrable</span><span class="id"> setT</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> Y</span>)<span class="id"> -&gt;</span><span class="id"> P</span>.<span class="id">-integrable</span><span class="id"> setT</span> (<span class="id">EFin</span><span class="id"> \o</span> (<span class="id">Y</span><span class="id"> ^+</span><span class="id"> 2</span>)<span class="id">%R</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">P</span>.<span class="id">-integrable</span><span class="id"> setT</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> Z</span>)<span class="id"> -&gt;</span><span class="id"> P</span>.<span class="id">-integrable</span><span class="id"> setT</span> (<span class="id">EFin</span><span class="id"> \o</span> (<span class="id">Z</span><span class="id"> ^+</span><span class="id"> 2</span>)<span class="id">%R</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">P</span>.<span class="id">-integrable</span><span class="id"> setT</span> (<span class="id">EFin</span><span class="id"> \o</span> (<span class="id">X</span><span class="id"> *</span><span class="id"> Z</span>)<span class="id">%R</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">P</span>.<span class="id">-integrable</span><span class="id"> setT</span> (<span class="id">EFin</span><span class="id"> \o</span> (<span class="id">Y</span><span class="id"> *</span><span class="id"> Z</span>)<span class="id">%R</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">covariance</span><span class="id"> P</span> (<span class="id">X</span><span class="id"> \-</span><span class="id"> Y</span>)<span class="id">%R</span><span class="id"> Z</span><span class="id"> =</span><span class="id"> covariance</span><span class="id"> P</span><span class="id"> X</span><span class="id"> Z</span><span class="id"> -</span><span class="id"> covariance</span><span class="id"> P</span><span class="id"> Y</span><span class="id"> Z</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> X1</span><span class="id"> X2</span><span class="id"> Y1</span><span class="id"> Y2</span><span class="id"> Z1</span><span class="id"> Z2</span><span class="id"> XZ1</span><span class="id"> YZ1</span>.<br/>
<span class="id">rewrite</span><span class="id"> -[</span>(<span class="id">X</span><span class="id"> \-</span><span class="id"> Y</span>)<span class="id">%R]/</span>(<span class="id">X</span><span class="id"> \+</span> (<span class="id">\-</span><span class="id"> Y</span>))<span class="id">%R</span><span class="id"> covarianceDl</span><span class="id"> ?covarianceNl//=</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> compreN//</span><span class="id"> integrableN</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> mulrNN</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> mulNr</span><span class="id"> compreN//</span><span class="id"> integrableN</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> covarianceBr</span> (<span class="id">X</span><span class="id"> Y</span><span class="id"> Z</span><span class="id"> :</span><span class="id"> {RV</span><span class="id"> P</span><span class="id"> &gt;-&gt;</span><span class="id"> R}</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">P</span>.<span class="id">-integrable</span><span class="id"> setT</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> X</span>)<span class="id"> -&gt;</span><span class="id"> P</span>.<span class="id">-integrable</span><span class="id"> setT</span> (<span class="id">EFin</span><span class="id"> \o</span> (<span class="id">X</span><span class="id"> ^+</span><span class="id"> 2</span>)<span class="id">%R</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">P</span>.<span class="id">-integrable</span><span class="id"> setT</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> Y</span>)<span class="id"> -&gt;</span><span class="id"> P</span>.<span class="id">-integrable</span><span class="id"> setT</span> (<span class="id">EFin</span><span class="id"> \o</span> (<span class="id">Y</span><span class="id"> ^+</span><span class="id"> 2</span>)<span class="id">%R</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">P</span>.<span class="id">-integrable</span><span class="id"> setT</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> Z</span>)<span class="id"> -&gt;</span><span class="id"> P</span>.<span class="id">-integrable</span><span class="id"> setT</span> (<span class="id">EFin</span><span class="id"> \o</span> (<span class="id">Z</span><span class="id"> ^+</span><span class="id"> 2</span>)<span class="id">%R</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">P</span>.<span class="id">-integrable</span><span class="id"> setT</span> (<span class="id">EFin</span><span class="id"> \o</span> (<span class="id">X</span><span class="id"> *</span><span class="id"> Y</span>)<span class="id">%R</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">P</span>.<span class="id">-integrable</span><span class="id"> setT</span> (<span class="id">EFin</span><span class="id"> \o</span> (<span class="id">X</span><span class="id"> *</span><span class="id"> Z</span>)<span class="id">%R</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">covariance</span><span class="id"> P</span><span class="id"> X</span> (<span class="id">Y</span><span class="id"> \-</span><span class="id"> Z</span>)<span class="id">%R</span><span class="id"> =</span><span class="id"> covariance</span><span class="id"> P</span><span class="id"> X</span><span class="id"> Y</span><span class="id"> -</span><span class="id"> covariance</span><span class="id"> P</span><span class="id"> X</span><span class="id"> Z</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> X1</span><span class="id"> X2</span><span class="id"> Y1</span><span class="id"> Y2</span><span class="id"> Z1</span><span class="id"> Z2</span><span class="id"> XY1</span><span class="id"> XZ1</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> !</span>(<span class="id">covarianceC</span><span class="id"> X</span>)<span class="id"> covarianceBl</span><span class="id"> 1?</span>(<span class="id">mulrC</span><span class="id"> _</span><span class="id"> X</span>).<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> covariance_lemmas</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> variance</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<span class="vernacular">Context</span><span class="id"> d</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>) (<span class="id">P</span><span class="id"> :</span><span class="id"> probability</span><span class="id"> T</span><span class="id"> R</span>).<br/>
<br/>
<span class="vernacular">Definition</span><span class="id"> variance</span> (<span class="id">X</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> R</span>)<span class="id"> :=</span><span class="id"> covariance</span><span class="id"> P</span><span class="id"> X</span><span class="id"> X</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Notation</span> <span class="id">&quot;''V_' P [ X ]&quot;</span><span class="id"> :=</span> (<span class="id">variance</span><span class="id"> X</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> varianceE</span> (<span class="id">X</span><span class="id"> :</span><span class="id"> {RV</span><span class="id"> P</span><span class="id"> &gt;-&gt;</span><span class="id"> R}</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">P</span>.<span class="id">-integrable</span><span class="id"> setT</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> X</span>)<span class="id"> -&gt;</span><span class="id"> P</span>.<span class="id">-integrable</span><span class="id"> setT</span> (<span class="id">EFin</span><span class="id"> \o</span> (<span class="id">X</span><span class="id"> ^+</span><span class="id"> 2</span>)<span class="id">%R</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">'V_P[X]</span><span class="id"> =</span><span class="id"> 'E_P[X</span><span class="id"> ^+</span><span class="id"> 2]</span><span class="id"> -</span> (<span class="id">'E_P[X]</span>)<span class="id"> ^+</span><span class="id"> 2</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> X1</span><span class="id"> X2;</span><span class="id"> rewrite</span><span class="id"> /variance</span><span class="id"> covarianceE</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> variance_fin_num</span> (<span class="id">X</span><span class="id"> :</span><span class="id"> {RV</span><span class="id"> P</span><span class="id"> &gt;-&gt;</span><span class="id"> R}</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">P</span>.<span class="id">-integrable</span><span class="id"> setT</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> X</span>)<span class="id"> -&gt;</span><span class="id"> P</span>.<span class="id">-integrable</span><span class="id"> setT</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> X</span><span class="id"> ^+</span><span class="id"> 2</span>)<span class="id">%R</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">'V_P[X]</span><span class="id"> \is</span><span class="id"> a</span><span class="id"> fin_num</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> /[dup];</span><span class="id"> apply:</span><span class="id"> covariance_fin_num</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> variance_ge0</span> (<span class="id">X</span><span class="id"> :</span><span class="id"> {RV</span><span class="id"> P</span><span class="id"> &gt;-&gt;</span><span class="id"> R}</span>)<span class="id"> :</span> (<span class="id">0</span><span class="id"> &lt;=</span><span class="id"> 'V_P[X]</span>)<span class="id">%E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /variance</span><span class="id"> unlock;</span><span class="id"> apply:</span><span class="id"> expectation_ge0</span><span class="id"> =&gt;</span><span class="id"> x;</span><span class="id"> apply:</span><span class="id"> sqr_ge0</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> variance_cst</span><span class="id"> r</span><span class="id"> :</span><span class="id"> 'V_P[cst</span><span class="id"> r]</span><span class="id"> =</span><span class="id"> 0%E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> /variance</span><span class="id"> unlock</span><span class="id"> expectation_cst/=</span>.<br/>
<span class="id">rewrite</span><span class="id"> [X</span><span class="gallina-kwd"> in</span><span class="id"> 'E_P[X]]</span>(_<span class="id"> :</span><span class="id"> _</span><span class="id"> =</span><span class="id"> cst</span><span class="id"> 0%R</span>)<span class="id"> ?expectation_cst//</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply/funext</span><span class="id"> =&gt;</span><span class="id"> x;</span><span class="id"> rewrite</span><span class="id"> /GRing</span>.<span class="id">exp/GRing</span>.<span class="id">mul/=</span><span class="id"> subrr</span><span class="id"> mulr0</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> varianceZ</span><span class="id"> a</span> (<span class="id">X</span><span class="id"> :</span><span class="id"> {RV</span><span class="id"> P</span><span class="id"> &gt;-&gt;</span><span class="id"> R}</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">P</span>.<span class="id">-integrable</span><span class="id"> setT</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> X</span>)<span class="id"> -&gt;</span><span class="id"> P</span>.<span class="id">-integrable</span><span class="id"> setT</span> (<span class="id">EFin</span><span class="id"> \o</span> (<span class="id">X</span><span class="id"> ^+</span><span class="id"> 2</span>)<span class="id">%R</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">'V_P[</span>(<span class="id">a</span><span class="id"> \o*</span><span class="id"> X</span>)<span class="id">%R]</span><span class="id"> =</span> (<span class="id">a</span><span class="id"> ^+</span><span class="id"> 2</span>)<span class="id">%:E</span><span class="id"> *</span><span class="id"> 'V_P[X]</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> X1</span><span class="id"> X2;</span><span class="id"> rewrite</span><span class="id"> /variance</span><span class="id"> covarianceZl//=</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> covarianceZr//</span><span class="id"> muleA</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> compre_scale//</span><span class="id"> integrableZl</span>.<br/>
<span class="id">-</span><span class="id"> rewrite</span><span class="id"> [X</span><span class="gallina-kwd"> in</span><span class="id"> EFin</span><span class="id"> \o</span><span class="id"> X]</span>(_<span class="id"> :</span><span class="id"> _</span><span class="id"> =</span> (<span class="id">a</span><span class="id"> \o*</span><span class="id"> X</span><span class="id"> ^+</span><span class="id"> 2</span>)<span class="id">%R</span>)<span class="id">;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply/funeqP</span><span class="id"> =&gt;</span><span class="id"> x;</span><span class="id"> rewrite</span><span class="id"> mulrA</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> compre_scale//</span><span class="id"> integrableZl</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> varianceN</span> (<span class="id">X</span><span class="id"> :</span><span class="id"> {RV</span><span class="id"> P</span><span class="id"> &gt;-&gt;</span><span class="id"> R}</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">P</span>.<span class="id">-integrable</span><span class="id"> setT</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> X</span>)<span class="id"> -&gt;</span><span class="id"> P</span>.<span class="id">-integrable</span><span class="id"> setT</span> (<span class="id">EFin</span><span class="id"> \o</span> (<span class="id">X</span><span class="id"> ^+</span><span class="id"> 2</span>)<span class="id">%R</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">'V_P[</span>(<span class="id">\-</span><span class="id"> X</span>)<span class="id">%R]</span><span class="id"> =</span><span class="id"> 'V_P[X]</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> X1</span><span class="id"> X2;</span><span class="id"> rewrite</span><span class="id"> /variance</span><span class="id"> covarianceNN</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> varianceD</span> (<span class="id">X</span><span class="id"> Y</span><span class="id"> :</span><span class="id"> {RV</span><span class="id"> P</span><span class="id"> &gt;-&gt;</span><span class="id"> R}</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">P</span>.<span class="id">-integrable</span><span class="id"> setT</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> X</span>)<span class="id"> -&gt;</span><span class="id"> P</span>.<span class="id">-integrable</span><span class="id"> setT</span> (<span class="id">EFin</span><span class="id"> \o</span> (<span class="id">X</span><span class="id"> ^+</span><span class="id"> 2</span>)<span class="id">%R</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">P</span>.<span class="id">-integrable</span><span class="id"> setT</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> Y</span>)<span class="id"> -&gt;</span><span class="id"> P</span>.<span class="id">-integrable</span><span class="id"> setT</span> (<span class="id">EFin</span><span class="id"> \o</span> (<span class="id">Y</span><span class="id"> ^+</span><span class="id"> 2</span>)<span class="id">%R</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">P</span>.<span class="id">-integrable</span><span class="id"> setT</span> (<span class="id">EFin</span><span class="id"> \o</span> (<span class="id">X</span><span class="id"> *</span><span class="id"> Y</span>)<span class="id">%R</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">'V_P[X</span><span class="id"> \+</span><span class="id"> Y]%R</span><span class="id"> =</span><span class="id"> 'V_P[X]</span><span class="id"> +</span><span class="id"> 'V_P[Y]</span><span class="id"> +</span><span class="id"> 2%:E</span><span class="id"> *</span><span class="id"> covariance</span><span class="id"> P</span><span class="id"> X</span><span class="id"> Y</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> X1</span><span class="id"> X2</span><span class="id"> Y1</span><span class="id"> Y2</span><span class="id"> XY1</span>.<br/>
<span class="id">rewrite</span><span class="id"> -['V_P[_]]/</span>(<span class="id">covariance</span><span class="id"> P</span> (<span class="id">X</span><span class="id"> \+</span><span class="id"> Y</span>)<span class="id">%R</span> (<span class="id">X</span><span class="id"> \+</span><span class="id"> Y</span>)<span class="id">%R</span>).<br/>
<span class="id">have</span><span class="id"> XY</span><span class="id"> :</span><span class="id"> P</span>.<span class="id">-integrable</span><span class="id"> [set:</span><span class="id"> T]</span> (<span class="id">EFin</span><span class="id"> \o</span> (<span class="id">X</span><span class="id"> \+</span><span class="id"> Y</span>)<span class="id">%R</span>).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> compreDr//</span><span class="id"> integrableD</span>.<br/>
<span class="id">rewrite</span><span class="id"> covarianceDl//=;</span><span class="id"> last</span><span class="id"> 3</span><span class="id"> first</span>.<br/>
<span class="id">-</span><span class="id"> rewrite</span><span class="id"> -expr2</span><span class="id"> sqrrD</span><span class="id"> compreDr</span><span class="id"> ?integrableD//</span><span class="id"> compreDr//</span><span class="id"> integrableD//</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -mulr_natr</span><span class="id"> -[</span>(_<span class="id"> *</span><span class="id"> 2</span>)<span class="id">%R]/</span>(<span class="id">2</span><span class="id"> \o*</span> (<span class="id">X</span><span class="id"> *</span><span class="id"> Y</span>))<span class="id">%R</span><span class="id"> compre_scale//</span>.<br/>
&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> integrableZl</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> mulrDr</span><span class="id"> compreDr</span><span class="id"> ?integrableD</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> mulrDr</span><span class="id"> mulrC</span><span class="id"> compreDr</span><span class="id"> ?integrableD</span>.<br/>
<span class="id">rewrite</span><span class="id"> covarianceDr//</span><span class="id"> covarianceDr;</span><span class="id"> [|by</span><span class="id"> []</span>..<span class="id">|by</span><span class="id"> rewrite</span><span class="id"> mulrC</span><span class="id"> |exact:</span><span class="id"> Y2]</span>.<br/>
<span class="id">rewrite</span> (<span class="id">covarianceC</span><span class="id"> P</span><span class="id"> Y</span><span class="id"> X</span>)<span class="id"> [LHS]addeA</span><span class="id"> [LHS]</span>(<span class="id">ACl</span> (<span class="id">1*4*</span>(<span class="id">2*3</span>)))<span class="id">/=</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -[2%R]/</span>(<span class="id">1</span><span class="id"> +</span><span class="id"> 1</span>)<span class="id">%R</span><span class="id"> EFinD</span><span class="id"> muleDl</span><span class="id"> ?mul1e//</span><span class="id"> covariance_fin_num</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> varianceB</span> (<span class="id">X</span><span class="id"> Y</span><span class="id"> :</span><span class="id"> {RV</span><span class="id"> P</span><span class="id"> &gt;-&gt;</span><span class="id"> R}</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">P</span>.<span class="id">-integrable</span><span class="id"> setT</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> X</span>)<span class="id"> -&gt;</span><span class="id"> P</span>.<span class="id">-integrable</span><span class="id"> setT</span> (<span class="id">EFin</span><span class="id"> \o</span> (<span class="id">X</span><span class="id"> ^+</span><span class="id"> 2</span>)<span class="id">%R</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">P</span>.<span class="id">-integrable</span><span class="id"> setT</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> Y</span>)<span class="id"> -&gt;</span><span class="id"> P</span>.<span class="id">-integrable</span><span class="id"> setT</span> (<span class="id">EFin</span><span class="id"> \o</span> (<span class="id">Y</span><span class="id"> ^+</span><span class="id"> 2</span>)<span class="id">%R</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">P</span>.<span class="id">-integrable</span><span class="id"> setT</span> (<span class="id">EFin</span><span class="id"> \o</span> (<span class="id">X</span><span class="id"> *</span><span class="id"> Y</span>)<span class="id">%R</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">'V_P[</span>(<span class="id">X</span><span class="id"> \-</span><span class="id"> Y</span>)<span class="id">%R]</span><span class="id"> =</span><span class="id"> 'V_P[X]</span><span class="id"> +</span><span class="id"> 'V_P[Y]</span><span class="id"> -</span><span class="id"> 2%:E</span><span class="id"> *</span><span class="id"> covariance</span><span class="id"> P</span><span class="id"> X</span><span class="id"> Y</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> X1</span><span class="id"> X2</span><span class="id"> Y1</span><span class="id"> Y2</span><span class="id"> XY1</span>.<br/>
<span class="id">rewrite</span><span class="id"> -[</span>(<span class="id">X</span><span class="id"> \-</span><span class="id"> Y</span>)<span class="id">%R]/</span>(<span class="id">X</span><span class="id"> \+</span> (<span class="id">\-</span><span class="id"> Y</span>))<span class="id">%R</span>.<br/>
<span class="id">rewrite</span><span class="id"> varianceD/=</span><span class="id"> ?varianceN</span><span class="id"> ?covarianceNr</span><span class="id"> ?muleN//</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> compreN</span><span class="id"> ?integrableN</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> mulrNN</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> mulrN</span><span class="id"> compreN</span><span class="id"> ?integrableN</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> varianceD_cst_l</span><span class="id"> c</span> (<span class="id">X</span><span class="id"> :</span><span class="id"> {RV</span><span class="id"> P</span><span class="id"> &gt;-&gt;</span><span class="id"> R}</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">P</span>.<span class="id">-integrable</span><span class="id"> setT</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> X</span>)<span class="id"> -&gt;</span><span class="id"> P</span>.<span class="id">-integrable</span><span class="id"> setT</span> (<span class="id">EFin</span><span class="id"> \o</span> (<span class="id">X</span><span class="id"> ^+</span><span class="id"> 2</span>)<span class="id">%R</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">'V_P[</span>(<span class="id">cst</span><span class="id"> c</span><span class="id"> \+</span><span class="id"> X</span>)<span class="id">%R]</span><span class="id"> =</span><span class="id"> 'V_P[X]</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> X1</span><span class="id"> X2</span>.<br/>
<span class="id">rewrite</span><span class="id"> varianceD//=;</span><span class="id"> last</span><span class="id"> 3</span><span class="id"> first</span>.<br/>
<span class="id">-</span><span class="id"> exact:</span><span class="id"> finite_measure_integrable_cst</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> compre_scale//</span><span class="id"> integrableZl//</span><span class="id"> finite_measure_integrable_cst</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> mulrC</span><span class="id"> compre_scale</span><span class="id"> ?integrableZl</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> variance_cst</span><span class="id"> add0e</span><span class="id"> covariance_cst_l</span><span class="id"> mule0</span><span class="id"> adde0</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> varianceD_cst_r</span> (<span class="id">X</span><span class="id"> :</span><span class="id"> {RV</span><span class="id"> P</span><span class="id"> &gt;-&gt;</span><span class="id"> R}</span>)<span class="id"> c</span><span class="id"> :</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">P</span>.<span class="id">-integrable</span><span class="id"> setT</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> X</span>)<span class="id"> -&gt;</span><span class="id"> P</span>.<span class="id">-integrable</span><span class="id"> setT</span> (<span class="id">EFin</span><span class="id"> \o</span> (<span class="id">X</span><span class="id"> ^+</span><span class="id"> 2</span>)<span class="id">%R</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">'V_P[</span>(<span class="id">X</span><span class="id"> \+</span><span class="id"> cst</span><span class="id"> c</span>)<span class="id">%R]</span><span class="id"> =</span><span class="id"> 'V_P[X]</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> X1</span><span class="id"> X2</span>.<br/>
<span class="id">have</span><span class="id"> -&gt;</span><span class="id"> :</span> (<span class="id">X</span><span class="id"> \+</span><span class="id"> cst</span><span class="id"> c</span><span class="id"> =</span><span class="id"> cst</span><span class="id"> c</span><span class="id"> \+</span><span class="id"> X</span>)<span class="id">%R</span><span class="gallina-kwd"> by</span><span class="id"> apply/funeqP</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> addrC</span>.<br/>
<span class="id">exact:</span><span class="id"> varianceD_cst_l</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> varianceB_cst_l</span><span class="id"> c</span> (<span class="id">X</span><span class="id"> :</span><span class="id"> {RV</span><span class="id"> P</span><span class="id"> &gt;-&gt;</span><span class="id"> R}</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">P</span>.<span class="id">-integrable</span><span class="id"> setT</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> X</span>)<span class="id"> -&gt;</span><span class="id"> P</span>.<span class="id">-integrable</span><span class="id"> setT</span> (<span class="id">EFin</span><span class="id"> \o</span> (<span class="id">X</span><span class="id"> ^+</span><span class="id"> 2</span>)<span class="id">%R</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">'V_P[</span>(<span class="id">cst</span><span class="id"> c</span><span class="id"> \-</span><span class="id"> X</span>)<span class="id">%R]</span><span class="id"> =</span><span class="id"> 'V_P[X]</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> X1</span><span class="id"> X2</span>.<br/>
<span class="id">rewrite</span><span class="id"> -[</span>(<span class="id">cst</span><span class="id"> c</span><span class="id"> \-</span><span class="id"> X</span>)<span class="id">%R]/</span>(<span class="id">cst</span><span class="id"> c</span><span class="id"> \+</span> (<span class="id">\-</span><span class="id"> X</span>))<span class="id">%R</span><span class="id"> varianceD_cst_l/=;</span><span class="id"> last</span><span class="id"> 2</span><span class="id"> first</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> compreN</span><span class="id"> ?integrableN</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> mulrNN;</span><span class="id"> apply:</span><span class="id"> X2</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> varianceN</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> varianceB_cst_r</span> (<span class="id">X</span><span class="id"> :</span><span class="id"> {RV</span><span class="id"> P</span><span class="id"> &gt;-&gt;</span><span class="id"> R}</span>)<span class="id"> c</span><span class="id"> :</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">P</span>.<span class="id">-integrable</span><span class="id"> setT</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> X</span>)<span class="id"> -&gt;</span><span class="id"> P</span>.<span class="id">-integrable</span><span class="id"> setT</span> (<span class="id">EFin</span><span class="id"> \o</span> (<span class="id">X</span><span class="id"> ^+</span><span class="id"> 2</span>)<span class="id">%R</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">'V_P[</span>(<span class="id">X</span><span class="id"> \-</span><span class="id"> cst</span><span class="id"> c</span>)<span class="id">%R]</span><span class="id"> =</span><span class="id"> 'V_P[X]</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> X1</span><span class="id"> X2;</span><span class="id"> rewrite</span><span class="id"> -[</span>(<span class="id">X</span><span class="id"> \-</span><span class="id"> cst</span><span class="id"> c</span>)<span class="id">%R]/</span>(<span class="id">X</span><span class="id"> \+</span> (<span class="id">cst</span> (<span class="id">-</span><span class="id"> c</span>)))<span class="id">%R</span><span class="id"> varianceD_cst_r</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> covariance_le</span> (<span class="id">X</span><span class="id"> Y</span><span class="id"> :</span><span class="id"> {RV</span><span class="id"> P</span><span class="id"> &gt;-&gt;</span><span class="id"> R}</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">P</span>.<span class="id">-integrable</span><span class="id"> setT</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> X</span>)<span class="id"> -&gt;</span><span class="id"> P</span>.<span class="id">-integrable</span><span class="id"> setT</span> (<span class="id">EFin</span><span class="id"> \o</span> (<span class="id">X</span><span class="id"> ^+</span><span class="id"> 2</span>)<span class="id">%R</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">P</span>.<span class="id">-integrable</span><span class="id"> setT</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> Y</span>)<span class="id"> -&gt;</span><span class="id"> P</span>.<span class="id">-integrable</span><span class="id"> setT</span> (<span class="id">EFin</span><span class="id"> \o</span> (<span class="id">Y</span><span class="id"> ^+</span><span class="id"> 2</span>)<span class="id">%R</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">P</span>.<span class="id">-integrable</span><span class="id"> setT</span> (<span class="id">EFin</span><span class="id"> \o</span> (<span class="id">X</span><span class="id"> *</span><span class="id"> Y</span>)<span class="id">%R</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">covariance</span><span class="id"> P</span><span class="id"> X</span><span class="id"> Y</span><span class="id"> &lt;=</span><span class="id"> sqrte</span><span class="id"> 'V_P[X]</span><span class="id"> *</span><span class="id"> sqrte</span><span class="id"> 'V_P[Y]</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> X1</span><span class="id"> X2</span><span class="id"> Y1</span><span class="id"> Y2</span><span class="id"> XY1</span>.<br/>
<span class="id">rewrite</span><span class="id"> -sqrteM</span><span class="id"> ?variance_ge0//</span>.<br/>
<span class="id">rewrite</span><span class="id"> lee_sqrE</span><span class="id"> ?sqrte_ge0//</span><span class="id"> sqr_sqrte</span><span class="id"> ?mule_ge0</span><span class="id"> ?variance_ge0//</span>.<br/>
<span class="id">rewrite</span><span class="id"> -</span>(<span class="id">fineK</span> (<span class="id">variance_fin_num</span><span class="id"> X1</span><span class="id"> X2</span>))<span class="id"> -</span>(<span class="id">fineK</span> (<span class="id">variance_fin_num</span><span class="id"> Y1</span><span class="id"> Y2</span>)).<br/>
<span class="id">rewrite</span><span class="id"> -</span>(<span class="id">fineK</span> (<span class="id">covariance_fin_num</span><span class="id"> X1</span><span class="id"> Y1</span><span class="id"> XY1</span>)).<br/>
<span class="id">rewrite</span><span class="id"> -EFin_expe</span><span class="id"> -EFinM</span><span class="id"> lee_fin</span><span class="id"> -</span>(<span class="id">@ler_pM2l</span><span class="id"> _</span><span class="id"> 4</span>)<span class="id"> ?ltr0n//</span><span class="id"> [leRHS]mulrA</span>.<br/>
<span class="id">rewrite</span><span class="id"> [in</span><span class="id"> leLHS]</span>(_<span class="id"> :</span><span class="id"> 4</span><span class="id"> =</span><span class="id"> 2</span><span class="id"> *</span><span class="id"> 2</span>)<span class="id">%R</span><span class="id"> -natrM//</span><span class="id"> [in</span><span class="id"> leLHS]natrM</span><span class="id"> mulrACA</span><span class="id"> -expr2</span>.<br/>
<span class="id">rewrite</span><span class="id"> -subr_le0;</span><span class="id"> apply:</span><span class="id"> deg_le2_ge0</span><span class="id"> =&gt;</span><span class="id"> r;</span><span class="id"> rewrite</span><span class="id"> -lee_fin</span><span class="id"> !EFinD</span>.<br/>
<span class="id">rewrite</span><span class="id"> EFinM</span><span class="id"> fineK</span><span class="id"> ?variance_fin_num//</span><span class="id"> muleC</span><span class="id"> -varianceZ//</span>.<br/>
<span class="id">rewrite</span><span class="id"> 2!EFinM</span><span class="id"> ?fineK</span><span class="id"> ?variance_fin_num//</span><span class="id"> ?covariance_fin_num//</span>.<br/>
<span class="id">rewrite</span><span class="id"> -muleA</span><span class="id"> [_</span><span class="id"> *</span><span class="id"> r%:E]muleC</span><span class="id"> -covarianceZl//</span>.<br/>
<span class="id">rewrite</span><span class="id"> addeAC</span><span class="id"> -varianceD</span><span class="id"> ?variance_ge0//=</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> compre_scale</span><span class="id"> ?integrableZl</span>.<br/>
<span class="id">-</span><span class="id"> rewrite</span><span class="id"> [X</span><span class="gallina-kwd"> in</span><span class="id"> EFin</span><span class="id"> \o</span><span class="id"> X]</span>(_<span class="id"> :</span><span class="id"> _</span><span class="id"> =</span><span class="id"> r</span><span class="id"> ^+2</span><span class="id"> \o*</span><span class="id"> X</span><span class="id"> ^+</span><span class="id"> 2</span>)<span class="id">%R</span><span class="id"> 1?mulrACA//</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> compre_scale</span><span class="id"> ?integrableZl</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> -mulrAC</span><span class="id"> compre_scale//</span><span class="id"> integrableZl</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> variance</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;'V_ P [ X ]&quot;</span><span class="id"> :=</span> (<span class="id">variance</span><span class="id"> P</span><span class="id"> X</span>).<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> markov_chebyshev_cantelli</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<span class="vernacular">Context</span><span class="id"> d</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>) (<span class="id">P</span><span class="id"> :</span><span class="id"> probability</span><span class="id"> T</span><span class="id"> R</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> markov</span> (<span class="id">X</span><span class="id"> :</span><span class="id"> {RV</span><span class="id"> P</span><span class="id"> &gt;-&gt;</span><span class="id"> R}</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> R</span>) (<span class="id">eps</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">0</span><span class="id"> &lt;</span><span class="id"> eps</span>)<span class="id">%R</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">measurable_fun</span><span class="id"> [set:</span><span class="id"> R]</span><span class="id"> f</span><span class="id"> -&gt;</span> (<span class="gallina-kwd">forall</span><span class="id"> r,</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> r</span><span class="id"> -&gt;</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> f</span><span class="id"> r</span>)<span class="id">%R</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">{in</span><span class="id"> Num</span>.<span class="id">nneg</span><span class="id"> &amp;,</span><span class="id"> {homo</span><span class="id"> f</span><span class="id"> :</span><span class="id"> x</span><span class="id"> y</span><span class="id"> /</span><span class="id"> x</span><span class="id"> &lt;=</span><span class="id"> y}}%R</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;(<span class="id">f</span><span class="id"> eps</span>)<span class="id">%:E</span><span class="id"> *</span><span class="id"> P</span><span class="id"> [set</span><span class="id"> x</span><span class="id"> |</span><span class="id"> eps%:E</span><span class="id"> &lt;=</span><span class="id"> `|</span> (<span class="id">X</span><span class="id"> x</span>)<span class="id">%:E</span><span class="id"> |</span><span class="id"> ]</span><span class="id"> &lt;=</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">'E_P[f</span><span class="id"> \o</span> (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> `|</span><span class="id"> x</span><span class="id"> |%R</span>)<span class="id"> \o</span><span class="id"> X]</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> e0</span><span class="id"> mf</span><span class="id"> f0</span><span class="id"> f_nd;</span><span class="id"> rewrite</span><span class="id"> -</span>(<span class="id">setTI</span><span class="id"> [set</span><span class="id"> _</span><span class="id"> |</span><span class="id"> _]</span>).<br/>
<span class="id">apply:</span> (<span class="id">le_trans</span> (<span class="id">@le_integral_comp_abse</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> P</span><span class="id"> _</span><span class="id"> measurableT</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> X</span>)<br/>
&nbsp;&nbsp;<span class="id">eps</span> (<span class="id">er_map</span><span class="id"> f</span>)<span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> e0</span>))<span class="id"> =&gt;</span><span class="id"> //=</span>.<br/>
<span class="id">-</span><span class="id"> exact:</span><span class="id"> measurable_er_map</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> case</span><span class="id"> =&gt;</span><span class="id"> //=</span><span class="id"> r</span><span class="id"> _;</span><span class="id"> exact:</span><span class="id"> f0</span>.<br/>
<span class="id">-</span><span class="id"> move=&gt;</span><span class="id"> [x|</span><span class="id"> |]</span><span class="id"> [y|</span><span class="id"> |];</span><span class="id"> rewrite</span><span class="id"> !inE/=</span><span class="id"> !in_itv/=</span><span class="id"> ?andbT</span><span class="id"> ?lee_fin</span><span class="id"> ?leey//</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> ?</span><span class="id"> ?</span><span class="id"> ?;</span><span class="id"> rewrite</span><span class="id"> f_nd</span>.<br/>
<span class="id">-</span><span class="id"> exact/measurable_EFinP</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> unlock</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Definition</span><span class="id"> mmt_gen_fun</span> (<span class="id">X</span><span class="id"> :</span><span class="id"> {RV</span><span class="id"> P</span><span class="id"> &gt;-&gt;</span><span class="id"> R}</span>) (<span class="id">t</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :=</span><span class="id"> 'E_P[expR</span><span class="id"> \o</span><span class="id"> t</span><span class="id"> \o*</span><span class="id"> X]</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> chernoff</span> (<span class="id">X</span><span class="id"> :</span><span class="id"> {RV</span><span class="id"> P</span><span class="id"> &gt;-&gt;</span><span class="id"> R}</span>) (<span class="id">r</span><span class="id"> a</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span> (<span class="id">0</span><span class="id"> &lt;</span><span class="id"> r</span>)<span class="id">%R</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">P</span><span class="id"> [set</span><span class="id"> x</span><span class="id"> |</span><span class="id"> X</span><span class="id"> x</span><span class="id"> &gt;=</span><span class="id"> a]%R</span><span class="id"> &lt;=</span><span class="id"> mmt_gen_fun</span><span class="id"> X</span><span class="id"> r</span><span class="id"> *</span> (<span class="id">expR</span> (<span class="id">-</span> (<span class="id">r</span><span class="id"> *</span><span class="id"> a</span>)))<span class="id">%:E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> t0</span>.<br/>
<span class="id">rewrite</span><span class="id"> /mmt_gen_fun;</span><span class="id"> have</span><span class="id"> -&gt;</span><span class="id"> :</span><span class="id"> expR</span><span class="id"> \o</span><span class="id"> r</span><span class="id"> \o*</span><span class="id"> X</span><span class="id"> =</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">normr</span><span class="id"> \o</span><span class="id"> normr</span>)<span class="id"> \o</span><span class="id"> [the</span><span class="id"> {mfun</span><span class="id"> T</span><span class="id"> &gt;-&gt;</span><span class="id"> R}</span><span class="id"> of</span><span class="id"> expR</span><span class="id"> \o</span><span class="id"> r</span><span class="id"> \o*</span><span class="id"> X]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> funext</span><span class="id"> =&gt;</span><span class="id"> t</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> normr_id</span><span class="id"> ger0_norm</span><span class="id"> ?expR_ge0</span>.<br/>
<span class="id">rewrite</span><span class="id"> expRN</span><span class="id"> lee_pdivlMr</span><span class="id"> ?expR_gt0//</span>.<br/>
<span class="id">rewrite</span> (<span class="id">le_trans</span><span class="id"> _</span> (<span class="id">markov</span><span class="id"> _</span> (<span class="id">expR_gt0</span> (<span class="id">r</span><span class="id"> *</span><span class="id"> a</span>))<span class="id"> _</span><span class="id"> _</span><span class="id"> _</span>))<span class="id">//;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">exact:</span> (<span class="id">monoW_in</span> (<span class="id">@ger0_le_norm</span><span class="id"> _</span>)).<br/>
<span class="id">rewrite</span><span class="id"> ger0_norm</span><span class="id"> ?expR_ge0//</span><span class="id"> muleC</span><span class="id"> lee_pmul2l//</span><span class="id"> ?lte_fin</span><span class="id"> ?expR_gt0//</span>.<br/>
<span class="id">rewrite</span><span class="id"> [X</span><span class="gallina-kwd"> in</span><span class="id"> _</span><span class="id"> &lt;=</span><span class="id"> P</span><span class="id"> X]</span>(_<span class="id"> :</span><span class="id"> _</span><span class="id"> =</span><span class="id"> [set</span><span class="id"> x</span><span class="id"> |</span><span class="id"> a</span><span class="id"> &lt;=</span><span class="id"> X</span><span class="id"> x]%R</span>)<span class="id">//;</span><span class="id"> apply:</span><span class="id"> eq_set</span><span class="id"> =&gt;</span><span class="id"> t/=</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> ger0_norm</span><span class="id"> ?expR_ge0//</span><span class="id"> lee_fin</span><span class="id"> ler_expR</span> <span class="id"> mulrC</span><span class="id"> ler_pM2r</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> chebyshev</span> (<span class="id">X</span><span class="id"> :</span><span class="id"> {RV</span><span class="id"> P</span><span class="id"> &gt;-&gt;</span><span class="id"> R}</span>) (<span class="id">eps</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span> (<span class="id">0</span><span class="id"> &lt;</span><span class="id"> eps</span>)<span class="id">%R</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">P</span><span class="id"> [set</span><span class="id"> x</span><span class="id"> |</span> (<span class="id">eps</span><span class="id"> &lt;=</span><span class="id"> `|</span><span class="id"> X</span><span class="id"> x</span><span class="id"> -</span><span class="id"> fine</span> (<span class="id">'E_P[X]</span>)<span class="id">|</span>)<span class="id">%R</span><span class="id"> ]</span><span class="id"> &lt;=</span> (<span class="id">eps</span><span class="id"> ^-</span><span class="id"> 2</span>)<span class="id">%:E</span><span class="id"> *</span><span class="id"> 'V_P[X]</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move</span><span class="id"> =&gt;</span><span class="id"> heps;</span><span class="id"> have</span><span class="id"> [-&gt;|hv]</span><span class="id"> :=</span><span class="id"> eqVneq</span><span class="id"> 'V_P[X]</span><span class="id"> +oo</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> mulr_infty</span><span class="id"> gtr0_sg</span><span class="id"> ?mul1e//</span><span class="id"> ?leey//</span><span class="id"> invr_gt0//</span><span class="id"> exprn_gt0</span>.<br/>
<span class="id">have</span><span class="id"> h</span> (<span class="id">Y</span><span class="id"> :</span><span class="id"> {RV</span><span class="id"> P</span><span class="id"> &gt;-&gt;</span><span class="id"> R}</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">P</span><span class="id"> [set</span><span class="id"> x</span><span class="id"> |</span> (<span class="id">eps</span><span class="id"> &lt;=</span><span class="id"> `|Y</span><span class="id"> x|</span>)<span class="id">%R]</span><span class="id"> &lt;=</span> (<span class="id">eps</span><span class="id"> ^-</span><span class="id"> 2</span>)<span class="id">%:E</span><span class="id"> *</span><span class="id"> 'E_P[Y</span><span class="id"> ^+</span><span class="id"> 2]</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -lee_pdivrMl;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> invr_gt0//</span><span class="id"> exprn_gt0</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> exprnN</span><span class="id"> expfV</span><span class="id"> exprz_inv</span><span class="id"> opprK</span><span class="id"> -exprnP</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span> (<span class="id">@le_trans</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">'E_P[</span>(<span class="id">@GRing</span>.<span class="id">exp</span><span class="id"> R</span><span class="id"> ^~</span><span class="id"> 2%N</span><span class="id"> \o</span><span class="id"> normr</span>)<span class="id"> \o</span><span class="id"> Y]</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span> (<span class="id">@markov</span><span class="id"> Y</span> (<span class="id">@GRing</span>.<span class="id">exp</span><span class="id"> R</span><span class="id"> ^~</span><span class="id"> 2%N</span>))<span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> r</span><span class="id"> _;</span><span class="id"> exact:</span><span class="id"> sqr_ge0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> y;</span><span class="id"> rewrite</span><span class="id"> !nnegrE</span><span class="id"> =&gt;</span><span class="id"> x0</span><span class="id"> y0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> ler_sqr</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> expectation_le</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> measurableT_comp</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> measurableT_comp</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> /=;</span><span class="id"> exact:</span><span class="id"> sqr_ge0</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> /=;</span><span class="id"> exact:</span><span class="id"> sqr_ge0</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> apply/aeW</span><span class="id"> =&gt;</span><span class="id"> t</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> real_normK//</span><span class="id"> num_real</span>.<br/>
<span class="id">have</span><span class="id"> :=</span><span class="id"> h</span><span class="id"> [the</span><span class="id"> {mfun</span><span class="id"> T</span><span class="id"> &gt;-&gt;</span><span class="id"> R}</span><span class="id"> of</span> (<span class="id">X</span><span class="id"> \-</span><span class="id"> cst</span> (<span class="id">fine</span> (<span class="id">'E_P[X]</span>)))<span class="id">%R]</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> /le_trans;</span><span class="id"> apply;</span><span class="id"> rewrite</span><span class="id"> /variance</span><span class="id"> [in</span><span class="id"> leRHS]unlock</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> cantelli</span> (<span class="id">X</span><span class="id"> :</span><span class="id"> {RV</span><span class="id"> P</span><span class="id"> &gt;-&gt;</span><span class="id"> R}</span>) (<span class="id">lambda</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">P</span>.<span class="id">-integrable</span><span class="id"> setT</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> X</span>)<span class="id"> -&gt;</span><span class="id"> P</span>.<span class="id">-integrable</span><span class="id"> setT</span> (<span class="id">EFin</span><span class="id"> \o</span> (<span class="id">X</span><span class="id"> ^+</span><span class="id"> 2</span>)<span class="id">%R</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">0</span><span class="id"> &lt;</span><span class="id"> lambda</span>)<span class="id">%R</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">P</span><span class="id"> [set</span><span class="id"> x</span><span class="id"> |</span><span class="id"> lambda%:E</span><span class="id"> &lt;=</span> (<span class="id">X</span><span class="id"> x</span>)<span class="id">%:E</span><span class="id"> -</span><span class="id"> 'E_P[X]]</span><br/>
&nbsp;&nbsp;<span class="id">&lt;=</span> (<span class="id">fine</span><span class="id"> 'V_P[X]</span><span class="id"> /</span> (<span class="id">fine</span><span class="id"> 'V_P[X]</span><span class="id"> +</span><span class="id"> lambda^2</span>))<span class="id">%:E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> X1</span><span class="id"> X2</span><span class="id"> lambda_gt0</span>.<br/>
<span class="id">have</span><span class="id"> finEK</span><span class="id"> :</span> (<span class="id">fine</span><span class="id"> 'E_P[X]</span>)<span class="id">%:E</span><span class="id"> =</span><span class="id"> 'E_P[X]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> fineK</span><span class="id"> ?unlock</span><span class="id"> ?integral_fune_fin_num</span>.<br/>
<span class="id">have</span><span class="id"> finVK</span><span class="id"> :</span> (<span class="id">fine</span><span class="id"> 'V_P[X]</span>)<span class="id">%:E</span><span class="id"> =</span><span class="id"> 'V_P[X]</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> fineK</span><span class="id"> ?variance_fin_num</span>.<br/>
<span class="id">pose</span><span class="id"> Y</span><span class="id"> :=</span> (<span class="id">X</span><span class="id"> \-</span><span class="id"> cst</span> (<span class="id">fine</span><span class="id"> 'E_P[X]</span>))<span class="id">%R</span>.<br/>
<span class="id">have</span><span class="id"> Y1</span><span class="id"> :</span><span class="id"> P</span>.<span class="id">-integrable</span><span class="id"> [set:</span><span class="id"> T]</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> Y</span>).<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> compreBr</span><span class="id"> =&gt;</span><span class="id"> [|//];</span><span class="id"> apply:</span><span class="id"> integrableB</span><span class="id"> X1</span><span class="id"> _</span><span class="id"> =&gt;</span><span class="id"> [//|]</span>.<br/>
&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> finite_measure_integrable_cst</span>.<br/>
<span class="id">have</span><span class="id"> Y2</span><span class="id"> :</span><span class="id"> P</span>.<span class="id">-integrable</span><span class="id"> [set:</span><span class="id"> T]</span> (<span class="id">EFin</span><span class="id"> \o</span> (<span class="id">Y</span><span class="id"> ^+</span><span class="id"> 2</span>)<span class="id">%R</span>).<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> sqrrD/=</span><span class="id"> compreDr</span><span class="id"> =&gt;</span><span class="id"> [|//]</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> integrableD</span><span class="id"> =&gt;</span><span class="id"> [//||];</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -[</span>(_<span class="id"> ^+</span><span class="id"> 2</span>)<span class="id">%R]/</span>(<span class="id">cst</span> ((<span class="id">-</span><span class="id"> fine</span><span class="id"> 'E_P[X]</span>)<span class="id"> ^+</span><span class="id"> 2</span>)<span class="id">%R</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> finite_measure_integrable_cst</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> compreDr</span><span class="id"> =&gt;</span><span class="id"> [|//];</span><span class="id"> apply:</span><span class="id"> integrableD</span><span class="id"> X2</span><span class="id"> _</span><span class="id"> =&gt;</span><span class="id"> [//|]</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> [X</span><span class="gallina-kwd"> in</span><span class="id"> EFin</span><span class="id"> \o</span><span class="id"> X]</span>(_<span class="id"> :</span><span class="id"> _</span><span class="id"> =</span> (<span class="id">-</span><span class="id"> fine</span><span class="id"> 'E_P[X]</span><span class="id"> *</span><span class="id"> 2</span>)<span class="id"> \o*</span><span class="id"> X</span>)<span class="id">%R;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply/funeqP</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> -mulr_natl</span><span class="id"> mulrC</span><span class="id"> mulrA</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> compre_scale</span><span class="id"> =&gt;</span><span class="id"> [|//];</span><span class="id"> apply:</span><span class="id"> integrableZl</span><span class="id"> X1</span>.<br/>
<span class="id">have</span><span class="id"> EY</span><span class="id"> :</span><span class="id"> 'E_P[Y]</span><span class="id"> =</span><span class="id"> 0</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> expectationB/=</span><span class="id"> ?finite_measure_integrable_cst//</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> expectation_cst</span><span class="id"> finEK</span><span class="id"> subee//</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> unlock;</span><span class="id"> apply:</span><span class="id"> integral_fune_fin_num</span><span class="id"> X1</span>.<br/>
<span class="id">have</span><span class="id"> VY</span><span class="id"> :</span><span class="id"> 'V_P[Y]</span><span class="id"> =</span><span class="id"> 'V_P[X]</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> varianceB_cst_r</span>.<br/>
<span class="id">have</span><span class="id"> le</span> (<span class="id">u</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span> (<span class="id">0</span><span class="id"> &lt;=</span><span class="id"> u</span>)<span class="id">%R</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">P</span><span class="id"> [set</span><span class="id"> x</span><span class="id"> |</span><span class="id"> lambda%:E</span><span class="id"> &lt;=</span> (<span class="id">X</span><span class="id"> x</span>)<span class="id">%:E</span><span class="id"> -</span><span class="id"> 'E_P[X]]</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">&lt;=</span> ((<span class="id">fine</span><span class="id"> 'V_P[X]</span><span class="id"> +</span><span class="id"> u^2</span>)<span class="id"> /</span> (<span class="id">lambda</span><span class="id"> +</span><span class="id"> u</span>)<span class="id">^2</span>)<span class="id">%:E</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> uge0;</span><span class="id"> rewrite</span><span class="id"> EFinM</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> YU1</span><span class="id"> :</span><span class="id"> P</span>.<span class="id">-integrable</span><span class="id"> [set:</span><span class="id"> T]</span> (<span class="id">EFin</span><span class="id"> \o</span> (<span class="id">Y</span><span class="id"> \+</span><span class="id"> cst</span><span class="id"> u</span>)<span class="id">%R</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> compreDr</span><span class="id"> =&gt;</span><span class="id"> [|//];</span><span class="id"> apply:</span><span class="id"> integrableD</span><span class="id"> Y1</span><span class="id"> _</span><span class="id"> =&gt;</span><span class="id"> [//|]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> finite_measure_integrable_cst</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> YU2</span><span class="id"> :</span><span class="id"> P</span>.<span class="id">-integrable</span><span class="id"> [set:</span><span class="id"> T]</span> (<span class="id">EFin</span><span class="id"> \o</span> ((<span class="id">Y</span><span class="id"> \+</span><span class="id"> cst</span><span class="id"> u</span>)<span class="id"> ^+</span><span class="id"> 2</span>)<span class="id">%R</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> sqrrD/=</span><span class="id"> compreDr</span><span class="id"> =&gt;</span><span class="id"> [|//]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> integrableD</span><span class="id"> =&gt;</span><span class="id"> [//||];</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -[</span>(_<span class="id"> ^+</span><span class="id"> 2</span>)<span class="id">%R]/</span>(<span class="id">cst</span> (<span class="id">u</span><span class="id"> ^+</span><span class="id"> 2</span>))<span class="id">%R</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> finite_measure_integrable_cst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> compreDr</span><span class="id"> =&gt;</span><span class="id"> [|//];</span><span class="id"> apply:</span><span class="id"> integrableD</span><span class="id"> Y2</span><span class="id"> _</span><span class="id"> =&gt;</span><span class="id"> [//|]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> [X</span><span class="gallina-kwd"> in</span><span class="id"> EFin</span><span class="id"> \o</span><span class="id"> X]</span>(_<span class="id"> :</span><span class="id"> _</span><span class="id"> =</span> (<span class="id">2</span><span class="id"> *</span><span class="id"> u</span>)<span class="id"> \o*</span><span class="id"> Y</span>)<span class="id">%R;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply/funeqP</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> -mulr_natl</span><span class="id"> mulrCA</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> compre_scale</span><span class="id"> =&gt;</span><span class="id"> [|//];</span><span class="id"> apply:</span><span class="id"> integrableZl</span><span class="id"> Y1</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> -&gt;</span><span class="id"> :</span> (<span class="id">fine</span><span class="id"> 'V_P[X]</span><span class="id"> +</span><span class="id"> u^2</span>)<span class="id">%:E</span><span class="id"> =</span><span class="id"> 'E_P[</span>(<span class="id">Y</span><span class="id"> \+</span><span class="id"> cst</span><span class="id"> u</span>)<span class="id">^+2]%R</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -VY</span><span class="id"> -[RHS]</span>(<span class="id">@subeK</span><span class="id"> _</span><span class="id"> _</span> ((<span class="id">'E_P[</span>(<span class="id">Y</span><span class="id"> \+</span><span class="id"> cst</span><span class="id"> u</span>)<span class="id">%R]</span>)<span class="id">^+2</span>))<span class="id">;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> fin_numX</span><span class="id"> ?unlock</span><span class="id"> ?integral_fune_fin_num</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -varianceE/=</span><span class="id"> -/Y</span><span class="id"> -?expe2//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> expectationD/=</span><span class="id"> ?EY</span><span class="id"> ?add0e</span><span class="id"> ?expectation_cst</span><span class="id"> -?EFinM;</span><span class="id"> last</span><span class="id"> 2</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="id"> rewrite</span><span class="id"> compreBr</span><span class="id"> =&gt;</span><span class="id"> [|//];</span><span class="id"> apply:</span><span class="id"> integrableB</span><span class="id"> X1</span><span class="id"> _</span><span class="id"> =&gt;</span><span class="id"> [//|]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> finite_measure_integrable_cst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="id"> exact:</span><span class="id"> finite_measure_integrable_cst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span> (<span class="id">varianceD_cst_r</span><span class="id"> _</span><span class="id"> Y1</span><span class="id"> Y2</span>)<span class="id"> EFinD</span><span class="id"> fineK</span><span class="id"> ?</span>(<span class="id">variance_fin_num</span><span class="id"> Y1</span><span class="id"> Y2</span>).<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> le</span><span class="id"> :</span><span class="id"> [set</span><span class="id"> x</span><span class="id"> |</span><span class="id"> lambda%:E</span><span class="id"> &lt;=</span> (<span class="id">X</span><span class="id"> x</span>)<span class="id">%:E</span><span class="id"> -</span><span class="id"> 'E_P[X]]</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">`&lt;=`</span><span class="id"> [set</span><span class="id"> x</span><span class="id"> |</span> ((<span class="id">lambda</span><span class="id"> +</span><span class="id"> u</span>)<span class="id">^2</span>)<span class="id">%:E</span><span class="id"> &lt;=</span> ((<span class="id">Y</span><span class="id"> x</span><span class="id"> +</span><span class="id"> u</span>)<span class="id">^+2</span>)<span class="id">%:E]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> x</span><span class="id"> /=</span><span class="id"> le;</span><span class="id"> rewrite</span><span class="id"> lee_fin;</span><span class="id"> apply:</span><span class="id"> lerXn2r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="id"> exact:</span><span class="id"> addr_ge0</span> (<span class="id">ltW</span><span class="id"> lambda_gt0</span>)<span class="id"> _</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="id"> apply/</span>(<span class="id">addr_ge0</span><span class="id"> _</span><span class="id"> uge0</span>)<span class="id">/</span>(<span class="id">le_trans</span> (<span class="id">ltW</span><span class="id"> lambda_gt0</span>)<span class="id"> _</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -lee_fin</span><span class="id"> EFinB</span><span class="id"> finEK</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> lerD2r</span><span class="id"> -lee_fin</span><span class="id"> EFinB</span><span class="id"> finEK</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span> (<span class="id">le_trans</span> (<span class="id">le_measure</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> le</span>)).<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> rewrite</span><span class="id"> -[[set</span><span class="id"> _</span><span class="id"> |</span><span class="id"> _]]setTI</span><span class="id"> inE;</span><span class="id"> apply:</span><span class="id"> emeasurable_fun_c_infty</span><span class="id"> =&gt;</span><span class="id"> [//|]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> emeasurable_funB</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> measurable_int</span><span class="id"> X1</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> rewrite</span><span class="id"> -[[set</span><span class="id"> _</span><span class="id"> |</span><span class="id"> _]]setTI</span><span class="id"> inE;</span><span class="id"> apply:</span><span class="id"> emeasurable_fun_c_infty</span><span class="id"> =&gt;</span><span class="id"> [//|]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> measurable_EFinP</span><span class="id"> [X</span><span class="gallina-kwd"> in</span><span class="id"> measurable_fun</span><span class="id"> _</span><span class="id"> X]</span>(_<span class="id"> :</span><span class="id"> _</span><span class="id"> =</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> ^+</span><span class="id"> 2</span>)<span class="id"> \o</span> (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> Y</span><span class="id"> x</span><span class="id"> +</span><span class="id"> u</span>))<span class="id">%R//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply/measurableT_comp</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> apply/measurable_funD</span>.<br/>
&nbsp;&nbsp;<span class="id">set</span><span class="id"> eps</span><span class="id"> :=</span> ((<span class="id">lambda</span><span class="id"> +</span><span class="id"> u</span>)<span class="id"> ^</span><span class="id"> 2</span>)<span class="id">%R</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> peps</span><span class="id"> :</span> (<span class="id">0</span><span class="id"> &lt;</span><span class="id"> eps</span>)<span class="id">%R</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> exprz_gt0</span><span class="id"> ?ltr_wpDr</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> (<span class="id">lee_pdivlMr</span><span class="id"> _</span><span class="id"> _</span><span class="id"> peps</span>)<span class="id"> muleC</span>.<br/>
&nbsp;&nbsp;<span class="id">under</span><span class="id"> eq_set</span><span class="id"> =&gt;</span><span class="id"> x</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -[leRHS]gee0_abs</span><span class="id"> ?lee_fin</span><span class="id"> ?sqr_ge0</span><span class="id"> -?lee_fin</span><span class="id"> =&gt;</span><span class="id"> [|//]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -[</span>(_<span class="id"> ^+</span><span class="id"> 2</span>)<span class="id">%R]/</span>(((<span class="id">Y</span><span class="id"> \+</span><span class="id"> cst</span><span class="id"> u</span>)<span class="id"> ^+</span><span class="id"> 2</span>)<span class="id"> x</span>)<span class="id">%R;</span><span class="id"> over</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -[X</span><span class="gallina-kwd"> in</span><span class="id"> X%:E</span><span class="id"> *</span><span class="id"> _]gtr0_norm</span><span class="id"> =&gt;</span><span class="id"> [|//]</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span> (<span class="id">le_trans</span> (<span class="id">markov</span><span class="id"> _</span><span class="id"> peps</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span>))<span class="id"> =&gt;</span><span class="id"> //=</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> y</span><span class="id"> /[!nnegrE]</span><span class="id"> /ger0_norm-&gt;</span><span class="id"> /ger0_norm-&gt;</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -/Y</span><span class="id"> le_eqVlt;</span><span class="id"> apply/orP;</span><span class="id"> left;</span><span class="id"> apply/eqP;</span><span class="id"> congr</span><span class="id"> expectation</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply/funeqP</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> -expr2</span><span class="id"> normr_id</span><span class="id"> ger0_norm</span><span class="id"> ?sqr_ge0</span>.<br/>
<span class="id">pose</span><span class="id"> u0</span><span class="id"> :=</span> (<span class="id">fine</span><span class="id"> 'V_P[X]</span><span class="id"> /</span><span class="id"> lambda</span>)<span class="id">%R</span>.<br/>
<span class="id">have</span><span class="id"> u0ge0</span><span class="id"> :</span> (<span class="id">0</span><span class="id"> &lt;=</span><span class="id"> u0</span>)<span class="id">%R</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> divr_ge0</span> (<span class="id">ltW</span><span class="id"> lambda_gt0</span>)<span class="id">;</span><span class="id"> rewrite</span><span class="id"> -lee_fin</span><span class="id"> finVK</span><span class="id"> variance_ge0</span>.<br/>
<span class="id">apply:</span><span class="id"> le_trans</span> (<span class="id">le</span><span class="id"> _</span><span class="id"> u0ge0</span>)<span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> lee_fin</span><span class="id"> le_eqVlt;</span><span class="id"> apply/orP;</span><span class="id"> left</span>.<br/>
<span class="id">rewrite</span><span class="id"> eqr_div;</span><span class="id"> [|apply:</span><span class="id"> lt0r_neq0</span>..<span class="id">];</span><span class="id"> last</span><span class="id"> 2</span><span class="id"> first</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> exprz_gt0</span><span class="id"> -1?[ltLHS]addr0</span><span class="id"> ?ltr_leD</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> ltr_wpDl</span><span class="id"> ?fine_ge0</span><span class="id"> ?variance_ge0</span><span class="id"> ?exprz_gt0</span>.<br/>
<span class="id">apply/eqP;</span><span class="id"> have</span><span class="id"> -&gt;</span><span class="id"> :</span><span class="id"> fine</span><span class="id"> 'V_P[X]</span><span class="id"> =</span> (<span class="id">u0</span><span class="id"> *</span><span class="id"> lambda</span>)<span class="id">%R</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /u0</span><span class="id"> -mulrA</span><span class="id"> mulVr</span><span class="id"> ?mulr1</span><span class="id"> ?unitfE</span><span class="id"> ?gt_eqF</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -mulrDl</span><span class="id"> -mulrDr</span> (<span class="id">addrC</span><span class="id"> u0</span>)<span class="id"> [in</span><span class="id"> RHS]</span>(<span class="id">mulrAC</span><span class="id"> u0</span>)<span class="id"> -exprnP</span><span class="id"> expr2</span><span class="id"> !mulrA</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> markov_chebyshev_cantelli</span>.<br/>
<br/>
<span class="id">HB</span>.<span class="id">mixin</span><span class="vernacular"> Record</span><span class="id"> MeasurableFun_isDiscrete</span><span class="id"> d</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">X</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> R</span>)<span class="id"> of</span><span class="id"> @MeasurableFun</span><span class="id"> d</span><span class="id"> _</span><span class="id"> T</span><span class="id"> R</span><span class="id"> X</span><span class="id"> :=</span><span class="id"> {</span><br/>
&nbsp;&nbsp;<span class="id">countable_range</span><span class="id"> :</span><span class="id"> countable</span> (<span class="id">range</span><span class="id"> X</span>)<br/>
<span class="id">}</span>.<br/>
<br/>
<span class="id">HB</span>.<span class="id">structure</span><span class="vernacular"> Definition</span><span class="id"> discreteMeasurableFun</span><span class="id"> d</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>)<span class="id"> :=</span><span class="id"> {</span><br/>
&nbsp;&nbsp;<span class="id">X</span><span class="id"> of</span><span class="id"> isMeasurableFun</span><span class="id"> d</span><span class="id"> _</span><span class="id"> T</span><span class="id"> R</span><span class="id"> X</span><span class="id"> &amp;</span><span class="id"> MeasurableFun_isDiscrete</span><span class="id"> d</span><span class="id"> T</span><span class="id"> R</span><span class="id"> X</span><br/>
<span class="id">}</span>.<br/>
<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;{ 'dmfun' aT &gt;-&gt; T }&quot;</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;(<span class="id">@discreteMeasurableFun</span>.<span class="id">type</span><span class="id"> _</span><span class="id"> aT</span><span class="id"> T</span>)<span class="id"> :</span><span class="id"> form_scope</span>.<br/>
<br/>
<span class="vernacular">Definition</span><span class="id"> discrete_random_variable</span> (<span class="id">d</span><span class="id"> :</span><span class="id"> _</span>) (<span class="id">T</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d</span>)<br/>
&nbsp;&nbsp;(<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>) (<span class="id">P</span><span class="id"> :</span><span class="id"> probability</span><span class="id"> T</span><span class="id"> R</span>)<span class="id"> :=</span><span class="id"> {dmfun</span><span class="id"> T</span><span class="id"> &gt;-&gt;</span><span class="id"> R}</span>.<br/>
<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;{ 'dRV' P &gt;-&gt; R }&quot;</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;(<span class="id">@discrete_random_variable</span><span class="id"> _</span><span class="id"> _</span><span class="id"> R</span><span class="id"> P</span>)<span class="id"> :</span><span class="id"> form_scope</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> dRV_definitions</span>.<br/>
<span class="vernacular">Context</span><span class="id"> d</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>) (<span class="id">P</span><span class="id"> :</span><span class="id"> probability</span><span class="id"> T</span><span class="id"> R</span>).<br/>
<br/>
<span class="vernacular">Definition</span><span class="id"> dRV_dom_enum</span> (<span class="id">X</span><span class="id"> :</span><span class="id"> {dRV</span><span class="id"> P</span><span class="id"> &gt;-&gt;</span><span class="id"> R}</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">{</span><span class="id"> B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> nat</span><span class="id"> &amp;</span><span class="id"> {splitbij</span><span class="id"> B</span><span class="id"> &gt;-&gt;</span><span class="id"> range</span><span class="id"> X}}</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">have</span><span class="id"> /countable_bijP/cid[B]</span><span class="id"> :=</span><span class="id"> @countable_range</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> X</span>.<br/>
<span class="id">move/card_esym/ppcard_eqP/unsquash</span><span class="id"> =&gt;</span><span class="id"> f</span>.<br/>
<span class="gallina-kwd">exists</span><span class="id"> B;</span><span class="id"> exact:</span><span class="id"> f</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Definition</span><span class="id"> dRV_dom</span> (<span class="id">X</span><span class="id"> :</span><span class="id"> {dRV</span><span class="id"> P</span><span class="id"> &gt;-&gt;</span><span class="id"> R}</span>)<span class="id"> :</span><span class="id"> set</span><span class="id"> nat</span><span class="id"> :=</span><span class="id"> projT1</span> (<span class="id">dRV_dom_enum</span><span class="id"> X</span>).<br/>
<br/>
<span class="vernacular">Definition</span><span class="id"> dRV_enum</span> (<span class="id">X</span><span class="id"> :</span><span class="id"> {dRV</span><span class="id"> P</span><span class="id"> &gt;-&gt;</span><span class="id"> R}</span>)<span class="id"> :</span><span class="id"> {splitbij</span> (<span class="id">dRV_dom</span><span class="id"> X</span>)<span class="id"> &gt;-&gt;</span><span class="id"> range</span><span class="id"> X}</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">projT2</span> (<span class="id">dRV_dom_enum</span><span class="id"> X</span>).<br/>
<br/>
<span class="vernacular">Definition</span><span class="id"> enum_prob</span> (<span class="id">X</span><span class="id"> :</span><span class="id"> {dRV</span><span class="id"> P</span><span class="id"> &gt;-&gt;</span><span class="id"> R}</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">fun</span><span class="id"> k</span><span class="id"> =&gt;</span><span class="id"> P</span> (<span class="id">X</span><span class="id"> @^-1`</span><span class="id"> [set</span><span class="id"> dRV_enum</span><span class="id"> X</span><span class="id"> k]</span>))<span class="id"> \_</span> (<span class="id">dRV_dom</span><span class="id"> X</span>).<br/>
<br/>
<span class="vernacular">End</span><span class="id"> dRV_definitions</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> distribution_dRV</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<span class="vernacular">Context</span><span class="id"> d</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>) (<span class="id">P</span><span class="id"> :</span><span class="id"> probability</span><span class="id"> T</span><span class="id"> R</span>).<br/>
<span class="vernacular">Variable</span><span class="id"> X</span><span class="id"> :</span><span class="id"> {dRV</span><span class="id"> P</span><span class="id"> &gt;-&gt;</span><span class="id"> R}</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> distribution_dRV_enum</span> (<span class="id">n</span><span class="id"> :</span><span class="id"> nat</span>)<span class="id"> :</span><span class="id"> n</span><span class="id"> \in</span><span class="id"> dRV_dom</span><span class="id"> X</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">distribution</span><span class="id"> P</span><span class="id"> X</span><span class="id"> [set</span><span class="id"> dRV_enum</span><span class="id"> X</span><span class="id"> n]</span><span class="id"> =</span><span class="id"> enum_prob</span><span class="id"> X</span><span class="id"> n</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> nX;</span><span class="id"> rewrite</span><span class="id"> /distribution/=</span><span class="id"> /enum_prob/=</span><span class="id"> patchE</span><span class="id"> nX</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> distribution_dRV</span><span class="id"> A</span><span class="id"> :</span><span class="id"> measurable</span><span class="id"> A</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">distribution</span><span class="id"> P</span><span class="id"> X</span><span class="id"> A</span><span class="id"> =</span><span class="id"> \sum_</span>(<span class="id">k</span><span class="id"> &lt;oo</span>)<span class="id"> enum_prob</span><span class="id"> X</span><span class="id"> k</span><span class="id"> *</span><span class="id"> \d_</span> (<span class="id">dRV_enum</span><span class="id"> X</span><span class="id"> k</span>)<span class="id"> A</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> mA;</span><span class="id"> rewrite</span><span class="id"> /distribution</span><span class="id"> /pushforward</span>.<br/>
<span class="id">have</span><span class="id"> mAX</span><span class="id"> i</span><span class="id"> :</span><span class="id"> dRV_dom</span><span class="id"> X</span><span class="id"> i</span><span class="id"> -&gt;</span><span class="id"> measurable</span> (<span class="id">X</span><span class="id"> @^-1`</span> (<span class="id">A</span><span class="id"> `&amp;`</span><span class="id"> [set</span><span class="id"> dRV_enum</span><span class="id"> X</span><span class="id"> i]</span>)).<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> preimage_setI;</span><span class="id"> apply:</span><span class="id"> measurableI</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="id">exact/measurable_sfunP</span>.<br/>
<span class="id">have</span><span class="id"> tAX</span><span class="id"> :</span><span class="id"> trivIset</span> (<span class="id">dRV_dom</span><span class="id"> X</span>) (<span class="gallina-kwd">fun</span><span class="id"> k</span><span class="id"> =&gt;</span><span class="id"> X</span><span class="id"> @^-1`</span> (<span class="id">A</span><span class="id"> `&amp;`</span><span class="id"> [set</span><span class="id"> dRV_enum</span><span class="id"> X</span><span class="id"> k]</span>)).<br/>
&nbsp;&nbsp;<span class="id">under</span><span class="id"> eq_fun</span><span class="id"> do</span><span class="id"> rewrite</span><span class="id"> preimage_setI;</span><span class="id"> rewrite</span><span class="id"> -/</span>(<span class="id">trivIset</span><span class="id"> _</span><span class="id"> _</span>).<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> trivIset_setIl;</span><span class="id"> apply/trivIsetP</span><span class="id"> =&gt;</span><span class="id"> i</span><span class="id"> j</span><span class="id"> iX</span><span class="id"> jX</span><span class="id"> /eqP</span><span class="id"> ij</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -preimage_setI</span> (_<span class="id"> :</span><span class="id"> _</span><span class="id"> `&amp;`</span><span class="id"> _</span><span class="id"> =</span><span class="id"> set0</span>)<span class="id">//</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply/seteqP;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //=</span><span class="id"> x</span><span class="id"> []</span><span class="id"> -&gt;</span><span class="id"> {x}</span><span class="id"> /inj;</span><span class="id"> rewrite</span><span class="id"> inE</span><span class="id"> inE</span><span class="id"> =&gt;</span><span class="id"> /</span>(_<span class="id"> iX</span><span class="id"> jX</span>).<br/>
<span class="id">have</span><span class="id"> :=</span><span class="id"> measure_bigcup</span><span class="id"> P</span><span class="id"> _</span> (<span class="gallina-kwd">fun</span><span class="id"> k</span><span class="id"> =&gt;</span><span class="id"> X</span><span class="id"> @^-1`</span> (<span class="id">A</span><span class="id"> `&amp;`</span><span class="id"> [set</span><span class="id"> dRV_enum</span><span class="id"> X</span><span class="id"> k]</span>))<span class="id"> mAX</span><span class="id"> tAX</span>.<br/>
<span class="id">rewrite</span><span class="id"> -preimage_bigcup</span><span class="id"> =&gt;</span><span class="id"> {mAX</span><span class="id"> tAX}PXU</span>.<br/>
<span class="id">rewrite</span><span class="id"> -{1}</span>(<span class="id">setIT</span><span class="id"> A</span>)<span class="id"> -</span>(<span class="id">setUv</span> (<span class="id">\bigcup_</span>(<span class="id">i</span><span class="gallina-kwd"> in</span><span class="id"> dRV_dom</span><span class="id"> X</span>)<span class="id"> [set</span><span class="id"> dRV_enum</span><span class="id"> X</span><span class="id"> i]</span>)).<br/>
<span class="id">rewrite</span><span class="id"> setIUr</span><span class="id"> preimage_setU</span><span class="id"> measureU;</span><span class="id"> last</span><span class="id"> 3</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> rewrite</span><span class="id"> preimage_setI;</span><span class="id"> apply:</span><span class="id"> measurableI</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> measurable_sfunP</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> measurable_sfunP;</span><span class="id"> exact:</span><span class="id"> bigcup_measurable</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> apply:</span><span class="id"> measurable_sfunP;</span><span class="id"> apply:</span><span class="id"> measurableI</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> measurableC;</span><span class="id"> exact:</span><span class="id"> bigcup_measurable</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> rewrite</span><span class="id"> 2!preimage_setI</span><span class="id"> setIACA</span><span class="id"> -!setIA</span><span class="id"> -preimage_setI</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> setICr</span><span class="id"> preimage_set0</span><span class="id"> 2!setI0</span>.<br/>
<span class="id">rewrite</span><span class="id"> [X</span><span class="gallina-kwd"> in</span><span class="id"> _</span><span class="id"> +</span><span class="id"> X</span><span class="id"> =</span><span class="id"> _]</span>(_<span class="id"> :</span><span class="id"> _</span><span class="id"> =</span><span class="id"> 0</span>)<span class="id"> ?adde0;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> (_<span class="id"> :</span><span class="id"> _</span><span class="id"> @^-1`</span><span class="id"> _</span><span class="id"> =</span><span class="id"> set0</span>)<span class="id"> ?measure0//;</span><span class="id"> apply/disjoints_subset</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> AXx</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> setCK</span><span class="id"> /bigcup</span><span class="id"> /=;</span><span class="gallina-kwd"> exists</span> ((<span class="id">dRV_enum</span><span class="id"> X</span>)<span class="id">^-1</span> (<span class="id">X</span><span class="id"> x</span>))<span class="id">%function</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> funS</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> invK//</span><span class="id"> inE</span>.<br/>
<span class="id">rewrite</span><span class="id"> setI_bigcupr;</span><span class="id"> etransitivity;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> PXU</span>.<br/>
<span class="id">rewrite</span><span class="id"> eseries_mkcond;</span><span class="id"> apply:</span><span class="id"> eq_eseriesr</span><span class="id"> =&gt;</span><span class="id"> k</span><span class="id"> _</span>.<br/>
<span class="id">rewrite</span><span class="id"> /enum_prob</span><span class="id"> patchE;</span><span class="id"> case:</span><span class="id"> ifPn</span><span class="id"> =&gt;</span><span class="id"> nX;</span><span class="id"> rewrite</span><span class="id"> ?mul0e//</span>.<br/>
<span class="id">rewrite</span><span class="id"> diracE;</span><span class="id"> have</span><span class="id"> [kA|]</span><span class="id"> :=</span><span class="id"> boolP</span> (_<span class="id"> \in</span><span class="id"> A</span>).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> mule1</span><span class="id"> setIidr//</span><span class="id"> =&gt;</span><span class="id"> _</span><span class="id"> /=</span><span class="id"> -&gt;;</span><span class="id"> exact:</span><span class="id"> set_mem</span>.<br/>
<span class="id">rewrite</span><span class="id"> notin_setE</span><span class="id"> =&gt;</span><span class="id"> kA</span>.<br/>
<span class="id">rewrite</span><span class="id"> mule0</span> (<span class="id">disjoints_subset</span><span class="id"> _</span><span class="id"> _</span>).<span class="id">2</span><span class="id"> ?preimage_set0</span><span class="id"> ?measure0//</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> subsetCr;</span><span class="id"> rewrite</span><span class="id"> sub1set</span><span class="id"> inE</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> sum_enum_prob</span><span class="id"> :</span><span class="id"> \sum_</span>(<span class="id">n</span><span class="id"> &lt;oo</span>) (<span class="id">enum_prob</span><span class="id"> X</span>)<span class="id"> n</span><span class="id"> =</span><span class="id"> 1</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">have</span><span class="id"> :=</span><span class="id"> distribution_dRV</span><span class="id"> measurableT</span>.<br/>
<span class="id">rewrite</span><span class="id"> probability_setT/=</span><span class="id"> =&gt;</span><span class="id"> /esym;</span><span class="id"> apply:</span><span class="id"> eq_trans</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> [RHS]eseries_mkcond;</span><span class="id"> apply:</span><span class="id"> eq_eseriesr</span><span class="id"> =&gt;</span><span class="id"> k</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> diracT</span><span class="id"> mule1</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> distribution_dRV</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> discrete_distribution</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<span class="vernacular">Context</span><span class="id"> d</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>) (<span class="id">P</span><span class="id"> :</span><span class="id"> probability</span><span class="id"> T</span><span class="id"> R</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> dRV_expectation</span> (<span class="id">X</span><span class="id"> :</span><span class="id"> {dRV</span><span class="id"> P</span><span class="id"> &gt;-&gt;</span><span class="id"> R}</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">P</span>.<span class="id">-integrable</span><span class="id"> [set:</span><span class="id"> T]</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> X</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">'E_P[X]</span><span class="id"> =</span><span class="id"> \sum_</span>(<span class="id">n</span><span class="id"> &lt;oo</span>)<span class="id"> enum_prob</span><span class="id"> X</span><span class="id"> n</span><span class="id"> *</span> (<span class="id">dRV_enum</span><span class="id"> X</span><span class="id"> n</span>)<span class="id">%:E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> ix;</span><span class="id"> rewrite</span><span class="id"> unlock</span>.<br/>
<span class="id">rewrite</span><span class="id"> -[in</span><span class="id"> LHS]</span>(_<span class="id"> :</span><span class="id"> \bigcup_k</span> (<span class="gallina-kwd">if</span><span class="id"> k</span><span class="id"> \in</span><span class="id"> dRV_dom</span><span class="id"> X</span><span class="gallina-kwd"> then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">X</span><span class="id"> @^-1`</span><span class="id"> [set</span><span class="id"> dRV_enum</span><span class="id"> X</span><span class="id"> k]</span><span class="gallina-kwd"> else</span><span class="id"> set0</span>)<span class="id"> =</span><span class="id"> setT</span>)<span class="id">;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">apply/seteqP;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> t</span><span class="id"> _</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">exists</span> ((<span class="id">dRV_enum</span><span class="id"> X</span>)<span class="id">^-1%function</span> (<span class="id">X</span><span class="id"> t</span>))<span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="id">case:</span><span class="id"> ifPn=&gt;</span><span class="id"> [_|]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> invK//</span><span class="id"> inE</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> notin_setE/=;</span><span class="id"> apply;</span><span class="id"> apply:</span><span class="id"> funS</span>.<br/>
<span class="id">have</span><span class="id"> tA</span><span class="id"> :</span><span class="id"> trivIset</span> (<span class="id">dRV_dom</span><span class="id"> X</span>) (<span class="gallina-kwd">fun</span><span class="id"> k</span><span class="id"> =&gt;</span><span class="id"> [set</span><span class="id"> dRV_enum</span><span class="id"> X</span><span class="id"> k]</span>).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> i</span><span class="id"> j</span><span class="id"> iX</span><span class="id"> jX</span><span class="id"> [r</span><span class="id"> [/=</span><span class="id"> -&gt;{r}]]</span><span class="id"> /inj;</span><span class="id"> rewrite</span><span class="id"> !inE;</span><span class="id"> exact</span>.<br/>
<span class="id">have</span><span class="id"> {tA}/trivIset_mkcond</span><span class="id"> tXA</span><span class="id"> :</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">trivIset</span> (<span class="id">dRV_dom</span><span class="id"> X</span>) (<span class="gallina-kwd">fun</span><span class="id"> k</span><span class="id"> =&gt;</span><span class="id"> X</span><span class="id"> @^-1`</span><span class="id"> [set</span><span class="id"> dRV_enum</span><span class="id"> X</span><span class="id"> k]</span>).<br/>
&nbsp;&nbsp;<span class="id">apply/trivIsetP</span><span class="id"> =&gt;</span><span class="id"> /=</span><span class="id"> i</span><span class="id"> j</span><span class="id"> iX</span><span class="id"> jX</span><span class="id"> ij</span>.<br/>
&nbsp;&nbsp;<span class="id">move/trivIsetP</span><span class="id"> :</span><span class="id"> tA</span><span class="id"> =&gt;</span><span class="id"> /</span>(_<span class="id"> i</span><span class="id"> j</span><span class="id"> iX</span><span class="id"> jX</span>)<span class="id"> Aij</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -preimage_setI</span><span class="id"> Aij</span><span class="id"> ?preimage_set0</span>.<br/>
<span class="id">rewrite</span><span class="id"> integral_bigcup</span><span class="id"> //;</span><span class="id"> last</span><span class="id"> 2</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> k;</span><span class="id"> case:</span><span class="id"> ifPn</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> apply:</span> (<span class="id">integrableS</span><span class="id"> measurableT</span>)<span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -bigcup_mkcond;</span><span class="id"> exact:</span><span class="id"> bigcup_measurable</span>.<br/>
<span class="id">transitivity</span> (<span class="id">\sum_</span>(<span class="id">i</span><span class="id"> &lt;oo</span>)<br/>
&nbsp;&nbsp;<span class="id">\int[P]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span> (<span class="gallina-kwd">if</span><span class="id"> i</span><span class="id"> \in</span><span class="id"> dRV_dom</span><span class="id"> X</span><span class="gallina-kwd"> then</span><span class="id"> X</span><span class="id"> @^-1`</span><span class="id"> [set</span><span class="id"> dRV_enum</span><span class="id"> X</span><span class="id"> i]</span><span class="gallina-kwd"> else</span><span class="id"> set0</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">dRV_enum</span><span class="id"> X</span><span class="id"> i</span>)<span class="id">%:E</span>).<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> eq_eseriesr</span><span class="id"> =&gt;</span><span class="id"> i</span><span class="id"> _;</span><span class="id"> case:</span><span class="id"> ifPn</span><span class="id"> =&gt;</span><span class="id"> iX</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> eq_integral</span><span class="id"> =&gt;</span><span class="id"> t;</span><span class="id"> rewrite</span><span class="id"> in_setE/=</span><span class="id"> =&gt;</span><span class="id"> -&gt;</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> !integral_set0</span>.<br/>
<span class="id">transitivity</span> (<span class="id">\sum_</span>(<span class="id">i</span><span class="id"> &lt;oo</span>) (<span class="id">dRV_enum</span><span class="id"> X</span><span class="id"> i</span>)<span class="id">%:E</span><span class="id"> *</span><br/>
&nbsp;&nbsp;<span class="id">\int[P]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span> (<span class="gallina-kwd">if</span><span class="id"> i</span><span class="id"> \in</span><span class="id"> dRV_dom</span><span class="id"> X</span><span class="gallina-kwd"> then</span><span class="id"> X</span><span class="id"> @^-1`</span><span class="id"> [set</span><span class="id"> dRV_enum</span><span class="id"> X</span><span class="id"> i]</span><span class="gallina-kwd"> else</span><span class="id"> set0</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">1</span>).<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> eq_eseriesr</span><span class="id"> =&gt;</span><span class="id"> i</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> -integralZl//;</span><span class="id"> last</span><span class="id"> 2</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> case:</span><span class="id"> ifPn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="id"> apply/integrableP;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> (<span class="id">eq_integral</span> (<span class="id">cst</span><span class="id"> 1%E</span>))<span class="id">;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> abse1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> integral_cst//;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> case:</span><span class="id"> ifPn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> mul1e</span> (<span class="id">@le_lt_trans</span><span class="id"> _</span><span class="id"> _</span><span class="id"> 1%E</span>)<span class="id"> ?ltey//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> case:</span><span class="id"> ifPn</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> _;</span><span class="id"> exact:</span><span class="id"> probability_le1</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> eq_integral</span><span class="id"> =&gt;</span><span class="id"> y</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> mule1</span>.<br/>
<span class="id">apply:</span><span class="id"> eq_eseriesr</span><span class="id"> =&gt;</span><span class="id"> k</span><span class="id"> _;</span><span class="id"> case:</span><span class="id"> ifPn</span><span class="id"> =&gt;</span><span class="id"> kX</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> /=</span><span class="id"> integral_cst//=</span><span class="id"> mul1e</span><span class="id"> probability_distribution</span><span class="id"> muleC</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> distribution_dRV_enum</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> integral_set0</span><span class="id"> mule0</span><span class="id"> /enum_prob</span><span class="id"> patchE</span> (<span class="id">negbTE</span><span class="id"> kX</span>)<span class="id"> mul0e</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Definition</span><span class="id"> pmf</span> (<span class="id">X</span><span class="id"> :</span><span class="id"> {RV</span><span class="id"> P</span><span class="id"> &gt;-&gt;</span><span class="id"> R}</span>) (<span class="id">r</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span><span class="id"> R</span><span class="id"> :=</span><span class="id"> fine</span> (<span class="id">P</span> (<span class="id">X</span><span class="id"> @^-1`</span><span class="id"> [set</span><span class="id"> r]</span>)).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> expectation_pmf</span> (<span class="id">X</span><span class="id"> :</span><span class="id"> {dRV</span><span class="id"> P</span><span class="id"> &gt;-&gt;</span><span class="id"> R}</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">P</span>.<span class="id">-integrable</span><span class="id"> [set:</span><span class="id"> T]</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> X</span>)<span class="id"> -&gt;</span><span class="id"> 'E_P[X]</span><span class="id"> =</span><br/>
&nbsp;&nbsp;<span class="id">\sum_</span>(<span class="id">n</span><span class="id"> &lt;oo</span><span class="id"> |</span><span class="id"> n</span><span class="id"> \in</span><span class="id"> dRV_dom</span><span class="id"> X</span>) (<span class="id">pmf</span><span class="id"> X</span> (<span class="id">dRV_enum</span><span class="id"> X</span><span class="id"> n</span>))<span class="id">%:E</span><span class="id"> *</span> (<span class="id">dRV_enum</span><span class="id"> X</span><span class="id"> n</span>)<span class="id">%:E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> iX;</span><span class="id"> rewrite</span><span class="id"> dRV_expectation//</span><span class="id"> [in</span><span class="id"> RHS]eseries_mkcond</span>.<br/>
<span class="id">apply:</span><span class="id"> eq_eseriesr</span><span class="id"> =&gt;</span><span class="id"> k</span><span class="id"> _</span>.<br/>
<span class="id">rewrite</span><span class="id"> /enum_prob</span><span class="id"> patchE;</span><span class="id"> case:</span><span class="id"> ifPn</span><span class="id"> =&gt;</span><span class="id"> kX;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> mul0e</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /pmf</span><span class="id"> fineK//</span><span class="id"> fin_num_measure</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> discrete_distribution</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> bernoulli_pmf</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {R</span><span class="id"> :</span><span class="id"> realType}</span> (<span class="id">p</span><span class="id"> :</span><span class="id"> R</span>).<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ring_scope</span>.<br/>
<br/>
<span class="vernacular">Definition</span><span class="id"> bernoulli_pmf</span><span class="id"> b</span><span class="id"> :=</span><span class="gallina-kwd"> if</span><span class="id"> b</span><span class="gallina-kwd"> then</span><span class="id"> p</span><span class="gallina-kwd"> else</span><span class="id"> 1</span><span class="id"> -</span><span class="id"> p</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> bernoulli_pmf_ge0</span> (<span class="id">p01</span><span class="id"> :</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> p</span><span class="id"> &lt;=</span><span class="id"> 1</span>)<span class="id"> b</span><span class="id"> :</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> bernoulli_pmf</span><span class="id"> b</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> /bernoulli_pmf</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> move:</span><span class="id"> p01</span><span class="id"> =&gt;</span><span class="id"> /andP[p0</span><span class="id"> p1];</span><span class="id"> case:</span><span class="id"> ifPn</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> subr_ge0</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> bernoulli_pmf1</span> (<span class="id">p01</span><span class="id"> :</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> p</span><span class="id"> &lt;=</span><span class="id"> 1</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">\sum_</span>(<span class="id">i</span><span class="id"> \in</span><span class="id"> [set:</span><span class="id"> bool]</span>) (<span class="id">bernoulli_pmf</span><span class="id"> i</span>)<span class="id">%:E</span><span class="id"> =</span><span class="id"> 1%E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> setT_bool</span><span class="id"> fsbigU//=;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> [/=</span><span class="id"> -&gt;]</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> !fsbig_set1/=</span><span class="id"> -EFinD</span><span class="id"> addrCA</span><span class="id"> subrr</span><span class="id"> addr0</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> bernoulli_pmf</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> measurable_bernoulli_pmf</span><span class="id"> {R</span><span class="id"> :</span><span class="id"> realType}</span><span class="id"> D</span><span class="id"> n</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">measurable_fun</span><span class="id"> D</span> (<span class="id">@bernoulli_pmf</span><span class="id"> R</span><span class="id"> ^~</span><span class="id"> n</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd">by</span><span class="id"> apply/measurable_funTS/measurable_fun_if</span><span class="id"> =&gt;</span><span class="id"> //=;</span><span class="id"> exact:</span><span class="id"> measurable_funB</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Definition</span><span class="id"> bernoulli</span><span class="id"> {R</span><span class="id"> :</span><span class="id"> realType}</span> (<span class="id">p</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span><span class="id"> set</span><span class="id"> bool</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span><span class="id"> :=</span><span class="gallina-kwd"> fun</span><span class="id"> A</span><span class="id"> =&gt;</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">if</span> (<span class="id">0</span><span class="id"> &lt;=</span><span class="id"> p</span><span class="id"> &lt;=</span><span class="id"> 1</span>)<span class="id">%R</span><span class="gallina-kwd"> then</span><span class="id"> \sum_</span>(<span class="id">b</span><span class="id"> \in</span><span class="id"> A</span>) (<span class="id">bernoulli_pmf</span><span class="id"> p</span><span class="id"> b</span>)<span class="id">%:E</span><span class="gallina-kwd"> else</span><span class="id"> \d_false</span><span class="id"> A</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> bernoulli</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {R</span><span class="id"> :</span><span class="id"> realType}</span> (<span class="id">p</span><span class="id"> :</span><span class="id"> R</span>).<br/>
<br/>
<span class="vernacular">Local</span><span class="vernacular"> Notation</span><span class="id"> bernoulli</span><span class="id"> :=</span> (<span class="id">bernoulli</span><span class="id"> p</span>).<br/>
<br/>
<span class="vernacular">Let</span><span class="id"> bernoulli0</span><span class="id"> :</span><span class="id"> bernoulli</span><span class="id"> set0</span><span class="id"> =</span><span class="id"> 0</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /bernoulli;</span><span class="id"> case:</span><span class="id"> ifPn</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> p01;</span><span class="id"> rewrite</span><span class="id"> fsbig_set0</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Let</span><span class="id"> bernoulli_ge0</span><span class="id"> U</span><span class="id"> :</span> (<span class="id">0</span><span class="id"> &lt;=</span><span class="id"> bernoulli</span><span class="id"> U</span>)<span class="id">%E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> /bernoulli;</span><span class="id"> case:</span><span class="id"> ifPn</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> p01</span>.<br/>
<span class="id">rewrite</span><span class="id"> fsbig_finite//=</span><span class="id"> sumEFin</span><span class="id"> lee_fin</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> sumr_ge0</span><span class="id"> =&gt;</span><span class="id"> /=</span><span class="id"> b</span><span class="id"> _;</span><span class="id"> exact:</span><span class="id"> bernoulli_pmf_ge0</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Let</span><span class="id"> bernoulli_sigma_additive</span><span class="id"> :</span><span class="id"> semi_sigma_additive</span><span class="id"> bernoulli</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> F</span><span class="id"> mF</span><span class="id"> tF</span><span class="id"> mUF;</span><span class="id"> rewrite</span><span class="id"> /bernoulli;</span><span class="id"> case:</span><span class="id"> ifPn</span><span class="id"> =&gt;</span><span class="id"> p01;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> measure_semi_sigma_additive</span>.<br/>
<span class="id">apply:</span><span class="id"> cvg_toP</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> ereal_nondecreasing_is_cvgn</span><span class="id"> =&gt;</span><span class="id"> m</span><span class="id"> n</span><span class="id"> mn</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> lee_sum_nneg_natr</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> k</span><span class="id"> _</span><span class="id"> _</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> fsbig_finite//=</span><span class="id"> sumEFin</span><span class="id"> lee_fin</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> sumr_ge0</span><span class="id"> =&gt;</span><span class="id"> /=</span><span class="id"> b</span><span class="id"> _;</span><span class="id"> exact:</span><span class="id"> bernoulli_pmf_ge0</span>.<br/>
<span class="id">transitivity</span> (<span class="id">\sum_</span>(<span class="id">0</span><span class="id"> &lt;=</span><span class="id"> i</span><span class="id"> &lt;oo</span>) (<span class="id">\esum_</span>(<span class="id">j</span><span class="gallina-kwd"> in</span><span class="id"> F</span><span class="id"> i</span>) (<span class="id">bernoulli_pmf</span><span class="id"> p</span><span class="id"> j</span>)<span class="id">%:E</span>)<span class="id">%R</span>)<span class="id">%E</span>.<br/>
<span class="id">apply:</span><span class="id"> eq_eseriesr</span><span class="id"> =&gt;</span><span class="id"> k</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> esum_fset//=</span><span class="id"> =&gt;</span><span class="id"> b</span><span class="id"> _</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> lee_fin</span><span class="id"> bernoulli_pmf_ge0</span>.<br/>
<span class="id">rewrite</span><span class="id"> -nneseries_sum_bigcup//=;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> b;</span><span class="id"> rewrite</span><span class="id"> lee_fin</span><span class="id"> bernoulli_pmf_ge0</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> esum_fset//=</span><span class="id"> =&gt;</span><span class="id"> b</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> lee_fin</span><span class="id"> bernoulli_pmf_ge0</span>.<br/>
Qed.</div></details>
<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> isMeasure</span>.<span class="id">Build</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> bernoulli</span><br/>
&nbsp;&nbsp;<span class="id">bernoulli0</span><span class="id"> bernoulli_ge0</span><span class="id"> bernoulli_sigma_additive</span>.<br/>
<br/>
<span class="vernacular">Let</span><span class="id"> bernoulli_setT</span><span class="id"> :</span><span class="id"> bernoulli</span><span class="id"> [set:</span><span class="id"> _]</span><span class="id"> =</span><span class="id"> 1%E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> /bernoulli/=;</span><span class="id"> case:</span><span class="id"> ifPn</span><span class="id"> =&gt;</span><span class="id"> p01;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> probability_setT</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> bernoulli_pmf1</span>.<br/>
Qed.</div></details>
<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">@Measure_isProbability</span>.<span class="id">Build</span><span class="id"> _</span><span class="id"> _</span><span class="id"> R</span><span class="id"> bernoulli</span><span class="id"> bernoulli_setT</span>.<br/>
<br/>
<span class="vernacular">End</span><span class="id"> bernoulli</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> bernoulli_measure</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {R</span><span class="id"> :</span><span class="id"> realType}</span>.<br/>
<span class="vernacular">Variables</span> (<span class="id">p</span><span class="id"> :</span><span class="id"> R</span>) (<span class="id">p0</span><span class="id"> :</span> (<span class="id">0</span><span class="id"> &lt;=</span><span class="id"> p</span>)<span class="id">%R</span>) (<span class="id">p1</span><span class="id"> :</span> ((<span class="id">NngNum</span><span class="id"> p0</span>)<span class="id">%:num</span><span class="id"> &lt;=</span><span class="id"> 1</span>)<span class="id">%R</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> bernoulli_dirac</span><span class="id"> :</span><span class="id"> bernoulli</span><span class="id"> p</span><span class="id"> =</span><span class="id"> measure_add</span><br/>
&nbsp;&nbsp;(<span class="id">mscale</span> (<span class="id">NngNum</span><span class="id"> p0</span>)<span class="id"> \d_true</span>) (<span class="id">mscale</span> (<span class="id">onem_nonneg</span><span class="id"> p1</span>)<span class="id"> \d_false</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">apply/funext</span><span class="id"> =&gt;</span><span class="id"> U;</span><span class="id"> rewrite</span><span class="id"> /bernoulli;</span><span class="id"> case:</span><span class="id"> ifPn</span><span class="id"> =&gt;</span><span class="id"> [p01|];</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> p0/=</span><span class="id"> p1</span>.<br/>
<span class="id">rewrite</span><span class="id"> measure_addE/=</span><span class="id"> /mscale/=</span>.<br/>
<span class="id">have</span><span class="id"> :=</span><span class="id"> @subsetT</span><span class="id"> _</span><span class="id"> U;</span><span class="id"> rewrite</span><span class="id"> setT_bool</span><span class="id"> =&gt;</span><span class="id"> UT</span>.<br/>
<span class="id">have</span><span class="id"> [-&gt;|-&gt;|-&gt;|-&gt;]</span><span class="id"> /=</span><span class="id"> :=</span><span class="id"> subset_set2</span><span class="id"> UT</span>.<br/>
<span class="id">-</span><span class="id"> rewrite</span><span class="id"> -esum_fset//=;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> b;</span><span class="id"> rewrite</span><span class="id"> lee_fin</span><span class="id"> bernoulli_pmf_ge0</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> esum_set0</span><span class="id"> 2!measure0</span><span class="id"> 2!mule0</span><span class="id"> adde0</span>.<br/>
<span class="id">-</span><span class="id"> rewrite</span><span class="id"> -esum_fset//=;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> b;</span><span class="id"> rewrite</span><span class="id"> lee_fin</span><span class="id"> bernoulli_pmf_ge0</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> esum_set1/=</span><span class="id"> ?lee_fin//</span><span class="id"> 2!diracE</span><span class="id"> mem_set//=</span><span class="id"> memNset//=</span><span class="id"> mule0</span><span class="id"> adde0</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> mule1</span>.<br/>
<span class="id">-</span><span class="id"> rewrite</span><span class="id"> -esum_fset//=;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> b;</span><span class="id"> rewrite</span><span class="id"> lee_fin</span><span class="id"> bernoulli_pmf_ge0</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> esum_set1/=</span><span class="id"> ?lee_fin</span><span class="id"> ?subr_ge0//</span><span class="id"> 2!diracE</span><span class="id"> memNset//=</span><span class="id"> mem_set//=</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> mule0</span><span class="id"> add0e</span><span class="id"> mule1</span>.<br/>
<span class="id">-</span><span class="id"> rewrite</span><span class="id"> fsbigU//=;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> [-&gt;]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> 2!fsbig_set1/=</span><span class="id"> -setT_bool</span><span class="id"> 2!diracT</span><span class="id"> !mule1</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> bernoulli_measure</span>.<br/>
<span class="vernacular">Arguments</span><span class="id"> bernoulli</span><span class="id"> {R}</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> integral_bernoulli</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {R</span><span class="id"> :</span><span class="id"> realType}</span>.<br/>
<span class="vernacular">Variables</span> (<span class="id">p</span><span class="id"> :</span><span class="id"> R</span>) (<span class="id">p01</span><span class="id"> :</span> (<span class="id">0</span><span class="id"> &lt;=</span><span class="id"> p</span><span class="id"> &lt;=</span><span class="id"> 1</span>)<span class="id">%R</span>).<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> bernoulliE</span><span class="id"> A</span><span class="id"> :</span><span class="id"> bernoulli</span><span class="id"> p</span><span class="id"> A</span><span class="id"> =</span><span class="id"> p%:E</span><span class="id"> *</span><span class="id"> \d_true</span><span class="id"> A</span><span class="id"> +</span> (<span class="id">`1-p</span>)<span class="id">%:E</span><span class="id"> *</span><span class="id"> \d_false</span><span class="id"> A</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> case/andP</span><span class="id"> :</span><span class="id"> p01</span><span class="id"> =&gt;</span><span class="id"> p0</span><span class="id"> p1;</span><span class="id"> rewrite</span><span class="id"> bernoulli_dirac//</span><span class="id"> measure_addE</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> integral_bernoulli</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> bool</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id"> :</span> (<span class="gallina-kwd">forall</span><span class="id"> x,</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> f</span><span class="id"> x</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">\int[bernoulli</span><span class="id"> p]_y</span> (<span class="id">f</span><span class="id"> y</span>)<span class="id"> =</span><span class="id"> p%:E</span><span class="id"> *</span><span class="id"> f</span><span class="id"> true</span><span class="id"> +</span> (<span class="id">`1-p</span>)<span class="id">%:E</span><span class="id"> *</span><span class="id"> f</span><span class="id"> false</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> f0;</span><span class="id"> case/andP</span><span class="id"> :</span><span class="id"> p01</span><span class="id"> =&gt;</span><span class="id"> p0</span><span class="id"> p1;</span><span class="id"> rewrite</span><span class="id"> bernoulli_dirac/=</span>.<br/>
<span class="id">rewrite</span><span class="id"> ge0_integral_measure_sum//</span><span class="id"> 2!big_ord_recl/=</span><span class="id"> big_ord0</span><span class="id"> adde0/=</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> !ge0_integral_mscale//=</span><span class="id"> !integral_dirac//=</span><span class="id"> !diracT</span><span class="id"> !mul1e</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> integral_bernoulli</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> measurable_bernoulli</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ring_scope</span>.<br/>
<span class="vernacular">Variable</span><span class="id"> R</span><span class="id"> :</span><span class="id"> realType</span>.<br/>
<span class="vernacular">Implicit</span><span class="gallina-kwd"> Type</span><span class="id"> p</span><span class="id"> :</span><span class="id"> R</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> measurable_bernoulli</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">measurable_fun</span><span class="id"> setT</span> (<span class="id">bernoulli</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> pprobability</span><span class="id"> bool</span><span class="id"> R</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">apply:</span> (<span class="id">@measurability</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><br/>
&nbsp;&nbsp;(<span class="id">@pset</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> :</span><span class="id"> set</span> (<span class="id">set</span> (<span class="id">pprobability</span><span class="id"> _</span><span class="id"> R</span>))))<span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> _</span><span class="id"> -[_</span><span class="id"> [r</span><span class="id"> r01]</span><span class="id"> [Ys</span><span class="id"> mYs</span><span class="id"> &lt;-]]</span><span class="id"> &lt;-;</span><span class="id"> apply:</span><span class="id"> emeasurable_fun_infty_o</span><span class="id"> =&gt;</span><span class="id"> //=</span>.<br/>
<span class="id">apply:</span><span class="id"> measurable_fun_if</span><span class="id"> =&gt;</span><span class="id"> //=</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> measurable_and</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> measurable_fun_ler</span>.<br/>
<span class="id">apply:</span> (<span class="id">eq_measurable_fun</span> (<span class="gallina-kwd">fun</span><span class="id"> t</span><span class="id"> =&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">\sum_</span>(<span class="id">b</span><span class="id"> &lt;-</span><span class="id"> fset_set</span><span class="id"> Ys</span>) (<span class="id">bernoulli_pmf</span><span class="id"> t</span><span class="id"> b</span>)<span class="id">%:E</span>)).<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> x</span><span class="id"> /set_mem[_/=</span><span class="id"> x01]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> fsbig_finite//=</span>.<br/>
<span class="id">apply:</span><span class="id"> emeasurable_fun_sum</span><span class="id"> =&gt;</span><span class="id"> n</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> k</span><span class="id"> Ysk;</span><span class="id"> apply/measurableT_comp</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
<span class="id">exact:</span><span class="id"> measurable_bernoulli_pmf</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> measurable_bernoulli2</span><span class="id"> U</span><span class="id"> :</span><span class="id"> measurable</span><span class="id"> U</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">measurable_fun</span><span class="id"> setT</span> (<span class="id">bernoulli</span><span class="id"> ^~</span><span class="id"> U</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> ?;</span><span class="id"> exact:</span> (<span class="id">measurable_kernel</span> (<span class="id">kprobability</span><span class="id"> measurable_bernoulli</span>)).<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> measurable_bernoulli</span>.<br/>
<span class="vernacular">Arguments</span><span class="id"> measurable_bernoulli</span><span class="id"> {R}</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> binomial_pmf</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ring_scope</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {R</span><span class="id"> :</span><span class="id"> realType}</span> (<span class="id">n</span><span class="id"> :</span><span class="id"> nat</span>) (<span class="id">p</span><span class="id"> :</span><span class="id"> R</span>).<br/>
<br/>
<span class="vernacular">Definition</span><span class="id"> binomial_pmf</span><span class="id"> k</span><span class="id"> :=</span><span class="id"> p</span><span class="id"> ^+</span><span class="id"> k</span><span class="id"> *</span> (<span class="id">`1-p</span>)<span class="id"> ^+</span> (<span class="id">n</span><span class="id"> -</span><span class="id"> k</span>)<span class="id"> *+</span><span class="id"> 'C</span>(<span class="id">n,</span><span class="id"> k</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> binomial_pmf_ge0</span><span class="id"> k</span> (<span class="id">p01</span><span class="id"> :</span> (<span class="id">0</span><span class="id"> &lt;=</span><span class="id"> p</span><span class="id"> &lt;=</span><span class="id"> 1</span>)<span class="id">%R</span>)<span class="id"> :</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> binomial_pmf</span><span class="id"> k</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move:</span><span class="id"> p01</span><span class="id"> =&gt;</span><span class="id"> /andP[p0</span><span class="id"> p1];</span><span class="id"> rewrite</span><span class="id"> mulrn_wge0//</span><span class="id"> mulr_ge0//</span><span class="id"> ?exprn_ge0//</span>.<br/>
<span class="id">exact:</span><span class="id"> onem_ge0</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> binomial_pmf</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> measurable_binomial_pmf</span><span class="id"> {R</span><span class="id"> :</span><span class="id"> realType}</span><span class="id"> D</span><span class="id"> n</span><span class="id"> k</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">measurable_fun</span><span class="id"> D</span> (<span class="id">@binomial_pmf</span><span class="id"> R</span><span class="id"> n</span><span class="id"> ^~</span><span class="id"> k</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">apply:</span> (<span class="id">@measurableT_comp</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span> (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> :</span><span class="id"> R</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> *+</span><span class="id"> 'C</span>(<span class="id">n,</span><span class="id"> k</span>))<span class="id">%R</span>)<span class="id"> =&gt;</span><span class="id"> /=</span>.<br/>
&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> natmul_measurable</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> measurable_funM</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> apply:</span><span class="id"> measurable_funX;</span><span class="id"> exact:</span><span class="id"> measurable_funB</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Definition</span><span class="id"> binomial_prob</span><span class="id"> {R</span><span class="id"> :</span><span class="id"> realType}</span> (<span class="id">n</span><span class="id"> :</span><span class="id"> nat</span>) (<span class="id">p</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span><span class="id"> set</span><span class="id"> nat</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">fun</span><span class="id"> U</span><span class="id"> =&gt;</span><span class="gallina-kwd"> if</span> (<span class="id">0</span><span class="id"> &lt;=</span><span class="id"> p</span><span class="id"> &lt;=</span><span class="id"> 1</span>)<span class="id">%R</span><span class="gallina-kwd"> then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">\esum_</span>(<span class="id">k</span><span class="gallina-kwd"> in</span><span class="id"> U</span>) (<span class="id">binomial_pmf</span><span class="id"> n</span><span class="id"> p</span><span class="id"> k</span>)<span class="id">%:E</span><span class="gallina-kwd"> else</span><span class="id"> \d_0%N</span><span class="id"> U</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> binomial</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {R</span><span class="id"> :</span><span class="id"> realType}</span> (<span class="id">n</span><span class="id"> :</span><span class="id"> nat</span>) (<span class="id">p</span><span class="id"> :</span><span class="id"> R</span>).<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<br/>
<span class="vernacular">Local</span><span class="vernacular"> Notation</span><span class="id"> binomial</span><span class="id"> :=</span> (<span class="id">binomial_prob</span><span class="id"> n</span><span class="id"> p</span>).<br/>
<br/>
<span class="vernacular">Let</span><span class="id"> binomial0</span><span class="id"> :</span><span class="id"> binomial</span><span class="id"> set0</span><span class="id"> =</span><span class="id"> 0</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> /binomial</span><span class="id"> measure0;</span><span class="id"> case:</span><span class="id"> ifPn</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> rewrite</span><span class="id"> esum_set0</span>. Qed.</div></details>
<br/>
<span class="vernacular">Let</span><span class="id"> binomial_ge0</span><span class="id"> U</span><span class="id"> :</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> binomial</span><span class="id"> U</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> /binomial;</span><span class="id"> case:</span><span class="id"> ifPn</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> p01;</span><span class="id"> apply:</span><span class="id"> esum_ge0</span><span class="id"> =&gt;</span><span class="id"> /=</span><span class="id"> k</span><span class="id"> Uk</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> lee_fin</span><span class="id"> binomial_pmf_ge0</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Let</span><span class="id"> binomial_sigma_additive</span><span class="id"> :</span><span class="id"> semi_sigma_additive</span><span class="id"> binomial</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> F</span><span class="id"> mF</span><span class="id"> tF</span><span class="id"> mUF;</span><span class="id"> rewrite</span><span class="id"> /binomial;</span><span class="id"> case:</span><span class="id"> ifPn</span><span class="id"> =&gt;</span><span class="id"> p01;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> measure_semi_sigma_additive</span>.<br/>
<span class="id">apply:</span><span class="id"> cvg_toP</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> ereal_nondecreasing_is_cvgn</span><span class="id"> =&gt;</span><span class="id"> a</span><span class="id"> b</span><span class="id"> ab</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> lee_sum_nneg_natr</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> k</span><span class="id"> _</span><span class="id"> _</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> esum_ge0</span><span class="id"> =&gt;</span><span class="id"> /=</span><span class="id"> ?</span><span class="id"> _;</span><span class="id"> exact:</span><span class="id"> binomial_pmf_ge0</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> nneseries_sum_bigcup//</span><span class="id"> =&gt;</span><span class="id"> i;</span><span class="id"> rewrite</span><span class="id"> lee_fin</span><span class="id"> binomial_pmf_ge0</span>.<br/>
Qed.</div></details>
<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> isMeasure</span>.<span class="id">Build</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> binomial</span><br/>
&nbsp;&nbsp;<span class="id">binomial0</span><span class="id"> binomial_ge0</span><span class="id"> binomial_sigma_additive</span>.<br/>
<br/>
<span class="vernacular">Let</span><span class="id"> binomial_setT</span><span class="id"> :</span><span class="id"> binomial</span><span class="id"> [set:</span><span class="id"> _]</span><span class="id"> =</span><span class="id"> 1</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> /binomial;</span><span class="id"> case:</span><span class="id"> ifPn;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> probability_setT</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> p01;</span><span class="id"> rewrite</span><span class="id"> /binomial_pmf</span>.<br/>
<span class="id">have</span><span class="id"> pkn</span><span class="id"> k</span><span class="id"> :</span><span class="id"> 0%R</span><span class="id"> &lt;=</span> (<span class="id">p</span><span class="id"> ^+</span><span class="id"> k</span><span class="id"> *</span><span class="id"> `1-p</span><span class="id"> ^+</span> (<span class="id">n</span><span class="id"> -</span><span class="id"> k</span>)<span class="id"> *+</span><span class="id"> 'C</span>(<span class="id">n,</span><span class="id"> k</span>))<span class="id">%:E</span>.<br/>
&nbsp;&nbsp;<span class="id">case/andP</span><span class="id"> :</span><span class="id"> p01</span><span class="id"> =&gt;</span><span class="id"> p0</span><span class="id"> p1</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> lee_fin</span><span class="id"> mulrn_wge0//</span><span class="id"> mulr_ge0</span><span class="id"> ?exprn_ge0</span><span class="id"> ?subr_ge0</span>.<br/>
<span class="id">rewrite</span> (<span class="id">esumID</span><span class="id"> `I_n</span>.<span class="id">+1</span>)<span class="id">//</span><span class="id"> [X</span><span class="gallina-kwd"> in</span><span class="id"> _</span><span class="id"> +</span><span class="id"> X]esum1</span><span class="id"> ?adde0;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> /=</span><span class="id"> k</span><span class="id"> [_</span><span class="id"> /negP];</span><span class="id"> rewrite</span><span class="id"> -leqNgt</span><span class="id"> =&gt;</span><span class="id"> nk;</span><span class="id"> rewrite</span><span class="id"> bin_small</span>.<br/>
<span class="id">rewrite</span><span class="id"> setTI</span><span class="id"> esum_fset//</span><span class="id"> -fsbig_ord//=</span>.<br/>
<span class="id">under</span><span class="id"> eq_bigr</span><span class="id"> do</span><span class="id"> rewrite</span><span class="id"> mulrC</span>.<br/>
<span class="id">rewrite</span><span class="id"> sumEFin</span><span class="id"> -exprDn_comm;</span><span class="id"> last</span><span class="id"> exact:</span><span class="id"> mulrC</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> addrC</span><span class="id"> add_onemK</span><span class="id"> expr1n</span>.<br/>
Qed.</div></details>
<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">@Measure_isProbability</span>.<span class="id">Build</span><span class="id"> _</span><span class="id"> _</span><span class="id"> R</span><span class="id"> binomial</span><span class="id"> binomial_setT</span>.<br/>
<br/>
<span class="vernacular">End</span><span class="id"> binomial</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> binomial_probability</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ring_scope</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {R</span><span class="id"> :</span><span class="id"> realType}</span> (<span class="id">n</span><span class="id"> :</span><span class="id"> nat</span>) (<span class="id">p</span><span class="id"> :</span><span class="id"> R</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">p0</span><span class="id"> :</span> (<span class="id">0</span><span class="id"> &lt;=</span><span class="id"> p</span>)<span class="id">%R</span>) (<span class="id">p1</span><span class="id"> :</span> ((<span class="id">NngNum</span><span class="id"> p0</span>)<span class="id">%:num</span><span class="id"> &lt;=</span><span class="id"> 1</span>)<span class="id">%R</span>).<br/>
<br/>
<span class="vernacular">Definition</span><span class="id"> bin_prob</span> (<span class="id">k</span><span class="id"> :</span><span class="id"> nat</span>)<span class="id"> :</span><span class="id"> {nonneg</span><span class="id"> R}</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;((<span class="id">NngNum</span><span class="id"> p0</span>)<span class="id">%:num</span><span class="id"> ^+</span><span class="id"> k</span><span class="id"> *</span> (<span class="id">NngNum</span> (<span class="id">onem_ge0</span><span class="id"> p1</span>))<span class="id">%:num</span><span class="id"> ^+</span> (<span class="id">n</span><span class="id"> -</span><span class="id"> k</span>)<span class="id">%N</span><span class="id"> *+</span><span class="id"> 'C</span>(<span class="id">n,</span><span class="id"> k</span>))<span class="id">%:nng</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> bin_prob0</span><span class="id"> :</span><span class="id"> bin_prob</span><span class="id"> 0</span><span class="id"> =</span> ((<span class="id">NngNum</span> (<span class="id">onem_ge0</span><span class="id"> p1</span>))<span class="id">%:num^+n</span>)<span class="id">%:nng</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> /bin_prob</span><span class="id"> bin0</span><span class="id"> subn0/=;</span><span class="id"> apply/val_inj</span><span class="id"> =&gt;</span><span class="id"> /=</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> expr0</span><span class="id"> mul1r</span><span class="id"> mulr1n</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> bin_prob1</span><span class="id"> :</span><span class="id"> bin_prob</span><span class="id"> 1</span><span class="id"> =</span><br/>
&nbsp;&nbsp;((<span class="id">NngNum</span><span class="id"> p0</span>)<span class="id">%:num</span><span class="id"> *</span> (<span class="id">NngNum</span> (<span class="id">onem_ge0</span><span class="id"> p1</span>))<span class="id">%:num</span><span class="id"> ^+</span><span class="id"> n</span>.<span class="id">-1</span><span class="id"> *+</span><span class="id"> n</span>)<span class="id">%:nng</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /bin_prob</span><span class="id"> bin1/=;</span><span class="id"> apply/val_inj</span><span class="id"> =&gt;</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> expr1</span><span class="id"> subn1</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> binomial_msum</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">binomial_prob</span><span class="id"> n</span><span class="id"> p</span><span class="id"> =</span><span class="id"> msum</span> (<span class="gallina-kwd">fun</span><span class="id"> k</span><span class="id"> =&gt;</span><span class="id"> mscale</span> (<span class="id">bin_prob</span><span class="id"> k</span>)<span class="id"> \d_k</span>)<span class="id"> n</span>.<span class="id">+1</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">apply/funext</span><span class="id"> =&gt;</span><span class="id"> U</span>.<br/>
<span class="id">rewrite</span><span class="id"> /binomial_prob;</span><span class="id"> case:</span><span class="id"> ifPn</span><span class="id"> =&gt;</span><span class="id"> [_|];</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> p1</span><span class="id"> p0</span>.<br/>
<span class="id">rewrite</span><span class="id"> /msum/=</span><span class="id"> /mscale/=</span><span class="id"> /binomial_pmf</span>.<br/>
<span class="id">have</span><span class="id"> pkn</span><span class="id"> k</span><span class="id"> :</span> (<span class="id">0%R</span><span class="id"> &lt;=</span> (<span class="id">p</span><span class="id"> ^+</span><span class="id"> k</span><span class="id"> *</span><span class="id"> `1-p</span><span class="id"> ^+</span> (<span class="id">n</span><span class="id"> -</span><span class="id"> k</span>)<span class="id"> *+</span><span class="id"> 'C</span>(<span class="id">n,</span><span class="id"> k</span>))<span class="id">%:E</span>)<span class="id">%E</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> lee_fin</span><span class="id"> mulrn_wge0//</span><span class="id"> mulr_ge0</span><span class="id"> ?exprn_ge0</span><span class="id"> ?subr_ge0</span>.<br/>
<span class="id">rewrite</span> (<span class="id">esumID</span><span class="id"> `I_n</span>.<span class="id">+1</span>)<span class="id">//=</span><span class="id"> [X</span><span class="gallina-kwd"> in</span><span class="id"> _</span><span class="id"> +</span><span class="id"> X]esum1</span><span class="id"> ?adde0;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> /=</span><span class="id"> k</span><span class="id"> [_</span><span class="id"> /negP];</span><span class="id"> rewrite</span><span class="id"> -leqNgt</span><span class="id"> =&gt;</span><span class="id"> nk;</span><span class="id"> rewrite</span><span class="id"> bin_small</span>.<br/>
<span class="id">rewrite</span><span class="id"> esum_mkcondl</span><span class="id"> esum_fset//;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> i</span><span class="id"> /=</span><span class="id"> _;</span><span class="id"> case:</span><span class="id"> ifPn</span>.<br/>
<span class="id">rewrite</span><span class="id"> -fsbig_ord//=;</span><span class="id"> apply:</span><span class="id"> eq_bigr</span><span class="id"> =&gt;</span><span class="id"> i</span><span class="id"> _</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> diracE;</span><span class="id"> case:</span><span class="id"> ifPn</span><span class="id"> =&gt;</span><span class="id"> /=</span><span class="id"> iU;</span><span class="id"> [rewrite</span><span class="id"> mule1|rewrite</span><span class="id"> mule0]</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> binomial_probE</span><span class="id"> U</span><span class="id"> :</span><span class="id"> binomial_prob</span><span class="id"> n</span><span class="id"> p</span><span class="id"> U</span><span class="id"> =</span><br/>
&nbsp;&nbsp;(<span class="id">\sum_</span>(<span class="id">k</span><span class="id"> &lt;</span><span class="id"> n</span>.<span class="id">+1</span>) (<span class="id">bin_prob</span><span class="id"> k</span>)<span class="id">%:num%:E</span><span class="id"> *</span> (<span class="id">\d_</span>(<span class="id">nat_of_ord</span><span class="id"> k</span>)<span class="id"> U</span>))<span class="id">%E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> binomial_msum</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> integral_binomial</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> nat</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id"> :</span> (<span class="gallina-kwd">forall</span><span class="id"> x,</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> f</span><span class="id"> x</span>)<span class="id">%E</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;(<span class="id">\int[binomial_prob</span><span class="id"> n</span><span class="id"> p]_y</span> (<span class="id">f</span><span class="id"> y</span>)<span class="id"> =</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id">\sum_</span>(<span class="id">k</span><span class="id"> &lt;</span><span class="id"> n</span>.<span class="id">+1</span>) (<span class="id">bin_prob</span><span class="id"> k</span>)<span class="id">%:num%:E</span><span class="id"> *</span><span class="id"> f</span><span class="id"> k</span>)<span class="id">%E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> f0;</span><span class="id"> rewrite</span><span class="id"> binomial_msum</span><span class="id"> ge0_integral_measure_sum//=</span>.<br/>
<span class="id">apply:</span><span class="id"> eq_bigr</span><span class="id"> =&gt;</span><span class="id"> i</span><span class="id"> _</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> ge0_integral_mscale//=</span><span class="id"> integral_dirac//=</span><span class="id"> diracT</span><span class="id"> mul1e</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> binomial_probability</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> integral_binomial_prob</span> (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>)<span class="id"> n</span><span class="id"> p</span><span class="id"> U</span><span class="id"> :</span> (<span class="id">0</span><span class="id"> &lt;=</span><span class="id"> p</span><span class="id"> &lt;=</span><span class="id"> 1</span>)<span class="id">%R</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;(<span class="id">\int[binomial_prob</span><span class="id"> n</span><span class="id"> p]_y</span><span class="id"> \d_</span>(<span class="id">0</span><span class="id"> &lt;</span><span class="id"> y</span>)<span class="id">%N</span><span class="id"> U</span><span class="id"> =</span><br/>
&nbsp;&nbsp;<span class="id">bernoulli</span> (<span class="id">1</span><span class="id"> -</span><span class="id"> `1-p</span><span class="id"> ^+</span><span class="id"> n</span>)<span class="id"> U</span><span class="id"> :&gt;</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id">%E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> /andP[p0</span><span class="id"> p1];</span><span class="id"> rewrite</span><span class="id"> bernoulliE//=;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> subr_ge0</span><span class="id"> exprn_ile1//=;</span><span class="id"> [|exact/onem_ge0|exact/onem_le1]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> lerBlDr</span><span class="id"> addrC</span><span class="id"> -lerBlDr</span><span class="id"> subrr;</span><span class="id"> exact/exprn_ge0/onem_ge0</span>.<br/>
<span class="id">rewrite</span> (<span class="id">@integral_binomial</span><span class="id"> _</span><span class="id"> n</span><span class="id"> p</span><span class="id"> _</span><span class="id"> _</span> (<span class="gallina-kwd">fun</span><span class="id"> y</span><span class="id"> =&gt;</span><span class="id"> \d_</span>(<span class="id">1</span><span class="id"> &lt;=</span><span class="id"> y</span>)<span class="id">%N</span><span class="id"> U</span>))<span class="id">//</span>.<br/>
<span class="id">rewrite</span><span class="id"> !big_ord_recl/=</span>.<br/>
<span class="id">rewrite</span><span class="id"> expr0</span><span class="id"> mul1r</span><span class="id"> subn0</span><span class="id"> bin0</span><span class="id"> ltnn</span><span class="id"> mulr1n</span><span class="id"> addrC</span>.<br/>
<span class="id">rewrite</span><span class="id"> onemD</span><span class="id"> opprK</span><span class="id"> onem1</span><span class="id"> add0r;</span><span class="id"> congr</span><span class="id"> +%E</span>.<br/>
<span class="id">rewrite</span><span class="id"> /bump;</span><span class="id"> under</span><span class="id"> eq_bigr</span><span class="id"> do</span><span class="id"> rewrite</span><span class="id"> leq0n</span><span class="id"> add1n</span><span class="id"> ltnS</span><span class="id"> leq0n</span>.<br/>
<span class="id">rewrite</span><span class="id"> -ge0_sume_distrl;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> i</span><span class="id"> _</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply/mulrn_wge0/mulr_ge0;</span><span class="id"> apply/exprn_ge0</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact/onem_ge0</span>.<br/>
<span class="id">congr</span><span class="id"> *%E</span>.<br/>
<span class="id">transitivity</span> (<span class="id">\sum_</span>(<span class="id">i</span><span class="id"> &lt;</span><span class="id"> n</span>.<span class="id">+1</span>) (<span class="id">`1-p</span><span class="id"> ^+</span> (<span class="id">n</span><span class="id"> -</span><span class="id"> i</span>)<span class="id"> *</span><span class="id"> p</span><span class="id"> ^+</span><span class="id"> i</span><span class="id"> *+</span><span class="id"> 'C</span>(<span class="id">n,</span><span class="id"> i</span>))<span class="id">%:E</span><span class="id"> -</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">`1-p</span><span class="id"> ^+</span><span class="id"> n</span>)<span class="id">%:E</span>)<span class="id">%E</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> big_ord_recl/=</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> expr0</span><span class="id"> mulr1</span><span class="id"> subn0</span><span class="id"> bin0</span><span class="id"> mulr1n</span><span class="id"> addrAC</span><span class="id"> -EFinD</span><span class="id"> subrr</span><span class="id"> add0e</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /bump;</span><span class="id"> under</span><span class="id"> [RHS]eq_bigr</span><span class="id"> do</span><span class="id"> rewrite</span><span class="id"> leq0n</span><span class="id"> add1n</span><span class="id"> mulrC</span>.<br/>
<span class="id">rewrite</span><span class="id"> sumEFin</span><span class="id"> -</span>(<span class="id">@exprDn_comm</span><span class="id"> _</span><span class="id"> `1-p</span><span class="id"> p</span><span class="id"> n</span>)<span class="id">//</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> subrK</span><span class="id"> expr1n</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /GRing</span>.<span class="id">comm/onem</span><span class="id"> mulrC</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> measurable_binomial_prob</span> (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>) (<span class="id">n</span><span class="id"> :</span><span class="id"> nat</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">measurable_fun</span><span class="id"> setT</span> (<span class="id">binomial_prob</span><span class="id"> n</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> pprobability</span><span class="id"> _</span><span class="id"> _</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">apply:</span> (<span class="id">@measurability</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><br/>
&nbsp;&nbsp;(<span class="id">@pset</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> :</span><span class="id"> set</span> (<span class="id">set</span> (<span class="id">pprobability</span><span class="id"> _</span><span class="id"> R</span>))))<span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> _</span><span class="id"> -[_</span><span class="id"> [r</span><span class="id"> r01]</span><span class="id"> [Ys</span><span class="id"> mYs</span><span class="id"> &lt;-]]</span><span class="id"> &lt;-;</span><span class="id"> apply:</span><span class="id"> emeasurable_fun_infty_o</span><span class="id"> =&gt;</span><span class="id"> //=</span>.<br/>
<span class="id">rewrite</span><span class="id"> /binomial_prob/=</span>.<br/>
<span class="id">set</span><span class="id"> f</span><span class="id"> :=</span> (<span class="id">X</span><span class="gallina-kwd"> in</span><span class="id"> measurable_fun</span><span class="id"> _</span><span class="id"> X</span>).<br/>
<span class="id">apply:</span><span class="id"> measurable_fun_if</span><span class="id"> =&gt;</span><span class="id"> //=</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> measurable_and</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> measurable_fun_ler</span>.<br/>
<span class="id">apply:</span> (<span class="id">eq_measurable_fun</span> (<span class="gallina-kwd">fun</span><span class="id"> t</span><span class="id"> =&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">\sum_</span>(<span class="id">k</span><span class="id"> &lt;oo</span><span class="id"> |</span><span class="id"> k</span><span class="id"> \in</span><span class="id"> Ys</span>) (<span class="id">binomial_pmf</span><span class="id"> n</span><span class="id"> t</span><span class="id"> k</span>)<span class="id">%:E</span>))<span class="id">%E</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> x</span><span class="id"> /set_mem[_/=</span><span class="id"> x01]</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> nneseries_esum//</span><span class="id"> -1?[in</span><span class="id"> RHS]</span>(<span class="id">set_mem_set</span><span class="id"> Ys</span>)<span class="id">//</span><span class="id"> =&gt;</span><span class="id"> k</span><span class="id"> kYs</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> lee_fin</span><span class="id"> binomial_pmf_ge0</span>.<br/>
<span class="id">apply:</span><span class="id"> ge0_emeasurable_fun_sum</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> k</span><span class="id"> x/=</span><span class="id"> [_</span><span class="id"> x01]</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> lee_fin</span><span class="id"> binomial_pmf_ge0</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> k</span><span class="id"> Ysk;</span><span class="id"> apply/measurableT_comp</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
<span class="id">exact:</span><span class="id"> measurable_binomial_pmf</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Section</span><span class="id"> uniform_probability</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ring_scope</span>.<br/>
<span class="vernacular">Context</span> (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>) (<span class="id">a</span><span class="id"> b</span><span class="id"> :</span><span class="id"> R</span>).<br/>
<br/>
<span class="vernacular">Definition</span><span class="id"> uniform_pdf</span><span class="id"> x</span><span class="id"> :=</span><span class="gallina-kwd"> if</span><span class="id"> a</span><span class="id"> &lt;=</span><span class="id"> x</span><span class="id"> &lt;=</span><span class="id"> b</span><span class="gallina-kwd"> then</span> (<span class="id">b</span><span class="id"> -</span><span class="id"> a</span>)<span class="id">^-1</span><span class="gallina-kwd"> else</span><span class="id"> 0</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> uniform_pdf_ge0</span><span class="id"> x</span><span class="id"> :</span><span class="id"> a</span><span class="id"> &lt;</span><span class="id"> b</span><span class="id"> -&gt;</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> uniform_pdf</span><span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> ab;</span><span class="id"> rewrite</span><span class="id"> /uniform_pdf;</span><span class="id"> case:</span><span class="id"> ifPn</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> axb</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> invr_ge0//</span><span class="id"> ltW//</span><span class="id"> subr_gt0</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> measurable_uniform_pdf</span><span class="id"> :</span><span class="id"> measurable_fun</span><span class="id"> setT</span><span class="id"> uniform_pdf</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> /uniform_pdf</span><span class="id"> /=;</span><span class="id"> apply:</span><span class="id"> measurable_fun_if</span><span class="id"> =&gt;</span><span class="id"> //=</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> measurable_and</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> measurable_fun_ler</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Local</span><span class="vernacular"> Notation</span><span class="id"> mu</span><span class="id"> :=</span><span class="id"> lebesgue_measure</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> integral_uniform_pdf</span><span class="id"> U</span><span class="id"> :</span><br/>
&nbsp;&nbsp;(<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> U</span>) (<span class="id">uniform_pdf</span><span class="id"> x</span>)<span class="id">%:E</span><span class="id"> =</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> U</span><span class="id"> `&amp;`</span><span class="id"> `[a,</span><span class="id"> b]</span>) (<span class="id">uniform_pdf</span><span class="id"> x</span>)<span class="id">%:E</span>)<span class="id">%E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> [RHS]integral_mkcondr/=;</span><span class="id"> apply:</span><span class="id"> eq_integral</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> xU</span>.<br/>
<span class="id">rewrite</span><span class="id"> patchE;</span><span class="id"> case:</span><span class="id"> ifPn</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
<span class="id">rewrite</span><span class="id"> notin_setE/=</span><span class="id"> in_itv/=</span><span class="id"> =&gt;</span><span class="id"> /negP/negbTE</span><span class="id"> xab</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /uniform_pdf</span><span class="id"> xab</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> integral_uniform_pdf1</span><span class="id"> A</span> (<span class="id">ab</span><span class="id"> :</span><span class="id"> a</span><span class="id"> &lt;</span><span class="id"> b</span>)<span class="id"> :</span><span class="id"> `[a,</span><span class="id"> b]</span><span class="id"> `&lt;=`</span><span class="id"> A</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;(<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> A</span>) (<span class="id">uniform_pdf</span><span class="id"> x</span>)<span class="id">%:E</span><span class="id"> =</span><span class="id"> 1</span>)<span class="id">%E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> abA;</span><span class="id"> rewrite</span><span class="id"> integral_uniform_pdf</span><span class="id"> setIidr//</span>.<br/>
<span class="id">rewrite</span> (<span class="id">eq_integral</span> (<span class="id">fun=&gt;</span> (<span class="id">b</span><span class="id"> -</span><span class="id"> a</span>)<span class="id">^-1%:E</span>))<span class="id">;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> x;</span><span class="id"> rewrite</span><span class="id"> inE/=</span><span class="id"> in_itv/=</span><span class="id"> /uniform_pdf</span><span class="id"> =&gt;</span><span class="id"> -&gt;</span>.<br/>
<span class="id">rewrite</span><span class="id"> integral_cst//=</span><span class="id"> lebesgue_measure_itv/=</span><span class="id"> lte_fin</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> ab</span><span class="id"> -EFinD</span><span class="id"> -EFinM</span><span class="id"> mulVf//</span><span class="id"> gt_eqF//</span><span class="id"> subr_gt0</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Definition</span><span class="id"> uniform_prob</span> (<span class="id">ab</span><span class="id"> :</span><span class="id"> a</span><span class="id"> &lt;</span><span class="id"> b</span>)<span class="id"> :</span><span class="id"> set</span><span class="id"> _</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">fun</span><span class="id"> U</span><span class="id"> =&gt;</span> (<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> U</span>) (<span class="id">uniform_pdf</span><span class="id"> x</span>)<span class="id">%:E</span>)<span class="id">%E</span>.<br/>
<br/>
<span class="vernacular">Hypothesis</span><span class="id"> ab</span><span class="id"> :</span> (<span class="id">a</span><span class="id"> &lt;</span><span class="id"> b</span>)<span class="id">%R</span>.<br/>
<br/>
<span class="vernacular">Let</span><span class="id"> uniform0</span><span class="id"> :</span><span class="id"> uniform_prob</span><span class="id"> ab</span><span class="id"> set0</span><span class="id"> =</span><span class="id"> 0</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> /uniform_prob</span><span class="id"> integral_set0</span>. Qed.</div></details>
<br/>
<span class="vernacular">Let</span><span class="id"> uniform_ge0</span><span class="id"> U</span><span class="id"> :</span> (<span class="id">0</span><span class="id"> &lt;=</span><span class="id"> uniform_prob</span><span class="id"> ab</span><span class="id"> U</span>)<span class="id">%E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> integral_ge0</span><span class="id"> =&gt;</span><span class="id"> /=</span><span class="id"> x</span><span class="id"> Ux;</span><span class="id"> rewrite</span><span class="id"> lee_fin</span><span class="id"> uniform_pdf_ge0</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> integrable_uniform_pdf</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">mu</span>.<span class="id">-integrable</span><span class="id"> setT</span> (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> =&gt;</span> (<span class="id">uniform_pdf</span><span class="id"> x</span>)<span class="id">%:E</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">apply/integrableP;</span><span class="id"> split</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> measurableT_comp</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> measurable_uniform_pdf</span>.<br/>
<span class="id">under</span><span class="id"> eq_integral</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> x</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> gee0_abs//;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> lee_fin</span><span class="id"> uniform_pdf_ge0</span>.<br/>
&nbsp;&nbsp;<span class="id">over</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /=</span><span class="id"> integral_uniform_pdf1</span><span class="id"> ?ltry//</span><span class="id"> -subr_gt0</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Let</span><span class="id"> uniform_sigma_additive</span><span class="id"> :</span><span class="id"> semi_sigma_additive</span> (<span class="id">uniform_prob</span><span class="id"> ab</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> /=</span><span class="id"> F</span><span class="id"> mF</span><span class="id"> tF</span><span class="id"> mUF;</span><span class="id"> rewrite</span><span class="id"> /uniform_prob;</span><span class="id"> apply:</span><span class="id"> cvg_toP</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> ereal_nondecreasing_is_cvgn</span><span class="id"> =&gt;</span><span class="id"> m</span><span class="id"> n</span><span class="id"> mn</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> lee_sum_nneg_natr</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> k</span><span class="id"> _</span><span class="id"> _</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> integral_ge0</span><span class="id"> =&gt;</span><span class="id"> /=</span><span class="id"> x</span><span class="id"> Fkx;</span><span class="id"> rewrite</span><span class="id"> lee_fin</span><span class="id"> uniform_pdf_ge0</span>.<br/>
<span class="id">rewrite</span><span class="id"> ge0_integral_bigcup//=</span>.<br/>
<span class="id">-</span><span class="id"> apply:</span><span class="id"> measurable_funTS;</span><span class="id"> apply:</span><span class="id"> measurableT_comp</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> measurable_uniform_pdf</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> lee_fin</span><span class="id"> uniform_pdf_ge0</span>.<br/>
Qed.</div></details>
<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> isMeasure</span>.<span class="id">Build</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">uniform_prob</span><span class="id"> ab</span>)<br/>
&nbsp;&nbsp;<span class="id">uniform0</span><span class="id"> uniform_ge0</span><span class="id"> uniform_sigma_additive</span>.<br/>
<br/>
<span class="vernacular">Let</span><span class="id"> uniform_setT</span><span class="id"> :</span><span class="id"> uniform_prob</span><span class="id"> ab</span><span class="id"> [set:</span><span class="id"> _]</span><span class="id"> =</span><span class="id"> 1%:E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> /uniform_prob</span><span class="id"> /mscale/=</span><span class="id"> integral_uniform_pdf1</span>. Qed.</div></details>
<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> @Measure_isProbability</span>.<span class="id">Build</span><span class="id"> _</span><span class="id"> _</span><span class="id"> R</span><br/>
&nbsp;&nbsp;(<span class="id">uniform_prob</span><span class="id"> ab</span>)<span class="id"> uniform_setT</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> dominates_uniform_prob</span><span class="id"> :</span><span class="id"> uniform_prob</span><span class="id"> ab</span><span class="id"> `&lt;&lt;</span><span class="id"> mu</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> A</span><span class="id"> mA</span><span class="id"> muA0;</span><span class="id"> rewrite</span><span class="id"> /uniform_prob</span><span class="id"> integral_uniform_pdf</span>.<br/>
<span class="id">apply/eqP;</span><span class="id"> rewrite</span><span class="id"> eq_le;</span><span class="id"> apply/andP;</span><span class="id"> split;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> integral_ge0</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> [Ax</span><span class="id"> /=];</span><span class="id"> rewrite</span><span class="id"> in_itv</span><span class="id"> /=</span><span class="id"> =&gt;</span><span class="id"> xab</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> lee_fin</span><span class="id"> uniform_pdf_ge0</span>.<br/>
<span class="id">apply:</span> (<span class="id">@le_trans</span><span class="id"> _</span><span class="id"> _</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> A</span><span class="id"> `&amp;`</span><span class="id"> `[a,</span><span class="id"> b]%classic</span>) (<span class="id">b</span><span class="id"> -</span><span class="id"> a</span>)<span class="id">^-1%:E</span>))<span class="id">%E;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> integral_cst//=</span><span class="id"> ?mul1e//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> pmule_rle0</span><span class="id"> ?lte_fin</span><span class="id"> ?invr_gt0//</span><span class="id"> ?subr_gt0//</span><span class="id"> -muA0</span><span class="id"> measureIl</span>.<br/>
&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> measurableI</span>.<br/>
<span class="id">apply:</span><span class="id"> ge0_le_integral</span><span class="id"> =&gt;</span><span class="id"> //=</span>.<br/>
<span class="id">-</span><span class="id"> exact:</span><span class="id"> measurableI</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> [Ax];</span><span class="id"> rewrite</span><span class="id"> /=</span><span class="id"> in_itv/=</span><span class="id"> =&gt;</span><span class="id"> axb;</span><span class="id"> rewrite</span><span class="id"> lee_fin</span><span class="id"> uniform_pdf_ge0</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> apply/measurable_EFinP/measurable_funTS;</span><span class="id"> exact:</span><span class="id"> measurable_uniform_pdf</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> [Ax</span><span class="id"> _];</span><span class="id"> rewrite</span><span class="id"> lee_fin</span><span class="id"> invr_ge0//</span><span class="id"> ltW//</span><span class="id"> subr_gt0</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> [Ax];</span><span class="id"> rewrite</span><span class="id"> in_itv/=</span><span class="id"> /uniform_pdf</span><span class="id"> =&gt;</span><span class="id"> -&gt;</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Let</span><span class="id"> integral_uniform_indic</span><span class="id"> E</span><span class="id"> :</span><span class="id"> measurable</span><span class="id"> E</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;(<span class="id">\int[uniform_prob</span><span class="id"> ab]_x</span> (<span class="id">\1_E</span><span class="id"> x</span>)<span class="id">%:E</span><span class="id"> =</span><br/>
&nbsp;&nbsp;&nbsp;(<span class="id">b</span><span class="id"> -</span><span class="id"> a</span>)<span class="id">^-1%:E</span><span class="id"> *</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> `[a,</span><span class="id"> b]</span>) (<span class="id">\1_E</span><span class="id"> x</span>)<span class="id">%:E</span>)<span class="id">%E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> mE;</span><span class="id"> rewrite</span><span class="id"> integral_indic//=</span><span class="id"> /uniform_prob</span><span class="id"> setIT</span><span class="id"> -ge0_integralZl//=</span>.<br/>
<span class="id">-</span><span class="id"> rewrite</span><span class="id"> [LHS]integral_mkcond/=</span><span class="id"> [RHS]integral_mkcond/=</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> eq_integral</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> !patchE;</span><span class="id"> case:</span><span class="id"> ifPn</span><span class="id"> =&gt;</span><span class="id"> xE</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">case:</span><span class="id"> ifPn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> inE/=</span><span class="id"> in_itv/=</span><span class="id"> =&gt;</span><span class="id"> xab</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /uniform_pdf</span><span class="id"> xab</span><span class="id"> indicE</span><span class="id"> xE</span><span class="id"> mule1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> notin_setE/=</span><span class="id"> in_itv/=</span><span class="id"> =&gt;</span><span class="id"> /negP/negbTE;</span><span class="id"> rewrite</span><span class="id"> /uniform_pdf</span><span class="id"> =&gt;</span><span class="id"> -&gt;</span>.<br/>
&nbsp;&nbsp;<span class="id">case:</span><span class="id"> ifPn</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> inE/=</span><span class="id"> in_itv/=</span><span class="id"> =&gt;</span><span class="id"> axb;</span><span class="id"> rewrite</span><span class="id"> indicE</span> (<span class="id">negbTE</span><span class="id"> xE</span>)<span class="id"> mule0</span>.<br/>
<span class="id">-</span><span class="id"> exact/measurable_EFinP/measurable_indic</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> lee_fin</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> lee_fin</span><span class="id"> invr_ge0//</span><span class="id"> ltW//</span><span class="id"> subr_gt0</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Import</span><span class="id"> HBNNSimple</span>.<br/>
<br/>
<span class="vernacular">Let</span><span class="id"> integral_uniform_nnsfun</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {nnsfun</span><span class="id"> _</span><span class="id"> &gt;-&gt;</span><span class="id"> R}</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;(<span class="id">\int[uniform_prob</span><span class="id"> ab]_x</span> (<span class="id">f</span><span class="id"> x</span>)<span class="id">%:E</span><span class="id"> =</span><br/>
&nbsp;&nbsp;&nbsp;(<span class="id">b</span><span class="id"> -</span><span class="id"> a</span>)<span class="id">^-1%:E</span><span class="id"> *</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> `[a,</span><span class="id"> b]</span>) (<span class="id">f</span><span class="id"> x</span>)<span class="id">%:E</span>)<span class="id">%E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">under</span><span class="id"> [LHS]eq_integral</span><span class="id"> do</span><span class="id"> rewrite</span><span class="id"> fimfunE</span><span class="id"> -fsumEFin//</span>.<br/>
<span class="id">rewrite</span><span class="id"> [LHS]ge0_integral_fsum//;</span><span class="id"> last</span><span class="id"> 2</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> r;</span><span class="id"> exact/measurable_EFinP/measurableT_comp</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> n</span><span class="id"> x</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> EFinM</span><span class="id"> nnfun_muleindic_ge0</span>.<br/>
<span class="id">rewrite</span><span class="id"> -[RHS]ge0_integralZl//;</span><span class="id"> last</span><span class="id"> 3</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> exact/measurable_EFinP/measurable_funTS</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> lee_fin</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> lee_fin</span><span class="id"> invr_ge0//</span><span class="id"> ltW//</span><span class="id"> subr_gt0</span>.<br/>
<span class="id">under</span><span class="id"> [RHS]eq_integral</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> x</span><span class="id"> xD;</span><span class="id"> rewrite</span><span class="id"> fimfunE</span><span class="id"> -fsumEFin//</span><span class="id"> ge0_mule_fsumr;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> r;</span><span class="id"> rewrite</span><span class="id"> EFinM</span><span class="id"> nnfun_muleindic_ge0</span>.<br/>
&nbsp;&nbsp;<span class="id">over</span>.<br/>
<span class="id">rewrite</span><span class="id"> [RHS]ge0_integral_fsum//;</span><span class="id"> last</span><span class="id"> 2</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> r;</span><span class="id"> apply/measurable_EFinP;</span><span class="id"> do</span><span class="id"> 2</span><span class="id"> apply/measurableT_comp</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> move=&gt;</span><span class="id"> n</span><span class="id"> x</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> EFinM</span><span class="id"> mule_ge0//;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> nnfun_muleindic_ge0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> lee_fin</span><span class="id"> invr_ge0//</span><span class="id"> ltW//</span><span class="id"> subr_gt0</span>.<br/>
<span class="id">apply:</span><span class="id"> eq_fsbigr</span><span class="id"> =&gt;</span><span class="id"> r</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> ge0_integralZl//</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> !integralZl_indic_nnsfun//=</span><span class="id"> integral_uniform_indic//</span><span class="id"> muleCA</span>.<br/>
<span class="id">-</span><span class="id"> exact/measurable_EFinP/measurableT_comp</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> t</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> nnfun_muleindic_ge0</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> lee_fin</span><span class="id"> invr_ge0//</span><span class="id"> ltW//</span><span class="id"> subr_gt0</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> integral_uniform</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> _</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">measurable_fun</span><span class="id"> setT</span><span class="id"> f</span><span class="id"> -&gt;</span> (<span class="gallina-kwd">forall</span><span class="id"> x,</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> f</span><span class="id"> x</span>)<span class="id">%E</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;(<span class="id">\int[uniform_prob</span><span class="id"> ab]_x</span><span class="id"> f</span><span class="id"> x</span><span class="id"> =</span> (<span class="id">b</span><span class="id"> -</span><span class="id"> a</span>)<span class="id">^-1%:E</span><span class="id"> *</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> `[a,</span><span class="id"> b]</span>)<span class="id"> f</span><span class="id"> x</span>)<span class="id">%E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> mf</span><span class="id"> f0</span>.<br/>
<span class="id">have</span><span class="id"> [f_</span><span class="id"> [ndf_</span><span class="id"> f_f]]</span><span class="id"> :=</span><span class="id"> approximation</span><span class="id"> measurableT</span><span class="id"> mf</span> (<span class="gallina-kwd">fun</span><span class="id"> y</span><span class="id"> _</span><span class="id"> =&gt;</span><span class="id"> f0</span><span class="id"> y</span>).<br/>
<span class="id">transitivity</span> (<span class="id">lim</span> (<span class="id">\int[uniform_prob</span><span class="id"> ab]_x</span> (<span class="id">f_</span><span class="id"> n</span><span class="id"> x</span>)<span class="id">%:E</span><span class="id"> @[n</span><span class="id"> --&gt;</span><span class="id"> \oo]</span>)<span class="id">%E</span>).<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -monotone_convergence//=</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> apply:</span><span class="id"> eq_integral</span><span class="id"> =&gt;</span><span class="id"> ?</span><span class="id"> /[!inE]</span><span class="id"> xD;</span><span class="id"> apply/esym/cvg_lim</span><span class="id"> =&gt;</span><span class="id"> //=</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> f_f</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> n;</span><span class="id"> exact/measurable_EFinP/measurable_funTS</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> n</span><span class="id"> ?</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> lee_fin</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> ?</span><span class="id"> _</span><span class="id"> ?</span><span class="id"> ?</span><span class="id"> mn;</span><span class="id"> rewrite</span><span class="id"> lee_fin;</span><span class="id"> exact/lefP/ndf_</span>.<br/>
<span class="id">rewrite</span><span class="id"> [X</span><span class="gallina-kwd"> in</span><span class="id"> _</span><span class="id"> =</span> (_<span class="id"> *</span><span class="id"> X</span>)<span class="id">%E]</span>(_<span class="id"> :</span><span class="id"> _</span><span class="id"> =</span><span class="id"> lim</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> `[a,</span><span class="id"> b]</span>) (<span class="id">f_</span><span class="id"> n</span><span class="id"> x</span>)<span class="id">%:E</span><span class="id"> @[n</span><span class="id"> --&gt;</span><span class="id"> \oo]</span>)<span class="id">%E</span>)<span class="id">;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -monotone_convergence//=</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> eq_integral</span><span class="id"> =&gt;</span><span class="id"> ?</span><span class="id"> /[!inE]</span><span class="id"> xD;</span><span class="id"> apply/esym/cvg_lim</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> f_f</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> n;</span><span class="id"> exact/measurable_EFinP/measurable_funTS</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> n</span><span class="id"> ?</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> lee_fin</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> ?</span><span class="id"> _</span><span class="id"> ?</span><span class="id"> ?</span><span class="id"> /ndf_</span><span class="id"> /lefP;</span><span class="id"> rewrite</span><span class="id"> lee_fin</span>.<br/>
<span class="id">rewrite</span><span class="id"> -limeMl//</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> congr_lim;</span><span class="id"> apply/funext</span><span class="id"> =&gt;</span><span class="id"> n</span><span class="id"> /=;</span><span class="id"> exact:</span><span class="id"> integral_uniform_nnsfun</span>.<br/>
<span class="id">apply/ereal_nondecreasing_is_cvgn</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> y</span><span class="id"> xy;</span><span class="id"> apply:</span><span class="id"> ge0_le_integral</span><span class="id"> =&gt;</span><span class="id"> //=</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> ?</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> lee_fin</span>.<br/>
<span class="id">-</span><span class="id"> exact/measurable_EFinP/measurable_funTS</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> ?</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> lee_fin</span>.<br/>
<span class="id">-</span><span class="id"> exact/measurable_EFinP/measurable_funTS</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> ?</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> lee_fin;</span><span class="id"> move/ndf_</span><span class="id"> :</span><span class="id"> xy</span><span class="id"> =&gt;</span><span class="id"> /lefP</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> uniform_probability</span>.<br/>

      <div class="footer"><hr/>Generated by <a href="https://github.com/yoshihiro503/coq2html/">a fork of coq2html</a></div>
    </div>
  </div>
    </main>
</body>
</html>
