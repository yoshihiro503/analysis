
<!DOCTYPE html>
<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Module mathcomp.analysis.ftc</title>
<meta name="description" content="Documentation of Coq module mathcomp.analysis.ftc" />
<link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.css">
<script src="https://cdn.jsdelivr.net/npm/markdown-it/dist/markdown-it.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/markdown-it-texmath/texmath.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/darkmode-js@1.5.7/lib/darkmode-js.min.js"></script>
<link href="coq2html.css" rel="stylesheet" type="text/css" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script type="text/javascript" src="coq2html.js"> </script>
</head>

<body onload="init()">

  <main>
    <div class="sidebar">
      <h2>Files</h2>
      
    </div>

  <div class="coq">

    <div class="content">
      <p><a href="./index.html">Top</a></p>
      <h1 class="title">Module mathcomp.analysis.ftc</h1>
<span class="vernacular">From</span><span class="id"> HB</span><span class="vernacular"> Require</span><span class="vernacular"> Import</span><span class="id"> structures</span>.<br/>
<span class="vernacular">From</span><span class="id"> mathcomp</span><span class="vernacular"> Require</span><span class="vernacular"> Import</span><span class="id"> all_ssreflect</span><span class="id"> ssralg</span><span class="id"> ssrnum</span><span class="id"> ssrint</span><span class="id"> interval</span><span class="id"> finmap</span>.<br/>
<span class="vernacular">From</span><span class="id"> mathcomp</span><span class="vernacular"> Require</span><span class="vernacular"> Import</span><span class="id"> mathcomp_extra</span><span class="id"> boolp</span><span class="id"> classical_sets</span><span class="id"> functions</span>.<br/>
<span class="vernacular">From</span><span class="id"> mathcomp</span><span class="vernacular"> Require</span><span class="vernacular"> Import</span><span class="id"> cardinality</span><span class="id"> fsbigop</span><span class="id"> signed</span><span class="id"> reals</span><span class="id"> ereal</span>.<br/>
<span class="vernacular">From</span><span class="id"> mathcomp</span><span class="vernacular"> Require</span><span class="vernacular"> Import</span><span class="id"> topology</span><span class="id"> tvs</span><span class="id"> normedtype</span><span class="id"> sequences</span><span class="id"> real_interval</span>.<br/>
<span class="vernacular">From</span><span class="id"> mathcomp</span><span class="vernacular"> Require</span><span class="vernacular"> Import</span><span class="id"> esum</span><span class="id"> measure</span><span class="id"> lebesgue_measure</span><span class="id"> numfun</span><span class="id"> realfun</span>.<br/>
<span class="vernacular">From</span><span class="id"> mathcomp</span><span class="vernacular"> Require</span><span class="vernacular"> Import</span><span class="id"> lebesgue_integral</span><span class="id"> derive</span><span class="id"> charge</span>.<br/>
<br/>
<div class="ssrdoc md">
# Fundamental Theorem of Calculus for the Lebesgue Integral

NB: See CONTRIBUTING.md for an introduction to HB concepts and commands.

This file provides a proof of the first fundamental theorem of calculus
for the Lebesgue integral. We derive from this theorem a corollary to
compute the definite integral of continuous functions.

parameterized_integral mu a x f := \int[mu]_(t \in `[a, x] f t)

</div>
<br/>
<span class="gallina-kwd">Set</span><span class="vernacular"> Implicit</span><span class="vernacular"> Arguments</span>.<br/>
<span class="vernacular">Unset</span><span class="vernacular"> Strict</span><span class="vernacular"> Implicit</span>.<br/>
<span class="vernacular">Unset</span><span class="vernacular"> Printing</span><span class="vernacular"> Implicit</span><span class="vernacular"> Defensive</span>.<br/>
<span class="vernacular">Import</span><span class="id"> Order</span>.<span class="id">TTheory</span><span class="id"> GRing</span>.<span class="id">Theory</span><span class="id"> Num</span>.<span class="id">Def</span><span class="id"> Num</span>.<span class="id">Theory</span>.<br/>
<span class="vernacular">Import</span><span class="id"> numFieldNormedType</span>.<span class="vernacular">Exports</span>.<br/>
<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> classical_set_scope</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ring_scope</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> FTC</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {R</span><span class="id"> :</span><span class="id"> realType}</span>.<br/>
<span class="vernacular">Notation</span><span class="id"> mu</span><span class="id"> :=</span> (<span class="id">@lebesgue_measure</span><span class="id"> R</span>).<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<span class="vernacular">Implicit</span><span class="id"> Types</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> R</span>) (<span class="id">a</span><span class="id"> :</span><span class="id"> itv_bound</span><span class="id"> R</span>).<br/>
<br/>
<span class="vernacular">Let</span><span class="id"> FTC0</span><span class="id"> f</span><span class="id"> a</span><span class="id"> :</span><span class="id"> mu</span>.<span class="id">-integrable</span><span class="id"> setT</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> f</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">let</span><span class="id"> F</span><span class="id"> x</span><span class="id"> :=</span> (<span class="id">\int[mu]_</span>(<span class="id">t</span><span class="gallina-kwd"> in</span><span class="id"> [set`</span><span class="id"> Interval</span><span class="id"> a</span> (<span class="id">BRight</span><span class="id"> x</span>)<span class="id">]</span>)<span class="id"> f</span><span class="id"> t</span>)<span class="id">%R</span><span class="gallina-kwd"> in</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">forall</span><span class="id"> x,</span><span class="id"> a</span><span class="id"> &lt;</span><span class="id"> BRight</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> lebesgue_pt</span><span class="id"> f</span><span class="id"> x</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">h^-1</span><span class="id"> *:</span> (<span class="id">F</span> (<span class="id">h</span><span class="id"> +</span><span class="id"> x</span>)<span class="id"> -</span><span class="id"> F</span><span class="id"> x</span>)<span class="id"> @[h</span><span class="id"> --&gt;</span><span class="id"> 0%R^']</span><span class="id"> --&gt;</span><span class="id"> f</span><span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> intf</span><span class="id"> F</span><span class="id"> x</span><span class="id"> ax</span><span class="id"> fx</span>.<br/>
<span class="id">have</span><span class="id"> locf</span><span class="id"> :</span><span class="id"> locally_integrable</span><span class="id"> setT</span><span class="id"> f</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> open_integrable_locally</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> openT</span>.<br/>
<span class="id">apply:</span><span class="id"> cvg_at_right_left_dnbhs</span>.<br/>
<span class="id">-</span><span class="id"> apply/cvg_at_rightP</span><span class="id"> =&gt;</span><span class="id"> d</span><span class="id"> [d_gt0</span><span class="id"> d0]</span>.<br/>
&nbsp;&nbsp;<span class="id">pose</span><span class="id"> E</span><span class="id"> x</span><span class="id"> n</span><span class="id"> :=</span><span class="id"> `[x,</span><span class="id"> x</span><span class="id"> +</span><span class="id"> d</span><span class="id"> n[%classic%R</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> muE</span><span class="id"> y</span><span class="id"> n</span><span class="id"> :</span><span class="id"> mu</span> (<span class="id">E</span><span class="id"> y</span><span class="id"> n</span>)<span class="id"> =</span> (<span class="id">d</span><span class="id"> n</span>)<span class="id">%:E</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> /E</span><span class="id"> lebesgue_measure_itv/=</span><span class="id"> lte_fin</span><span class="id"> ltrDl</span><span class="id"> d_gt0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -EFinD</span><span class="id"> addrAC</span><span class="id"> subrr</span><span class="id"> add0r</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> nice_E</span><span class="id"> y</span><span class="id"> :</span><span class="id"> nicely_shrinking</span><span class="id"> y</span> (<span class="id">E</span><span class="id"> y</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split=&gt;</span><span class="id"> [n|];</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> measurable_itv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">exists</span> (<span class="id">2,</span><span class="gallina-kwd"> fun</span><span class="id"> n</span><span class="id"> =&gt;</span><span class="id"> PosNum</span> (<span class="id">d_gt0</span><span class="id"> n</span>))<span class="id">;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //=</span><span class="id"> [n</span><span class="id"> z|n]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> /E/=</span><span class="id"> in_itv/=</span><span class="id"> /ball/=</span><span class="id"> ltr_distlC</span><span class="id"> =&gt;</span><span class="id"> /andP[yz</span><span class="id"> -&gt;]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span> (<span class="id">lt_le_trans</span><span class="id"> _</span><span class="id"> yz</span>)<span class="id">//</span><span class="id"> ltrBlDr</span><span class="id"> ltrDl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> (<span class="id">lebesgue_measure_ball</span><span class="id"> _</span> (<span class="id">ltW</span><span class="id"> _</span>))<span class="id">//</span><span class="id"> -/mu</span><span class="id"> muE</span><span class="id"> -EFinM</span><span class="id"> lee_fin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> mulr_natl</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> ixdf</span><span class="id"> n</span><span class="id"> :</span><span class="id"> \int[mu]_</span>(<span class="id">t</span><span class="gallina-kwd"> in</span><span class="id"> [set`</span><span class="id"> Interval</span><span class="id"> a</span> (<span class="id">BRight</span> (<span class="id">x</span><span class="id"> +</span><span class="id"> d</span><span class="id"> n</span>))<span class="id">]</span>) (<span class="id">f</span><span class="id"> t</span>)<span class="id">%:E</span><span class="id"> -</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">\int[mu]_</span>(<span class="id">t</span><span class="gallina-kwd"> in</span><span class="id"> [set`</span><span class="id"> Interval</span><span class="id"> a</span> (<span class="id">BRight</span><span class="id"> x</span>)<span class="id">]</span>) (<span class="id">f</span><span class="id"> t</span>)<span class="id">%:E</span><span class="id"> =</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">\int[mu]_</span>(<span class="id">y</span><span class="gallina-kwd"> in</span><span class="id"> E</span><span class="id"> x</span><span class="id"> n</span>) (<span class="id">f</span><span class="id"> y</span>)<span class="id">%:E</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -[in</span><span class="id"> X</span><span class="gallina-kwd"> in</span><span class="id"> X</span><span class="id"> -</span><span class="id"> _]integral_itv_bndo_bndc//=;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> case:</span><span class="id"> locf</span><span class="id"> =&gt;</span><span class="id"> +</span><span class="id"> _</span><span class="id"> _;</span><span class="id"> exact:</span><span class="id"> measurable_funS</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> (<span class="id">@itv_bndbnd_setU</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">BLeft</span><span class="id"> x</span>))<span class="id">//=;</span><span class="id"> last</span><span class="id"> 2</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> case:</span><span class="id"> a</span><span class="id"> ax</span><span class="id"> F</span><span class="id"> =&gt;</span><span class="id"> [[|]</span><span class="id"> a|[|]]//</span><span class="id"> /ltW</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> bnd_simp</span><span class="id"> lerDl</span><span class="id"> ltW</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> integral_setU_EFin//=</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="id"> rewrite</span><span class="id"> addeAC</span><span class="id"> -[X</span><span class="gallina-kwd"> in</span><span class="id"> _</span><span class="id"> -</span><span class="id"> X]integral_itv_bndo_bndc//=;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> case:</span><span class="id"> locf</span><span class="id"> =&gt;</span><span class="id"> +</span><span class="id"> _</span><span class="id"> _;</span><span class="id"> exact:</span><span class="id"> measurable_funS</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> subee</span><span class="id"> ?add0e//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> integral_fune_fin_num</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> integrableS</span><span class="id"> intf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> case:</span><span class="id"> locf</span><span class="id"> =&gt;</span><span class="id"> +</span><span class="id"> _</span><span class="id"> _;</span><span class="id"> exact:</span><span class="id"> measurable_funS</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="id"> apply/disj_setPRL</span><span class="id"> =&gt;</span><span class="id"> z/=</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> /E</span><span class="id"> /=</span><span class="id"> !in_itv/=</span><span class="id"> =&gt;</span><span class="id"> /andP[xz</span><span class="id"> zxdn]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">move:</span><span class="id"> a</span><span class="id"> ax</span><span class="id"> {F}</span><span class="id"> =&gt;</span><span class="id"> [[|]</span><span class="id"> t/=|[_</span><span class="id"> /=|//]]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="id"> rewrite</span><span class="id"> lte_fin</span><span class="id"> =&gt;</span><span class="id"> tx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply/negP;</span><span class="id"> rewrite</span><span class="id"> negb_and</span><span class="id"> -leNgt</span><span class="id"> xz</span><span class="id"> orbT</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="id"> rewrite</span><span class="id"> lte_fin</span><span class="id"> =&gt;</span><span class="id"> tx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply/negP;</span><span class="id"> rewrite</span><span class="id"> negb_and</span><span class="id"> -!leNgt</span><span class="id"> xz</span><span class="id"> orbT</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> apply/negP;</span><span class="id"> rewrite</span><span class="id"> -leNgt</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> [f</span><span class="gallina-kwd"> in</span><span class="id"> f</span><span class="id"> n</span><span class="id"> @[n</span><span class="id"> --&gt;</span><span class="id"> _]</span><span class="id"> --&gt;</span><span class="id"> _]</span>(_<span class="id"> :</span><span class="id"> _</span><span class="id"> =</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">fun</span><span class="id"> n</span><span class="id"> =&gt;</span> (<span class="id">d</span><span class="id"> n</span>)<span class="id">^-1</span><span class="id"> *:</span><span class="id"> fine</span> (<span class="id">\int[mu]_</span>(<span class="id">t</span><span class="gallina-kwd"> in</span><span class="id"> E</span><span class="id"> x</span><span class="id"> n</span>) (<span class="id">f</span><span class="id"> t</span>)<span class="id">%:E</span>))<span class="id">;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply/funext</span><span class="id"> =&gt;</span><span class="id"> n;</span><span class="id"> congr</span> (_<span class="id"> *:</span><span class="id"> _</span>)<span class="id">;</span><span class="id"> rewrite</span><span class="id"> -fineB/=</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /=</span> (<span class="id">addrC</span> (<span class="id">d</span><span class="id"> n</span>)<span class="id"> x</span>)<span class="id"> ixdf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> integral_fune_fin_num</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> integrableS</span><span class="id"> intf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> integral_fune_fin_num</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> integrableS</span><span class="id"> intf</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> :=</span><span class="id"> nice_lebesgue_differentiation</span><span class="id"> nice_E</span><span class="id"> locf</span><span class="id"> fx</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> {ixdf}</span><span class="id"> -/mu</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> [g</span><span class="gallina-kwd"> in</span><span class="id"> g</span><span class="id"> n</span><span class="id"> @[n</span><span class="id"> --&gt;</span><span class="id"> _]</span><span class="id"> --&gt;</span><span class="id"> _</span><span class="id"> -&gt;</span><span class="id"> _]</span>(_<span class="id"> :</span><span class="id"> _</span><span class="id"> =</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">fun</span><span class="id"> n</span><span class="id"> =&gt;</span> (<span class="id">d</span><span class="id"> n</span>)<span class="id">^-1%:E</span><span class="id"> *</span><span class="id"> \int[mu]_</span>(<span class="id">y</span><span class="gallina-kwd"> in</span><span class="id"> E</span><span class="id"> x</span><span class="id"> n</span>) (<span class="id">f</span><span class="id"> y</span>)<span class="id">%:E</span>)<span class="id">;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply/funext</span><span class="id"> =&gt;</span><span class="id"> n;</span><span class="id"> rewrite</span><span class="id"> muE</span>.<br/>
&nbsp;&nbsp;<span class="id">move/fine_cvgP</span><span class="id"> =&gt;</span><span class="id"> [_</span><span class="id"> /=]</span>.<br/>
&nbsp;&nbsp;<span class="id">set</span><span class="id"> g</span><span class="id"> :=</span><span class="id"> _</span><span class="id"> \o</span><span class="id"> _</span><span class="id"> =&gt;</span><span class="id"> gf</span>.<br/>
&nbsp;&nbsp;<span class="id">set</span><span class="id"> h</span><span class="id"> :=</span> (<span class="id">f</span><span class="gallina-kwd"> in</span><span class="id"> f</span><span class="id"> n</span><span class="id"> @[n</span><span class="id"> --&gt;</span><span class="id"> \oo]</span><span class="id"> --&gt;</span><span class="id"> _</span>).<br/>
&nbsp;&nbsp;<span class="id">suff</span><span class="id"> :</span><span class="id"> g</span><span class="id"> =</span><span class="id"> h</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> &lt;-</span>.<br/>
&nbsp;&nbsp;<span class="id">apply/funext</span><span class="id"> =&gt;</span><span class="id"> n</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> /g</span><span class="id"> /h</span><span class="id"> /=</span><span class="id"> fineM//</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> integral_fune_fin_num</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> first</span><span class="id"> exact:</span> (<span class="id">nice_E</span><span class="id"> _</span>).<span class="id">1</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> integrableS</span><span class="id"> intf</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span> (<span class="id">nice_E</span><span class="id"> _</span>).<span class="id">1</span>.<br/>
<span class="id">-</span><span class="id"> apply/cvg_at_leftP</span><span class="id"> =&gt;</span><span class="id"> d</span><span class="id"> [d_gt0</span><span class="id"> d0]</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> {}Nd_gt0</span><span class="id"> n</span><span class="id"> :</span> (<span class="id">0</span><span class="id"> &lt;</span><span class="id"> -</span><span class="id"> d</span><span class="id"> n</span>)<span class="id">%R</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> ltrNr</span><span class="id"> oppr0</span>.<br/>
&nbsp;&nbsp;<span class="id">pose</span><span class="id"> E</span><span class="id"> x</span><span class="id"> n</span><span class="id"> :=</span><span class="id"> `]x</span><span class="id"> +</span><span class="id"> d</span><span class="id"> n,</span><span class="id"> x]%classic%R</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> muE</span><span class="id"> y</span><span class="id"> n</span><span class="id"> :</span><span class="id"> mu</span> (<span class="id">E</span><span class="id"> y</span><span class="id"> n</span>)<span class="id"> =</span> (<span class="id">-</span><span class="id"> d</span><span class="id"> n</span>)<span class="id">%:E</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> /E</span><span class="id"> lebesgue_measure_itv/=</span><span class="id"> lte_fin</span><span class="id"> -ltrBrDr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> ltrDl</span><span class="id"> Nd_gt0</span><span class="id"> -EFinD</span><span class="id"> opprD</span><span class="id"> addrA</span><span class="id"> subrr</span><span class="id"> add0r</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> nice_E</span><span class="id"> y</span><span class="id"> :</span><span class="id"> nicely_shrinking</span><span class="id"> y</span> (<span class="id">E</span><span class="id"> y</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split=&gt;</span><span class="id"> [n|];</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> measurable_itv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">exists</span> (<span class="id">2,</span> (<span class="gallina-kwd">fun</span><span class="id"> n</span><span class="id"> =&gt;</span><span class="id"> PosNum</span> (<span class="id">Nd_gt0</span><span class="id"> n</span>)))<span class="id">;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //=</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -oppr0;</span><span class="id"> exact:</span><span class="id"> cvgN</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> n</span><span class="id"> z</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> /E/=</span><span class="id"> in_itv/=</span><span class="id"> /ball/=</span><span class="id"> =&gt;</span><span class="id"> /andP[yz</span><span class="id"> zy]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> ltr_distlC</span><span class="id"> opprK</span><span class="id"> yz</span><span class="id"> /=</span> (<span class="id">le_lt_trans</span><span class="id"> zy</span>)<span class="id">//</span><span class="id"> ltrDl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> lebesgue_measure_ball//;</span><span class="id"> last</span><span class="id"> exact:</span><span class="id"> ltW</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -/mu</span><span class="id"> muE</span><span class="id"> -EFinM</span><span class="id"> lee_fin</span><span class="id"> mulr_natl</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> ixdf</span><span class="id"> :</span><span class="id"> {near</span><span class="id"> \oo,</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="gallina-kwd">fun</span><span class="id"> n</span><span class="id"> =&gt;</span><span class="id"> \int[mu]_</span>(<span class="id">t</span><span class="gallina-kwd"> in</span><span class="id"> [set`</span><span class="id"> Interval</span><span class="id"> a</span> (<span class="id">BRight</span> (<span class="id">x</span><span class="id"> +</span><span class="id"> d</span><span class="id"> n</span>))<span class="id">]</span>) (<span class="id">f</span><span class="id"> t</span>)<span class="id">%:E</span><span class="id"> -</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">\int[mu]_</span>(<span class="id">t</span><span class="gallina-kwd"> in</span><span class="id"> [set`</span><span class="id"> Interval</span><span class="id"> a</span> (<span class="id">BRight</span><span class="id"> x</span>)<span class="id">]</span>) (<span class="id">f</span><span class="id"> t</span>)<span class="id">%:E</span>)<span class="id"> =1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="gallina-kwd">fun</span><span class="id"> n</span><span class="id"> =&gt;</span><span class="id"> -</span><span class="id"> \int[mu]_</span>(<span class="id">y</span><span class="gallina-kwd"> in</span><span class="id"> E</span><span class="id"> x</span><span class="id"> n</span>) (<span class="id">f</span><span class="id"> y</span>)<span class="id">%:E</span>)<span class="id">}</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">case:</span><span class="id"> a</span><span class="id"> ax</span><span class="id"> {F};</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> [_|//]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> nearW</span><span class="id"> =&gt;</span><span class="id"> n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -[in</span><span class="id"> LHS]integral_itv_bndo_bndc//=;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> case:</span><span class="id"> locf</span><span class="id"> =&gt;</span><span class="id"> +</span><span class="id"> _</span><span class="id"> _;</span><span class="id"> exact:</span><span class="id"> measurable_funS</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -/mu</span><span class="id"> -[LHS]oppeK;</span><span class="id"> congr</span><span class="id"> oppe</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> oppeB;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> fin_num_adde_defl//</span><span class="id"> fin_numN//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> integral_fune_fin_num</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> integrableS</span><span class="id"> intf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> addeC</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> (_<span class="id"> :</span><span class="id"> `]-oo,</span><span class="id"> x]</span><span class="id"> =</span><span class="id"> `]-oo,</span> (<span class="id">x</span><span class="id"> +</span><span class="id"> d</span><span class="id"> n</span>)<span class="id">%R]</span><span class="id"> `|`</span><span class="id"> E</span><span class="id"> x</span><span class="id"> n</span>)<span class="id">%classic;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -itv_bndbnd_setU//=</span><span class="id"> bnd_simp</span><span class="id"> ler_wnDr//</span><span class="id"> ltW</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> integral_setU_EFin//=</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="id"> rewrite</span><span class="id"> addeAC</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -[X</span><span class="gallina-kwd"> in</span><span class="id"> X</span><span class="id"> -</span><span class="id"> _]integral_itv_bndo_bndc//;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> case:</span><span class="id"> locf</span><span class="id"> =&gt;</span><span class="id"> +</span><span class="id"> _</span><span class="id"> _;</span><span class="id"> exact:</span><span class="id"> measurable_funS</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> subee</span><span class="id"> ?add0e//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> integral_fune_fin_num</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> integrableS</span><span class="id"> intf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="id"> exact:</span> (<span class="id">nice_E</span><span class="id"> _</span>).<span class="id">1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> case:</span><span class="id"> locf</span><span class="id"> =&gt;</span><span class="id"> +</span><span class="id"> _</span><span class="id"> _;</span><span class="id"> exact:</span><span class="id"> measurable_funS</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="id"> apply/disj_setPLR</span><span class="id"> =&gt;</span><span class="id"> z/=</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> /E</span><span class="id"> /=</span><span class="id"> !in_itv/=</span><span class="id"> leNgt</span><span class="id"> =&gt;</span><span class="id"> xdnz</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply/negP;</span><span class="id"> rewrite</span><span class="id"> negb_and</span><span class="id"> xdnz</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> b</span><span class="id"> a</span><span class="id"> ax</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">move/cvgrPdist_le</span><span class="id"> :</span><span class="id"> d0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">move/</span>(_ (<span class="id">x</span><span class="id"> -</span><span class="id"> a</span>)<span class="id">%R</span>)<span class="id">;</span><span class="id"> rewrite</span><span class="id"> subr_gt0</span><span class="id"> =&gt;</span><span class="id"> /</span>(_<span class="id"> ax</span>)<span class="id">[m</span><span class="id"> _</span><span class="id"> /=]</span><span class="id"> h</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">near=&gt;</span><span class="id"> n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">have</span><span class="id"> mn</span><span class="id"> :</span> (<span class="id">m</span><span class="id"> &lt;=</span><span class="id"> n</span>)<span class="id">%N</span><span class="gallina-kwd"> by</span><span class="id"> near:</span><span class="id"> n;</span><span class="gallina-kwd"> exists</span><span class="id"> m</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -[in</span><span class="id"> X</span><span class="gallina-kwd"> in</span><span class="id"> X</span><span class="id"> -</span><span class="id"> _]integral_itv_bndo_bndc//=;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> case:</span><span class="id"> locf</span><span class="id"> =&gt;</span><span class="id"> +</span><span class="id"> _</span><span class="id"> _;</span><span class="id"> exact:</span><span class="id"> measurable_funS</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -/mu</span><span class="id"> -[LHS]oppeK;</span><span class="id"> congr</span><span class="id"> oppe</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> oppeB;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> fin_num_adde_defl//</span><span class="id"> fin_numN//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> integral_fune_fin_num</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> integrableS</span><span class="id"> intf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> addeC</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> (<span class="id">@itv_bndbnd_setU</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">BRight</span> (<span class="id">x</span><span class="id"> -</span><span class="id"> -</span><span class="id"> d</span><span class="id"> n</span>)<span class="id">%R</span>))<span class="id">//;</span><span class="id"> last</span><span class="id"> 2</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">case:</span><span class="id"> b</span><span class="gallina-kwd"> in</span><span class="id"> ax</span><span class="id"> *</span><span class="id"> =&gt;</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> bnd_simp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> lerBrDl</span><span class="id"> addrC</span><span class="id"> -lerBrDl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> have</span><span class="id"> :=</span><span class="id"> h</span><span class="id"> _</span><span class="id"> mn;</span><span class="id"> rewrite</span><span class="id"> sub0r</span><span class="id"> gtr0_norm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> lerBrDl</span><span class="id"> -lerBrDr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> have</span><span class="id"> :=</span><span class="id"> h</span><span class="id"> _</span><span class="id"> mn;</span><span class="id"> rewrite</span><span class="id"> sub0r</span><span class="id"> gtr0_norm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> opprK</span><span class="id"> bnd_simp</span><span class="id"> -lerBrDl</span><span class="id"> subrr</span><span class="id"> ltW</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> integral_setU_EFin//=</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="id"> rewrite</span><span class="id"> addeAC</span><span class="id"> -[X</span><span class="gallina-kwd"> in</span><span class="id"> X</span><span class="id"> -</span><span class="id"> _]integral_itv_bndo_bndc//;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> case:</span><span class="id"> locf</span><span class="id"> =&gt;</span><span class="id"> +</span><span class="id"> _</span><span class="id"> _;</span><span class="id"> exact:</span><span class="id"> measurable_funS</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> opprK</span><span class="id"> subee</span><span class="id"> ?add0e//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> integral_fune_fin_num</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> integrableS</span><span class="id"> intf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> case:</span><span class="id"> locf</span><span class="id"> =&gt;</span><span class="id"> +</span><span class="id"> _</span><span class="id"> _;</span><span class="id"> exact:</span><span class="id"> measurable_funS</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="id"> apply/disj_setPLR</span><span class="id"> =&gt;</span><span class="id"> z/=</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> /E</span><span class="id"> /=</span><span class="id"> !in_itv/=</span><span class="id"> =&gt;</span><span class="id"> /andP[az</span><span class="id"> zxdn]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply/negP;</span><span class="id"> rewrite</span><span class="id"> negb_and</span><span class="id"> -leNgt</span><span class="id"> zxdn</span>.<br/>
&nbsp;&nbsp;<span class="id">suff:</span> ((<span class="id">d</span><span class="id"> n</span>)<span class="id">^-1</span><span class="id"> *</span><span class="id"> -</span><span class="id"> fine</span> (<span class="id">\int[mu]_</span>(<span class="id">y</span><span class="gallina-kwd"> in</span><span class="id"> E</span><span class="id"> x</span><span class="id"> n</span>) (<span class="id">f</span><span class="id"> y</span>)<span class="id">%:E</span>))<span class="id">%R</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">@[n</span><span class="id"> --&gt;</span><span class="id"> \oo]</span><span class="id"> --&gt;</span><span class="id"> f</span><span class="id"> x</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> cvg_trans;</span><span class="id"> apply:</span><span class="id"> near_eq_cvg;</span><span class="id"> near=&gt;</span><span class="id"> n;</span> <span class="id"> congr</span> (_<span class="id"> *:</span><span class="id"> _</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> /F</span><span class="id"> -fineN</span><span class="id"> -fineB;</span><span class="id"> last</span><span class="id"> 2</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> integral_fune_fin_num</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> integrableS</span><span class="id"> intf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> integral_fune_fin_num</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> integrableS</span><span class="id"> intf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> congr</span><span class="id"> fine</span><span class="id"> =&gt;</span><span class="id"> /=;</span><span class="id"> apply/esym;</span><span class="id"> rewrite</span> (<span class="id">addrC</span><span class="id"> _</span><span class="id"> x</span>)<span class="id">;</span><span class="id"> near:</span><span class="id"> n</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> :=</span><span class="id"> nice_lebesgue_differentiation</span><span class="id"> nice_E</span><span class="id"> locf</span><span class="id"> fx</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> {ixdf}</span><span class="id"> -/mu</span>.<br/>
&nbsp;&nbsp;<span class="id">move/fine_cvgP</span><span class="id"> =&gt;</span><span class="id"> [_</span><span class="id"> /=]</span>.<br/>
&nbsp;&nbsp;<span class="id">set</span><span class="id"> g</span><span class="id"> :=</span><span class="id"> _</span><span class="id"> \o</span><span class="id"> _</span><span class="id"> =&gt;</span><span class="id"> gf</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> (<span class="id">@eq_cvg</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> g</span>)<span class="id">//</span><span class="id"> =&gt;</span><span class="id"> n</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> /g</span><span class="id"> /=</span><span class="id"> fineM//=;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> integral_fune_fin_num</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> first</span><span class="id"> exact:</span> (<span class="id">nice_E</span><span class="id"> _</span>).<span class="id">1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> integrableS</span><span class="id"> intf</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span> (<span class="id">nice_E</span><span class="id"> _</span>).<span class="id">1</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> muE/=</span><span class="id"> invrN</span><span class="id"> mulNr</span><span class="id"> -mulrN</span>.<br/>
<span class="id">Unshelve</span>.<span class="id"> all:</span><span class="gallina-kwd"> by</span><span class="id"> end_near</span>. Qed.</div></details>
<br/>
<span class="vernacular">Let</span><span class="id"> FTC0_restrict</span><span class="id"> f</span><span class="id"> a</span><span class="id"> x</span> (<span class="id">u</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span> (<span class="id">x</span><span class="id"> &lt;</span><span class="id"> u</span>)<span class="id">%R</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">mu</span>.<span class="id">-integrable</span><span class="id"> [set`</span><span class="id"> Interval</span><span class="id"> a</span> (<span class="id">BRight</span><span class="id"> u</span>)<span class="id">]</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> f</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">let</span><span class="id"> F</span><span class="id"> y</span><span class="id"> :=</span> (<span class="id">\int[mu]_</span>(<span class="id">t</span><span class="gallina-kwd"> in</span><span class="id"> [set`</span><span class="id"> Interval</span><span class="id"> a</span> (<span class="id">BRight</span><span class="id"> y</span>)<span class="id">]</span>)<span class="id"> f</span><span class="id"> t</span>)<span class="id">%R</span><span class="gallina-kwd"> in</span><br/>
&nbsp;&nbsp;<span class="id">a</span><span class="id"> &lt;</span><span class="id"> BRight</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> lebesgue_pt</span><span class="id"> f</span><span class="id"> x</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">h^-1</span><span class="id"> *:</span> (<span class="id">F</span> (<span class="id">h</span><span class="id"> +</span><span class="id"> x</span>)<span class="id"> -</span><span class="id"> F</span><span class="id"> x</span>)<span class="id"> @[h</span><span class="id"> --&gt;</span><span class="id"> 0%R^']</span><span class="id"> --&gt;</span><span class="id"> f</span><span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> xu</span><span class="id"> +</span><span class="id"> F</span><span class="id"> ax</span><span class="id"> fx</span>.<br/>
<span class="id">rewrite</span><span class="id"> integrable_mkcond//=</span> (<span class="id">restrict_EFin</span><span class="id"> f</span>)<span class="id"> =&gt;</span><span class="id"> intf</span>.<br/>
<span class="id">have</span><span class="id"> /</span>(<span class="id">@FTC0</span><span class="id"> _</span><span class="id"> _</span><span class="id"> intf</span><span class="id"> _</span><span class="id"> ax</span>)<span class="id"> :</span><span class="id"> lebesgue_pt</span> (<span class="id">f</span><span class="id"> \_</span><span class="id"> [set`</span><span class="id"> Interval</span><span class="id"> a</span> (<span class="id">BRight</span><span class="id"> u</span>)<span class="id">]</span>)<span class="id"> x</span>.<br/>
&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> lebesgue_pt_restrict</span>.<br/>
<span class="id">rewrite</span><span class="id"> patchE</span><span class="id"> mem_set;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> /=</span><span class="id"> in_itv/=</span> (<span class="id">ltW</span><span class="id"> xu</span>)<span class="id"> andbT</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move:</span><span class="id"> a</span><span class="id"> ax</span><span class="id"> {F</span><span class="id"> intf}</span><span class="id"> =&gt;</span><span class="id"> [[a|]|[]]//=;</span><span class="id"> rewrite</span><span class="id"> lte_fin</span><span class="id"> =&gt;</span><span class="id"> /ltW</span>.<br/>
<span class="id">apply:</span><span class="id"> cvg_trans;</span><span class="id"> apply:</span><span class="id"> near_eq_cvg;</span><span class="id"> near=&gt;</span><span class="id"> r;</span><span class="id"> congr</span> (_<span class="id"> *:</span> (_<span class="id"> -</span><span class="id"> _</span>)).<br/>
<span class="id">-</span><span class="id"> apply:</span><span class="id"> eq_Rintegral</span><span class="id"> =&gt;</span><span class="id"> y</span><span class="id"> yaxr;</span><span class="id"> rewrite</span><span class="id"> patchE</span><span class="id"> mem_set//=</span>.<br/>
&nbsp;&nbsp;<span class="id">move:</span><span class="id"> yaxr;</span><span class="id"> rewrite</span><span class="id"> /=</span><span class="id"> !in_itv/=</span><span class="id"> inE/=</span><span class="id"> in_itv/=</span><span class="id"> =&gt;</span><span class="id"> /andP[-&gt;/=]</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> /le_trans;</span><span class="id"> apply;</span><span class="id"> rewrite</span><span class="id"> -lerBrDr</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> [r0|r0]</span><span class="id"> :=</span><span class="id"> leP</span><span class="id"> r</span><span class="id"> 0%R;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span> (<span class="id">le_trans</span><span class="id"> r0</span>)<span class="id">//</span><span class="id"> subr_ge0</span><span class="id"> ltW</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -</span>(<span class="id">gtr0_norm</span><span class="id"> r0</span>)<span class="id">;</span><span class="id"> near:</span><span class="id"> r;</span><span class="id"> apply:</span><span class="id"> dnbhs0_le;</span><span class="id"> rewrite</span><span class="id"> subr_gt0</span>.<br/>
<span class="id">-</span><span class="id"> apply:</span><span class="id"> eq_Rintegral</span><span class="id"> =&gt;</span><span class="id"> y</span><span class="id"> yaxr;</span><span class="id"> rewrite</span><span class="id"> patchE</span><span class="id"> mem_set//=</span>.<br/>
&nbsp;&nbsp;<span class="id">move:</span><span class="id"> yaxr</span><span class="id"> =&gt;</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> !in_itv/=</span><span class="id"> inE/=</span><span class="id"> in_itv/=</span><span class="id"> =&gt;</span><span class="id"> /andP[-&gt;/=]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> /le_trans;</span><span class="id"> apply;</span><span class="id"> exact/ltW</span>.<br/>
<span class="id">Unshelve</span>.<span class="id"> all:</span><span class="gallina-kwd"> by</span><span class="id"> end_near</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> FTC1_lebesgue_pt</span><span class="id"> f</span><span class="id"> a</span><span class="id"> x</span> (<span class="id">u</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span> (<span class="id">x</span><span class="id"> &lt;</span><span class="id"> u</span>)<span class="id">%R</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">mu</span>.<span class="id">-integrable</span><span class="id"> [set`</span><span class="id"> Interval</span><span class="id"> a</span> (<span class="id">BRight</span><span class="id"> u</span>)<span class="id">]</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> f</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">let</span><span class="id"> F</span><span class="id"> y</span><span class="id"> :=</span> (<span class="id">\int[mu]_</span>(<span class="id">t</span><span class="gallina-kwd"> in</span><span class="id"> [set`</span><span class="id"> Interval</span><span class="id"> a</span> (<span class="id">BRight</span><span class="id"> y</span>)<span class="id">]</span>) (<span class="id">f</span><span class="id"> t</span>))<span class="id">%R</span><span class="gallina-kwd"> in</span><br/>
&nbsp;&nbsp;<span class="id">a</span><span class="id"> &lt;</span><span class="id"> BRight</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> lebesgue_pt</span><span class="id"> f</span><span class="id"> x</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">derivable</span><span class="id"> F</span><span class="id"> x</span><span class="id"> 1</span><span class="id"> /\</span><span class="id"> F^`</span>()<span class="id"> x</span><span class="id"> =</span><span class="id"> f</span><span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> xu</span><span class="id"> intf</span><span class="id"> F</span><span class="id"> ax</span><span class="id"> fx;</span><span class="id"> split;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply/cvg_lim;</span><span class="id"> [exact:</span><span class="id"> Rhausdorff|exact:</span> (<span class="id">@FTC0_restrict</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> u</span>)<span class="id">]</span>.<br/>
<span class="id">apply/cvg_ex;</span><span class="gallina-kwd"> exists</span> (<span class="id">f</span><span class="id"> x</span>).<br/>
<span class="id">have</span><span class="id"> /=</span><span class="id"> :=</span><span class="id"> FTC0_restrict</span><span class="id"> xu</span><span class="id"> intf</span><span class="id"> ax</span><span class="id"> fx</span>.<br/>
<span class="id">set</span><span class="id"> g</span><span class="id"> :=</span> (<span class="id">f</span><span class="gallina-kwd"> in</span><span class="id"> f</span><span class="id"> n</span><span class="id"> @[n</span><span class="id"> --&gt;</span><span class="id"> _]</span><span class="id"> --&gt;</span><span class="id"> _</span><span class="id"> -&gt;</span><span class="id"> _</span>).<br/>
<span class="id">set</span><span class="id"> h</span><span class="id"> :=</span> (<span class="id">f</span><span class="gallina-kwd"> in</span><span class="id"> _</span><span class="id"> -&gt;</span><span class="id"> f</span><span class="id"> n</span><span class="id"> @[n</span><span class="id"> --&gt;</span><span class="id"> _]</span><span class="id"> --&gt;</span><span class="id"> _</span>).<br/>
<span class="id">suff</span><span class="id"> :</span><span class="id"> g</span><span class="id"> =</span><span class="id"> h</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> &lt;-</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply/funext</span><span class="id"> =&gt;</span><span class="id"> y;rewrite</span><span class="id"> /g</span><span class="id"> /h</span><span class="id"> /=</span><span class="id"> [X</span><span class="gallina-kwd"> in</span><span class="id"> F</span> (<span class="id">X</span><span class="id"> +</span><span class="id"> _</span>)<span class="id">]mulr1</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Corollary</span><span class="id"> FTC1</span><span class="id"> f</span><span class="id"> a</span><span class="id"> :</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">forall</span><span class="id"> y,</span><span class="id"> mu</span>.<span class="id">-integrable</span><span class="id"> [set`</span><span class="id"> Interval</span><span class="id"> a</span> (<span class="id">BRight</span><span class="id"> y</span>)<span class="id">]</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> f</span>))<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">locally_integrable</span><span class="id"> [set:</span><span class="id"> R]</span><span class="id"> f</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">let</span><span class="id"> F</span><span class="id"> x</span><span class="id"> :=</span> (<span class="id">\int[mu]_</span>(<span class="id">t</span><span class="gallina-kwd"> in</span><span class="id"> [set`</span><span class="id"> Interval</span><span class="id"> a</span> (<span class="id">BRight</span><span class="id"> x</span>)<span class="id">]</span>) (<span class="id">f</span><span class="id"> t</span>))<span class="id">%R</span><span class="gallina-kwd"> in</span><br/>
&nbsp;&nbsp;<span class="id">{ae</span><span class="id"> mu,</span><span class="gallina-kwd"> forall</span><span class="id"> x,</span><span class="id"> a</span><span class="id"> &lt;</span><span class="id"> BRight</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> derivable</span><span class="id"> F</span><span class="id"> x</span><span class="id"> 1</span><span class="id"> /\</span><span class="id"> F^`</span>()<span class="id"> x</span><span class="id"> =</span><span class="id"> f</span><span class="id"> x}</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> intf</span><span class="id"> locf</span><span class="id"> F;</span><span class="id"> move:</span> (<span class="id">locf</span>)<span class="id"> =&gt;</span><span class="id"> /lebesgue_differentiation</span>.<br/>
<span class="id">apply:</span><span class="id"> filterS;</span><span class="id"> first</span><span class="id"> exact:</span> (<span class="id">ae_filter_ringOfSetsType</span><span class="id"> mu</span>).<br/>
<span class="id">move=&gt;</span><span class="id"> i</span><span class="id"> fi</span><span class="id"> ai</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply:</span> (<span class="id">@FTC1_lebesgue_pt</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">i</span><span class="id"> +</span><span class="id"> 1</span>)<span class="id">%R</span>)<span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> rewrite</span><span class="id"> ltrDl</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Corollary</span><span class="id"> FTC1Ny</span><span class="id"> f</span><span class="id"> :</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">forall</span><span class="id"> y,</span><span class="id"> mu</span>.<span class="id">-integrable</span><span class="id"> `]-oo,</span><span class="id"> y]</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> f</span>))<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">locally_integrable</span><span class="id"> [set:</span><span class="id"> R]</span><span class="id"> f</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">let</span><span class="id"> F</span><span class="id"> x</span><span class="id"> :=</span> (<span class="id">\int[mu]_</span>(<span class="id">t</span><span class="gallina-kwd"> in</span><span class="id"> [set`</span><span class="id"> `]-oo,</span><span class="id"> x]]</span>) (<span class="id">f</span><span class="id"> t</span>))<span class="id">%R</span><span class="gallina-kwd"> in</span><br/>
&nbsp;&nbsp;<span class="id">{ae</span><span class="id"> mu,</span><span class="gallina-kwd"> forall</span><span class="id"> x,</span><span class="id"> derivable</span><span class="id"> F</span><span class="id"> x</span><span class="id"> 1</span><span class="id"> /\</span><span class="id"> F^`</span>()<span class="id"> x</span><span class="id"> =</span><span class="id"> f</span><span class="id"> x}</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> intf</span><span class="id"> locf</span><span class="id"> F;</span><span class="id"> have</span><span class="id"> :=</span><span class="id"> FTC1</span><span class="id"> intf</span><span class="id"> locf</span>.<br/>
<span class="id">apply:</span><span class="id"> filterS;</span><span class="id"> first</span><span class="id"> exact:</span> (<span class="id">ae_filter_ringOfSetsType</span><span class="id"> mu</span>).<br/>
<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> r</span><span class="id"> /=;</span><span class="id"> apply;</span><span class="id"> rewrite</span><span class="id"> ltNyr</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Let</span><span class="id"> itv_continuous_lebesgue_pt</span><span class="id"> f</span><span class="id"> a</span><span class="id"> x</span> (<span class="id">u</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span> (<span class="id">x</span><span class="id"> &lt;</span><span class="id"> u</span>)<span class="id">%R</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">measurable_fun</span><span class="id"> [set`</span><span class="id"> Interval</span><span class="id"> a</span> (<span class="id">BRight</span><span class="id"> u</span>)<span class="id">]</span><span class="id"> f</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">a</span><span class="id"> &lt;</span><span class="id"> BRight</span><span class="id"> x</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">{for</span><span class="id"> x,</span><span class="id"> continuous</span><span class="id"> f}</span><span class="id"> -&gt;</span><span class="id"> lebesgue_pt</span><span class="id"> f</span><span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> xu</span><span class="id"> fi</span><span class="id"> +</span><span class="id"> fx</span>.<br/>
<span class="id">move:</span><span class="id"> a</span><span class="id"> fi</span><span class="id"> =&gt;</span><span class="id"> [b</span><span class="id"> a</span><span class="id"> fi</span><span class="id"> /[1!</span>(<span class="id">@lte_fin</span><span class="id"> R</span>)<span class="id">]</span><span class="id"> ax|[|//]</span><span class="id"> fi</span><span class="id"> _]</span>.<br/>
<span class="id">-</span><span class="id"> near</span> (<span class="id">0%R:R</span>)<span class="id">^'+</span><span class="id"> =&gt;</span><span class="id"> e;</span><span class="id"> apply:</span> (<span class="id">@continuous_lebesgue_pt</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">ball</span><span class="id"> x</span><span class="id"> e</span>))<span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="id"> exact:</span><span class="id"> ball_open_nbhs</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="id"> exact:</span><span class="id"> measurable_ball</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="id"> apply:</span><span class="id"> measurable_funS</span><span class="id"> fi</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> rewrite</span><span class="id"> ball_itv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span> (<span class="id">@subset_trans</span><span class="id"> _</span><span class="id"> `]</span>(<span class="id">x</span><span class="id"> -</span><span class="id"> e</span>)<span class="id">%R,</span><span class="id"> u]</span>)<span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> subset_itvl;</span><span class="id"> rewrite</span><span class="id"> bnd_simp</span><span class="id"> -lerBrDl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> near:</span><span class="id"> e;</span><span class="id"> apply:</span><span class="id"> nbhs_right_ltW;</span><span class="id"> rewrite</span><span class="id"> subr_gt0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> subset_itvr;</span><span class="id"> rewrite</span><span class="id"> bnd_simp</span><span class="id"> lerBrDr</span><span class="id"> -lerBrDl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> near:</span><span class="id"> e;</span><span class="id"> apply:</span><span class="id"> nbhs_right_ltW;</span><span class="id"> rewrite</span><span class="id"> subr_gt0</span>.<br/>
<span class="id">-</span><span class="id"> near</span> (<span class="id">0%R:R</span>)<span class="id">^'+</span><span class="id"> =&gt;</span><span class="id"> e;</span><span class="id"> apply:</span> (<span class="id">@continuous_lebesgue_pt</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">ball</span><span class="id"> x</span><span class="id"> e</span>))<span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="id"> exact:</span><span class="id"> ball_open_nbhs</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="id"> exact:</span><span class="id"> measurable_ball</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="id"> apply:</span><span class="id"> measurable_funS</span><span class="id"> fi</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> rewrite</span><span class="id"> ball_itv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span> (<span class="id">@subset_trans</span><span class="id"> _</span><span class="id"> `]</span>(<span class="id">x</span><span class="id"> -</span><span class="id"> e</span>)<span class="id">%R,</span><span class="id"> u]</span>)<span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> subset_itvl;</span><span class="id"> rewrite</span><span class="id"> bnd_simp</span><span class="id"> -lerBrDl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> near:</span><span class="id"> e;</span><span class="id"> apply:</span><span class="id"> nbhs_right_ltW;</span><span class="id"> rewrite</span><span class="id"> subr_gt0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> subset_itvr</span>.<br/>
<span class="id">Unshelve</span>.<span class="id"> all:</span><span class="gallina-kwd"> by</span><span class="id"> end_near</span>. Qed.</div></details>
<br/>
<span class="vernacular">Corollary</span><span class="id"> continuous_FTC1</span><span class="id"> f</span><span class="id"> a</span><span class="id"> x</span> (<span class="id">u</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span> (<span class="id">x</span><span class="id"> &lt;</span><span class="id"> u</span>)<span class="id">%R</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">mu</span>.<span class="id">-integrable</span><span class="id"> [set`</span><span class="id"> Interval</span><span class="id"> a</span> (<span class="id">BRight</span><span class="id"> u</span>)<span class="id">]</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> f</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">let</span><span class="id"> F</span><span class="id"> x</span><span class="id"> :=</span> (<span class="id">\int[mu]_</span>(<span class="id">t</span><span class="gallina-kwd"> in</span><span class="id"> [set`</span><span class="id"> Interval</span><span class="id"> a</span> (<span class="id">BRight</span><span class="id"> x</span>)<span class="id">]</span>) (<span class="id">f</span><span class="id"> t</span>))<span class="id">%R</span><span class="gallina-kwd"> in</span><br/>
&nbsp;&nbsp;<span class="id">a</span><span class="id"> &lt;</span><span class="id"> BRight</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> {for</span><span class="id"> x,</span><span class="id"> continuous</span><span class="id"> f}</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">derivable</span><span class="id"> F</span><span class="id"> x</span><span class="id"> 1</span><span class="id"> /\</span><span class="id"> F^`</span>()<span class="id"> x</span><span class="id"> =</span><span class="id"> f</span><span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> xu</span><span class="id"> fi</span><span class="id"> F</span><span class="id"> ax</span><span class="id"> fx;</span><span class="id"> suff</span><span class="id"> lfx</span><span class="id"> :</span><span class="id"> lebesgue_pt</span><span class="id"> f</span><span class="id"> x</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> /</span>(_<span class="id"> ax</span><span class="id"> lfx</span>)<span class="id">[dfx</span><span class="id"> f'xE]</span><span class="id"> :=</span><span class="id"> @FTC1_lebesgue_pt</span><span class="id"> _</span><span class="id"> a</span><span class="id"> _</span><span class="id"> _</span><span class="id"> xu</span><span class="id"> fi</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> split;</span><span class="id"> [exact:</span><span class="id"> dfx|rewrite</span><span class="id"> f'xE]</span>.<br/>
<span class="id">apply:</span><span class="id"> itv_continuous_lebesgue_pt</span><span class="id"> xu</span><span class="id"> _</span><span class="id"> ax</span><span class="id"> fx</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> move/integrableP</span><span class="id"> :</span><span class="id"> fi</span><span class="id"> =&gt;</span><span class="id"> -[/measurable_EFinP]</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Corollary</span><span class="id"> continuous_FTC1_closed</span><span class="id"> f</span> (<span class="id">a</span><span class="id"> x</span><span class="id"> :</span><span class="id"> R</span>) (<span class="id">u</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span> (<span class="id">x</span><span class="id"> &lt;</span><span class="id"> u</span>)<span class="id">%R</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">mu</span>.<span class="id">-integrable</span><span class="id"> `[a,</span><span class="id"> u]</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> f</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">let</span><span class="id"> F</span><span class="id"> x</span><span class="id"> :=</span> (<span class="id">\int[mu]_</span>(<span class="id">t</span><span class="gallina-kwd"> in</span><span class="id"> [set`</span><span class="id"> `[a,</span><span class="id"> x]]</span>) (<span class="id">f</span><span class="id"> t</span>))<span class="id">%R</span><span class="gallina-kwd"> in</span><br/>
&nbsp;&nbsp;(<span class="id">a</span><span class="id"> &lt;</span><span class="id"> x</span>)<span class="id">%R</span><span class="id"> -&gt;</span><span class="id"> {for</span><span class="id"> x,</span><span class="id"> continuous</span><span class="id"> f}</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">derivable</span><span class="id"> F</span><span class="id"> x</span><span class="id"> 1</span><span class="id"> /\</span><span class="id"> F^`</span>()<span class="id"> x</span><span class="id"> =</span><span class="id"> f</span><span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> xu</span><span class="id"> locf</span><span class="id"> F</span><span class="id"> ax</span><span class="id"> fx;</span><span class="id"> exact:</span> (<span class="id">@continuous_FTC1</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> u</span>). Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> FTC</span>.<br/>
<br/>
<span class="vernacular">Definition</span><span class="id"> parameterized_integral</span><span class="id"> {R</span><span class="id"> :</span><span class="id"> realType}</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">mu</span><span class="id"> :</span><span class="id"> {measure</span><span class="id"> set</span> (<span class="id">g_sigma_algebraType</span> (<span class="id">R</span>.<span class="id">-ocitv</span>.<span class="id">-measurable</span>))<span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R}</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">a</span><span class="id"> x</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> R</span>)<span class="id"> :</span><span class="id"> R</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;(<span class="id">\int[mu]_</span>(<span class="id">t</span><span class="gallina-kwd"> in</span><span class="id"> `[a,</span><span class="id"> x]</span>)<span class="id"> f</span><span class="id"> t</span>)<span class="id">%R</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> parameterized_integral_continuous</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {R</span><span class="id"> :</span><span class="id"> realType}</span>.<br/>
<span class="vernacular">Notation</span><span class="id"> mu</span><span class="id"> :=</span> (<span class="id">@lebesgue_measure</span><span class="id"> R</span>).<br/>
<br/>
<span class="vernacular">Let</span><span class="id"> int</span><span class="id"> :=</span> (<span class="id">parameterized_integral</span><span class="id"> mu</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> parameterized_integral_near_left</span> (<span class="id">a</span><span class="id"> b</span><span class="id"> :</span><span class="id"> R</span>) (<span class="id">e</span><span class="id"> :</span><span class="id"> R</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">a</span><span class="id"> &lt;</span><span class="id"> b</span><span class="id"> -&gt;</span><span class="id"> 0</span><span class="id"> &lt;</span><span class="id"> e</span><span class="id"> -&gt;</span><span class="id"> mu</span>.<span class="id">-integrable</span><span class="id"> `[a,</span><span class="id"> b]</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> f</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">\forall</span><span class="id"> c</span><span class="id"> \near</span><span class="id"> a,</span><span class="id"> a</span><span class="id"> &lt;=</span><span class="id"> c</span><span class="id"> -&gt;</span><span class="id"> `|</span><span class="id"> int</span><span class="id"> a</span><span class="id"> c</span><span class="id"> f</span><span class="id"> |</span><span class="id"> &lt;</span><span class="id"> e</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> ab</span><span class="id"> e0</span><span class="id"> intf</span>.<br/>
<span class="id">have</span><span class="id"> :</span><span class="id"> mu</span>.<span class="id">-integrable</span><span class="id"> setT</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> f</span><span class="id"> \_</span><span class="id"> `[a,</span><span class="id"> b]</span>).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -restrict_EFin;</span><span class="id"> apply/integrable_restrict</span><span class="id"> =&gt;</span><span class="id"> //=;</span><span class="id"> rewrite</span><span class="id"> setTI</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> /integral_normr_continuous</span><span class="id"> /</span>(_<span class="id"> _</span><span class="id"> e0</span>)<span class="id">[d</span><span class="id"> [d0</span><span class="id"> /=]]</span><span class="id"> ifab</span>.<br/>
<span class="id">near=&gt;</span><span class="id"> c</span><span class="id"> =&gt;</span><span class="id"> ac</span>.<br/>
<span class="id">have</span><span class="id"> /ifab</span><span class="id"> :</span> (<span class="id">mu</span><span class="id"> `[a,</span><span class="id"> c]</span><span class="id"> &lt;</span><span class="id"> d%:E</span>)<span class="id">%E</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> lebesgue_measure_itv/=</span><span class="id"> lte_fin</span>.<br/>
&nbsp;&nbsp;<span class="id">case:</span><span class="id"> ifPn</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> {}ac;</span><span class="id"> rewrite</span><span class="id"> -EFinD</span><span class="id"> lte_fin</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move:</span><span class="id"> ac;</span><span class="id"> near:</span><span class="id"> c;</span><span class="id"> exact:</span><span class="id"> nbhs_right_ltDr</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> /</span>(_ (<span class="id">measurable_itv</span><span class="id"> _</span>))<span class="id"> {ifab}</span>.<br/>
<span class="id">apply:</span><span class="id"> le_lt_trans</span>.<br/>
<span class="id">have</span><span class="id"> acbc</span><span class="id"> :</span><span class="id"> `[a,</span><span class="id"> c]</span><span class="id"> `&lt;=`</span><span class="id"> `[a,</span><span class="id"> b]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> subset_itvl;</span><span class="id"> rewrite</span><span class="id"> bnd_simp;</span><span class="id"> move:</span><span class="id"> ac;</span><span class="id"> near:</span><span class="id"> c;</span><span class="id"> exact:</span><span class="id"> nbhs_le</span>.<br/>
<span class="id">rewrite</span><span class="id"> -lee_fin</span><span class="id"> fineK;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> integral_fune_fin_num</span><span class="id"> =&gt;</span><span class="id"> //=</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> (_<span class="id"> :</span> (<span class="gallina-kwd">fun</span><span class="id"> _</span><span class="id"> =&gt;</span><span class="id"> _</span>)<span class="id"> =</span><span class="id"> abse</span><span class="id"> \o</span> ((<span class="id">EFin</span><span class="id"> \o</span><span class="id"> f</span>)<span class="id"> \_</span><span class="id"> `[a,</span><span class="id"> b]</span>))<span class="id">;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply/funext</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> restrict_EFin</span>.<br/>
&nbsp;&nbsp;<span class="id">apply/integrable_abse/integrable_restrict</span><span class="id"> =&gt;</span><span class="id"> //=</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> setIidl//;</span><span class="id"> exact:</span><span class="id"> integrableS</span><span class="id"> intf</span>.<br/>
<span class="id">rewrite</span><span class="id"> [leRHS]integralEpatch//=</span><span class="id"> [in</span><span class="id"> leRHS]integralEpatch//=</span>.<br/>
<span class="id">under</span><span class="id"> [in</span><span class="id"> leRHS]eq_integral</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> /=</span><span class="id"> x</span><span class="id"> xac</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -patch_setI</span><span class="id"> setIid</span><span class="id"> restrict_EFin/=</span><span class="id"> restrict_normr/=</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -patch_setI</span><span class="id"> setIidl//</span>.<br/>
&nbsp;&nbsp;<span class="id">over</span>.<br/>
<span class="id">rewrite</span><span class="id"> /=</span><span class="id"> [leRHS]</span>(_<span class="id"> :</span><span class="id"> _</span><span class="id"> =</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> `[a,</span><span class="id"> c]</span>)<span class="id"> `|</span><span class="id"> f</span><span class="id"> x</span><span class="id"> |%:E</span>)<span class="id">%E;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> [RHS]integralEpatch//=;</span><span class="id"> apply:</span><span class="id"> eq_integral</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> xac/=</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> restrict_EFin/=</span><span class="id"> restrict_normr</span>.<br/>
<span class="id">rewrite</span><span class="id"> /int</span><span class="id"> /parameterized_integral</span><span class="id"> /=</span>.<br/>
<span class="id">apply:</span> (<span class="id">@le_trans</span><span class="id"> _</span><span class="id"> _</span> ((<span class="id">\int[mu]_</span>(<span class="id">t</span><span class="gallina-kwd"> in</span><span class="id"> `[a,</span><span class="id"> c]</span>)<span class="id"> `|f</span><span class="id"> t|</span>))<span class="id">%:E</span>).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> le_normr_integral</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> integrableS</span><span class="id"> intf</span>.<br/>
<span class="id">set</span><span class="id"> rhs</span><span class="id"> :</span><span class="id"> \bar</span><span class="id"> R</span><span class="id"> :=</span><span class="id"> leRHS</span>.<br/>
<span class="id">have</span><span class="id"> [-&gt;|rhsoo]</span><span class="id"> :=</span><span class="id"> eqVneq</span><span class="id"> rhs</span><span class="id"> +oo%E;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> leey</span>.<br/>
<span class="id">rewrite</span><span class="id"> /rhs</span><span class="id"> /Rintegral</span><span class="id"> -/rhs</span>.<br/>
<span class="id">rewrite</span><span class="id"> fineK//</span><span class="id"> fin_numE</span><span class="id"> rhsoo</span><span class="id"> andbT</span><span class="id"> -ltNye</span> (<span class="id">@lt_le_trans</span><span class="id"> _</span><span class="id"> _</span><span class="id"> 0%E</span>)<span class="id">//</span>.<br/>
<span class="id">exact:</span><span class="id"> integral_ge0</span>.<br/>
<span class="id">Unshelve</span>.<span class="id"> all:</span><span class="gallina-kwd"> by</span><span class="id"> end_near</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> parameterized_integral_cvg_left</span><span class="id"> a</span><span class="id"> b</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> R</span>)<span class="id"> :</span><span class="id"> a</span><span class="id"> &lt;</span><span class="id"> b</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">mu</span>.<span class="id">-integrable</span><span class="id"> `[a,</span><span class="id"> b]</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> f</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">int</span><span class="id"> a</span><span class="id"> x</span><span class="id"> f</span><span class="id"> @[x</span><span class="id"> --&gt;</span><span class="id"> a]</span><span class="id"> --&gt;</span><span class="id"> 0</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> ab</span><span class="id"> intf;</span><span class="id"> pose</span><span class="id"> fab</span><span class="id"> :=</span><span class="id"> f</span><span class="id"> \_</span><span class="id"> `[a,</span><span class="id"> b]</span>.<br/>
<span class="id">have</span><span class="id"> intfab</span><span class="id"> :</span><span class="id"> mu</span>.<span class="id">-integrable</span><span class="id"> `[a,</span><span class="id"> b]</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> fab</span>).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -restrict_EFin;</span><span class="id"> apply/integrable_restrict</span><span class="id"> =&gt;</span><span class="id"> //=;</span><span class="id"> rewrite</span><span class="id"> setIidr</span>.<br/>
<span class="id">apply/cvgrPdist_le</span><span class="id"> =&gt;</span><span class="id"> /=</span><span class="id"> e</span><span class="id"> e0;</span><span class="id"> near=&gt;</span><span class="id"> x</span>.<br/>
<span class="id">rewrite</span><span class="id"> {1}/int</span><span class="id"> /parameterized_integral</span><span class="id"> sub0r</span><span class="id"> normrN</span>.<br/>
<span class="id">have</span><span class="id"> [|xa]</span><span class="id"> :=</span><span class="id"> leP</span><span class="id"> a</span><span class="id"> x</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> ax;</span><span class="id"> apply/ltW;</span><span class="id"> move:</span><span class="id"> ax</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> near:</span><span class="id"> x;</span><span class="id"> exact:</span> (<span class="id">@parameterized_integral_near_left</span><span class="id"> _</span><span class="id"> b</span>).<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> set_itv_ge</span><span class="id"> ?Rintegral_set0</span><span class="id"> ?normr0</span><span class="id"> ?</span>(<span class="id">ltW</span><span class="id"> e0</span>)<span class="id">//</span><span class="id"> -leNgt</span><span class="id"> bnd_simp</span>.<br/>
<span class="id">Unshelve</span>.<span class="id"> all:</span><span class="gallina-kwd"> by</span><span class="id"> end_near</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> parameterized_integral_cvg_at_left</span><span class="id"> a</span><span class="id"> b</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> R</span>)<span class="id"> :</span><span class="id"> a</span><span class="id"> &lt;</span><span class="id"> b</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">mu</span>.<span class="id">-integrable</span><span class="id"> `[a,</span><span class="id"> b]</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> f</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">int</span><span class="id"> a</span><span class="id"> x</span><span class="id"> f</span><span class="id"> @[x</span><span class="id"> --&gt;</span><span class="id"> b^'-]</span><span class="id"> --&gt;</span><span class="id"> int</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> ab</span><span class="id"> intf;</span><span class="id"> pose</span><span class="id"> fab</span><span class="id"> :=</span><span class="id"> f</span><span class="id"> \_</span><span class="id"> `[a,</span><span class="id"> b]</span>.<br/>
<span class="id">have</span><span class="id"> /=</span><span class="id"> int_normr_cont</span><span class="id"> :</span><span class="gallina-kwd"> forall</span><span class="id"> e</span><span class="id"> :</span><span class="id"> R,</span><span class="id"> 0</span><span class="id"> &lt;</span><span class="id"> e</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">exists</span><span class="id"> d</span><span class="id"> :</span><span class="id"> R,</span><span class="id"> 0</span><span class="id"> &lt;</span><span class="id"> d</span><span class="id"> /\</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">forall</span><span class="id"> A,</span><span class="id"> measurable</span><span class="id"> A</span><span class="id"> -&gt;</span> (<span class="id">mu</span><span class="id"> A</span><span class="id"> &lt;</span><span class="id"> d%:E</span>)<span class="id">%E</span><span class="id"> -&gt;</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> A</span>)<span class="id"> `|fab</span><span class="id"> x|</span><span class="id"> &lt;</span><span class="id"> e</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> /=</span><span class="id"> =&gt;</span><span class="id"> e</span><span class="id"> e0;</span><span class="id"> apply:</span><span class="id"> integral_normr_continuous</span><span class="id"> =&gt;</span><span class="id"> //=</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -restrict_EFin;</span><span class="id"> apply/integrable_restrict</span><span class="id"> =&gt;</span><span class="id"> //=;</span><span class="id"> rewrite</span><span class="id"> setTI</span>.<br/>
<span class="id">have</span><span class="id"> intfab</span><span class="id"> :</span><span class="id"> mu</span>.<span class="id">-integrable</span><span class="id"> `[a,</span><span class="id"> b]</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> fab</span>).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -restrict_EFin;</span><span class="id"> apply/integrable_restrict</span><span class="id"> =&gt;</span><span class="id"> //=;</span><span class="id"> rewrite</span><span class="id"> setIidr</span>.<br/>
<span class="id">rewrite</span><span class="id"> /int</span><span class="id"> /parameterized_integral;</span><span class="id"> apply/cvgrPdist_le</span><span class="id"> =&gt;</span><span class="id"> /=</span><span class="id"> e</span><span class="id"> e0</span>.<br/>
<span class="id">have</span><span class="id"> [d</span><span class="id"> [d0</span><span class="id"> /=</span><span class="id"> {}int_normr_cont]]</span><span class="id"> :=</span><span class="id"> int_normr_cont</span><span class="id"> _</span><span class="id"> e0</span>.<br/>
<span class="id">near=&gt;</span><span class="id"> x</span>.<br/>
<span class="id">rewrite</span><span class="id"> [in</span><span class="id"> X</span><span class="gallina-kwd"> in</span><span class="id"> X</span><span class="id"> -</span><span class="id"> _]</span>(<span class="id">@itv_bndbnd_setU</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">BRight</span><span class="id"> x</span>))<span class="id">//;</span><br/>
&nbsp;&nbsp;<span class="id">[|by</span><span class="id"> rewrite</span><span class="id"> bnd_simp</span><span class="id"> ltW</span>..<span class="id">]</span>.<br/>
<span class="id">rewrite</span><span class="id"> Rintegral_setU_EFin//=;</span><span class="id"> last</span><span class="id"> 2</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -itv_bndbnd_setU//</span><span class="id"> ?bnd_simp;</span><span class="id"> last</span><span class="id"> 2</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> near:</span><span class="id"> x;</span><span class="id"> exact:</span><span class="id"> nbhs_left_ge</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exact/ltW</span>.<br/>
&nbsp;&nbsp;<span class="id">apply/disj_set2P;</span><span class="id"> rewrite</span><span class="id"> -subset0</span><span class="id"> =&gt;</span><span class="id"> z/=;</span><span class="id"> rewrite</span><span class="id"> !in_itv/=</span><span class="id"> =&gt;</span><span class="id"> -[/andP[_]]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> leNgt</span><span class="id"> =&gt;</span><span class="id"> /negbTE</span><span class="id"> -&gt;</span>.<br/>
<span class="id">have</span><span class="id"> xbab</span><span class="id"> :</span><span class="id"> `]x,</span><span class="id"> b]</span><span class="id"> `&lt;=`</span><span class="id"> `[a,</span><span class="id"> b]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> subset_itvr;</span><span class="id"> rewrite</span><span class="id"> bnd_simp;</span><span class="id"> near:</span><span class="id"> x;</span><span class="id"> exact:</span><span class="id"> nbhs_left_ge</span>.<br/>
<span class="id">rewrite</span><span class="id"> -addrAC</span><span class="id"> subrr</span><span class="id"> add0r</span> (<span class="id">le_trans</span> (<span class="id">le_normr_integral</span><span class="id"> _</span><span class="id"> _</span>))<span class="id">//</span>.<br/>
&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> integrableS</span><span class="id"> intf</span>.<br/>
<span class="id">rewrite</span><span class="id"> [leLHS]</span>(_<span class="id"> :</span><span class="id"> _</span><span class="id"> =</span> (<span class="id">\int[mu]_</span>(<span class="id">t</span><span class="gallina-kwd"> in</span><span class="id"> `]x,</span><span class="id"> b]</span>)<span class="id"> normr</span> (<span class="id">fab</span><span class="id"> t</span>)))<span class="id">//;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> eq_Rintegral</span><span class="id"> =&gt;</span><span class="id"> //=</span><span class="id"> z;</span><span class="id"> rewrite</span><span class="id"> inE/=</span><span class="id"> in_itv/=</span><span class="id"> =&gt;</span><span class="id"> /andP[xz</span><span class="id"> zb]</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> /fab</span><span class="id"> patchE</span><span class="id"> ifT//</span><span class="id"> inE/=</span><span class="id"> in_itv/=</span><span class="id"> zb</span><span class="id"> andbT</span> (<span class="id">le_trans</span><span class="id"> _</span> (<span class="id">ltW</span><span class="id"> xz</span>))<span class="id">//</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> near:</span><span class="id"> x;</span><span class="id"> exact:</span><span class="id"> nbhs_left_ge</span>.<br/>
<span class="id">apply/ltW/int_normr_cont</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
<span class="id">rewrite</span><span class="id"> lebesgue_measure_itv/=</span><span class="id"> lte_fin</span>.<br/>
<span class="id">rewrite</span><span class="id"> ifT//</span><span class="id"> -EFinD</span><span class="id"> lte_fin</span>.<br/>
<span class="id">near:</span><span class="id"> x;</span><span class="gallina-kwd"> exists</span><span class="id"> d</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> z;</span><span class="id"> rewrite</span><span class="id"> /ball_/=</span><span class="id"> =&gt;</span><span class="id"> +</span><span class="id"> zb</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> gtr0_norm//</span><span class="id"> ?subr_gt0</span>.<br/>
<span class="id">Unshelve</span>.<span class="id"> all:</span><span class="gallina-kwd"> by</span><span class="id"> end_near</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> parameterized_integral_continuous</span><span class="id"> a</span><span class="id"> b</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> R</span>)<span class="id"> :</span><span class="id"> a</span><span class="id"> &lt;</span><span class="id"> b</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">mu</span>.<span class="id">-integrable</span><span class="id"> `[a,</span><span class="id"> b]</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> f</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">{within</span><span class="id"> `[a,</span><span class="id"> b],</span><span class="id"> continuous</span> (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> int</span><span class="id"> a</span><span class="id"> x</span><span class="id"> f</span>)<span class="id">}</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> ab</span><span class="id"> intf;</span><span class="id"> apply/</span>(<span class="id">continuous_within_itvP</span><span class="id"> _</span><span class="id"> ab</span>)<span class="id">;</span><span class="id"> split;</span><span class="id"> first</span><span class="id"> last</span>.<br/>
&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> parameterized_integral_cvg_at_left</span>.<br/>
&nbsp;&nbsp;<span class="id">apply/cvg_at_right_filter</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> {2}/int</span><span class="id"> /parameterized_integral</span><span class="id"> interval_set1</span><span class="id"> Rintegral_set1</span>.<br/>
&nbsp;&nbsp;<span class="id">exact:</span> (<span class="id">parameterized_integral_cvg_left</span><span class="id"> ab</span>).<br/>
<span class="id">pose</span><span class="id"> fab</span><span class="id"> :=</span><span class="id"> f</span><span class="id"> \_</span><span class="id"> `[a,</span><span class="id"> b]</span>.<br/>
<span class="id">have</span><span class="id"> /=</span><span class="id"> int_normr_cont</span><span class="id"> :</span><span class="gallina-kwd"> forall</span><span class="id"> e</span><span class="id"> :</span><span class="id"> R,</span><span class="id"> 0</span><span class="id"> &lt;</span><span class="id"> e</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">exists</span><span class="id"> d</span><span class="id"> :</span><span class="id"> R,</span><span class="id"> 0</span><span class="id"> &lt;</span><span class="id"> d</span><span class="id"> /\</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">forall</span><span class="id"> A,</span><span class="id"> measurable</span><span class="id"> A</span><span class="id"> -&gt;</span> (<span class="id">mu</span><span class="id"> A</span><span class="id"> &lt;</span><span class="id"> d%:E</span>)<span class="id">%E</span><span class="id"> -&gt;</span><span class="id"> \int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> A</span>)<span class="id"> `|fab</span><span class="id"> x|</span><span class="id"> &lt;</span><span class="id"> e</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> /=</span><span class="id"> =&gt;</span><span class="id"> e</span><span class="id"> e0;</span><span class="id"> apply:</span><span class="id"> integral_normr_continuous</span><span class="id"> =&gt;</span><span class="id"> //=</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -restrict_EFin;</span><span class="id"> apply/integrable_restrict</span><span class="id"> =&gt;</span><span class="id"> //=;</span><span class="id"> rewrite</span><span class="id"> setTI</span>.<br/>
<span class="id">have</span><span class="id"> intfab</span><span class="id"> :</span><span class="id"> mu</span>.<span class="id">-integrable</span><span class="id"> `[a,</span><span class="id"> b]</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> fab</span>).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -restrict_EFin;</span><span class="id"> apply/integrable_restrict</span><span class="id"> =&gt;</span><span class="id"> //=;</span><span class="id"> rewrite</span><span class="id"> setIidr</span>.<br/>
<span class="id">rewrite</span><span class="id"> /int</span><span class="id"> /parameterized_integral</span><span class="id"> =&gt;</span><span class="id"> z;</span><span class="id"> rewrite</span><span class="id"> in_itv/=</span><span class="id"> =&gt;</span><span class="id"> /andP[az</span><span class="id"> zb]</span>.<br/>
<span class="id">apply/cvgrPdist_le</span><span class="id"> =&gt;</span><span class="id"> /=</span><span class="id"> e</span><span class="id"> e0</span>.<br/>
<span class="id">have</span><span class="id"> [d</span><span class="id"> [d0</span><span class="id"> /=</span><span class="id"> {}int_normr_cont]]</span><span class="id"> :=</span><span class="id"> int_normr_cont</span><span class="id"> _</span><span class="id"> e0</span>.<br/>
<span class="id">near=&gt;</span><span class="id"> x</span>.<br/>
<span class="id">have</span><span class="id"> [xz|xz|-&gt;]</span><span class="id"> :=</span><span class="id"> ltgtP</span><span class="id"> x</span><span class="id"> z;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> subrr</span><span class="id"> normr0</span><span class="id"> ltW</span>.<br/>
<span class="id">-</span><span class="id"> have</span><span class="id"> ax</span><span class="id"> :</span><span class="id"> a</span><span class="id"> &lt;</span><span class="id"> x</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">move:</span><span class="id"> xz;</span><span class="id"> near:</span><span class="id"> x</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">exists</span><span class="id"> `|z</span><span class="id"> -</span><span class="id"> a|</span><span class="id"> =&gt;</span><span class="id"> /=;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> gtr0_norm</span><span class="id"> ?subr_gt0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> y</span><span class="id"> /=</span><span class="id"> +</span><span class="id"> yz</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span><span class="id"> 2</span><span class="id"> rewrite</span><span class="id"> gtr0_norm</span><span class="id"> ?subr_gt0//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> ltrBlDr</span><span class="id"> -ltrBlDl;</span><span class="id"> apply:</span><span class="id"> le_lt_trans</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> opprB</span><span class="id"> addrCA</span><span class="id"> subrr</span><span class="id"> addr0</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> Rintegral_itvB//;</span><span class="id"> last</span><span class="id"> 3</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> integrableS</span><span class="id"> intf</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> apply:</span><span class="id"> subset_itvl;</span><span class="id"> exact:</span><span class="id"> ltW</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> bnd_simp</span><span class="id"> ltW</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> ltW</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> xzab</span><span class="id"> :</span><span class="id"> `]x,</span><span class="id"> z]</span><span class="id"> `&lt;=`</span><span class="id"> `[a,</span><span class="id"> b]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> subset_itvScc;</span><span class="id"> rewrite</span><span class="id"> bnd_simp;</span><span class="id"> exact/ltW</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span> (<span class="id">le_trans</span> (<span class="id">le_normr_integral</span><span class="id"> _</span><span class="id"> _</span>))<span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> integrableS</span><span class="id"> intf</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -</span>(<span class="id">setIidl</span><span class="id"> xzab</span>)<span class="id"> Rintegral_mkcondr/=</span>.<br/>
&nbsp;&nbsp;<span class="id">under</span><span class="id"> eq_Rintegral</span><span class="id"> do</span><span class="id"> rewrite</span><span class="id"> restrict_normr</span>.<br/>
&nbsp;&nbsp;<span class="id">apply/ltW/int_normr_cont</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> lebesgue_measure_itv/=</span><span class="id"> lte_fin</span><span class="id"> xz</span><span class="id"> -EFinD</span><span class="id"> lte_fin</span><span class="id"> ltrBlDl</span>.<br/>
&nbsp;&nbsp;<span class="id">move:</span><span class="id"> xz;</span><span class="id"> near:</span><span class="id"> x</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">exists</span> (<span class="id">d</span><span class="id"> /</span><span class="id"> 2</span>)<span class="id">;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> /=</span><span class="id"> divr_gt0</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> x/=</span><span class="id"> /[swap]</span><span class="id"> xz</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> gtr0_norm</span><span class="id"> ?subr_gt0//</span><span class="id"> ltrBlDl</span><span class="id"> =&gt;</span><span class="id"> /lt_le_trans;</span><span class="id"> apply</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> lerD2l</span><span class="id"> ler_pdivrMr//</span><span class="id"> ler_pMr//</span><span class="id"> ler1n</span>.<br/>
<span class="id">+</span><span class="id"> have</span><span class="id"> ax</span><span class="id"> :</span><span class="id"> a</span><span class="id"> &lt;</span><span class="id"> x</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span> (<span class="id">lt_trans</span><span class="id"> az</span>).<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> xb</span><span class="id"> :</span><span class="id"> x</span><span class="id"> &lt;</span><span class="id"> b</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">move:</span><span class="id"> xz;</span><span class="id"> near:</span><span class="id"> x</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">exists</span><span class="id"> `|b</span><span class="id"> -</span><span class="id"> z|;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> /=</span><span class="id"> gtr0_norm</span><span class="id"> ?subr_gt0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> y</span><span class="id"> /=</span><span class="id"> +</span><span class="id"> yz</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> ltr0_norm</span><span class="id"> ?subr_lt0//</span><span class="id"> gtr0_norm</span><span class="id"> ?subr_gt0//</span><span class="id"> opprB</span><span class="id"> ltrBlDr</span><span class="id"> subrK</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -opprB</span><span class="id"> normrN</span><span class="id"> Rintegral_itvB</span><span class="id"> ?bnd_simp;</span><span class="id"> [|</span><span class="id"> |exact/ltW</span>..<span class="id">];</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> integrableS</span><span class="id"> intf</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> apply:</span><span class="id"> subset_itvl;</span><span class="id"> exact:</span><span class="id"> ltW</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> zxab</span><span class="id"> :</span><span class="id"> `[z,</span><span class="id"> x]</span><span class="id"> `&lt;=`</span><span class="id"> `[a,</span><span class="id"> b]</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> subset_itvScc;</span><span class="id"> exact/ltW</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> intzxf</span><span class="id"> :</span><span class="id"> mu</span>.<span class="id">-integrable</span><span class="id"> `[z,</span><span class="id"> x]</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> f</span>)<span class="gallina-kwd"> by</span><span class="id"> exact:</span><span class="id"> integrableS</span><span class="id"> intf</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> Rintegral_itv_obnd_cbnd//;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span> (<span class="id">@integrableS</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> mu</span><span class="id"> `[z,</span><span class="id"> x]</span>)<span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> subset_itv_oc_cc</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span> (<span class="id">le_trans</span> (<span class="id">le_normr_integral</span><span class="id"> _</span><span class="id"> _</span>))<span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -</span>(<span class="id">setIidl</span><span class="id"> zxab</span>)<span class="id"> Rintegral_mkcondr/=</span>.<br/>
&nbsp;&nbsp;<span class="id">under</span><span class="id"> eq_Rintegral</span><span class="id"> do</span><span class="id"> rewrite</span><span class="id"> restrict_normr</span>.<br/>
&nbsp;&nbsp;<span class="id">apply/ltW/int_normr_cont</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> lebesgue_measure_itv/=</span><span class="id"> lte_fin</span><span class="id"> xz</span><span class="id"> -EFinD</span><span class="id"> lte_fin</span><span class="id"> ltrBlDl</span>.<br/>
&nbsp;&nbsp;<span class="id">move:</span><span class="id"> xz;</span><span class="id"> near:</span><span class="id"> x</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">exists</span> (<span class="id">d</span><span class="id"> /</span><span class="id"> 2</span>)<span class="id">;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> /=</span><span class="id"> divr_gt0</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> x/=</span><span class="id"> /[swap]</span><span class="id"> xz</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> ltr0_norm</span><span class="id"> ?subr_lt0//</span><span class="id"> opprB</span><span class="id"> ltrBlDl</span><span class="id"> =&gt;</span><span class="id"> /lt_le_trans;</span><span class="id"> apply</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> lerD2l</span><span class="id"> ler_pdivrMr//</span><span class="id"> ler_pMr//</span><span class="id"> ler1n</span>.<br/>
<span class="id">Unshelve</span>.<span class="id"> all:</span><span class="gallina-kwd"> by</span><span class="id"> end_near</span>. Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> parameterized_integral_continuous</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> corollary_FTC1</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {R</span><span class="id"> :</span><span class="id"> realType}</span>.<br/>
<span class="vernacular">Notation</span><span class="id"> mu</span><span class="id"> :=</span><span class="id"> lebesgue_measure</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<span class="vernacular">Implicit</span><span class="id"> Types</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> R</span>) (<span class="id">a</span><span class="id"> b</span><span class="id"> :</span><span class="id"> R</span>).<br/>
<br/>
<span class="vernacular">Let</span><span class="id"> within_continuous_restrict</span><span class="id"> f</span><span class="id"> a</span><span class="id"> b</span><span class="id"> :</span> (<span class="id">a</span><span class="id"> &lt;</span><span class="id"> b</span>)<span class="id">%R</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">{within</span><span class="id"> `[a,</span><span class="id"> b],</span><span class="id"> continuous</span><span class="id"> f}</span><span class="id"> -&gt;</span><span class="id"> {in</span><span class="id"> `]a,</span><span class="id"> b[,</span><span class="id"> continuous</span> (<span class="id">f</span><span class="id"> \_</span><span class="id"> `[a,</span><span class="id"> b]</span>)<span class="id">}</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> ab</span><span class="id"> +</span><span class="id"> x</span><span class="id"> xab;</span><span class="id"> move=&gt;</span><span class="id"> /</span>(_<span class="id"> x</span>).<br/>
<span class="id">rewrite</span><span class="id"> {1}/continuous_at</span><span class="id"> =&gt;</span><span class="id"> xf</span>.<br/>
<span class="id">rewrite</span><span class="id"> /prop_for</span><span class="id"> /continuous_at</span> <span class="id"> patchE</span>.<br/>
<span class="id">rewrite</span><span class="id"> mem_set</span><span class="id"> ?mulr1</span><span class="id"> /=;</span><span class="id"> last</span><span class="id"> exact:</span><span class="id"> subset_itv_oo_cc</span>.<br/>
<span class="id">exact:</span><span class="id"> cvg_patch</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Corollary</span><span class="id"> continuous_FTC2</span><span class="id"> f</span><span class="id"> F</span><span class="id"> a</span><span class="id"> b</span><span class="id"> :</span> (<span class="id">a</span><span class="id"> &lt;</span><span class="id"> b</span>)<span class="id">%R</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">{within</span><span class="id"> `[a,</span><span class="id"> b],</span><span class="id"> continuous</span><span class="id"> f}</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">derivable_oo_continuous_bnd</span><span class="id"> F</span><span class="id"> a</span><span class="id"> b</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">{in</span><span class="id"> `]a,</span><span class="id"> b[,</span><span class="id"> F^`</span>()<span class="id"> =1</span><span class="id"> f}</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;(<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> `[a,</span><span class="id"> b]</span>) (<span class="id">f</span><span class="id"> x</span>)<span class="id">%:E</span><span class="id"> =</span> (<span class="id">F</span><span class="id"> b</span>)<span class="id">%:E</span><span class="id"> -</span> (<span class="id">F</span><span class="id"> a</span>)<span class="id">%:E</span>)<span class="id">%E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> ab</span><span class="id"> cf</span><span class="id"> dF</span><span class="id"> F'f</span>.<br/>
<span class="id">pose</span><span class="id"> fab</span><span class="id"> :=</span><span class="id"> f</span><span class="id"> \_</span><span class="id"> `[a,</span><span class="id"> b]</span>.<br/>
<span class="id">pose</span><span class="id"> G</span><span class="id"> x</span><span class="id"> :=</span> (<span class="id">\int[mu]_</span>(<span class="id">t</span><span class="gallina-kwd"> in</span><span class="id"> `[a,</span><span class="id"> x]</span>)<span class="id"> fab</span><span class="id"> t</span>)<span class="id">%R</span>.<br/>
<span class="id">have</span><span class="id"> iabf</span><span class="id"> :</span><span class="id"> mu</span>.<span class="id">-integrable</span><span class="id"> `[a,</span><span class="id"> b]</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> f</span>).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> continuous_compact_integrable</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> segment_compact</span>.<br/>
<span class="id">have</span><span class="id"> G'f</span><span class="id"> :</span><span class="id"> {in</span><span class="id"> `]a,</span><span class="id"> b[,</span><span class="gallina-kwd"> forall</span><span class="id"> x,</span><span class="id"> G^`</span>()<span class="id"> x</span><span class="id"> =</span><span class="id"> fab</span><span class="id"> x</span><span class="id"> /\</span><span class="id"> derivable</span><span class="id"> G</span><span class="id"> x</span><span class="id"> 1}</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> x</span><span class="id"> /[!in_itv]/=</span><span class="id"> /andP[ax</span><span class="id"> xb]</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> ifab</span><span class="id"> :</span><span class="id"> mu</span>.<span class="id">-integrable</span><span class="id"> `[a,</span><span class="id"> b]</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> fab</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -restrict_EFin;</span><span class="id"> apply/integrable_restrict</span><span class="id"> =&gt;</span><span class="id"> //=;</span><span class="id"> rewrite</span><span class="id"> setIid</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> cfab</span><span class="id"> :</span><span class="id"> {for</span><span class="id"> x,</span><span class="id"> continuous</span><span class="id"> fab}</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> within_continuous_restrict</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> rewrite</span><span class="id"> in_itv/=</span><span class="id"> ax</span><span class="id"> xb</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> have</span><span class="id"> []</span><span class="id"> :=</span><span class="id"> continuous_FTC1_closed</span><span class="id"> xb</span><span class="id"> ifab</span><span class="id"> ax</span><span class="id"> cfab</span>.<br/>
<span class="id">have</span><span class="id"> F'G'0</span><span class="id"> :</span><span class="id"> {in</span><span class="id"> `]a,</span><span class="id"> b[,</span> (<span class="id">F^`</span>()<span class="id"> -</span><span class="id"> G^`</span>()<span class="id"> =1</span><span class="id"> cst</span><span class="id"> 0</span>)<span class="id">%R}</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> x</span><span class="id"> xab;</span><span class="id"> rewrite</span><span class="id"> !fctE</span> (<span class="id">G'f</span><span class="id"> x</span><span class="id"> xab</span>).<span class="id">1</span><span class="id"> /fab</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> patchE</span><span class="id"> mem_set/=</span><span class="id"> ?F'f</span><span class="id"> ?subrr//;</span><span class="id"> exact:</span><span class="id"> subset_itv_oo_cc</span>.<br/>
<span class="id">have</span><span class="id"> [k</span><span class="id"> FGk]</span><span class="id"> :</span><span class="gallina-kwd"> exists</span><span class="id"> k</span><span class="id"> :</span><span class="id"> R,</span><span class="id"> {in</span><span class="id"> `]a,</span><span class="id"> b[,</span> (<span class="id">F</span><span class="id"> -</span><span class="id"> G</span><span class="id"> =1</span><span class="id"> cst</span><span class="id"> k</span>)<span class="id">%R}</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> :</span><span class="id"> {in</span><span class="id"> `]a,</span><span class="id"> b[</span><span class="id"> &amp;,</span><span class="gallina-kwd"> forall</span><span class="id"> x</span><span class="id"> y,</span> (<span class="id">F</span><span class="id"> x</span><span class="id"> -</span><span class="id"> G</span><span class="id"> x</span><span class="id"> =</span><span class="id"> F</span><span class="id"> y</span><span class="id"> -</span><span class="id"> G</span><span class="id"> y</span>)<span class="id">%R}</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> x</span><span class="id"> y</span><span class="id"> xab</span><span class="id"> yab</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">wlog</span><span class="id"> xLy</span><span class="id"> :</span><span class="id"> x</span><span class="id"> y</span><span class="id"> xab</span><span class="id"> yab</span><span class="id"> /</span> (<span class="id">x</span><span class="id"> &lt;=</span><span class="id"> y</span>)<span class="id">%R</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> abFG;</span><span class="id"> have</span><span class="id"> [|/ltW]</span><span class="id"> :=</span><span class="id"> leP</span><span class="id"> x</span><span class="id"> y;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> abFG</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move/abFG</span><span class="id"> =&gt;</span><span class="id"> /</span>(_<span class="id"> yab</span><span class="id"> xab</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">move:</span><span class="id"> xLy;</span><span class="id"> rewrite</span><span class="id"> le_eqVlt</span><span class="id"> =&gt;</span><span class="id"> /predU1P[-&gt;//|xy]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">have</span><span class="id"> [|</span><span class="id"> |]</span><span class="id"> :=</span><span class="id"> @MVT</span><span class="id"> _</span> (<span class="id">F</span><span class="id"> \-</span><span class="id"> G</span>)<span class="id">%R</span> (<span class="id">F^`</span>()<span class="id"> -</span><span class="id"> G^`</span>())<span class="id">%R</span><span class="id"> x</span><span class="id"> y</span><span class="id"> xy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="id"> move=&gt;</span><span class="id"> z</span><span class="id"> zxy;</span><span class="id"> have</span><span class="id"> zab</span><span class="id"> :</span><span class="id"> z</span><span class="id"> \in</span><span class="id"> `]a,</span><span class="id"> b[</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">move:</span><span class="id"> z</span><span class="id"> zxy;</span><span class="id"> apply:</span><span class="id"> subset_itvW</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> move:</span><span class="id"> xab;</span><span class="id"> rewrite</span><span class="id"> in_itv/=</span><span class="id"> =&gt;</span><span class="id"> /andP[/ltW]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> move:</span><span class="id"> yab;</span><span class="id"> rewrite</span><span class="id"> in_itv/=</span><span class="id"> =&gt;</span><span class="id"> /andP[_</span><span class="id"> /ltW]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">have</span><span class="id"> Fz1</span><span class="id"> :</span><span class="id"> derivable</span><span class="id"> F</span><span class="id"> z</span><span class="id"> 1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> case:</span><span class="id"> dF</span><span class="id"> =&gt;</span><span class="id"> /=</span><span class="id"> +</span><span class="id"> _</span><span class="id"> _;</span><span class="id"> apply;</span><span class="id"> rewrite</span><span class="id"> inE</span><span class="gallina-kwd"> in</span><span class="id"> zab</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">have</span><span class="id"> Gz1</span><span class="id"> :</span><span class="id"> derivable</span><span class="id"> G</span><span class="id"> z</span><span class="id"> 1</span><span class="gallina-kwd"> by</span><span class="id"> have</span><span class="id"> [|]</span><span class="id"> :=</span><span class="id"> G'f</span><span class="id"> z</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> DeriveDef</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> derivableB;</span><span class="id"> [exact:</span><span class="id"> Fz1|exact:</span><span class="id"> Gz1]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> deriveB</span><span class="id"> -?derive1E;</span><span class="id"> [by</span><span class="id"> []|exact:</span><span class="id"> Fz1|exact:</span><span class="id"> Gz1]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="id"> apply:</span><span class="id"> derivable_within_continuous</span><span class="id"> =&gt;</span><span class="id"> z</span><span class="id"> zxy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> derivableB</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">+</span><span class="id"> case:</span><span class="id"> dF</span><span class="id"> =&gt;</span><span class="id"> /=</span><span class="id"> +</span><span class="id"> _</span><span class="id"> _;</span><span class="id"> apply</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> subset_itvSoo</span><span class="id"> zxy</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move:</span><span class="id"> xab;</span><span class="id"> rewrite</span><span class="id"> in_itv/=</span><span class="id"> =&gt;</span><span class="id"> /andP[]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move:</span><span class="id"> yab;</span><span class="id"> rewrite</span><span class="id"> in_itv/=</span><span class="id"> =&gt;</span><span class="id"> /andP[]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">+</span><span class="id"> apply:</span> (<span class="id">G'f</span><span class="id"> _</span><span class="id"> _</span>).<span class="id">2;</span><span class="id"> apply:</span><span class="id"> subset_itvSoo</span><span class="id"> zxy</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move:</span><span class="id"> xab;</span><span class="id"> rewrite</span><span class="id"> in_itv/=</span><span class="id"> =&gt;</span><span class="id"> /andP[]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move:</span><span class="id"> yab;</span><span class="id"> rewrite</span><span class="id"> in_itv/=</span><span class="id"> =&gt;</span><span class="id"> /andP[]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="id"> move=&gt;</span><span class="id"> z</span><span class="id"> zxy;</span><span class="id"> rewrite</span><span class="id"> F'G'0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /cst/=</span><span class="id"> mul0r</span><span class="id"> =&gt;</span><span class="id"> /eqP;</span><span class="id"> rewrite</span><span class="id"> subr_eq0</span><span class="id"> =&gt;</span><span class="id"> /eqP</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> subset_itvSoo</span><span class="id"> zxy</span><span class="id"> =&gt;</span><span class="id"> //=;</span><span class="id"> rewrite</span><span class="id"> bnd_simp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">*</span><span class="gallina-kwd"> by</span><span class="id"> move:</span><span class="id"> xab;</span><span class="id"> rewrite</span><span class="id"> in_itv/=</span><span class="id"> =&gt;</span><span class="id"> /andP[/ltW]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">*</span><span class="gallina-kwd"> by</span><span class="id"> move:</span><span class="id"> yab;</span><span class="id"> rewrite</span><span class="id"> in_itv/=</span><span class="id"> =&gt;</span><span class="id"> /andP[_</span><span class="id"> /ltW]</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> H;</span><span class="id"> pose</span><span class="id"> c</span><span class="id"> :=</span> (<span class="id">a</span><span class="id"> +</span><span class="id"> b</span>)<span class="id"> /</span><span class="id"> 2</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">exists</span> (<span class="id">F</span><span class="id"> c</span><span class="id"> -</span><span class="id"> G</span><span class="id"> c</span>)<span class="id">%R</span><span class="id"> =&gt;</span><span class="id"> u</span><span class="id"> /</span>(<span class="id">H</span><span class="id"> u</span><span class="id"> c</span>)<span class="id">;</span><span class="id"> apply</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> in_itv/=</span><span class="id"> midf_lt//=</span><span class="id"> midf_lt</span>.<br/>
<span class="id">have</span><span class="id"> [c</span><span class="id"> GFc]</span><span class="id"> :</span><span class="gallina-kwd"> exists</span><span class="id"> c</span><span class="id"> :</span><span class="id"> R,</span><span class="gallina-kwd"> forall</span><span class="id"> x,</span><span class="id"> x</span><span class="id"> \in</span><span class="id"> `]a,</span><span class="id"> b[</span><span class="id"> -&gt;</span> (<span class="id">F</span><span class="id"> x</span><span class="id"> -</span><span class="id"> G</span><span class="id"> x</span>)<span class="id">%R</span><span class="id"> =</span><span class="id"> c</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="gallina-kwd"> exists</span><span class="id"> k</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> xab;</span><span class="id"> rewrite</span><span class="id"> -[k]/</span>(<span class="id">cst</span><span class="id"> k</span><span class="id"> x</span>)<span class="id"> -</span>(<span class="id">FGk</span><span class="id"> x</span><span class="id"> xab</span>).<br/>
<span class="id">case:</span> (<span class="id">dF</span>)<span class="id"> =&gt;</span><span class="id"> _</span><span class="id"> Fa</span><span class="id"> Fb</span>.<br/>
<span class="id">have</span><span class="id"> GacFa</span><span class="id"> :</span><span class="id"> G</span><span class="id"> x</span><span class="id"> @[x</span><span class="id"> --&gt;</span><span class="id"> a^'+]</span><span class="id"> --&gt;</span> (<span class="id">-</span><span class="id"> c</span><span class="id"> +</span><span class="id"> F</span><span class="id"> a</span>)<span class="id">%R</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> Fap</span><span class="id"> :</span><span class="id"> Filter</span><span class="id"> a^'+</span><span class="gallina-kwd"> by</span><span class="id"> exact:</span><span class="id"> at_right_proper_filter</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> GFac</span><span class="id"> :</span> (<span class="id">G</span><span class="id"> x</span><span class="id"> -</span><span class="id"> F</span><span class="id"> x</span>)<span class="id">%R</span><span class="id"> @[x</span><span class="id"> --&gt;</span><span class="id"> a^'+]</span><span class="id"> --&gt;</span> (<span class="id">-</span><span class="id"> c</span>)<span class="id">%R</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply/cvgrPdist_le</span><span class="id"> =&gt;</span><span class="id"> /=</span><span class="id"> e</span><span class="id"> e0;</span><span class="id"> near=&gt;</span><span class="id"> t</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> opprB</span><span class="id"> GFc;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> in_itv/=;</span><span class="id"> apply/andP</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> addrC</span><span class="id"> subrr</span><span class="id"> normr0</span><span class="id"> ltW</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> :=</span><span class="id"> @cvgD</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> Fap</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> GFac</span><span class="id"> Fa</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> (_<span class="id"> :</span> (<span class="id">G</span><span class="id"> \-</span><span class="id"> F</span>)<span class="id">%R</span><span class="id"> +</span><span class="id"> F</span><span class="id"> =</span><span class="id"> G</span>)<span class="id">//</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply/funext</span><span class="id"> =&gt;</span><span class="id"> x/=;</span><span class="id"> rewrite</span><span class="id"> subrK</span>.<br/>
<span class="id">have</span><span class="id"> GbcFb</span><span class="id"> :</span><span class="id"> G</span><span class="id"> x</span><span class="id"> @[x</span><span class="id"> --&gt;</span><span class="id"> b^'-]</span><span class="id"> --&gt;</span> (<span class="id">-</span><span class="id"> c</span><span class="id"> +</span><span class="id"> F</span><span class="id"> b</span>)<span class="id">%R</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> Fbn</span><span class="id"> :</span><span class="id"> Filter</span><span class="id"> b^'-</span><span class="gallina-kwd"> by</span><span class="id"> exact:</span><span class="id"> at_left_proper_filter</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> GFbc</span><span class="id"> :</span> (<span class="id">G</span><span class="id"> x</span><span class="id"> -</span><span class="id"> F</span><span class="id"> x</span>)<span class="id">%R</span><span class="id"> @[x</span><span class="id"> --&gt;</span><span class="id"> b^'-]</span><span class="id"> --&gt;</span> (<span class="id">-</span><span class="id"> c</span>)<span class="id">%R</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply/cvgrPdist_le</span><span class="id"> =&gt;</span><span class="id"> /=</span><span class="id"> e</span><span class="id"> e0;</span><span class="id"> near=&gt;</span><span class="id"> t</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> opprB</span><span class="id"> GFc;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> in_itv/=;</span><span class="id"> apply/andP</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> addrC</span><span class="id"> subrr</span><span class="id"> normr0</span><span class="id"> ltW</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> :=</span><span class="id"> @cvgD</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> Fbn</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> GFbc</span><span class="id"> Fb</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> (_<span class="id"> :</span> (<span class="id">G</span><span class="id"> \-</span><span class="id"> F</span>)<span class="id">%R</span><span class="id"> +</span><span class="id"> F</span><span class="id"> =</span><span class="id"> G</span>)<span class="id">//</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply/funext</span><span class="id"> =&gt;</span><span class="id"> x/=;</span><span class="id"> rewrite</span><span class="id"> subrK</span>.<br/>
<span class="id">have</span><span class="id"> contF</span><span class="id"> :</span><span class="id"> {within</span><span class="id"> `[a,</span><span class="id"> b],</span><span class="id"> continuous</span><span class="id"> F}</span>.<br/>
&nbsp;&nbsp;<span class="id">apply/</span>(<span class="id">continuous_within_itvP</span><span class="id"> _</span><span class="id"> ab</span>)<span class="id">;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> z</span><span class="id"> zab;</span><span class="id"> apply/differentiable_continuous/derivable1_diffP</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> case:</span><span class="id"> dF</span><span class="id"> =&gt;</span><span class="id"> /=</span><span class="id"> +</span><span class="id"> _</span><span class="id"> _;</span><span class="id"> exact</span>.<br/>
<span class="id">have</span><span class="id"> iabfab</span><span class="id"> :</span><span class="id"> mu</span>.<span class="id">-integrable</span><span class="id"> `[a,</span><span class="id"> b]</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> fab</span>).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -restrict_EFin;</span><span class="id"> apply/integrable_restrict</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> rewrite</span><span class="id"> setIidr</span>.<br/>
<span class="id">have</span><span class="id"> Ga</span><span class="id"> :</span><span class="id"> G</span><span class="id"> x</span><span class="id"> @[x</span><span class="id"> --&gt;</span><span class="id"> a^'+]</span><span class="id"> --&gt;</span><span class="id"> G</span><span class="id"> a</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="id">have</span><span class="id"> :=</span><span class="id"> parameterized_integral_cvg_left</span><span class="id"> ab</span><span class="id"> iabfab</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> (_<span class="id"> :</span><span class="id"> 0</span><span class="id"> =</span><span class="id"> G</span><span class="id"> a</span>)<span class="id">%R</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> /left_right_continuousP[]</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /G</span><span class="id"> interval_set1</span><span class="id"> Rintegral_set1</span>.<br/>
<span class="id">have</span><span class="id"> Gb</span><span class="id"> :</span><span class="id"> G</span><span class="id"> x</span><span class="id"> @[x</span><span class="id"> --&gt;</span><span class="id"> b^'-]</span><span class="id"> --&gt;</span><span class="id"> G</span><span class="id"> b</span>.<br/>
&nbsp;&nbsp;<span class="id">exact:</span> (<span class="id">parameterized_integral_cvg_at_left</span><span class="id"> ab</span><span class="id"> iabfab</span>).<br/>
<span class="id">have</span><span class="id"> Ga0</span><span class="id"> :</span><span class="id"> G</span><span class="id"> a</span><span class="id"> =</span><span class="id"> 0%R</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> /G</span><span class="id"> interval_set1//</span><span class="id"> Rintegral_set1</span>.<br/>
<span class="id">have</span><span class="id"> cE</span><span class="id"> :</span><span class="id"> c</span><span class="id"> =</span><span class="id"> F</span><span class="id"> a</span>.<br/>
&nbsp;&nbsp;<span class="id">apply/eqP;</span><span class="id"> rewrite</span><span class="id"> -</span>(<span class="id">opprK</span><span class="id"> c</span>)<span class="id"> eq_sym</span><span class="id"> -addr_eq0</span><span class="id"> addrC</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> have</span><span class="id"> :=</span><span class="id"> cvg_unique</span><span class="id"> _</span><span class="id"> GacFa</span><span class="id"> Ga;</span><span class="id"> rewrite</span><span class="id"> Ga0</span><span class="id"> =&gt;</span><span class="id"> -&gt;</span>.<br/>
<span class="id">have</span><span class="id"> GbFbc</span><span class="id"> :</span><span class="id"> G</span><span class="id"> b</span><span class="id"> =</span> (<span class="id">F</span><span class="id"> b</span><span class="id"> -</span><span class="id"> c</span>)<span class="id">%R</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> have</span><span class="id"> :=</span><span class="id"> cvg_unique</span><span class="id"> _</span><span class="id"> GbcFb</span><span class="id"> Gb;</span><span class="id"> rewrite</span><span class="id"> addrC</span><span class="id"> =&gt;</span><span class="id"> -&gt;</span>.<br/>
<span class="id">rewrite</span><span class="id"> -EFinB</span><span class="id"> -cE</span><span class="id"> -GbFbc</span><span class="id"> /G</span><span class="id"> /Rintegral/=</span><span class="id"> fineK//</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> integralEpatch//=</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> under</span><span class="id"> eq_integral</span><span class="id"> do</span><span class="id"> rewrite</span><span class="id"> restrict_EFin</span>.<br/>
<span class="id">exact:</span><span class="id"> integral_fune_fin_num</span>.<br/>
<span class="id">Unshelve</span>.<span class="id"> all:</span><span class="gallina-kwd"> by</span><span class="id"> end_near</span>. Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> corollary_FTC1</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> integration_by_parts</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {R</span><span class="id"> :</span><span class="id"> realType}</span>.<br/>
<span class="vernacular">Notation</span><span class="id"> mu</span><span class="id"> :=</span><span class="id"> lebesgue_measure</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<span class="vernacular">Implicit</span><span class="id"> Types</span> (<span class="id">F</span><span class="id"> G</span><span class="id"> f</span><span class="id"> g</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> R</span>) (<span class="id">a</span><span class="id"> b</span><span class="id"> :</span><span class="id"> R</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> integration_by_parts</span><span class="id"> F</span><span class="id"> G</span><span class="id"> f</span><span class="id"> g</span><span class="id"> a</span><span class="id"> b</span><span class="id"> :</span> (<span class="id">a</span><span class="id"> &lt;</span><span class="id"> b</span>)<span class="id">%R</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">{within</span><span class="id"> `[a,</span><span class="id"> b],</span><span class="id"> continuous</span><span class="id"> f}</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">derivable_oo_continuous_bnd</span><span class="id"> F</span><span class="id"> a</span><span class="id"> b</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">{in</span><span class="id"> `]a,</span><span class="id"> b[,</span><span class="id"> F^`</span>()<span class="id"> =1</span><span class="id"> f}</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">{within</span><span class="id"> `[a,</span><span class="id"> b],</span><span class="id"> continuous</span><span class="id"> g}</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">derivable_oo_continuous_bnd</span><span class="id"> G</span><span class="id"> a</span><span class="id"> b</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">{in</span><span class="id"> `]a,</span><span class="id"> b[,</span><span class="id"> G^`</span>()<span class="id"> =1</span><span class="id"> g}</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> `[a,</span><span class="id"> b]</span>) (<span class="id">F</span><span class="id"> x</span><span class="id"> *</span><span class="id"> g</span><span class="id"> x</span>)<span class="id">%:E</span><span class="id"> =</span> (<span class="id">F</span><span class="id"> b</span><span class="id"> *</span><span class="id"> G</span><span class="id"> b</span><span class="id"> -</span><span class="id"> F</span><span class="id"> a</span><span class="id"> *</span><span class="id"> G</span><span class="id"> a</span>)<span class="id">%:E</span><span class="id"> -</span><br/>
&nbsp;&nbsp;<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> `[a,</span><span class="id"> b]</span>) (<span class="id">f</span><span class="id"> x</span><span class="id"> *</span><span class="id"> G</span><span class="id"> x</span>)<span class="id">%:E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> ab</span><span class="id"> cf</span><span class="id"> Fab</span><span class="id"> Ff</span><span class="id"> cg</span><span class="id"> Gab</span><span class="id"> Gg</span>.<br/>
<span class="id">have</span><span class="id"> cfg</span><span class="id"> :</span><span class="id"> {within</span><span class="id"> `[a,</span><span class="id"> b],</span><span class="id"> continuous</span> (<span class="id">f</span><span class="id"> *</span><span class="id"> G</span><span class="id"> +</span><span class="id"> F</span><span class="id"> *</span><span class="id"> g</span>)<span class="id">%R}</span>.<br/>
&nbsp;&nbsp;<span class="id">apply/subspace_continuousP</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> abx;</span><span class="id"> apply:</span><span class="id"> cvgD</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> apply:</span><span class="id"> cvgM</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> move/subspace_continuousP</span><span class="id"> :</span><span class="id"> cf;</span><span class="id"> exact</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">+</span><span class="id"> have</span><span class="id"> :=</span><span class="id"> derivable_oo_continuous_bnd_within</span><span class="id"> Gab</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move/subspace_continuousP;</span><span class="id"> exact</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> apply:</span><span class="id"> cvgM</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">+</span><span class="id"> have</span><span class="id"> :=</span><span class="id"> derivable_oo_continuous_bnd_within</span><span class="id"> Fab</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move/subspace_continuousP;</span><span class="id"> exact</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> move/subspace_continuousP</span><span class="id"> :</span><span class="id"> cg;</span><span class="id"> exact</span>.<br/>
<span class="id">have</span><span class="id"> FGab</span><span class="id"> :</span><span class="id"> derivable_oo_continuous_bnd</span> (<span class="id">F</span><span class="id"> *</span><span class="id"> G</span>)<span class="id">%R</span><span class="id"> a</span><span class="id"> b</span>.<br/>
&nbsp;&nbsp;<span class="id">move:</span><span class="id"> Fab</span><span class="id"> Gab</span><span class="id"> =&gt;</span><span class="id"> /=</span><span class="id"> [abF</span><span class="id"> FFa</span><span class="id"> FFb]</span><span class="id"> [abG</span><span class="id"> GGa</span><span class="id"> GGb];split;</span><span class="id"> [|exact:cvgM</span>..<span class="id">]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> z</span><span class="id"> zab;</span><span class="id"> apply:</span><span class="id"> derivableM;</span><span class="id"> [exact:</span><span class="id"> abF|exact:</span><span class="id"> abG]</span>.<br/>
<span class="id">have</span><span class="id"> FGfg</span><span class="id"> :</span><span class="id"> {in</span><span class="id"> `]a,</span><span class="id"> b[,</span> (<span class="id">F</span><span class="id"> *</span><span class="id"> G</span>)<span class="id">^`</span>()<span class="id"> =1</span><span class="id"> f</span><span class="id"> *</span><span class="id"> G</span><span class="id"> +</span><span class="id"> F</span><span class="id"> *</span><span class="id"> g}%R</span>.<br/>
&nbsp;&nbsp;<span class="id">move:</span><span class="id"> Fab</span><span class="id"> Gab</span><span class="id"> =&gt;</span><span class="id"> /=</span><span class="id"> [abF</span><span class="id"> FFa</span><span class="id"> FFb]</span><span class="id"> [abG</span><span class="id"> GGa</span><span class="id"> GGb]</span><span class="id"> z</span><span class="id"> zba</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> derive1E</span><span class="id"> deriveM;</span><span class="id"> [|exact:</span><span class="id"> abF|exact:</span><span class="id"> abG]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -derive1E</span><span class="id"> Gg//</span><span class="id"> -derive1E</span><span class="id"> Ff//</span><span class="id"> addrC</span> (<span class="id">mulrC</span><span class="id"> f</span>).<br/>
<span class="id">have</span><span class="id"> :=</span><span class="id"> continuous_FTC2</span><span class="id"> ab</span><span class="id"> cfg</span><span class="id"> FGab</span><span class="id"> FGfg;</span><span class="id"> rewrite</span><span class="id"> -EFinB</span><span class="id"> =&gt;</span><span class="id"> &lt;-</span>.<br/>
<span class="id">under</span><span class="id"> [X</span><span class="gallina-kwd"> in</span><span class="id"> _</span><span class="id"> =</span><span class="id"> X</span><span class="id"> -</span><span class="id"> _]eq_integral</span><span class="id"> do</span><span class="id"> rewrite</span><span class="id"> EFinD</span>.<br/>
<span class="id">have</span><span class="id"> ?</span><span class="id"> :</span><span class="id"> mu</span>.<span class="id">-integrable</span><span class="id"> `[a,</span><span class="id"> b]</span> (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> =&gt;</span> ((<span class="id">f</span><span class="id"> *</span><span class="id"> G</span>)<span class="id"> x</span>)<span class="id">%:E</span>).<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> continuous_compact_integrable</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> segment_compact</span>.<br/>
&nbsp;&nbsp;<span class="id">apply/subspace_continuousP</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> abx;</span><span class="id"> apply:</span><span class="id"> cvgM</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> move/subspace_continuousP</span><span class="id"> :</span><span class="id"> cf;</span><span class="id"> exact</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="id"> have</span><span class="id"> :=</span><span class="id"> derivable_oo_continuous_bnd_within</span><span class="id"> Gab</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move/subspace_continuousP;</span><span class="id"> exact</span>.<br/>
<span class="id">rewrite</span><span class="id"> /=</span><span class="id"> integralD//=</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> addeAC</span><span class="id"> subee</span><span class="id"> ?add0e//</span><span class="id"> integral_fune_fin_num</span>.<br/>
<span class="id">-</span><span class="id"> apply:</span><span class="id"> continuous_compact_integrable</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> segment_compact</span>.<br/>
&nbsp;&nbsp;<span class="id">apply/subspace_continuousP</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> abx;apply:</span><span class="id"> cvgM</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="id"> have</span><span class="id"> :=</span><span class="id"> derivable_oo_continuous_bnd_within</span><span class="id"> Fab</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move/subspace_continuousP;</span><span class="id"> exact</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> move/subspace_continuousP</span><span class="id"> :</span><span class="id"> cg;</span><span class="id"> exact</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> integration_by_parts</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> Rintegration_by_parts</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {R</span><span class="id"> :</span><span class="id"> realType}</span>.<br/>
<span class="vernacular">Notation</span><span class="id"> mu</span><span class="id"> :=</span><span class="id"> lebesgue_measure</span>.<br/>
<span class="vernacular">Implicit</span><span class="id"> Types</span> (<span class="id">F</span><span class="id"> G</span><span class="id"> f</span><span class="id"> g</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> R</span>) (<span class="id">a</span><span class="id"> b</span><span class="id"> :</span><span class="id"> R</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> Rintegration_by_parts</span><span class="id"> F</span><span class="id"> G</span><span class="id"> f</span><span class="id"> g</span><span class="id"> a</span><span class="id"> b</span><span class="id"> :</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">a</span><span class="id"> &lt;</span><span class="id"> b</span>)<span class="id">%R</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">{within</span><span class="id"> `[a,</span><span class="id"> b],</span><span class="id"> continuous</span><span class="id"> f}</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">derivable_oo_continuous_bnd</span><span class="id"> F</span><span class="id"> a</span><span class="id"> b</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">{in</span><span class="id"> `]a,</span><span class="id"> b[,</span><span class="id"> F^`</span>()<span class="id"> =1</span><span class="id"> f}</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">{within</span><span class="id"> `[a,</span><span class="id"> b],</span><span class="id"> continuous</span><span class="id"> g}</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">derivable_oo_continuous_bnd</span><span class="id"> G</span><span class="id"> a</span><span class="id"> b</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">{in</span><span class="id"> `]a,</span><span class="id"> b[,</span><span class="id"> G^`</span>()<span class="id"> =1</span><span class="id"> g}</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> `[a,</span><span class="id"> b]</span>) (<span class="id">F</span><span class="id"> x</span><span class="id"> *</span><span class="id"> g</span><span class="id"> x</span>)<span class="id"> =</span> (<span class="id">F</span><span class="id"> b</span><span class="id"> *</span><span class="id"> G</span><span class="id"> b</span><span class="id"> -</span><span class="id"> F</span><span class="id"> a</span><span class="id"> *</span><span class="id"> G</span><span class="id"> a</span>)<span class="id"> -</span><br/>
&nbsp;&nbsp;<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> `[a,</span><span class="id"> b]</span>) (<span class="id">f</span><span class="id"> x</span><span class="id"> *</span><span class="id"> G</span><span class="id"> x</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> ab</span><span class="id"> cf</span><span class="id"> Fab</span><span class="id"> Ff</span><span class="id"> cg</span><span class="id"> Gab</span><span class="id"> Gg</span>.<br/>
<span class="id">rewrite</span><span class="id"> [in</span><span class="id"> LHS]/Rintegral</span> (<span class="id">@integration_by_parts</span><span class="id"> R</span><span class="id"> F</span><span class="id"> G</span><span class="id"> f</span><span class="id"> g</span>)<span class="id">//</span><span class="id"> fineB//</span>.<br/>
<span class="id">suff:</span><span class="id"> mu</span>.<span class="id">-integrable</span><span class="id"> `[a,</span><span class="id"> b]</span> (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> =&gt;</span> (<span class="id">f</span><span class="id"> x</span><span class="id"> *</span><span class="id"> G</span><span class="id"> x</span>)<span class="id">%:E</span>).<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> /integrableP[?</span><span class="id"> abfG];</span><span class="id"> apply:</span><span class="id"> fin_real</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> (_<span class="id"> :</span><span class="id"> -oo</span><span class="id"> =</span><span class="id"> -</span><span class="id"> +oo</span>)<span class="id">%E//</span><span class="id"> -lte_absl</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> le_lt_trans</span><span class="id"> abfG;</span><span class="id"> exact:</span><span class="id"> le_abse_integral</span>.<br/>
<span class="id">apply:</span><span class="id"> continuous_compact_integrable</span>.<br/>
&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> segment_compact</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> /=</span><span class="id"> z;</span><span class="id"> apply:</span><span class="id"> continuousM;</span><span class="id"> [exact:</span><span class="id"> cf|]</span>.<br/>
<span class="id">exact:</span> (<span class="id">derivable_oo_continuous_bnd_within</span><span class="id"> Gab</span>).<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> Rintegration_by_parts</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> integration_by_substitution_preliminaries</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {R</span><span class="id"> :</span><span class="id"> realType}</span>.<br/>
<span class="vernacular">Notation</span><span class="id"> mu</span><span class="id"> :=</span><span class="id"> lebesgue_measure</span>.<br/>
<span class="vernacular">Implicit</span><span class="id"> Types</span> (<span class="id">F</span><span class="id"> G</span><span class="id"> f</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> R</span>) (<span class="id">a</span><span class="id"> b</span><span class="id"> :</span><span class="id"> R</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> increasing_image_oo</span><span class="id"> F</span> (<span class="id">a</span><span class="id"> b</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span> (<span class="id">a</span><span class="id"> &lt;</span><span class="id"> b</span>)<span class="id">%R</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">{in</span><span class="id"> `[a,</span><span class="id"> b]</span><span class="id"> &amp;,</span><span class="id"> {homo</span><span class="id"> F</span><span class="id"> :</span><span class="id"> x</span><span class="id"> y</span><span class="id"> /</span> (<span class="id">x</span><span class="id"> &lt;</span><span class="id"> y</span>)<span class="id">%R}}</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">F</span><span class="id"> @`</span><span class="id"> `]a,</span><span class="id"> b[</span><span class="id"> `&lt;=`</span><span class="id"> `]F</span><span class="id"> a,</span><span class="id"> F</span><span class="id"> b[</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> ab</span><span class="id"> iF</span><span class="id"> ?</span><span class="id"> [x</span><span class="id"> /=</span><span class="id"> xab</span><span class="id"> &lt;-]</span>.<br/>
<span class="id">move:</span><span class="id"> xab;</span><span class="id"> rewrite</span><span class="id"> !in_itv/=</span><span class="id"> =&gt;</span><span class="id"> /andP[ax</span><span class="id"> xb]</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply/andP;</span><span class="id"> split;</span><span class="id"> apply:</span><span class="id"> iF;</span><span class="id"> rewrite</span><span class="id"> //</span><span class="id"> in_itv/=</span><span class="id"> ?lexx</span><span class="id"> !ltW</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> decreasing_image_oo</span><span class="id"> F</span> (<span class="id">a</span><span class="id"> b</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span> (<span class="id">a</span><span class="id"> &lt;</span><span class="id"> b</span>)<span class="id">%R</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">{in</span><span class="id"> `[a,</span><span class="id"> b]</span><span class="id"> &amp;,</span><span class="id"> {homo</span><span class="id"> F</span><span class="id"> :</span><span class="id"> x</span><span class="id"> y</span><span class="id"> /~</span> (<span class="id">x</span><span class="id"> &lt;</span><span class="id"> y</span>)<span class="id">%R}}</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">F</span><span class="id"> @`</span><span class="id"> `]a,</span><span class="id"> b[</span><span class="id"> `&lt;=`</span><span class="id"> `]F</span><span class="id"> b,</span><span class="id"> F</span><span class="id"> a[</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> ab</span><span class="id"> iF</span><span class="id"> ?</span><span class="id"> [x</span><span class="id"> /=</span><span class="id"> xab</span><span class="id"> &lt;-]</span>.<br/>
<span class="id">move:</span><span class="id"> xab;</span><span class="id"> rewrite</span><span class="id"> !in_itv/=</span><span class="id"> =&gt;</span><span class="id"> /andP[ax</span><span class="id"> xb]</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply/andP;</span><span class="id"> split;</span><span class="id"> apply:</span><span class="id"> iF;</span><span class="id"> rewrite</span><span class="id"> //</span><span class="id"> in_itv/=</span><span class="id"> ?lexx</span><span class="id"> !ltW</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> increasing_cvg_at_right_comp</span><span class="id"> F</span><span class="id"> G</span><span class="id"> a</span><span class="id"> b</span> (<span class="id">l</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span> (<span class="id">a</span><span class="id"> &lt;</span><span class="id"> b</span>)<span class="id">%R</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">{in</span><span class="id"> `[a,</span><span class="id"> b[</span><span class="id"> &amp;,</span><span class="id"> {homo</span><span class="id"> F</span><span class="id"> :</span><span class="id"> x</span><span class="id"> y</span><span class="id"> /</span> (<span class="id">x</span><span class="id"> &lt;</span><span class="id"> y</span>)<span class="id">%R}}</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">F</span><span class="id"> x</span><span class="id"> @[x</span><span class="id"> --&gt;</span><span class="id"> a^'+]</span><span class="id"> --&gt;</span><span class="id"> F</span><span class="id"> a</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">G</span><span class="id"> x</span><span class="id"> @[x</span><span class="id"> --&gt;</span> (<span class="id">F</span><span class="id"> a</span>)<span class="id">^'+]</span><span class="id"> --&gt;</span><span class="id"> l</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;(<span class="id">G</span><span class="id"> \o</span><span class="id"> F</span>)<span class="id"> x</span><span class="id"> @[x</span><span class="id"> --&gt;</span><span class="id"> a^'+]</span><span class="id"> --&gt;</span><span class="id"> l</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> ab</span><span class="id"> incrF</span><span class="id"> cFa</span><span class="id"> GFa</span>.<br/>
<span class="id">apply/cvgrPdist_le</span><span class="id"> =&gt;</span><span class="id"> /=</span><span class="id"> e</span><span class="id"> e0</span>.<br/>
<span class="id">have/cvgrPdist_le</span><span class="id"> /</span>(_<span class="id"> e</span><span class="id"> e0</span>)<span class="id"> [d</span><span class="id"> /=</span><span class="id"> d0</span><span class="id"> {}GFa]</span><span class="id"> :=</span><span class="id"> GFa</span>.<br/>
<span class="id">have</span><span class="id"> :=</span><span class="id"> cvg_at_right_within</span><span class="id"> cFa</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> /cvgrPdist_lt/</span>(_<span class="id"> _</span><span class="id"> d0</span>)<span class="id">[d'</span><span class="id"> /=</span><span class="id"> d'0</span><span class="id"> {}cFa]</span>.<br/>
<span class="id">near=&gt;</span><span class="id"> t</span>.<br/>
<span class="id">apply:</span><span class="id"> GFa;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> incrF;</span><span class="id"> rewrite</span><span class="id"> //in_itv/=</span><span class="id"> ?lexx//;</span><span class="id"> apply/andP;</span><span class="id"> split</span>.<br/>
<span class="id">apply:</span><span class="id"> cFa</span><span class="id"> =&gt;</span><span class="id"> //=</span>.<br/>
<span class="id">rewrite</span><span class="id"> ltr0_norm//</span><span class="id"> ?subr_lt0//</span><span class="id"> opprB</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> near:</span><span class="id"> t;</span><span class="id"> exact:</span><span class="id"> nbhs_right_ltDr</span>.<br/>
<span class="id">Unshelve</span>.<span class="id"> all:</span><span class="id"> end_near</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> increasing_cvg_at_left_comp</span><span class="id"> F</span><span class="id"> G</span><span class="id"> a</span><span class="id"> b</span> (<span class="id">l</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span> (<span class="id">a</span><span class="id"> &lt;</span><span class="id"> b</span>)<span class="id">%R</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">{in</span><span class="id"> `]a,</span><span class="id"> b]</span><span class="id"> &amp;,</span><span class="id"> {homo</span><span class="id"> F</span><span class="id"> :</span><span class="id"> x</span><span class="id"> y</span><span class="id"> /</span> (<span class="id">x</span><span class="id"> &lt;</span><span class="id"> y</span>)<span class="id">%R}}</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">F</span><span class="id"> x</span><span class="id"> @[x</span><span class="id"> --&gt;</span><span class="id"> b^'-]</span><span class="id"> --&gt;</span><span class="id"> F</span><span class="id"> b</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">G</span><span class="id"> x</span><span class="id"> @[x</span><span class="id"> --&gt;</span> (<span class="id">F</span><span class="id"> b</span>)<span class="id">^'-]</span><span class="id"> --&gt;</span><span class="id"> l</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;(<span class="id">G</span><span class="id"> \o</span><span class="id"> F</span>)<span class="id"> x</span><span class="id"> @[x</span><span class="id"> --&gt;</span><span class="id"> b^'-]</span><span class="id"> --&gt;</span><span class="id"> l</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> ab</span><span class="id"> incrF</span><span class="id"> cFb</span><span class="id"> GFb</span>.<br/>
<span class="id">apply/cvgrPdist_le</span><span class="id"> =&gt;</span><span class="id"> /=</span><span class="id"> e</span><span class="id"> e0</span>.<br/>
<span class="id">have</span><span class="id"> /cvgrPdist_le</span><span class="id"> /</span>(_<span class="id"> e</span><span class="id"> e0</span>)<span class="id"> [d</span><span class="id"> /=</span><span class="id"> d0</span><span class="id"> {}GFb]</span><span class="id"> :=</span><span class="id"> GFb</span>.<br/>
<span class="id">have</span><span class="id"> :=</span><span class="id"> cvg_at_left_within</span><span class="id"> cFb</span>.<br/>
<span class="id">move/cvgrPdist_lt/</span>(_<span class="id"> _</span><span class="id"> d0</span>)<span class="id"> =&gt;</span><span class="id"> [d'</span><span class="id"> /=</span><span class="id"> d'0</span><span class="id"> {}cFb]</span>.<br/>
<span class="id">near=&gt;</span><span class="id"> t</span>.<br/>
<span class="id">apply:</span><span class="id"> GFb;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> incrF;</span><span class="id"> rewrite</span><span class="id"> //in_itv/=</span><span class="id"> ?lexx//;</span><span class="id"> apply/andP;</span><span class="id"> split</span>.<br/>
<span class="id">apply:</span><span class="id"> cFb</span><span class="id"> =&gt;</span><span class="id"> //=</span>.<br/>
<span class="id">rewrite</span><span class="id"> gtr0_norm//</span><span class="id"> ?subr_gt0//</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> near:</span><span class="id"> t;</span><span class="id"> exact:</span><span class="id"> nbhs_left_ltBl</span>.<br/>
<span class="id">Unshelve</span>.<span class="id"> all:</span><span class="id"> end_near</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> decreasing_cvg_at_right_comp</span><span class="id"> F</span><span class="id"> G</span><span class="id"> a</span><span class="id"> b</span> (<span class="id">l</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span> (<span class="id">a</span><span class="id"> &lt;</span><span class="id"> b</span>)<span class="id">%R</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">{in</span><span class="id"> `[a,</span><span class="id"> b[</span><span class="id"> &amp;,</span><span class="id"> {homo</span><span class="id"> F</span><span class="id"> :</span><span class="id"> x</span><span class="id"> y</span><span class="id"> /~</span> (<span class="id">x</span><span class="id"> &lt;</span><span class="id"> y</span>)<span class="id">%R}}</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">F</span><span class="id"> x</span><span class="id"> @[x</span><span class="id"> --&gt;</span><span class="id"> a^'+]</span><span class="id"> --&gt;</span><span class="id"> F</span><span class="id"> a</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">G</span><span class="id"> x</span><span class="id"> @[x</span><span class="id"> --&gt;</span> (<span class="id">F</span><span class="id"> a</span>)<span class="id">^'-]</span><span class="id"> --&gt;</span><span class="id"> l</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;(<span class="id">G</span><span class="id"> \o</span><span class="id"> F</span>)<span class="id"> x</span><span class="id"> @[x</span><span class="id"> --&gt;</span><span class="id"> a^'+]</span><span class="id"> --&gt;</span><span class="id"> l</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> ab</span><span class="id"> decrF</span><span class="id"> cFa</span><span class="id"> GFa</span>.<br/>
<span class="id">apply/cvgrPdist_le</span><span class="id"> =&gt;</span><span class="id"> /=</span><span class="id"> e</span><span class="id"> e0</span>.<br/>
<span class="id">have</span><span class="id"> /cvgrPdist_le</span><span class="id"> /</span>(_<span class="id"> e</span><span class="id"> e0</span>)<span class="id"> [d'</span><span class="id"> /=</span><span class="id"> d'0</span><span class="id"> {}GFa]</span><span class="id"> :=</span><span class="id"> GFa</span>.<br/>
<span class="id">have</span><span class="id"> :=</span><span class="id"> cvg_at_right_within</span><span class="id"> cFa</span>.<br/>
<span class="id">move/cvgrPdist_lt/</span>(_<span class="id"> _</span><span class="id"> d'0</span>)<span class="id"> =&gt;</span><span class="id"> [d''</span><span class="id"> /=</span><span class="id"> d''0</span><span class="id"> {}cFa]</span>.<br/>
<span class="id">near=&gt;</span><span class="id"> t</span>.<br/>
<span class="id">apply:</span><span class="id"> GFa;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> decrF;</span><span class="id"> rewrite</span><span class="id"> //in_itv/=</span><span class="id"> ?lexx//;</span><span class="id"> apply/andP;</span><span class="id"> split</span>.<br/>
<span class="id">apply:</span><span class="id"> cFa</span><span class="id"> =&gt;</span><span class="id"> //=</span>.<br/>
<span class="id">rewrite</span><span class="id"> ltr0_norm//</span><span class="id"> ?subr_lt0//</span><span class="id"> opprB</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> near:</span><span class="id"> t;</span><span class="id"> exact:</span><span class="id"> nbhs_right_ltDr</span>.<br/>
<span class="id">Unshelve</span>.<span class="id"> all:</span><span class="id"> end_near</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> decreasing_cvg_at_left_comp</span><span class="id"> F</span><span class="id"> G</span><span class="id"> a</span><span class="id"> b</span> (<span class="id">l</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span> (<span class="id">a</span><span class="id"> &lt;</span><span class="id"> b</span>)<span class="id">%R</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">{in</span><span class="id"> `]a,</span><span class="id"> b]</span><span class="id"> &amp;,</span><span class="id"> {homo</span><span class="id"> F</span><span class="id"> :</span><span class="id"> x</span><span class="id"> y</span><span class="id"> /~</span> (<span class="id">x</span><span class="id"> &lt;</span><span class="id"> y</span>)<span class="id">%R}}</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">F</span><span class="id"> x</span><span class="id"> @[x</span><span class="id"> --&gt;</span><span class="id"> b^'-]</span><span class="id"> --&gt;</span><span class="id"> F</span><span class="id"> b</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">G</span><span class="id"> x</span><span class="id"> @[x</span><span class="id"> --&gt;</span> (<span class="id">F</span><span class="id"> b</span>)<span class="id">^'+]</span><span class="id"> --&gt;</span><span class="id"> l</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;(<span class="id">G</span><span class="id"> \o</span><span class="id"> F</span>)<span class="id"> x</span><span class="id"> @[x</span><span class="id"> --&gt;</span><span class="id"> b^'-]</span><span class="id"> --&gt;</span><span class="id"> l</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> ab</span><span class="id"> decrF</span><span class="id"> cFb</span><span class="id"> GFb</span>.<br/>
<span class="id">apply/cvgrPdist_le</span><span class="id"> =&gt;</span><span class="id"> /=</span><span class="id"> e</span><span class="id"> e0</span>.<br/>
<span class="id">have</span><span class="id"> /cvgrPdist_le</span><span class="id"> /</span>(_<span class="id"> e</span><span class="id"> e0</span>)<span class="id"> [d'</span><span class="id"> /=</span><span class="id"> d'0</span><span class="id"> {}GFb]</span><span class="id"> :=</span><span class="id"> GFb</span>.<br/>
<span class="id">have</span><span class="id"> :=</span><span class="id"> cvg_at_left_within</span><span class="id"> cFb</span>. <span class="comment">(*&nbsp;different&nbsp;point&nbsp;from&nbsp;gt0&nbsp;version&nbsp;*)</span><br/>
<span class="id">move/cvgrPdist_lt/</span>(_<span class="id"> _</span><span class="id"> d'0</span>)<span class="id"> =&gt;</span><span class="id"> [d''</span><span class="id"> /=</span><span class="id"> d''0</span><span class="id"> {}cFb]</span>.<br/>
<span class="id">near=&gt;</span><span class="id"> t</span>.<br/>
<span class="id">apply:</span><span class="id"> GFb;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> decrF;</span><span class="id"> rewrite</span><span class="id"> //in_itv/=</span><span class="id"> ?lexx//;</span><span class="id"> apply/andP;</span><span class="id"> split</span>.<br/>
<span class="id">apply:</span><span class="id"> cFb</span><span class="id"> =&gt;</span><span class="id"> //=</span>.<br/>
<span class="id">rewrite</span><span class="id"> gtr0_norm//</span><span class="id"> ?subr_gt0//</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> near:</span><span class="id"> t;</span><span class="id"> exact:</span><span class="id"> nbhs_left_ltBl</span>.<br/>
<span class="id">Unshelve</span>.<span class="id"> all:</span><span class="id"> end_near</span>. Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> integration_by_substitution_preliminaries</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> integration_by_substitution</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {R</span><span class="id"> :</span><span class="id"> realType}</span>.<br/>
<span class="vernacular">Notation</span><span class="id"> mu</span><span class="id"> :=</span><span class="id"> lebesgue_measure</span>.<br/>
<span class="vernacular">Implicit</span><span class="id"> Types</span> (<span class="id">F</span><span class="id"> G</span><span class="id"> f</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> R</span>) (<span class="id">a</span><span class="id"> b</span><span class="id"> :</span><span class="id"> R</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> integration_by_substitution_decreasing</span><span class="id"> F</span><span class="id"> G</span><span class="id"> a</span><span class="id"> b</span><span class="id"> :</span> (<span class="id">a</span><span class="id"> &lt;</span><span class="id"> b</span>)<span class="id">%R</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">{in</span><span class="id"> `[a,</span><span class="id"> b]</span><span class="id"> &amp;,</span><span class="id"> {homo</span><span class="id"> F</span><span class="id"> :</span><span class="id"> x</span><span class="id"> y</span><span class="id"> /~</span> (<span class="id">x</span><span class="id"> &lt;</span><span class="id"> y</span>)<span class="id">%R}}</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">{in</span><span class="id"> `]a,</span><span class="id"> b[,</span><span class="id"> continuous</span><span class="id"> F^`</span>()<span class="id">}</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">cvg</span> (<span class="id">F^`</span>()<span class="id"> x</span><span class="id"> @[x</span><span class="id"> --&gt;</span><span class="id"> a^'+]</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">cvg</span> (<span class="id">F^`</span>()<span class="id"> x</span><span class="id"> @[x</span><span class="id"> --&gt;</span><span class="id"> b^'-]</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">derivable_oo_continuous_bnd</span><span class="id"> F</span><span class="id"> a</span><span class="id"> b</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">{within</span><span class="id"> `[F</span><span class="id"> b,</span><span class="id"> F</span><span class="id"> a],</span><span class="id"> continuous</span><span class="id"> G}</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> `[F</span><span class="id"> b,</span><span class="id"> F</span><span class="id"> a]</span>) (<span class="id">G</span><span class="id"> x</span>)<span class="id">%:E</span><span class="id"> =</span><br/>
&nbsp;&nbsp;<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> `[a,</span><span class="id"> b]</span>) (((<span class="id">G</span><span class="id"> \o</span><span class="id"> F</span>)<span class="id"> *</span><span class="id"> -</span><span class="id"> F^`</span>())<span class="id"> x</span>)<span class="id">%:E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> ab</span><span class="id"> decrF</span><span class="id"> cF'</span><span class="id"> /cvg_ex[/=</span><span class="id"> r</span><span class="id"> F'ar]</span><span class="id"> /cvg_ex[/=</span><span class="id"> l</span><span class="id"> F'bl]</span><span class="id"> Fab</span><span class="id"> cG</span>.<br/>
<span class="id">have</span><span class="id"> cF</span><span class="id"> :=</span><span class="id"> derivable_oo_continuous_bnd_within</span><span class="id"> Fab</span>.<br/>
<span class="id">have</span><span class="id"> FbFa</span><span class="id"> :</span> (<span class="id">F</span><span class="id"> b</span><span class="id"> &lt;</span><span class="id"> F</span><span class="id"> a</span>)<span class="id">%R</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> decrF;</span><span class="id"> rewrite</span><span class="id"> //=</span><span class="id"> in_itv/=</span> (<span class="id">ltW</span><span class="id"> ab</span>)<span class="id"> lexx</span>.<br/>
<span class="id">have</span><span class="id"> mGFF'</span><span class="id"> :</span><span class="id"> measurable_fun</span><span class="id"> `]a,</span><span class="id"> b[</span> ((<span class="id">G</span><span class="id"> \o</span><span class="id"> F</span>)<span class="id"> *</span><span class="id"> F^`</span>())<span class="id">%R</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> measurable_funM</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> apply:</span> (<span class="id">measurable_comp</span> (<span class="id">measurable_itv</span><span class="id"> `]F</span><span class="id"> b,</span><span class="id"> F</span><span class="id"> a[</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">+</span><span class="id"> exact:</span><span class="id"> decreasing_image_oo</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">+</span><span class="id"> apply:</span><span class="id"> subspace_continuous_measurable_fun</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> continuous_subspaceW</span><span class="id"> cG;</span><span class="id"> exact/subset_itv_oo_cc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">+</span><span class="id"> apply:</span><span class="id"> subspace_continuous_measurable_fun</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> continuous_subspaceW</span><span class="id"> cF;</span><span class="id"> exact/subset_itv_oo_cc</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> apply:</span><span class="id"> subspace_continuous_measurable_fun</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> continuous_in_subspaceT</span><span class="id"> =&gt;</span><span class="id"> x;</span><span class="id"> rewrite</span><span class="id"> inE/=</span><span class="id"> =&gt;</span><span class="id"> /cF'</span>.<br/>
<span class="id">have</span><span class="id"> {}mGFF'</span><span class="id"> :</span><span class="id"> measurable_fun</span><span class="id"> `[a,</span><span class="id"> b]</span> ((<span class="id">G</span><span class="id"> \o</span><span class="id"> F</span>)<span class="id"> *</span><span class="id"> F^`</span>())<span class="id">%R</span>.<br/>
&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> measurable_fun_itv_cc</span><span class="id"> mGFF'</span>.<br/>
<span class="id">have</span><span class="id"> intG</span><span class="id"> :</span><span class="id"> mu</span>.<span class="id">-integrable</span><span class="id"> `[F</span><span class="id"> b,</span><span class="id"> F</span><span class="id"> a]</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> G</span>).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> continuous_compact_integrable</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> segment_compact</span>.<br/>
<span class="id">pose</span><span class="id"> PG</span><span class="id"> x</span><span class="id"> :=</span><span class="id"> parameterized_integral</span><span class="id"> mu</span> (<span class="id">F</span><span class="id"> b</span>)<span class="id"> x</span><span class="id"> G</span>.<br/>
<span class="id">have</span><span class="id"> PGFbFa</span><span class="id"> :</span><span class="id"> derivable_oo_continuous_bnd</span><span class="id"> PG</span> (<span class="id">F</span><span class="id"> b</span>) (<span class="id">F</span><span class="id"> a</span>).<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> [/=</span><span class="id"> dF</span><span class="id"> rF</span><span class="id"> lF]</span><span class="id"> :=</span><span class="id"> Fab;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> /=</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> xFbFa</span><span class="id"> /=</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">have</span><span class="id"> xFa</span><span class="id"> :</span> (<span class="id">x</span><span class="id"> &lt;</span><span class="id"> F</span><span class="id"> a</span>)<span class="id">%R</span><span class="gallina-kwd"> by</span><span class="id"> move:</span><span class="id"> xFbFa;</span><span class="id"> rewrite</span><span class="id"> in_itv/=</span><span class="id"> =&gt;</span><span class="id"> /andP[]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span> (<span class="id">continuous_FTC1</span><span class="id"> xFa</span><span class="id"> intG</span><span class="id"> _</span><span class="id"> _</span>).<span class="id">1</span><span class="id"> =&gt;</span><span class="id"> /=</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move:</span><span class="id"> xFbFa;</span><span class="id"> rewrite</span><span class="id"> lte_fin</span><span class="id"> in_itv/=</span><span class="id"> =&gt;</span><span class="id"> /andP[]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exact:</span> (<span class="id">within_continuous_continuous</span><span class="id"> _</span><span class="id"> _</span><span class="id"> xFbFa</span>).<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> have</span><span class="id"> :=</span><span class="id"> parameterized_integral_continuous</span><span class="id"> FbFa</span><span class="id"> intG</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> /</span>(<span class="id">continuous_within_itvP</span><span class="id"> _</span><span class="id"> FbFa</span>)<span class="id">[]</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> exact:</span><span class="id"> parameterized_integral_cvg_at_left</span>.<br/>
<span class="id">rewrite</span> (<span class="id">@continuous_FTC2</span><span class="id"> _</span><span class="id"> _</span><span class="id"> PG</span><span class="id"> _</span><span class="id"> _</span><span class="id"> FbFa</span><span class="id"> cG</span>)<span class="id">;</span><span class="id"> last</span><span class="id"> 2</span><span class="id"> first</span>.<br/>
<span class="id">-</span><span class="id"> split</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> /[dup]xFbFa;</span><span class="id"> rewrite</span><span class="id"> in_itv/=</span><span class="id"> =&gt;</span><span class="id"> /andP[Fbx</span><span class="id"> xFa]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span> (<span class="id">continuous_FTC1</span><span class="id"> xFa</span><span class="id"> intG</span><span class="id"> Fbx</span><span class="id"> _</span>).<span class="id">1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move:</span><span class="id"> cG</span><span class="id"> =&gt;</span><span class="id"> /</span>(<span class="id">continuous_within_itvP</span><span class="id"> _</span><span class="id"> FbFa</span>)<span class="id">[+</span><span class="id"> _</span><span class="id"> _];</span><span class="id"> exact</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="id"> have</span><span class="id"> :=</span><span class="id"> parameterized_integral_continuous</span><span class="id"> FbFa</span><span class="id"> intG</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> /</span>(<span class="id">continuous_within_itvP</span><span class="id"> _</span><span class="id"> FbFa</span>)<span class="id">[]</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="id"> exact:</span><span class="id"> parameterized_integral_cvg_at_left</span>.<br/>
<span class="id">-</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> xFbFa</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> xFa</span><span class="id"> :</span> (<span class="id">x</span><span class="id"> &lt;</span><span class="id"> F</span><span class="id"> a</span>)<span class="id">%R</span><span class="gallina-kwd"> by</span><span class="id"> move:</span><span class="id"> xFbFa;</span><span class="id"> rewrite</span><span class="id"> in_itv/=</span><span class="id"> =&gt;</span><span class="id"> /andP[]</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span> (<span class="id">continuous_FTC1</span><span class="id"> xFa</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span>).<span class="id">2</span><span class="id"> =&gt;</span><span class="id"> //=</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move:</span><span class="id"> xFbFa;</span><span class="id"> rewrite</span><span class="id"> lte_fin</span><span class="id"> in_itv/=</span><span class="id"> =&gt;</span><span class="id"> /andP[]</span>.<br/>
&nbsp;&nbsp;<span class="id">exact:</span> (<span class="id">within_continuous_continuous</span><span class="id"> _</span><span class="id"> _</span><span class="id"> xFbFa</span>).<br/>
<span class="id">set</span><span class="id"> f</span> <span class="id"> :=</span><span class="gallina-kwd"> fun</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="gallina-kwd"> if</span><span class="id"> x</span><span class="id"> ==</span><span class="id"> a</span><span class="gallina-kwd"> then</span><span class="id"> r</span><span class="gallina-kwd"> else</span><span class="gallina-kwd"> if</span><span class="id"> x</span><span class="id"> ==</span><span class="id"> b</span><span class="gallina-kwd"> then</span><span class="id"> l</span><span class="gallina-kwd"> else</span><span class="id"> F^`</span>()<span class="id"> x</span>.<br/>
<span class="id">have</span><span class="id"> fE</span><span class="id"> :</span><span class="id"> {in</span><span class="id"> `]a,</span><span class="id"> b[,</span><span class="id"> F^`</span>()<span class="id"> =1</span><span class="id"> f}</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> x;</span><span class="id"> rewrite</span><span class="id"> in_itv/=</span><span class="id"> =&gt;</span><span class="id"> /andP[ax</span><span class="id"> xb];</span><span class="id"> rewrite</span><span class="id"> /f</span><span class="id"> gt_eqF//</span><span class="id"> lt_eqF</span>.<br/>
<span class="id">have</span><span class="id"> DPGFE</span><span class="id"> :</span><span class="id"> {in</span><span class="id"> `]a,</span><span class="id"> b[,</span> (<span class="id">-</span> (<span class="id">PG</span><span class="id"> \o</span><span class="id"> F</span>))<span class="id">%R^`</span>()<span class="id"> =1</span> ((<span class="id">G</span><span class="id"> \o</span><span class="id"> F</span>)<span class="id"> *</span> (<span class="id">-</span><span class="id"> f</span>))<span class="id">%R}</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> x</span><span class="id"> /[dup]xab</span><span class="id"> /andP[ax</span><span class="id"> xb];</span><span class="id"> rewrite</span><span class="id"> derive1_comp</span><span class="id"> //;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> diff_derivable;</span><span class="id"> apply:</span><span class="id"> differentiable_comp;</span><span class="id"> apply/derivable1_diffP</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> case:</span><span class="id"> Fab</span><span class="id"> =&gt;</span><span class="id"> +</span><span class="id"> _</span><span class="id"> _;</span><span class="id"> exact</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> case:</span><span class="id"> PGFbFa</span><span class="id"> =&gt;</span><span class="id"> +</span><span class="id"> _</span><span class="id"> _;</span><span class="id"> apply;</span><span class="id"> exact:</span><span class="id"> decreasing_image_oo</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> /</span>(<span class="id">@derive_val</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> -%R</span>)<span class="id"> :=</span><span class="id"> @is_deriveNid</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">PG</span> (<span class="id">F</span><span class="id"> x</span>))<span class="id"> 1%R</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> fctE</span><span class="id"> -derive1E</span><span class="id"> =&gt;</span><span class="id"> -&gt;;</span><span class="id"> rewrite</span><span class="id"> mulN1r</span><span class="id"> mulrN;</span><span class="id"> congr</span><span class="id"> -%R</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> derive1_comp;</span><span class="id"> last</span><span class="id"> 2</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> case:</span><span class="id"> Fab</span><span class="id"> =&gt;</span><span class="id"> +</span><span class="id"> _</span><span class="id"> _;</span><span class="id"> exact</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> case:</span><span class="id"> PGFbFa</span><span class="id"> =&gt;</span><span class="id"> [+</span><span class="id"> _</span><span class="id"> _];</span><span class="id"> apply;</span><span class="id"> exact:</span><span class="id"> decreasing_image_oo</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> fE//;</span><span class="id"> congr</span><span class="id"> *%R</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> /[dup]FxFbFa</span><span class="id"> :</span><span class="id"> F</span><span class="id"> x</span><span class="id"> \in</span><span class="id"> `]F</span><span class="id"> b,</span><span class="id"> F</span><span class="id"> a[</span><span class="gallina-kwd"> by</span><span class="id"> exact:</span><span class="id"> decreasing_image_oo</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> in_itv/=</span><span class="id"> =&gt;</span><span class="id"> /andP[FbFx</span><span class="id"> FxFa]</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span> (<span class="id">continuous_FTC1</span><span class="id"> FxFa</span><span class="id"> intG</span><span class="id"> FbFx</span><span class="id"> _</span>).<span class="id">2</span><span class="id"> =&gt;</span><span class="id"> //=</span>.<br/>
&nbsp;&nbsp;<span class="id">exact:</span> (<span class="id">within_continuous_continuous</span><span class="id"> _</span><span class="id"> _</span><span class="id"> FxFbFa</span>).<br/>
<span class="id">rewrite</span><span class="id"> -[LHS]oppeK</span><span class="id"> oppeB//</span><span class="id"> addrC</span>.<br/>
<span class="id">under</span><span class="id"> eq_integral</span><span class="id"> do</span><span class="id"> rewrite</span><span class="id"> mulrN</span><span class="id"> EFinN</span>.<br/>
<span class="id">rewrite</span><span class="id"> oppeD//=</span><span class="id"> -</span>(<span class="id">continuous_FTC2</span><span class="id"> ab</span><span class="id"> _</span><span class="id"> _</span><span class="id"> DPGFE</span>)<span class="id">;</span><span class="id"> last</span><span class="id"> 2</span><span class="id"> first</span>.<br/>
<span class="id">-</span><span class="id"> apply/</span>(<span class="id">continuous_within_itvP</span><span class="id"> _</span><span class="id"> ab</span>)<span class="id">;</span><span class="id"> split</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> xab;</span><span class="id"> apply:</span><span class="id"> continuousM;</span><span class="id"> first</span><span class="id"> apply:</span><span class="id"> continuous_comp</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">*</span><span class="gallina-kwd"> by</span><span class="id"> move:</span><span class="id"> cF</span><span class="id"> =&gt;</span><span class="id"> /</span>(<span class="id">continuous_within_itvP</span><span class="id"> _</span><span class="id"> ab</span>)<span class="id">[+</span><span class="id"> _</span><span class="id"> _];</span><span class="id"> exact</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">*</span><span class="id"> move/</span>(<span class="id">continuous_within_itvP</span><span class="id"> _</span><span class="id"> FbFa</span>)<span class="id"> :</span><span class="id"> cG</span><span class="id"> =&gt;</span><span class="id"> [+</span><span class="id"> _</span><span class="id"> _];</span><span class="id"> apply</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> decreasing_image_oo</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">*</span><span class="id"> have</span><span class="id"> :</span><span class="id"> -%R</span><span class="id"> F^`</span>()<span class="id"> @</span><span class="id"> x</span><span class="id"> --&gt;</span> (<span class="id">-</span><span class="id"> f</span><span class="id"> x</span>)<span class="id">%R</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -fE//;</span><span class="id"> apply:</span><span class="id"> cvgN;</span><span class="id"> exact:</span><span class="id"> cF'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> cvg_trans;</span><span class="id"> apply:</span><span class="id"> near_eq_cvg</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span> (<span class="id">@open_in_nearW</span><span class="id"> _</span><span class="id"> _</span><span class="id"> `]a,</span><span class="id"> b[</span>)<span class="id"> ;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> inE</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> interval_open</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> z;</span><span class="id"> rewrite</span><span class="id"> inE/=</span><span class="id"> =&gt;</span><span class="id"> zab;</span><span class="id"> rewrite</span><span class="id"> fctE</span><span class="id"> fE</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="id"> apply:</span><span class="id"> cvgM</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span> (<span class="id">decreasing_cvg_at_right_comp</span><span class="id"> ab</span>)<span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">*</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> y</span><span class="id"> xab</span><span class="id"> yab;</span><span class="id"> apply:</span><span class="id"> decrF;</span><span class="id"> exact:</span><span class="id"> subset_itv_co_cc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">*</span><span class="gallina-kwd"> by</span><span class="id"> move/continuous_within_itvP</span><span class="id"> :</span><span class="id"> cF</span><span class="id"> =&gt;</span><span class="id"> /</span>(_<span class="id"> ab</span>)<span class="id">[]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">*</span><span class="gallina-kwd"> by</span><span class="id"> move/continuous_within_itvP</span><span class="id"> :</span><span class="id"> cG</span><span class="id"> =&gt;</span><span class="id"> /</span>(_<span class="id"> FbFa</span>)<span class="id">[]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> fctE</span><span class="id"> {2}/f</span><span class="id"> eqxx;</span><span class="id"> apply:</span><span class="id"> cvgN</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> cvg_trans</span><span class="id"> F'ar;</span><span class="id"> apply:</span><span class="id"> near_eq_cvg</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> near=&gt;</span><span class="id"> z;</span><span class="id"> rewrite</span><span class="id"> fE//</span><span class="id"> in_itv/=;</span><span class="id"> apply/andP;</span><span class="id"> split</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="id"> apply:</span><span class="id"> cvgM</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span> (<span class="id">decreasing_cvg_at_left_comp</span><span class="id"> ab</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">*</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> //x</span><span class="id"> y</span><span class="id"> xab</span><span class="id"> yab;</span><span class="id"> apply:</span><span class="id"> decrF;</span><span class="id"> apply:</span><span class="id"> subset_itv_oc_cc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">*</span><span class="gallina-kwd"> by</span><span class="id"> move/continuous_within_itvP</span><span class="id"> :</span><span class="id"> cF</span><span class="id"> =&gt;</span><span class="id"> /</span>(_<span class="id"> ab</span>)<span class="id">[]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">*</span><span class="gallina-kwd"> by</span><span class="id"> move/continuous_within_itvP</span><span class="id"> :</span><span class="id"> cG</span><span class="id"> =&gt;</span><span class="id"> /</span>(_<span class="id"> FbFa</span>)<span class="id">[]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> fctE</span><span class="id"> {2}/f</span><span class="id"> gt_eqF//</span><span class="id"> eqxx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> cvgN;</span><span class="id"> apply:</span><span class="id"> cvg_trans</span><span class="id"> F'bl;</span><span class="id"> apply:</span><span class="id"> near_eq_cvg</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> near=&gt;</span><span class="id"> z;</span><span class="id"> rewrite</span><span class="id"> fE//</span><span class="id"> in_itv/=;</span><span class="id"> apply/andP;</span><span class="id"> split</span>.<br/>
<span class="id">-</span><span class="id"> have</span><span class="id"> [/=</span><span class="id"> dF</span><span class="id"> rF</span><span class="id"> lF]</span><span class="id"> :=</span><span class="id"> Fab</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> :=</span><span class="id"> derivable_oo_continuous_bnd_within</span><span class="id"> PGFbFa</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> /</span>(<span class="id">continuous_within_itvP</span><span class="id"> _</span><span class="id"> FbFa</span>)<span class="id">[_</span><span class="id"> PGFb</span><span class="id"> PGFa];</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> /=</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> xab;</span><span class="id"> apply/derivable1_diffP;</span><span class="id"> apply:</span><span class="id"> differentiable_comp</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> differentiable_comp;</span><span class="id"> apply/derivable1_diffP</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> case:</span><span class="id"> Fab</span><span class="id"> =&gt;</span><span class="id"> +</span><span class="id"> _</span><span class="id"> _;</span><span class="id"> exact</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> case:</span><span class="id"> PGFbFa</span><span class="id"> =&gt;</span><span class="id"> +</span><span class="id"> _</span><span class="id"> _;</span><span class="id"> apply;</span><span class="id"> exact:</span><span class="id"> decreasing_image_oo</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> apply:</span><span class="id"> cvgN;</span><span class="id"> apply/cvgrPdist_le</span><span class="id"> =&gt;</span><span class="id"> /=</span><span class="id"> e</span><span class="id"> e0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">have</span><span class="id"> /cvgrPdist_le/</span>(_<span class="id"> e</span><span class="id"> e0</span>)<span class="id">[d</span><span class="id"> /=</span><span class="id"> d0</span><span class="id"> {}PGFa]</span><span class="id"> :=</span><span class="id"> PGFa</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">have</span><span class="id"> :=</span><span class="id"> cvg_at_right_within</span><span class="id"> rF</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">move/cvgrPdist_lt</span><span class="id"> =&gt;</span><span class="id"> /</span>(_<span class="id"> _</span><span class="id"> d0</span>)<span class="id">[d'</span><span class="id"> /=</span><span class="id"> d'0</span><span class="id"> {}cFa]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">near=&gt;</span><span class="id"> t</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> PGFa;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> decrF;</span><span class="id"> rewrite</span><span class="id"> //in_itv/=</span><span class="id"> ?lexx</span><span class="id"> !ltW</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> cFa</span><span class="id"> =&gt;</span><span class="id"> //=</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> ltr0_norm//</span><span class="id"> ?subr_lt0//</span><span class="id"> opprB</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> near:</span><span class="id"> t;</span><span class="id"> exact:</span><span class="id"> nbhs_right_ltDr</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> apply:</span><span class="id"> cvgN;</span><span class="id"> apply/cvgrPdist_le</span><span class="id"> =&gt;</span><span class="id"> /=</span><span class="id"> e</span><span class="id"> e0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">have</span><span class="id"> /cvgrPdist_le/</span>(_<span class="id"> e</span><span class="id"> e0</span>)<span class="id">[d</span><span class="id"> /=</span><span class="id"> d0</span><span class="id"> {}PGFb]</span><span class="id"> :=</span><span class="id"> PGFb</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">have</span><span class="id"> :=</span><span class="id"> cvg_at_left_within</span><span class="id"> lF</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">move/cvgrPdist_lt</span><span class="id"> =&gt;</span><span class="id"> /</span>(_<span class="id"> _</span><span class="id"> d0</span>)<span class="id">[d'</span><span class="id"> /=</span><span class="id"> d'0</span><span class="id"> {}cFb]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">near=&gt;</span><span class="id"> t</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> PGFb;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> decrF;</span><span class="id"> rewrite</span><span class="id"> //in_itv/=</span><span class="id"> ?lexx</span><span class="id"> !ltW</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> cFb</span><span class="id"> =&gt;</span><span class="id"> //=</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> gtr0_norm//</span><span class="id"> ?subr_gt0//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> near:</span><span class="id"> t;</span><span class="id"> exact:</span><span class="id"> nbhs_left_ltBl</span>.<br/>
<span class="id">apply:</span><span class="id"> eq_integral_itv_bounded</span>.<br/>
<span class="id">-</span><span class="id"> rewrite</span><span class="id"> mulrN;</span><span class="id"> apply:</span><span class="id"> measurableT_comp</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span> (<span class="id">eq_measurable_fun</span> ((<span class="id">G</span><span class="id"> \o</span><span class="id"> F</span>)<span class="id"> *</span><span class="id"> F^`</span>())<span class="id">%R</span>)<span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> x;</span><span class="id"> rewrite</span><span class="id"> inE/=</span><span class="id"> =&gt;</span><span class="id"> xab;</span><span class="id"> rewrite</span><span class="id"> !fctE</span><span class="id"> fE</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move:</span><span class="id"> mGFF';</span><span class="id"> apply:</span><span class="id"> measurable_funS</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> subset_itv_oo_cc</span>.<br/>
<span class="id">-</span><span class="id"> apply:</span><span class="id"> measurableT_comp</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> apply:</span><span class="id"> measurable_funS</span><span class="id"> mGFF'</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> subset_itv_oo_cc</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> /[!inE]</span><span class="id"> xab;</span><span class="id"> rewrite</span><span class="id"> mulrN</span><span class="id"> !fctE</span><span class="id"> fE</span>.<br/>
<span class="id">Unshelve</span>.<span class="id"> all:</span><span class="id"> end_near</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> integration_by_substitution_oppr</span><span class="id"> G</span><span class="id"> a</span><span class="id"> b</span><span class="id"> :</span> (<span class="id">a</span><span class="id"> &lt;</span><span class="id"> b</span>)<span class="id">%R</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">{within</span><span class="id"> `[</span>(<span class="id">-</span><span class="id"> b</span>)<span class="id">%R,</span> (<span class="id">-</span><span class="id"> a</span>)<span class="id">%R],</span><span class="id"> continuous</span><span class="id"> G}</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> `[</span>(<span class="id">-</span><span class="id"> b</span>)<span class="id">%R,</span> (<span class="id">-</span><span class="id"> a</span>)<span class="id">%R]</span>) (<span class="id">G</span><span class="id"> x</span>)<span class="id">%:E</span><span class="id"> =</span><br/>
&nbsp;&nbsp;<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> `[a,</span><span class="id"> b]</span>) ((<span class="id">G</span><span class="id"> \o</span><span class="id"> -%R</span>)<span class="id"> x</span>)<span class="id">%:E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> ab</span><span class="id"> cG;</span><span class="id"> have</span><span class="id"> Dopp:</span> (<span class="id">@GRing</span>.<span class="id">opp</span><span class="id"> R</span>)<span class="id">^`</span>()<span class="id"> =</span><span class="id"> cst</span> (<span class="id">-1</span>)<span class="id">%R</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply/funext</span><span class="id"> =&gt;</span><span class="id"> z;</span><span class="id"> rewrite</span><span class="id"> derive1E</span><span class="id"> derive_val</span>.<br/>
<span class="id">rewrite</span> (<span class="id">@integration_by_substitution_decreasing</span><span class="id"> -%R</span>)<span class="id">//</span>.<br/>
<span class="id">-</span><span class="id"> apply:</span><span class="id"> eq_integral</span><span class="id"> =&gt;</span><span class="id"> //=</span><span class="id"> x</span><span class="id"> /[!inE]</span><span class="id"> xab;</span><span class="id"> congr</span> (<span class="id">EFin</span><span class="id"> _</span>).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> !fctE</span><span class="id"> -[RHS]mulr1</span><span class="id"> derive1E</span><span class="id"> deriveN//</span><span class="id"> opprK</span><span class="id"> derive_val</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> ?</span><span class="id"> ?</span><span class="id"> _</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> ltrN2</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> Dopp</span><span class="id"> =&gt;</span><span class="id"> ?</span><span class="id"> _;</span><span class="id"> exact:</span><span class="id"> cvg_cst</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> Dopp;</span><span class="id"> apply:</span><span class="id"> is_cvgN;</span><span class="id"> exact:</span><span class="id"> is_cvg_cst</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> Dopp;</span><span class="id"> apply:</span><span class="id"> is_cvgN;</span><span class="id"> exact:</span><span class="id"> is_cvg_cst</span>.<br/>
<span class="id">-</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> -at_leftN;</span><span class="id"> exact:</span><span class="id"> cvg_at_left_filter</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> -at_rightN;</span><span class="id"> exact:</span><span class="id"> cvg_at_right_filter</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> integration_by_substitution_increasing</span><span class="id"> F</span><span class="id"> G</span><span class="id"> a</span><span class="id"> b</span><span class="id"> :</span> (<span class="id">a</span><span class="id"> &lt;</span><span class="id"> b</span>)<span class="id">%R</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">{in</span><span class="id"> `[a,</span><span class="id"> b]</span><span class="id"> &amp;,</span><span class="id"> {homo</span><span class="id"> F</span><span class="id"> :</span><span class="id"> x</span><span class="id"> y</span><span class="id"> /</span> (<span class="id">x</span><span class="id"> &lt;</span><span class="id"> y</span>)<span class="id">%R}}</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">{in</span><span class="id"> `]a,</span><span class="id"> b[,</span><span class="id"> continuous</span><span class="id"> F^`</span>()<span class="id">}</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">cvg</span> (<span class="id">F^`</span>()<span class="id"> x</span><span class="id"> @[x</span><span class="id"> --&gt;</span><span class="id"> a^'+]</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">cvg</span> (<span class="id">F^`</span>()<span class="id"> x</span><span class="id"> @[x</span><span class="id"> --&gt;</span><span class="id"> b^'-]</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">derivable_oo_continuous_bnd</span><span class="id"> F</span><span class="id"> a</span><span class="id"> b</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">{within</span><span class="id"> `[F</span><span class="id"> a,</span><span class="id"> F</span><span class="id"> b],</span><span class="id"> continuous</span><span class="id"> G}</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> `[F</span><span class="id"> a,</span><span class="id"> F</span><span class="id"> b]</span>) (<span class="id">G</span><span class="id"> x</span>)<span class="id">%:E</span><span class="id"> =</span><br/>
&nbsp;&nbsp;<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> `[a,</span><span class="id"> b]</span>) (((<span class="id">G</span><span class="id"> \o</span><span class="id"> F</span>)<span class="id"> *</span><span class="id"> F^`</span>())<span class="id"> x</span>)<span class="id">%:E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> ab</span><span class="id"> incrF</span><span class="id"> cF'</span><span class="id"> /cvg_ex[/=</span><span class="id"> r</span><span class="id"> F'ar]</span><span class="id"> /cvg_ex[/=</span><span class="id"> l</span><span class="id"> F'bl]</span><span class="id"> Fab</span><span class="id"> cG</span>.<br/>
<span class="id">transitivity</span> (<span class="id">\int[mu]_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> `[F</span><span class="id"> a,</span><span class="id"> F</span><span class="id"> b]</span>) (((<span class="id">G</span><span class="id"> \o</span><span class="id"> -%R</span>)<span class="id"> \o</span><span class="id"> -%R</span>)<span class="id"> x</span>)<span class="id">%:E</span>).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply/eq_integral</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> ?</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> opprK</span>.<br/>
<span class="id">have</span><span class="id"> FaFb</span><span class="id"> :</span> (<span class="id">F</span><span class="id"> a</span><span class="id"> &lt;</span><span class="id"> F</span><span class="id"> b</span>)<span class="id">%R</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> incrF//</span><span class="id"> in_itv/=</span><span class="id"> lexx</span> (<span class="id">ltW</span><span class="id"> ab</span>).<br/>
<span class="id">have</span><span class="id"> cGN</span><span class="id"> :</span><span class="id"> {within</span><span class="id"> `[-</span><span class="id"> F</span><span class="id"> b,</span><span class="id"> -</span><span class="id"> F</span><span class="id"> a]%classic%R,</span><span class="id"> continuous</span> (<span class="id">G</span><span class="id"> \o</span><span class="id"> -%R</span>)<span class="id">}</span>.<br/>
&nbsp;&nbsp;<span class="id">apply/continuous_within_itvP;</span><span class="id"> [by</span><span class="id"> rewrite</span><span class="id"> ltrN2|split]</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> /[dup]xab</span><span class="id"> /[!in_itv]/=</span><span class="id"> /andP[ax</span><span class="id"> xb]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> continuous_comp;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> continuousN</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> move/</span>(<span class="id">continuous_within_itvP</span><span class="id"> _</span><span class="id"> FaFb</span>)<span class="id"> :</span><span class="id"> cG</span><span class="id"> =&gt;</span><span class="id"> [+</span><span class="id"> _</span><span class="id"> _];</span><span class="id"> apply</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> in_itv/=</span><span class="id"> ltrNr</span><span class="id"> xb</span><span class="id"> ltrNl</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> move/</span>(<span class="id">continuous_within_itvP</span><span class="id"> _</span><span class="id"> FaFb</span>)<span class="id"> :</span><span class="id"> cG</span><span class="id"> =&gt;</span><span class="id"> [_</span><span class="id"> _]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /=</span><span class="id"> opprK</span><span class="id"> =&gt;</span><span class="id"> /cvg_at_leftNP</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> move/</span>(<span class="id">continuous_within_itvP</span><span class="id"> _</span><span class="id"> FaFb</span>)<span class="id"> :</span><span class="id"> cG</span><span class="id"> =&gt;</span><span class="id"> [_</span><span class="id"> +</span><span class="id"> _]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /=</span><span class="id"> opprK</span><span class="id"> =&gt;</span><span class="id"> /cvg_at_rightNP</span>.<br/>
<span class="id">rewrite</span><span class="id"> -integration_by_substitution_oppr//</span>.<br/>
<span class="id">rewrite</span> (<span class="id">@integration_by_substitution_decreasing</span> (<span class="id">-</span><span class="id"> F</span>)<span class="id">%R</span>)<span class="id">;</span><span class="id"> first</span><span class="id"> last</span>.<br/>
<span class="id">-</span><span class="id"> exact:</span><span class="id"> cGN</span>.<br/>
<span class="id">-</span><span class="id"> split;</span><span class="id"> [|by</span><span class="id"> apply:</span><span class="id"> cvgN;</span><span class="id"> case:</span><span class="id"> Fab</span>..<span class="id">]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> xab;</span><span class="id"> apply:</span><span class="id"> derivableN;</span><span class="id"> case:</span><span class="id"> Fab</span><span class="id"> =&gt;</span><span class="id"> +</span><span class="id"> _</span><span class="id"> _;</span><span class="id"> exact</span>.<br/>
<span class="id">-</span><span class="id"> apply/cvg_ex;</span><span class="gallina-kwd"> exists</span> (<span class="id">-</span><span class="id"> l</span>)<span class="id">%R</span>.<br/>
&nbsp;&nbsp;<span class="id">move/cvgN</span><span class="id"> :</span><span class="id"> F'bl;</span><span class="id"> apply:</span><span class="id"> cvg_trans;</span><span class="id"> apply:</span><span class="id"> near_eq_cvg</span>.<br/>
&nbsp;&nbsp;<span class="id">near=&gt;</span><span class="id"> z;</span><span class="id"> rewrite</span><span class="id"> fctE</span><span class="id"> !derive1E</span><span class="id"> deriveN//</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> case:</span><span class="id"> Fab</span><span class="id"> =&gt;</span><span class="id"> +</span><span class="id"> _</span><span class="id"> _;</span><span class="id"> apply;</span><span class="id"> rewrite</span><span class="id"> in_itv/=;</span><span class="id"> apply/andP;</span><span class="id"> split</span>.<br/>
<span class="id">-</span><span class="id"> apply/cvg_ex;</span><span class="gallina-kwd"> exists</span> (<span class="id">-</span><span class="id"> r</span>)<span class="id">%R</span>.<br/>
&nbsp;&nbsp;<span class="id">move/cvgN</span><span class="id"> :</span><span class="id"> F'ar;</span><span class="id"> apply:</span><span class="id"> cvg_trans;</span><span class="id"> apply:</span><span class="id"> near_eq_cvg</span>.<br/>
&nbsp;&nbsp;<span class="id">near=&gt;</span><span class="id"> z;</span><span class="id"> rewrite</span><span class="id"> fctE</span><span class="id"> !derive1E</span><span class="id"> deriveN//</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> case:</span><span class="id"> Fab</span><span class="id"> =&gt;</span><span class="id"> +</span><span class="id"> _</span><span class="id"> _;</span><span class="id"> apply;</span><span class="id"> rewrite</span><span class="id"> in_itv/=;</span><span class="id"> apply/andP;</span><span class="id"> split</span>.<br/>
<span class="id">-</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> xab;</span><span class="id"> rewrite</span><span class="id"> /continuous_at</span><span class="id"> derive1E</span><span class="id"> deriveN;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> case:</span><span class="id"> Fab</span><span class="id"> =&gt;</span><span class="id"> +</span><span class="id"> _</span><span class="id"> _;</span><span class="id"> exact</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -derive1E</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> /cvgN</span><span class="id"> :=</span><span class="id"> cF'</span><span class="id"> _</span><span class="id"> xab;</span><span class="id"> apply:</span><span class="id"> cvg_trans;</span><span class="id"> apply:</span><span class="id"> near_eq_cvg</span>.<br/>
&nbsp;&nbsp;<span class="id">near=&gt;</span><span class="id"> y;</span><span class="id"> rewrite</span><span class="id"> fctE</span><span class="id"> !derive1E</span><span class="id"> deriveN//</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> case:</span><span class="id"> Fab</span><span class="id"> =&gt;</span><span class="id"> +</span><span class="id"> _</span><span class="id"> _;</span><span class="id"> apply;</span><span class="id"> near:</span><span class="id"> y;</span><span class="id"> exact:</span><span class="id"> near_in_itvoo</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> y</span><span class="id"> xab</span><span class="id"> yab</span><span class="id"> yx;</span><span class="id"> rewrite</span><span class="id"> ltrN2</span><span class="id"> incrF</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> []</span>.<br/>
<span class="id">have</span><span class="id"> mGF</span><span class="id"> :</span><span class="id"> measurable_fun</span><span class="id"> `]a,</span><span class="id"> b[</span> (<span class="id">G</span><span class="id"> \o</span><span class="id"> F</span>).<br/>
&nbsp;&nbsp;<span class="id">apply:</span> (<span class="id">@measurable_comp</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> `]F</span><span class="id"> a,</span><span class="id"> F</span><span class="id"> b[%classic</span>)<span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> move=&gt;</span><span class="id"> /=</span><span class="id"> _</span><span class="id"> [x]</span><span class="id"> /[!in_itv]/=</span><span class="id"> /andP[ax</span><span class="id"> xb]</span><span class="id"> &lt;-</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> incrF</span><span class="id"> ?incrF//</span><span class="id"> in_itv/=</span><span class="id"> ?lexx/=</span><span class="id"> ?</span>(<span class="id">ltW</span><span class="id"> ab</span>)<span class="id">//=</span><span class="id"> ?</span>(<span class="id">ltW</span><span class="id"> ax</span>)<span class="id"> ?</span>(<span class="id">ltW</span><span class="id"> xb</span>).<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> apply:</span><span class="id"> subspace_continuous_measurable_fun</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> continuous_subspaceW</span><span class="id"> cG;</span><span class="id"> exact/subset_itv_oo_cc</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> apply:</span><span class="id"> subspace_continuous_measurable_fun</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> derivable_within_continuous</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> xab;</span><span class="id"> case:</span><span class="id"> Fab</span><span class="id"> =&gt;</span><span class="id"> +</span><span class="id"> _</span><span class="id"> _;</span><span class="id"> exact</span>.<br/>
<span class="id">have</span><span class="id"> mF'</span><span class="id"> :</span><span class="id"> measurable_fun</span><span class="id"> `]a,</span><span class="id"> b[</span><span class="id"> F^`</span>().<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> subspace_continuous_measurable_fun</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> continuous_in_subspaceT</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> /[!inE]</span><span class="id"> xab;</span><span class="id"> exact:</span><span class="id"> cF'</span>.<br/>
<span class="id">rewrite</span><span class="id"> integral_itv_bndoo//;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> compA</span><span class="id"> -</span>(<span class="id">compA</span><span class="id"> G</span><span class="id"> -%R</span>) (_<span class="id"> :</span><span class="id"> -%R</span><span class="id"> \o</span><span class="id"> -%R</span><span class="id"> =</span><span class="id"> id</span>)<span class="id">;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply/funext</span><span class="id"> =&gt;</span><span class="id"> y;</span><span class="id"> rewrite</span><span class="id"> /=</span><span class="id"> opprK</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> measurable_funM</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> apply:</span><span class="id"> measurableT_comp</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span> (<span class="id">@eq_measurable_fun</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">-</span><span class="id"> F^`</span>())<span class="id">%R</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> x</span><span class="id"> /[!inE]</span><span class="id"> xab;</span><span class="id"> rewrite</span><span class="id"> [in</span><span class="id"> RHS]derive1E</span><span class="id"> deriveN</span><span class="id"> -?derive1E//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> case:</span><span class="id"> Fab</span><span class="id"> =&gt;</span><span class="id"> +</span><span class="id"> _</span><span class="id"> _;</span><span class="id"> apply</span>.<br/>
&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> measurableT_comp</span>.<br/>
<span class="id">rewrite</span><span class="id"> [in</span><span class="id"> RHS]integral_itv_bndoo//;</span><span class="id"> last</span><span class="id"> exact:</span><span class="id"> measurable_funM</span>.<br/>
<span class="id">apply:</span><span class="id"> eq_integral</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> /[!inE]</span><span class="id"> xab;</span><span class="id"> rewrite</span><span class="id"> !fctE</span><span class="id"> !opprK</span><span class="id"> derive1E</span><span class="id"> deriveN</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> opprK</span><span class="id"> -derive1E</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> case:</span><span class="id"> Fab</span><span class="id"> =&gt;</span><span class="id"> +</span><span class="id"> _</span><span class="id"> _;</span><span class="id"> exact</span>.<br/>
<span class="id">Unshelve</span>.<span class="id"> all:</span><span class="id"> end_near</span>. Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> integration_by_substitution</span>.<br/>

      <div class="footer"><hr/>Generated by <a href="https://github.com/yoshihiro503/coq2html/">a fork of coq2html</a></div>
    </div>
  </div>
    </main>
</body>
</html>
