
<!DOCTYPE html>
<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Module mathcomp.analysis.ereal</title>
<meta name="description" content="Documentation of Coq module mathcomp.analysis.ereal" />
<link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.css">
<script src="https://cdn.jsdelivr.net/npm/markdown-it/dist/markdown-it.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/markdown-it-texmath/texmath.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/darkmode-js@1.5.7/lib/darkmode-js.min.js"></script>
<link href="coq2html.css" rel="stylesheet" type="text/css" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script type="text/javascript" src="coq2html.js"> </script>
</head>

<body onload="init()">

  <main>
    <div class="sidebar">
      <h2>Files</h2>
      
    </div>

  <div class="coq">

    <div class="content">
      <p><a href="./index.html">Top</a></p>
      <h1 class="title">Module mathcomp.analysis.ereal</h1>
<span class="vernacular">From</span><span class="id"> HB</span><span class="vernacular"> Require</span><span class="vernacular"> Import</span><span class="id"> structures</span>.<br/>
<span class="vernacular">From</span><span class="id"> mathcomp</span><span class="vernacular"> Require</span><span class="vernacular"> Import</span><span class="id"> all_ssreflect</span><span class="id"> all_algebra</span><span class="id"> archimedean</span><span class="id"> finmap</span>.<br/>
<span class="vernacular">From</span><span class="id"> mathcomp</span><span class="vernacular"> Require</span><span class="vernacular"> Import</span><span class="id"> boolp</span><span class="id"> classical_sets</span><span class="id"> functions</span>.<br/>
<span class="vernacular">From</span><span class="id"> mathcomp</span><span class="vernacular"> Require</span><span class="vernacular"> Import</span><span class="id"> fsbigop</span><span class="id"> cardinality</span><span class="id"> set_interval</span>.<br/>
<span class="vernacular">From</span><span class="id"> mathcomp</span><span class="vernacular"> Require</span><span class="vernacular"> Import</span><span class="id"> reals</span><span class="id"> signed</span><span class="id"> topology</span>.<br/>
<span class="vernacular">From</span><span class="id"> mathcomp</span><span class="vernacular"> Require</span><span class="vernacular"> Export</span><span class="id"> constructive_ereal</span>.<br/>
<br/>
<div class="ssrdoc md">
# Extended real numbers, classical part ($\overline{\mathbb{R}}$)

This is an addition to the file constructive_ereal.v with classical logic
elements.
```
 (\sum_(i \in A) f i)%E == finitely supported sum, see fsbigop.v

            ereal_sup E == supremum of E
            ereal_inf E == infimum of E
 ereal_supremums_neq0 S == S has a supremum
```

## Topology of extended real numbers
```
       ereal_topologicalType R == topology for extended real numbers over
                                  R, a realFieldType
      ereal_pseudoMetricType R == pseudometric space for extended reals
                                  over R where is a realFieldType; the
                                  distance between x and y is defined by
                                  `|contract x - contract y|
```

## Filters
```
                 ereal_dnbhs x == filter on extended real numbers that
                                  corresponds to the deleted neighborhood
                                  x^' if x is a real number and to
                                  predicates that are eventually true if x
                                  is +oo/-oo.
                  ereal_nbhs x == same as ereal_dnbhs where dnbhs is
                                  replaced with nbhs.
               ereal_loc_seq x == sequence that converges to x in the set
                                  of extended real numbers.
```

</div>
<br/>
<span class="gallina-kwd">Set</span><span class="vernacular"> Implicit</span><span class="vernacular"> Arguments</span>.<br/>
<span class="vernacular">Unset</span><span class="vernacular"> Strict</span><span class="vernacular"> Implicit</span>.<br/>
<span class="vernacular">Unset</span><span class="vernacular"> Printing</span><span class="vernacular"> Implicit</span><span class="vernacular"> Defensive</span>.<br/>
<br/>
<span class="vernacular">Import</span><span class="id"> Order</span>.<span class="id">TTheory</span><span class="id"> GRing</span>.<span class="id">Theory</span><span class="id"> Num</span>.<span class="id">Theory</span>.<br/>
<span class="vernacular">Import</span><span class="id"> numFieldTopology</span>.<span class="vernacular">Exports</span>.<br/>
<span class="vernacular">From</span><span class="id"> mathcomp</span><span class="vernacular"> Require</span><span class="vernacular"> Import</span><span class="id"> mathcomp_extra</span>.<br/>
<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ring_scope</span>.<br/>
<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> classical_set_scope</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> EFin_bigcup</span><span class="id"> T</span> (<span class="id">F</span><span class="id"> :</span><span class="id"> nat</span><span class="id"> -&gt;</span><span class="id"> set</span><span class="id"> T</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">EFin</span><span class="id"> @`</span> (<span class="id">\bigcup_i</span><span class="id"> F</span><span class="id"> i</span>)<span class="id"> =</span><span class="id"> \bigcup_i</span> (<span class="id">EFin</span><span class="id"> @`</span><span class="id"> F</span><span class="id"> i</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> eqEsubset;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> [_</span><span class="id"> [r</span><span class="id"> [n</span><span class="id"> _</span><span class="id"> Fnr</span><span class="id"> &lt;-]]|];</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="gallina-kwd"> exists</span><span class="id"> n</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="gallina-kwd"> exists</span><span class="id"> r</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> [n</span><span class="id"> _</span><span class="id"> [r</span><span class="id"> Fnr</span><span class="id"> &lt;-</span><span class="id"> /=]];</span><span class="gallina-kwd"> exists</span><span class="id"> r</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="gallina-kwd"> exists</span><span class="id"> n</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> EFin_setC</span><span class="id"> T</span> (<span class="id">A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">EFin</span><span class="id"> @`</span> (<span class="id">~`</span><span class="id"> A</span>)<span class="id"> =</span> (<span class="id">~`</span> (<span class="id">EFin</span><span class="id"> @`</span><span class="id"> A</span>))<span class="id"> `\`</span><span class="id"> [set</span><span class="id"> -oo;</span><span class="id"> +oo]</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> eqEsubset;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> [_</span><span class="id"> [r</span><span class="id"> Ar</span><span class="id"> &lt;-]|[r</span><span class="id"> |</span><span class="id"> |]]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> [|[]//];</span><span class="id"> apply:</span><span class="id"> contra_not</span><span class="id"> Ar</span><span class="id"> =&gt;</span><span class="id"> -[?</span><span class="id"> ?</span><span class="id"> []</span><span class="id"> &lt;-]</span>.<br/>
<span class="id">-</span><span class="id"> move=&gt;</span><span class="id"> [Ar</span><span class="id"> _];</span><span class="id"> apply/not_exists2P;</span><span class="id"> apply:</span><span class="id"> contra_not</span><span class="id"> Ar</span><span class="id"> =&gt;</span><span class="id"> h</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="gallina-kwd"> exists</span><span class="id"> r</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> have</span><span class="id"> [|//]</span><span class="id"> :=</span><span class="id"> h</span><span class="id"> r;</span><span class="id"> apply:</span><span class="id"> contrapT</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> -[_]</span><span class="id"> /not_orP[_</span><span class="id"> /=]</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> -[_]</span><span class="id"> /not_orP[/=]</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Local</span><span class="vernacular"> Close</span><span class="vernacular"> Scope</span><span class="id"> classical_set_scope</span>.<br/>
<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;\sum_ ( i '\in' A ) F&quot;</span><span class="id"> :=</span> (<span class="id">\big[+%dE/0%dE]_</span>(<span class="id">i</span><span class="id"> \in</span><span class="id"> A</span>)<span class="id"> F%dE</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">ereal_dual_scope</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;\sum_ ( i '\in' A ) F&quot;</span><span class="id"> :=</span> (<span class="id">\big[+%E/0%E]_</span>(<span class="id">i</span><span class="id"> \in</span><span class="id"> A</span>)<span class="id"> F%E</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">ereal_scope</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> ERealArith</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {R</span><span class="id"> :</span><span class="id"> numDomainType}</span>.<br/>
<span class="vernacular">Implicit</span><span class="id"> Types</span><span class="id"> x</span><span class="id"> y</span><span class="id"> z</span><span class="id"> :</span><span class="id"> \bar</span><span class="id"> R</span>.<br/>
<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> classical_set_scope</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> preimage_abse_pinfty</span><span class="id"> :</span><span class="id"> @abse</span><span class="id"> R</span><span class="id"> @^-1`</span><span class="id"> [set</span><span class="id"> +oo]</span><span class="id"> =</span><span class="id"> [set</span><span class="id"> -oo;</span><span class="id"> +oo]</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> predeqE</span><span class="id"> =&gt;</span><span class="id"> y;</span><span class="id"> split</span><span class="id"> ;</span><span class="id"> move:</span><span class="id"> y</span><span class="id"> =&gt;</span><span class="id"> [y//|</span><span class="id"> |]//=;</span><span class="id"> [right</span><span class="id"> |</span><span class="id"> left</span><span class="id"> |</span><span class="id"> case]</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> preimage_abse_ninfty</span><span class="id"> :</span> (<span class="id">@abse</span><span class="id"> R</span><span class="id"> @^-1`</span><span class="id"> [set</span><span class="id"> -oo]</span>)<span class="id">%classic</span><span class="id"> =</span><span class="id"> set0</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> predeqE</span><span class="id"> =&gt;</span><span class="id"> t;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //=;</span><span class="id"> apply/eqP</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> gt_eqF//</span> (<span class="id">lt_le_trans</span><span class="id"> _</span> (<span class="id">abse_ge0</span><span class="id"> t</span>)).<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> compreDr</span><span class="id"> T</span> (<span class="id">h</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>) (<span class="id">f</span><span class="id"> g</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">{morph</span><span class="id"> h</span><span class="id"> :</span><span class="id"> x</span><span class="id"> y</span><span class="id"> /</span> (<span class="id">x</span><span class="id"> +</span><span class="id"> y</span>)<span class="id">%R</span><span class="id"> &gt;-&gt;</span> (<span class="id">x</span><span class="id"> +</span><span class="id"> y</span>)<span class="id">%E}</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">h</span><span class="id"> \o</span> (<span class="id">f</span><span class="id"> \+</span><span class="id"> g</span>)<span class="id">%R</span><span class="id"> =</span> ((<span class="id">h</span><span class="id"> \o</span><span class="id"> f</span>)<span class="id"> \+</span> (<span class="id">h</span><span class="id"> \o</span><span class="id"> g</span>))<span class="id">%E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> mh;</span><span class="id"> apply/funext</span><span class="id"> =&gt;</span><span class="id"> t</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> mh</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> compreN</span><span class="id"> T</span> (<span class="id">h</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">{morph</span><span class="id"> h</span><span class="id"> :</span><span class="id"> x</span><span class="id"> /</span> (<span class="id">-</span><span class="id"> x</span>)<span class="id">%R</span><span class="id"> &gt;-&gt;</span> (<span class="id">-</span><span class="id"> x</span>)<span class="id">%E}</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">h</span><span class="id"> \o</span> (<span class="id">\-</span><span class="id"> f</span>)<span class="id">%R</span><span class="id"> =</span><span class="id"> \-</span> (<span class="id">h</span><span class="id"> \o</span><span class="id"> f</span>)<span class="id">%E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> mh;</span><span class="id"> apply/funext</span><span class="id"> =&gt;</span><span class="id"> t</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> mh</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> compreBr</span><span class="id"> T</span> (<span class="id">h</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>) (<span class="id">f</span><span class="id"> g</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">{morph</span><span class="id"> h</span><span class="id"> :</span><span class="id"> x</span><span class="id"> y</span><span class="id"> /</span> (<span class="id">x</span><span class="id"> -</span><span class="id"> y</span>)<span class="id">%R</span><span class="id"> &gt;-&gt;</span> (<span class="id">x</span><span class="id"> -</span><span class="id"> y</span>)<span class="id">%E}</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">h</span><span class="id"> \o</span> (<span class="id">f</span><span class="id"> \-</span><span class="id"> g</span>)<span class="id">%R</span><span class="id"> =</span> ((<span class="id">h</span><span class="id"> \o</span><span class="id"> f</span>)<span class="id"> \-</span> (<span class="id">h</span><span class="id"> \o</span><span class="id"> g</span>))<span class="id">%E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> mh;</span><span class="id"> apply/funext</span><span class="id"> =&gt;</span><span class="id"> t</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> mh</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> compre_scale</span><span class="id"> T</span> (<span class="id">h</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> R</span>)<span class="id"> k</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">{morph</span><span class="id"> h</span><span class="id"> :</span><span class="id"> x</span><span class="id"> y</span><span class="id"> /</span> (<span class="id">x</span><span class="id"> *</span><span class="id"> y</span>)<span class="id">%R</span><span class="id"> &gt;-&gt;</span> (<span class="id">x</span><span class="id"> *</span><span class="id"> y</span>)<span class="id">%E}</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">h</span><span class="id"> \o</span> (<span class="id">k</span><span class="id"> \o*</span><span class="id"> f</span>)<span class="id"> =</span> (<span class="gallina-kwd">fun</span><span class="id"> t</span><span class="id"> =&gt;</span><span class="id"> h</span><span class="id"> k</span><span class="id"> *</span><span class="id"> h</span> (<span class="id">f</span><span class="id"> t</span>))<span class="id">%E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> mf;</span><span class="id"> apply/funext</span><span class="id"> =&gt;</span><span class="id"> t</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> mf;</span><span class="id"> rewrite</span><span class="id"> muleC</span>. Qed.</div></details>
<br/>
<span class="vernacular">Local</span><span class="vernacular"> Close</span><span class="vernacular"> Scope</span><span class="id"> classical_set_scope</span>.<br/>
<br/>
<span class="vernacular">End</span><span class="id"> ERealArith</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> ERealArithTh_numDomainType</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {R</span><span class="id"> :</span><span class="id"> numDomainType}</span>.<br/>
<span class="vernacular">Implicit</span><span class="id"> Types</span> (<span class="id">x</span><span class="id"> y</span><span class="id"> z</span><span class="id"> :</span><span class="id"> \bar</span><span class="id"> R</span>) (<span class="id">r</span><span class="id"> :</span><span class="id"> R</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> range_oppe</span><span class="id"> :</span><span class="id"> range</span><span class="id"> -%E</span><span class="id"> =</span><span class="id"> [set:</span><span class="id"> \bar</span><span class="id"> R]%classic</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> apply/seteqP;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> [//|x]</span><span class="id"> _;</span><span class="gallina-kwd"> exists</span> (<span class="id">-</span><span class="id"> x</span>)<span class="id">;</span><span class="id"> rewrite</span><span class="id"> ?oppeK</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> oppe_subset</span> (<span class="id">A</span><span class="id"> B</span><span class="id"> :</span><span class="id"> set</span> (<span class="id">\bar</span><span class="id"> R</span>))<span class="id"> :</span><br/>
&nbsp;&nbsp;((<span class="id">A</span><span class="id"> `&lt;=`</span><span class="id"> B</span>)<span class="id"> &lt;-&gt;</span> (<span class="id">-%E</span><span class="id"> @`</span><span class="id"> A</span><span class="id"> `&lt;=`</span><span class="id"> -%E</span><span class="id"> @`</span><span class="id"> B</span>))<span class="id">%classic</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">split=&gt;</span><span class="id"> [AB</span><span class="id"> _</span><span class="id"> []</span><span class="id"> x</span><span class="id"> ?</span><span class="id"> &lt;-|AB</span><span class="id"> x</span><span class="id"> Ax];</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="gallina-kwd"> exists</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> AB</span>.<br/>
<span class="id">have</span><span class="id"> /AB[y</span><span class="id"> By]</span><span class="id"> :</span> ((<span class="id">-%E</span><span class="id"> @`</span><span class="id"> A</span>) (<span class="id">-</span><span class="id"> x</span>))<span class="id">%classic</span><span class="gallina-kwd"> by</span><span class="gallina-kwd"> exists</span><span class="id"> x</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> eqe_oppP</span><span class="id"> =&gt;</span><span class="id"> &lt;-</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> fsume_ge0</span> (<span class="id">I</span><span class="id"> :</span><span class="id"> choiceType</span>) (<span class="id">P</span><span class="id"> :</span><span class="id"> set</span><span class="id"> I</span>) (<span class="id">F</span><span class="id"> :</span><span class="id"> I</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">forall</span><span class="id"> i,</span><span class="id"> P</span><span class="id"> i</span><span class="id"> -&gt;</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> F</span><span class="id"> i</span>)<span class="id"> -&gt;</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> \sum_</span>(<span class="id">i</span><span class="id"> \in</span><span class="id"> P</span>)<span class="id"> F</span><span class="id"> i</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> PF;</span><span class="id"> case:</span><span class="id"> finite_supportP;</span><span class="id"> rewrite</span><span class="id"> ?big_nil//</span><span class="id"> =&gt;</span><span class="id"> X</span><span class="id"> XP</span><span class="id"> F0</span><span class="id"> _</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> big_seq_cond</span><span class="id"> big_mkcondr</span><span class="id"> sume_ge0//</span><span class="id"> =&gt;</span><span class="id"> i</span><span class="id"> /XP/PF</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> fsume_le0</span> (<span class="id">I</span><span class="id"> :</span><span class="id"> choiceType</span>) (<span class="id">P</span><span class="id"> :</span><span class="id"> set</span><span class="id"> I</span>) (<span class="id">F</span><span class="id"> :</span><span class="id"> I</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">forall</span><span class="id"> t,</span><span class="id"> P</span><span class="id"> t</span><span class="id"> -&gt;</span><span class="id"> F</span><span class="id"> t</span><span class="id"> &lt;=</span><span class="id"> 0</span>)<span class="id"> -&gt;</span><span class="id"> \sum_</span>(<span class="id">i</span><span class="id"> \in</span><span class="id"> P</span>)<span class="id"> F</span><span class="id"> i</span><span class="id"> &lt;=</span><span class="id"> 0</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> PF;</span><span class="id"> case:</span><span class="id"> finite_supportP;</span><span class="id"> rewrite</span><span class="id"> ?big_nil//</span><span class="id"> =&gt;</span><span class="id"> X</span><span class="id"> XP</span><span class="id"> F0</span><span class="id"> _</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> big_seq_cond</span><span class="id"> big_mkcondr</span><span class="id"> sume_le0//</span><span class="id"> =&gt;</span><span class="id"> i</span><span class="id"> /XP/PF</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> fsumEFin</span> (<span class="id">I</span><span class="id"> :</span><span class="id"> choiceType</span>)<span class="id"> A</span> (<span class="id">F</span><span class="id"> :</span><span class="id"> I</span><span class="id"> -&gt;</span><span class="id"> R</span>)<span class="id"> :</span><span class="id"> finite_set</span><span class="id"> A</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">\sum_</span>(<span class="id">i</span><span class="id"> \in</span><span class="id"> A</span>) (<span class="id">F</span><span class="id"> i</span>)<span class="id">%:E</span><span class="id"> =</span> (<span class="id">\sum_</span>(<span class="id">i</span><span class="id"> \in</span><span class="id"> A</span>)<span class="id"> F</span><span class="id"> i</span>)<span class="id">%:E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> fs;</span><span class="id"> rewrite</span><span class="id"> fsbig_finite//=</span><span class="id"> sumEFin</span><span class="id"> -fsbig_finite</span>. Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> ERealArithTh_numDomainType</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> ERealArithTh_realDomainType</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {R</span><span class="id"> :</span><span class="id"> realDomainType}</span>.<br/>
<span class="vernacular">Implicit</span><span class="id"> Types</span> (<span class="id">x</span><span class="id"> y</span><span class="id"> z</span><span class="id"> u</span><span class="id"> a</span><span class="id"> b</span><span class="id"> :</span><span class="id"> \bar</span><span class="id"> R</span>) (<span class="id">r</span><span class="id"> :</span><span class="id"> R</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> le_er_map_in</span> (<span class="id">A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> R</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">{in</span><span class="id"> A</span><span class="id"> &amp;,</span><span class="id"> {homo</span><span class="id"> f</span><span class="id"> :</span><span class="id"> x</span><span class="id"> y</span><span class="id"> /</span> (<span class="id">x</span><span class="id"> &lt;=</span><span class="id"> y</span>)<span class="id">%O}}</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">{in</span> (<span class="id">EFin</span><span class="id"> @`</span><span class="id"> A</span>)<span class="id">%classic</span><span class="id"> &amp;,</span><span class="id"> {homo</span><span class="id"> er_map</span><span class="id"> f</span><span class="id"> :</span><span class="id"> x</span><span class="id"> y</span><span class="id"> /</span> (<span class="id">x</span><span class="id"> &lt;=</span><span class="id"> y</span>)<span class="id">%E}}</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> h</span><span class="id"> x</span><span class="id"> y;</span><span class="id"> rewrite</span><span class="id"> !inE/=</span><span class="id"> =&gt;</span><span class="id"> -[r</span><span class="id"> Ar</span><span class="id"> &lt;-{x}]</span><span class="id"> [s</span><span class="id"> As</span><span class="id"> &lt;-{y}]</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> !lee_fin/=</span><span class="id"> =&gt;</span><span class="id"> /h;</span><span class="id"> apply;</span><span class="id"> rewrite</span><span class="id"> inE</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> fsume_gt0</span> (<span class="id">I</span><span class="id"> :</span><span class="id"> choiceType</span>) (<span class="id">P</span><span class="id"> :</span><span class="id"> set</span><span class="id"> I</span>) (<span class="id">F</span><span class="id"> :</span><span class="id"> I</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">0</span><span class="id"> &lt;</span><span class="id"> \sum_</span>(<span class="id">i</span><span class="id"> \in</span><span class="id"> P</span>)<span class="id"> F</span><span class="id"> i</span><span class="id"> -&gt;</span><span class="gallina-kwd"> exists2</span><span class="id"> i,</span><span class="id"> P</span><span class="id"> i</span><span class="id"> &amp;</span><span class="id"> 0</span><span class="id"> &lt;</span><span class="id"> F</span><span class="id"> i</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">apply:</span><span class="id"> contraPP</span><span class="id"> =&gt;</span><span class="id"> /forall2NP</span><span class="id"> xNPF;</span><span class="id"> rewrite</span><span class="id"> le_gtF//</span><span class="id"> fsume_le0//</span><span class="id"> =&gt;</span><span class="id"> i</span><span class="id"> Pi</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> case:</span> (<span class="id">xNPF</span><span class="id"> i</span>)<span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> /negP;</span><span class="id"> case:</span><span class="id"> ltP</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> fsume_lt0</span> (<span class="id">I</span><span class="id"> :</span><span class="id"> choiceType</span>) (<span class="id">P</span><span class="id"> :</span><span class="id"> set</span><span class="id"> I</span>) (<span class="id">F</span><span class="id"> :</span><span class="id"> I</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">\sum_</span>(<span class="id">i</span><span class="id"> \in</span><span class="id"> P</span>)<span class="id"> F</span><span class="id"> i</span><span class="id"> &lt;</span><span class="id"> 0</span><span class="id"> -&gt;</span><span class="gallina-kwd"> exists2</span><span class="id"> i,</span><span class="id"> P</span><span class="id"> i</span><span class="id"> &amp;</span><span class="id"> F</span><span class="id"> i</span><span class="id"> &lt;</span><span class="id"> 0</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">apply:</span><span class="id"> contraPP</span><span class="id"> =&gt;</span><span class="id"> /forall2NP</span><span class="id"> xNPF;</span><span class="id"> rewrite</span><span class="id"> le_gtF//</span><span class="id"> fsume_ge0//</span><span class="id"> =&gt;</span><span class="id"> i</span><span class="id"> Pi</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> case:</span> (<span class="id">xNPF</span><span class="id"> i</span>)<span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> /negP;</span><span class="id"> case:</span><span class="id"> ltP</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> pfsume_eq0</span> (<span class="id">I</span><span class="id"> :</span><span class="id"> choiceType</span>) (<span class="id">P</span><span class="id"> :</span><span class="id"> set</span><span class="id"> I</span>) (<span class="id">F</span><span class="id"> :</span><span class="id"> I</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">finite_set</span><span class="id"> P</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">forall</span><span class="id"> i,</span><span class="id"> P</span><span class="id"> i</span><span class="id"> -&gt;</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> F</span><span class="id"> i</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">\sum_</span>(<span class="id">i</span><span class="id"> \in</span><span class="id"> P</span>)<span class="id"> F</span><span class="id"> i</span><span class="id"> =</span><span class="id"> 0</span><span class="id"> -&gt;</span><span class="gallina-kwd"> forall</span><span class="id"> i,</span><span class="id"> P</span><span class="id"> i</span><span class="id"> -&gt;</span><span class="id"> F</span><span class="id"> i</span><span class="id"> =</span><span class="id"> 0</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> Pfin</span><span class="id"> F0</span><span class="id"> /eqP;</span><span class="id"> apply:</span><span class="id"> contraTP</span><span class="id"> =&gt;</span><span class="id"> /existsPNP[i</span><span class="id"> Pi</span><span class="id"> /eqP</span><span class="id"> Fi0]</span>.<br/>
<span class="id">rewrite</span> (<span class="id">fsbigD1</span><span class="id"> i</span>)<span class="id">//=</span><span class="id"> padde_eq0</span><span class="id"> ?F0</span><span class="id"> ?negb_and</span><span class="id"> ?Fi0//</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> fsume_ge0//</span><span class="id"> =&gt;</span><span class="id"> j</span><span class="id"> [/F0-&gt;]</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> lee_fsum_nneg_subset</span><span class="id"> [T</span><span class="id"> :</span><span class="id"> choiceType]</span><span class="id"> [A</span><span class="id"> B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T]</span><span class="id"> [f</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R]</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">finite_set</span><span class="id"> A</span><span class="id"> -&gt;</span><span class="id"> finite_set</span><span class="id"> B</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">{subset</span><span class="id"> A</span><span class="id"> &lt;=</span><span class="id"> B}</span><span class="id"> -&gt;</span><span class="id"> {in</span><span class="id"> [predD</span><span class="id"> B</span><span class="id"> &amp;</span><span class="id"> A],</span><span class="gallina-kwd"> forall</span><span class="id"> t</span><span class="id"> :</span><span class="id"> T,</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> f</span><span class="id"> t}%E</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;(<span class="id">\sum_</span>(<span class="id">t</span><span class="id"> \in</span><span class="id"> A</span>)<span class="id"> f</span><span class="id"> t</span><span class="id"> &lt;=</span><span class="id"> \sum_</span>(<span class="id">t</span><span class="id"> \in</span><span class="id"> B</span>)<span class="id"> f</span><span class="id"> t</span>)<span class="id">%E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> finA</span><span class="id"> finB</span><span class="id"> AB</span><span class="id"> f0;</span><span class="id"> rewrite</span><span class="id"> !fsbig_finite//=;</span><span class="id"> apply:</span><span class="id"> lee_sum_nneg_subfset</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply/fsubsetP;</span><span class="id"> rewrite</span><span class="id"> -fset_set_sub//;</span><span class="id"> apply/subsetP</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> t;</span><span class="id"> rewrite</span><span class="id"> !inE</span><span class="id"> !in_fset_set//</span><span class="id"> =&gt;</span><span class="id"> /f0</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> lee_fsum</span><span class="id"> [T</span><span class="id"> :</span><span class="id"> choiceType]</span> (<span class="id">I</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T</span>) (<span class="id">a</span><span class="id"> b</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">finite_set</span><span class="id"> I</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">forall</span><span class="id"> i,</span><span class="id"> I</span><span class="id"> i</span><span class="id"> -&gt;</span><span class="id"> a</span><span class="id"> i</span><span class="id"> &lt;=</span><span class="id"> b</span><span class="id"> i</span>)<span class="id">%E</span><span class="id"> -&gt;</span> (<span class="id">\sum_</span>(<span class="id">i</span><span class="id"> \in</span><span class="id"> I</span>)<span class="id"> a</span><span class="id"> i</span><span class="id"> &lt;=</span><span class="id"> \sum_</span>(<span class="id">i</span><span class="id"> \in</span><span class="id"> I</span>)<span class="id"> b</span><span class="id"> i</span>)<span class="id">%E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> finI</span><span class="id"> ab</span>.<br/>
<span class="id">rewrite</span><span class="id"> !fsbig_finite//</span><span class="id"> big_seq</span><span class="id"> [in</span><span class="id"> leRHS]big_seq</span><span class="id"> lee_sum</span><span class="id"> //</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> i;</span><span class="id"> rewrite</span><span class="id"> in_fset_set//</span><span class="id"> inE;</span><span class="id"> exact:</span><span class="id"> ab</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> ge0_mule_fsumr</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> choiceType</span>)<span class="id"> x</span> (<span class="id">F</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>) (<span class="id">P</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">forall</span><span class="id"> i</span><span class="id"> :</span><span class="id"> T,</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> F</span><span class="id"> i</span>)<span class="id"> -&gt;</span><span class="id"> x</span><span class="id"> *</span> (<span class="id">\sum_</span>(<span class="id">i</span><span class="id"> \in</span><span class="id"> P</span>)<span class="id"> F</span><span class="id"> i</span>)<span class="id"> =</span><span class="id"> \sum_</span>(<span class="id">i</span><span class="id"> \in</span><span class="id"> P</span>)<span class="id"> x</span><span class="id"> *</span><span class="id"> F</span><span class="id"> i</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> F0;</span><span class="id"> have</span><span class="id"> [-&gt;{x}|x0]</span><span class="id"> :=</span><span class="id"> eqVneq</span><span class="id"> x</span><span class="id"> 0%E</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> mul0e</span><span class="id"> big1//</span><span class="id"> =&gt;</span><span class="id"> ?</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> mul0e</span>.<br/>
<span class="id">rewrite</span><span class="id"> ge0_sume_distrr//;</span><span class="id"> apply:</span><span class="id"> eq_fbigl</span><span class="id"> =&gt;</span><span class="id"> y</span>.<br/>
<span class="id">rewrite</span><span class="id"> !unlock;</span><span class="id"> congr</span> (_<span class="id"> \in</span><span class="id"> fset_set</span><span class="id"> _</span>).<br/>
<span class="id">apply/seteqP;</span><span class="id"> rewrite</span><span class="id"> /preimage;</span><span class="id"> split=&gt;</span><span class="id"> [|]</span><span class="id"> z/=</span><span class="id"> [Pz</span><span class="id"> Fz0];</span><br/>
&nbsp;&nbsp;<span class="id">split=&gt;</span><span class="id"> //;</span><span class="id"> apply:</span><span class="id"> contra_not</span><span class="id"> Fz0</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> /eqP;</span><span class="id"> rewrite</span><span class="id"> mule_eq0</span> (<span class="id">negbTE</span><span class="id"> x0</span>)<span class="id">/=</span><span class="id"> =&gt;</span><span class="id"> /eqP</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> -&gt;;</span><span class="id"> rewrite</span><span class="id"> mule0</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> ge0_mule_fsuml</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> choiceType</span>)<span class="id"> x</span> (<span class="id">F</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>) (<span class="id">P</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">forall</span><span class="id"> i</span><span class="id"> :</span><span class="id"> T,</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> F</span><span class="id"> i</span>)<span class="id"> -&gt;</span> (<span class="id">\sum_</span>(<span class="id">i</span><span class="id"> \in</span><span class="id"> P</span>)<span class="id"> F</span><span class="id"> i</span>)<span class="id"> *</span><span class="id"> x</span><span class="id"> =</span><span class="id"> \sum_</span>(<span class="id">i</span><span class="id"> \in</span><span class="id"> P</span>)<span class="id"> F</span><span class="id"> i</span><span class="id"> *</span><span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> F0;</span><span class="id"> rewrite</span><span class="id"> muleC</span><span class="id"> ge0_mule_fsumr//</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> eq_fsbigr</span><span class="id"> =&gt;</span><span class="id"> i;</span><span class="id"> rewrite</span><span class="id"> muleC</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> ERealArithTh_realDomainType</span>.<br/>
<span class="vernacular">Arguments</span><span class="id"> lee_fsum</span><span class="id"> [R</span><span class="id"> T</span><span class="id"> I</span><span class="id"> a</span><span class="id"> b]</span>.<br/>
<br/>
<span class="vernacular">Module</span><span class="id"> DualAddTheoryNumDomain</span>.<br/>
<br/>
<span class="vernacular">Import</span><span class="id"> DualAddTheory</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> DualERealArithTh_numDomainType</span>.<br/>
<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_dual_scope</span>.<br/>
<br/>
<span class="vernacular">Context</span><span class="id"> {R</span><span class="id"> :</span><span class="id"> numDomainType}</span>.<br/>
<br/>
<span class="vernacular">Implicit</span><span class="id"> Types</span><span class="id"> x</span><span class="id"> y</span><span class="id"> z</span><span class="id"> :</span><span class="id"> \bar</span><span class="id"> R</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> finite_supportNe</span> (<span class="id">I</span><span class="id"> :</span><span class="id"> choiceType</span>) (<span class="id">P</span><span class="id"> :</span><span class="id"> set</span><span class="id"> I</span>) (<span class="id">F</span><span class="id"> :</span><span class="id"> I</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">finite_support</span><span class="id"> 0%E</span><span class="id"> P</span> (<span class="id">\-</span><span class="id"> F</span>)<span class="id">%E</span><span class="id"> =</span><span class="id"> finite_support</span><span class="id"> 0%E</span><span class="id"> P</span><span class="id"> F</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> /finite_support</span><span class="id"> !unlock;</span><span class="id"> congr</span><span class="id"> fset_set;</span><span class="id"> congr</span><span class="id"> setI</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> seteqP;</span><span class="id"> split=&gt;</span><span class="id"> x</span><span class="id"> /=</span><span class="id"> /eqP</span><span class="id"> +</span><span class="id"> /ltac:</span>(<span class="id">apply/eqP</span>)<span class="id">;</span><span class="id"> rewrite</span><span class="id"> oppe_eq0</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> dual_fsumeE</span> (<span class="id">I</span><span class="id"> :</span><span class="id"> choiceType</span>) (<span class="id">P</span><span class="id"> :</span><span class="id"> set</span><span class="id"> I</span>) (<span class="id">F</span><span class="id"> :</span><span class="id"> I</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;(<span class="id">\sum_</span>(<span class="id">i</span><span class="id"> \in</span><span class="id"> P</span>)<span class="id"> F</span><span class="id"> i</span>)<span class="id">%dE</span><span class="id"> =</span> (<span class="id">-</span> (<span class="id">\sum_</span>(<span class="id">i</span><span class="id"> \in</span><span class="id"> P</span>) (<span class="id">-</span><span class="id"> F</span><span class="id"> i</span>)))<span class="id">%E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> finite_supportNe</span>.<br/>
<span class="id">apply:</span> (<span class="id">big_ind2</span> (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> y</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> =</span><span class="id"> -</span><span class="id"> y</span>)<span class="id">%E</span>)<span class="id"> =&gt;</span><span class="id"> [|_</span><span class="id"> x</span><span class="id"> _</span><span class="id"> y</span><span class="id"> -&gt;</span><span class="id"> -&gt;|i</span><span class="id"> _]</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> oppe0</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> dual_addeE</span><span class="id"> !oppeK</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> oppeK</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> dfsume_ge0</span> (<span class="id">I</span><span class="id"> :</span><span class="id"> choiceType</span>) (<span class="id">P</span><span class="id"> :</span><span class="id"> set</span><span class="id"> I</span>) (<span class="id">F</span><span class="id"> :</span><span class="id"> I</span><span class="id"> -&gt;</span><span class="id"> \bar^d</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">forall</span><span class="id"> i,</span><span class="id"> P</span><span class="id"> i</span><span class="id"> -&gt;</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> F</span><span class="id"> i</span>)<span class="id"> -&gt;</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> \sum_</span>(<span class="id">i</span><span class="id"> \in</span><span class="id"> P</span>)<span class="id"> F</span><span class="id"> i</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> PF;</span><span class="id"> case:</span><span class="id"> finite_supportP;</span><span class="id"> rewrite</span><span class="id"> ?big_nil//</span><span class="id"> =&gt;</span><span class="id"> X</span><span class="id"> XP</span><span class="id"> F0</span><span class="id"> _</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> big_seq_cond</span><span class="id"> big_mkcondr</span><span class="id"> dsume_ge0//</span><span class="id"> =&gt;</span><span class="id"> i</span><span class="id"> /XP/PF</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> dfsume_le0</span> (<span class="id">I</span><span class="id"> :</span><span class="id"> choiceType</span>) (<span class="id">P</span><span class="id"> :</span><span class="id"> set</span><span class="id"> I</span>) (<span class="id">F</span><span class="id"> :</span><span class="id"> I</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">forall</span><span class="id"> t,</span><span class="id"> P</span><span class="id"> t</span><span class="id"> -&gt;</span><span class="id"> F</span><span class="id"> t</span><span class="id"> &lt;=</span><span class="id"> 0</span>)<span class="id"> -&gt;</span><span class="id"> \sum_</span>(<span class="id">i</span><span class="id"> \in</span><span class="id"> P</span>)<span class="id"> F</span><span class="id"> i</span><span class="id"> &lt;=</span><span class="id"> 0</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> PF;</span><span class="id"> case:</span><span class="id"> finite_supportP;</span><span class="id"> rewrite</span><span class="id"> ?big_nil//</span><span class="id"> =&gt;</span><span class="id"> X</span><span class="id"> XP</span><span class="id"> F0</span><span class="id"> _</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> big_seq_cond</span><span class="id"> big_mkcondr</span><span class="id"> dsume_le0//</span><span class="id"> =&gt;</span><span class="id"> i</span><span class="id"> /XP/PF</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> DualERealArithTh_numDomainType</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> DualERealArithTh_realDomainType</span>.<br/>
<br/>
<span class="vernacular">Import</span><span class="id"> DualAddTheory</span>.<br/>
<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_dual_scope</span>.<br/>
<br/>
<span class="vernacular">Context</span><span class="id"> {R</span><span class="id"> :</span><span class="id"> realDomainType}</span>.<br/>
<span class="vernacular">Implicit</span><span class="id"> Types</span><span class="id"> x</span><span class="id"> y</span><span class="id"> z</span><span class="id"> a</span><span class="id"> b</span><span class="id"> :</span><span class="id"> \bar^d</span><span class="id"> R</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> dfsume_gt0</span> (<span class="id">I</span><span class="id"> :</span><span class="id"> choiceType</span>) (<span class="id">P</span><span class="id"> :</span><span class="id"> set</span><span class="id"> I</span>) (<span class="id">F</span><span class="id"> :</span><span class="id"> I</span><span class="id"> -&gt;</span><span class="id"> \bar^d</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">0</span><span class="id"> &lt;</span><span class="id"> \sum_</span>(<span class="id">i</span><span class="id"> \in</span><span class="id"> P</span>)<span class="id"> F</span><span class="id"> i</span><span class="id"> -&gt;</span><span class="gallina-kwd"> exists2</span><span class="id"> i,</span><span class="id"> P</span><span class="id"> i</span><span class="id"> &amp;</span><span class="id"> 0</span><span class="id"> &lt;</span><span class="id"> F</span><span class="id"> i</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> dual_fsumeE</span><span class="id"> oppe_gt0</span><span class="id"> =&gt;</span><span class="id"> /fsume_lt0[i</span><span class="id"> Pi]</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> oppe_lt0</span><span class="id"> =&gt;</span><span class="id"> ?;</span><span class="gallina-kwd"> exists</span><span class="id"> i</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> dfsume_lt0</span> (<span class="id">I</span><span class="id"> :</span><span class="id"> choiceType</span>) (<span class="id">P</span><span class="id"> :</span><span class="id"> set</span><span class="id"> I</span>) (<span class="id">F</span><span class="id"> :</span><span class="id"> I</span><span class="id"> -&gt;</span><span class="id"> \bar^d</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">\sum_</span>(<span class="id">i</span><span class="id"> \in</span><span class="id"> P</span>)<span class="id"> F</span><span class="id"> i</span><span class="id"> &lt;</span><span class="id"> 0</span><span class="id"> -&gt;</span><span class="gallina-kwd"> exists2</span><span class="id"> i,</span><span class="id"> P</span><span class="id"> i</span><span class="id"> &amp;</span><span class="id"> F</span><span class="id"> i</span><span class="id"> &lt;</span><span class="id"> 0</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> dual_fsumeE</span><span class="id"> oppe_lt0</span><span class="id"> =&gt;</span><span class="id"> /fsume_gt0[i</span><span class="id"> Pi]</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> oppe_gt0</span><span class="id"> =&gt;</span><span class="id"> ?;</span><span class="gallina-kwd"> exists</span><span class="id"> i</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> pdfsume_eq0</span> (<span class="id">I</span><span class="id"> :</span><span class="id"> choiceType</span>) (<span class="id">P</span><span class="id"> :</span><span class="id"> set</span><span class="id"> I</span>) (<span class="id">F</span><span class="id"> :</span><span class="id"> I</span><span class="id"> -&gt;</span><span class="id"> \bar^d</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">finite_set</span><span class="id"> P</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">forall</span><span class="id"> i,</span><span class="id"> P</span><span class="id"> i</span><span class="id"> -&gt;</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> F</span><span class="id"> i</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">\sum_</span>(<span class="id">i</span><span class="id"> \in</span><span class="id"> P</span>)<span class="id"> F</span><span class="id"> i</span><span class="id"> =</span><span class="id"> 0</span><span class="id"> -&gt;</span><span class="gallina-kwd"> forall</span><span class="id"> i,</span><span class="id"> P</span><span class="id"> i</span><span class="id"> -&gt;</span><span class="id"> F</span><span class="id"> i</span><span class="id"> =</span><span class="id"> 0</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> Pfin</span><span class="id"> F0</span><span class="id"> /eqP;</span><span class="id"> apply:</span><span class="id"> contraTP</span><span class="id"> =&gt;</span><span class="id"> /existsPNP[i</span><span class="id"> Pi</span><span class="id"> /eqP</span><span class="id"> Fi0]</span>.<br/>
<span class="id">rewrite</span> (<span class="id">fsbigD1</span><span class="id"> i</span>)<span class="id">//=</span><span class="id"> pdadde_eq0</span><span class="id"> ?F0</span><span class="id"> ?negb_and</span><span class="id"> ?Fi0//</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> dfsume_ge0//</span><span class="id"> =&gt;</span><span class="id"> j</span><span class="id"> [/F0-&gt;]</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> le0_mule_dfsumr</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> choiceType</span>)<span class="id"> x</span> (<span class="id">F</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar^d</span><span class="id"> R</span>) (<span class="id">P</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">forall</span><span class="id"> i</span><span class="id"> :</span><span class="id"> T,</span><span class="id"> F</span><span class="id"> i</span><span class="id"> &lt;=</span><span class="id"> 0</span>)<span class="id"> -&gt;</span><span class="id"> x</span><span class="id"> *</span> (<span class="id">\sum_</span>(<span class="id">i</span><span class="id"> \in</span><span class="id"> P</span>)<span class="id"> F</span><span class="id"> i</span>)<span class="id"> =</span><span class="id"> \sum_</span>(<span class="id">i</span><span class="id"> \in</span><span class="id"> P</span>)<span class="id"> x</span><span class="id"> *</span><span class="id"> F</span><span class="id"> i</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> Fge0</span>.<br/>
<span class="id">rewrite</span><span class="id"> !dual_fsumeE</span><span class="id"> muleN</span><span class="id"> ge0_mule_fsumr;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> ?;</span><span class="id"> rewrite</span><span class="id"> oppe_ge0</span>.<br/>
<span class="id">rewrite</span> (<span class="id">eq_bigr</span><span class="id"> _</span> (<span class="gallina-kwd">fun</span><span class="id"> _</span><span class="id"> _</span><span class="id"> =&gt;</span><span class="id"> muleN</span><span class="id"> _</span><span class="id"> _</span>)).<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span> (<span class="id">eq_finite_support</span><span class="id"> _</span> (<span class="gallina-kwd">fun</span><span class="id"> i</span><span class="id"> _</span><span class="id"> =&gt;</span><span class="id"> muleN</span><span class="id"> _</span><span class="id"> _</span>)).<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> le0_mule_dfsuml</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> choiceType</span>)<span class="id"> x</span> (<span class="id">F</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar^d</span><span class="id"> R</span>) (<span class="id">P</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">forall</span><span class="id"> i</span><span class="id"> :</span><span class="id"> T,</span><span class="id"> F</span><span class="id"> i</span><span class="id"> &lt;=</span><span class="id"> 0</span>)<span class="id"> -&gt;</span> (<span class="id">\sum_</span>(<span class="id">i</span><span class="id"> \in</span><span class="id"> P</span>)<span class="id"> F</span><span class="id"> i</span>)<span class="id"> *</span><span class="id"> x</span><span class="id"> =</span><span class="id"> \sum_</span>(<span class="id">i</span><span class="id"> \in</span><span class="id"> P</span>)<span class="id"> F</span><span class="id"> i</span><span class="id"> *</span><span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> F0;</span><span class="id"> rewrite</span><span class="id"> muleC</span><span class="id"> le0_mule_dfsumr//</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> eq_fsbigr</span><span class="id"> =&gt;</span><span class="id"> i;</span><span class="id"> rewrite</span><span class="id"> muleC</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> DualERealArithTh_realDomainType</span>.<br/>
<br/>
<span class="vernacular">End</span><span class="id"> DualAddTheoryNumDomain</span>.<br/>
<br/>
<span class="vernacular">Module</span><span class="id"> DualAddTheory</span>.<br/>
<span class="vernacular">Export</span><span class="id"> ConstructiveDualAddTheory</span>.<br/>
<span class="vernacular">Export</span><span class="id"> DualAddTheoryNumDomain</span>.<br/>
<span class="vernacular">End</span><span class="id"> DualAddTheory</span>.<br/>
<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">R</span><span class="id"> :</span><span class="id"> numDomainType</span>)<span class="id"> :=</span><span class="id"> isPointed</span>.<span class="id">Build</span> (<span class="id">\bar</span><span class="id"> R</span>)<span class="id"> 0%E</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> funID</span><span class="id"> {aT</span><span class="id"> :</span><span class="id"> pointedType}</span> (<span class="id">D</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT</span>)<span class="id"> {R</span><span class="id"> :</span><span class="id"> numDomainType}</span><br/>
&nbsp;&nbsp;(<span class="id">f</span><span class="id"> :</span><span class="id"> aT</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id"> :</span><span class="id"> f</span><span class="id"> =</span> (<span class="id">f</span><span class="id"> \_</span><span class="id"> ~`</span><span class="id"> D</span>)<span class="id"> \+</span> (<span class="id">f</span><span class="id"> \_</span><span class="id"> D</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd">by</span><span class="id"> apply/funext</span><span class="id"> =&gt;</span><span class="id"> x;</span><span class="id"> rewrite</span><span class="id"> !patchE</span><span class="id"> in_setC;</span><span class="id"> case:</span><span class="id"> ifPn</span><span class="id"> =&gt;</span><span class="id"> [xD|/negPn</span><span class="id"> -&gt;];</span><br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> ?</span>(<span class="id">negbTE</span><span class="id"> xD</span>)<span class="id"> ?</span>(<span class="id">addr0,add0r</span>).<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Section</span><span class="id"> ereal_supremum</span>.<br/>
<span class="vernacular">Variable</span><span class="id"> R</span><span class="id"> :</span><span class="id"> realFieldType</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> classical_set_scope</span>.<br/>
<span class="vernacular">Implicit</span><span class="id"> Types</span> (<span class="id">S</span><span class="id"> :</span><span class="id"> set</span> (<span class="id">\bar</span><span class="id"> R</span>)) (<span class="id">x</span><span class="id"> y</span><span class="id"> :</span><span class="id"> \bar</span><span class="id"> R</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> uboundT</span><span class="id"> :</span><span class="id"> ubound</span><span class="id"> [set:</span><span class="id"> \bar</span><span class="id"> R]</span><span class="id"> =</span><span class="id"> [set</span><span class="id"> +oo]</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">apply/seteqP;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> /=</span><span class="id"> [x</span><span class="id"> Tx|x</span><span class="id"> -&gt;</span><span class="id"> ?];</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> leey</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply/eqP;</span><span class="id"> rewrite</span><span class="id"> eq_le</span><span class="id"> leey</span><span class="id"> /=</span><span class="id"> Tx</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> ereal_ub_pinfty</span><span class="id"> S</span><span class="id"> :</span><span class="id"> ubound</span><span class="id"> S</span><span class="id"> +oo</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> apply/ubP=&gt;</span><span class="id"> x</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> leey</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> ereal_ub_ninfty</span><span class="id"> S</span><span class="id"> :</span><span class="id"> ubound</span><span class="id"> S</span><span class="id"> -oo</span><span class="id"> -&gt;</span><span class="id"> S</span><span class="id"> =</span><span class="id"> set0</span><span class="id"> \/</span><span class="id"> S</span><span class="id"> =</span><span class="id"> [set</span><span class="id"> -oo]</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">have</span><span class="id"> [-&gt;|/set0P[x</span><span class="id"> Sx]</span><span class="id"> Snoo]</span><span class="id"> :=</span><span class="id"> eqVneq</span><span class="id"> S</span><span class="id"> set0;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> left</span>.<br/>
<span class="id">right;</span><span class="id"> rewrite</span><span class="id"> predeqE</span><span class="id"> =&gt;</span><span class="id"> y;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> [/Snoo|-&gt;{y}]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> leeNy_eq</span><span class="id"> =&gt;</span><span class="id"> /eqP</span><span class="id"> -&gt;</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> have</span><span class="id"> :=</span><span class="id"> Snoo</span><span class="id"> _</span><span class="id"> Sx;</span><span class="id"> rewrite</span><span class="id"> leeNy_eq</span><span class="id"> =&gt;</span><span class="id"> /eqP</span><span class="id"> &lt;-</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> supremumsT</span><span class="id"> :</span><span class="id"> supremums</span><span class="id"> [set:</span><span class="id"> \bar</span><span class="id"> R]</span><span class="id"> =</span><span class="id"> [set</span><span class="id"> +oo]</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> /supremums</span><span class="id"> uboundT</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply/seteqP;</span><span class="id"> split=&gt;</span><span class="id"> [x</span><span class="id"> []//|x</span><span class="id"> -&gt;</span><span class="id"> /=];</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> y</span><span class="id"> -&gt;</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> ereal_supremums_set0_ninfty</span><span class="id"> :</span><span class="id"> supremums</span> (<span class="id">@set0</span> (<span class="id">\bar</span><span class="id"> R</span>))<span class="id"> -oo</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> split;</span><span class="id"> [exact/ubP</span><span class="id"> |</span><span class="id"> apply/lbP=&gt;</span><span class="id"> y</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> leNye]</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> supremumT</span><span class="id"> :</span><span class="id"> supremum</span><span class="id"> -oo</span><span class="id"> [set:</span><span class="id"> \bar</span><span class="id"> R]</span><span class="id"> =</span><span class="id"> +oo</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> /supremum</span> (<span class="id">negbTE</span><span class="id"> setT0</span>)<span class="id"> supremumsT</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> case:</span><span class="id"> xgetP</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> /</span>(_<span class="id"> +oo</span>)<span class="id">/=</span><span class="id"> /eqP;</span><span class="id"> rewrite</span><span class="id"> eqxx</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> supremum_pinfty</span><span class="id"> S</span><span class="id"> x0</span><span class="id"> :</span><span class="id"> S</span><span class="id"> +oo</span><span class="id"> -&gt;</span><span class="id"> supremum</span><span class="id"> x0</span><span class="id"> S</span><span class="id"> =</span><span class="id"> +oo</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> Spoo;</span><span class="id"> rewrite</span><span class="id"> /supremum</span><span class="id"> ifF;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> apply/eqP</span><span class="id"> =&gt;</span><span class="id"> S0;</span><span class="id"> rewrite</span><span class="id"> S0</span><span class="gallina-kwd"> in</span><span class="id"> Spoo</span>.<br/>
<span class="id">have</span><span class="id"> sSoo</span><span class="id"> :</span><span class="id"> supremums</span><span class="id"> S</span><span class="id"> +oo</span>.<br/>
&nbsp;&nbsp;<span class="id">split;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> ereal_ub_pinfty</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> /=</span><span class="id"> y</span><span class="id"> /</span>(_<span class="id"> _</span><span class="id"> Spoo</span>)<span class="id">;</span><span class="id"> rewrite</span><span class="id"> leye_eq</span><span class="id"> =&gt;</span><span class="id"> /eqP</span><span class="id"> -&gt;</span>.<br/>
<span class="id">case:</span><span class="id"> xgetP</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> _</span><span class="id"> -&gt;</span><span class="id"> sSxget;</span><span class="id"> move:</span> (<span class="id">is_subset1_supremums</span><span class="id"> sSoo</span><span class="id"> sSxget</span>).<br/>
<span class="gallina-kwd">by</span><span class="id"> move/</span>(_<span class="id"> +oo</span>)<span class="id"> =&gt;</span><span class="id"> gSoo;</span><span class="id"> exfalso;</span><span class="id"> apply</span><span class="id"> gSoo</span><span class="id"> =&gt;</span><span class="id"> {gSoo}</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Definition</span><span class="id"> ereal_sup</span><span class="id"> S</span><span class="id"> :=</span><span class="id"> supremum</span><span class="id"> -oo</span><span class="id"> S</span>.<br/>
<br/>
<span class="vernacular">Definition</span><span class="id"> ereal_inf</span><span class="id"> S</span><span class="id"> :=</span><span class="id"> -</span><span class="id"> ereal_sup</span> (<span class="id">-%E</span><span class="id"> @`</span><span class="id"> S</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> ereal_sup0</span><span class="id"> :</span><span class="id"> ereal_sup</span><span class="id"> set0</span><span class="id"> =</span><span class="id"> -oo</span><br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id"> exact:</span><span class="id"> supremum0</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> ereal_supT</span><span class="id"> :</span><span class="id"> ereal_sup</span><span class="id"> [set:</span><span class="id"> \bar</span><span class="id"> R]</span><span class="id"> =</span><span class="id"> +oo</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> /ereal_sup/=</span><span class="id"> supremumT</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> ereal_sup1</span><span class="id"> x</span><span class="id"> :</span><span class="id"> ereal_sup</span><span class="id"> [set</span><span class="id"> x]</span><span class="id"> =</span><span class="id"> x</span><br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id"> exact:</span><span class="id"> supremum1</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> ereal_inf0</span><span class="id"> :</span><span class="id"> ereal_inf</span><span class="id"> set0</span><span class="id"> =</span><span class="id"> +oo</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> /ereal_inf</span><span class="id"> image_set0</span><span class="id"> ereal_sup0</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> ereal_infT</span><span class="id"> :</span><span class="id"> ereal_inf</span><span class="id"> [set:</span><span class="id"> \bar</span><span class="id"> R]</span><span class="id"> =</span><span class="id"> -oo</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> /ereal_inf</span><span class="id"> range_oppe/=</span><span class="id"> ereal_supT</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> ereal_inf1</span><span class="id"> x</span><span class="id"> :</span><span class="id"> ereal_inf</span><span class="id"> [set</span><span class="id"> x]</span><span class="id"> =</span><span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> /ereal_inf</span><span class="id"> image_set1</span><span class="id"> ereal_sup1</span><span class="id"> oppeK</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> ub_ereal_sup</span><span class="id"> S</span><span class="id"> M</span><span class="id"> :</span><span class="id"> ubound</span><span class="id"> S</span><span class="id"> M</span><span class="id"> -&gt;</span><span class="id"> ereal_sup</span><span class="id"> S</span><span class="id"> &lt;=</span><span class="id"> M</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> /ereal_sup</span><span class="id"> /supremum;</span><span class="id"> case:</span><span class="id"> ifPn</span><span class="id"> =&gt;</span><span class="id"> [/eqP</span><span class="id"> -&gt;|];</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> leNye</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> _</span><span class="id"> SM;</span><span class="id"> case:</span><span class="id"> xgetP</span><span class="id"> =&gt;</span><span class="id"> [_</span><span class="id"> -&gt;</span><span class="id"> [_]|</span><span class="id"> _]</span><span class="id"> /=;</span><span class="id"> [exact</span><span class="id"> |rewrite</span><span class="id"> leNye]</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> lb_ereal_inf</span><span class="id"> S</span><span class="id"> M</span><span class="id"> :</span><span class="id"> lbound</span><span class="id"> S</span><span class="id"> M</span><span class="id"> -&gt;</span><span class="id"> M</span><span class="id"> &lt;=</span><span class="id"> ereal_inf</span><span class="id"> S</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> SM;</span><span class="id"> rewrite</span><span class="id"> /ereal_inf</span><span class="id"> leeNr;</span><span class="id"> apply</span><span class="id"> ub_ereal_sup</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> [y</span><span class="id"> Sy</span><span class="id"> &lt;-{x}]</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> leeNl</span><span class="id"> oppeK;</span><span class="id"> apply</span><span class="id"> SM</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> ub_ereal_sup_adherent</span><span class="id"> S</span> (<span class="id">e</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span> (<span class="id">0</span><span class="id"> &lt;</span><span class="id"> e</span>)<span class="id">%R</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">ereal_sup</span><span class="id"> S</span><span class="id"> \is</span><span class="id"> a</span><span class="id"> fin_num</span><span class="id"> -&gt;</span><span class="gallina-kwd"> exists2</span><span class="id"> x,</span><span class="id"> S</span><span class="id"> x</span><span class="id"> &amp;</span> (<span class="id">ereal_sup</span><span class="id"> S</span><span class="id"> -</span><span class="id"> e%:E</span><span class="id"> &lt;</span><span class="id"> x</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> e0</span><span class="id"> Sr;</span><span class="id"> have</span><span class="id"> :</span><span class="id"> ~</span><span class="id"> ubound</span><span class="id"> S</span> (<span class="id">ereal_sup</span><span class="id"> S</span><span class="id"> -</span><span class="id"> e%:E</span>).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move/ub_ereal_sup;</span><span class="id"> apply/negP;</span><span class="id"> rewrite</span><span class="id"> -ltNge</span><span class="id"> lteBlDr//</span><span class="id"> lteDl//</span><span class="id"> lte_fin</span>.<br/>
<span class="id">move/asboolP;</span><span class="id"> rewrite</span><span class="id"> asbool_neg;</span><span class="id"> case/existsp_asboolPn</span><span class="id"> =&gt;</span><span class="id"> /=</span><span class="id"> x</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> not_implyE</span><span class="id"> =&gt;</span><span class="id"> -[?</span><span class="id"> ?];</span><span class="gallina-kwd"> exists</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> rewrite</span><span class="id"> ltNge;</span><span class="id"> apply/negP</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> lb_ereal_inf_adherent</span><span class="id"> S</span> (<span class="id">e</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span> (<span class="id">0</span><span class="id"> &lt;</span><span class="id"> e</span>)<span class="id">%R</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">ereal_inf</span><span class="id"> S</span><span class="id"> \is</span><span class="id"> a</span><span class="id"> fin_num</span><span class="id"> -&gt;</span><span class="gallina-kwd"> exists2</span><span class="id"> x,</span><span class="id"> S</span><span class="id"> x</span><span class="id"> &amp;</span> (<span class="id">x</span><span class="id"> &lt;</span><span class="id"> ereal_inf</span><span class="id"> S</span><span class="id"> +</span><span class="id"> e%:E</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> e0;</span><span class="id"> rewrite</span><span class="id"> fin_numN</span><span class="id"> =&gt;</span><span class="id"> /</span>(<span class="id">ub_ereal_sup_adherent</span><span class="id"> e0</span>)<span class="id">[x</span><span class="id"> []]</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> y</span><span class="id"> Sy</span><span class="id"> &lt;-;</span><span class="id"> rewrite</span><span class="id"> -lteNr</span><span class="id"> =&gt;</span><span class="id"> /lt_le_trans</span><span class="id"> ex;</span><span class="gallina-kwd"> exists</span><span class="id"> y</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> ex;</span><span class="id"> rewrite</span><span class="id"> fin_num_oppeD//</span><span class="id"> oppeK</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> ereal_sup_gt</span><span class="id"> S</span><span class="id"> x</span><span class="id"> :</span><span class="id"> x</span><span class="id"> &lt;</span><span class="id"> ereal_sup</span><span class="id"> S</span><span class="id"> -&gt;</span><span class="gallina-kwd"> exists2</span><span class="id"> y,</span><span class="id"> S</span><span class="id"> y</span><span class="id"> &amp;</span><span class="id"> x</span><span class="id"> &lt;</span><span class="id"> y</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> not_exists2P</span><span class="id"> =&gt;</span><span class="id"> +</span><span class="id"> g;</span><span class="id"> apply/negP;</span><span class="id"> rewrite</span><span class="id"> -leNgt</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> ub_ereal_sup</span><span class="id"> =&gt;</span><span class="id"> y</span><span class="id"> Sy;</span><span class="id"> move:</span> (<span class="id">g</span><span class="id"> y</span>)<span class="id"> =&gt;</span><span class="id"> [//|/negP];</span><span class="id"> rewrite</span><span class="id"> leNgt</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> ereal_inf_lt</span><span class="id"> S</span><span class="id"> x</span><span class="id"> :</span><span class="id"> ereal_inf</span><span class="id"> S</span><span class="id"> &lt;</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="gallina-kwd"> exists2</span><span class="id"> y,</span><span class="id"> S</span><span class="id"> y</span><span class="id"> &amp;</span><span class="id"> y</span><span class="id"> &lt;</span><span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> lteNl</span><span class="id"> =&gt;</span><span class="id"> /ereal_sup_gt[_</span><span class="id"> [y</span><span class="id"> Sy</span><span class="id"> &lt;-]]</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> lteNl</span><span class="id"> oppeK</span><span class="id"> =&gt;</span><span class="id"> xlty;</span><span class="gallina-kwd"> exists</span><span class="id"> y</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> ereal_supremum</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> ereal_supremum_realType</span>.<br/>
<span class="vernacular">Variable</span><span class="id"> R</span><span class="id"> :</span><span class="id"> realType</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> classical_set_scope</span>.<br/>
<span class="vernacular">Implicit</span><span class="id"> Types</span><span class="id"> S</span><span class="id"> :</span><span class="id"> set</span> (<span class="id">\bar</span><span class="id"> R</span>).<br/>
<span class="vernacular">Implicit</span><span class="id"> Types</span><span class="id"> x</span><span class="id"> :</span><span class="id"> \bar</span><span class="id"> R</span>.<br/>
<br/>
<span class="vernacular">Let</span><span class="id"> fine_def</span><span class="id"> r0</span><span class="id"> x</span><span class="id"> :</span><span class="id"> R</span><span class="id"> :=</span><span class="gallina-kwd"> if</span><span class="id"> x</span><span class="id"> is</span><span class="id"> r%:E</span><span class="gallina-kwd"> then</span><span class="id"> r</span><span class="gallina-kwd"> else</span><span class="id"> r0</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> ereal_supremums_neq0</span><span class="id"> S</span><span class="id"> :</span><span class="id"> supremums</span><span class="id"> S</span><span class="id"> !=set0</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">have</span><span class="id"> [-&gt;|Snoo]</span><span class="id"> :=</span><span class="id"> eqVneq</span><span class="id"> S</span><span class="id"> [set</span><span class="id"> -oo]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="gallina-kwd"> exists</span><span class="id"> -oo;</span><span class="id"> split;</span><span class="id"> [rewrite</span><span class="id"> ub_set1</span><span class="id"> |exact:</span><span class="id"> lb_ub_refl]</span>.<br/>
<span class="id">have</span><span class="id"> [-&gt;|S0]</span><span class="id"> :=</span><span class="id"> eqVneq</span><span class="id"> S</span><span class="id"> set0</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="gallina-kwd"> exists</span><span class="id"> -oo;</span><span class="id"> exact:</span><span class="id"> ereal_supremums_set0_ninfty</span>.<br/>
<span class="id">have</span><span class="id"> [Spoo|Spoo]</span><span class="id"> :=</span><span class="id"> pselect</span> (<span class="id">S</span><span class="id"> +oo</span>).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="gallina-kwd"> exists</span><span class="id"> +oo;</span><span class="id"> split;</span><span class="id"> [apply/ereal_ub_pinfty</span><span class="id"> |</span><span class="id"> apply/lbP</span><span class="id"> =&gt;</span><span class="id"> /=</span><span class="id"> y</span><span class="id"> /ubP;</span><span class="id"> apply]</span>.<br/>
<span class="id">have</span><span class="id"> [r</span><span class="id"> Sr]</span><span class="id"> :</span><span class="gallina-kwd"> exists</span><span class="id"> r,</span><span class="id"> S</span><span class="id"> r%:E</span>.<br/>
&nbsp;&nbsp;<span class="id">move:</span><span class="id"> S0</span><span class="id"> =&gt;</span><span class="id"> /set0P[]</span><span class="id"> [r</span><span class="id"> Sr|</span><span class="id"> //</span><span class="id"> |Snoo1];</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="gallina-kwd"> exists</span><span class="id"> r</span>.<br/>
&nbsp;&nbsp;<span class="id">apply/not_existsP</span><span class="id"> =&gt;</span><span class="id"> nS;</span><span class="id"> move/negP</span><span class="id"> :</span><span class="id"> Snoo;</span><span class="id"> apply</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply/eqP;</span><span class="id"> rewrite</span><span class="id"> predeqE</span><span class="id"> =&gt;</span><span class="id"> -[]</span><span class="id"> //</span><span class="id"> r;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> /nS</span>.<br/>
<span class="id">set</span><span class="id"> U</span><span class="id"> :=</span><span class="id"> fine_def</span><span class="id"> r</span><span class="id"> @`</span><span class="id"> S</span>.<br/>
<span class="id">have</span><span class="id"> [|]</span><span class="id"> :=</span><span class="id"> eqVneq</span> (<span class="id">ubound</span><span class="id"> U</span>)<span class="id"> set0</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -subset0</span><span class="id"> =&gt;</span><span class="id"> U0;</span><span class="gallina-kwd"> exists</span><span class="id"> +oo</span>.<br/>
&nbsp;&nbsp;<span class="id">split;</span><span class="id"> [exact/ereal_ub_pinfty</span><span class="id"> |</span><span class="id"> apply/lbP</span><span class="id"> =&gt;</span><span class="id"> /=</span><span class="id"> -[r0</span><span class="id"> /ubP</span><span class="id"> Sr0|//|]]</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> suff</span><span class="id"> :</span><span class="id"> ubound</span><span class="id"> U</span><span class="id"> r0</span><span class="gallina-kwd"> by</span><span class="id"> move/U0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply/ubP=&gt;</span><span class="id"> _</span><span class="id"> -[]</span><span class="id"> [r1</span><span class="id"> Sr1</span><span class="id"> &lt;-|//|</span><span class="id"> /=</span><span class="id"> _</span><span class="id"> &lt;-];</span><span class="id"> rewrite</span><span class="id"> -lee_fin;</span><span class="id"> apply</span><span class="id"> Sr0</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move/ereal_ub_ninfty</span><span class="id"> =&gt;</span><span class="id"> [|];</span><span class="gallina-kwd"> by</span><span class="id"> [move/eqP</span><span class="id"> :</span><span class="id"> S0|move/eqP</span><span class="id"> :</span><span class="id"> Snoo]</span>.<br/>
<span class="id">set</span><span class="id"> u</span><span class="id"> :</span><span class="id"> R</span><span class="id"> :=</span><span class="id"> sup</span><span class="id"> U</span>.<br/>
<span class="gallina-kwd">exists</span><span class="id"> u%:E;</span><span class="id"> split;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">apply/lbP=&gt;</span><span class="id"> -[r0</span><span class="id"> /ubP</span><span class="id"> Sr0|</span><span class="id"> |]</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> rewrite</span><span class="id"> lee_fin;</span><span class="id"> apply/sup_le_ub;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="gallina-kwd"> exists</span><span class="id"> r,</span><span class="id"> r%:E</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply/ubP</span><span class="id"> =&gt;</span><span class="id"> _</span><span class="id"> -[[r2</span><span class="id"> ?</span><span class="id"> &lt;-|</span><span class="id"> //</span><span class="id"> |</span><span class="id"> /=</span><span class="id"> _</span><span class="id"> &lt;-]];</span><span class="id"> rewrite</span><span class="id"> -lee_fin;</span><span class="id"> exact:</span><span class="id"> Sr0</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> leey</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move/ereal_ub_ninfty=&gt;</span><span class="id"> [|/eqP</span><span class="id"> //];</span><span class="id"> [move/eqP</span><span class="id"> :</span><span class="id"> S0|rewrite</span> (<span class="id">negbTE</span><span class="id"> Snoo</span>)<span class="id">]</span>.<br/>
<span class="id">apply/ubP</span><span class="id"> =&gt;</span><span class="id"> -[r0</span><span class="id"> Sr0|//|_];</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> leNye</span>.<br/>
<span class="id">rewrite</span><span class="id"> lee_fin</span>.<br/>
<span class="id">suff</span><span class="id"> :</span><span class="id"> has_sup</span><span class="id"> U</span><span class="gallina-kwd"> by</span><span class="id"> move/sup_upper_bound/ubP;</span><span class="id"> apply;</span><span class="gallina-kwd"> exists</span><span class="id"> r0%:E</span>.<br/>
<span class="id">split;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="gallina-kwd"> exists</span><span class="id"> r0,</span><span class="id"> r0%:E</span>.<br/>
<span class="gallina-kwd">exists</span><span class="id"> u;</span><span class="id"> apply/ubP</span><span class="id"> =&gt;</span><span class="id"> y;</span><span class="id"> move=&gt;</span><span class="id"> []</span><span class="id"> y'</span><span class="id"> Sy'</span><span class="id"> &lt;-{y}</span>.<br/>
<span class="id">have</span><span class="id"> :</span><span class="id"> has_sup</span><span class="id"> U</span><span class="gallina-kwd"> by</span><span class="id"> split;</span><span class="id"> [exists</span><span class="id"> r,</span><span class="id"> r%:E</span><span class="id"> |</span><span class="id"> exact/set0P]</span>.<br/>
<span class="id">move/sup_upper_bound/ubP;</span><span class="id"> apply</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> case:</span><span class="id"> y'</span><span class="id"> Sy'</span><span class="id"> =&gt;</span><span class="id"> [r1</span><span class="id"> /=</span><span class="id"> Sr1</span><span class="id"> |</span><span class="id"> //</span><span class="id"> |</span><span class="id"> /=</span><span class="id"> _];</span><span class="id"> [exists</span><span class="id"> r1%:E</span><span class="id"> |</span><span class="gallina-kwd"> exists</span><span class="id"> r%:E]</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> ereal_sup_ubound</span><span class="id"> S</span><span class="id"> :</span><span class="id"> ubound</span><span class="id"> S</span> (<span class="id">ereal_sup</span><span class="id"> S</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> y</span><span class="id"> Sy;</span><span class="id"> rewrite</span><span class="id"> /ereal_sup</span><span class="id"> /supremum</span><span class="id"> ifF;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply/eqP;</span><span class="id"> rewrite</span><span class="id"> predeqE</span><span class="id"> =&gt;</span><span class="id"> /</span>(_<span class="id"> y</span>)<span class="id">[+</span><span class="id"> _];</span><span class="id"> exact</span>.<br/>
<span class="id">case:</span><span class="id"> xgetP</span><span class="id"> =&gt;</span><span class="id"> /=;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> _</span><span class="id"> -&gt;</span><span class="id"> -[]</span><span class="id"> /ubP</span><span class="id"> geS</span><span class="id"> _;</span><span class="id"> apply</span><span class="id"> geS</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> case:</span> (<span class="id">ereal_supremums_neq0</span><span class="id"> S</span>)<span class="id"> =&gt;</span><span class="id"> /=</span><span class="id"> x0</span><span class="id"> Sx0;</span><span class="id"> move/</span>(_<span class="id"> x0</span>).<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> ereal_supy</span><span class="id"> S</span><span class="id"> :</span><span class="id"> S</span><span class="id"> +oo</span><span class="id"> -&gt;</span><span class="id"> ereal_sup</span><span class="id"> S</span><span class="id"> =</span><span class="id"> +oo</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> Soo;</span><span class="id"> apply/eqP;</span><span class="id"> rewrite</span><span class="id"> eq_le</span><span class="id"> leey/=;</span><span class="id"> exact:</span><span class="id"> ereal_sup_ubound</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> ereal_sup_le</span><span class="id"> S</span><span class="id"> x</span><span class="id"> :</span> (<span class="gallina-kwd">exists2</span><span class="id"> y,</span><span class="id"> S</span><span class="id"> y</span><span class="id"> &amp;</span><span class="id"> x</span><span class="id"> &lt;=</span><span class="id"> y</span>)<span class="id"> -&gt;</span><span class="id"> x</span><span class="id"> &lt;=</span><span class="id"> ereal_sup</span><span class="id"> S</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> [y</span><span class="id"> Sy]</span><span class="id"> /le_trans;</span><span class="id"> apply;</span><span class="id"> exact:</span><span class="id"> ereal_sup_ubound</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> ereal_sup_ninfty</span><span class="id"> S</span><span class="id"> :</span><span class="id"> ereal_sup</span><span class="id"> S</span><span class="id"> =</span><span class="id"> -oo</span><span class="id"> &lt;-&gt;</span><span class="id"> S</span><span class="id"> `&lt;=`</span><span class="id"> [set</span><span class="id"> -oo]</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">split</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> supS</span><span class="id"> [r</span><span class="id"> /ereal_sup_ubound|/ereal_sup_ubound|//];</span><span class="id"> rewrite</span><span class="id"> supS</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> /</span>(<span class="id">@subset_set1</span><span class="id"> _</span><span class="id"> S</span>)<span class="id"> []</span><span class="id"> -&gt;;</span><span class="id"> [exact:</span><span class="id"> ereal_sup0|exact:</span><span class="id"> ereal_sup1]</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> ereal_inf_lbound</span><span class="id"> S</span><span class="id"> :</span><span class="id"> lbound</span><span class="id"> S</span> (<span class="id">ereal_inf</span><span class="id"> S</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> Sx;</span><span class="id"> rewrite</span><span class="id"> /ereal_inf</span><span class="id"> leeNl;</span><span class="id"> apply:</span><span class="id"> ereal_sup_ubound;</span><span class="gallina-kwd"> exists</span><span class="id"> x</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> ereal_inf_le</span><span class="id"> S</span><span class="id"> x</span><span class="id"> :</span> (<span class="gallina-kwd">exists2</span><span class="id"> y,</span><span class="id"> S</span><span class="id"> y</span><span class="id"> &amp;</span><span class="id"> y</span><span class="id"> &lt;=</span><span class="id"> x</span>)<span class="id"> -&gt;</span><span class="id"> ereal_inf</span><span class="id"> S</span><span class="id"> &lt;=</span><span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> [y</span><span class="id"> Sy];</span><span class="id"> apply:</span><span class="id"> le_trans;</span><span class="id"> exact:</span><span class="id"> ereal_inf_lbound</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> ereal_inf_pinfty</span><span class="id"> S</span><span class="id"> :</span><span class="id"> ereal_inf</span><span class="id"> S</span><span class="id"> =</span><span class="id"> +oo</span><span class="id"> &lt;-&gt;</span><span class="id"> S</span><span class="id"> `&lt;=`</span><span class="id"> [set</span><span class="id"> +oo]</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id"> rewrite</span><span class="id"> eqe_oppLRP</span><span class="id"> oppe_subset</span><span class="id"> image_set1;</span><span class="id"> exact:</span><span class="id"> ereal_sup_ninfty</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> le_ereal_sup</span><span class="id"> :</span><span class="id"> {homo</span><span class="id"> @ereal_sup</span><span class="id"> R</span><span class="id"> :</span><span class="id"> A</span><span class="id"> B</span><span class="id"> /</span><span class="id"> A</span><span class="id"> `&lt;=`</span><span class="id"> B</span><span class="id"> &gt;-&gt;</span><span class="id"> A</span><span class="id"> &lt;=</span><span class="id"> B}</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> A</span><span class="id"> B</span><span class="id"> AB;</span><span class="id"> apply:</span><span class="id"> ub_ereal_sup</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> Ax;</span><span class="id"> exact/ereal_sup_ubound/AB</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> le_ereal_inf</span><span class="id"> :</span><span class="id"> {homo</span><span class="id"> @ereal_inf</span><span class="id"> R</span><span class="id"> :</span><span class="id"> A</span><span class="id"> B</span><span class="id"> /</span><span class="id"> A</span><span class="id"> `&lt;=`</span><span class="id"> B</span><span class="id"> &gt;-&gt;</span><span class="id"> B</span><span class="id"> &lt;=</span><span class="id"> A}</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> A</span><span class="id"> B</span><span class="id"> AB;</span><span class="id"> apply:</span><span class="id"> lb_ereal_inf</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> Bx;</span><span class="id"> exact/ereal_inf_lbound/AB</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> hasNub_ereal_sup</span> (<span class="id">A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> R</span>)<span class="id"> :</span><span class="id"> ~</span><span class="id"> has_ubound</span><span class="id"> A</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">A</span><span class="id"> !=set0</span><span class="id"> -&gt;</span><span class="id"> ereal_sup</span> (<span class="id">EFin</span><span class="id"> @`</span><span class="id"> A</span>)<span class="id"> =</span><span class="id"> +oo%E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> +</span><span class="id"> A0;</span><span class="id"> apply:</span><span class="id"> contra_notP</span><span class="id"> =&gt;</span><span class="id"> /eqP;</span><span class="id"> rewrite</span><span class="id"> -ltey</span><span class="id"> =&gt;</span><span class="id"> Aoo</span>.<br/>
<span class="gallina-kwd">exists</span> (<span class="id">fine</span> (<span class="id">ereal_sup</span> (<span class="id">EFin</span><span class="id"> @`</span><span class="id"> A</span>)))<span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> Ax</span>.<br/>
<span class="id">rewrite</span><span class="id"> -lee_fin</span><span class="id"> -</span>(<span class="id">@fineK</span><span class="id"> _</span><span class="id"> x%:E</span>)<span class="id">//</span><span class="id"> lee_fin</span><span class="id"> fine_le//;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> ereal_sup_ubound</span><span class="id"> =&gt;</span><span class="id"> /=;</span><span class="gallina-kwd"> exists</span><span class="id"> x</span>.<br/>
<span class="id">rewrite</span><span class="id"> fin_numE//</span><span class="id"> -ltey</span><span class="id"> Aoo</span><span class="id"> andbT</span>.<br/>
<span class="id">apply/eqP</span><span class="id"> =&gt;</span><span class="id"> /ereal_sup_ninfty/</span>(_<span class="id"> x%:E</span>).<br/>
<span class="gallina-kwd">by</span><span class="id"> have</span><span class="id"> /[swap]</span><span class="id"> /[apply]:</span> (<span class="id">EFin</span><span class="id"> @`</span><span class="id"> A</span>)<span class="id"> x%:E</span><span class="gallina-kwd"> by</span><span class="gallina-kwd"> exists</span><span class="id"> x</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> ereal_sup_EFin</span> (<span class="id">A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">has_ubound</span><span class="id"> A</span><span class="id"> -&gt;</span><span class="id"> A</span><span class="id"> !=set0</span><span class="id"> -&gt;</span><span class="id"> ereal_sup</span> (<span class="id">EFin</span><span class="id"> @`</span><span class="id"> A</span>)<span class="id"> =</span> (<span class="id">sup</span><span class="id"> A</span>)<span class="id">%:E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> has_ubA</span><span class="id"> A0;</span><span class="id"> apply/eqP;</span><span class="id"> rewrite</span><span class="id"> eq_le;</span><span class="id"> apply/andP;</span><span class="id"> split</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> ub_ereal_sup</span><span class="id"> =&gt;</span><span class="id"> /=</span><span class="id"> y</span><span class="id"> [r</span><span class="id"> Ar</span><span class="id"> &lt;-{y}];</span><span class="id"> rewrite</span><span class="id"> lee_fin</span><span class="id"> sup_ubound</span>.<br/>
<span class="id">set</span><span class="id"> esup</span><span class="id"> :=</span><span class="id"> ereal_sup</span><span class="id"> _;</span><span class="id"> have</span><span class="id"> :=</span><span class="id"> leey</span><span class="id"> esup</span>.<br/>
<span class="id">rewrite</span><span class="id"> [X</span><span class="gallina-kwd"> in</span><span class="id"> _</span><span class="id"> X]le_eqVlt</span><span class="id"> =&gt;</span><span class="id"> /predU1P[-&gt;|esupoo];</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> leey</span>.<br/>
<span class="id">have</span><span class="id"> :=</span><span class="id"> leNye</span><span class="id"> esup;</span><span class="id"> rewrite</span><span class="id"> [in</span><span class="id"> X</span><span class="gallina-kwd"> in</span><span class="id"> X</span><span class="id"> -&gt;</span><span class="id"> _]le_eqVlt</span><span class="id"> =&gt;</span><span class="id"> /predU1P[/esym|ooesup]</span>.<br/>
&nbsp;&nbsp;<span class="id">case:</span><span class="id"> A0</span><span class="id"> =&gt;</span><span class="id"> i</span><span class="id"> Ai</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> /ereal_sup_ninfty</span><span class="id"> /</span>(_<span class="id"> i%:E</span>)<span class="id"> /</span>(_ (<span class="id">ex_intro2</span><span class="id"> A</span><span class="id"> _</span><span class="id"> i</span><span class="id"> Ai</span><span class="id"> erefl</span>)).<br/>
<span class="id">have</span><span class="id"> esup_fin_num</span><span class="id"> :</span><span class="id"> esup</span><span class="id"> \is</span><span class="id"> a</span><span class="id"> fin_num</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> fin_numE</span><span class="id"> -leeNy_eq</span><span class="id"> -ltNge</span><span class="id"> ooesup</span><span class="id"> /=</span><span class="id"> -leye_eq</span><span class="id"> -ltNge</span><span class="id"> esupoo</span>.<br/>
<span class="id">rewrite</span><span class="id"> -</span>(<span class="id">@fineK</span><span class="id"> _</span><span class="id"> esup</span>)<span class="id"> //</span><span class="id"> lee_fin</span><span class="id"> leNgt</span>.<br/>
<span class="id">apply/negP</span><span class="id"> =&gt;</span><span class="id"> /</span>(<span class="id">sup_gt</span><span class="id"> A0</span>)<span class="id">[r</span><span class="id"> Ar];</span><span class="id"> apply/negP;</span><span class="id"> rewrite</span><span class="id"> -leNgt</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -lee_fin</span><span class="id"> fineK//;</span><span class="id"> apply:</span><span class="id"> ereal_sup_ubound;</span><span class="gallina-kwd"> exists</span><span class="id"> r</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> ereal_inf_EFin</span> (<span class="id">A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> R</span>)<span class="id"> :</span><span class="id"> has_lbound</span><span class="id"> A</span><span class="id"> -&gt;</span><span class="id"> A</span><span class="id"> !=set0</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">ereal_inf</span> (<span class="id">EFin</span><span class="id"> @`</span><span class="id"> A</span>)<span class="id"> =</span> (<span class="id">inf</span><span class="id"> A</span>)<span class="id">%:E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> has_lbA</span><span class="id"> A0;</span><span class="id"> rewrite</span><span class="id"> /ereal_inf</span><span class="id"> /inf</span><span class="id"> EFinN;</span><span class="id"> congr</span> (<span class="id">-</span><span class="id"> _</span>)<span class="id">%E</span>.<br/>
<span class="id">rewrite</span><span class="id"> -ereal_sup_EFin;</span><span class="id"> [|exact/has_lb_ubN|exact/nonemptyN]</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> !image_comp</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> ereal_supremum_realType</span>.<br/>
<span class="id">#[deprecated</span>(<span class="id">since=</span><span class="id">&quot;mathcomp-analysis 1.3.0&quot;</span><span class="id">,</span><span class="id"> note=</span><span class="id">&quot;Renamed `ereal_sup_ubound`.&quot;</span>)<span class="id">]</span><br/>
<span class="vernacular">Notation</span><span class="id"> ereal_sup_ub</span><span class="id"> :=</span><span class="id"> ereal_sup_ubound</span> (<span class="id">only</span><span class="id"> parsing</span>).<br/>
<span class="id">#[deprecated</span>(<span class="id">since=</span><span class="id">&quot;mathcomp-analysis 1.3.0&quot;</span><span class="id">,</span><span class="id"> note=</span><span class="id">&quot;Renamed `ereal_inf_lbound`.&quot;</span>)<span class="id">]</span><br/>
<span class="vernacular">Notation</span><span class="id"> ereal_inf_lb</span><span class="id"> :=</span><span class="id"> ereal_inf_lbound</span> (<span class="id">only</span><span class="id"> parsing</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> restrict_abse</span><span class="id"> T</span> (<span class="id">R</span><span class="id"> :</span><span class="id"> numDomainType</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>) (<span class="id">D</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;(<span class="id">abse</span><span class="id"> \o</span><span class="id"> f</span>)<span class="id"> \_</span><span class="id"> D</span><span class="id"> =</span><span class="id"> abse</span><span class="id"> \o</span> (<span class="id">f</span><span class="id"> \_</span><span class="id"> D</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd">by</span><span class="id"> apply/funext=&gt;</span><span class="id"> t;</span><span class="id"> rewrite</span><span class="id"> /restrict/=;</span><span class="id"> case:</span><span class="id"> ifPn</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> abse0</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> restrict_EFin</span><span class="id"> T</span> (<span class="id">R</span><span class="id"> :</span><span class="id"> numFieldType</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> R</span>) (<span class="id">D</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;(<span class="id">EFin</span><span class="id"> \o</span><span class="id"> f</span>)<span class="id"> \_</span><span class="id"> D</span><span class="id"> =</span><span class="id"> EFin</span><span class="id"> \o</span> (<span class="id">f</span><span class="id"> \_</span><span class="id"> D</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> apply/funext</span><span class="id"> =&gt;</span><span class="id"> x;</span><span class="id"> rewrite</span><span class="id"> /=</span><span class="id"> !patchE;</span><span class="id"> case:</span><span class="id"> ifPn</span>. Qed.</div></details>
<br/>
<span class="vernacular">Section</span><span class="id"> SignedRealFieldStability</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {R</span><span class="id"> :</span><span class="id"> realFieldType}</span>.<br/>
<br/>
<span class="vernacular">Definition</span><span class="id"> ereal_sup_reality_subdef</span> (<span class="id">xnz</span><span class="id"> :</span><span class="id"> KnownSign</span>.<span class="id">nullity</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">xr</span><span class="id"> :</span><span class="id"> KnownSign</span>.<span class="id">reality</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">if</span><span class="id"> KnownSign</span>.<span class="id">wider_reality</span><span class="id"> &lt;=0</span><span class="id"> xr</span><span class="gallina-kwd"> then</span><span class="id"> KnownSign</span>.<span class="id">Real</span><span class="id"> &lt;=0</span><br/>
&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">else</span><span class="id"> &gt;=&lt;0</span>)<span class="id">%snum_sign</span>.<br/>
<span class="vernacular">Arguments</span><span class="id"> ereal_sup_reality_subdef</span><span class="id"> /</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> ereal_sup_snum_subproof</span> (<span class="id">xnz</span><span class="id"> :</span><span class="id"> KnownSign</span>.<span class="id">nullity</span>) (<span class="id">xr</span><span class="id"> :</span><span class="id"> KnownSign</span>.<span class="id">reality</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">S</span><span class="id"> :</span><span class="id"> {compare</span> (<span class="id">0</span><span class="id"> :</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id"> &amp;</span><span class="id"> xnz</span><span class="id"> &amp;</span><span class="id"> xr}</span><span class="id"> -&gt;</span><span class="gallina-kwd"> Prop</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">r</span><span class="id"> :=</span><span class="id"> ereal_sup_reality_subdef</span><span class="id"> xnz</span><span class="id"> xr</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">Signed</span>.<span class="id">spec</span><span class="id"> 0</span><span class="id"> ?=0</span><span class="id"> r</span> (<span class="id">ereal_sup</span><span class="id"> [set</span><span class="id"> x%:num</span><span class="id"> |</span><span class="id"> x</span><span class="gallina-kwd"> in</span><span class="id"> S]%classic</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> {}/r;</span><span class="id"> move:</span><span class="id"> xr</span><span class="id"> S</span><span class="id"> =&gt;</span><span class="id"> [[[]|]|]</span><span class="id"> S</span><span class="id"> /=;</span><br/>
&nbsp;&nbsp;<span class="id">do</span><span class="id"> ?[by</span><span class="id"> apply:</span><span class="id"> ub_ereal_sup</span><span class="id"> =&gt;</span><span class="id"> _</span><span class="id"> [?</span><span class="id"> _</span><span class="id"> &lt;-]</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">|by</span><span class="id"> case:</span><span class="id"> ereal_sup</span><span class="id"> =&gt;</span><span class="id"> [s||];</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> ?leey</span><span class="id"> ?leNye//</span><span class="id"> !lee_fin</span><span class="id"> -realE</span><span class="id"> num_real]</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Canonical</span><span class="id"> ereal_sup_snum</span> (<span class="id">xnz</span><span class="id"> :</span><span class="id"> KnownSign</span>.<span class="id">nullity</span>) (<span class="id">xr</span><span class="id"> :</span><span class="id"> KnownSign</span>.<span class="id">reality</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">S</span><span class="id"> :</span><span class="id"> {compare</span> (<span class="id">0</span><span class="id"> :</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id"> &amp;</span><span class="id"> xnz</span><span class="id"> &amp;</span><span class="id"> xr}</span><span class="id"> -&gt;</span><span class="gallina-kwd"> Prop</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">Signed</span>.<span class="id">mk</span> (<span class="id">ereal_sup_snum_subproof</span><span class="id"> S</span>).<br/>
<br/>
<span class="vernacular">Definition</span><span class="id"> ereal_inf_reality_subdef</span> (<span class="id">xnz</span><span class="id"> :</span><span class="id"> KnownSign</span>.<span class="id">nullity</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">xr</span><span class="id"> :</span><span class="id"> KnownSign</span>.<span class="id">reality</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">if</span><span class="id"> KnownSign</span>.<span class="id">wider_reality</span><span class="id"> &gt;=0</span><span class="id"> xr</span><span class="gallina-kwd"> then</span><span class="id"> KnownSign</span>.<span class="id">Real</span><span class="id"> &gt;=0</span><br/>
&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">else</span><span class="id"> &gt;=&lt;0</span>)<span class="id">%snum_sign</span>.<br/>
<span class="vernacular">Arguments</span><span class="id"> ereal_inf_reality_subdef</span><span class="id"> /</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> ereal_inf_snum_subproof</span> (<span class="id">xnz</span><span class="id"> :</span><span class="id"> KnownSign</span>.<span class="id">nullity</span>) (<span class="id">xr</span><span class="id"> :</span><span class="id"> KnownSign</span>.<span class="id">reality</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">S</span><span class="id"> :</span><span class="id"> {compare</span> (<span class="id">0</span><span class="id"> :</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id"> &amp;</span><span class="id"> xnz</span><span class="id"> &amp;</span><span class="id"> xr}</span><span class="id"> -&gt;</span><span class="gallina-kwd"> Prop</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">r</span><span class="id"> :=</span><span class="id"> ereal_inf_reality_subdef</span><span class="id"> xnz</span><span class="id"> xr</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">Signed</span>.<span class="id">spec</span><span class="id"> 0</span><span class="id"> ?=0</span><span class="id"> r</span> (<span class="id">ereal_inf</span><span class="id"> [set</span><span class="id"> x%:num</span><span class="id"> |</span><span class="id"> x</span><span class="gallina-kwd"> in</span><span class="id"> S]%classic</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> {}/r;</span><span class="id"> move:</span><span class="id"> xr</span><span class="id"> S</span><span class="id"> =&gt;</span><span class="id"> [[[]|]|]</span><span class="id"> S</span><span class="id"> /=;</span><br/>
&nbsp;&nbsp;<span class="id">do</span><span class="id"> ?[by</span><span class="id"> apply:</span><span class="id"> lb_ereal_inf</span><span class="id"> =&gt;</span><span class="id"> _</span><span class="id"> [?</span><span class="id"> _</span><span class="id"> &lt;-]</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">|by</span><span class="id"> case:</span><span class="id"> ereal_inf</span><span class="id"> =&gt;</span><span class="id"> [s||];</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> ?leey</span><span class="id"> ?leNye//</span><span class="id"> !lee_fin</span><span class="id"> -realE</span><span class="id"> num_real]</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Canonical</span><span class="id"> ereal_inf_snum</span> (<span class="id">xnz</span><span class="id"> :</span><span class="id"> KnownSign</span>.<span class="id">nullity</span>) (<span class="id">xr</span><span class="id"> :</span><span class="id"> KnownSign</span>.<span class="id">reality</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">S</span><span class="id"> :</span><span class="id"> {compare</span> (<span class="id">0</span><span class="id"> :</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id"> &amp;</span><span class="id"> xnz</span><span class="id"> &amp;</span><span class="id"> xr}</span><span class="id"> -&gt;</span><span class="gallina-kwd"> Prop</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">Signed</span>.<span class="id">mk</span> (<span class="id">ereal_inf_snum_subproof</span><span class="id"> S</span>).<br/>
<br/>
<span class="vernacular">End</span><span class="id"> SignedRealFieldStability</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> ereal_nbhs</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {R</span><span class="id"> :</span><span class="id"> numFieldType}</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> classical_set_scope</span>.<br/>
<br/>
<span class="vernacular">Definition</span><span class="id"> ereal_dnbhs</span> (<span class="id">x</span><span class="id"> :</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id"> :</span><span class="id"> set_system</span> (<span class="id">\bar</span><span class="id"> R</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">[set</span><span class="id"> P</span><span class="id"> |</span><span class="gallina-kwd"> match</span><span class="id"> x</span><span class="gallina-kwd"> with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">|</span><span class="id"> r%:E</span><span class="id"> =&gt;</span><span class="id"> r^'</span> (<span class="gallina-kwd">fun</span><span class="id"> r</span><span class="id"> =&gt;</span><span class="id"> P</span><span class="id"> r%:E</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">|</span><span class="id"> +oo</span><span class="id"> =&gt;</span><span class="gallina-kwd"> exists</span><span class="id"> M,</span><span class="id"> M</span><span class="id"> \is</span><span class="id"> Num</span>.<span class="id">real</span><span class="id"> /\</span><span class="gallina-kwd"> forall</span><span class="id"> y,</span><span class="id"> M%:E</span><span class="id"> &lt;</span><span class="id"> y</span><span class="id"> -&gt;</span><span class="id"> P</span><span class="id"> y</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">|</span><span class="id"> -oo</span><span class="id"> =&gt;</span><span class="gallina-kwd"> exists</span><span class="id"> M,</span><span class="id"> M</span><span class="id"> \is</span><span class="id"> Num</span>.<span class="id">real</span><span class="id"> /\</span><span class="gallina-kwd"> forall</span><span class="id"> y,</span><span class="id"> y</span><span class="id"> &lt;</span><span class="id"> M%:E</span><span class="id"> -&gt;</span><span class="id"> P</span><span class="id"> y</span><br/>
&nbsp;&nbsp;<span class="id">end]</span>.<br/>
<span class="vernacular">Definition</span><span class="id"> ereal_nbhs</span> (<span class="id">x</span><span class="id"> :</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id"> :</span><span class="id"> set_system</span> (<span class="id">\bar</span><span class="id"> R</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">[set</span><span class="id"> P</span><span class="id"> |</span><span class="gallina-kwd"> match</span><span class="id"> x</span><span class="gallina-kwd"> with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">|</span><span class="id"> x%:E</span><span class="id"> =&gt;</span><span class="id"> nbhs</span><span class="id"> x</span> (<span class="gallina-kwd">fun</span><span class="id"> r</span><span class="id"> =&gt;</span><span class="id"> P</span><span class="id"> r%:E</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">|</span><span class="id"> +oo</span><span class="id"> =&gt;</span><span class="gallina-kwd"> exists</span><span class="id"> M,</span><span class="id"> M</span><span class="id"> \is</span><span class="id"> Num</span>.<span class="id">real</span><span class="id"> /\</span><span class="gallina-kwd"> forall</span><span class="id"> y,</span><span class="id"> M%:E</span><span class="id"> &lt;</span><span class="id"> y</span><span class="id"> -&gt;</span><span class="id"> P</span><span class="id"> y</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">|</span><span class="id"> -oo</span><span class="id"> =&gt;</span><span class="gallina-kwd"> exists</span><span class="id"> M,</span><span class="id"> M</span><span class="id"> \is</span><span class="id"> Num</span>.<span class="id">real</span><span class="id"> /\</span><span class="gallina-kwd"> forall</span><span class="id"> y,</span><span class="id"> y</span><span class="id"> &lt;</span><span class="id"> M%:E</span><span class="id"> -&gt;</span><span class="id"> P</span><span class="id"> y</span><br/>
&nbsp;&nbsp;<span class="id">end]</span>.<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> hasNbhs</span>.<span class="id">Build</span> (<span class="id">\bar</span><span class="id"> R</span>)<span class="id"> ereal_nbhs</span>.<br/>
<span class="vernacular">End</span><span class="id"> ereal_nbhs</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> ereal_nbhs_instances</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {R</span><span class="id"> :</span><span class="id"> numFieldType}</span>.<br/>
<br/>
<span class="id">Global</span><span class="vernacular"> Instance</span><span class="id"> ereal_dnbhs_filter</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">forall</span><span class="id"> x</span><span class="id"> :</span><span class="id"> \bar</span><span class="id"> R,</span><span class="id"> ProperFilter</span> (<span class="id">ereal_dnbhs</span><span class="id"> x</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">case=&gt;</span><span class="id"> [x||]</span>.<br/>
<span class="id">-</span><span class="id"> case:</span> (<span class="id">Proper_dnbhs_numFieldType</span><span class="id"> x</span>)<span class="id"> =&gt;</span><span class="id"> x0</span><span class="id"> [//=</span><span class="id"> xT</span><span class="id"> xI</span><span class="id"> xS]</span>.<br/>
&nbsp;&nbsp;<span class="id">apply</span><span class="id"> Build_ProperFilter</span><span class="id"> =&gt;</span><span class="id"> //=;</span><span class="id"> apply</span><span class="id"> Build_Filter</span><span class="id"> =&gt;</span><span class="id"> //=</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> P</span><span class="id"> Q</span><span class="id"> lP</span><span class="id"> lQ;</span><span class="id"> exact:</span><span class="id"> xI</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> P</span><span class="id"> Q</span><span class="id"> PQ</span><span class="id"> /xS;</span><span class="id"> apply</span><span class="id"> =&gt;</span><span class="id"> y</span><span class="id"> /PQ</span>.<br/>
<span class="id">-</span><span class="id"> apply</span><span class="id"> Build_ProperFilter_ex</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> P</span><span class="id"> [x</span><span class="id"> [xr</span><span class="id"> xP]]</span><span class="id"> //;</span><span class="gallina-kwd"> exists</span> (<span class="id">x</span><span class="id"> +</span><span class="id"> 1</span>)<span class="id">%:E;</span><span class="id"> apply</span><span class="id"> xP</span><span class="id"> =&gt;</span><span class="id"> /=</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> lte_fin</span><span class="id"> ltrDl</span>.<br/>
&nbsp;&nbsp;<span class="id">split=&gt;</span><span class="id"> /=</span><span class="id"> [|P</span><span class="id"> Q</span><span class="id"> [MP</span><span class="id"> [MPr</span><span class="id"> gtMP]]</span><span class="id"> [MQ</span><span class="id"> [MQr</span><span class="id"> gtMQ]]</span><span class="id"> |P</span><span class="id"> Q</span><span class="id"> sPQ</span><span class="id"> [M</span><span class="id"> [Mr</span><span class="id"> gtM]]]</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="gallina-kwd"> exists</span><span class="id"> 0%R</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="id"> have</span><span class="id"> [MP0|MP0]</span><span class="id"> :=</span><span class="id"> eqVneq</span><span class="id"> MP</span><span class="id"> 0%R</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">have</span><span class="id"> [MQ0|MQ0]</span><span class="id"> :=</span><span class="id"> eqVneq</span><span class="id"> MQ</span><span class="id"> 0%R</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="gallina-kwd"> exists</span><span class="id"> 0%R;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> x</span><span class="id"> x0;</span><span class="id"> split;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">[apply/gtMP;</span><span class="id"> rewrite</span><span class="id"> MP0</span><span class="id"> |</span><span class="id"> apply/gtMQ;</span><span class="id"> rewrite</span><span class="id"> MQ0]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">exists</span><span class="id"> `|MQ|%R;</span><span class="id"> rewrite</span><span class="id"> realE</span><span class="id"> normr_ge0;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> x</span><span class="id"> MQx;</span><span class="id"> split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> gtMP;</span><span class="id"> rewrite</span> (<span class="id">le_lt_trans</span><span class="id"> _</span><span class="id"> MQx</span>)<span class="id"> //</span><span class="id"> MP0</span><span class="id"> lee_fin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply</span><span class="id"> gtMQ;</span><span class="id"> rewrite</span> (<span class="id">le_lt_trans</span><span class="id"> _</span><span class="id"> MQx</span>)<span class="id">//</span><span class="id"> lee_fin</span><span class="id"> real_ler_normr</span><span class="id"> ?lexx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">have</span><span class="id"> [MQ0|MQ0]</span><span class="id"> :=</span><span class="id"> eqVneq</span><span class="id"> MQ</span><span class="id"> 0%R</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">exists</span><span class="id"> `|MP|%R;</span><span class="id"> rewrite</span><span class="id"> realE</span><span class="id"> normr_ge0;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> x</span><span class="id"> MPx;</span><span class="id"> split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply</span><span class="id"> gtMP;</span><span class="id"> rewrite</span> (<span class="id">le_lt_trans</span><span class="id"> _</span><span class="id"> MPx</span>)<span class="id">//</span><span class="id"> lee_fin</span><span class="id"> real_ler_normr</span><span class="id"> ?lexx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply</span><span class="id"> gtMQ;</span><span class="id"> rewrite</span> (<span class="id">le_lt_trans</span><span class="id"> _</span><span class="id"> MPx</span>)<span class="id"> //</span><span class="id"> lee_fin</span><span class="id"> MQ0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">have</span><span class="id"> {}MP0</span><span class="id"> :</span> (<span class="id">0</span><span class="id"> &lt;</span><span class="id"> `|MP|</span>)<span class="id">%R</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> normr_gt0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">have</span><span class="id"> {}MQ0</span><span class="id"> :</span> (<span class="id">0</span><span class="id"> &lt;</span><span class="id"> `|MQ|</span>)<span class="id">%R</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> normr_gt0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">exists</span> (<span class="id">Num</span>.<span class="id">max</span> (<span class="id">PosNum</span><span class="id"> MP0</span>) (<span class="id">PosNum</span><span class="id"> MQ0</span>))<span class="id">%:num</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> realE</span><span class="id"> /=</span><span class="id"> ge0</span><span class="id"> /=;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">case=&gt;</span><span class="id"> [r|</span><span class="id"> |//]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">*</span><span class="id"> rewrite</span><span class="id"> lte_fin/=</span><span class="id"> num_max</span><span class="id"> num_gt_max</span><span class="id"> /=</span><span class="id"> =&gt;</span><span class="id"> /andP[MPx</span><span class="id"> MQx];</span><span class="id"> split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply/gtMP;</span><span class="id"> rewrite</span><span class="id"> lte_fin</span> (<span class="id">le_lt_trans</span><span class="id"> _</span><span class="id"> MPx</span>)<span class="id">//</span><span class="id"> real_ler_normr</span><span class="id"> ?lexx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply/gtMQ;</span><span class="id"> rewrite</span><span class="id"> lte_fin</span> (<span class="id">le_lt_trans</span><span class="id"> _</span><span class="id"> MQx</span>)<span class="id">//</span><span class="id"> real_ler_normr</span><span class="id"> ?lexx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">*</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> _;</span><span class="id"> split;</span><span class="id"> [apply/gtMP</span><span class="id"> |</span><span class="id"> apply/gtMQ]</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="gallina-kwd"> exists</span><span class="id"> M;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> ?</span><span class="id"> /gtM</span><span class="id"> /sPQ</span>.<br/>
<span class="id">-</span><span class="id"> apply</span><span class="id"> Build_ProperFilter_ex</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="id"> move=&gt;</span><span class="id"> P</span><span class="id"> [M</span><span class="id"> [Mr</span><span class="id"> ltMP]];</span><span class="gallina-kwd"> exists</span> (<span class="id">M</span><span class="id"> -</span><span class="id"> 1</span>)<span class="id">%:E</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> ltMP;</span><span class="id"> rewrite</span><span class="id"> lte_fin</span><span class="id"> gtrDl</span><span class="id"> oppr_lt0</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="id"> split=&gt;</span><span class="id"> /=</span><span class="id"> [|P</span><span class="id"> Q</span><span class="id"> [MP</span><span class="id"> [MPr</span><span class="id"> ltMP]]</span><span class="id"> [MQ</span><span class="id"> [MQr</span><span class="id"> ltMQ]]</span><span class="id"> |P</span><span class="id"> Q</span><span class="id"> sPQ</span><span class="id"> [M</span><span class="id"> [Mr</span><span class="id"> ltM]]]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">*</span><span class="gallina-kwd"> by</span><span class="gallina-kwd"> exists</span><span class="id"> 0%R</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">*</span><span class="id"> have</span><span class="id"> [MP0|MP0]</span><span class="id"> :=</span><span class="id"> eqVneq</span><span class="id"> MP</span><span class="id"> 0%R</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">have</span><span class="id"> [MQ0|MQ0]</span><span class="id"> :=</span><span class="id"> eqVneq</span><span class="id"> MQ</span><span class="id"> 0%R</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="gallina-kwd"> exists</span><span class="id"> 0%R;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> x</span><span class="id"> x0;</span><span class="id"> split;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">[apply/ltMP;</span><span class="id"> rewrite</span><span class="id"> MP0</span><span class="id"> |</span><span class="id"> apply/ltMQ;</span><span class="id"> rewrite</span><span class="id"> MQ0]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">exists</span> (<span class="id">-</span><span class="id"> `|MQ|</span>)<span class="id">%R;</span><span class="id"> rewrite</span><span class="id"> realN</span><span class="id"> realE</span><span class="id"> normr_ge0;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> x</span><span class="id"> xMQ</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply</span><span class="id"> ltMP;</span><span class="id"> rewrite</span> (<span class="id">lt_le_trans</span><span class="id"> xMQ</span>)<span class="id">//</span><span class="id"> lee_fin</span><span class="id"> MP0</span><span class="id"> lerNl</span><span class="id"> oppr0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span><span class="id"> ltMQ;</span><span class="id"> rewrite</span> (<span class="id">lt_le_trans</span><span class="id"> xMQ</span>)<span class="id"> //</span><span class="id"> lee_fin</span><span class="id"> lerNl</span><span class="id"> -normrN</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> real_ler_normr</span><span class="id"> ?realN</span><span class="id"> //</span><span class="id"> lexx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">*</span><span class="id"> have</span><span class="id"> [MQ0|MQ0]</span><span class="id"> :=</span><span class="id"> eqVneq</span><span class="id"> MQ</span><span class="id"> 0%R</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">exists</span> (<span class="id">-</span><span class="id"> `|MP|</span>)<span class="id">%R;</span><span class="id"> rewrite</span><span class="id"> realN</span><span class="id"> realE</span><span class="id"> normr_ge0;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> x</span><span class="id"> MPx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span><span class="id"> ltMP;</span><span class="id"> rewrite</span> (<span class="id">lt_le_trans</span><span class="id"> MPx</span>)<span class="id"> //</span><span class="id"> lee_fin</span><span class="id"> lerNl</span><span class="id"> -normrN</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> real_ler_normr</span><span class="id"> ?realN</span><span class="id"> //</span><span class="id"> lexx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply</span><span class="id"> ltMQ;</span><span class="id"> rewrite</span> (<span class="id">lt_le_trans</span><span class="id"> MPx</span>)<span class="id"> //</span><span class="id"> lee_fin</span><span class="id"> MQ0</span><span class="id"> lerNl</span><span class="id"> oppr0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">have</span><span class="id"> {}MP0</span><span class="id"> :</span> (<span class="id">0</span><span class="id"> &lt;</span><span class="id"> `|MP|</span>)<span class="id">%R</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> normr_gt0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">have</span><span class="id"> {}MQ0</span><span class="id"> :</span> (<span class="id">0</span><span class="id"> &lt;</span><span class="id"> `|MQ|</span>)<span class="id">%R</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> normr_gt0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">exists</span> (<span class="id">-</span> (<span class="id">Num</span>.<span class="id">max</span> (<span class="id">PosNum</span><span class="id"> MP0</span>) (<span class="id">PosNum</span><span class="id"> MQ0</span>))<span class="id">%:num</span>)<span class="id">%R</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> realN</span><span class="id"> realE</span><span class="id"> /=</span><span class="id"> ge0</span><span class="id"> /=;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">case=&gt;</span><span class="id"> [r|//|]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="id"> rewrite</span><span class="id"> lte_fin</span><span class="id"> ltrNr</span><span class="id"> num_max</span><span class="id"> num_gt_max</span><span class="id"> =&gt;</span><span class="id"> /andP[]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> ltrNr</span><span class="id"> =&gt;</span><span class="id"> MPx;</span><span class="id"> rewrite</span><span class="id"> ltrNr</span><span class="id"> =&gt;</span><span class="id"> MQx;</span><span class="id"> split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply/ltMP;</span><span class="id"> rewrite</span><span class="id"> lte_fin</span> (<span class="id">lt_le_trans</span><span class="id"> MPx</span>)<span class="id"> //=</span><span class="id"> lerNl</span><span class="id"> -normrN</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> real_ler_normr</span><span class="id"> ?realN</span><span class="id"> //</span><span class="id"> lexx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply/ltMQ;</span><span class="id"> rewrite</span><span class="id"> lte_fin</span> (<span class="id">lt_le_trans</span><span class="id"> MQx</span>)<span class="id"> //=</span><span class="id"> lerNl</span><span class="id"> -normrN</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> real_ler_normr</span><span class="id"> ?realN</span><span class="id"> //</span><span class="id"> lexx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> _;</span><span class="id"> split;</span><span class="id"> [apply/ltMP</span><span class="id"> |</span><span class="id"> apply/ltMQ]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">*</span><span class="gallina-kwd"> by</span><span class="gallina-kwd"> exists</span><span class="id"> M;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> x</span><span class="id"> /ltM</span><span class="id"> /sPQ</span>.<br/>
Qed.</div></details>
<span class="id">Typeclasses</span><span class="vernacular"> Opaque</span><span class="id"> ereal_dnbhs</span>.<br/>
<br/>
<span class="id">Global</span><span class="vernacular"> Instance</span><span class="id"> ereal_nbhs_filter</span><span class="id"> :</span><span class="gallina-kwd"> forall</span><span class="id"> x,</span><span class="id"> ProperFilter</span> (<span class="id">@ereal_nbhs</span><span class="id"> R</span><span class="id"> x</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">case=&gt;</span><span class="id"> [r|</span><span class="id"> |]</span>.<br/>
<span class="id">-</span><span class="id"> case:</span> (<span class="id">ereal_dnbhs_filter</span><span class="id"> r%:E</span>)<span class="id"> =&gt;</span><span class="id"> r0</span><span class="id"> [//=</span><span class="id"> nrT</span><span class="id"> rI</span><span class="id"> rS]</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> Build_ProperFilter_ex</span><span class="id"> =&gt;</span><span class="id"> P</span><span class="id"> /nbhs_ballP[r2</span><span class="id"> r20</span><span class="id"> rr2]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="gallina-kwd"> exists</span><span class="id"> r%:E;</span><span class="id"> exact/rr2/ballxx</span>.<br/>
<span class="id">-</span><span class="id"> exact:</span> (<span class="id">ereal_dnbhs_filter</span><span class="id"> +oo</span>).<br/>
<span class="id">-</span><span class="id"> exact:</span> (<span class="id">ereal_dnbhs_filter</span><span class="id"> -oo</span>).<br/>
Qed.</div></details>
<span class="id">Typeclasses</span><span class="vernacular"> Opaque</span><span class="id"> ereal_nbhs</span>.<br/>
<br/>
<span class="vernacular">End</span><span class="id"> ereal_nbhs_instances</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> ereal_nbhs_infty</span>.<br/>
<span class="vernacular">Context</span> (<span class="id">R</span><span class="id"> :</span><span class="id"> numFieldType</span>).<br/>
<span class="vernacular">Implicit</span><span class="gallina-kwd"> Type</span><span class="id"> r</span><span class="id"> :</span><span class="id"> R</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> ereal_nbhs_pinfty_gt</span><span class="id"> r</span><span class="id"> :</span><span class="id"> r</span><span class="id"> \is</span><span class="id"> Num</span>.<span class="id">real</span><span class="id"> -&gt;</span><span class="id"> \forall</span><span class="id"> x</span><span class="id"> \near</span><span class="id"> +oo,</span><span class="id"> r%:E</span><span class="id"> &lt;</span><span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="gallina-kwd"> exists</span><span class="id"> r</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> ereal_nbhs_pinfty_ge</span><span class="id"> r</span><span class="id"> :</span><span class="id"> r</span><span class="id"> \is</span><span class="id"> Num</span>.<span class="id">real</span><span class="id"> -&gt;</span><span class="id"> \forall</span><span class="id"> x</span><span class="id"> \near</span><span class="id"> +oo,</span><span class="id"> r%:E</span><span class="id"> &lt;=</span><span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="gallina-kwd"> exists</span><span class="id"> r;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> apply:</span><span class="id"> ltW</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> ereal_nbhs_ninfty_lt</span><span class="id"> r</span><span class="id"> :</span><span class="id"> r</span><span class="id"> \is</span><span class="id"> Num</span>.<span class="id">real</span><span class="id"> -&gt;</span><span class="id"> \forall</span><span class="id"> x</span><span class="id"> \near</span><span class="id"> -oo,</span><span class="id"> r%:E</span><span class="id"> &gt;</span><span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="gallina-kwd"> exists</span><span class="id"> r</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> ereal_nbhs_ninfty_le</span><span class="id"> r</span><span class="id"> :</span><span class="id"> r</span><span class="id"> \is</span><span class="id"> Num</span>.<span class="id">real</span><span class="id"> -&gt;</span><span class="id"> \forall</span><span class="id"> x</span><span class="id"> \near</span><span class="id"> -oo,</span><span class="id"> r%:E</span><span class="id"> &gt;=</span><span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="gallina-kwd"> exists</span><span class="id"> r;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> ?;</span><span class="id"> apply:</span><span class="id"> ltW</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> ereal_nbhs_pinfty_real</span><span class="id"> :</span><span class="id"> \forall</span><span class="id"> x</span><span class="id"> \near</span><span class="id"> +oo,</span><span class="id"> fine</span><span class="id"> x</span><span class="id"> \is</span><span class="id"> @Num</span>.<span class="id">real</span><span class="id"> R</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">apply:</span><span class="id"> filterS</span> (<span class="id">ereal_nbhs_pinfty_gt</span> (<span class="id">@real0</span><span class="id"> _</span>))<span class="id"> =&gt;</span><span class="id"> x</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> case:</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> //=</span><span class="id"> x;</span><span class="id"> apply:</span><span class="id"> gtr0_real</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> ereal_nbhs_ninfty_real</span><span class="id"> :</span><span class="id"> \forall</span><span class="id"> x</span><span class="id"> \near</span><span class="id"> -oo,</span><span class="id"> fine</span><span class="id"> x</span><span class="id"> \is</span><span class="id"> @Num</span>.<span class="id">real</span><span class="id"> R</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">apply:</span><span class="id"> filterS</span> (<span class="id">ereal_nbhs_ninfty_lt</span> (<span class="id">@real0</span><span class="id"> _</span>))<span class="id"> =&gt;</span><span class="id"> x</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> case:</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> //=</span><span class="id"> x;</span><span class="id"> apply:</span><span class="id"> ltr0_real</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> ereal_nbhs_infty</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> ereal_topologicalType</span>.<br/>
<span class="vernacular">Variable</span><span class="id"> R</span><span class="id"> :</span><span class="id"> realFieldType</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> ereal_nbhs_singleton</span> (<span class="id">p</span><span class="id"> :</span><span class="id"> \bar</span><span class="id"> R</span>) (<span class="id">A</span><span class="id"> :</span><span class="id"> set</span> (<span class="id">\bar</span><span class="id"> R</span>))<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">ereal_nbhs</span><span class="id"> p</span><span class="id"> A</span><span class="id"> -&gt;</span><span class="id"> A</span><span class="id"> p</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move:</span><span class="id"> p</span><span class="id"> =&gt;</span><span class="id"> -[p</span><span class="id"> |</span><span class="id"> [M</span><span class="id"> [Mreal</span><span class="id"> MA]]</span><span class="id"> |</span><span class="id"> [M</span><span class="id"> [Mreal</span><span class="id"> MA]]]</span><span class="id"> /=;</span><span class="id"> [|exact:</span><span class="id"> MA</span><span class="id"> |</span><span class="id"> exact:</span><span class="id"> MA]</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> /nbhs_ballP[_/posnumP[e]];</span><span class="id"> apply;</span><span class="id"> exact/ballxx</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> ereal_nbhs_nbhs</span> (<span class="id">p</span><span class="id"> :</span><span class="id"> \bar</span><span class="id"> R</span>) (<span class="id">A</span><span class="id"> :</span><span class="id"> set</span> (<span class="id">\bar</span><span class="id"> R</span>))<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">ereal_nbhs</span><span class="id"> p</span><span class="id"> A</span><span class="id"> -&gt;</span><span class="id"> ereal_nbhs</span><span class="id"> p</span> (<span class="id">ereal_nbhs^~</span><span class="id"> A</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move:</span><span class="id"> p</span><span class="id"> =&gt;</span><span class="id"> -[p|</span><span class="id"> [M</span><span class="id"> [Mreal</span><span class="id"> MA]]</span><span class="id"> |</span><span class="id"> [M</span><span class="id"> [Mreal</span><span class="id"> MA]]]</span><span class="id"> //=</span>.<br/>
<span class="id">-</span><span class="id"> move=&gt;</span><span class="id"> /nbhs_ballP[_/posnumP[e]]</span><span class="id"> ballA</span>.<br/>
&nbsp;&nbsp;<span class="id">apply/nbhs_ballP;</span><span class="gallina-kwd"> exists</span> (<span class="id">e%:num</span><span class="id"> /</span><span class="id"> 2</span>)<span class="id"> =&gt;</span><span class="id"> //=</span><span class="id"> r</span><span class="id"> per</span>.<br/>
&nbsp;&nbsp;<span class="id">apply/nbhs_ballP;</span><span class="gallina-kwd"> exists</span> (<span class="id">e%:num</span><span class="id"> /</span><span class="id"> 2</span>)<span class="id"> =&gt;</span><span class="id"> //=</span><span class="id"> x</span><span class="id"> rex</span>.<br/>
&nbsp;&nbsp;<span class="id">apply/ballA/</span>(<span class="id">@ball_splitl</span><span class="id"> _</span><span class="id"> _</span><span class="id"> r</span>)<span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact/ball_sym</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> exists</span> (<span class="id">M</span><span class="id"> +</span><span class="id"> 1</span>)<span class="id">%R;</span><span class="id"> split;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> realD</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> -[x|</span><span class="id"> _</span><span class="id"> |_]</span><span class="id"> //=;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="gallina-kwd"> exists</span><span class="id"> M</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> lte_fin</span><span class="id"> =&gt;</span><span class="id"> M'x</span><span class="id"> /=</span>.<br/>
&nbsp;&nbsp;<span class="id">apply/nbhs_ballP;</span><span class="gallina-kwd"> exists</span><span class="id"> 1%R</span><span class="id"> =&gt;</span><span class="id"> //=</span><span class="id"> y</span><span class="id"> x1y</span>.<br/>
&nbsp;&nbsp;<span class="id">apply</span><span class="id"> MA;</span><span class="id"> rewrite</span><span class="id"> lte_fin</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> addrC</span><span class="id"> -ltrBrDl</span><span class="gallina-kwd"> in</span><span class="id"> M'x</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> (<span class="id">lt_le_trans</span><span class="id"> M'x</span>)<span class="id"> //</span><span class="id"> lerBlDl</span><span class="id"> addrC</span><span class="id"> -lerBlDl</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> (<span class="id">le_trans</span><span class="id"> _</span> (<span class="id">ltW</span><span class="id"> x1y</span>))<span class="id"> //</span><span class="id"> real_ler_norm</span><span class="id"> //</span><span class="id"> realB</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> ltrBrDr</span><span class="gallina-kwd"> in</span><span class="id"> M'x</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -comparabler0</span> (<span class="id">@comparabler_trans</span><span class="id"> _</span> (<span class="id">M</span><span class="id"> +</span><span class="id"> 1</span>)<span class="id">%R</span>)<span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /Order</span>.<span class="id">comparable</span> (<span class="id">ltW</span><span class="id"> M'x</span>)<span class="id"> orbT</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> comparabler0</span><span class="id"> realD</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> num_real</span>. <span class="comment">(*&nbsp;where&nbsp;we&nbsp;really&nbsp;use&nbsp;realFieldType&nbsp;*)</span><br/>
<span class="id">-</span><span class="gallina-kwd"> exists</span> (<span class="id">M</span><span class="id"> -</span><span class="id"> 1</span>)<span class="id">%R;</span><span class="id"> split;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> realB</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> -[x|</span><span class="id"> _</span><span class="id"> |_]</span><span class="id"> //=;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="gallina-kwd"> exists</span><span class="id"> M</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> lte_fin</span><span class="id"> =&gt;</span><span class="id"> M'x</span><span class="id"> /=</span>.<br/>
&nbsp;&nbsp;<span class="id">apply/nbhs_ballP;</span><span class="gallina-kwd"> exists</span><span class="id"> 1%R</span><span class="id"> =&gt;</span><span class="id"> //=</span><span class="id"> y</span><span class="id"> x1y</span>.<br/>
&nbsp;&nbsp;<span class="id">apply</span><span class="id"> MA;</span><span class="id"> rewrite</span><span class="id"> lte_fin</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> ltrBrDl</span><span class="gallina-kwd"> in</span><span class="id"> M'x</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> (<span class="id">le_lt_trans</span><span class="id"> _</span><span class="id"> M'x</span>)<span class="id"> //</span><span class="id"> addrC</span><span class="id"> -lerBlDl</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> (<span class="id">le_trans</span><span class="id"> _</span> (<span class="id">ltW</span><span class="id"> x1y</span>))<span class="id"> //</span><span class="id"> distrC</span><span class="id"> real_ler_norm</span><span class="id"> //</span><span class="id"> realB</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> num_real</span>. <span class="comment">(*&nbsp;where&nbsp;we&nbsp;really&nbsp;use&nbsp;realFieldType&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> addrC</span><span class="id"> -ltrBrDr</span><span class="gallina-kwd"> in</span><span class="id"> M'x</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -comparabler0</span> (<span class="id">@comparabler_trans</span><span class="id"> _</span> (<span class="id">M</span><span class="id"> -</span><span class="id"> 1</span>)<span class="id">%R</span>)<span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /Order</span>.<span class="id">comparable</span> (<span class="id">ltW</span><span class="id"> M'x</span>).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> comparabler0</span><span class="id"> realB</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> ereal_topologicalType</span>.<br/>
<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> classical_set_scope</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> nbhsNe</span> (<span class="id">R</span><span class="id"> :</span><span class="id"> realFieldType</span>) (<span class="id">x</span><span class="id"> :</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">nbhs</span> (<span class="id">-</span><span class="id"> x</span>)<span class="id"> =</span><span class="id"> [set</span> (<span class="id">-%E</span><span class="id"> @`</span><span class="id"> A</span>)<span class="id"> |</span><span class="id"> A</span><span class="gallina-kwd"> in</span><span class="id"> nbhs</span><span class="id"> x]</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">case:</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> [r</span><span class="id"> /=|</span><span class="id"> |]</span>.<br/>
<span class="id">-</span><span class="id"> rewrite</span><span class="id"> /nbhs</span><span class="id"> /=</span><span class="id"> /ereal_nbhs</span><span class="id"> -nbhs_ballE</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> predeqE</span><span class="id"> =&gt;</span><span class="id"> S;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> [[_/posnumP[e]</span><span class="id"> reS]|[S'</span><span class="id"> [_</span><span class="id"> /posnumP[e]</span><span class="id"> reS'</span><span class="id"> &lt;-]]]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">exists</span> (<span class="id">-%E</span><span class="id"> @`</span><span class="id"> S</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">exists</span><span class="id"> e%:num</span><span class="id"> =&gt;</span><span class="id"> //=</span><span class="id"> r1</span><span class="id"> rer1;</span><span class="gallina-kwd"> exists</span> (<span class="id">-</span><span class="id"> r1%:E</span>)<span class="id">;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> oppeK</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply</span><span class="id"> reS;</span><span class="id"> rewrite</span><span class="id"> /ball</span><span class="id"> /=</span><span class="id"> opprK</span><span class="id"> -normrN</span><span class="id"> opprD</span><span class="id"> opprK</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> predeqE</span><span class="id"> =&gt;</span><span class="id"> s;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> [[y</span><span class="id"> [z</span><span class="id"> Sz]</span><span class="id"> &lt;-</span><span class="id"> &lt;-]|Ss]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> oppeK</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="gallina-kwd"> exists</span> (<span class="id">-</span><span class="id"> s</span>)<span class="id">;</span><span class="id"> [exists</span><span class="id"> s</span><span class="id"> |</span><span class="id"> rewrite</span><span class="id"> oppeK]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">exists</span><span class="id"> e%:num</span><span class="id"> =&gt;</span><span class="id"> //=</span><span class="id"> r1</span><span class="id"> rer1;</span><span class="gallina-kwd"> exists</span> (<span class="id">-</span><span class="id"> r1%:E</span>)<span class="id">;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> oppeK</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply</span><span class="id"> reS';</span><span class="id"> rewrite</span><span class="id"> /ball</span><span class="id"> /=</span><span class="id"> opprK</span><span class="id"> -normrN</span><span class="id"> opprD</span>.<br/>
<span class="id">-</span><span class="id"> rewrite</span><span class="id"> predeqE</span><span class="id"> =&gt;</span><span class="id"> S;</span><span class="id"> split=&gt;</span><span class="id"> [[M</span><span class="id"> [Mreal</span><span class="id"> MS]]|[x</span><span class="id"> [M</span><span class="id"> [Mreal</span><span class="id"> Mx]]</span><span class="id"> &lt;-]]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">exists</span> (<span class="id">-%E</span><span class="id"> @`</span><span class="id"> S</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">exists</span> (<span class="id">-</span><span class="id"> M</span>)<span class="id">%R;</span><span class="id"> rewrite</span><span class="id"> realN</span><span class="id"> Mreal;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> x</span><span class="id"> Mx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="gallina-kwd"> exists</span> (<span class="id">-</span><span class="id"> x</span>)<span class="id">;</span><span class="id"> [apply</span><span class="id"> MS;</span><span class="id"> rewrite</span><span class="id"> lteNl</span><span class="id"> |</span><span class="id"> rewrite</span><span class="id"> oppeK]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> predeqE</span><span class="id"> =&gt;</span><span class="id"> x;</span><span class="id"> split=&gt;</span><span class="id"> [[y</span><span class="id"> [z</span><span class="id"> Sz</span><span class="id"> &lt;-</span><span class="id"> &lt;-]]|Sx];</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> oppeK</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="gallina-kwd"> exists</span> (<span class="id">-</span><span class="id"> x</span>)<span class="id">;</span><span class="id"> [exists</span><span class="id"> x</span><span class="id"> |</span><span class="id"> rewrite</span><span class="id"> oppeK]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">exists</span> (<span class="id">-</span><span class="id"> M</span>)<span class="id">%R;</span><span class="id"> rewrite</span><span class="id"> realN;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> y</span><span class="id"> yM</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">exists</span> (<span class="id">-</span><span class="id"> y</span>)<span class="id">;</span><span class="gallina-kwd"> by</span><span class="id"> [apply</span><span class="id"> Mx;</span><span class="id"> rewrite</span><span class="id"> lteNr|rewrite</span><span class="id"> oppeK]</span>.<br/>
<span class="id">-</span><span class="id"> rewrite</span><span class="id"> predeqE</span><span class="id"> =&gt;</span><span class="id"> S;</span><span class="id"> split=&gt;</span><span class="id"> [[M</span><span class="id"> [Mreal</span><span class="id"> MS]]|[x</span><span class="id"> [M</span><span class="id"> [Mreal</span><span class="id"> Mx]]</span><span class="id"> &lt;-]]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">exists</span> (<span class="id">-%E</span><span class="id"> @`</span><span class="id"> S</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">exists</span> (<span class="id">-</span><span class="id"> M</span>)<span class="id">%R;</span><span class="id"> rewrite</span><span class="id"> realN</span><span class="id"> Mreal;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> x</span><span class="id"> Mx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="gallina-kwd"> exists</span> (<span class="id">-</span><span class="id"> x</span>)<span class="id">;</span><span class="id"> [apply</span><span class="id"> MS;</span><span class="id"> rewrite</span><span class="id"> lteNr</span><span class="id"> |</span><span class="id"> rewrite</span><span class="id"> oppeK]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> predeqE</span><span class="id"> =&gt;</span><span class="id"> x;</span><span class="id"> split=&gt;</span><span class="id"> [[y</span><span class="id"> [z</span><span class="id"> Sz</span><span class="id"> &lt;-</span><span class="id"> &lt;-]]|Sx];</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> oppeK</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="gallina-kwd"> exists</span> (<span class="id">-</span><span class="id"> x</span>)<span class="id">;</span><span class="id"> [exists</span><span class="id"> x</span><span class="id"> |</span><span class="id"> rewrite</span><span class="id"> oppeK]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">exists</span> (<span class="id">-</span><span class="id"> M</span>)<span class="id">%R;</span><span class="id"> rewrite</span><span class="id"> realN;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> y</span><span class="id"> yM</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">exists</span> (<span class="id">-</span><span class="id"> y</span>)<span class="id">;</span><span class="gallina-kwd"> by</span><span class="id"> [apply</span><span class="id"> Mx;</span><span class="id"> rewrite</span><span class="id"> lteNl|rewrite</span><span class="id"> oppeK]</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> nbhsNKe</span> (<span class="id">R</span><span class="id"> :</span><span class="id"> realFieldType</span>) (<span class="id">z</span><span class="id"> :</span><span class="id"> \bar</span><span class="id"> R</span>) (<span class="id">A</span><span class="id"> :</span><span class="id"> set</span> (<span class="id">\bar</span><span class="id"> R</span>))<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">nbhs</span> (<span class="id">-</span><span class="id"> z</span>) (<span class="id">-%E</span><span class="id"> @`</span><span class="id"> A</span>)<span class="id"> -&gt;</span><span class="id"> nbhs</span><span class="id"> z</span><span class="id"> A</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> nbhsNe</span><span class="id"> =&gt;</span><span class="id"> -[S</span><span class="id"> zS]</span><span class="id"> SA;</span><span class="id"> rewrite</span><span class="id"> -</span>(<span class="id">oppeK</span><span class="id"> z</span>)<span class="id"> nbhsNe</span>.<br/>
<span class="gallina-kwd">exists</span> (<span class="id">-%E</span><span class="id"> @`</span><span class="id"> S</span>)<span class="id">;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> nbhsNe;</span><span class="gallina-kwd"> exists</span><span class="id"> S</span>.<br/>
<span class="id">rewrite</span><span class="id"> predeqE</span><span class="id"> =&gt;</span><span class="id"> x;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> [[y</span><span class="id"> [u</span><span class="id"> Su</span><span class="id"> &lt;-{y}</span><span class="id"> &lt;-]]|Ax]</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> oppeK</span>.<br/>
&nbsp;&nbsp;<span class="id">move:</span><span class="id"> SA;</span><span class="id"> rewrite</span><span class="id"> predeqE</span><span class="id"> =&gt;</span><span class="id"> /</span>(_ (<span class="id">-</span><span class="id"> u</span>))<span class="id"> [h</span><span class="id"> _]</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> :</span> (<span class="gallina-kwd">exists2</span><span class="id"> y,</span><span class="id"> S</span><span class="id"> y</span><span class="id"> &amp;</span><span class="id"> -</span><span class="id"> y</span><span class="id"> =</span><span class="id"> -</span><span class="id"> u</span>)<span class="gallina-kwd"> by</span><span class="gallina-kwd"> exists</span><span class="id"> u</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move/h</span><span class="id"> =&gt;</span><span class="id"> -[y</span><span class="id"> Ay]</span><span class="id"> /eqP;</span><span class="id"> rewrite</span><span class="id"> eqe_opp</span><span class="id"> =&gt;</span><span class="id"> /eqP</span><span class="id"> &lt;-</span>.<br/>
<span class="gallina-kwd">exists</span> (<span class="id">-</span><span class="id"> x</span>)<span class="id">;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> oppeK</span>.<br/>
<span class="gallina-kwd">exists</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
<span class="id">move:</span><span class="id"> SA;</span><span class="id"> rewrite</span><span class="id"> predeqE</span><span class="id"> =&gt;</span><span class="id"> /</span>(_ (<span class="id">-</span><span class="id"> x</span>))<span class="id"> [_</span><span class="id"> h]</span>.<br/>
<span class="id">have</span><span class="id"> :</span> (<span class="id">-%E</span><span class="id"> @`</span><span class="id"> A</span>) (<span class="id">-</span><span class="id"> x</span>)<span class="gallina-kwd"> by</span><span class="gallina-kwd"> exists</span><span class="id"> x</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> move/h</span><span class="id"> =&gt;</span><span class="id"> [y</span><span class="id"> Sy]</span><span class="id"> /eqP;</span><span class="id"> rewrite</span><span class="id"> eqe_opp</span><span class="id"> =&gt;</span><span class="id"> /eqP</span><span class="id"> &lt;-</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> oppe_continuous</span> (<span class="id">R</span><span class="id"> :</span><span class="id"> realFieldType</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">continuous</span> (<span class="id">-%E</span><span class="id"> :</span><span class="id"> \bar</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> x</span><span class="id"> S</span><span class="id"> /=</span><span class="id"> xS;</span><span class="id"> apply</span><span class="id"> nbhsNKe;</span><span class="id"> rewrite</span><span class="id"> image_preimage</span><span class="id"> //</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> predeqE</span><span class="id"> =&gt;</span><span class="id"> y;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> _;</span><span class="gallina-kwd"> exists</span> (<span class="id">-</span><span class="id"> y</span>)<span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> rewrite</span><span class="id"> oppeK</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Section</span><span class="id"> contract_expand</span>.<br/>
<span class="vernacular">Variable</span><span class="id"> R</span><span class="id"> :</span><span class="id"> realFieldType</span>.<br/>
<span class="vernacular">Implicit</span><span class="id"> Types</span> (<span class="id">x</span><span class="id"> :</span><span class="id"> \bar</span><span class="id"> R</span>) (<span class="id">r</span><span class="id"> :</span><span class="id"> R</span>).<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> contract_imageN</span> (<span class="id">S</span><span class="id"> :</span><span class="id"> set</span> (<span class="id">\bar</span><span class="id"> R</span>))<span class="id"> :</span><br/>
&nbsp;&nbsp;(<span class="id">@contract</span><span class="id"> R</span>)<span class="id"> @`</span> (<span class="id">-%E</span><span class="id"> @`</span><span class="id"> S</span>)<span class="id"> =</span><span class="id"> -%R</span><span class="id"> @`</span> ((<span class="id">@contract</span><span class="id"> R</span>)<span class="id"> @`</span><span class="id"> S</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> predeqE</span><span class="id"> =&gt;</span><span class="id"> r;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> [[y</span><span class="id"> [z</span><span class="id"> Sz</span><span class="id"> &lt;-{y}</span><span class="id"> &lt;-{r}]]|[s</span><span class="id"> [y</span><span class="id"> Sy</span><span class="id"> &lt;-{s}</span><span class="id"> &lt;-{r}]]]</span>.<br/>
<span class="gallina-kwd">by</span><span class="gallina-kwd"> exists</span> (<span class="id">contract</span><span class="id"> z</span>)<span class="id">;</span><span class="id"> [exists</span><span class="id"> z</span><span class="id"> |</span><span class="id"> rewrite</span><span class="id"> contractN]</span>.<br/>
<span class="gallina-kwd">by</span><span class="gallina-kwd"> exists</span> (<span class="id">-</span><span class="id"> y</span>)<span class="id">;</span><span class="id"> [exists</span><span class="id"> y</span><span class="id"> |</span><span class="id"> rewrite</span><span class="id"> contractN]</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> contractK</span><span class="id"> :</span><span class="id"> cancel</span> (<span class="id">@contract</span><span class="id"> R</span>) (<span class="id">@expand</span><span class="id"> R</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">apply:</span> (<span class="id">onS_can</span><span class="id"> [pred</span><span class="id"> r</span><span class="id"> |</span><span class="id"> `|r|</span><span class="id"> &lt;=</span><span class="id"> 1]%R</span> (<span class="id">@contract_le1</span><span class="id"> R</span>)).<br/>
<span class="id">exact:</span><span class="id"> inj_can_sym_on</span> (<span class="id">@expandK</span><span class="id"> R</span>) (<span class="id">on2W</span> (<span class="id">@contract_inj</span><span class="id"> R</span>)).<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> bijective_contract</span><span class="id"> :</span><span class="id"> {on</span><span class="id"> [pred</span><span class="id"> r</span><span class="id"> |</span><span class="id"> `|r|</span><span class="id"> &lt;=</span><span class="id"> 1]%R,</span><span class="id"> bijective</span> (<span class="id">@contract</span><span class="id"> R</span>)<span class="id">}</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> exists</span> (<span class="id">@expand</span><span class="id"> R</span>)<span class="id">;</span><span class="id"> [exact:</span><span class="id"> in1W</span><span class="id"> contractK</span><span class="id"> |</span><span class="id"> exact:</span> (<span class="id">@expandK</span><span class="id"> R</span>)<span class="id">]</span>. Qed.</div></details>
<br/>
<span class="vernacular">Definition</span><span class="id"> le_expandLR</span><span class="id"> :=</span><span class="id"> monoLR_in</span><br/>
&nbsp;&nbsp;(<span class="id">in_onW_can</span><span class="id"> _</span><span class="id"> predT</span><span class="id"> contractK</span>) (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> _</span><span class="id"> =&gt;</span><span class="id"> contract_le1</span><span class="id"> x</span>) (<span class="id">@le_expand_in</span><span class="id"> R</span>).<br/>
<span class="vernacular">Definition</span><span class="id"> lt_expandLR</span><span class="id"> :=</span><span class="id"> monoLR_in</span><br/>
&nbsp;&nbsp;(<span class="id">in_onW_can</span><span class="id"> _</span><span class="id"> predT</span><span class="id"> contractK</span>) (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> _</span><span class="id"> =&gt;</span><span class="id"> contract_le1</span><span class="id"> x</span>) (<span class="id">@lt_expand</span><span class="id"> R</span>).<br/>
<span class="vernacular">Definition</span><span class="id"> le_expandRL</span><span class="id"> :=</span><span class="id"> monoRL_in</span><br/>
&nbsp;&nbsp;(<span class="id">in_onW_can</span><span class="id"> _</span><span class="id"> predT</span><span class="id"> contractK</span>) (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> _</span><span class="id"> =&gt;</span><span class="id"> contract_le1</span><span class="id"> x</span>) (<span class="id">@le_expand_in</span><span class="id"> R</span>).<br/>
<span class="vernacular">Definition</span><span class="id"> lt_expandRL</span><span class="id"> :=</span><span class="id"> monoRL_in</span><br/>
&nbsp;&nbsp;(<span class="id">in_onW_can</span><span class="id"> _</span><span class="id"> predT</span><span class="id"> contractK</span>) (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> _</span><span class="id"> =&gt;</span><span class="id"> contract_le1</span><span class="id"> x</span>) (<span class="id">@lt_expand</span><span class="id"> R</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> contract_eq0</span><span class="id"> x</span><span class="id"> :</span> (<span class="id">contract</span><span class="id"> x</span><span class="id"> ==</span><span class="id"> 0%R</span>)<span class="id"> =</span> (<span class="id">x</span><span class="id"> ==</span><span class="id"> 0</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> -</span>(<span class="id">can_eq</span><span class="id"> contractK</span>)<span class="id"> contract0</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> contract_eqN1</span><span class="id"> x</span><span class="id"> :</span> (<span class="id">contract</span><span class="id"> x</span><span class="id"> ==</span><span class="id"> -1</span>)<span class="id"> =</span> (<span class="id">x</span><span class="id"> ==</span><span class="id"> -oo</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> -</span>(<span class="id">can_eq</span><span class="id"> contractK</span>). Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> contract_eq1</span><span class="id"> x</span><span class="id"> :</span> (<span class="id">contract</span><span class="id"> x</span><span class="id"> ==</span><span class="id"> 1%R</span>)<span class="id"> =</span> (<span class="id">x</span><span class="id"> ==</span><span class="id"> +oo</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> -</span>(<span class="id">can_eq</span><span class="id"> contractK</span>). Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> contract_expand</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> contract_expand_realType</span>.<br/>
<span class="vernacular">Variable</span><span class="id"> R</span><span class="id"> :</span><span class="id"> realType</span>.<br/>
<br/>
<span class="vernacular">Let</span><span class="id"> contract</span><span class="id"> :=</span><span class="id"> @contract</span><span class="id"> R</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> sup_contract_le1</span><span class="id"> S</span><span class="id"> :</span><span class="id"> S</span><span class="id"> !=set0</span><span class="id"> -&gt;</span> (<span class="id">`|sup</span> (<span class="id">contract</span><span class="id"> @`</span><span class="id"> S</span>)<span class="id">|</span><span class="id"> &lt;=</span><span class="id"> 1</span>)<span class="id">%R</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">case=&gt;</span><span class="id"> x</span><span class="id"> Sx;</span><span class="id"> rewrite</span><span class="id"> ler_norml;</span><span class="id"> apply/andP;</span><span class="id"> split;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">apply</span><span class="id"> sup_le_ub;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="gallina-kwd"> exists</span> (<span class="id">contract</span><span class="id"> x</span>)<span class="id">,</span><span class="id"> x</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> r</span><span class="id"> [y</span><span class="id"> Sy]</span><span class="id"> &lt;-;</span><span class="id"> case/ler_normlP</span><span class="id"> :</span> (<span class="id">contract_le1</span><span class="id"> y</span>).<br/>
<span class="id">rewrite</span> (<span class="id">@le_trans</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">contract</span><span class="id"> x</span>))<span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> case/ler_normlP</span><span class="id"> :</span> (<span class="id">contract_le1</span><span class="id"> x</span>)<span class="id">;</span><span class="id"> rewrite</span><span class="id"> lerNl</span>.<br/>
<span class="id">apply:</span><span class="id"> sup_ubound;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="gallina-kwd"> exists</span><span class="id"> x</span>.<br/>
<span class="gallina-kwd">by</span><span class="gallina-kwd"> exists</span><span class="id"> 1%R</span><span class="id"> =&gt;</span><span class="id"> r</span><span class="id"> [y</span><span class="id"> Sy</span><span class="id"> &lt;-];</span><span class="id"> case/ler_normlP</span><span class="id"> :</span> (<span class="id">contract_le1</span><span class="id"> y</span>).<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> contract_sup</span><span class="id"> S</span><span class="id"> :</span><span class="id"> S</span><span class="id"> !=set0</span><span class="id"> -&gt;</span><span class="id"> contract</span> (<span class="id">ereal_sup</span><span class="id"> S</span>)<span class="id"> =</span><span class="id"> sup</span> (<span class="id">contract</span><span class="id"> @`</span><span class="id"> S</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> S0;</span><span class="id"> apply/eqP;</span><span class="id"> rewrite</span><span class="id"> eq_le;</span><span class="id"> apply/andP;</span><span class="id"> split;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> sup_le_ub</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> case:</span><span class="id"> S0</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> Sx;</span><span class="gallina-kwd"> exists</span> (<span class="id">contract</span><span class="id"> x</span>)<span class="id">,</span><span class="id"> x</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> [y</span><span class="id"> Sy]</span><span class="id"> &lt;-{x};</span><span class="id"> rewrite</span><span class="id"> le_contract;</span><span class="id"> exact/ereal_sup_ubound</span>.<br/>
<span class="id">rewrite</span><span class="id"> leNgt;</span><span class="id"> apply/negP</span>.<br/>
<span class="id">set</span><span class="id"> supc</span><span class="id"> :=</span><span class="id"> sup</span><span class="id"> _;</span><span class="id"> set</span><span class="id"> csup</span><span class="id"> :=</span><span class="id"> contract</span><span class="id"> _;</span><span class="id"> move=&gt;</span><span class="id"> ltsup</span>.<br/>
<span class="id">suff</span><span class="id"> [y</span><span class="id"> [ysupS</span><span class="id"> ?]]</span><span class="id"> :</span><span class="gallina-kwd"> exists</span><span class="id"> y,</span><span class="id"> y</span><span class="id"> &lt;</span><span class="id"> ereal_sup</span><span class="id"> S</span><span class="id"> /\</span><span class="id"> ubound</span><span class="id"> S</span><span class="id"> y</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> :</span><span class="id"> ereal_sup</span><span class="id"> S</span><span class="id"> &lt;=</span><span class="id"> y</span><span class="gallina-kwd"> by</span><span class="id"> apply</span><span class="id"> ub_ereal_sup</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move/</span>(<span class="id">lt_le_trans</span><span class="id"> ysupS</span>)<span class="id">;</span><span class="id"> rewrite</span><span class="id"> ltxx</span>.<br/>
<span class="id">suff</span><span class="id"> [x</span><span class="id"> [?</span><span class="id"> [ubSx</span><span class="id"> x1]]]</span><span class="id"> :</span><span class="gallina-kwd"> exists</span><span class="id"> x,</span> (<span class="id">x</span><span class="id"> &lt;</span><span class="id"> csup</span>)<span class="id">%R</span><span class="id"> /\</span><span class="id"> ubound</span> (<span class="id">contract</span><span class="id"> @`</span><span class="id"> S</span>)<span class="id"> x</span><span class="id"> /\</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">`|x|</span><span class="id"> &lt;=</span><span class="id"> 1</span>)<span class="id">%R</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">exists</span> (<span class="id">expand</span><span class="id"> x</span>)<span class="id">;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> [|y</span><span class="id"> Sy]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -</span>(<span class="id">contractK</span> (<span class="id">ereal_sup</span><span class="id"> S</span>))<span class="id"> lt_expand</span><span class="id"> //</span><span class="id"> inE</span><span class="id"> //</span><span class="id"> contract_le1</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -</span>(<span class="id">contractK</span><span class="id"> y</span>)<span class="id"> le_expand</span><span class="id"> //;</span><span class="id"> apply</span><span class="id"> ubSx;</span><span class="gallina-kwd"> exists</span><span class="id"> y</span>.<br/>
<span class="gallina-kwd">exists</span> ((<span class="id">supc</span><span class="id"> +</span><span class="id"> csup</span>)<span class="id"> /</span><span class="id"> 2</span>)<span class="id">;</span><span class="id"> split;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> midf_lt</span>.<br/>
<span class="id">split</span><span class="id"> =&gt;</span><span class="id"> [r</span><span class="id"> [y</span><span class="id"> Sy</span><span class="id"> &lt;-{r}]|]</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> (<span class="id">@le_trans</span><span class="id"> _</span><span class="id"> _</span><span class="id"> supc</span>)<span class="id"> ?midf_le</span><span class="id"> //;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> ltW</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> sup_ubound;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="gallina-kwd"> exists</span><span class="id"> y</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="gallina-kwd"> exists</span><span class="id"> 1%R</span><span class="id"> =&gt;</span><span class="id"> r</span><span class="id"> [z</span><span class="id"> Sz</span><span class="id"> &lt;-];</span><span class="id"> case/ler_normlP</span><span class="id"> :</span> (<span class="id">contract_le1</span><span class="id"> z</span>).<br/>
<span class="id">rewrite</span><span class="id"> ler_norml;</span><span class="id"> apply/andP;</span><span class="id"> split;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> ler_pdivrMr</span><span class="id"> //</span><span class="id"> mul1r</span> (_<span class="id"> :</span><span class="id"> 2</span><span class="id"> =</span><span class="id"> 1</span><span class="id"> +</span><span class="id"> 1</span>)<span class="id">%R</span><span class="id"> //</span><span class="id"> lerD</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> case/ler_normlP</span><span class="id"> :</span> (<span class="id">sup_contract_le1</span><span class="id"> S0</span>).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> case/ler_normlP</span><span class="id"> :</span> (<span class="id">contract_le1</span> (<span class="id">ereal_sup</span><span class="id"> S</span>)).<br/>
<span class="id">rewrite</span><span class="id"> ler_pdivlMr</span><span class="id"> //</span> (_<span class="id"> :</span><span class="id"> 2</span><span class="id"> =</span><span class="id"> 1</span><span class="id"> +</span><span class="id"> 1</span>)<span class="id">%R</span><span class="id"> //</span><span class="id"> mulN1r</span><span class="id"> opprD</span><span class="id"> lerD</span><span class="id"> //</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> case/ler_normlP</span><span class="id"> :</span> (<span class="id">sup_contract_le1</span><span class="id"> S0</span>)<span class="id">;</span><span class="id"> rewrite</span><span class="id"> lerNl</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> case/ler_normlP</span><span class="id"> :</span> (<span class="id">contract_le1</span> (<span class="id">ereal_sup</span><span class="id"> S</span>))<span class="id">;</span><span class="id"> rewrite</span><span class="id"> lerNl</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> contract_inf</span><span class="id"> S</span><span class="id"> :</span><span class="id"> S</span><span class="id"> !=set0</span><span class="id"> -&gt;</span><span class="id"> contract</span> (<span class="id">ereal_inf</span><span class="id"> S</span>)<span class="id"> =</span><span class="id"> inf</span> (<span class="id">contract</span><span class="id"> @`</span><span class="id"> S</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> -[x</span><span class="id"> Sx];</span><span class="id"> rewrite</span><span class="id"> /ereal_inf</span><span class="id"> /contract</span> (<span class="id">contractN</span> (<span class="id">ereal_sup</span> (<span class="id">-%E</span><span class="id"> @`</span><span class="id"> S</span>))).<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -/contract</span><span class="id"> contract_sup</span><span class="id"> /inf;</span><br/>
&nbsp;&nbsp;<span class="id">[rewrite</span><span class="id"> contract_imageN|exists</span> (<span class="id">-</span><span class="id"> x</span>)<span class="id">,</span><span class="id"> x]</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> contract_expand_realType</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> ereal_PseudoMetric</span>.<br/>
<span class="vernacular">Variable</span><span class="id"> R</span><span class="id"> :</span><span class="id"> realFieldType</span>.<br/>
<span class="vernacular">Implicit</span><span class="id"> Types</span> (<span class="id">x</span><span class="id"> y</span><span class="id"> :</span><span class="id"> \bar</span><span class="id"> R</span>) (<span class="id">r</span><span class="id"> :</span><span class="id"> R</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> le_ereal_ball</span><span class="id"> x</span><span class="id"> :</span><span class="id"> {homo</span><span class="id"> ereal_ball</span><span class="id"> x</span><span class="id"> :</span><span class="id"> e</span><span class="id"> e'</span><span class="id"> /</span> (<span class="id">e</span><span class="id"> &lt;=</span><span class="id"> e'</span>)<span class="id">%R</span><span class="id"> &gt;-&gt;</span><span class="id"> e</span><span class="id"> `&lt;=`</span><span class="id"> e'}</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> e</span><span class="id"> e'</span><span class="id"> ee'</span><span class="id"> y;</span><span class="id"> rewrite</span><span class="id"> /ereal_ball</span><span class="id"> =&gt;</span><span class="id"> /lt_le_trans;</span><span class="id"> exact</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> expand_ereal_ball_pinfty</span><span class="id"> {e</span><span class="id"> :</span><span class="id"> {posnum</span><span class="id"> R}}</span><span class="id"> r</span><span class="id"> :</span> (<span class="id">e%:num</span><span class="id"> &lt;=</span><span class="id"> 1</span>)<span class="id">%R</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">expand</span> (<span class="id">1</span><span class="id"> -</span><span class="id"> e%:num</span>)<span class="id">%R</span><span class="id"> &lt;</span><span class="id"> r%:E</span><span class="id"> -&gt;</span><span class="id"> ereal_ball</span><span class="id"> +oo</span><span class="id"> e%:num</span><span class="id"> r%:E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> e1</span><span class="id"> er;</span><span class="id"> rewrite</span><span class="id"> /ereal_ball</span><span class="id"> gtr0_norm</span><span class="id"> ?subr_gt0;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> case/ltr_normlP</span><span class="id"> :</span> (<span class="id">contract_lt1</span><span class="id"> r</span>).<br/>
<span class="id">rewrite</span><span class="id"> ltrBlDl</span><span class="id"> addrC</span><span class="id"> -ltrBlDl</span><span class="id"> -[ltLHS]expandK</span><span class="id"> ?lt_contract//</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> inE</span><span class="id"> ger0_norm</span><span class="id"> ?lerBlDl</span><span class="id"> ?lerDr</span><span class="id"> //</span><span class="id"> subr_ge0</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> contract_ereal_ball_fin_le</span><span class="id"> r</span><span class="id"> r'</span> (<span class="id">e</span><span class="id"> :</span><span class="id"> {posnum</span><span class="id"> R}</span>)<span class="id"> :</span> (<span class="id">r</span><span class="id"> &lt;=</span><span class="id"> r'</span>)<span class="id">%R</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;(<span class="id">1</span><span class="id"> &lt;=</span><span class="id"> contract</span><span class="id"> r%:E</span><span class="id"> +</span><span class="id"> e%:num</span>)<span class="id">%R</span><span class="id"> -&gt;</span><span class="id"> ereal_ball</span><span class="id"> r%:E</span><span class="id"> e%:num</span><span class="id"> r'%:E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> le_eqVlt</span><span class="id"> =&gt;</span><span class="id"> /predU1P[&lt;-{r'}</span><span class="id"> _|rr'</span><span class="id"> re1];</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> ereal_ball_center</span>.<br/>
<span class="id">rewrite</span><span class="id"> /ereal_ball</span><span class="id"> ltr0_norm;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> subr_lt0</span><span class="id"> lt_contract</span><span class="id"> lte_fin</span>.<br/>
<span class="id">rewrite</span><span class="id"> opprB</span><span class="id"> ltrBlDl</span> (<span class="id">lt_le_trans</span><span class="id"> _</span><span class="id"> re1</span>)<span class="id"> //</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> case/ltr_normlP</span><span class="id"> :</span> (<span class="id">contract_lt1</span><span class="id"> r'</span>).<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> contract_ereal_ball_fin_lt</span><span class="id"> r</span><span class="id"> r'</span> (<span class="id">e</span><span class="id"> :</span><span class="id"> {posnum</span><span class="id"> R}</span>)<span class="id"> :</span> (<span class="id">r'</span><span class="id"> &lt;</span><span class="id"> r</span>)<span class="id">%R</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;(<span class="id">contract</span><span class="id"> r%:E</span><span class="id"> -</span><span class="id"> e%:num</span><span class="id"> &lt;=</span><span class="id"> -1</span>)<span class="id">%R</span> <span class="id"> -&gt;</span><span class="id"> ereal_ball</span><span class="id"> r%:E</span><span class="id"> e%:num</span><span class="id"> r'%:E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> r'r</span><span class="id"> reN1;</span><span class="id"> rewrite</span><span class="id"> /ereal_ball</span>.<br/>
<span class="id">rewrite</span><span class="id"> gtr0_norm</span><span class="id"> ?subr_gt0</span><span class="id"> ?lt_contract</span><span class="id"> ?lte_fin//</span>.<br/>
<span class="id">rewrite</span><span class="id"> ltrBlDl</span><span class="id"> addrC</span><span class="id"> -ltrBlDl</span> (<span class="id">le_lt_trans</span><span class="id"> reN1</span>)<span class="id"> //</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> move:</span> (<span class="id">contract_lt1</span><span class="id"> r'</span>)<span class="id">;</span><span class="id"> rewrite</span><span class="id"> ltr_norml</span><span class="id"> =&gt;</span><span class="id"> /andP[]</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> expand_ereal_ball_fin_lt</span><span class="id"> r'</span><span class="id"> r</span> (<span class="id">e</span><span class="id"> :</span><span class="id"> {posnum</span><span class="id"> R}</span>)<span class="id"> :</span> (<span class="id">r'</span><span class="id"> &lt;</span><span class="id"> r</span>)<span class="id">%R</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">expand</span> (<span class="id">contract</span><span class="id"> r%:E</span><span class="id"> -</span><span class="id"> e%:num</span>)<span class="id">%R</span><span class="id"> &lt;</span><span class="id"> r'%:E</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;(<span class="id">`|contract</span><span class="id"> r%:E</span><span class="id"> -</span><span class="id"> e%:num|</span><span class="id"> &lt;</span><span class="id"> 1</span>)<span class="id">%R</span><span class="id"> -&gt;</span><span class="id"> ereal_ball</span><span class="id"> r%:E</span><span class="id"> e%:num</span><span class="id"> r'%:E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> r'r</span><span class="id"> ?</span><span class="id"> r'e'r</span>.<br/>
<span class="id">rewrite</span><span class="id"> /ereal_ball</span><span class="id"> gtr0_norm</span><span class="id"> ?subr_gt0</span><span class="id"> ?lt_contract</span><span class="id"> ?lte_fin//</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> ltrBlDl</span><span class="id"> addrC</span><span class="id"> -ltrBlDl</span><span class="id"> -lt_expandLR</span><span class="id"> ?inE</span><span class="id"> ?ltW</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> ball_ereal_ball_fin_lt</span><span class="id"> r</span><span class="id"> r'</span> (<span class="id">e</span><span class="id"> :</span><span class="id"> {posnum</span><span class="id"> R}</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">let</span><span class="id"> e'</span><span class="id"> :=</span> (<span class="id">r</span><span class="id"> -</span><span class="id"> fine</span> (<span class="id">expand</span> (<span class="id">contract</span><span class="id"> r%:E</span><span class="id"> -</span><span class="id"> e%:num</span>)))<span class="id">%R</span><span class="gallina-kwd"> in</span><br/>
&nbsp;&nbsp;<span class="id">ball</span><span class="id"> r</span><span class="id"> e'</span><span class="id"> r'</span><span class="id"> -&gt;</span> (<span class="id">r'</span><span class="id"> &lt;</span><span class="id"> r</span>)<span class="id">%R</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;(<span class="id">`|contract</span><span class="id"> r%:E</span><span class="id"> -</span> (<span class="id">e</span>)<span class="id">%:num|</span><span class="id"> &lt;</span><span class="id"> 1</span>)<span class="id">%R</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">ereal_ball</span><span class="id"> r%:E</span><span class="id"> e%:num</span><span class="id"> r'%:E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> e'</span><span class="id"> re'r'</span><span class="id"> rr'</span><span class="id"> X;</span><span class="id"> rewrite</span><span class="id"> /ereal_ball</span>.<br/>
<span class="id">rewrite</span><span class="id"> gtr0_norm</span><span class="id"> ?subr_gt0//</span><span class="id"> ?lt_contract</span><span class="id"> ?lte_fin//</span>.<br/>
<span class="id">move:</span><span class="id"> re'r'</span>.<br/>
<span class="id">rewrite</span><span class="id"> /ball</span><span class="id"> /=</span><span class="id"> gtr0_norm</span><span class="id"> //</span><span class="id"> ?subr_gt0//</span><span class="id"> /e'</span>.<br/>
<span class="id">rewrite</span><span class="id"> -ltrBlDl</span><span class="id"> addrAC</span><span class="id"> subrr</span><span class="id"> add0r</span><span class="id"> ltrNl</span><span class="id"> opprK</span><span class="id"> -lte_fin</span>.<br/>
<span class="id">rewrite</span><span class="id"> fine_expand</span><span class="id"> //</span><span class="id"> lt_expandLR</span><span class="id"> ?inE</span><span class="id"> ?ltW//</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> ltrBlDl</span><span class="id"> addrC</span><span class="id"> -ltrBlDl</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> ball_ereal_ball_fin_le</span><span class="id"> r</span><span class="id"> r'</span> (<span class="id">e</span><span class="id"> :</span><span class="id"> {posnum</span><span class="id"> R}</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">let</span><span class="id"> e'</span><span class="id"> :</span><span class="id"> R</span><span class="id"> :=</span> (<span class="id">fine</span> (<span class="id">expand</span> (<span class="id">contract</span><span class="id"> r%:E</span><span class="id"> +</span><span class="id"> e%:num</span>))<span class="id"> -</span><span class="id"> r</span>)<span class="id">%R</span><span class="gallina-kwd"> in</span><br/>
&nbsp;&nbsp;<span class="id">ball</span><span class="id"> r</span><span class="id"> e'</span><span class="id"> r'</span><span class="id"> -&gt;</span> (<span class="id">r</span><span class="id"> &lt;=</span><span class="id"> r'</span>)<span class="id">%R</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;(<span class="id">`|</span><span class="id"> contract</span><span class="id"> r%:E</span><span class="id"> +</span><span class="id"> e%:num</span><span class="id"> |</span><span class="id"> &lt;</span><span class="id"> 1</span>)<span class="id">%R</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">ereal_ball</span><span class="id"> r%:E</span><span class="id"> e%:num</span><span class="id"> r'%:E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> e'</span><span class="id"> r'e'r</span><span class="id"> rr'</span><span class="id"> re1;</span><span class="id"> rewrite</span><span class="id"> /ereal_ball</span>.<br/>
<span class="id">move:</span><span class="id"> rr';</span><span class="id"> rewrite</span><span class="id"> le_eqVlt</span><span class="id"> =&gt;</span><span class="id"> /predU1P[-&gt;|rr'];</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> subrr</span><span class="id"> normr0</span>.<br/>
<span class="id">rewrite</span><span class="id"> /ball</span><span class="id"> /=</span><span class="id"> ltr0_norm</span><span class="id"> ?subr_lt0//</span><span class="id"> opprB</span><span class="gallina-kwd"> in</span><span class="id"> r'e'r</span>.<br/>
<span class="id">rewrite</span><span class="id"> ltr0_norm</span><span class="id"> ?subr_lt0</span><span class="id"> ?lt_contract</span><span class="id"> ?lte_fin//</span>.<br/>
<span class="id">rewrite</span><span class="id"> opprB;</span><span class="id"> move:</span><span class="id"> r'e'r</span>.<br/>
<span class="id">rewrite</span><span class="id"> /e'</span><span class="id"> -ltrBlDr</span><span class="id"> opprK</span><span class="id"> subrK</span><span class="id"> -lte_fin</span><span class="id"> fine_expand</span><span class="id"> //</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> lt_expandRL</span><span class="id"> ?inE</span><span class="id"> ?ltW//</span><span class="id"> ltrBlDl</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> nbhs_oo_up_e1</span> (<span class="id">A</span><span class="id"> :</span><span class="id"> set</span> (<span class="id">\bar</span><span class="id"> R</span>)) (<span class="id">e</span><span class="id"> :</span><span class="id"> {posnum</span><span class="id"> R}</span>)<span class="id"> :</span> (<span class="id">e%:num</span><span class="id"> &lt;=</span><span class="id"> 1</span>)<span class="id">%R</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">ereal_ball</span><span class="id"> +oo</span><span class="id"> e%:num</span><span class="id"> `&lt;=`</span><span class="id"> A</span><span class="id"> -&gt;</span><span class="id"> nbhs</span><span class="id"> +oo</span><span class="id"> A</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> e1</span><span class="id"> ooeA</span>.<br/>
<span class="gallina-kwd">exists</span> (<span class="id">fine</span> (<span class="id">expand</span> (<span class="id">1</span><span class="id"> -</span><span class="id"> e%:num</span>)<span class="id">%R</span>))<span class="id">;</span><span class="id"> rewrite</span><span class="id"> num_real;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
<span class="id">case</span><span class="id"> =&gt;</span><span class="id"> [r</span><span class="id"> |</span><span class="id"> |</span><span class="id"> //]</span>.<br/>
<span class="id">-</span><span class="id"> rewrite</span><span class="id"> fine_expand;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> ger0_norm</span><span class="id"> ?ltrBlDl</span><span class="id"> ?ltrDr</span><span class="id"> //</span><span class="id"> subr_ge0</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> ?;</span><span class="id"> exact/ooeA/expand_ereal_ball_pinfty</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> _;</span><span class="id"> exact/ooeA/ereal_ball_center</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> nbhs_oo_down_e1</span> (<span class="id">A</span><span class="id"> :</span><span class="id"> set</span> (<span class="id">\bar</span><span class="id"> R</span>)) (<span class="id">e</span><span class="id"> :</span><span class="id"> {posnum</span><span class="id"> R}</span>)<span class="id"> :</span> (<span class="id">e%:num</span><span class="id"> &lt;=</span><span class="id"> 1</span>)<span class="id">%R</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">ereal_ball</span><span class="id"> -oo</span><span class="id"> e%:num</span><span class="id"> `&lt;=`</span><span class="id"> A</span><span class="id"> -&gt;</span><span class="id"> nbhs</span><span class="id"> -oo</span><span class="id"> A</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> e1</span><span class="id"> reA;</span><span class="id"> suff</span><span class="id"> h</span><span class="id"> :</span><span class="id"> nbhs</span><span class="id"> +oo</span> (<span class="id">-%E</span><span class="id"> @`</span><span class="id"> A</span>).<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> (_<span class="id"> :</span><span class="id"> -oo</span><span class="id"> =</span><span class="id"> -</span><span class="id"> +oo</span>)<span class="id"> //</span><span class="id"> nbhsNe;</span><span class="gallina-kwd"> exists</span> (<span class="id">-%E</span><span class="id"> @`</span><span class="id"> A</span>)<span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> predeqE</span><span class="id"> =&gt;</span><span class="id"> x;</span><span class="id"> split=&gt;</span><span class="id"> [[y</span><span class="id"> [z</span><span class="id"> Az</span><span class="id"> &lt;-</span><span class="id"> &lt;-]]|Ax];</span><span class="id"> rewrite</span><span class="id"> ?oppeK</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="gallina-kwd"> exists</span> (<span class="id">-</span><span class="id"> x</span>)<span class="id">;</span><span class="id"> [exists</span><span class="id"> x</span><span class="id"> |</span><span class="id"> rewrite</span><span class="id"> oppeK]</span>.<br/>
<span class="id">apply</span> (<span class="id">@nbhs_oo_up_e1</span><span class="id"> _</span><span class="id"> e</span>)<span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> x</span><span class="id"> x1e;</span><span class="gallina-kwd"> exists</span> (<span class="id">-</span><span class="id"> x</span>)<span class="id">;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> oppeK</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply/reA/ereal_ballN;</span><span class="id"> rewrite</span><span class="id"> oppeK</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> nbhs_oo_up_1e</span> (<span class="id">A</span><span class="id"> :</span><span class="id"> set</span> (<span class="id">\bar</span><span class="id"> R</span>)) (<span class="id">e</span><span class="id"> :</span><span class="id"> {posnum</span><span class="id"> R}</span>)<span class="id"> :</span> (<span class="id">1</span><span class="id"> &lt;</span><span class="id"> e%:num</span>)<span class="id">%R</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">ereal_ball</span><span class="id"> +oo</span><span class="id"> e%:num</span><span class="id"> `&lt;=`</span><span class="id"> A</span><span class="id"> -&gt;</span><span class="id"> nbhs</span><span class="id"> +oo</span><span class="id"> A</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> e1</span><span class="id"> reA;</span><span class="id"> have</span><span class="id"> [e2{e1}|e2]</span><span class="id"> :=</span><span class="id"> ltrP</span><span class="id"> 2</span><span class="id"> e%:num</span>.<br/>
&nbsp;&nbsp;<span class="id">suff</span><span class="id"> -&gt;</span><span class="id"> :</span><span class="id"> A</span><span class="id"> =</span><span class="id"> setT</span><span class="gallina-kwd"> by</span><span class="gallina-kwd"> exists</span><span class="id"> 0%R</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> predeqE</span><span class="id"> =&gt;</span><span class="id"> x;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> _;</span><span class="id"> apply</span><span class="id"> reA</span>.<br/>
&nbsp;&nbsp;<span class="id">exact/ereal_ballN/ereal_ball_ninfty_oversize</span>.<br/>
<span class="id">have</span><span class="id"> /andP[e10</span><span class="id"> e11]</span><span class="id"> :</span> (<span class="id">0</span><span class="id"> &lt;</span><span class="id"> e%:num</span><span class="id"> -</span><span class="id"> 1</span><span class="id"> &lt;=</span><span class="id"> 1</span>)<span class="id">%R</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> subr_gt0</span><span class="id"> e1</span><span class="id"> /=</span><span class="id"> lerBlDl</span>.<br/>
<span class="id">apply</span><span class="id"> nbhsNKe</span>.<br/>
<span class="id">have</span><span class="id"> :</span> ((<span class="id">PosNum</span><span class="id"> e10</span>)<span class="id">%:num</span><span class="id"> &lt;=</span><span class="id"> 1</span>)<span class="id">%R</span><span class="gallina-kwd"> by</span><span class="id"> []</span>.<br/>
<span class="id">move/</span>(<span class="id">@nbhs_oo_down_e1</span> (<span class="id">-%E</span><span class="id"> @`</span><span class="id"> A</span>) (<span class="id">PosNum</span><span class="id"> e10</span>))<span class="id">;</span><span class="id"> apply</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> y</span><span class="id"> ye;</span><span class="gallina-kwd"> exists</span> (<span class="id">-</span><span class="id"> y</span>)<span class="id">;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> oppeK</span>.<br/>
<span class="id">apply/reA/ereal_ballN;</span><span class="id"> rewrite</span><span class="id"> oppeK</span><span class="id"> /=</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> le_ereal_ball</span><span class="id"> ye</span><span class="id"> =&gt;</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> lerBlDl</span><span class="id"> lerDr</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> nbhs_oo_down_1e</span> (<span class="id">A</span><span class="id"> :</span><span class="id"> set</span> (<span class="id">\bar</span><span class="id"> R</span>)) (<span class="id">e</span><span class="id"> :</span><span class="id"> {posnum</span><span class="id"> R}</span>)<span class="id"> :</span> (<span class="id">1</span><span class="id"> &lt;</span><span class="id"> e%:num</span>)<span class="id">%R</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">ereal_ball</span><span class="id"> -oo</span><span class="id"> e%:num</span><span class="id"> `&lt;=`</span><span class="id"> A</span><span class="id"> -&gt;</span><span class="id"> nbhs</span><span class="id"> -oo</span><span class="id"> A</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> e1</span><span class="id"> reA;</span><span class="id"> have</span><span class="id"> [e2{e1}|e2]</span><span class="id"> :=</span><span class="id"> ltrP</span><span class="id"> 2</span><span class="id"> e%:num</span>.<br/>
&nbsp;&nbsp;<span class="id">suff</span><span class="id"> -&gt;</span><span class="id"> :</span><span class="id"> A</span><span class="id"> =</span><span class="id"> setT</span><span class="gallina-kwd"> by</span><span class="gallina-kwd"> exists</span><span class="id"> 0%R</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> predeqE</span><span class="id"> =&gt;</span><span class="id"> x;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> _;</span><span class="id"> exact/reA/ereal_ball_ninfty_oversize</span>.<br/>
<span class="id">have</span><span class="id"> /andP[e10</span><span class="id"> e11]</span><span class="id"> :</span> (<span class="id">0</span><span class="id"> &lt;</span><span class="id"> e%:num</span><span class="id"> -</span><span class="id"> 1</span><span class="id"> &lt;=</span><span class="id"> 1</span>)<span class="id">%R</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> subr_gt0</span><span class="id"> e1</span><span class="id"> /=</span><span class="id"> lerBlDl</span>.<br/>
<span class="id">apply</span><span class="id"> nbhsNKe</span>.<br/>
<span class="id">have</span><span class="id"> :</span> ((<span class="id">PosNum</span><span class="id"> e10</span>)<span class="id">%:num</span><span class="id"> &lt;=</span><span class="id"> 1</span>)<span class="id">%R</span><span class="gallina-kwd"> by</span><span class="id"> []</span>.<br/>
<span class="id">move/</span>(<span class="id">@nbhs_oo_up_e1</span> (<span class="id">-%E</span><span class="id"> @`</span><span class="id"> A</span>) (<span class="id">PosNum</span><span class="id"> e10</span>))<span class="id">;</span><span class="id"> apply</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> y</span><span class="id"> ye;</span><span class="gallina-kwd"> exists</span> (<span class="id">-</span><span class="id"> y</span>)<span class="id">;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> oppeK</span>.<br/>
<span class="id">apply/reA/ereal_ballN;</span><span class="id"> rewrite</span><span class="id"> /=</span><span class="id"> oppeK</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> le_ereal_ball</span><span class="id"> ye</span><span class="id"> =&gt;</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> lerBlDl</span><span class="id"> lerDr</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> nbhs_fin_out_above</span><span class="id"> r</span> (<span class="id">e</span><span class="id"> :</span><span class="id"> {posnum</span><span class="id"> R}</span>) (<span class="id">A</span><span class="id"> :</span><span class="id"> set</span> (<span class="id">\bar</span><span class="id"> R</span>))<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">ereal_ball</span><span class="id"> r%:E</span><span class="id"> e%:num</span><span class="id"> `&lt;=`</span><span class="id"> A</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;(<span class="id">-</span><span class="id"> 1</span><span class="id"> &lt;</span><span class="id"> contract</span><span class="id"> r%:E</span><span class="id"> -</span><span class="id"> e%:num</span>)<span class="id">%R</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;(<span class="id">1</span><span class="id"> &lt;=</span><span class="id"> contract</span><span class="id"> r%:E</span><span class="id"> +</span><span class="id"> e%:num</span>)<span class="id">%R</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">nbhs</span><span class="id"> r%:E</span><span class="id"> A</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> reA</span><span class="id"> reN1</span><span class="id"> re1</span>.<br/>
<span class="id">have</span><span class="id"> er1</span><span class="id"> :</span> (<span class="id">`|contract</span><span class="id"> r%:E</span><span class="id"> -</span><span class="id"> e%:num|</span><span class="id"> &lt;</span><span class="id"> 1</span>)<span class="id">%R</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> ltr_norml</span><span class="id"> reN1</span><span class="id"> andTb</span><span class="id"> ltrBlDl</span><span class="id"> ltr_pwDl</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move:</span> (<span class="id">contract_le1</span><span class="id"> r%:E</span>)<span class="id">;</span><span class="id"> rewrite</span><span class="id"> ler_norml</span><span class="id"> =&gt;</span><span class="id"> /andP[]</span>.<br/>
<span class="id">pose</span><span class="id"> e'</span><span class="id"> :=</span> (<span class="id">r</span><span class="id"> -</span><span class="id"> fine</span> (<span class="id">expand</span> (<span class="id">contract</span><span class="id"> r%:E</span><span class="id"> -</span><span class="id"> e%:num</span>)))<span class="id">%R</span>.<br/>
<span class="id">have</span><span class="id"> e'0</span><span class="id"> :</span> (<span class="id">0</span><span class="id"> &lt;</span><span class="id"> e'</span>)<span class="id">%R</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> subr_gt0</span><span class="id"> -lte_fin</span><span class="id"> -[ltRHS]</span>(<span class="id">contractK</span><span class="id"> r%:E</span>).<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> fine_expand</span><span class="id"> //</span><span class="id"> lt_expand</span><span class="id"> ?inE</span><span class="id"> ?contract_le1//</span><span class="id"> ?ltW//</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> ltrBlDl</span><span class="id"> ltrDr</span>.<br/>
<span class="id">apply/nbhs_ballP;</span><span class="gallina-kwd"> exists</span><span class="id"> e'</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> r'</span><span class="id"> re'r';</span><span class="id"> apply</span><span class="id"> reA</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> have</span><span class="id"> [?|?]</span><span class="id"> :=</span><span class="id"> lerP</span><span class="id"> r</span><span class="id"> r';</span><br/>
&nbsp;&nbsp;<span class="id">[exact:</span><span class="id"> contract_ereal_ball_fin_le</span><span class="id"> |</span><span class="id"> exact:</span><span class="id"> ball_ereal_ball_fin_lt]</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> nbhs_fin_out_below</span><span class="id"> r</span> (<span class="id">e</span><span class="id"> :</span><span class="id"> {posnum</span><span class="id"> R}</span>) (<span class="id">A</span><span class="id"> :</span><span class="id"> set</span> (<span class="id">\bar</span><span class="id"> R</span>))<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">ereal_ball</span><span class="id"> r%:E</span><span class="id"> e%:num</span><span class="id"> `&lt;=`</span><span class="id"> A</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;(<span class="id">contract</span><span class="id"> r%:E</span><span class="id"> -</span><span class="id"> e%:num</span><span class="id"> &lt;=</span><span class="id"> -</span><span class="id"> 1</span>)<span class="id">%R</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;(<span class="id">contract</span><span class="id"> r%:E</span><span class="id"> +</span><span class="id"> e%:num</span><span class="id"> &lt;</span><span class="id"> 1</span>)<span class="id">%R</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">nbhs</span><span class="id"> r%:E</span><span class="id"> A</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> reA</span><span class="id"> reN1</span><span class="id"> re1</span>.<br/>
<span class="id">have</span><span class="id"> ?</span><span class="id"> :</span> (<span class="id">`|contract</span><span class="id"> r%:E</span><span class="id"> +</span><span class="id"> e%:num|</span><span class="id"> &lt;</span><span class="id"> 1</span>)<span class="id">%R</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> ltr_norml</span><span class="id"> re1</span><span class="id"> andbT</span> (<span class="id">@lt_le_trans</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">contract</span><span class="id"> r%:E</span>))<span class="id"> //</span><span class="id"> ?lerDl</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move:</span> (<span class="id">contract_lt1</span><span class="id"> r</span>)<span class="id">;</span><span class="id"> rewrite</span><span class="id"> ltr_norml</span><span class="id"> =&gt;</span><span class="id"> /andP[]</span>.<br/>
<span class="id">pose</span><span class="id"> e'</span><span class="id"> :</span><span class="id"> R</span><span class="id"> :=</span> (<span class="id">fine</span> (<span class="id">expand</span> (<span class="id">contract</span><span class="id"> r%:E</span><span class="id"> +</span><span class="id"> e%:num</span>))<span class="id"> -</span><span class="id"> r</span>)<span class="id">%R</span>.<br/>
<span class="id">have</span><span class="id"> e'0</span><span class="id"> :</span> (<span class="id">0</span><span class="id"> &lt;</span><span class="id"> e'</span>)<span class="id">%R</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> /e'</span><span class="id"> subr_gt0</span><span class="id"> -lte_fin</span><span class="id"> -[in</span><span class="id"> ltLHS]</span>(<span class="id">contractK</span><span class="id"> r%:E</span>).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> fine_expand</span><span class="id"> //</span><span class="id"> lt_expand</span><span class="id"> ?inE</span><span class="id"> ?contract_le1</span><span class="id"> ?ltrDl</span><span class="id"> ?ltW</span>.<br/>
<span class="id">apply/nbhs_ballP;</span><span class="gallina-kwd"> exists</span><span class="id"> e'</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> r'</span><span class="id"> r'e'r;</span><span class="id"> apply</span><span class="id"> reA</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> have</span><span class="id"> [?|?]</span><span class="id"> :=</span><span class="id"> lerP</span><span class="id"> r</span><span class="id"> r';</span><br/>
&nbsp;&nbsp;<span class="id">[exact:</span><span class="id"> ball_ereal_ball_fin_le</span><span class="id"> |</span><span class="id"> exact:</span><span class="id"> contract_ereal_ball_fin_lt]</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> nbhs_fin_out_above_below</span><span class="id"> r</span> (<span class="id">e</span><span class="id"> :</span><span class="id"> {posnum</span><span class="id"> R}</span>) (<span class="id">A</span><span class="id"> :</span><span class="id"> set</span> (<span class="id">\bar</span><span class="id"> R</span>))<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">ereal_ball</span><span class="id"> r%:E</span><span class="id"> e%:num</span><span class="id"> `&lt;=`</span><span class="id"> A</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;(<span class="id">contract</span><span class="id"> r%:E</span><span class="id"> -</span><span class="id"> e%:num</span><span class="id"> &lt;</span><span class="id"> -1</span>)<span class="id">%R</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;(<span class="id">1</span><span class="id"> &lt;</span><span class="id"> contract</span><span class="id"> r%:E</span><span class="id"> +</span><span class="id"> e%:num</span>)<span class="id">%R</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">nbhs</span><span class="id"> r%:E</span><span class="id"> A</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> reA</span><span class="id"> reN1</span><span class="id"> re1;</span><span class="id"> suff</span><span class="id"> :</span><span class="id"> A</span><span class="id"> =</span><span class="id"> setT</span><span class="gallina-kwd"> by</span><span class="id"> move-&gt;;</span><span class="id"> apply:</span><span class="id"> filterT</span>.<br/>
<span class="id">rewrite</span><span class="id"> predeqE</span><span class="id"> =&gt;</span><span class="id"> x;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> _;</span><span class="id"> apply</span><span class="id"> reA</span>.<br/>
<span class="id">case:</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> [r'|</span><span class="id"> |]</span><span class="id"> //</span>.<br/>
<span class="id">-</span><span class="id"> have</span><span class="id"> [?|?]</span><span class="id"> :=</span><span class="id"> lerP</span><span class="id"> r</span><span class="id"> r'</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> contract_ereal_ball_fin_le</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact/ltW</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> apply</span><span class="id"> contract_ereal_ball_fin_lt</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact/ltW</span>.<br/>
<span class="id">-</span><span class="id"> exact/contract_ereal_ball_pinfty</span>.<br/>
<span class="id">-</span><span class="id"> apply/ereal_ballN/contract_ereal_ball_pinfty</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> EFinN</span><span class="id"> contractN</span><span class="id"> -</span>(<span class="id">opprK</span><span class="id"> 1%R</span>)<span class="id"> ltrNl</span><span class="id"> opprD</span><span class="id"> opprK</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> nbhs_fin_inbound</span><span class="id"> r</span> (<span class="id">e</span><span class="id"> :</span><span class="id"> {posnum</span><span class="id"> R}</span>) (<span class="id">A</span><span class="id"> :</span><span class="id"> set</span> (<span class="id">\bar</span><span class="id"> R</span>))<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">ereal_ball</span><span class="id"> r%:E</span><span class="id"> e%:num</span><span class="id"> `&lt;=`</span><span class="id"> A</span><span class="id"> -&gt;</span><span class="id"> nbhs</span><span class="id"> r%:E</span><span class="id"> A</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> reA</span>.<br/>
<span class="id">have</span><span class="id"> [|reN1]</span><span class="id"> :=</span><span class="id"> boolP</span> (<span class="id">contract</span><span class="id"> r%:E</span><span class="id"> -</span><span class="id"> e%:num</span><span class="id"> ==</span><span class="id"> -1</span>)<span class="id">%R</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> subr_eq</span><span class="id"> addrC</span><span class="id"> =&gt;</span><span class="id"> /eqP</span><span class="id"> reN1</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> [re1|]</span><span class="id"> :=</span><span class="id"> boolP</span> (<span class="id">contract</span><span class="id"> r%:E</span><span class="id"> +</span><span class="id"> e%:num</span><span class="id"> ==</span><span class="id"> 1</span>)<span class="id">%R</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">move/eqP</span><span class="id"> :</span><span class="id"> reN1;</span><span class="id"> rewrite</span><span class="id"> -</span>(<span class="id">eqP</span><span class="id"> re1</span>)<span class="id"> opprD</span><span class="id"> addrCA</span><span class="id"> subrr</span><span class="id"> addr0</span><span class="id"> -subr_eq0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> opprK</span><span class="id"> -mulr2n</span><span class="id"> mulrn_eq0</span><span class="id"> orFb</span><span class="id"> contract_eq0</span><span class="id"> =&gt;</span><span class="id"> /eqP[r0]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">move:</span><span class="id"> re1;</span><span class="id"> rewrite</span><span class="id"> r0</span><span class="id"> contract0</span><span class="id"> add0r</span><span class="id"> =&gt;</span><span class="id"> /eqP</span><span class="id"> e1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply/nbhs_ballP;</span><span class="gallina-kwd"> exists</span><span class="id"> 1%R</span><span class="id"> =&gt;</span><span class="id"> //=</span><span class="id"> r';</span><span class="id"> rewrite</span><span class="id"> /ball</span><span class="id"> /=</span><span class="id"> sub0r</span><span class="id"> normrN</span><span class="id"> =&gt;</span><span class="id"> r'1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply</span><span class="id"> reA</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /ereal_ball</span><span class="id"> r0</span><span class="id"> contract0</span><span class="id"> sub0r</span><span class="id"> normrN</span><span class="id"> e1</span><span class="id"> contract_lt1</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> neq_lt</span><span class="id"> =&gt;</span><span class="id"> /orP[re1|re1]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply</span> (<span class="id">@nbhs_fin_out_below</span><span class="id"> _</span><span class="id"> e</span>)<span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> rewrite</span><span class="id"> reN1</span><span class="id"> addrAC</span><span class="id"> subrr</span><span class="id"> sub0r</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> e1</span><span class="id"> :</span> (<span class="id">1</span><span class="id"> &lt;</span><span class="id"> e%:num</span>)<span class="id">%R</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">move:</span><span class="id"> re1;</span><span class="id"> rewrite</span><span class="id"> reN1</span><span class="id"> addrAC</span><span class="id"> ltrBrDl</span><span class="id"> -!mulr2n</span><span class="id"> -</span>(<span class="id">mulr_natl</span><span class="id"> e%:num</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -{1}</span>(<span class="id">mulr1</span><span class="id"> 2%:R</span>)<span class="id"> =&gt;</span><span class="id"> ?;</span><span class="id"> rewrite</span><span class="id"> -</span>(<span class="id">@ltr_pM2l</span><span class="id"> _</span><span class="id"> 2</span>).<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> Aoo</span><span class="id"> :</span><span class="id"> setT</span><span class="id"> `\</span><span class="id"> -oo</span><span class="id"> `&lt;=`</span><span class="id"> A</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> x</span><span class="id"> [_];</span><span class="id"> rewrite</span><span class="id"> /set1</span><span class="id"> /=</span><span class="id"> =&gt;</span><span class="id"> xnoo;</span><span class="id"> apply</span><span class="id"> reA</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">case:</span><span class="id"> x</span><span class="id"> xnoo</span><span class="id"> =&gt;</span><span class="id"> [r'</span><span class="id"> _</span><span class="id"> |</span><span class="id"> _</span><span class="id"> |//]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">have</span><span class="id"> [rr'|r'r]</span><span class="id"> :=</span><span class="id"> lerP</span> (<span class="id">contract</span><span class="id"> r%:E</span>) (<span class="id">contract</span><span class="id"> r'%:E</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> contract_ereal_ball_fin_le;</span><span class="id"> last</span><span class="id"> exact/ltW</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -lee_fin</span><span class="id"> -</span>(<span class="id">contractK</span><span class="id"> r%:E</span>)<span class="id"> -</span>(<span class="id">contractK</span><span class="id"> r'%:E</span>)<span class="id"> le_expand</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> contract_ereal_ball_fin_lt;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> reN1</span><span class="id"> addrAC</span><span class="id"> subrr</span><span class="id"> add0r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -lte_fin</span><span class="id"> -</span>(<span class="id">contractK</span><span class="id"> r%:E</span>)<span class="id"> -</span>(<span class="id">contractK</span><span class="id"> r'%:E</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> lt_expand</span><span class="id"> //</span><span class="id"> inE;</span><span class="id"> exact:</span><span class="id"> contract_le1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> contract_ereal_ball_pinfty</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> :</span><span class="id"> nbhs</span><span class="id"> r%:E</span> (<span class="id">setT</span><span class="id"> `\</span><span class="id"> -oo</span>)<span class="gallina-kwd"> by</span><span class="id"> apply/nbhs_ballP;</span><span class="gallina-kwd"> exists</span><span class="id"> 1%R</span><span class="id"> =&gt;</span><span class="id"> /=</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> /nbhs_ballP[_/posnumP[e']]</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> /ball</span><span class="id"> /=</span><span class="id"> =&gt;</span><span class="id"> h</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply/nbhs_ballP;</span><span class="gallina-kwd"> exists</span><span class="id"> e'%:num</span><span class="id"> =&gt;</span><span class="id"> //=</span><span class="id"> y</span><span class="id"> /h;</span><span class="id"> apply:</span><span class="id"> Aoo</span>.<br/>
<span class="id">move:</span><span class="id"> reN1;</span><span class="id"> rewrite</span><span class="id"> eq_sym</span><span class="id"> neq_lt</span><span class="id"> =&gt;</span><span class="id"> /orP[reN1|reN1]</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> [re1|re1]</span><span class="id"> :=</span><span class="id"> eqVneq</span> (<span class="id">contract</span><span class="id"> r%:E</span><span class="id"> +</span><span class="id"> e%:num</span>)<span class="id">%R</span><span class="id"> 1%R</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply</span> (<span class="id">@nbhs_fin_out_above</span><span class="id"> _</span><span class="id"> e</span>)<span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> rewrite</span><span class="id"> re1</span>.<br/>
&nbsp;&nbsp;<span class="id">move:</span><span class="id"> re1;</span><span class="id"> rewrite</span><span class="id"> neq_lt</span><span class="id"> =&gt;</span><span class="id"> /orP[re1|re1]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">have</span><span class="id"> ?</span><span class="id"> :</span> (<span class="id">`|contract</span><span class="id"> r%:E</span><span class="id"> -</span><span class="id"> e%:num|</span><span class="id"> &lt;</span><span class="id"> 1</span>)<span class="id">%R</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> ltr_norml</span><span class="id"> reN1</span><span class="id"> andTb</span><span class="id"> ltrBlDl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> (<span class="id">@lt_le_trans</span><span class="id"> _</span><span class="id"> _</span><span class="id"> 1%R</span>)<span class="id"> //</span><span class="id"> ?lerDr//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> case/ltr_normlP</span><span class="id"> :</span> (<span class="id">contract_lt1</span><span class="id"> r</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">have</span><span class="id"> ?</span><span class="id"> :</span> (<span class="id">`|contract</span><span class="id"> r%:E</span><span class="id"> +</span><span class="id"> e%:num|</span><span class="id"> &lt;</span><span class="id"> 1</span>)<span class="id">%R</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> ltr_norml</span><span class="id"> re1</span><span class="id"> andbT</span><span class="id"> -</span>(<span class="id">addr0</span> (<span class="id">-1</span>))<span class="id"> ler_ltD</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move:</span> (<span class="id">contract_le1</span><span class="id"> r%:E</span>)<span class="id">;</span><span class="id"> rewrite</span><span class="id"> ler_norml</span><span class="id"> =&gt;</span><span class="id"> /andP[]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">pose</span><span class="id"> e'</span><span class="id"> :</span><span class="id"> R</span><span class="id"> :=</span><span class="id"> Num</span>.<span class="id">min</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">r</span><span class="id"> -</span><span class="id"> fine</span> (<span class="id">expand</span> (<span class="id">contract</span><span class="id"> r%:E</span><span class="id"> -</span><span class="id"> e%:num</span>)))<span class="id">%R</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">fine</span> (<span class="id">expand</span> (<span class="id">contract</span><span class="id"> r%:E</span><span class="id"> +</span><span class="id"> e%:num</span>))<span class="id"> -</span><span class="id"> r</span>)<span class="id">%R</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">have</span><span class="id"> e'0</span><span class="id"> :</span> (<span class="id">0</span><span class="id"> &lt;</span><span class="id"> e'</span>)<span class="id">%R</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> /e'</span><span class="id"> lt_min;</span><span class="id"> apply/andP;</span><span class="id"> split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> subr_gt0</span><span class="id"> -lte_fin</span><span class="id"> -[in</span><span class="id"> ltRHS]</span>(<span class="id">contractK</span><span class="id"> r%:E</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> fine_expand</span><span class="id"> //</span><span class="id"> lt_expand//</span><span class="id"> ?inE</span><span class="id"> ?contract_le1</span><span class="id"> ?ltW//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> ltrBlDl</span><span class="id"> ltrDr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> subr_gt0</span><span class="id"> -lte_fin</span><span class="id"> -[in</span><span class="id"> ltLHS]</span>(<span class="id">contractK</span><span class="id"> r%:E</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> fine_expand//</span><span class="id"> lt_expand</span><span class="id"> ?inE</span><span class="id"> ?contract_le1</span><span class="id"> ?ltrDl</span><span class="id"> ?ltW</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply/nbhs_ballP;</span><span class="gallina-kwd"> exists</span><span class="id"> e'</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> r'</span><span class="id"> re'r';</span><span class="id"> apply</span><span class="id"> reA</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">have</span><span class="id"> [|r'r]</span><span class="id"> :=</span><span class="id"> lerP</span><span class="id"> r</span><span class="id"> r'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> rr';</span><span class="id"> apply:</span><span class="id"> ball_ereal_ball_fin_le</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> le_ball</span><span class="id"> re'r';</span><span class="id"> rewrite</span><span class="id"> ge_min</span><span class="id"> lexx</span><span class="id"> orbT</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">move:</span><span class="id"> re'r';</span><span class="id"> rewrite</span><span class="id"> /ball</span><span class="id"> /=</span><span class="id"> lt_min</span><span class="id"> =&gt;</span><span class="id"> /andP[]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> gtr0_norm</span><span class="id"> ?subr_gt0</span><span class="id"> //</span><span class="id"> -ltrBlDl</span><span class="id"> addrAC</span><span class="id"> subrr</span><span class="id"> add0r</span><span class="id"> ltrNl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> opprK</span><span class="id"> -lte_fin</span><span class="id"> fine_expand</span><span class="id"> //</span><span class="id"> =&gt;</span><span class="id"> r'e'r</span><span class="id"> _</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> expand_ereal_ball_fin_lt</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply</span> (<span class="id">@nbhs_fin_out_above</span><span class="id"> _</span><span class="id"> e</span>)<span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> rewrite</span><span class="id"> ltW</span>.<br/>
<span class="id">have</span><span class="id"> [re1|re1]</span><span class="id"> :=</span><span class="id"> ltrP</span><span class="id"> 1</span> (<span class="id">contract</span><span class="id"> r%:E</span><span class="id"> +</span><span class="id"> e%:num</span>).<br/>
&nbsp;&nbsp;<span class="id">exact:</span> (<span class="id">@nbhs_fin_out_above_below</span><span class="id"> _</span><span class="id"> e</span>).<br/>
<span class="id">move:</span><span class="id"> re1;</span><span class="id"> rewrite</span><span class="id"> le_eqVlt</span><span class="id"> =&gt;</span><span class="id"> /orP[re1|re1]</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> {}re1</span><span class="id"> :</span><span class="id"> contract</span><span class="id"> r%:E</span><span class="id"> =</span> (<span class="id">1</span><span class="id"> -</span><span class="id"> e%:num</span>)<span class="id">%R</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move:</span><span class="id"> re1;</span><span class="id"> rewrite</span><span class="id"> eq_sym</span><span class="id"> -subr_eq</span><span class="id"> =&gt;</span><span class="id"> /eqP</span><span class="id"> &lt;-</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> e1</span><span class="id"> :</span> (<span class="id">1</span><span class="id"> &lt;</span><span class="id"> e%:num</span>)<span class="id">%R</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">move:</span><span class="id"> reN1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> re1</span><span class="id"> -addrA</span><span class="id"> -opprD</span><span class="id"> ltrBlDl</span><span class="id"> ltrBrDl</span><span class="id"> -!mulr2n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -</span>(<span class="id">mulr_natl</span><span class="id"> e%:num</span>)<span class="id"> -{1}</span>(<span class="id">mulr1</span><span class="id"> 2%:R</span>)<span class="id"> =&gt;</span><span class="id"> ?</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -</span>(<span class="id">@ltr_pM2l</span><span class="id"> _</span><span class="id"> 2</span>).<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> Aoo</span><span class="id"> :</span> (<span class="id">setT</span><span class="id"> `\</span><span class="id"> +oo</span><span class="id"> `&lt;=`</span><span class="id"> A</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> x</span><span class="id"> [_];</span><span class="id"> rewrite</span><span class="id"> /set1</span><span class="id"> /=</span><span class="id"> =&gt;</span><span class="id"> xpoo;</span><span class="id"> apply</span><span class="id"> reA</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">case:</span><span class="id"> x</span><span class="id"> xpoo</span><span class="id"> =&gt;</span><span class="id"> [r'</span><span class="id"> _</span><span class="id"> |</span><span class="id"> //</span><span class="id"> |_]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> /ereal_ball</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">have</span><span class="id"> [rr'|r'r]</span><span class="id"> :=</span><span class="id"> lerP</span> (<span class="id">contract</span><span class="id"> r%:E</span>) (<span class="id">contract</span><span class="id"> r'%:E</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> re1</span><span class="id"> opprB</span><span class="id"> addrCA</span><span class="id"> -[ltRHS]addr0</span><span class="id"> ltrD2</span><span class="id"> subr_lt0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> case/ltr_normlP</span><span class="id"> :</span> (<span class="id">contract_lt1</span><span class="id"> r'</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> /ereal_ball</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> re1</span><span class="id"> addrAC</span><span class="id"> ltrBlDl</span><span class="id"> ltrD</span><span class="id"> //</span> (<span class="id">lt_trans</span><span class="id"> _</span><span class="id"> e1</span>)<span class="id"> //</span><span class="id"> ltrNl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move:</span> (<span class="id">contract_lt1</span><span class="id"> r'</span>)<span class="id">;</span><span class="id"> rewrite</span><span class="id"> ltr_norml</span><span class="id"> =&gt;</span><span class="id"> /andP[]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> /ereal_ball</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> [contract</span><span class="id"> -oo]/=</span><span class="id"> opprK</span><span class="id"> gtr0_norm</span><span class="id"> ?subr_gt0;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -ltrBlDl</span><span class="id"> add0r</span><span class="id"> ltrNl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move:</span> (<span class="id">contract_lt1</span><span class="id"> r</span>)<span class="id">;</span><span class="id"> rewrite</span><span class="id"> ltr_norml</span><span class="id"> =&gt;</span><span class="id"> /andP[]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> re1</span><span class="id"> addrAC</span><span class="id"> ltrBlDl</span><span class="id"> ltrD</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="id">have</span><span class="id"> :</span><span class="id"> nbhs</span><span class="id"> r%:E</span> (<span class="id">setT</span><span class="id"> `\</span><span class="id"> +oo</span>)<span class="gallina-kwd"> by</span><span class="gallina-kwd"> exists</span><span class="id"> 1%R</span><span class="id"> =&gt;</span><span class="id"> /=</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="id">case</span><span class="id"> =&gt;</span><span class="id"> _/posnumP[x]</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> /ball_</span><span class="id"> =&gt;</span><span class="id"> h</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="gallina-kwd"> exists</span><span class="id"> x%:num</span><span class="id"> =&gt;</span><span class="id"> //=</span><span class="id"> y</span><span class="id"> /h;</span><span class="id"> exact:</span><span class="id"> Aoo</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply</span> (<span class="id">@nbhs_fin_out_below</span><span class="id"> _</span><span class="id"> e</span>)<span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> rewrite</span><span class="id"> ltW</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> ereal_nbhsE</span><span class="id"> :</span><span class="id"> nbhs</span><span class="id"> =</span><span class="id"> nbhs_</span> (<span class="id">entourage_</span> (<span class="id">@ereal_ball</span><span class="id"> R</span>)).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">set</span><span class="id"> diag</span><span class="id"> :=</span><span class="gallina-kwd"> fun</span><span class="id"> r</span><span class="id"> =&gt;</span><span class="id"> [set</span><span class="id"> xy</span><span class="id"> |</span><span class="id"> ereal_ball</span><span class="id"> xy</span>.<span class="id">1</span><span class="id"> r</span><span class="id"> xy</span>.<span class="id">2]</span>.<br/>
<span class="id">rewrite</span><span class="id"> predeq2E</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> A;</span><span class="id"> split</span>.<br/>
<span class="id">-</span><span class="id"> rewrite</span><span class="id"> {1}/nbhs</span><span class="id"> /=</span><span class="id"> /ereal_nbhs</span>.<br/>
&nbsp;&nbsp;<span class="id">case:</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> [/=</span><span class="id"> r</span><span class="id"> [_/posnumP[e]</span><span class="id"> reA]|</span><span class="id"> [M</span><span class="id"> [/=</span><span class="id"> Mreal</span><span class="id"> MA]]|</span><span class="id"> [M</span><span class="id"> [/=</span><span class="id"> Mreal</span><span class="id"> MA]]]</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="id"> pose</span><span class="id"> e'</span><span class="id"> :</span><span class="id"> R</span><span class="id"> :=</span><span class="id"> Num</span>.<span class="id">min</span> (<span class="id">contract</span><span class="id"> r%:E</span><span class="id"> -</span><span class="id"> contract</span> (<span class="id">r%:E</span><span class="id"> -</span><span class="id"> e%:num%:E</span>))<span class="id">%R</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">contract</span> (<span class="id">r%:E</span><span class="id"> +</span><span class="id"> e%:num%:E</span>)<span class="id"> -</span><span class="id"> contract</span><span class="id"> r%:E</span>)<span class="id">%R</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">exists</span> (<span class="id">diag</span><span class="id"> e'</span>)<span class="id">;</span><span class="id"> rewrite</span><span class="id"> /diag</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">exists</span><span class="id"> e'</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> /=</span><span class="id"> /e'</span><span class="id"> lt_min;</span><span class="id"> apply/andP;</span><span class="id"> split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> subr_gt0</span><span class="id"> lt_contract</span><span class="id"> lte_fin</span><span class="id"> ltrBlDr</span><span class="id"> ltrDl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> subr_gt0</span><span class="id"> lt_contract</span><span class="id"> lte_fin</span><span class="id"> ltrDl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">case=&gt;</span><span class="id"> [r'</span><span class="id"> /=</span><span class="id"> /xsectionP/=</span><span class="id"> re'r'|</span><span class="id"> |]/=</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">*</span><span class="id"> rewrite</span><span class="id"> /ereal_ball</span><span class="gallina-kwd"> in</span><span class="id"> re'r'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">have</span><span class="id"> [r'r|rr']</span><span class="id"> :=</span><span class="id"> lerP</span> (<span class="id">contract</span><span class="id"> r'%:E</span>) (<span class="id">contract</span><span class="id"> r%:E</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> reA;</span><span class="id"> rewrite</span><span class="id"> /ball</span><span class="id"> /=</span><span class="id"> ltr_norml//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> ger0_norm</span><span class="id"> ?subr_ge0//</span><span class="gallina-kwd"> in</span><span class="id"> re'r'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">have</span><span class="id"> :</span> (<span class="id">contract</span> (<span class="id">r%:E</span><span class="id"> -</span><span class="id"> e%:num%:E</span>)<span class="id"> &lt;</span><span class="id"> contract</span><span class="id"> r'%:E</span>)<span class="id">%R</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">move:</span><span class="id"> re'r';</span><span class="id"> rewrite</span><span class="id"> /e'</span><span class="id"> lt_min</span><span class="id"> =&gt;</span><span class="id"> /andP[+</span><span class="id"> _]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> /e'</span><span class="id"> ltrBrDl</span><span class="id"> addrC</span><span class="id"> -ltrBrDl</span><span class="id"> =&gt;</span><span class="id"> /lt_le_trans</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply;</span><span class="id"> rewrite</span><span class="id"> opprB</span><span class="id"> addrCA</span><span class="id"> subrr</span><span class="id"> addr0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -lt_expandRL</span><span class="id"> ?inE</span><span class="id"> ?contract_le1</span><span class="id"> //</span><span class="id"> !contractK</span><span class="id"> lte_fin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> ltrBlDr</span><span class="id"> addrC</span><span class="id"> -ltrBlDr</span><span class="id"> =&gt;</span><span class="id"> -&gt;;</span><span class="id"> rewrite</span><span class="id"> andbT</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> (<span class="id">@lt_le_trans</span><span class="id"> _</span><span class="id"> _</span><span class="id"> 0%R</span>)<span class="id">//</span><span class="id"> 1?ltrNl</span><span class="id"> 1?oppr0//</span><span class="id"> subr_ge0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -lee_fin</span><span class="id"> -le_contract</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> reA;</span><span class="id"> rewrite</span><span class="id"> /ball</span><span class="id"> /=</span><span class="id"> ltr_norml//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> ltr0_norm</span><span class="id"> ?subr_lt0//</span><span class="id"> opprB</span><span class="gallina-kwd"> in</span><span class="id"> re'r'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply/andP;</span><span class="id"> split;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span> (<span class="id">@lt_trans</span><span class="id"> _</span><span class="id"> _</span><span class="id"> 0%R</span>)<span class="id"> //</span><span class="id"> subr_lt0</span><span class="id"> -lte_fin</span><span class="id"> -lt_contract</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> ltrNl</span><span class="id"> opprB</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> /e'</span><span class="gallina-kwd"> in</span><span class="id"> re'r'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">have</span><span class="id"> r're</span><span class="id"> :</span> (<span class="id">contract</span><span class="id"> r'%:E</span><span class="id"> &lt;</span><span class="id"> contract</span> (<span class="id">r%:E</span><span class="id"> +</span><span class="id"> e%:num%:E</span>))<span class="id">%R</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">move:</span><span class="id"> re'r';</span><span class="id"> rewrite</span><span class="id"> lt_min</span><span class="id"> =&gt;</span><span class="id"> /andP[_]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> ltrBlDr</span><span class="id"> subrK</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> ltrBlDr</span><span class="id"> -lte_fin</span><span class="id"> -</span>(<span class="id">contractK</span> (_<span class="id"> +</span><span class="id"> r</span>)<span class="id">%:E</span>)<span class="id">%R</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> addrC</span><span class="id"> -</span>(<span class="id">contractK</span><span class="id"> r'%:E</span>)<span class="id"> //</span><span class="id"> lt_expand</span><span class="id"> ?inE</span><span class="id"> ?contract_le1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">*</span><span class="id"> move=&gt;</span><span class="id"> /xsectionP/=;</span><span class="id"> rewrite</span><span class="id"> /ereal_ball</span><span class="id"> [contract</span><span class="id"> +oo]/=</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> lt_min</span><span class="id"> =&gt;</span><span class="id"> /andP[re'1</span><span class="id"> re'2]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">have</span><span class="id"> [cr0|cr0]</span><span class="id"> :=</span><span class="id"> lerP</span><span class="id"> 0</span> (<span class="id">contract</span><span class="id"> r%:E</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">move:</span><span class="id"> re'2;</span><span class="id"> rewrite</span><span class="id"> ler0_norm;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> subr_le0;</span><span class="id"> case/ler_normlP</span><span class="id"> :</span> (<span class="id">contract_le1</span><span class="id"> r%:E</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> opprB</span><span class="id"> ltrBrDl</span><span class="id"> addrCA</span><span class="id"> subrr</span><span class="id"> addr0</span><span class="id"> =&gt;</span><span class="id"> h</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exfalso</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">move:</span><span class="id"> h;</span><span class="id"> apply/negP;</span><span class="id"> rewrite</span><span class="id"> -leNgt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> case/ler_normlP</span><span class="id"> :</span> (<span class="id">contract_le1</span> (<span class="id">r%:E</span><span class="id"> +</span><span class="id"> e%:num%:E</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">move:</span><span class="id"> re'2;</span><span class="id"> rewrite</span><span class="id"> ler0_norm;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> subr_le0;</span><span class="id"> case/ler_normlP</span><span class="id"> :</span> (<span class="id">contract_le1</span><span class="id"> r%:E</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> opprB</span><span class="id"> ltrBrDl</span><span class="id"> addrCA</span><span class="id"> subrr</span><span class="id"> addr0</span><span class="id"> =&gt;</span><span class="id"> h</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exfalso</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">move:</span><span class="id"> h;</span><span class="id"> apply/negP;</span><span class="id"> rewrite</span><span class="id"> -leNgt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> case/ler_normlP</span><span class="id"> :</span> (<span class="id">contract_le1</span> (<span class="id">r%:E</span><span class="id"> +</span><span class="id"> e%:num%:E</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">*</span><span class="id"> move=&gt;</span><span class="id"> /xsectionP/=;</span><span class="id"> rewrite</span><span class="id"> /ereal_ball</span><span class="id"> [contract</span><span class="id"> -oo]/=</span><span class="id"> opprK</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> lt_min</span><span class="id"> =&gt;</span><span class="id"> /andP[re'1</span><span class="id"> _]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">move:</span><span class="id"> re'1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> ger0_norm;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> addrC</span><span class="id"> -lerBlDl</span><span class="id"> add0r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move:</span> (<span class="id">contract_le1</span><span class="id"> r%:E</span>)<span class="id">;</span><span class="id"> rewrite</span><span class="id"> ler_norml</span><span class="id"> =&gt;</span><span class="id"> /andP[]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> ltrD2l</span><span class="id"> =&gt;</span><span class="id"> h</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exfalso</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">move:</span><span class="id"> h;</span><span class="id"> apply/negP;</span><span class="id"> rewrite</span><span class="id"> -leNgt</span><span class="id"> -lerNl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move:</span> (<span class="id">contract_le1</span> (<span class="id">r%:E</span><span class="id"> -</span><span class="id"> e%:num%:E</span>))<span class="id">;</span><span class="id"> rewrite</span><span class="id"> ler_norml</span><span class="id"> =&gt;</span><span class="id"> /andP[]</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> exists</span> (<span class="id">diag</span> (<span class="id">1</span><span class="id"> -</span><span class="id"> contract</span><span class="id"> M%:E</span>))<span class="id">%R;</span><span class="id"> rewrite</span><span class="id"> /diag</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">exists</span> (<span class="id">1</span><span class="id"> -</span><span class="id"> contract</span><span class="id"> M%:E</span>)<span class="id">%R</span><span class="id"> =&gt;</span><span class="id"> //=</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> subr_gt0</span> (<span class="id">le_lt_trans</span><span class="id"> _</span> (<span class="id">contract_lt1</span><span class="id"> M</span>))<span class="id"> //</span><span class="id"> ler_norm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">case=&gt;</span><span class="id"> [r|</span><span class="id"> |]/=</span><span class="id"> /xsectionP/=</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">*</span><span class="id"> rewrite</span><span class="id"> /ereal_ball</span><span class="id"> [_</span><span class="id"> +oo]/=</span><span class="id"> =&gt;</span><span class="id"> rM1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> MA;</span><span class="id"> rewrite</span><span class="id"> lte_fin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> ger0_norm</span><span class="gallina-kwd"> in</span><span class="id"> rM1;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> subr_ge0</span><span class="id"> //</span> (<span class="id">le_trans</span><span class="id"> _</span> (<span class="id">contract_le1</span><span class="id"> r%:E</span>))<span class="id"> //</span><span class="id"> ler_norm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> ltrBlDr</span><span class="id"> addrC</span><span class="id"> addrCA</span><span class="id"> addrC</span><span class="id"> -ltrBlDr</span><span class="id"> subrr</span><span class="id"> subr_gt0</span><span class="gallina-kwd"> in</span><span class="id"> rM1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -lte_fin</span><span class="id"> -lt_contract</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">*</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> /ereal_ball</span><span class="id"> /=</span><span class="id"> subrr</span><span class="id"> normr0</span><span class="id"> =&gt;</span><span class="id"> h;</span><span class="id"> exact:</span><span class="id"> MA</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">*</span><span class="id"> rewrite</span><span class="id"> /ereal_ball</span><span class="id"> /=</span><span class="id"> opprK</span><span class="id"> =&gt;</span><span class="id"> h</span><span class="id"> {MA}</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exfalso</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">move:</span><span class="id"> h;</span><span class="id"> apply/negP</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -leNgt</span><span class="id"> [in</span><span class="id"> leRHS]ger0_norm</span><span class="id"> //</span><span class="id"> lerBlDr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -/</span>(<span class="id">contract</span><span class="id"> M%:E</span>)<span class="id"> addrC</span><span class="id"> -lerBlDr</span><span class="id"> opprD</span><span class="id"> addrA</span><span class="id"> subrr</span><span class="id"> sub0r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move:</span> (<span class="id">contract_le1</span><span class="id"> M%:E</span>)<span class="id">;</span><span class="id"> rewrite</span><span class="id"> ler_norml</span><span class="id"> =&gt;</span><span class="id"> /andP[]</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> exists</span> (<span class="id">diag</span> (<span class="id">1</span><span class="id"> +</span><span class="id"> contract</span><span class="id"> M%:E</span>)<span class="id">%R</span>)<span class="id">;</span><span class="id"> rewrite</span><span class="id"> /diag</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">exists</span> (<span class="id">1</span><span class="id"> +</span><span class="id"> contract</span><span class="id"> M%:E</span>)<span class="id">%R</span><span class="id"> =&gt;</span><span class="id"> //=</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -ltrBlDl</span><span class="id"> sub0r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move:</span> (<span class="id">contract_lt1</span><span class="id"> M</span>)<span class="id">;</span><span class="id"> rewrite</span><span class="id"> ltr_norml</span><span class="id"> =&gt;</span><span class="id"> /andP[]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">case=&gt;</span><span class="id"> [r|</span><span class="id"> |]</span><span class="id"> /xsectionP/=</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">*</span><span class="id"> rewrite</span><span class="id"> /ereal_ball</span><span class="id"> =&gt;</span><span class="id"> /=</span><span class="id"> rM1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> MA;</span><span class="id"> rewrite</span><span class="id"> lte_fin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> ler0_norm</span><span class="gallina-kwd"> in</span><span class="id"> rM1;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> lerBlDl</span><span class="id"> addr0</span><span class="id"> ltW</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move:</span> (<span class="id">contract_lt1</span><span class="id"> r</span>)<span class="id">;</span><span class="id"> rewrite</span><span class="id"> ltr_norml</span><span class="id"> =&gt;</span><span class="id"> /andP[]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> opprB</span><span class="id"> opprK</span><span class="id"> -ltrBlDl</span><span class="id"> addrK</span><span class="gallina-kwd"> in</span><span class="id"> rM1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -lte_fin</span><span class="id"> -lt_contract</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">*</span><span class="id"> rewrite</span><span class="id"> /ereal_ball</span><span class="id"> /=</span><span class="id"> -opprD</span><span class="id"> normrN</span><span class="id"> =&gt;</span><span class="id"> h</span><span class="id"> {MA}</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exfalso</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">move:</span><span class="id"> h;</span><span class="id"> apply/negP</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -leNgt</span><span class="id"> [in</span><span class="id"> leRHS]ger0_norm//</span><span class="id"> -lerBlDr</span><span class="id"> addrAC</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> subrr</span><span class="id"> add0r</span><span class="id"> -/</span>(<span class="id">contract</span><span class="id"> M%:E</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span> (<span class="id">le_trans</span><span class="id"> _</span> (<span class="id">ltW</span> (<span class="id">contract_lt1</span><span class="id"> M</span>)))<span class="id"> //</span><span class="id"> ler_norm</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">*</span><span class="id"> rewrite</span><span class="id"> /ereal_ball</span><span class="id"> /=</span><span class="id"> =&gt;</span><span class="id"> _;</span><span class="id"> exact:</span><span class="id"> MA</span>.<br/>
<span class="id">-</span><span class="id"> case:</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> [r</span><span class="id"> [E</span><span class="id"> [_/posnumP[e]</span><span class="id"> reA]</span><span class="id"> sEA]</span><span class="id"> |</span><span class="id"> [E</span><span class="id"> [_/posnumP[e]</span><span class="id"> reA]</span><span class="id"> sEA]</span><span class="id"> |</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">[E</span><span class="id"> [_/posnumP[e]</span><span class="id"> reA]</span><span class="id"> sEA]]</span><span class="id"> //=</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> apply</span><span class="id"> nbhs_fin_inbound</span><span class="gallina-kwd"> with</span><span class="id"> e</span><span class="id"> =&gt;</span><span class="id"> ?</span><span class="id"> ?;</span><span class="id"> exact/sEA/xsectionP/reA</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="id"> have</span><span class="id"> [|]</span><span class="id"> :=</span><span class="id"> boolP</span> (<span class="id">e%:num</span><span class="id"> &lt;=</span><span class="id"> 1</span>)<span class="id">%R</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move/nbhs_oo_up_e1;</span><span class="id"> apply</span><span class="id"> =&gt;</span><span class="id"> ?</span><span class="id"> ?;</span><span class="id"> exact/sEA/xsectionP/reA</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -ltNge</span><span class="id"> =&gt;</span><span class="id"> /nbhs_oo_up_1e;</span><span class="id"> apply</span><span class="id"> =&gt;</span><span class="id"> ?</span><span class="id"> ?;</span><span class="id"> exact/sEA/xsectionP/reA</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="id"> have</span><span class="id"> [|]</span><span class="id"> :=</span><span class="id"> boolP</span> (<span class="id">e%:num</span><span class="id"> &lt;=</span><span class="id"> 1</span>)<span class="id">%R</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">move/nbhs_oo_down_e1;</span><span class="id"> apply</span><span class="id"> =&gt;</span><span class="id"> ?</span><span class="id"> ?;</span><span class="id"> apply:</span><span class="id"> sEA</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /xsection/=</span><span class="id"> inE;</span><span class="id"> exact:</span><span class="id"> reA</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -ltNge</span><span class="id"> =&gt;/nbhs_oo_down_1e;</span><span class="id"> apply</span><span class="id"> =&gt;</span><span class="id"> ?</span><span class="id"> ?;</span><span class="id"> exact/sEA/xsectionP/reA</span>.<br/>
Qed.</div></details>
<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> Nbhs_isPseudoMetric</span>.<span class="id">Build</span><span class="id"> R</span> (<span class="id">\bar</span><span class="id"> R</span>)<br/>
&nbsp;&nbsp;<span class="id">ereal_nbhsE</span><span class="id"> ereal_ball_center</span><span class="id"> ereal_ball_sym</span><span class="id"> ereal_ball_triangle</span><span class="id"> erefl</span>.<br/>
<br/>
<span class="vernacular">End</span><span class="id"> ereal_PseudoMetric</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> nbhs_interval</span> (<span class="id">R</span><span class="id"> :</span><span class="id"> realFieldType</span>) (<span class="id">P</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="gallina-kwd"> Prop</span>) (<span class="id">r</span><span class="id"> :</span><span class="id"> R</span>) (<span class="id">a</span><span class="id"> b</span><span class="id"> :</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">a</span><span class="id"> &lt;</span><span class="id"> r%:E</span><span class="id"> -&gt;</span><span class="id"> r%:E</span><span class="id"> &lt;</span><span class="id"> b</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">forall</span><span class="id"> y,</span><span class="id"> a</span><span class="id"> &lt;</span><span class="id"> y%:E</span><span class="id"> -&gt;</span><span class="id"> y%:E</span><span class="id"> &lt;</span><span class="id"> b</span><span class="id"> -&gt;</span><span class="id"> P</span><span class="id"> y</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">nbhs</span><span class="id"> r</span><span class="id"> P</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move</span><span class="id"> =&gt;</span><span class="id"> ar</span><span class="id"> rb</span><span class="id"> abP;</span><span class="id"> case:</span> (<span class="id">lt_ereal_nbhs</span><span class="id"> ar</span><span class="id"> rb</span>)<span class="id"> =&gt;</span><span class="id"> d</span><span class="id"> rd</span>.<br/>
<span class="gallina-kwd">exists</span><span class="id"> d%:num</span><span class="id"> =&gt;</span><span class="id"> //=</span><span class="id"> y;</span><span class="id"> rewrite</span><span class="id"> /=</span><span class="id"> distrC</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> /rd</span><span class="id"> /andP[?</span><span class="id"> ?];</span><span class="id"> apply:</span><span class="id"> abP</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> ereal_dnbhs_le</span> (<span class="id">R</span><span class="id"> :</span><span class="id"> numFieldType</span>) (<span class="id">x</span><span class="id"> :</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">ereal_dnbhs</span><span class="id"> x</span><span class="id"> --&gt;</span><span class="id"> ereal_nbhs</span><span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move:</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> [r</span><span class="id"> P</span><span class="id"> [_/posnumP[e]</span><span class="id"> reP]</span><span class="id"> |r</span><span class="id"> P|r</span><span class="id"> P]</span><span class="id"> //=</span>.<br/>
<span class="gallina-kwd">by</span><span class="gallina-kwd"> exists</span><span class="id"> e%:num</span><span class="id"> =&gt;</span><span class="id"> //=</span><span class="id"> ?</span><span class="id"> ?</span><span class="id"> ?;</span><span class="id"> apply:</span><span class="id"> reP</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> ereal_dnbhs_le_finite</span> (<span class="id">R</span><span class="id"> :</span><span class="id"> numFieldType</span>) (<span class="id">r</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">ereal_dnbhs</span><span class="id"> r%:E</span><span class="id"> --&gt;</span><span class="id"> nbhs</span><span class="id"> r%:E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> P</span><span class="id"> [_/posnumP[e]</span><span class="id"> reP]</span><span class="id"> //=;</span><span class="gallina-kwd"> exists</span><span class="id"> e%:num</span><span class="id"> =&gt;</span><span class="id"> //=</span><span class="id"> ?</span><span class="id"> ?</span><span class="id"> ?;</span><span class="id"> exact:</span><span class="id"> reP</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Definition</span><span class="id"> ereal_loc_seq</span> (<span class="id">R</span><span class="id"> :</span><span class="id"> numDomainType</span>) (<span class="id">x</span><span class="id"> :</span><span class="id"> \bar</span><span class="id"> R</span>) (<span class="id">n</span><span class="id"> :</span><span class="id"> nat</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">match</span><span class="id"> x</span><span class="gallina-kwd"> with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">|</span><span class="id"> x%:E</span><span class="id"> =&gt;</span> (<span class="id">x</span><span class="id"> +</span> (<span class="id">n%:R</span><span class="id"> +</span><span class="id"> 1</span>)<span class="id">^-1</span>)<span class="id">%:E</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">|</span><span class="id"> +oo</span><span class="id"> =&gt;</span><span class="id"> n%:R%:E</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">|</span><span class="id"> -oo</span><span class="id"> =&gt;</span><span class="id"> -</span><span class="id"> n%:R%:E</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">end</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> cvg_ereal_loc_seq</span> (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>) (<span class="id">x</span><span class="id"> :</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">ereal_loc_seq</span><span class="id"> x</span> <span class="id"> @</span><span class="id"> \oo--&gt;</span><span class="id"> ereal_dnbhs</span><span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> P;</span><span class="id"> rewrite</span><span class="id"> /ereal_loc_seq</span>.<br/>
<span class="id">case:</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> /=</span><span class="id"> [x</span><span class="id"> [_/posnumP[d]</span><span class="id"> dP]</span><span class="id"> |[d</span><span class="id"> [dreal</span><span class="id"> dP]]</span><span class="id"> |[d</span><span class="id"> [dreal</span><span class="id"> dP]]];</span><span class="id"> last</span><span class="id"> 2</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">have</span><span class="id"> /natrP[N</span><span class="id"> Nfloor]</span><span class="id"> :</span><span class="id"> Num</span>.<span class="id">floor</span> (<span class="id">Num</span>.<span class="id">max</span><span class="id"> d</span><span class="id"> 0%R</span>)<span class="id"> \is</span><span class="id"> a</span><span class="id"> Num</span>.<span class="id">nat</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> Znat_def</span><span class="id"> floor_ge0</span><span class="id"> le_max</span><span class="id"> lexx</span><span class="id"> orbC</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">exists</span><span class="id"> N</span>.<span class="id">+1</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> n</span><span class="id"> ltNn;</span><span class="id"> apply:</span><span class="id"> dP;</span><span class="id"> rewrite</span><span class="id"> lte_fin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">have</span><span class="id"> /le_lt_trans</span><span class="id"> :</span> (<span class="id">d</span><span class="id"> &lt;=</span><span class="id"> Num</span>.<span class="id">max</span><span class="id"> d</span><span class="id"> 0</span>)<span class="id">%R</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> le_max</span><span class="id"> lexx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply;</span><span class="id"> rewrite</span> (<span class="id">lt_le_trans</span> (<span class="id">lt_succ_floor</span><span class="id"> _</span>))<span class="id">//</span><span class="id"> Nfloor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> natr1</span><span class="id"> mulrz_nat</span><span class="id"> ler_nat</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> /natrP[N</span><span class="id"> Nfloor]</span><span class="id"> :</span><span class="id"> Num</span>.<span class="id">floor</span> (<span class="id">Num</span>.<span class="id">max</span> (<span class="id">-</span><span class="id"> d</span>)<span class="id">%R</span><span class="id"> 0%R</span>)<span class="id"> \is</span><span class="id"> a</span><span class="id"> Num</span>.<span class="id">nat</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> Znat_def</span><span class="id"> floor_ge0</span><span class="id"> le_max</span><span class="id"> lexx</span><span class="id"> orbC</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">exists</span><span class="id"> N</span>.<span class="id">+1</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> n</span><span class="id"> ltNn;</span><span class="id"> apply:</span><span class="id"> dP;</span><span class="id"> rewrite</span><span class="id"> lte_fin</span><span class="id"> ltrNl</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> /le_lt_trans</span><span class="id"> :</span> (<span class="id">-</span><span class="id"> d</span><span class="id"> &lt;=</span><span class="id"> Num</span>.<span class="id">max</span> (<span class="id">-</span><span class="id"> d</span>)<span class="id"> 0</span>)<span class="id">%R</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> le_max</span><span class="id"> lexx</span>.<br/>
&nbsp;&nbsp;<span class="id">apply;</span><span class="id"> rewrite</span> (<span class="id">lt_le_trans</span> (<span class="id">lt_succ_floor</span><span class="id"> _</span>))<span class="id">//</span><span class="id"> Nfloor</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> natr1</span><span class="id"> mulrz_nat</span><span class="id"> ler_nat</span>.<br/>
<span class="id">have</span><span class="id"> /natrP[N</span><span class="id"> Nfloor]</span><span class="id"> :</span><span class="id"> Num</span>.<span class="id">floor</span><span class="id"> d%:num^-1</span><span class="id"> \is</span><span class="id"> a</span><span class="id"> Num</span>.<span class="id">nat</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> Znat_def</span><span class="id"> floor_ge0</span>.<br/>
<span class="gallina-kwd">exists</span><span class="id"> N</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> n</span><span class="id"> leNn;</span><span class="id"> apply:</span><span class="id"> dP;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> eq_sym</span><span class="id"> addrC</span><span class="id"> -subr_eq</span><span class="id"> subrr</span><span class="id"> eq_sym;</span><span class="id"> exact/invr_neq0/lt0r_neq0</span>.<br/>
<span class="id">rewrite</span><span class="id"> /=</span><span class="id"> opprD</span><span class="id"> addrA</span><span class="id"> subrr</span><span class="id"> distrC</span><span class="id"> subr0</span><span class="id"> gtr0_norm;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> invr_gt0</span>.<br/>
<span class="id">rewrite</span><span class="id"> -[ltLHS]mulr1</span><span class="id"> ltr_pdivrMl</span><span class="id"> //</span><span class="id"> -ltr_pdivrMr</span><span class="id"> //</span><span class="id"> div1r</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span> (<span class="id">lt_le_trans</span> (<span class="id">lt_succ_floor</span><span class="id"> _</span>))<span class="id">//</span><span class="id"> Nfloor</span><span class="id"> !natr1</span><span class="id"> mulrz_nat</span><span class="id"> ler_nat</span>.<br/>
Qed.</div></details>

      <div class="footer"><hr/>Generated by <a href="https://github.com/yoshihiro503/coq2html/">a fork of coq2html</a></div>
    </div>
  </div>
    </main>
</body>
</html>
