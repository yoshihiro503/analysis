
<!DOCTYPE html>
<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Module mathcomp.classical.functions</title>
<meta name="description" content="Documentation of Coq module mathcomp.classical.functions" />
<link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.css">
<script src="https://cdn.jsdelivr.net/npm/markdown-it/dist/markdown-it.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/markdown-it-texmath/texmath.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/darkmode-js@1.5.7/lib/darkmode-js.min.js"></script>
<link href="coq2html.css" rel="stylesheet" type="text/css" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script type="text/javascript" src="coq2html.js"> </script>
</head>

<body onload="init()">

  <main>
    <div class="sidebar">
      <h2>Files</h2>
      
    </div>

  <div class="coq">

    <div class="content">
      <p><a href="./index.html">Top</a></p>
      <h1 class="title">Module mathcomp.classical.functions</h1>
<span class="vernacular">From</span><span class="id"> mathcomp</span><span class="vernacular"> Require</span><span class="vernacular"> Import</span><span class="id"> all_ssreflect</span><span class="id"> finmap</span><span class="id"> ssralg</span><span class="id"> ssrnum</span><span class="id"> ssrint</span><span class="id"> rat</span>.<br/>
<span class="vernacular">From</span><span class="id"> HB</span><span class="vernacular"> Require</span><span class="vernacular"> Import</span><span class="id"> structures</span>.<br/>
<span class="vernacular">From</span><span class="id"> mathcomp</span><span class="vernacular"> Require</span><span class="vernacular"> Import</span><span class="id"> mathcomp_extra</span><span class="id"> boolp</span><span class="id"> classical_sets</span>.<br/>
<span class="id">Add</span><span class="id"> Search</span><span class="id"> Blacklist</span> <span class="id">&quot;__canonical__&quot;</span>.<br/>
<span class="id">Add</span><span class="id"> Search</span><span class="id"> Blacklist</span> <span class="id">&quot;__functions_&quot;</span>.<br/>
<span class="id">Add</span><span class="id"> Search</span><span class="id"> Blacklist</span> <span class="id">&quot;_factory_&quot;</span>.<br/>
<span class="id">Add</span><span class="id"> Search</span><span class="id"> Blacklist</span> <span class="id">&quot;_mixin_&quot;</span>.<br/>
<br/>
<div class="ssrdoc md">
# Theory of functions

This file provides a theory of functions $f : A\to B$ whose domain $A$
and codomain $B$ are represented by sets.

```
         set_fun A B f == f : aT -&gt; rT is a function with domain
                          A : set aT and codomain B : set rT
        set_surj A B f == f is surjective
         set_inj A B f == f is injective
         set_bij A B f == f is bijective

         {fun A &gt;-&gt; B} == type of functions f : aT -&gt; rT from A : set aT
                          to B : set rT
                          `funS f` is a proof of `set_fun A B f`.
      {oinv aT &gt;-&gt; rT} == type of functions with a partial inverse
     {oinvfun A &gt;-&gt; B} == combination of {fun A &gt;-&gt; B} and
                          {oinv aT &gt;-&gt; rT}
       {inv aT &gt;-&gt; rT} == type of functions with an inverse
                 f ^-1 == inverse of f : {inv aT &gt;-&gt; rT}
      {invfun A &gt;-&gt; B} == combination of {fun A &gt;-&gt; B} and {inv aT &gt;-&gt; rT}
        {surj A &gt;-&gt; B} == type of surjective functions
     {surjfun A &gt;-&gt; B} == combination of {fun A &gt;-&gt; B} and {surj A &gt;-&gt; B}
   {splitsurj A &gt;-&gt; B} == type of surjective functions with an inverse
{splitsurjfun A &gt;-&gt; B} == combination of {fun A &gt;-&gt; B} and
                          {splitsurj A &gt;-&gt; B}
        {inj A &gt;-&gt; rT} == type of injective functions
      {injfun A &gt;-&gt; B} == combination of {fun A &gt;-&gt; B} and {inj A &gt;-&gt; rT}
    {splitinj A &gt;-&gt; B} == type of injective functions with an inverse
 {splitinjfun A &gt;-&gt; B} == combination of {fun A &gt;-&gt; B} and
                          {splitinj A &gt;-&gt; B}
         {bij A &gt;-&gt; B} == combination of {injfun A &gt;-&gt; B} and
                          {surjfun A &gt;-&gt; B}
    {splitbij A &gt;-&gt; B} == combination of {splitinj A &gt;-&gt; B} and
                          {splitsurj A &gt;-&gt; B}
               'inj_ f == proof of {in A &amp;, injective f} where f has type
                          {splitinj A &gt;-&gt; _}
```

```
          [fun f in A] == the function f from the set A to the set f @` A
                          with f : aT -&gt; rT and A : set aT
                          This is a notation for funin A f, which is an HB
                          alias.
           'split_ d f == partial injection from aT : Type to rT : Type,
                          f : aT -&gt; rT, and d : rT -&gt; aT
                          This is a notation for split_ d f which is an HB
                          alias.
                 split := 'split_(fun=&gt; point)
            @to_setT T == function that associates to x : T a dependent
                          pair of x with a proof that x belongs to setT
                          (i.e., the type set_type [set: T])
               incl AB == identity function from T to T, where AB is a
                          proof of A `&lt;=` B, with A, B : set T
               inclT A := incl (@subsetT _ _)
             eqincl AB == identity function from T to T, where AB is a
                          proof of A = B, with A, B : set T
             mkfun fAB == builds a function {fun A &gt;-&gt; B} given a function
                          f : aT -&gt; rT and a proof fAB that
                          {homo f : x / A x &gt;-&gt; B x}
          @set_val T A == injection from set_type A to T, where A has
                          type set T
            @ssquash T == function of type
                          {splitsurj [set: T] &gt;-&gt; [set: $| T |]}
       @finset_val T X == function that turns an element x : X
                          (with X : {fset T}) into a dependent pair of x
                          with a proof that x belongs to X
                          (i.e., the type set_type [set` X])
       @val_finset T X == function of type [set` X] -&gt; X with X : {fset T}
                          that cancels finset_val
        glue XY AB f g == function that behaves as f over X, as g over Y
                          XY is a proof that sets X and Y are disjoint,
                          AB is a proof that sets A and B are disjoint,
                          A and B are intended to be the ranges of f and g
          'pinv_ d A f == inverse of the function [fun f in A] over
                          f @` A, function d outside of f @` A
                          This is a notation for pinv_ which is defined as
                          the inverse of a partial injection ('split_).
                  pinv := 'pinv_(fun=&gt; point)
```

## Function restriction
```
           patch d A f == "partial function" that behaves as the function
                          f over the set A and as the function d otherwise
          restrict D f := patch (fun=&gt; point) D f
                f \_ D := restrict D f
              sigL A f == "left restriction"; given a set A : set U and a
                          function f : U -&gt; V, returns the corresponding
                          function of type set_type A -&gt; V
              sigR A f == "right restriction"; given a set B : set V and a
                          function f : {fun [set: U] &gt;-&gt; B}, returns the
                          corresponding function of type U -&gt; set_type B
           sigLR A B f == the function of type set_type A -&gt; set_type B
                          corresponding to f : {fun A &gt;-&gt; B}
               valL_ v == function cancelled by sigL A, with A : set U and
                          v : V
                valR f == the function of type U -&gt; V corresponding to
                          f : U -&gt; set_type B, with B : set V
              valR_fun == the function of type {fun [set: U] &gt;-&gt; B}
                          corresponding to f : U -&gt; set_type B, with
                          B : set V
             valLR v f == the function of type U -&gt; V corresponding to
                          f : set_type A -&gt; set_type B (where v : V),
                          i.e., 'valL_ v \o valR_fun
      valLfun_ v A B f := [fun of valL_ f] with f : {fun [set: A] &gt;-&gt; B}
                  valL := 'valL_ point
            valLRfun v := 'valLfun_ v \o valR_fun
```

```
Section function_space == canonical ringType and lmodType
                          structures for functions whose range is
                          a ringType, comRingType, or lmodType.
                  fctE == multi-rule for fct
```

</div>
<br/>
<span class="gallina-kwd">Set</span><span class="vernacular"> Implicit</span><span class="vernacular"> Arguments</span>.<br/>
<span class="vernacular">Unset</span><span class="vernacular"> Strict</span><span class="vernacular"> Implicit</span>.<br/>
<span class="vernacular">Unset</span><span class="vernacular"> Printing</span><span class="vernacular"> Implicit</span><span class="vernacular"> Defensive</span>.<br/>
<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;f \_ D&quot;</span> (<span class="gallina-kwd">at</span><span class="id"> level</span><span class="id"> 10</span>).<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;'{' 'fun' A '&gt;-&gt;' B '}'&quot;</span><br/>
&nbsp;&nbsp;(<span class="id">format</span> <span class="id">&quot;'{' 'fun'  A  '&gt;-&gt;'  B '}'&quot;</span>).<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;'{' 'oinv' T '&gt;-&gt;' U '}'&quot;</span><br/>
&nbsp;&nbsp;(<span class="id">format</span> <span class="id">&quot;'{' 'oinv'  T  '&gt;-&gt;'  U '}'&quot;</span>).<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;'{' 'inv' T '&gt;-&gt;' U '}'&quot;</span><br/>
&nbsp;&nbsp;(<span class="id">format</span> <span class="id">&quot;'{' 'inv'  T  '&gt;-&gt;'  U '}'&quot;</span>).<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;'{' 'oinvfun' T '&gt;-&gt;' U '}'&quot;</span><br/>
&nbsp;&nbsp;(<span class="id">format</span> <span class="id">&quot;'{' 'oinvfun'  T  '&gt;-&gt;'  U '}'&quot;</span>).<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;'{' 'invfun' T '&gt;-&gt;' U '}'&quot;</span><br/>
&nbsp;&nbsp;(<span class="id">format</span> <span class="id">&quot;'{' 'invfun'  T  '&gt;-&gt;'  U '}'&quot;</span>).<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;'{' 'inj' A '&gt;-&gt;' T '}'&quot;</span><br/>
&nbsp;&nbsp;(<span class="id">format</span> <span class="id">&quot;'{' 'inj'  A  '&gt;-&gt;'  T '}'&quot;</span>).<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;'{' 'splitinj' A '&gt;-&gt;' T '}'&quot;</span><br/>
&nbsp;&nbsp;(<span class="id">format</span> <span class="id">&quot;'{' 'splitinj'  A  '&gt;-&gt;'  T '}'&quot;</span>).<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;'{' 'surj' A '&gt;-&gt;' B '}'&quot;</span><br/>
&nbsp;&nbsp;(<span class="id">format</span> <span class="id">&quot;'{' 'surj'  A  '&gt;-&gt;'  B '}'&quot;</span>).<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;'{' 'splitsurj' A '&gt;-&gt;' B '}'&quot;</span><br/>
&nbsp;&nbsp;(<span class="id">format</span> <span class="id">&quot;'{' 'splitsurj'  A  '&gt;-&gt;'  B '}'&quot;</span>).<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;'{' 'injfun' A '&gt;-&gt;' B '}'&quot;</span><br/>
&nbsp;&nbsp;(<span class="id">format</span> <span class="id">&quot;'{' 'injfun'  A  '&gt;-&gt;'  B '}'&quot;</span>).<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;'{' 'surjfun' A '&gt;-&gt;' B '}'&quot;</span><br/>
&nbsp;&nbsp;(<span class="id">format</span> <span class="id">&quot;'{' 'surjfun'  A  '&gt;-&gt;'  B '}'&quot;</span>).<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;'{' 'splitinjfun' A '&gt;-&gt;' B '}'&quot;</span><br/>
&nbsp;&nbsp;(<span class="id">format</span> <span class="id">&quot;'{' 'splitinjfun'  A  '&gt;-&gt;'  B '}'&quot;</span>).<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;'{' 'splitsurjfun' A '&gt;-&gt;' B '}'&quot;</span><br/>
&nbsp;&nbsp;(<span class="id">format</span> <span class="id">&quot;'{' 'splitsurjfun'  A  '&gt;-&gt;'  B '}'&quot;</span>).<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;'{' 'bij' A '&gt;-&gt;' B '}'&quot;</span><br/>
&nbsp;&nbsp;(<span class="id">format</span> <span class="id">&quot;'{' 'bij'  A  '&gt;-&gt;'  B '}'&quot;</span>).<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;'{' 'splitbij' A '&gt;-&gt;' B '}'&quot;</span><br/>
&nbsp;&nbsp;(<span class="id">format</span> <span class="id">&quot;'{' 'splitbij'  A  '&gt;-&gt;'  B '}'&quot;</span>).<br/>
<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;[ 'fun' 'of' f ]&quot;</span> (<span class="id">format</span> <span class="id">&quot;[ 'fun'  'of'  f ]&quot;</span>).<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;[ 'oinv' 'of' f ]&quot;</span> (<span class="id">format</span> <span class="id">&quot;[ 'oinv'  'of'  f ]&quot;</span>).<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;[ 'inv' 'of' f ]&quot;</span> (<span class="id">format</span> <span class="id">&quot;[ 'inv'  'of'  f ]&quot;</span>).<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;[ 'oinv' 'of' f ]&quot;</span> (<span class="id">format</span> <span class="id">&quot;[ 'oinv'  'of'  f ]&quot;</span>).<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;[ 'inv' 'of' f ]&quot;</span> (<span class="id">format</span> <span class="id">&quot;[ 'inv'  'of'  f ]&quot;</span>).<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;[ 'inj' 'of' f ]&quot;</span> (<span class="id">format</span> <span class="id">&quot;[ 'inj'  'of'  f ]&quot;</span>).<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;[ 'splitinj' 'of' f ]&quot;</span> (<span class="id">format</span> <span class="id">&quot;[ 'splitinj'  'of'  f ]&quot;</span>).<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;[ 'surj' 'of' f ]&quot;</span> (<span class="id">format</span> <span class="id">&quot;[ 'surj'  'of'  f ]&quot;</span>).<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;[ 'splitsurj' 'of' f ]&quot;</span> (<span class="id">format</span> <span class="id">&quot;[ 'splitsurj'  'of'  f ]&quot;</span>).<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;[ 'injfun' 'of' f ]&quot;</span> (<span class="id">format</span> <span class="id">&quot;[ 'injfun'  'of'  f ]&quot;</span>).<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;[ 'surjfun' 'of' f ]&quot;</span> (<span class="id">format</span> <span class="id">&quot;[ 'surjfun'  'of'  f ]&quot;</span>).<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;[ 'splitinjfun' 'of' f ]&quot;</span><br/>
&nbsp;&nbsp;(<span class="id">format</span> <span class="id">&quot;[ 'splitinjfun'  'of'  f ]&quot;</span>).<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;[ 'splitsurjfun' 'of' f ]&quot;</span><br/>
&nbsp;&nbsp;(<span class="id">format</span> <span class="id">&quot;[ 'splitsurjfun'  'of'  f ]&quot;</span>).<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;[ 'bij' 'of' f ]&quot;</span> (<span class="id">format</span> <span class="id">&quot;[ 'bij'  'of'  f ]&quot;</span>).<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;[ 'splitbij' 'of' f ]&quot;</span> (<span class="id">format</span> <span class="id">&quot;[ 'splitbij'  'of'  f ]&quot;</span>).<br/>
<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;''oinv_' f&quot;</span> (<span class="gallina-kwd">at</span><span class="id"> level</span><span class="id"> 8,</span><span class="id"> f</span><span class="gallina-kwd"> at</span><span class="id"> level</span><span class="id"> 2,</span><span class="id"> format</span> <span class="id">&quot;''oinv_' f&quot;</span>).<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;''funS_' f&quot;</span> (<span class="gallina-kwd">at</span><span class="id"> level</span><span class="id"> 8,</span><span class="id"> f</span><span class="gallina-kwd"> at</span><span class="id"> level</span><span class="id"> 2,</span><span class="id"> format</span> <span class="id">&quot;''funS_' f&quot;</span>).<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;''mem_fun_' f&quot;</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">at</span><span class="id"> level</span><span class="id"> 8,</span><span class="id"> f</span><span class="gallina-kwd"> at</span><span class="id"> level</span><span class="id"> 2,</span><span class="id"> format</span>  <span class="id">&quot;''mem_fun_' f&quot;</span>).<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;''oinvK_' f&quot;</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">at</span><span class="id"> level</span><span class="id"> 8,</span><span class="id"> f</span><span class="gallina-kwd"> at</span><span class="id"> level</span><span class="id"> 2,</span><span class="id"> format</span> <span class="id">&quot;''oinvK_' f&quot;</span>).<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;''oinvS_' f&quot;</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">at</span><span class="id"> level</span><span class="id"> 8,</span><span class="id"> f</span><span class="gallina-kwd"> at</span><span class="id"> level</span><span class="id"> 2,</span><span class="id"> format</span> <span class="id">&quot;''oinvS_' f&quot;</span>).<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;''oinvP_' f&quot;</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">at</span><span class="id"> level</span><span class="id"> 8,</span><span class="id"> f</span><span class="gallina-kwd"> at</span><span class="id"> level</span><span class="id"> 2,</span><span class="id"> format</span> <span class="id">&quot;''oinvP_' f&quot;</span>).<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;''oinvT_' f&quot;</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">at</span><span class="id"> level</span><span class="id"> 8,</span><span class="id"> f</span><span class="gallina-kwd"> at</span><span class="id"> level</span><span class="id"> 2,</span><span class="id"> format</span> <span class="id">&quot;''oinvT_' f&quot;</span>).<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;''invK_' f&quot;</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">at</span><span class="id"> level</span><span class="id"> 8,</span><span class="id"> f</span><span class="gallina-kwd"> at</span><span class="id"> level</span><span class="id"> 2,</span><span class="id"> format</span> <span class="id">&quot;''invK_' f&quot;</span>).<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;''invS_' f&quot;</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">at</span><span class="id"> level</span><span class="id"> 8,</span><span class="id"> f</span><span class="gallina-kwd"> at</span><span class="id"> level</span><span class="id"> 2,</span><span class="id"> format</span> <span class="id">&quot;''invS_' f&quot;</span>).<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;''funoK_' f&quot;</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">at</span><span class="id"> level</span><span class="id"> 8,</span><span class="id"> f</span><span class="gallina-kwd"> at</span><span class="id"> level</span><span class="id"> 2,</span><span class="id"> format</span> <span class="id">&quot;''funoK_' f&quot;</span>).<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;''inj_' f&quot;</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">at</span><span class="id"> level</span><span class="id"> 8,</span><span class="id"> f</span><span class="gallina-kwd"> at</span><span class="id"> level</span><span class="id"> 2,</span><span class="id"> format</span> <span class="id">&quot;''inj_' f&quot;</span>).<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;''funK_' f&quot;</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">at</span><span class="id"> level</span><span class="id"> 8,</span><span class="id"> f</span><span class="gallina-kwd"> at</span><span class="id"> level</span><span class="id"> 2,</span><span class="id"> format</span> <span class="id">&quot;''funK_' f&quot;</span>).<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;''totalfun_' A&quot;</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">at</span><span class="id"> level</span><span class="id"> 8,</span><span class="id"> A</span><span class="gallina-kwd"> at</span><span class="id"> level</span><span class="id"> 2,</span><span class="id"> format</span> <span class="id">&quot;''totalfun_' A&quot;</span>).<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;''surj_' f&quot;</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">at</span><span class="id"> level</span><span class="id"> 8,</span><span class="id"> f</span><span class="gallina-kwd"> at</span><span class="id"> level</span><span class="id"> 2,</span><span class="id"> format</span> <span class="id">&quot;''surj_' f&quot;</span>).<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;''split_' a&quot;</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">at</span><span class="id"> level</span><span class="id"> 8,</span><span class="id"> a</span><span class="gallina-kwd"> at</span><span class="id"> level</span><span class="id"> 2,</span><span class="id"> format</span> <span class="id">&quot;''split_' a&quot;</span>).<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;''bijTT_'  f&quot;</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">at</span><span class="id"> level</span><span class="id"> 8,</span><span class="id"> f</span><span class="gallina-kwd"> at</span><span class="id"> level</span><span class="id"> 2,</span><span class="id"> format</span> <span class="id">&quot;''bijTT_' f&quot;</span>).<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;''bij_' f&quot;</span> (<span class="gallina-kwd">at</span><span class="id"> level</span><span class="id"> 8,</span><span class="id"> f</span><span class="gallina-kwd"> at</span><span class="id"> level</span><span class="id"> 2,</span><span class="id"> format</span> <span class="id">&quot;''bij_' f&quot;</span>).<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;''valL_' v&quot;</span> (<span class="gallina-kwd">at</span><span class="id"> level</span><span class="id"> 8,</span><span class="id"> v</span><span class="gallina-kwd"> at</span><span class="id"> level</span><span class="id"> 2,</span><span class="id"> format</span> <span class="id">&quot;''valL_' v&quot;</span>).<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;''valLfun_' v&quot;</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">at</span><span class="id"> level</span><span class="id"> 8,</span><span class="id"> v</span><span class="gallina-kwd"> at</span><span class="id"> level</span><span class="id"> 2,</span><span class="id"> format</span> <span class="id">&quot;''valLfun_' v&quot;</span>).<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;''pinv_' dflt&quot;</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">at</span><span class="id"> level</span><span class="id"> 8,</span><span class="id"> dflt</span><span class="gallina-kwd"> at</span><span class="id"> level</span><span class="id"> 2,</span><span class="id"> format</span> <span class="id">&quot;''pinv_' dflt&quot;</span>).<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;''pPbij_' dflt&quot;</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">at</span><span class="id"> level</span><span class="id"> 8,</span><span class="id"> dflt</span><span class="gallina-kwd"> at</span><span class="id"> level</span><span class="id"> 2,</span><span class="id"> format</span> <span class="id">&quot;''pPbij_' dflt&quot;</span>).<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;''pPinj_' dflt&quot;</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">at</span><span class="id"> level</span><span class="id"> 8,</span><span class="id"> dflt</span><span class="gallina-kwd"> at</span><span class="id"> level</span><span class="id"> 2,</span><span class="id"> format</span> <span class="id">&quot;''pPinj_' dflt&quot;</span>).<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;''injpPfun_' dflt&quot;</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">at</span><span class="id"> level</span><span class="id"> 8,</span><span class="id"> dflt</span><span class="gallina-kwd"> at</span><span class="id"> level</span><span class="id"> 2,</span><span class="id"> format</span> <span class="id">&quot;''injpPfun_' dflt&quot;</span>).<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;''funpPinj_' dflt&quot;</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">at</span><span class="id"> level</span><span class="id"> 8,</span><span class="id"> dflt</span><span class="gallina-kwd"> at</span><span class="id"> level</span><span class="id"> 2,</span><span class="id"> format</span> <span class="id">&quot;''funpPinj_' dflt&quot;</span>).<br/>
<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> classical_set_scope</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> MainProperties</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {aT</span><span class="id"> rT}</span>  (<span class="id">A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT</span>) (<span class="id">B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> rT</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> aT</span><span class="id"> -&gt;</span><span class="id"> rT</span>).<br/>
<span class="vernacular">Definition</span><span class="id"> set_fun</span><span class="id"> :=</span><span class="id"> {homo</span><span class="id"> f</span><span class="id"> :</span><span class="id"> x</span><span class="id"> /</span><span class="id"> A</span><span class="id"> x</span><span class="id"> &gt;-&gt;</span><span class="id"> B</span><span class="id"> x}</span>.<br/>
<span class="vernacular">Definition</span><span class="id"> set_surj</span><span class="id"> :=</span><span class="id"> B</span><span class="id"> `&lt;=`</span><span class="id"> f</span><span class="id"> @`</span><span class="id"> A</span>.<br/>
<span class="vernacular">Definition</span><span class="id"> set_inj</span><span class="id"> :=</span><span class="id"> {in</span><span class="id"> A</span><span class="id"> &amp;,</span><span class="id"> injective</span><span class="id"> f}</span>.<br/>
<span class="vernacular">Definition</span><span class="id"> set_bij</span><span class="id"> :=</span><span class="id"> [/\</span><span class="id"> set_fun,</span><span class="id"> set_inj</span><span class="id"> &amp;</span><span class="id"> set_surj]</span>.<br/>
<span class="vernacular">End</span><span class="id"> MainProperties</span>.<br/>
<br/>
<span class="id">HB</span>.<span class="id">mixin</span><span class="vernacular"> Record</span><span class="id"> isFun</span><span class="id"> {aT</span><span class="id"> rT}</span> (<span class="id">A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT</span>) (<span class="id">B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> rT</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> aT</span><span class="id"> -&gt;</span><span class="id"> rT</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">{</span><span class="id"> funS</span><span class="id"> :</span><span class="id"> set_fun</span><span class="id"> A</span><span class="id"> B</span><span class="id"> f</span><span class="id"> }</span>.<br/>
<span class="id">HB</span>.<span class="id">structure</span><span class="vernacular"> Definition</span><span class="id"> Fun</span><span class="id"> {aT</span><span class="id"> rT}</span> (<span class="id">A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT</span>) (<span class="id">B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> rT</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">{</span><span class="id"> f</span><span class="id"> of</span><span class="id"> isFun</span><span class="id"> _</span><span class="id"> _</span><span class="id"> A</span><span class="id"> B</span><span class="id"> f</span><span class="id"> }</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;{ 'fun' A &gt;-&gt; B }&quot;</span><span class="id"> :=</span> (<span class="id">@Fun</span>.<span class="id">type</span><span class="id"> _</span><span class="id"> _</span><span class="id"> A</span><span class="id"> B</span>)<span class="id"> :</span><span class="id"> form_scope</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;[ 'fun'  'of'  f ]&quot;</span><span class="id"> :=</span><span class="id"> [the</span><span class="id"> {fun</span><span class="id"> _</span><span class="id"> &gt;-&gt;</span><span class="id"> _}</span><span class="id"> of</span><span class="id"> f</span><span class="id"> :</span><span class="id"> _</span><span class="id"> -&gt;</span><span class="id"> _]</span><span class="id"> :</span><span class="id"> form_scope</span>.<br/>
<br/>
<span class="id">HB</span>.<span class="id">mixin</span><span class="vernacular"> Record</span><span class="id"> OInv</span><span class="id"> {aT</span><span class="id"> rT}</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> aT</span><span class="id"> -&gt;</span><span class="id"> rT</span>)<span class="id"> :=</span><span class="id"> {</span><span class="id"> oinv</span><span class="id"> :</span><span class="id"> rT</span><span class="id"> -&gt;</span><span class="id"> option</span><span class="id"> aT</span><span class="id"> }</span>.<br/>
<span class="id">HB</span>.<span class="id">structure</span><span class="vernacular"> Definition</span><span class="id"> OInversible</span><span class="id"> aT</span><span class="id"> rT</span><span class="id"> :=</span><span class="id"> {f</span><span class="id"> of</span><span class="id"> OInv</span><span class="id"> aT</span><span class="id"> rT</span><span class="id"> f}</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;{ 'oinv' aT &gt;-&gt; rT }&quot;</span><span class="id"> :=</span> (<span class="id">@OInversible</span>.<span class="id">type</span><span class="id"> aT</span><span class="id"> rT</span>)<span class="id"> :</span><span class="id"> type_scope</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;[ 'oinv'  'of'  f ]&quot;</span><span class="id"> :=</span><span class="id"> [the</span><span class="id"> {oinv</span><span class="id"> _</span><span class="id"> &gt;-&gt;</span><span class="id"> _}</span><span class="id"> of</span><span class="id"> f</span><span class="id"> :</span><span class="id"> _</span><span class="id"> -&gt;</span><span class="id"> _]</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">form_scope</span>.<br/>
<span class="vernacular">Definition</span><span class="id"> phant_oinv</span><span class="id"> aT</span><span class="id"> rT</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {oinv</span><span class="id"> aT</span><span class="id"> &gt;-&gt;</span><span class="id"> rT}</span>)<br/>
&nbsp;&nbsp;<span class="id">of</span><span class="id"> phantom</span> (_<span class="id"> -&gt;</span><span class="id"> _</span>)<span class="id"> f</span><span class="id"> :=</span><span class="id"> @oinv</span><span class="id"> _</span><span class="id"> _</span><span class="id"> f</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;''oinv_' f&quot;</span><span class="id"> :=</span> (<span class="id">@phant_oinv</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">Phantom</span> (_<span class="id"> -&gt;</span><span class="id"> _</span>)<span class="id"> f%FUN</span>)).<br/>
<br/>
<span class="id">HB</span>.<span class="id">structure</span><span class="vernacular"> Definition</span><span class="id"> OInvFun</span><span class="id"> aT</span><span class="id"> rT</span><span class="id"> A</span><span class="id"> B</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">{f</span><span class="id"> of</span><span class="id"> OInv</span><span class="id"> aT</span><span class="id"> rT</span><span class="id"> f</span><span class="id"> &amp;</span><span class="id"> isFun</span><span class="id"> aT</span><span class="id"> rT</span><span class="id"> A</span><span class="id"> B</span><span class="id"> f}</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;{ 'oinvfun' A &gt;-&gt; B }&quot;</span><span class="id"> :=</span> (<span class="id">@OInvFun</span>.<span class="id">type</span><span class="id"> _</span><span class="id"> _</span><span class="id"> A</span><span class="id"> B</span>)<span class="id"> :</span><span class="id"> type_scope</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;[ 'oinvfun'  'of'  f ]&quot;</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">[the</span><span class="id"> {oinvfun</span><span class="id"> _</span><span class="id"> &gt;-&gt;</span><span class="id"> _}</span><span class="id"> of</span><span class="id"> f</span><span class="id"> :</span><span class="id"> _</span><span class="id"> -&gt;</span><span class="id"> _]</span><span class="id"> :</span><span class="id"> form_scope</span>.<br/>
<br/>
<span class="id">HB</span>.<span class="id">mixin</span><span class="vernacular"> Record</span><span class="id"> OInv_Inv</span><span class="id"> {aT</span><span class="id"> rT}</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> aT</span><span class="id"> -&gt;</span><span class="id"> rT</span>)<span class="id"> of</span><span class="id"> OInv</span><span class="id"> _</span><span class="id"> _</span><span class="id"> f</span><span class="id"> :=</span><span class="id"> {</span><br/>
&nbsp;&nbsp;<span class="id">inv</span><span class="id"> :</span><span class="id"> rT</span><span class="id"> -&gt;</span><span class="id"> aT;</span><br/>
&nbsp;&nbsp;<span class="id">oliftV</span><span class="id"> :</span><span class="id"> olift</span><span class="id"> inv</span><span class="id"> =</span><span class="id"> 'oinv_f</span><br/>
<span class="id">}</span>.<br/>
<br/>
<span class="id">HB</span>.<span class="id">factory</span><span class="vernacular"> Record</span><span class="id"> Inv</span><span class="id"> {aT</span><span class="id"> rT}</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> aT</span><span class="id"> -&gt;</span><span class="id"> rT</span>)<span class="id"> :=</span><span class="id"> {</span><span class="id"> inv</span><span class="id"> :</span><span class="id"> rT</span><span class="id"> -&gt;</span><span class="id"> aT</span> <span class="id"> }</span>.<br/>
<span class="id">HB</span>.<span class="id">builders</span><span class="vernacular"> Context</span><span class="id"> {aT</span><span class="id"> rT}</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> aT</span><span class="id"> -&gt;</span><span class="id"> rT</span>)<span class="id"> of</span><span class="id"> Inv</span><span class="id"> _</span><span class="id"> _</span><span class="id"> f</span>.<br/>
&nbsp;&nbsp;<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> OInv</span>.<span class="id">Build</span><span class="id"> _</span><span class="id"> _</span><span class="id"> f</span> (<span class="id">olift</span><span class="id"> inv</span>).<br/>
&nbsp;&nbsp;<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> OInv_Inv</span>.<span class="id">Build</span><span class="id"> _</span><span class="id"> _</span><span class="id"> f</span><span class="id"> erefl</span>.<br/>
<span class="id">HB</span>.<span class="gallina-kwd">end</span>.<br/>
<br/>
<span class="id">HB</span>.<span class="id">structure</span><span class="vernacular"> Definition</span><span class="id"> Inversible</span><span class="id"> aT</span><span class="id"> rT</span><span class="id"> :=</span><span class="id"> {f</span><span class="id"> of</span><span class="id"> Inv</span><span class="id"> aT</span><span class="id"> rT</span><span class="id"> f}</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;{ 'inv' aT &gt;-&gt;  rT }&quot;</span><span class="id"> :=</span> (<span class="id">@Inversible</span>.<span class="id">type</span><span class="id"> aT</span><span class="id"> rT</span>)<span class="id"> :</span><span class="id"> type_scope</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;[ 'inv'  'of'  f ]&quot;</span><span class="id"> :=</span><span class="id"> [the</span><span class="id"> {inv</span><span class="id"> _</span><span class="id"> &gt;-&gt;</span><span class="id"> _}</span><span class="id"> of</span><span class="id"> f</span><span class="id"> :</span><span class="id"> _</span><span class="id"> -&gt;</span><span class="id"> _]</span><span class="id"> :</span><span class="id"> form_scope</span>.<br/>
<span class="vernacular">Definition</span><span class="id"> phant_inv</span><span class="id"> aT</span><span class="id"> rT</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {inv</span><span class="id"> aT</span><span class="id"> &gt;-&gt;</span><span class="id"> rT}</span>)<span class="id"> of</span><span class="id"> phantom</span> (_<span class="id"> -&gt;</span><span class="id"> _</span>)<span class="id"> f</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">@inv</span><span class="id"> _</span><span class="id"> _</span><span class="id"> f</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;f ^-1&quot;</span><span class="id"> :=</span> (<span class="id">@inv</span><span class="id"> _</span><span class="id"> _</span><span class="id"> f%function</span>) (<span class="id">only</span><span class="id"> printing</span>)<span class="id"> :</span><span class="id"> function_scope</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;f ^-1&quot;</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;(<span class="id">@phant_inv</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">Phantom</span> (_<span class="id"> -&gt;</span><span class="id"> _</span>)<span class="id"> f%function</span>))<span class="id"> :</span><span class="id"> function_scope</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;f ^-1&quot;</span><span class="id"> :=</span> (<span class="id">@inv</span><span class="id"> _</span><span class="id"> _</span><span class="id"> f%FUN</span>) (<span class="id">only</span><span class="id"> printing</span>)<span class="id"> :</span><span class="id"> fun_scope</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;f ^-1&quot;</span><span class="id"> :=</span> (<span class="id">@phant_inv</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">Phantom</span> (_<span class="id"> -&gt;</span><span class="id"> _</span>)<span class="id"> f%FUN</span>))<span class="id"> :</span><span class="id"> fun_scope</span>.<br/>
<br/>
<span class="id">HB</span>.<span class="id">structure</span><span class="vernacular"> Definition</span><span class="id"> InvFun</span><span class="id"> aT</span><span class="id"> rT</span><span class="id"> A</span><span class="id"> B</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">{f</span><span class="id"> of</span><span class="id"> Inv</span><span class="id"> aT</span><span class="id"> rT</span><span class="id"> f</span><span class="id"> &amp;</span><span class="id"> isFun</span><span class="id"> aT</span><span class="id"> rT</span><span class="id"> A</span><span class="id"> B</span><span class="id"> f}</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;{ 'invfun' A &gt;-&gt; B }&quot;</span><span class="id"> :=</span> (<span class="id">@InvFun</span>.<span class="id">type</span><span class="id"> _</span><span class="id"> _</span><span class="id"> A</span><span class="id"> B</span>)<span class="id"> :</span><span class="id"> type_scope</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;[ 'invfun'  'of'  f ]&quot;</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">[the</span><span class="id"> {invfun</span><span class="id"> _</span><span class="id"> &gt;-&gt;</span><span class="id"> _}</span><span class="id"> of</span><span class="id"> f</span><span class="id"> :</span><span class="id"> _</span><span class="id"> -&gt;</span><span class="id"> _]</span><span class="id"> :</span><span class="id"> form_scope</span>.<br/>
<br/>
<span class="id">HB</span>.<span class="id">mixin</span><span class="vernacular"> Record</span><span class="id"> OInv_CanV</span><span class="id"> {aT</span><span class="id"> rT}</span><span class="id"> {A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT}</span><span class="id"> {B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> rT}</span><br/>
&nbsp;&nbsp;(<span class="id">f</span><span class="id"> :</span><span class="id"> aT</span><span class="id"> -&gt;</span><span class="id"> rT</span>)<span class="id"> of</span><span class="id"> OInv</span><span class="id"> _</span><span class="id"> _</span><span class="id"> f</span><span class="id"> :=</span><span class="id"> {</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">oinvS</span><span class="id"> :</span><span class="id"> {homo</span><span class="id"> 'oinv_f</span><span class="id"> :</span><span class="id"> x</span><span class="id"> /</span><span class="id"> B</span><span class="id"> x</span><span class="id"> &gt;-&gt;</span> (<span class="id">some</span><span class="id"> @`</span><span class="id"> A</span>)<span class="id"> x};</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">oinvK</span><span class="id"> :</span><span class="id"> {in</span><span class="id"> B,</span><span class="id"> ocancel</span><span class="id"> 'oinv_f</span><span class="id"> f};</span><br/>
&nbsp;&nbsp;<span class="id">}</span>.<br/>
<br/>
<span class="id">HB</span>.<span class="id">factory</span><span class="vernacular"> Record</span><span class="id"> OCanV</span><span class="id"> {aT</span><span class="id"> rT}</span><span class="id"> {A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT}</span><span class="id"> {B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> rT}</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> aT</span><span class="id"> -&gt;</span><span class="id"> rT</span>)<span class="id"> :=</span><span class="id"> {</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">oinv;</span><span class="id"> oinvS</span><span class="id"> :</span><span class="id"> {homo</span><span class="id"> oinv</span><span class="id"> :</span><span class="id"> x</span><span class="id"> /</span><span class="id"> B</span><span class="id"> x</span><span class="id"> &gt;-&gt;</span> (<span class="id">some</span><span class="id"> @`</span><span class="id"> A</span>)<span class="id"> x};</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">oinvK</span><span class="id"> :</span><span class="id"> {in</span><span class="id"> B,</span><span class="id"> ocancel</span><span class="id"> oinv</span><span class="id"> f};</span><br/>
&nbsp;&nbsp;<span class="id">}</span>.<br/>
<span class="id">HB</span>.<span class="id">builders</span><span class="vernacular"> Context</span><span class="id"> {aT</span><span class="id"> rT}</span><span class="id"> {A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT}</span><span class="id"> {B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> rT}</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> aT</span><span class="id"> -&gt;</span><span class="id"> rT</span>)<br/>
&nbsp;&nbsp;&nbsp;<span class="id">of</span><span class="id"> OCanV</span><span class="id"> _</span><span class="id"> _</span><span class="id"> A</span><span class="id"> B</span><span class="id"> f</span>.<br/>
&nbsp;<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> OInv</span>.<span class="id">Build</span><span class="id"> _</span><span class="id"> _</span><span class="id"> f</span><span class="id"> oinv</span>.<br/>
&nbsp;<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> OInv_CanV</span>.<span class="id">Build</span><span class="id"> _</span><span class="id"> _</span><span class="id"> A</span><span class="id"> B</span><span class="id"> f</span><span class="id"> oinvS</span><span class="id"> oinvK</span>.<br/>
<span class="id">HB</span>.<span class="gallina-kwd">end</span>.<br/>
<br/>
<span class="id">HB</span>.<span class="id">structure</span><span class="vernacular"> Definition</span><span class="id"> Surject</span><span class="id"> {aT</span><span class="id"> rT</span><span class="id"> A</span><span class="id"> B}</span><span class="id"> :=</span><span class="id"> {f</span><span class="id"> of</span><span class="id"> @OCanV</span><span class="id"> aT</span><span class="id"> rT</span><span class="id"> A</span><span class="id"> B</span><span class="id"> f}</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;{ 'surj' A &gt;-&gt; B }&quot;</span><span class="id"> :=</span> (<span class="id">@Surject</span>.<span class="id">type</span><span class="id"> _</span><span class="id"> _</span><span class="id"> A</span><span class="id"> B</span>)<span class="id"> :</span><span class="id"> type_scope</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;[ 'surj'  'of'  f ]&quot;</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">[the</span><span class="id"> {surj</span><span class="id"> _</span><span class="id"> &gt;-&gt;</span><span class="id"> _}</span><span class="id"> of</span><span class="id"> f</span><span class="id"> :</span><span class="id"> _</span><span class="id"> -&gt;</span><span class="id"> _]</span><span class="id"> :</span><span class="id"> form_scope</span>.<br/>
<br/>
<span class="id">HB</span>.<span class="id">structure</span><span class="vernacular"> Definition</span><span class="id"> SurjFun</span><span class="id"> aT</span><span class="id"> rT</span><span class="id"> A</span><span class="id"> B</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">{f</span><span class="id"> of</span><span class="id"> @Surject</span><span class="id"> aT</span><span class="id"> rT</span><span class="id"> A</span><span class="id"> B</span><span class="id"> f</span><span class="id"> &amp;</span><span class="id"> @Fun</span><span class="id"> _</span><span class="id"> _</span><span class="id"> A</span><span class="id"> B</span><span class="id"> f}</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;{ 'surjfun' A &gt;-&gt; B }&quot;</span><span class="id"> :=</span> (<span class="id">@SurjFun</span>.<span class="id">type</span><span class="id"> _</span><span class="id"> _</span><span class="id"> A</span><span class="id"> B</span>)<span class="id"> :</span><span class="id"> type_scope</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;[ 'surjfun'  'of'  f ]&quot;</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">[the</span><span class="id"> {surjfun</span><span class="id"> _</span><span class="id"> &gt;-&gt;</span><span class="id"> _}</span><span class="id"> of</span><span class="id"> f</span><span class="id"> :</span><span class="id"> _</span><span class="id"> -&gt;</span><span class="id"> _]</span><span class="id"> :</span><span class="id"> form_scope</span>.<br/>
<br/>
<span class="id">HB</span>.<span class="id">structure</span><span class="vernacular"> Definition</span><span class="id"> SplitSurj</span><span class="id"> aT</span><span class="id"> rT</span><span class="id"> A</span><span class="id"> B</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">{f</span><span class="id"> of</span><span class="id"> @Surject</span><span class="id"> aT</span><span class="id"> rT</span><span class="id"> A</span><span class="id"> B</span><span class="id"> f</span><span class="id"> &amp;</span><span class="id"> @Inv</span><span class="id"> _</span><span class="id"> _</span><span class="id"> f}</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;{ 'splitsurj' A &gt;-&gt; B }&quot;</span><span class="id"> :=</span> (<span class="id">@SplitSurj</span>.<span class="id">type</span><span class="id"> _</span><span class="id"> _</span><span class="id"> A</span><span class="id"> B</span>)<span class="id"> :</span><span class="id"> type_scope</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;[ 'splitsurj'  'of'  f ]&quot;</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">[the</span><span class="id"> {splitsurj</span><span class="id"> _</span><span class="id"> &gt;-&gt;</span><span class="id"> _}</span><span class="id"> of</span><span class="id"> f</span><span class="id"> :</span><span class="id"> _</span><span class="id"> -&gt;</span><span class="id"> _]</span><span class="id"> :</span><span class="id"> form_scope</span>.<br/>
<br/>
<span class="id">HB</span>.<span class="id">structure</span><span class="vernacular"> Definition</span><span class="id"> SplitSurjFun</span><span class="id"> aT</span><span class="id"> rT</span><span class="id"> A</span><span class="id"> B</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id">{f</span><span class="id"> of</span><span class="id"> @SplitSurj</span><span class="id"> aT</span><span class="id"> rT</span><span class="id"> A</span><span class="id"> B</span><span class="id"> f</span><span class="id"> &amp;</span><span class="id"> @Fun</span><span class="id"> _</span><span class="id"> _</span><span class="id"> A</span><span class="id"> B</span><span class="id"> f}</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;{ 'splitsurjfun' A &gt;-&gt; B }&quot;</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;(<span class="id">@SplitSurjFun</span>.<span class="id">type</span><span class="id"> _</span><span class="id"> _</span><span class="id"> A</span><span class="id"> B</span>)<span class="id"> :</span><span class="id"> type_scope</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;[ 'splitsurjfun'  'of'  f ]&quot;</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">[the</span><span class="id"> {splitsurjfun</span><span class="id"> _</span><span class="id"> &gt;-&gt;</span><span class="id"> _}</span><span class="id"> of</span><span class="id"> f</span><span class="id"> :</span><span class="id"> _</span><span class="id"> -&gt;</span><span class="id"> _]</span><span class="id"> :</span><span class="id"> form_scope</span>.<br/>
<br/>
<span class="id">HB</span>.<span class="id">mixin</span><span class="vernacular"> Record</span><span class="id"> OInv_Can</span><span class="id"> aT</span><span class="id"> rT</span> (<span class="id">A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> aT</span><span class="id"> -&gt;</span><span class="id"> rT</span>)<span class="id"> of</span><span class="id"> OInv</span><span class="id"> _</span><span class="id"> _</span><span class="id"> f</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">{</span><span class="id"> funoK</span><span class="id"> :</span><span class="id"> {in</span><span class="id"> A,</span><span class="id"> pcancel</span><span class="id"> f</span><span class="id"> 'oinv_f}</span><span class="id"> }</span>.<br/>
<br/>
<span class="id">HB</span>.<span class="id">structure</span><span class="vernacular"> Definition</span><span class="id"> Inject</span><span class="id"> aT</span><span class="id"> rT</span><span class="id"> A</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">{f</span><span class="id"> of</span><span class="id"> OInv</span><span class="id"> aT</span><span class="id"> rT</span><span class="id"> f</span><span class="id"> &amp;</span><span class="id"> OInv_Can</span><span class="id"> aT</span><span class="id"> rT</span><span class="id"> A</span><span class="id"> f}</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;{ 'inj' A &gt;-&gt; rT }&quot;</span><span class="id"> :=</span> (<span class="id">@Inject</span>.<span class="id">type</span><span class="id"> _</span><span class="id"> rT</span><span class="id"> A</span>)<span class="id"> :</span><span class="id"> type_scope</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;[ 'inj'  'of'  f ]&quot;</span><span class="id"> :=</span><span class="id"> [the</span><span class="id"> {inj</span><span class="id"> _</span><span class="id"> &gt;-&gt;</span><span class="id"> _}</span><span class="id"> of</span><span class="id"> f</span><span class="id"> :</span><span class="id"> _</span><span class="id"> -&gt;</span><span class="id"> _]</span><span class="id"> :</span><span class="id"> form_scope</span>.<br/>
<br/>
<span class="id">HB</span>.<span class="id">structure</span><span class="vernacular"> Definition</span><span class="id"> InjFun</span><span class="id"> {aT</span><span class="id"> rT}</span> (<span class="id">A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT</span>) (<span class="id">B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> rT</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id">{</span><span class="id"> f</span><span class="id"> of</span><span class="id"> @Fun</span><span class="id"> _</span><span class="id"> _</span><span class="id"> A</span><span class="id"> B</span><span class="id"> f</span><span class="id"> &amp;</span><span class="id"> @Inject</span><span class="id"> _</span><span class="id"> _</span><span class="id"> A</span><span class="id"> f</span><span class="id"> }</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;{ 'injfun' A &gt;-&gt; B }&quot;</span><span class="id"> :=</span> (<span class="id">@InjFun</span>.<span class="id">type</span><span class="id"> _</span><span class="id"> _</span><span class="id"> A</span><span class="id"> B</span>)<span class="id"> :</span><span class="id"> type_scope</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;[ 'injfun'  'of'  f ]&quot;</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">[the</span><span class="id"> {injfun</span><span class="id"> _</span><span class="id"> &gt;-&gt;</span><span class="id"> _}</span><span class="id"> of</span><span class="id"> f</span><span class="id"> :</span><span class="id"> _</span><span class="id"> -&gt;</span><span class="id"> _]</span><span class="id"> :</span><span class="id"> form_scope</span>.<br/>
<br/>
<span class="id">HB</span>.<span class="id">structure</span><span class="vernacular"> Definition</span><span class="id"> SplitInj</span><span class="id"> aT</span><span class="id"> rT</span> (<span class="id">A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">{f</span><span class="id"> of</span><span class="id"> @Inv</span><span class="id"> aT</span><span class="id"> rT</span><span class="id"> f</span><span class="id"> &amp;</span><span class="id"> @Inject</span><span class="id"> aT</span><span class="id"> rT</span><span class="id"> A</span><span class="id"> f}</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;{ 'splitinj' A &gt;-&gt; rT }&quot;</span><span class="id"> :=</span> (<span class="id">@SplitInj</span>.<span class="id">type</span><span class="id"> _</span><span class="id"> rT</span><span class="id"> A</span>)<span class="id"> :</span><span class="id"> type_scope</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;[ 'splitinj'  'of'  f ]&quot;</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">[the</span><span class="id"> {splitinj</span><span class="id"> _</span><span class="id"> &gt;-&gt;</span><span class="id"> _}</span><span class="id"> of</span><span class="id"> f</span><span class="id"> :</span><span class="id"> _</span><span class="id"> -&gt;</span><span class="id"> _]</span><span class="id"> :</span><span class="id"> form_scope</span>.<br/>
<br/>
<span class="id">HB</span>.<span class="id">structure</span><span class="vernacular"> Definition</span><span class="id"> SplitInjFun</span><span class="id"> aT</span><span class="id"> rT</span> (<span class="id">A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT</span>) (<span class="id">B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> rT</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">{f</span><span class="id"> of</span><span class="id"> @SplitInj</span><span class="id"> _</span><span class="id"> rT</span><span class="id"> A</span><span class="id"> f</span><span class="id"> &amp;</span><span class="id"> @isFun</span><span class="id"> _</span><span class="id"> _</span><span class="id"> A</span><span class="id"> B</span><span class="id"> f}</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;{ 'splitinjfun' A &gt;-&gt; B }&quot;</span><span class="id"> :=</span> (<span class="id">@SplitInjFun</span>.<span class="id">type</span><span class="id"> _</span><span class="id"> _</span><span class="id"> A</span><span class="id"> B</span>)<span class="id"> :</span><span class="id"> type_scope</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;[ 'splitinjfun'  'of'  f ]&quot;</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">[the</span><span class="id"> {splitinjfun</span><span class="id"> _</span><span class="id"> &gt;-&gt;</span><span class="id"> _}</span><span class="id"> of</span><span class="id"> f</span><span class="id"> :</span><span class="id"> _</span><span class="id"> -&gt;</span><span class="id"> _]</span><span class="id"> :</span><span class="id"> form_scope</span>.<br/>
<br/>
<span class="id">HB</span>.<span class="id">structure</span><span class="vernacular"> Definition</span><span class="id"> Bij</span><span class="id"> {aT</span><span class="id"> rT}</span><span class="id"> {A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT}</span><span class="id"> {B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> rT}</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id">{f</span><span class="id"> of</span><span class="id"> @InjFun</span><span class="id"> _</span><span class="id"> _</span><span class="id"> A</span><span class="id"> B</span><span class="id"> f</span><span class="id"> &amp;</span><span class="id"> @SurjFun</span><span class="id"> _</span><span class="id"> _</span><span class="id"> A</span><span class="id"> B</span><span class="id"> f}</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;{ 'bij' A &gt;-&gt; B }&quot;</span><span class="id"> :=</span> (<span class="id">@Bij</span>.<span class="id">type</span><span class="id"> _</span><span class="id"> _</span><span class="id"> A</span><span class="id"> B</span>)<span class="id"> :</span><span class="id"> type_scope</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;[ 'bij'  'of'  f ]&quot;</span><span class="id"> :=</span><span class="id"> [the</span><span class="id"> {bij</span><span class="id"> _</span><span class="id"> &gt;-&gt;</span><span class="id"> _}</span><span class="id"> of</span><span class="id"> f]</span><span class="id"> :</span><span class="id"> form_scope</span>.<br/>
<br/>
<span class="id">HB</span>.<span class="id">structure</span><span class="vernacular"> Definition</span><span class="id"> SplitBij</span><span class="id"> {aT</span><span class="id"> rT}</span><span class="id"> {A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT}</span><span class="id"> {B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> rT}</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id">{f</span><span class="id"> of</span><span class="id"> @SplitInjFun</span><span class="id"> _</span><span class="id"> _</span><span class="id"> A</span><span class="id"> B</span><span class="id"> f</span><span class="id"> &amp;</span><span class="id"> @SplitSurjFun</span><span class="id"> _</span><span class="id"> _</span><span class="id"> A</span><span class="id"> B</span><span class="id"> f}</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;{ 'splitbij' A &gt;-&gt; B }&quot;</span><span class="id"> :=</span> (<span class="id">@SplitBij</span>.<span class="id">type</span><span class="id"> _</span><span class="id"> _</span><span class="id"> A</span><span class="id"> B</span>)<span class="id"> :</span><span class="id"> type_scope</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;[ 'splitbij'  'of'  f ]&quot;</span><span class="id"> :=</span><span class="id"> [the</span><span class="id"> {splitbij</span><span class="id"> _</span><span class="id"> &gt;-&gt;</span><span class="id"> _}</span><span class="id"> of</span><span class="id"> f]</span><span class="id"> :</span><span class="id"> form_scope</span>.<br/>
<br/>
<br/>
<span class="vernacular">Module</span><span class="id"> ShortFunSyntax</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;A ~&gt; B&quot;</span><span class="id"> :=</span><span class="id"> {fun</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span> (<span class="gallina-kwd">at</span><span class="id"> level</span><span class="id"> 70</span>)<span class="id"> :</span><span class="id"> type_scope</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;aT &lt;=&gt; rT&quot;</span><span class="id"> :=</span><span class="id"> {oinv</span><span class="id"> aT</span><span class="id"> &gt;-&gt;</span><span class="id"> rT}</span> (<span class="gallina-kwd">at</span><span class="id"> level</span><span class="id"> 70</span>)<span class="id"> :</span><span class="id"> type_scope</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;A &lt;~ B&quot;</span><span class="id"> :=</span><span class="id"> {oinvfun</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span> (<span class="gallina-kwd">at</span><span class="id"> level</span><span class="id"> 70</span>)<span class="id"> :</span><span class="id"> type_scope</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;aT &lt;&lt;=&gt; rT&quot;</span><span class="id"> :=</span><span class="id"> {inv</span><span class="id"> aT</span><span class="id"> &gt;-&gt;</span><span class="id"> rT}</span> (<span class="gallina-kwd">at</span><span class="id"> level</span><span class="id"> 70</span>)<span class="id"> :</span><span class="id"> type_scope</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;A &lt;&lt;~ B&quot;</span><span class="id"> :=</span><span class="id"> {invfun</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span> (<span class="gallina-kwd">at</span><span class="id"> level</span><span class="id"> 70</span>)<span class="id"> :</span><span class="id"> type_scope</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;A =&gt;&gt; B&quot;</span><span class="id"> :=</span><span class="id"> {surj</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span> (<span class="gallina-kwd">at</span><span class="id"> level</span><span class="id"> 70</span>)<span class="id"> :</span><span class="id"> type_scope</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;A ~&gt;&gt; B&quot;</span><span class="id"> :=</span><span class="id"> {surjfun</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span> (<span class="gallina-kwd">at</span><span class="id"> level</span><span class="id"> 70</span>)<span class="id"> :</span><span class="id"> type_scope</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;A ==&gt;&gt; B&quot;</span><span class="id"> :=</span><span class="id"> {splitsurj</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span> (<span class="gallina-kwd">at</span><span class="id"> level</span><span class="id"> 70</span>)<span class="id"> :</span><span class="id"> type_scope</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;A ~~&gt;&gt; B&quot;</span><span class="id"> :=</span><span class="id"> {splitsurjfun</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span> (<span class="gallina-kwd">at</span><span class="id"> level</span><span class="id"> 70</span>)<span class="id"> :</span><span class="id"> type_scope</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;A &gt;=&gt; rT&quot;</span><span class="id"> :=</span><span class="id"> {inj</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> rT}</span> (<span class="gallina-kwd">at</span><span class="id"> level</span><span class="id"> 70</span>)<span class="id"> :</span><span class="id"> type_scope</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;A &gt;~&gt; B&quot;</span><span class="id"> :=</span><span class="id"> {injfun</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span> (<span class="gallina-kwd">at</span><span class="id"> level</span><span class="id"> 70</span>)<span class="id"> :</span><span class="id"> type_scope</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;A &gt;&gt;=&gt; rT&quot;</span><span class="id"> :=</span><span class="id"> {splitinj</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> rT}</span> (<span class="gallina-kwd">at</span><span class="id"> level</span><span class="id"> 70</span>)<span class="id"> :</span><span class="id"> type_scope</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;A &gt;&gt;~&gt; B&quot;</span><span class="id"> :=</span><span class="id"> {splitinjfun</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span> (<span class="gallina-kwd">at</span><span class="id"> level</span><span class="id"> 70</span>)<span class="id"> :</span><span class="id"> type_scope</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;A &lt;~&gt; B&quot;</span><span class="id"> :=</span><span class="id"> {bij</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span> (<span class="gallina-kwd">at</span><span class="id"> level</span><span class="id"> 70</span>)<span class="id"> :</span><span class="id"> type_scope</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;A &lt;&lt;~&gt; B&quot;</span><span class="id"> :=</span><span class="id"> {splitbij</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span> (<span class="gallina-kwd">at</span><span class="id"> level</span><span class="id"> 70</span>)<span class="id"> :</span><span class="id"> type_scope</span>.<br/>
<span class="vernacular">End</span><span class="id"> ShortFunSyntax</span>.<br/>
<br/>
<div class="ssrdoc md">
## Theory
</div>
<br/>
<span class="vernacular">Definition</span><span class="id"> phant_funS</span><span class="id"> aT</span><span class="id"> rT</span> (<span class="id">A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT</span>) (<span class="id">B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> rT</span>)<br/>
&nbsp;&nbsp;(<span class="id">f</span><span class="id"> :</span><span class="id"> {fun</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<span class="id"> of</span><span class="id"> phantom</span> (_<span class="id"> -&gt;</span><span class="id"> _</span>)<span class="id"> f</span><span class="id"> :=</span><span class="id"> @funS</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> f</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;'funS_  f&quot;</span><span class="id"> :=</span> (<span class="id">phant_funS</span> (<span class="id">Phantom</span> (_<span class="id"> -&gt;</span><span class="id"> _</span>)<span class="id"> f</span>))<br/>
&nbsp;&nbsp;(<span class="gallina-kwd">at</span><span class="id"> level</span><span class="id"> 8,</span><span class="id"> f</span><span class="gallina-kwd"> at</span><span class="id"> level</span><span class="id"> 2</span>)<span class="id"> :</span><span class="id"> form_scope</span>.<br/>
<span class="id">#[global]</span><span class="vernacular"> Hint</span><span class="id"> Extern</span><span class="id"> 0</span> (<span class="id">set_fun</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span>)<span class="id"> =&gt;</span><span class="id"> solve</span><span class="id"> [apply:</span><span class="id"> funS]</span><span class="id"> :</span><span class="id"> core</span>.<br/>
<span class="id">#[global]</span><span class="vernacular"> Hint</span><span class="id"> Extern</span><span class="id"> 0</span> (<span class="id">prop_in1</span><span class="id"> _</span><span class="id"> _</span>)<span class="id"> =&gt;</span><span class="id"> solve</span><span class="id"> [apply:</span><span class="id"> funS]</span><span class="id"> :</span><span class="id"> core</span>.<br/>
<br/>
<span class="vernacular">Definition</span><span class="id"> fun_image_sub</span><span class="id"> aT</span><span class="id"> rT</span> (<span class="id">A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT</span>) (<span class="id">B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> rT</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> {fun</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">image_subP</span>.<span class="id">2</span> (<span class="id">@funS</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> f</span>).<br/>
<span class="vernacular">Arguments</span><span class="id"> fun_image_sub</span><span class="id"> {aT</span><span class="id"> rT</span><span class="id"> A</span><span class="id"> B}</span>.<br/>
<span class="id">#[global]</span><span class="vernacular"> Hint</span><span class="id"> Extern</span><span class="id"> 0</span> (_<span class="id"> @`</span><span class="id"> _</span><span class="id"> `&lt;=`</span><span class="id"> _</span>)<span class="id"> =&gt;</span><span class="id"> solve</span><span class="id"> [apply:</span><span class="id"> fun_image_sub]</span><span class="id"> :</span><span class="id"> core</span>.<br/>
<br/>
<span class="vernacular">Definition</span><span class="id"> mem_fun</span><span class="id"> aT</span><span class="id"> rT</span> (<span class="id">A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT</span>) (<span class="id">B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> rT</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> {fun</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">homo_setP</span>.<span class="id">2</span> (<span class="id">@funS</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> f</span>).<br/>
<span class="id">#[global]</span><span class="vernacular"> Hint</span><span class="id"> Extern</span><span class="id"> 0</span> (<span class="id">prop_in1</span><span class="id"> _</span><span class="id"> _</span>)<span class="id"> =&gt;</span><span class="id"> solve</span><span class="id"> [apply:</span><span class="id"> mem_fun]</span><span class="id"> :</span><span class="id"> core</span>.<br/>
<br/>
<span class="vernacular">Definition</span><span class="id"> phant_mem_fun</span><span class="id"> aT</span><span class="id"> rT</span> (<span class="id">A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT</span>) (<span class="id">B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> rT</span>)<br/>
&nbsp;&nbsp;(<span class="id">f</span><span class="id"> :</span><span class="id"> {fun</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<span class="id"> of</span><span class="id"> phantom</span> (_<span class="id"> -&gt;</span><span class="id"> _</span>)<span class="id"> f</span><span class="id"> :=</span><span class="id"> homo_setP</span>.<span class="id">2</span> (<span class="id">@funS</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> f</span>).<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;'mem_fun_  f&quot;</span><span class="id"> :=</span> (<span class="id">phant_mem_fun</span> (<span class="id">Phantom</span> (_<span class="id"> -&gt;</span><span class="id"> _</span>)<span class="id"> f</span>))<br/>
&nbsp;&nbsp;(<span class="gallina-kwd">at</span><span class="id"> level</span><span class="id"> 8,</span><span class="id"> f</span><span class="gallina-kwd"> at</span><span class="id"> level</span><span class="id"> 2</span>)<span class="id"> :</span><span class="id"> form_scope</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> some_inv</span><span class="id"> {aT</span><span class="id"> rT}</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {inv</span><span class="id"> aT</span><span class="id"> &gt;-&gt;</span><span class="id"> rT}</span>)<span class="id"> x</span><span class="id"> :</span><span class="id"> Some</span> (<span class="id">f^-1</span><span class="id"> x</span>)<span class="id"> =</span><span class="id"> 'oinv_f</span><span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> -oliftV</span>. Qed.</div></details>
<br/>
<span class="vernacular">Definition</span><span class="id"> phant_oinvK</span><span class="id"> aT</span><span class="id"> rT</span> (<span class="id">A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT</span>) (<span class="id">B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> rT</span>)<br/>
&nbsp;&nbsp;&nbsp;(<span class="id">f</span><span class="id"> :</span><span class="id"> {surj</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<span class="id"> of</span><span class="id"> phantom</span> (_<span class="id"> -&gt;</span><span class="id"> _</span>)<span class="id"> f</span><span class="id"> :=</span><span class="id"> @oinvK</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> f</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;'oinvK_ f&quot;</span><span class="id"> :=</span> (<span class="id">phant_oinvK</span> (<span class="id">Phantom</span> (_<span class="id"> -&gt;</span><span class="id"> _</span>)<span class="id"> f</span>))<span class="id"> :</span><span class="id"> form_scope</span>.<br/>
<span class="id">#[global]</span><span class="vernacular"> Hint</span><span class="id"> Resolve</span><span class="id"> oinvK</span><span class="id"> :</span><span class="id"> core</span>.<br/>
<br/>
<span class="vernacular">Definition</span><span class="id"> phant_oinvS</span><span class="id"> aT</span><span class="id"> rT</span> (<span class="id">A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT</span>) (<span class="id">B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> rT</span>)<br/>
&nbsp;&nbsp;&nbsp;(<span class="id">f</span><span class="id"> :</span><span class="id"> {surj</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<span class="id"> of</span><span class="id"> phantom</span> (_<span class="id"> -&gt;</span><span class="id"> _</span>)<span class="id"> f</span><span class="id"> :=</span><span class="id"> @oinvS</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> f</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;'oinvS_ f&quot;</span><span class="id"> :=</span> (<span class="id">phant_oinvS</span> (<span class="id">Phantom</span> (_<span class="id"> -&gt;</span><span class="id"> _</span>)<span class="id"> f</span>))<span class="id"> :</span><span class="id"> form_scope</span>.<br/>
<span class="id">#[global]</span><span class="vernacular"> Hint</span><span class="id"> Resolve</span><span class="id"> oinvS</span><span class="id"> :</span><span class="id"> core</span>.<br/>
<br/>
<span class="vernacular">Variant</span><span class="id"> oinv_spec</span><span class="id"> {aT}</span><span class="id"> {rT}</span><span class="id"> {A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT}</span><span class="id"> {B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> rT}</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {surj</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<span class="id"> y</span><span class="id"> :</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id">rT</span><span class="id"> -&gt;</span><span class="id"> option</span><span class="id"> aT</span><span class="id"> -&gt;</span><span class="gallina-kwd"> Type</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">OInvSpec</span> (<span class="id">x</span><span class="id"> :</span><span class="id"> aT</span>)<span class="id"> of</span><span class="id"> A</span><span class="id"> x</span><span class="id"> &amp;</span><span class="id"> f</span><span class="id"> x</span><span class="id"> =</span><span class="id"> y</span><span class="id"> :</span><span class="id"> oinv_spec</span><span class="id"> f</span><span class="id"> y</span> (<span class="id">f</span><span class="id"> x</span>) (<span class="id">Some</span><span class="id"> x</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> oinvP</span><span class="id"> aT</span><span class="id"> rT</span> (<span class="id">A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT</span>) (<span class="id">B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> rT</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> {surj</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<span class="id"> y</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">B</span><span class="id"> y</span><span class="id"> -&gt;</span><span class="id"> oinv_spec</span><span class="id"> f</span><span class="id"> y</span><span class="id"> y</span> (<span class="id">'oinv_f</span><span class="id"> y</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> By;</span><span class="id"> have</span><span class="id"> :='oinvK_f</span> (<span class="id">mem_set</span><span class="id"> By</span>).<br/>
<span class="gallina-kwd">by</span><span class="id"> have</span><span class="id"> /cid2</span><span class="id"> [x</span><span class="id"> Ax</span><span class="id"> &lt;-]</span><span class="id"> :=</span><span class="id"> 'oinvS_f</span><span class="id"> By</span><span class="id"> =&gt;</span><span class="id"> &lt;-;</span><span class="id"> constructor</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Definition</span><span class="id"> phant_oinvP</span><span class="id"> aT</span><span class="id"> rT</span> (<span class="id">A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT</span>) (<span class="id">B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> rT</span>)<br/>
&nbsp;&nbsp;&nbsp;(<span class="id">f</span><span class="id"> :</span><span class="id"> {surj</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<span class="id"> of</span><span class="id"> phantom</span> (_<span class="id"> -&gt;</span><span class="id"> _</span>)<span class="id"> f</span><span class="id"> :=</span><span class="id"> @oinvP</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> f</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;'oinvP_ f&quot;</span><span class="id"> :=</span> (<span class="id">phant_oinvP</span> (<span class="id">Phantom</span> (_<span class="id"> -&gt;</span><span class="id"> _</span>)<span class="id"> f</span>))<span class="id"> :</span><span class="id"> form_scope</span>.<br/>
<span class="id">#[global]</span><span class="vernacular"> Hint</span><span class="id"> Resolve</span><span class="id"> oinvP</span><span class="id"> :</span><span class="id"> core</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> oinvT</span><span class="id"> {aT</span><span class="id"> rT}</span><span class="id"> {A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT}</span><span class="id"> {B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> rT}</span><span class="id"> {f</span><span class="id"> :</span><span class="id"> {surj</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}}</span><span class="id"> x</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">B</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> 'oinv_f</span><span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> /'oinvS_f</span><span class="id"> [a</span><span class="id"> Aa</span><span class="id"> &lt;-]</span>. Qed.</div></details>
<span class="vernacular">Definition</span><span class="id"> phant_oinvT</span><span class="id"> aT</span><span class="id"> rT</span> (<span class="id">A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT</span>) (<span class="id">B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> rT</span>)<br/>
&nbsp;&nbsp;&nbsp;(<span class="id">f</span><span class="id"> :</span><span class="id"> {surj</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<span class="id"> of</span><span class="id"> phantom</span> (_<span class="id"> -&gt;</span><span class="id"> _</span>)<span class="id"> f</span><span class="id"> :=</span><span class="id"> @oinvT</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> f</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;'oinvT_ f&quot;</span><span class="id"> :=</span> (<span class="id">phant_oinvT</span> (<span class="id">Phantom</span> (_<span class="id"> -&gt;</span><span class="id"> _</span>)<span class="id"> f</span>))<span class="id"> :</span><span class="id"> form_scope</span>.<br/>
<span class="id">#[global]</span><span class="vernacular"> Hint</span><span class="id"> Resolve</span><span class="id"> oinvT</span><span class="id"> :</span><span class="id"> core</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> invK</span><span class="id"> {aT</span><span class="id"> rT}</span><span class="id"> {A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT}</span><span class="id"> {B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> rT}</span><span class="id"> {f</span><span class="id"> :</span><span class="id"> {splitsurj</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}}</span><span class="id"> :</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id">{in</span><span class="id"> B,</span><span class="id"> cancel</span><span class="id"> f^-1</span><span class="id"> f}</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> Bx;</span><span class="id"> rewrite</span><span class="id"> -[x</span><span class="gallina-kwd"> in</span><span class="id"> RHS]'oinvK_f//</span><span class="id"> -some_inv/=</span>. Qed.</div></details>
<span class="vernacular">Definition</span><span class="id"> phant_invK</span><span class="id"> aT</span><span class="id"> rT</span> (<span class="id">A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT</span>) (<span class="id">B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> rT</span>)<br/>
&nbsp;&nbsp;&nbsp;(<span class="id">f</span><span class="id"> :</span><span class="id"> {splitsurj</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<span class="id"> of</span><span class="id"> phantom</span> (_<span class="id"> -&gt;</span><span class="id"> _</span>)<span class="id"> f</span><span class="id"> :=</span><span class="id"> @invK</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> f</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;'invK_ f&quot;</span><span class="id"> :=</span> (<span class="id">phant_invK</span> (<span class="id">Phantom</span> (_<span class="id"> -&gt;</span><span class="id"> _</span>)<span class="id"> f</span>))<span class="id"> :</span><span class="id"> form_scope</span>.<br/>
<span class="id">#[global]</span><span class="vernacular"> Hint</span><span class="id"> Resolve</span><span class="id"> invK</span><span class="id"> :</span><span class="id"> core</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> invS</span><span class="id"> {aT</span><span class="id"> rT}</span><span class="id"> {A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT}</span><span class="id"> {B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> rT}</span><span class="id"> {f</span><span class="id"> :</span><span class="id"> {splitsurj</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}}</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">{homo</span><span class="id"> f^-1</span><span class="id"> :</span><span class="id"> x</span><span class="id"> /</span><span class="id"> B</span><span class="id"> x</span><span class="id"> &gt;-&gt;</span><span class="id"> A</span><span class="id"> x}</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> /'oinvS_f/=</span><span class="id"> [a</span><span class="id"> Aa];</span><span class="id"> rewrite</span><span class="id"> -some_inv</span><span class="id"> =&gt;</span><span class="id"> -[&lt;-]</span>. Qed.</div></details>
<span class="vernacular">Definition</span><span class="id"> phant_invS</span><span class="id"> aT</span><span class="id"> rT</span> (<span class="id">A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT</span>) (<span class="id">B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> rT</span>)<br/>
&nbsp;&nbsp;&nbsp;<span class="id">{f</span><span class="id"> :</span><span class="id"> {splitsurjfun</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}}</span><span class="id"> of</span><span class="id"> phantom</span> (_<span class="id"> -&gt;</span><span class="id"> _</span>)<span class="id"> f</span><span class="id"> :=</span><span class="id"> @invS</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> f</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;'invS_ f&quot;</span><span class="id"> :=</span> (<span class="id">phant_invS</span> (<span class="id">Phantom</span> (_<span class="id"> -&gt;</span><span class="id"> _</span>)<span class="id"> f</span>))<span class="id"> :</span><span class="id"> form_scope</span>.<br/>
<span class="id">#[global]</span><span class="vernacular"> Hint</span><span class="id"> Resolve</span><span class="id"> invS</span><span class="id"> :</span><span class="id"> core</span>.<br/>
<br/>
<span class="vernacular">Definition</span><span class="id"> phant_funoK</span><span class="id"> aT</span><span class="id"> rT</span> (<span class="id">A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> {inj</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> rT}</span>)<br/>
&nbsp;&nbsp;<span class="id">of</span><span class="id"> phantom</span> (_<span class="id"> -&gt;</span><span class="id"> _</span>)<span class="id"> f</span><span class="id"> :=</span><span class="id"> @funoK</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> f</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;'funoK_ f&quot;</span><span class="id"> :=</span> (<span class="id">phant_funoK</span> (<span class="id">Phantom</span> (_<span class="id"> -&gt;</span><span class="id"> _</span>)<span class="id"> f</span>))<span class="id"> :</span><span class="id"> form_scope</span>.<br/>
<span class="id">#[global]</span><span class="vernacular"> Hint</span><span class="id"> Resolve</span><span class="id"> funoK</span><span class="id"> :</span><span class="id"> core</span>.<br/>
<br/>
<span class="vernacular">Definition</span><span class="id"> inj</span><span class="id"> {aT</span><span class="id"> rT</span><span class="id"> :</span><span class="id"> nonPropType}</span><span class="id"> {A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT}</span><span class="id"> {f</span><span class="id"> :</span><span class="id"> {inj</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> rT}}</span><span class="id"> :</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id">{in</span><span class="id"> A</span><span class="id"> &amp;,</span><span class="id"> injective</span><span class="id"> f}</span><span class="id"> :=</span><span class="id"> pcan_in_inj</span><span class="id"> funoK</span>.<br/>
<span class="vernacular">Definition</span><span class="id"> phant_inj</span><span class="id"> aT</span><span class="id"> rT</span> (<span class="id">A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> {inj</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> rT}</span>)<span class="id"> of</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id">phantom</span> (_<span class="id"> -&gt;</span><span class="id"> _</span>)<span class="id"> f</span><span class="id"> :=</span><span class="id"> @inj</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> f</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;'inj_ f&quot;</span><span class="id"> :=</span> (<span class="id">phant_inj</span> (<span class="id">Phantom</span> (_<span class="id"> -&gt;</span><span class="id"> _</span>)<span class="id"> f</span>))<span class="id"> :</span><span class="id"> form_scope</span>.<br/>
<br/>
<span class="vernacular">Definition</span><span class="id"> inj_hint</span><span class="id"> {aT</span><span class="id"> rT}</span><span class="id"> {A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT}</span><span class="id"> {f</span><span class="id"> :</span><span class="id"> {inj</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> rT}}</span><span class="id"> :</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id">{in</span><span class="id"> A</span><span class="id"> &amp;,</span><span class="id"> injective</span><span class="id"> f}</span><span class="id"> :=</span><span class="id"> inj</span>.<br/>
<span class="id">#[global]</span><span class="vernacular"> Hint</span><span class="id"> Extern</span><span class="id"> 0</span><span class="id"> {in</span><span class="id"> _</span><span class="id"> &amp;,</span><span class="id"> injective</span><span class="id"> _}</span><span class="id"> =&gt;</span><span class="id"> solve</span><span class="id"> [apply:</span><span class="id"> inj_hint]</span><span class="id"> :</span><span class="id"> core</span>.<br/>
<span class="id">#[global]</span><span class="vernacular"> Hint</span><span class="id"> Extern</span><span class="id"> 0</span> (<span class="id">set_inj</span><span class="id"> _</span><span class="id"> _</span>)<span class="id"> =&gt;</span><span class="id"> solve</span><span class="id"> [apply:</span><span class="id"> inj_hint]</span><span class="id"> :</span><span class="id"> core</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> injT</span><span class="id"> {aT</span><span class="id"> rT}</span><span class="id"> {f</span><span class="id"> :</span><span class="id"> {inj</span><span class="id"> [set:</span><span class="id"> aT]</span><span class="id"> &gt;-&gt;</span><span class="id"> rT}}</span><span class="id"> :</span><span class="id"> injective</span><span class="id"> f</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> in2TT;</span><span class="id"> apply:</span><span class="id"> inj</span>. Qed.</div></details>
<span class="id">#[global]</span><span class="vernacular"> Hint</span><span class="id"> Extern</span><span class="id"> 0</span> (<span class="id">injective</span><span class="id"> _</span>)<span class="id"> =&gt;</span><span class="id"> solve</span><span class="id"> [apply:</span><span class="id"> injT]</span><span class="id"> :</span><span class="id"> core</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> funK</span><span class="id"> {aT</span><span class="id"> rT</span><span class="id"> :</span><span class="id"> Type}</span><span class="id"> {A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT}</span><span class="id"> {s</span><span class="id"> :</span><span class="id"> {splitinj</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> rT}}</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">{in</span><span class="id"> A,</span><span class="id"> cancel</span><span class="id"> s</span><span class="id"> s^-1}</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> Ax;</span><span class="id"> apply:</span><span class="id"> Some_inj;</span><span class="id"> rewrite</span><span class="id"> some_inv</span><span class="id"> funoK</span>. Qed.</div></details>
<br/>
<span class="vernacular">Definition</span><span class="id"> phant_funK</span><span class="id"> aT</span><span class="id"> rT</span> (<span class="id">A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> {splitinj</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> rT}</span>)<br/>
&nbsp;&nbsp;<span class="id">of</span><span class="id"> phantom</span> (_<span class="id"> -&gt;</span><span class="id"> _</span>)<span class="id"> f</span><span class="id"> :=</span><span class="id"> @funK</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> f</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;'funK_  f&quot;</span><span class="id"> :=</span> (<span class="id">phant_funK</span> (<span class="id">Phantom</span> (_<span class="id"> -&gt;</span><span class="id"> _</span>)<span class="id"> f</span>))<span class="id"> :</span><span class="id"> form_scope</span>.<br/>
<span class="id">#[global]</span><span class="vernacular"> Hint</span><span class="id"> Resolve</span><span class="id"> funK</span><span class="id"> :</span><span class="id"> core</span>.<br/>
<br/>
<div class="doc">Structure Equality </div>
<br/>
<span class="vernacular">Lemma</span><span class="id"> funP</span><span class="id"> {aT</span><span class="id"> rT}</span><span class="id"> {A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT}</span><span class="id"> {B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> rT}</span> (<span class="id">f</span><span class="id"> g</span><span class="id"> :</span><span class="id"> {fun</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">f</span><span class="id"> =</span><span class="id"> g</span><span class="id"> &lt;-&gt;</span><span class="id"> f</span><span class="id"> =1</span><span class="id"> g</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">case:</span><span class="id"> f</span><span class="id"> g</span><span class="id"> =&gt;</span><span class="id"> [f</span><span class="id"> [[ffun]]]</span><span class="id"> [g</span><span class="id"> [[gfun]]]/=;</span><span class="id"> split=&gt;</span><span class="id"> [[-&gt;//]|/funext</span><span class="id"> eqfg]</span>.<br/>
<span class="id">rewrite</span><span class="id"> eqfg</span><span class="gallina-kwd"> in</span><span class="id"> ffun</span><span class="id"> *;</span><span class="id"> congr</span><span class="id"> {|</span><span class="id"> Fun</span>.<span class="id">sort</span><span class="id"> :=</span><span class="id"> _;</span><span class="id"> Fun</span>.<span class="id">class</span><span class="id"> :=</span><span class="id"> {|</span><br/>
&nbsp;&nbsp;<span class="id">Fun</span>.<span class="id">functions_isFun_mixin</span><span class="id"> :=</span><span class="id"> {|isFun</span>.<span class="id">funS</span><span class="id"> :=</span><span class="id"> _|}|}|}</span>.<br/>
<span class="id">exact:</span><span class="id"> Prop_irrelevance</span>.<br/>
Qed.</div></details>
<br/>
<div class="doc">Preliminary Builders </div>
<br/>
<span class="id">HB</span>.<span class="id">factory</span><span class="vernacular"> Record</span><span class="id"> Inv_Can</span><span class="id"> {aT</span><span class="id"> rT}</span><span class="id"> {A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT}</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> aT</span><span class="id"> -&gt;</span><span class="id"> rT</span>)<span class="id"> of</span><span class="id"> Inv</span><span class="id"> _</span><span class="id"> _</span><span class="id"> f</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">{</span><span class="id"> funK</span><span class="id"> :</span><span class="id"> {in</span><span class="id"> A,</span><span class="id"> cancel</span><span class="id"> f</span><span class="id"> f^-1}</span><span class="id"> }</span>.<br/>
<span class="id">HB</span>.<span class="id">builders</span><span class="vernacular"> Context</span><span class="id"> {aT</span><span class="id"> rT}</span><span class="id"> A</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> aT</span><span class="id"> -&gt;</span><span class="id"> rT</span>)<span class="id"> of</span><span class="id"> @Inv_Can</span><span class="id"> _</span><span class="id"> _</span><span class="id"> A</span><span class="id"> f</span>.<br/>
&nbsp;&nbsp;<span class="vernacular">Local</span><span class="vernacular"> Lemma</span><span class="id"> funoK:</span><span class="id"> {in</span><span class="id"> A,</span><span class="id"> pcancel</span><span class="id"> f</span><span class="id"> 'oinv_f}</span>.<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> -oliftV/=;</span><span class="id"> apply:</span><span class="id"> can_in_pcan;</span><span class="id"> apply:</span><span class="id"> funK</span>. Qed.</div></details>
&nbsp;&nbsp;<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> OInv_Can</span>.<span class="id">Build</span><span class="id"> _</span><span class="id"> _</span><span class="id"> A</span><span class="id"> f</span><span class="id"> funoK</span>.<br/>
<span class="id">HB</span>.<span class="gallina-kwd">end</span>.<br/>
<br/>
<span class="id">HB</span>.<span class="id">factory</span><span class="vernacular"> Record</span><span class="id"> Inv_CanV</span><span class="id"> {aT</span><span class="id"> rT}</span><span class="id"> {A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT}</span><span class="id"> {B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> rT}</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> aT</span><span class="id"> -&gt;</span><span class="id"> rT</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">of</span><span class="id"> Inv</span><span class="id"> aT</span><span class="id"> rT</span><span class="id"> f</span><span class="id"> :=</span><span class="id"> {</span><br/>
&nbsp;&nbsp;<span class="id">invS</span><span class="id"> :</span><span class="id"> {homo</span><span class="id"> f^-1</span><span class="id"> :</span><span class="id"> x</span><span class="id"> /</span><span class="id"> B</span><span class="id"> x</span><span class="id"> &gt;-&gt;</span><span class="id"> A</span><span class="id"> x};</span><br/>
&nbsp;&nbsp;<span class="id">invK</span><span class="id"> :</span><span class="id"> {in</span><span class="id"> B,</span><span class="id"> cancel</span><span class="id"> f^-1</span><span class="id"> f};</span><br/>
<span class="id">}</span>.<br/>
<span class="id">HB</span>.<span class="id">builders</span><span class="vernacular"> Context</span><span class="id"> {aT</span><span class="id"> rT}</span><span class="id"> {A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT}</span><span class="id"> {B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> rT}</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> aT</span><span class="id"> -&gt;</span><span class="id"> rT</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">of</span><span class="id"> Inv_CanV</span><span class="id"> _</span><span class="id"> _</span><span class="id"> A</span><span class="id"> B</span><span class="id"> f</span>.<br/>
&nbsp;&nbsp;<span class="id">#[local]</span><span class="vernacular"> Lemma</span><span class="id"> oinvK</span><span class="id"> :</span><span class="id"> {in</span><span class="id"> B,</span><span class="id"> ocancel</span><span class="id"> 'oinv_f</span><span class="id"> f}</span>.<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> Bx;</span><span class="id"> rewrite</span><span class="id"> -some_inv/=</span><span class="id"> invK</span>. Qed.</div></details>
&nbsp;&nbsp;<span class="id">#[local]</span><span class="vernacular"> Lemma</span><span class="id"> oinvS</span><span class="id"> :</span><span class="id"> {homo</span><span class="id"> 'oinv_f</span><span class="id"> :</span><span class="id"> x</span><span class="id"> /</span><span class="id"> B</span><span class="id"> x</span><span class="id"> &gt;-&gt;</span> (<span class="id">some</span><span class="id"> @`</span><span class="id"> A</span>)<span class="id"> x}</span>.<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> /invS</span><span class="id"> Af'x;</span><span class="gallina-kwd"> exists</span> (<span class="id">f^-1</span><span class="id"> x</span>)<span class="id">;</span><span class="id"> rewrite</span><span class="id"> //</span><span class="id"> -some_inv</span>. Qed.</div></details>
&nbsp;&nbsp;<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> OInv_CanV</span>.<span class="id">Build</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> f</span><span class="id"> oinvS</span><span class="id"> oinvK</span>.<br/>
<span class="id">HB</span>.<span class="gallina-kwd">end</span>.<br/>
<br/>
<div class="doc">Trivial instances </div>
<br/>
<span class="vernacular">Section</span><span class="id"> OInverse</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {aT</span><span class="id"> rT</span><span class="id"> :</span><span class="id"> Type}</span><span class="id"> {A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT}</span><span class="id"> {B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> rT}</span>.<br/>
<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> {f</span><span class="id"> :</span><span class="id"> {oinv</span><span class="id"> aT</span><span class="id"> &gt;-&gt;</span><span class="id"> rT}}</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">OInv</span>.<span class="id">Build</span><span class="id"> _</span><span class="id"> _</span><span class="id"> 'oinv_f</span> (<span class="id">omap</span><span class="id"> f</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> oinvV</span><span class="id"> {f</span><span class="id"> :</span><span class="id"> {oinv</span><span class="id"> aT</span><span class="id"> &gt;-&gt;</span><span class="id"> rT}}</span><span class="id"> :</span><span class="id"> 'oinv_</span>(<span class="id">'oinv_f</span>)<span class="id"> =</span><span class="id"> omap</span><span class="id"> f</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> []</span>. Qed.</div></details>
<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {surj</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">isFun</span>.<span class="id">Build</span><span class="id"> rT</span> (<span class="id">option</span><span class="id"> aT</span>)<span class="id"> B</span> (<span class="id">some</span><span class="id"> @`</span><span class="id"> A</span>)<span class="id"> 'oinv_f</span><span class="id"> oinvS</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> surjoinv_inj_subproof</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {surj</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<span class="id"> :</span><span class="id"> OInv_Can</span><span class="id"> _</span><span class="id"> _</span><span class="id"> B</span><span class="id"> 'oinv_f</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">split=&gt;</span><span class="id"> x</span><span class="id"> Bx/=;</span><span class="id"> rewrite</span><span class="id"> -[x</span><span class="gallina-kwd"> in</span><span class="id"> RHS]</span>(<span class="id">'oinvK_f</span><span class="id"> Bx</span>).<br/>
<span class="gallina-kwd">by</span><span class="id"> have</span><span class="id"> :=</span><span class="id"> 'oinvT_f</span> (<span class="id">set_mem</span><span class="id"> Bx</span>)<span class="id">;</span><span class="id"> case:</span><span class="id"> 'oinv_f</span>.<br/>
Qed.</div></details>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> f</span><span class="id"> :=</span><span class="id"> surjoinv_inj_subproof</span><span class="id"> f</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> injoinv_surj_subproof</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {injfun</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">OInv_CanV</span><span class="id"> _</span><span class="id"> _</span><span class="id"> B</span> (<span class="id">some</span><span class="id"> @`</span><span class="id"> A</span>)<span class="id"> 'oinv_f</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">split=&gt;</span><span class="id"> [_|_</span><span class="id"> /set_mem]</span><span class="id"> [a</span><span class="id"> Aa</span><span class="id"> &lt;-]/=;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> funoK</span><span class="id"> ?inE</span>.<br/>
<span class="gallina-kwd">by</span><span class="gallina-kwd"> exists</span> (<span class="id">f</span><span class="id"> a</span>)<span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> apply:</span><span class="id"> funS</span>.<br/>
Qed.</div></details>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {injfun</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<span class="id"> :=</span><span class="id"> injoinv_surj_subproof</span><span class="id"> f</span>.<br/>
<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> {f</span><span class="id"> :</span><span class="id"> {bij</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}}</span><span class="id"> :=</span><span class="id"> InjFun</span>.<span class="id">on</span><span class="id"> 'oinv_f</span>.<br/>
<br/>
<span class="vernacular">End</span><span class="id"> OInverse</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> Inverse</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {aT</span><span class="id"> rT</span><span class="id"> :</span><span class="id"> Type}</span><span class="id"> {A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT}</span><span class="id"> {B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> rT}</span>.<br/>
<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {inv</span><span class="id"> aT</span><span class="id"> &gt;-&gt;</span><span class="id"> rT}</span>)<span class="id"> :=</span><span class="id"> Inv</span>.<span class="id">Build</span><span class="id"> rT</span><span class="id"> aT</span><span class="id"> f^-1</span><span class="id"> f</span>.<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {inv</span><span class="id"> aT</span><span class="id"> &gt;-&gt;</span><span class="id"> rT}</span>)<span class="id"> :=</span><span class="id"> Inversible</span>.<span class="id">copy</span><span class="id"> inv</span><span class="id"> f^-1</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> invV</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {inv</span><span class="id"> aT</span><span class="id"> &gt;-&gt;</span><span class="id"> rT}</span>)<span class="id"> :</span><span class="id"> f^-1^-1</span><span class="id"> =</span><span class="id"> f</span><br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> []</span>. Qed.</div></details>
<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {splitsurj</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">isFun</span>.<span class="id">Build</span><span class="id"> rT</span><span class="id"> aT</span><span class="id"> B</span><span class="id"> A</span><span class="id"> f^-1</span><span class="id"> invS</span>.<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {splitsurj</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<span class="id"> :=</span><span class="id"> Fun</span>.<span class="id">copy</span><span class="id"> inv</span><span class="id"> f^-1</span>.<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> {f</span><span class="id"> :</span><span class="id"> {splitsurj</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}}</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">Inv_Can</span>.<span class="id">Build</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> f^-1</span><span class="id"> 'invK_f</span>.<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {splitinjfun</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">Inv_CanV</span>.<span class="id">Build</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> f^-1</span><span class="id"> funS</span><span class="id"> funK</span>.<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> {f</span><span class="id"> :</span><span class="id"> {splitbij</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}}</span><span class="id"> :=</span><span class="id"> InjFun</span>.<span class="id">on</span><span class="id"> f^-1</span>.<br/>
<br/>
<span class="vernacular">End</span><span class="id"> Inverse</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> Some</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {T}</span><span class="id"> {A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T}</span>.<br/>
<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> OInv</span>.<span class="id">Build</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">@Some</span><span class="id"> T</span>)<span class="id"> id</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> oinv_some</span><span class="id"> :</span><span class="id"> 'oinv_</span>(<span class="id">@Some</span><span class="id"> T</span>)<span class="id"> =</span><span class="id"> id</span><br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> []</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> some_can_subproof</span><span class="id"> :</span><span class="id"> @OInv_Can</span><span class="id"> _</span><span class="id"> _</span><span class="id"> A</span> (<span class="id">@Some</span><span class="id"> T</span>)<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> split</span>. Qed.</div></details>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> some_can_subproof</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> some_canV_subproof</span><span class="id"> :</span><span class="id"> OInv_CanV</span><span class="id"> _</span><span class="id"> _</span><span class="id"> A</span> (<span class="id">some</span><span class="id"> @`</span><span class="id"> A</span>) (<span class="id">@Some</span><span class="id"> T</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> split=&gt;</span><span class="id"> [x|x</span><span class="id"> /set_mem]</span><span class="id"> [a</span><span class="id"> Aa</span><span class="id"> &lt;-]//=;</span><span class="gallina-kwd"> exists</span><span class="id"> a</span>. Qed.</div></details>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> <span class="id"> :=</span><span class="id"> some_canV_subproof</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> some_fun_subproof</span><span class="id"> :</span><span class="id"> isFun</span><span class="id"> _</span><span class="id"> _</span><span class="id"> A</span> (<span class="id">some</span><span class="id"> @`</span><span class="id"> A</span>) (<span class="id">@Some</span><span class="id"> T</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> split=&gt;</span><span class="id"> x;</span><span class="gallina-kwd"> exists</span><span class="id"> x</span>. Qed.</div></details>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> some_fun_subproof</span>.<br/>
<br/>
<span class="vernacular">End</span><span class="id"> Some</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> OApply</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {aT</span><span class="id"> rT}</span><span class="id"> {A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT}</span><span class="id"> {B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> rT}</span><span class="id"> {b0</span><span class="id"> :</span><span class="id"> rT}</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Notation</span><span class="id"> oapp</span><span class="id"> f</span><span class="id"> :=</span> (<span class="id">oapp</span><span class="id"> f</span><span class="id"> b0</span>).<br/>
<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> {f</span><span class="id"> :</span><span class="id"> {oinv</span><span class="id"> aT</span><span class="id"> &gt;-&gt;</span><span class="id"> rT}}</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">Inv</span>.<span class="id">Build</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">oapp</span><span class="id"> f</span>)<span class="id"> 'oinv_f</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> inv_oapp</span><span class="id"> {f</span><span class="id"> :</span><span class="id"> {oinv</span><span class="id"> aT</span><span class="id"> &gt;-&gt;</span><span class="id"> rT}}</span><span class="id"> :</span> (<span class="id">oapp</span><span class="id"> f</span>)<span class="id">^-1</span><span class="id"> =</span><span class="id"> 'oinv_f</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> []</span>. Qed.</div></details>
<span class="vernacular">Lemma</span><span class="id"> oinv_oapp</span> <span class="id"> {f</span><span class="id"> :</span><span class="id"> {oinv</span><span class="id"> aT</span><span class="id"> &gt;-&gt;</span><span class="id"> rT}}</span><span class="id"> :</span><span class="id"> 'oinv_</span>(<span class="id">oapp</span><span class="id"> f</span>)<span class="id"> =</span><span class="id"> olift</span><span class="id"> 'oinv_f</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> -inv_oapp</span>. Qed.</div></details>
<span class="vernacular">Lemma</span><span class="id"> inv_oappV</span><span class="id"> {f</span><span class="id"> :</span><span class="id"> {inv</span><span class="id"> aT</span><span class="id"> &gt;-&gt;</span><span class="id"> rT}}</span><span class="id"> :</span><span class="id"> olift</span><span class="id"> f^-1</span><span class="id"> =</span> (<span class="id">oapp</span><span class="id"> f</span>)<span class="id">^-1</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> inv_oapp</span><span class="id"> -oliftV</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> oapp_can_subproof</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {inj</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> rT}</span>)<span class="id"> :</span><span class="id"> Inv_Can</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">some</span><span class="id"> @`</span><span class="id"> A</span>) (<span class="id">oapp</span><span class="id"> f</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> split=&gt;</span><span class="id"> x</span><span class="id"> /set_mem[a</span><span class="id"> Aa</span><span class="id"> &lt;-]/=;</span><span class="id"> rewrite</span><span class="id"> inv_oapp</span><span class="id"> funoK</span><span class="id"> ?inE</span>. Qed.</div></details>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> f</span><span class="id"> :=</span><span class="id"> oapp_can_subproof</span><span class="id"> f</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> oapp_surj_subproof</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {surj</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<span class="id"> :</span><span class="id"> Inv_CanV</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">some</span><span class="id"> @`</span><span class="id"> A</span>)<span class="id"> B</span> (<span class="id">oapp</span><span class="id"> f</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd">by</span><span class="id"> split=&gt;</span><span class="id"> [b|b</span><span class="id"> /set_mem]</span><span class="id"> Bb/=;</span><span class="id"> rewrite</span><span class="id"> inv_oapp;</span><span class="id"> case:</span><span class="id"> oinvP</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> x;</span><span class="gallina-kwd"> exists</span><span class="id"> x</span>.<br/>
Qed.</div></details>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> <span class="id"> f</span><span class="id"> :=</span><span class="id"> oapp_surj_subproof</span><span class="id"> f</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> oapp_fun_subproof</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {fun</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<span class="id"> :</span><span class="id"> isFun</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">some</span><span class="id"> @`</span><span class="id"> A</span>)<span class="id"> B</span> (<span class="id">oapp</span><span class="id"> f</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> split=&gt;</span><span class="id"> x</span><span class="id"> [a</span><span class="id"> Aa</span><span class="id"> &lt;-]</span><span class="id"> /=;</span><span class="id"> apply:</span><span class="id"> funS</span>. Qed.</div></details>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> f</span><span class="id"> :=</span><span class="id"> oapp_fun_subproof</span><span class="id"> f</span>.<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {oinvfun</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<span class="id"> :=</span><span class="id"> Fun</span>.<span class="id">on</span> (<span class="id">oapp</span><span class="id"> f</span>).<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {injfun</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<span class="id"> :=</span><span class="id"> Fun</span>.<span class="id">on</span> (<span class="id">oapp</span><span class="id"> f</span>).<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {surjfun</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<span class="id"> :=</span><span class="id"> Fun</span>.<span class="id">on</span> (<span class="id">oapp</span><span class="id"> f</span>).<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {bij</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<span class="id"> :=</span><span class="id"> Fun</span>.<span class="id">on</span> (<span class="id">oapp</span><span class="id"> f</span>).<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {splitbij</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<span class="id"> :=</span><span class="id"> Fun</span>.<span class="id">on</span> (<span class="id">oapp</span><span class="id"> f</span>).<br/>
<br/>
<span class="vernacular">End</span><span class="id"> OApply</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> OBind</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {aT</span><span class="id"> rT}</span><span class="id"> {A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT}</span><span class="id"> {B</span><span class="id"> :</span><span class="id"> set</span> (<span class="id">option</span><span class="id"> rT</span>)<span class="id">}</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Notation</span><span class="id"> b</span><span class="id"> f</span><span class="id"> :=</span> (<span class="id">oapp</span><span class="id"> f</span><span class="id"> None</span>).<br/>
<span class="vernacular">Local</span><span class="vernacular"> Notation</span><span class="id"> orT</span><span class="id"> :=</span> (<span class="id">option</span><span class="id"> rT</span>).<br/>
<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> {f</span><span class="id"> :</span><span class="id"> {oinv</span><span class="id"> aT</span><span class="id"> &gt;-&gt;</span><span class="id"> orT}}</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">Inv</span>.<span class="id">Build</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">obind</span><span class="id"> f</span>)<span class="id"> 'oinv_f</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> inv_obind</span><span class="id"> {f</span><span class="id"> :</span><span class="id"> {oinv</span><span class="id"> aT</span><span class="id"> &gt;-&gt;</span><span class="id"> orT}}</span><span class="id"> :</span> (<span class="id">obind</span><span class="id"> f</span>)<span class="id">^-1</span><span class="id"> =</span><span class="id"> 'oinv_f</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> []</span>. Qed.</div></details>
<span class="vernacular">Lemma</span><span class="id"> oinv_obind</span><span class="id"> {f</span><span class="id"> :</span><span class="id"> {oinv</span><span class="id"> aT</span><span class="id"> &gt;-&gt;</span><span class="id"> orT}}</span><span class="id"> :</span><span class="id"> 'oinv_</span>(<span class="id">obind</span><span class="id"> f</span>)<span class="id"> =</span><span class="id"> olift</span><span class="id"> 'oinv_f</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> []</span>. Qed.</div></details>
<span class="vernacular">Lemma</span><span class="id"> inv_obindV</span><span class="id"> {f</span><span class="id"> :</span><span class="id"> {inv</span><span class="id"> aT</span><span class="id"> &gt;-&gt;</span><span class="id"> orT}}</span><span class="id"> :</span> (<span class="id">obind</span><span class="id"> f</span>)<span class="id">^-1</span><span class="id"> =</span><span class="id"> olift</span><span class="id"> f^-1</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> inv_obind</span><span class="id"> -oliftV</span>. Qed.</div></details>
<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {fun</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<span class="id"> :=</span><span class="id"> Fun</span>.<span class="id">copy</span> (<span class="id">obind</span><span class="id"> f</span>) (<span class="id">b</span><span class="id"> f</span>).<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {inj</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> orT}</span>)<span class="id"> :=</span><span class="id"> Inject</span>.<span class="id">copy</span> (<span class="id">obind</span><span class="id"> f</span>) (<span class="id">b</span><span class="id"> f</span>).<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {injfun</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<span class="id"> :=</span><span class="id"> Fun</span>.<span class="id">on</span> (<span class="id">obind</span><span class="id"> f</span>).<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {surj</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<span class="id"> :=</span><span class="id"> Surject</span>.<span class="id">copy</span> (<span class="id">obind</span><span class="id"> f</span>) (<span class="id">b</span><span class="id"> f</span>).<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {surjfun</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<span class="id"> :=</span><span class="id"> Fun</span>.<span class="id">on</span> (<span class="id">obind</span><span class="id"> f</span>).<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {bij</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<span class="id"> :=</span><span class="id"> Fun</span>.<span class="id">on</span> (<span class="id">obind</span><span class="id"> f</span>).<br/>
<span class="vernacular">End</span><span class="id"> OBind</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> Composition</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {aT</span><span class="id"> rT</span><span class="id"> sT}</span><span class="id"> {A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT}</span><span class="id"> {B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> rT}</span><span class="id"> {C</span><span class="id"> :</span><span class="id"> set</span><span class="id"> sT}</span>.<br/>
<br/>
<span class="vernacular">Local</span><span class="vernacular"> Lemma</span><span class="id"> comp_fun_subproof</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {fun</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>) (<span class="id">g</span><span class="id"> :</span><span class="id"> {fun</span><span class="id"> B</span><span class="id"> &gt;-&gt;</span><span class="id"> C}</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">isFun</span><span class="id"> _</span><span class="id"> _</span><span class="id"> A</span><span class="id"> C</span> (<span class="id">g</span><span class="id"> \o</span><span class="id"> f</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> /'funS_f;</span><span class="id"> apply:</span><span class="id"> funS</span>. Qed.</div></details>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> f</span><span class="id"> g</span><span class="id"> :=</span><span class="id"> comp_fun_subproof</span><span class="id"> f</span><span class="id"> g</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> OInv</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {f</span><span class="id"> :</span><span class="id"> {oinv</span><span class="id"> aT</span><span class="id"> &gt;-&gt;</span><span class="id"> rT}}</span><span class="id"> {g</span><span class="id"> :</span><span class="id"> {oinv</span><span class="id"> rT</span><span class="id"> &gt;-&gt;</span><span class="id"> sT}}</span>.<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> OInv</span>.<span class="id">Build</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">g</span><span class="id"> \o</span><span class="id"> f</span>) (<span class="id">obind</span><span class="id"> 'oinv_f</span><span class="id"> \o</span><span class="id"> 'oinv_g</span>).<br/>
<span class="vernacular">Lemma</span><span class="id"> oinv_comp</span><span class="id"> :</span><span class="id"> 'oinv_</span>(<span class="id">g</span><span class="id"> \o</span><span class="id"> f</span>)<span class="id"> =</span> (<span class="id">obind</span><span class="id"> 'oinv_f</span>)<span class="id"> \o</span><span class="id"> 'oinv_g</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> []</span>. Qed.</div></details>
<span class="vernacular">End</span><span class="id"> OInv</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> OInv</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {f</span><span class="id"> :</span><span class="id"> {inv</span><span class="id"> aT</span><span class="id"> &gt;-&gt;</span><span class="id"> rT}}</span><span class="id"> {g</span><span class="id"> :</span><span class="id"> {inv</span><span class="id"> rT</span><span class="id"> &gt;-&gt;</span><span class="id"> sT}}</span>.<br/>
<span class="vernacular">Lemma</span><span class="id"> some_comp_inv</span><span class="id"> :</span><span class="id"> olift</span> (<span class="id">f^-1</span><span class="id"> \o</span><span class="id"> g^-1</span>)<span class="id"> =</span><span class="id"> 'oinv_</span>(<span class="id">g</span><span class="id"> \o</span><span class="id"> f</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> funeqE</span><span class="id"> =&gt;</span><span class="id"> x;</span><span class="id"> rewrite</span><span class="id"> oinv_comp</span><span class="id"> -!oliftV</span>. Qed.</div></details>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> OInv_Inv</span>.<span class="id">Build</span><span class="id"> aT</span><span class="id"> sT</span> (<span class="id">g</span><span class="id"> \o</span><span class="id"> f</span>)<span class="id"> some_comp_inv</span>.<br/>
<span class="vernacular">Lemma</span><span class="id"> inv_comp</span><span class="id"> :</span> (<span class="id">g</span><span class="id"> \o</span><span class="id"> f</span>)<span class="id">^-1</span><span class="id"> =</span><span class="id"> f^-1</span><span class="id"> \o</span><span class="id"> g^-1</span><br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> []</span>. Qed.</div></details>
<span class="vernacular">End</span><span class="id"> OInv</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> comp_can_subproof</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {injfun</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>) (<span class="id">g</span><span class="id"> :</span><span class="id"> {inj</span><span class="id"> B</span><span class="id"> &gt;-&gt;</span><span class="id"> sT}</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">OInv_Can</span><span class="id"> aT</span><span class="id"> sT</span><span class="id"> A</span> (<span class="id">g</span><span class="id"> \o</span><span class="id"> f</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> split=&gt;</span><span class="id"> x</span><span class="id"> Ax;</span><span class="id"> rewrite</span><span class="id"> oinv_comp/=</span><span class="id"> funoK</span><span class="id"> ?mem_fun//=</span><span class="id"> funoK</span>. Qed.</div></details>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> f</span><span class="id"> g</span><span class="id"> :=</span><span class="id"> comp_can_subproof</span><span class="id"> f</span><span class="id"> g</span>.<br/>
<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {injfun</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>) (<span class="id">g</span><span class="id"> :</span><span class="id"> {injfun</span><span class="id"> B</span><span class="id"> &gt;-&gt;</span><span class="id"> C}</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">Inject</span>.<span class="id">on</span> (<span class="id">g</span><span class="id"> \o</span><span class="id"> f</span>).<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {splitinjfun</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<br/>
&nbsp;&nbsp;(<span class="id">g</span><span class="id"> :</span><span class="id"> {splitinj</span><span class="id"> B</span><span class="id"> &gt;-&gt;</span><span class="id"> sT}</span>)<span class="id"> :=</span><span class="id"> Inject</span>.<span class="id">on</span> (<span class="id">g</span><span class="id"> \o</span><span class="id"> f</span>).<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {splitinjfun</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<br/>
&nbsp;&nbsp;(<span class="id">g</span><span class="id"> :</span><span class="id"> {splitinjfun</span><span class="id"> B</span><span class="id"> &gt;-&gt;</span><span class="id"> C}</span>)<span class="id"> :=</span><span class="id"> Inject</span>.<span class="id">on</span> (<span class="id">g</span><span class="id"> \o</span><span class="id"> f</span>).<br/>
<span class="vernacular">End</span><span class="id"> Composition</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> Composition</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {aT</span><span class="id"> rT</span><span class="id"> sT}</span><span class="id"> {A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT}</span><span class="id"> {B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> rT}</span><span class="id"> {C</span><span class="id"> :</span><span class="id"> set</span><span class="id"> sT}</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> comp_surj_subproof</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {surj</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>) (<span class="id">g</span><span class="id"> :</span><span class="id"> {surj</span><span class="id"> B</span><span class="id"> &gt;-&gt;</span><span class="id"> C}</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">OInv_CanV</span><span class="id"> _</span><span class="id"> _</span><span class="id"> A</span><span class="id"> C</span> (<span class="id">g</span><span class="id"> \o</span><span class="id"> f</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">split;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> funS</span>.<br/>
<span class="id">apply:</span> (<span class="id">@ocan_in_comp</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">mem</span><span class="id"> B</span>))<span class="id"> oinvK</span><span class="id"> oinvK</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> ?</span><span class="id"> /set_mem;</span><span class="id"> rewrite</span><span class="id"> pred_oapp_set</span><span class="id"> inE;</span><span class="id"> apply:</span><span class="id"> funS</span>.<br/>
Qed.</div></details>
<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> f</span><span class="id"> g</span><span class="id"> :=</span><span class="id"> comp_surj_subproof</span><span class="id"> f</span><span class="id"> g</span>.<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {splitsurj</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>) (<span class="id">g</span><span class="id"> :</span><span class="id"> {splitsurj</span><span class="id"> B</span><span class="id"> &gt;-&gt;</span><span class="id"> C}</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">Surject</span>.<span class="id">on</span> (<span class="id">g</span><span class="id"> \o</span><span class="id"> f</span>).<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {surjfun</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>) (<span class="id">g</span><span class="id"> :</span><span class="id"> {surjfun</span><span class="id"> B</span><span class="id"> &gt;-&gt;</span><span class="id"> C}</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">Surject</span>.<span class="id">on</span> (<span class="id">g</span><span class="id"> \o</span><span class="id"> f</span>).<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {splitsurjfun</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<br/>
&nbsp;&nbsp;(<span class="id">g</span><span class="id"> :</span><span class="id"> {splitsurjfun</span><span class="id"> B</span><span class="id"> &gt;-&gt;</span><span class="id"> C}</span>)<span class="id"> :=</span><span class="id"> Surject</span>.<span class="id">on</span> (<span class="id">g</span><span class="id"> \o</span><span class="id"> f</span>).<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {bij</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>) (<span class="id">g</span><span class="id"> :</span><span class="id"> {bij</span><span class="id"> B</span><span class="id"> &gt;-&gt;</span><span class="id"> C}</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">Surject</span>.<span class="id">on</span> (<span class="id">g</span><span class="id"> \o</span><span class="id"> f</span>).<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {splitbij</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>) (<span class="id">g</span><span class="id"> :</span><span class="id"> {splitbij</span><span class="id"> B</span><span class="id"> &gt;-&gt;</span><span class="id"> C}</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">Surject</span>.<span class="id">on</span> (<span class="id">g</span><span class="id"> \o</span><span class="id"> f</span>).<br/>
<br/>
<span class="vernacular">End</span><span class="id"> Composition</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> totalfun</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {aT</span><span class="id"> rT</span><span class="id"> :</span><span class="id"> Type}</span>.<br/>
<span class="vernacular">Definition</span><span class="id"> totalfun_</span> (<span class="id">A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> aT</span><span class="id"> -&gt;</span><span class="id"> rT</span>)<span class="id"> :=</span><span class="id"> f</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT}</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Notation</span><span class="id"> totalfun</span><span class="id"> :=</span> (<span class="id">totalfun_</span><span class="id"> A</span>).<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> aT</span><span class="id"> -&gt;</span><span class="id"> rT</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">isFun</span>.<span class="id">Build</span><span class="id"> _</span><span class="id"> _</span><span class="id"> A</span><span class="id"> setT</span> (<span class="id">totalfun</span><span class="id"> f</span>) (<span class="gallina-kwd">fun</span><span class="id"> _</span><span class="id"> _</span><span class="id"> =&gt;</span><span class="id"> I</span>).<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {inj</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> rT}</span>)<span class="id"> :=</span><span class="id"> Inject</span>.<span class="id">on</span> (<span class="id">totalfun</span><span class="id"> f</span>).<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {splitinj</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> rT}</span>)<span class="id"> :=</span><span class="id"> SplitInj</span>.<span class="id">on</span> (<span class="id">totalfun</span><span class="id"> f</span>).<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {surj</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> [set:</span><span class="id"> rT]}</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">Surject</span>.<span class="id">on</span> (<span class="id">totalfun</span><span class="id"> f</span>).<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {splitsurj</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> [set:</span><span class="id"> rT]}</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">SplitSurj</span>.<span class="id">on</span> (<span class="id">totalfun</span><span class="id"> f</span>).<br/>
<span class="vernacular">End</span><span class="id"> totalfun</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;''totalfun_' A&quot;</span><span class="id"> :=</span> (<span class="id">totalfun_</span><span class="id"> A</span>)<span class="id"> :</span><span class="id"> form_scope</span>.<br/>
<span class="vernacular">Notation</span><span class="id"> totalfun</span><span class="id"> :=</span> (<span class="id">totalfun_</span><span class="id"> setT</span>).<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> Olift</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {aT</span><span class="id"> rT}</span><span class="id"> {A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT}</span><span class="id"> {B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> rT}</span>.<br/>
<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> {f</span><span class="id"> :</span><span class="id"> {oinv</span><span class="id"> aT</span><span class="id"> &gt;-&gt;</span><span class="id"> rT}}</span><span class="id"> :=</span><span class="id"> OInversible</span>.<span class="id">copy</span> (<span class="id">olift</span><span class="id"> f</span>)<br/>
&nbsp;&nbsp;(<span class="id">Some</span><span class="id"> \o</span><span class="id"> f</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> oinv_olift</span> <span class="id"> {f</span><span class="id"> :</span><span class="id"> {oinv</span><span class="id"> aT</span><span class="id"> &gt;-&gt;</span><span class="id"> rT}}</span><span class="id"> :</span><span class="id"> 'oinv_</span>(<span class="id">olift</span><span class="id"> f</span>)<span class="id"> =</span><span class="id"> obind</span><span class="id"> 'oinv_f</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> []</span>. Qed.</div></details>
<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {inj</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> rT}</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">Inject</span>.<span class="id">copy</span> (<span class="id">olift</span><span class="id"> f</span>) (<span class="id">Some</span><span class="id"> \o</span> (<span class="id">'totalfun_A</span><span class="id"> f</span>)).<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {surj</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">Surject</span>.<span class="id">copy</span> (<span class="id">olift</span><span class="id"> f</span>) (<span class="id">Some</span><span class="id"> \o</span><span class="id"> f</span>).<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {fun</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<span class="id"> :=</span><span class="id"> Fun</span>.<span class="id">copy</span> (<span class="id">olift</span><span class="id"> f</span>) (<span class="id">Some</span><span class="id"> \o</span><span class="id"> f</span>).<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {oinvfun</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<span class="id"> :=</span><span class="id"> Fun</span>.<span class="id">on</span> (<span class="id">olift</span><span class="id"> f</span>).<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {injfun</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<span class="id"> :=</span><span class="id"> Fun</span>.<span class="id">on</span> (<span class="id">olift</span><span class="id"> f</span>).<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {surjfun</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<span class="id"> :=</span><span class="id"> Fun</span>.<span class="id">on</span> (<span class="id">olift</span><span class="id"> f</span>).<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {bij</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<span class="id"> :=</span><span class="id"> Fun</span>.<span class="id">on</span> (<span class="id">olift</span><span class="id"> f</span>).<br/>
<br/>
<span class="vernacular">End</span><span class="id"> Olift</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> Map</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {aT</span><span class="id"> rT}</span><span class="id"> {A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT}</span><span class="id"> {B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> rT}</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Notation</span><span class="id"> m</span><span class="id"> f</span><span class="id"> :=</span> (<span class="id">obind</span> (<span class="id">olift</span><span class="id"> f</span>)).<br/>
<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {fun</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<span class="id"> :=</span><span class="id"> Fun</span>.<span class="id">copy</span> (<span class="id">omap</span><span class="id"> f</span>) (<span class="id">m</span><span class="id"> f</span>).<br/>
<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> {f</span><span class="id"> :</span><span class="id"> {oinv</span><span class="id"> aT</span><span class="id"> &gt;-&gt;</span><span class="id"> rT}}</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">Inv</span>.<span class="id">Build</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">omap</span><span class="id"> f</span>) (<span class="id">obind</span><span class="id"> 'oinv_f</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> inv_omap</span><span class="id"> {f</span><span class="id"> :</span><span class="id"> {oinv</span><span class="id"> aT</span><span class="id"> &gt;-&gt;</span><span class="id"> rT}}</span><span class="id"> :</span> (<span class="id">omap</span><span class="id"> f</span>)<span class="id">^-1</span><span class="id"> =</span><span class="id"> obind</span><span class="id"> 'oinv_f</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> []</span>. Qed.</div></details>
<span class="vernacular">Lemma</span><span class="id"> oinv_omap</span><span class="id"> {f</span><span class="id"> :</span><span class="id"> {oinv</span><span class="id"> aT</span><span class="id"> &gt;-&gt;</span><span class="id"> rT}}</span><span class="id"> :</span><span class="id"> 'oinv_</span>(<span class="id">omap</span><span class="id"> f</span>)<span class="id"> =</span><span class="id"> olift</span> (<span class="id">obind</span><span class="id"> 'oinv_f</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> []</span>. Qed.</div></details>
<span class="vernacular">Lemma</span><span class="id"> omapV</span><span class="id"> {f</span><span class="id"> :</span><span class="id"> {inv</span><span class="id"> aT</span><span class="id"> &gt;-&gt;</span><span class="id"> rT}}</span><span class="id"> :</span><span class="id"> omap</span><span class="id"> f^-1</span><span class="id"> =</span> (<span class="id">omap</span><span class="id"> f</span>)<span class="id">^-1</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> inv_omap</span><span class="id"> -oliftV</span>. Qed.</div></details>
<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {oinvfun</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<span class="id"> :=</span><span class="id"> Fun</span>.<span class="id">on</span> (<span class="id">omap</span><span class="id"> f</span>).<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {inj</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> rT}</span>)<span class="id"> :=</span><span class="id"> Inject</span>.<span class="id">copy</span> (<span class="id">omap</span><span class="id"> f</span>) (<span class="id">m</span><span class="id"> f</span>).<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {injfun</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<span class="id"> :=</span><span class="id"> Fun</span>.<span class="id">on</span> (<span class="id">omap</span><span class="id"> f</span>).<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {surj</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<span class="id"> :=</span><span class="id"> Surject</span>.<span class="id">copy</span> (<span class="id">omap</span><span class="id"> f</span>) (<span class="id">m</span><span class="id"> f</span>).<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {surjfun</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<span class="id"> :=</span><span class="id"> Fun</span>.<span class="id">on</span> (<span class="id">omap</span><span class="id"> f</span>).<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {bij</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<span class="id"> :=</span><span class="id"> Fun</span>.<span class="id">on</span> (<span class="id">omap</span><span class="id"> f</span>).<br/>
<span class="vernacular">End</span><span class="id"> Map</span>.<br/>
<br/>
<div class="doc">Builders </div>
<br/>
<span class="id">HB</span>.<span class="id">factory</span><span class="vernacular"> Record</span><span class="id"> CanV</span><span class="id"> {aT</span><span class="id"> rT}</span><span class="id"> {A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT}</span><span class="id"> {B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> rT}</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> aT</span><span class="id"> -&gt;</span><span class="id"> rT</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">{</span><span class="id"> inv;</span><span class="id"> invS</span><span class="id"> :</span><span class="id"> {homo</span><span class="id"> inv</span><span class="id"> :</span><span class="id"> x</span><span class="id"> /</span><span class="id"> B</span><span class="id"> x</span><span class="id"> &gt;-&gt;</span><span class="id"> A</span><span class="id"> x};</span><span class="id"> invK</span><span class="id"> :</span><span class="id"> {in</span><span class="id"> B,</span><span class="id"> cancel</span><span class="id"> inv</span><span class="id"> f};</span><span class="id"> }</span>.<br/>
<span class="id">HB</span>.<span class="id">builders</span><span class="vernacular"> Context</span><span class="id"> {aT</span><span class="id"> rT}</span><span class="id"> {A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT}</span><span class="id"> {B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> rT}</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> aT</span><span class="id"> -&gt;</span><span class="id"> rT</span>)<span class="id"> of</span><span class="id"> CanV</span><span class="id"> _</span><span class="id"> _</span><span class="id"> A</span><span class="id"> B</span><span class="id"> f</span>.<br/>
&nbsp;<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> Inv</span>.<span class="id">Build</span><span class="id"> _</span><span class="id"> _</span><span class="id"> f</span><span class="id"> inv</span>.<br/>
&nbsp;<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> Inv_CanV</span>.<span class="id">Build</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> f</span><span class="id"> invS</span><span class="id"> invK</span>.<br/>
<span class="id">HB</span>.<span class="gallina-kwd">end</span>.<br/>
<br/>
<span class="id">HB</span>.<span class="id">factory</span><span class="vernacular"> Record</span><span class="id"> OInv_Can2</span><span class="id"> {aT</span><span class="id"> rT}</span><span class="id"> {A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT}</span><span class="id"> {B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> rT}</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> aT</span><span class="id"> -&gt;</span><span class="id"> rT</span>)<span class="id"> of</span><br/>
&nbsp;&nbsp;<span class="id">@OInv</span><span class="id"> _</span><span class="id"> _</span><span class="id"> f</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">{</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">funS</span><span class="id"> :</span> <span class="id"> {homo</span><span class="id"> f</span><span class="id"> :</span><span class="id"> x</span><span class="id"> /</span><span class="id"> A</span><span class="id"> x</span><span class="id"> &gt;-&gt;</span><span class="id"> B</span><span class="id"> x};</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">oinvS</span><span class="id"> :</span><span class="id"> {homo</span><span class="id"> 'oinv_f</span><span class="id"> :</span><span class="id"> x</span><span class="id"> /</span><span class="id"> B</span><span class="id"> x</span><span class="id"> &gt;-&gt;</span> (<span class="id">some</span><span class="id"> @`</span><span class="id"> A</span>)<span class="id"> x};</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">funoK</span><span class="id"> :</span><span class="id"> {in</span><span class="id"> A,</span><span class="id"> pcancel</span><span class="id"> f</span><span class="id"> 'oinv_f};</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">oinvK</span><span class="id"> :</span><span class="id"> {in</span><span class="id"> B,</span><span class="id"> ocancel</span><span class="id"> 'oinv_f</span><span class="id"> f};</span><br/>
&nbsp;&nbsp;<span class="id">}</span>.<br/>
<span class="id">HB</span>.<span class="id">builders</span><span class="vernacular"> Context</span><span class="id"> {aT</span><span class="id"> rT}</span><span class="id"> A</span><span class="id"> B</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> aT</span><span class="id"> -&gt;</span><span class="id"> rT</span>)<span class="id"> of</span><span class="id"> OInv_Can2</span><span class="id"> _</span><span class="id"> _</span><span class="id"> A</span><span class="id"> B</span><span class="id"> f</span>.<br/>
&nbsp;&nbsp;<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> isFun</span>.<span class="id">Build</span><span class="id"> aT</span><span class="id"> rT</span><span class="id"> _</span><span class="id"> _</span><span class="id"> f</span><span class="id"> funS</span>.<br/>
&nbsp;&nbsp;<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> OInv_Can</span>.<span class="id">Build</span><span class="id"> aT</span><span class="id"> rT</span><span class="id"> _</span><span class="id"> f</span><span class="id"> funoK</span>.<br/>
&nbsp;&nbsp;<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> OInv_CanV</span>.<span class="id">Build</span><span class="id"> aT</span><span class="id"> rT</span><span class="id"> _</span><span class="id"> _</span><span class="id"> f</span><span class="id"> oinvS</span><span class="id"> oinvK</span>.<br/>
<span class="id">HB</span>.<span class="gallina-kwd">end</span>.<br/>
<br/>
<span class="id">HB</span>.<span class="id">factory</span><span class="vernacular"> Record</span><span class="id"> OCan2</span><span class="id"> {aT</span><span class="id"> rT}</span><span class="id"> {A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT}</span><span class="id"> {B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> rT}</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> aT</span><span class="id"> -&gt;</span><span class="id"> rT</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id">{</span><span class="id"> oinv;</span><span class="id"> funS</span><span class="id"> :</span> <span class="id"> {homo</span><span class="id"> f</span><span class="id"> :</span><span class="id"> x</span><span class="id"> /</span><span class="id"> A</span><span class="id"> x</span><span class="id"> &gt;-&gt;</span><span class="id"> B</span><span class="id"> x};</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">oinvS</span><span class="id"> :</span><span class="id"> {homo</span><span class="id"> oinv</span><span class="id"> :</span><span class="id"> x</span><span class="id"> /</span><span class="id"> B</span><span class="id"> x</span><span class="id"> &gt;-&gt;</span> (<span class="id">some</span><span class="id"> @`</span><span class="id"> A</span>)<span class="id"> x};</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">funoK</span><span class="id"> :</span><span class="id"> {in</span><span class="id"> A,</span><span class="id"> pcancel</span><span class="id"> f</span><span class="id"> oinv};</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">oinvK</span><span class="id"> :</span><span class="id"> {in</span><span class="id"> B,</span><span class="id"> ocancel</span><span class="id"> oinv</span><span class="id"> f};</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id">}</span>.<br/>
<span class="id">HB</span>.<span class="id">builders</span><span class="vernacular"> Context</span><span class="id"> {aT</span><span class="id"> rT}</span><span class="id"> A</span><span class="id"> B</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> aT</span><span class="id"> -&gt;</span><span class="id"> rT</span>)<span class="id"> of</span><span class="id"> OCan2</span><span class="id"> _</span><span class="id"> _</span><span class="id"> A</span><span class="id"> B</span><span class="id"> f</span>.<br/>
&nbsp;&nbsp;<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> OInv</span>.<span class="id">Build</span><span class="id"> aT</span><span class="id"> rT</span><span class="id"> f</span><span class="id"> oinv</span>.<br/>
&nbsp;&nbsp;<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> OInv_Can2</span>.<span class="id">Build</span><span class="id"> aT</span><span class="id"> rT</span><span class="id"> _</span><span class="id"> _</span><span class="id"> f</span><span class="id"> funS</span><span class="id"> oinvS</span><span class="id"> funoK</span><span class="id"> oinvK</span>.<br/>
<span class="id">HB</span>.<span class="gallina-kwd">end</span>.<br/>
<br/>
<br/>
<span class="id">HB</span>.<span class="id">factory</span><span class="vernacular"> Record</span><span class="id"> Can</span><span class="id"> {aT</span><span class="id"> rT}</span><span class="id"> {A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT}</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> aT</span><span class="id"> -&gt;</span><span class="id"> rT</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">{</span><span class="id"> inv;</span><span class="id"> funK</span><span class="id"> :</span><span class="id"> {in</span><span class="id"> A,</span><span class="id"> cancel</span><span class="id"> f</span><span class="id"> inv}</span><span class="id"> }</span>.<br/>
<span class="id">HB</span>.<span class="id">builders</span><span class="vernacular"> Context</span><span class="id"> {aT</span><span class="id"> rT}</span><span class="id"> A</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> aT</span><span class="id"> -&gt;</span><span class="id"> rT</span>)<span class="id"> of</span><span class="id"> @Can</span><span class="id"> _</span><span class="id"> _</span><span class="id"> A</span><span class="id"> f</span>. <br/>
&nbsp;<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> Inv</span>.<span class="id">Build</span><span class="id"> _</span><span class="id"> _</span><span class="id"> f</span><span class="id"> inv</span>.<br/>
&nbsp;<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> Inv_Can</span>.<span class="id">Build</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> f</span><span class="id"> funK</span>.<br/>
<span class="id">HB</span>.<span class="gallina-kwd">end</span>.<br/>
<br/>
<span class="id">HB</span>.<span class="id">factory</span><span class="vernacular"> Record</span><span class="id"> Inv_Can2</span><span class="id"> {aT</span><span class="id"> rT}</span><span class="id"> {A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT}</span><span class="id"> {B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> rT}</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> aT</span><span class="id"> -&gt;</span><span class="id"> rT</span>)<span class="id"> of</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id">Inv</span><span class="id"> _</span><span class="id"> _</span><span class="id"> f</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id">{</span><span class="id"> funS</span><span class="id"> :</span><span class="id"> {homo</span><span class="id"> f</span><span class="id"> :</span><span class="id"> x</span><span class="id"> /</span><span class="id"> A</span><span class="id"> x</span><span class="id"> &gt;-&gt;</span><span class="id"> B</span><span class="id"> x};</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">invS</span><span class="id"> :</span><span class="id"> {homo</span><span class="id"> f^-1</span><span class="id"> :</span><span class="id"> x</span><span class="id"> /</span><span class="id"> B</span><span class="id"> x</span><span class="id"> &gt;-&gt;</span><span class="id"> A</span><span class="id"> x};</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">funK</span><span class="id"> :</span><span class="id"> {in</span><span class="id"> A,</span><span class="id"> cancel</span><span class="id"> f</span><span class="id"> f^-1};</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">invK</span><span class="id"> :</span><span class="id"> {in</span><span class="id"> B,</span><span class="id"> cancel</span><span class="id"> f^-1</span><span class="id"> f};</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id">}</span>.<br/>
<span class="id">HB</span>.<span class="id">builders</span><span class="vernacular"> Context</span><span class="id"> {aT</span><span class="id"> rT}</span><span class="id"> A</span><span class="id"> B</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> aT</span><span class="id"> -&gt;</span><span class="id"> rT</span>)<span class="id"> of</span><span class="id"> Inv_Can2</span><span class="id"> _</span><span class="id"> _</span><span class="id"> A</span><span class="id"> B</span><span class="id"> f</span>.<br/>
&nbsp;&nbsp;<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> isFun</span>.<span class="id">Build</span><span class="id"> aT</span><span class="id"> rT</span><span class="id"> A</span><span class="id"> B</span><span class="id"> f</span><span class="id"> funS</span>.<br/>
&nbsp;&nbsp;<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> Inv_Can</span>.<span class="id">Build</span><span class="id"> aT</span><span class="id"> rT</span><span class="id"> A</span><span class="id"> f</span><span class="id"> funK</span>.<br/>
&nbsp;&nbsp;<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> @Inv_CanV</span>.<span class="id">Build</span><span class="id"> aT</span><span class="id"> rT</span><span class="id"> A</span><span class="id"> B</span><span class="id"> f</span><span class="id"> invS</span><span class="id"> invK</span>.<br/>
<span class="id">HB</span>.<span class="gallina-kwd">end</span>.<br/>
<br/>
<span class="id">HB</span>.<span class="id">factory</span><span class="vernacular"> Record</span><span class="id"> Can2</span><span class="id"> {aT</span><span class="id"> rT}</span><span class="id"> {A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT}</span><span class="id"> {B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> rT}</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> aT</span><span class="id"> -&gt;</span><span class="id"> rT</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">{</span><span class="id"> inv;</span><span class="id"> funS</span><span class="id"> :</span><span class="id"> {homo</span><span class="id"> f</span><span class="id"> :</span><span class="id"> x</span><span class="id"> /</span><span class="id"> A</span><span class="id"> x</span><span class="id"> &gt;-&gt;</span><span class="id"> B</span><span class="id"> x};</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">invS</span><span class="id"> :</span><span class="id"> {homo</span><span class="id"> inv</span><span class="id"> :</span><span class="id"> x</span><span class="id"> /</span><span class="id"> B</span><span class="id"> x</span><span class="id"> &gt;-&gt;</span><span class="id"> A</span><span class="id"> x};</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">funK</span><span class="id"> :</span><span class="id"> {in</span><span class="id"> A,</span><span class="id"> cancel</span><span class="id"> f</span><span class="id"> inv};</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">invK</span><span class="id"> :</span><span class="id"> {in</span><span class="id"> B,</span><span class="id"> cancel</span><span class="id"> inv</span><span class="id"> f};</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id">}</span>.<br/>
<span class="id">HB</span>.<span class="id">builders</span><span class="vernacular"> Context</span><span class="id"> {aT</span><span class="id"> rT}</span><span class="id"> A</span><span class="id"> B</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> aT</span><span class="id"> -&gt;</span><span class="id"> rT</span>)<span class="id"> of</span><span class="id"> Can2</span><span class="id"> _</span><span class="id"> _</span><span class="id"> A</span><span class="id"> B</span><span class="id"> f</span>.<br/>
&nbsp;&nbsp;<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> Inv</span>.<span class="id">Build</span><span class="id"> aT</span><span class="id"> rT</span><span class="id"> f</span><span class="id"> inv</span>.<br/>
&nbsp;&nbsp;<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> Inv_Can2</span>.<span class="id">Build</span><span class="id"> aT</span><span class="id"> rT</span><span class="id"> A</span><span class="id"> B</span><span class="id"> f</span><span class="id"> funS</span><span class="id"> invS</span><span class="id"> funK</span><span class="id"> invK</span>.<br/>
<span class="id">HB</span>.<span class="gallina-kwd">end</span>.<br/>
<br/>
<span class="id">HB</span>.<span class="id">factory</span><span class="vernacular"> Record</span><span class="id"> SplitInjFun_CanV</span><span class="id"> {aT</span><span class="id"> rT}</span><span class="id"> {A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT}</span><span class="id"> {B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> rT}</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> aT</span><span class="id"> -&gt;</span><span class="id"> rT</span>)<span class="id"> of</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">@SplitInjFun</span><span class="id"> _</span><span class="id"> _</span><span class="id"> A</span><span class="id"> B</span><span class="id"> f</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">{</span><span class="id"> invS</span><span class="id"> :</span><span class="id"> {homo</span><span class="id"> f^-1</span><span class="id"> :</span><span class="id"> x</span><span class="id"> /</span><span class="id"> B</span><span class="id"> x</span><span class="id"> &gt;-&gt;</span><span class="id"> A</span><span class="id"> x};</span><span class="id"> injV</span><span class="id"> :</span><span class="id"> {in</span><span class="id"> B</span><span class="id"> &amp;,</span><span class="id"> injective</span><span class="id"> f^-1}</span><span class="id"> }</span>.<br/>
<span class="id">HB</span>.<span class="id">builders</span><span class="vernacular"> Context</span><span class="id"> {aT</span><span class="id"> rT}</span><span class="id"> {A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT}</span><span class="id"> {B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> rT}</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> aT</span><span class="id"> -&gt;</span><span class="id"> rT</span>)<span class="id"> of</span><span class="id"> SplitInjFun_CanV</span><span class="id"> _</span><span class="id"> _</span><span class="id"> A</span><span class="id"> B</span><span class="id"> f</span>.<br/>
&nbsp;&nbsp;<span class="vernacular">Let</span><span class="id"> mem_inv</span><span class="id"> :=</span><span class="id"> homo_setP</span>.<span class="id">2</span><span class="id"> invS</span>.<br/>
&nbsp;&nbsp;<span class="vernacular">Local</span><span class="vernacular"> Lemma</span><span class="id"> invK</span><span class="id"> :</span><span class="id"> {in</span><span class="id"> B,</span><span class="id"> cancel</span><span class="id"> f^-1</span><span class="id"> f}</span>.<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> Bx;</span><span class="id"> apply:</span><span class="id"> injV;</span><span class="id"> rewrite</span><span class="id"> ?funK</span><span class="id"> ?</span>(<span class="id">mem_fun,</span><span class="id"> mem_inv</span>). Qed.</div></details>
&nbsp;&nbsp;<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> Inv_CanV</span>.<span class="id">Build</span><span class="id"> aT</span><span class="id"> rT</span><span class="id"> A</span><span class="id"> B</span><span class="id"> f</span><span class="id"> invS</span><span class="id"> invK</span>.<br/>
<span class="id">HB</span>.<span class="gallina-kwd">end</span>.<br/>
<br/>
<span class="id">HB</span>.<span class="id">factory</span><span class="vernacular"> Record</span><span class="id"> BijTT</span><span class="id"> {aT</span><span class="id"> rT}</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> aT</span><span class="id"> -&gt;</span><span class="id"> rT</span>)<span class="id"> :=</span><span class="id"> {</span><span class="id"> bij</span><span class="id"> :</span><span class="id"> bijective</span><span class="id"> f</span><span class="id"> }</span>.<br/>
<span class="id">HB</span>.<span class="id">builders</span><span class="vernacular"> Context</span><span class="id"> {aT</span><span class="id"> rT}</span><span class="id"> f</span><span class="id"> of</span><span class="id"> BijTT</span><span class="id"> aT</span><span class="id"> rT</span><span class="id"> f</span>.<br/>
&nbsp;&nbsp;<span class="vernacular">Local</span><span class="vernacular"> Lemma</span><span class="id"> exg</span><span class="id"> :</span><span class="id"> {g</span><span class="id"> |</span><span class="id"> cancel</span><span class="id"> f</span><span class="id"> g</span><span class="id"> /\</span><span class="id"> cancel</span><span class="id"> g</span><span class="id"> f}</span>.<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> cid;</span><span class="id"> case:</span><span class="id"> bij</span><span class="id"> =&gt;</span><span class="id"> g;</span><span class="gallina-kwd"> exists</span><span class="id"> g</span>. Qed.</div></details>
&nbsp;&nbsp;<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> Can2</span>.<span class="id">Build</span><span class="id"> aT</span><span class="id"> rT</span><span class="id"> setT</span><span class="id"> setT</span><span class="id"> f</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> y</span><span class="id"> =&gt;</span><span class="id"> y</span>) (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> y</span><span class="id"> =&gt;</span><span class="id"> y</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">in1W</span> (<span class="id">projT2</span><span class="id"> exg</span>).<span class="id">1</span>) (<span class="id">in1W</span> (<span class="id">projT2</span><span class="id"> exg</span>).<span class="id">2</span>).<br/>
<span class="id">HB</span>.<span class="gallina-kwd">end</span>.<br/>
<br/>
<div class="doc">Fun in </div>
<br/>
<span class="vernacular">Section</span><span class="id"> surj_oinv</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {aT</span><span class="id"> rT}</span><span class="id"> {A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT}</span><span class="id"> {B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> rT}</span><span class="id"> {f</span><span class="id"> :</span><span class="id"> aT</span><span class="id"> -&gt;</span><span class="id"> rT}</span> (<span class="id">fsurj</span><span class="id"> :</span><span class="id"> set_surj</span><span class="id"> A</span><span class="id"> B</span><span class="id"> f</span>).<br/>
<br/>
<span class="vernacular">Let</span><span class="id"> surjective_oinv</span> (<span class="id">y</span><span class="id"> :</span><span class="id"> rT</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">if</span><span class="id"> pselect</span> (<span class="id">B</span><span class="id"> y</span>)<span class="id"> is</span><span class="id"> left</span><span class="id"> By</span><span class="gallina-kwd"> then</span><span class="id"> some</span> (<span class="id">projT1</span> (<span class="id">cid2</span> (<span class="id">fsurj</span><span class="id"> By</span>)))<span class="gallina-kwd"> else</span><span class="id"> None</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> surjective_oinvK</span><span class="id"> :</span><span class="id"> {in</span><span class="id"> B,</span><span class="id"> ocancel</span><span class="id"> surjective_oinv</span><span class="id"> f}</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /surjective_oinv</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> /set_mem</span><span class="id"> ?;</span><span class="id"> case:</span><span class="id"> pselect</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> ?;</span><span class="id"> case:</span><span class="id"> cid2</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> surjective_oinvS</span><span class="id"> :</span><span class="id"> set_fun</span><span class="id"> B</span> (<span class="id">some</span><span class="id"> @`</span><span class="id"> A</span>)<span class="id"> surjective_oinv</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> y</span><span class="id"> By</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> /surjective_oinv;</span><span class="id"> case:</span><span class="id"> pselect</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> By'</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> case:</span><span class="id"> cid2</span><span class="id"> =&gt;</span><span class="id"> //=</span><span class="id"> x</span><span class="id"> Ax</span><span class="id"> fxy;</span><span class="gallina-kwd"> exists</span><span class="id"> x</span>.<br/>
Qed.</div></details>
<span class="vernacular">End</span><span class="id"> surj_oinv</span>.<br/>
<span class="vernacular">Coercion</span><span class="id"> surjective_ocanV</span><span class="id"> {aT</span><span class="id"> rT}</span><span class="id"> {A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT}</span><span class="id"> {B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> rT}</span><span class="id"> {f</span><span class="id"> :</span><span class="id"> aT</span><span class="id"> -&gt;</span><span class="id"> rT}</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">fS</span><span class="id"> :</span><span class="id"> set_surj</span><span class="id"> A</span><span class="id"> B</span><span class="id"> f</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">OCanV</span>.<span class="id">Build</span><span class="id"> aT</span><span class="id"> rT</span><span class="id"> A</span><span class="id"> B</span><span class="id"> f</span> (<span class="id">surjective_oinvS</span><span class="id"> fS</span>) (<span class="id">surjective_oinvK</span><span class="id"> fS</span>).<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> Psurj</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {aT</span><span class="id"> rT}</span><span class="id"> {A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT}</span><span class="id"> {B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> rT}</span><span class="id"> {f</span><span class="id"> :</span><span class="id"> aT</span><span class="id"> -&gt;</span><span class="id"> rT}</span> (<span class="id">fsurj</span><span class="id"> :</span><span class="id"> set_surj</span><span class="id"> A</span><span class="id"> B</span><span class="id"> f</span>).<br/>
<br/>
<span class="id">#[local]</span><span class="id"> HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :</span><span class="id"> OCanV</span><span class="id"> _</span><span class="id"> _</span><span class="id"> A</span><span class="id"> B</span><span class="id"> f</span><span class="id"> :=</span><span class="id"> fsurj</span>.<br/>
<span class="vernacular">Definition</span><span class="id"> surjection_of_surj</span><span class="id"> :=</span><span class="id"> [surj</span><span class="id"> of</span><span class="id"> f]</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> Psurj</span><span class="id"> :</span><span class="id"> {s</span><span class="id"> :</span><span class="id"> {surj</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span><span class="id"> |</span><span class="id"> f</span><span class="id"> =</span><span class="id"> s}</span><br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="gallina-kwd"> exists</span><span class="id"> [surj</span><span class="id"> of</span><span class="id"> f]</span>. Qed.</div></details>
<span class="vernacular">End</span><span class="id"> Psurj</span>.<br/>
<span class="vernacular">Coercion</span><span class="id"> surjection_of_surj</span><span class="id"> :</span><span class="id"> set_surj</span><span class="id"> &gt;-&gt;</span><span class="id"> Surject</span>.<span class="id">type</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> oinv_surj</span><span class="id"> {aT</span><span class="id"> rT}</span><span class="id"> {A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT}</span><span class="id"> {B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> rT}</span><span class="id"> {f</span><span class="id"> :</span><span class="id"> aT</span><span class="id"> -&gt;</span><span class="id"> rT}</span><br/>
&nbsp;&nbsp;&nbsp;(<span class="id">fS</span><span class="id"> :</span><span class="id"> set_surj</span><span class="id"> A</span><span class="id"> B</span><span class="id"> f</span>)<span class="id"> y</span><span class="id"> :</span><br/>
&nbsp;<span class="id">'oinv_fS</span><span class="id"> y</span><span class="id"> =</span><span class="gallina-kwd"> if</span><span class="id"> pselect</span> (<span class="id">B</span><span class="id"> y</span>)<span class="id"> is</span><span class="id"> left</span><span class="id"> By</span><span class="gallina-kwd"> then</span><span class="id"> some</span> (<span class="id">projT1</span> (<span class="id">cid2</span> (<span class="id">fS</span><span class="id"> y</span><span class="id"> By</span>)))<span class="gallina-kwd"> else</span><span class="id"> None</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> []</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> surj</span><span class="id"> {aT</span><span class="id"> rT}</span><span class="id"> {A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT}</span><span class="id"> {B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> rT}</span><span class="id"> {f</span><span class="id"> :</span><span class="id"> {surj</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}}</span><span class="id"> :</span><span class="id"> set_surj</span><span class="id"> A</span><span class="id"> B</span><span class="id"> f</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> b</span><span class="id"> /'oinvP_f[x</span><span class="id"> Ax</span><span class="id"> _];</span><span class="gallina-kwd"> exists</span><span class="id"> x</span>. Qed.</div></details>
<br/>
<span class="vernacular">Definition</span><span class="id"> phant_surj</span><span class="id"> aT</span><span class="id"> rT</span> (<span class="id">A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT</span>) (<span class="id">B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> rT</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> {surj</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<br/>
&nbsp;&nbsp;<span class="id">of</span><span class="id"> phantom</span> (_<span class="id"> -&gt;</span><span class="id"> _</span>)<span class="id"> f</span><span class="id"> :=</span><span class="id"> @surj</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> f</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;'surj_  f&quot;</span><span class="id"> :=</span> (<span class="id">phant_surj</span> (<span class="id">Phantom</span> (_<span class="id"> -&gt;</span><span class="id"> _</span>)<span class="id"> f</span>))<span class="id"> :</span><span class="id"> form_scope</span>.<br/>
<span class="id">#[global]</span><span class="vernacular"> Hint</span><span class="id"> Extern</span><span class="id"> 0</span> (<span class="id">set_surj</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span>)<span class="id"> =&gt;</span><span class="id"> solve</span><span class="id"> [apply:</span><span class="id"> surj]</span><span class="id"> :</span><span class="id"> core</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> funin_surj</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {aT</span><span class="id"> rT</span><span class="id"> :</span><span class="id"> Type}</span>.<br/>
<br/>
<span class="vernacular">Definition</span><span class="id"> funin</span> (<span class="id">A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> aT</span><span class="id"> -&gt;</span><span class="id"> rT</span>)<span class="id"> :=</span><span class="id"> f</span>.<br/>
<br/>
<span class="vernacular">Context</span><span class="id"> {A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT}</span><span class="id"> {B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> rT}</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> aT</span><span class="id"> -&gt;</span><span class="id"> rT</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> set_fun_image</span><span class="id"> :</span><span class="id"> set_fun</span><span class="id"> A</span> (<span class="id">f</span><span class="id"> @`</span><span class="id"> A</span>)<span class="id"> f</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id"> exact/image_subP</span>. Qed.</div></details>
<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">@isFun</span>.<span class="id">Build</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">funin</span><span class="id"> A</span><span class="id"> f</span>)<span class="id"> set_fun_image</span>.<br/>
<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :</span><span class="id"> OCanV</span><span class="id"> _</span><span class="id"> _</span><span class="id"> A</span> (<span class="id">f</span><span class="id"> @`</span><span class="id"> A</span>) (<span class="id">funin</span><span class="id"> A</span><span class="id"> f</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;&nbsp;((<span class="gallina-kwd">fun</span><span class="id"> _</span><span class="id"> =&gt;</span><span class="id"> id</span>)<span class="id"> :</span><span class="id"> set_surj</span><span class="id"> A</span> (<span class="id">f</span><span class="id"> @`</span><span class="id"> A</span>)<span class="id"> f</span>).<br/>
<br/>
<span class="vernacular">End</span><span class="id"> funin_surj</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;[ 'fun' f 'in' A ]&quot;</span><span class="id"> :=</span> (<span class="id">funin</span><span class="id"> A</span><span class="id"> f</span>)<br/>
&nbsp;&nbsp;(<span class="gallina-kwd">at</span><span class="id"> level</span><span class="id"> 0,</span><span class="id"> f</span><span class="gallina-kwd"> at</span><span class="id"> next</span><span class="id"> level,</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id">format</span> <span class="id">&quot;[ 'fun'  f  'in'  A ]&quot;</span>)<span class="id"> :</span><span class="id"> function_scope</span>.<br/>
<span class="id">#[global]</span><span class="vernacular"> Hint</span><span class="id"> Resolve</span><span class="id"> set_fun_image</span><span class="id"> :</span><span class="id"> core</span>.<br/>
<br/>
<div class="doc">Partial injection </div>
<br/>
<span class="vernacular">Section</span><span class="id"> split</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {aT</span><span class="id"> rT}</span> (<span class="id">A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT</span>) (<span class="id">B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> rT</span>).<br/>
<span class="vernacular">Definition</span><span class="id"> split_</span> (<span class="id">dflt</span><span class="id"> :</span><span class="id"> rT</span><span class="id"> -&gt;</span><span class="id"> aT</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> aT</span><span class="id"> -&gt;</span><span class="id"> rT</span>)<span class="id"> :=</span><span class="id"> f</span>.<br/>
<br/>
<span class="vernacular">Context</span> (<span class="id">dflt</span><span class="id"> :</span><span class="id"> rT</span><span class="id"> -&gt;</span><span class="id"> aT</span>).<br/>
<span class="vernacular">Local</span><span class="vernacular"> Notation</span><span class="id"> split</span><span class="id"> :=</span> (<span class="id">split_</span><span class="id"> dflt</span>).<br/>
<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {fun</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<span class="id"> :=</span><span class="id"> Fun</span>.<span class="id">on</span> (<span class="id">split</span><span class="id"> f</span>).<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> oinv</span>.<br/>
<span class="vernacular">Context</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {oinv</span><span class="id"> aT</span><span class="id"> &gt;-&gt;</span><span class="id"> rT}</span>).<br/>
<span class="vernacular">Let</span><span class="id"> g</span><span class="id"> y</span><span class="id"> :=</span><span class="id"> odflt</span> (<span class="id">dflt</span><span class="id"> y</span>) (<span class="id">'oinv_f</span><span class="id"> y</span>).<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> <span class="id"> :=</span><span class="id"> Inv</span>.<span class="id">Build</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">split</span><span class="id"> f</span>)<span class="id"> g</span>.<br/>
<span class="vernacular">Lemma</span><span class="id"> splitV</span><span class="id"> :</span> (<span class="id">split</span><span class="id"> f</span>)<span class="id">^-1</span><span class="id"> =</span><span class="id"> g</span><br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> []</span>. Qed.</div></details>
<span class="vernacular">End</span><span class="id"> oinv</span>.<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {oinvfun</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<span class="id"> :=</span><span class="id"> Fun</span>.<span class="id">on</span> (<span class="id">split</span><span class="id"> f</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> splitis_inj_subproof</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {inj</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> rT}</span>)<span class="id"> :</span><span class="id"> Inv_Can</span><span class="id"> _</span><span class="id"> _</span><span class="id"> A</span> (<span class="id">split</span><span class="id"> f</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> split=&gt;</span><span class="id"> x</span><span class="id"> Ax;</span><span class="id"> rewrite</span><span class="id"> splitV</span><span class="id"> funoK</span>. Qed.</div></details>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> f</span><span class="id"> :=</span><span class="id"> splitis_inj_subproof</span><span class="id"> f</span>.<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {injfun</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<span class="id"> :=</span><span class="id"> Inject</span>.<span class="id">on</span> (<span class="id">split</span><span class="id"> f</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> splitid</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {splitinjfun</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<span class="id"> :</span> (<span class="id">split</span><span class="id"> f</span>)<span class="id">^-1</span><span class="id"> =</span><span class="id"> f^-1</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> apply/funext</span><span class="id"> =&gt;</span><span class="id"> x;</span><span class="id"> apply:</span><span class="id"> Some_inj;</span><span class="id"> rewrite</span><span class="id"> splitV</span><span class="id"> -oliftV</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> splitsurj_subproof</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {surj</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<span class="id"> :</span><span class="id"> Inv_CanV</span><span class="id"> _</span><span class="id"> _</span><span class="id"> A</span><span class="id"> B</span> (<span class="id">split</span><span class="id"> f</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> split=&gt;</span><span class="id"> [+|+</span><span class="id"> /set_mem]</span><span class="id"> =&gt;</span><span class="id"> b</span><span class="id"> Bb;</span><span class="id"> rewrite</span><span class="id"> splitV;</span><span class="id"> case:</span><span class="id"> oinvP</span>. Qed.</div></details>
<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> f</span><span class="id"> :=</span><span class="id"> splitsurj_subproof</span><span class="id"> f</span>.<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {surjfun</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<span class="id"> :=</span><span class="id"> Surject</span>.<span class="id">on</span> (<span class="id">split</span><span class="id"> f</span>).<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {bij</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<span class="id"> :=</span><span class="id"> Surject</span>.<span class="id">on</span> (<span class="id">split</span><span class="id"> f</span>).<br/>
<br/>
<span class="vernacular">End</span><span class="id"> split</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;''split_' a&quot;</span><span class="id"> :=</span> (<span class="id">split_</span><span class="id"> a</span>)<span class="id"> :</span><span class="id"> form_scope</span>.<br/>
<span class="vernacular">Notation</span><span class="id"> split</span><span class="id"> :=</span><span class="id"> 'split_</span>(<span class="id">fun=&gt;</span><span class="id"> point</span>).<br/>
<br/>
<div class="doc">More Builders </div>
<br/>
<span class="id">HB</span>.<span class="id">factory</span><span class="vernacular"> Record</span><span class="id"> Inj</span><span class="id"> {aT</span><span class="id"> rT}</span> (<span class="id">A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> aT</span><span class="id"> -&gt;</span><span class="id"> rT</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id">{</span><span class="id"> inj</span><span class="id"> :</span><span class="id"> {in</span><span class="id"> A</span><span class="id"> &amp;,</span><span class="id"> injective</span><span class="id"> f}</span><span class="id"> }</span>.<br/>
<span class="id">HB</span>.<span class="id">builders</span><span class="vernacular"> Context</span><span class="id"> {aT</span><span class="id"> rT}</span><span class="id"> A</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> aT</span><span class="id"> -&gt;</span><span class="id"> rT</span>)<span class="id"> of</span><span class="id"> Inj</span><span class="id"> _</span><span class="id"> _</span><span class="id"> A</span><span class="id"> f</span>.<br/>
&nbsp;&nbsp;<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> OInversible</span>.<span class="id">copy</span><span class="id"> f</span><span class="id"> [fun</span><span class="id"> f</span><span class="gallina-kwd"> in</span><span class="id"> A]</span>.<br/>
&nbsp;&nbsp;<span class="vernacular">Lemma</span><span class="id"> funoK</span><span class="id"> :</span><span class="id"> {in</span><span class="id"> A,</span><span class="id"> pcancel</span><span class="id"> f</span><span class="id"> 'oinv_f}</span>.<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> x</span><span class="id"> /set_mem</span><span class="id"> Ax;</span><span class="id"> rewrite</span><span class="id"> oinv_surj</span>.<br/>
&nbsp;&nbsp;<span class="id">case:</span><span class="id"> pselect</span><span class="id"> =&gt;</span><span class="id"> //=;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> case;</span><span class="gallina-kwd"> exists</span><span class="id"> x</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> ?;</span><span class="id"> case:</span><span class="id"> cid2</span><span class="id"> =&gt;</span><span class="id"> //=</span><span class="id"> y</span><span class="id"> Ay</span><span class="id"> /inj;</span><span class="id"> rewrite</span><span class="id"> !inE</span><span class="id"> =&gt;</span><span class="id"> -&gt;</span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
&nbsp;&nbsp;<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> OInv_Can</span>.<span class="id">Build</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> f</span><span class="id"> funoK</span>.<br/>
<span class="id">HB</span>.<span class="gallina-kwd">end</span>.<br/>
<br/>
<span class="id">HB</span>.<span class="id">factory</span><span class="vernacular"> Record</span><span class="id"> SurjFun_Inj</span><span class="id"> {aT</span><span class="id"> rT}</span><span class="id"> {A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT}</span><span class="id"> {B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> rT}</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> aT</span><span class="id"> -&gt;</span><span class="id"> rT</span>)<span class="id"> of</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id">@SurjFun</span><span class="id"> _</span><span class="id"> _</span><span class="id"> A</span><span class="id"> B</span><span class="id"> f</span><span class="id"> :=</span><span class="id"> {</span><span class="id"> inj</span><span class="id"> :</span><span class="id"> {in</span><span class="id"> A</span><span class="id"> &amp;,</span><span class="id"> injective</span><span class="id"> f}</span><span class="id"> }</span>.<br/>
<span class="id">HB</span>.<span class="id">builders</span><span class="vernacular"> Context</span><span class="id"> {aT</span><span class="id"> rT}</span><span class="id"> {A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT}</span><span class="id"> {B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> rT}</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> aT</span><span class="id"> -&gt;</span><span class="id"> rT</span>)<span class="id"> of</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">@SurjFun_Inj</span><span class="id"> _</span><span class="id"> _</span><span class="id"> A</span><span class="id"> B</span><span class="id"> f</span>.<br/>
&nbsp;&nbsp;<span class="vernacular">Let</span><span class="id"> g</span><span class="id"> :=</span><span class="id"> f</span>.<br/>
&nbsp;&nbsp;<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> Inj</span>.<span class="id">Build</span><span class="id"> _</span><span class="id"> _</span><span class="id"> A</span><span class="id"> g</span><span class="id"> inj</span>.<br/>
&nbsp;&nbsp;<span class="vernacular">Let</span><span class="id"> fcan</span><span class="id"> :</span><span class="id"> OInv_Can</span><span class="id"> aT</span><span class="id"> rT</span><span class="id"> A</span><span class="id"> f</span>.<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
&nbsp;&nbsp;<span class="id">split=&gt;</span><span class="id"> x</span><span class="id"> /set_mem</span><span class="id"> Ax;</span><span class="id"> apply:</span><span class="id"> 'inj_</span>(<span class="id">omap</span><span class="id"> g</span>)<span class="id">;</span><span class="id"> rewrite</span><span class="id"> ?mem_fun</span><span class="id"> ?inE//=</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /g</span><span class="id"> -oinvV/=</span><span class="id"> funoK//</span><span class="id"> ?mem_fun</span><span class="id"> ?inE</span>.<br/>
&nbsp;&nbsp;Qed.</div></details>
&nbsp;<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> fcan</span>.<br/>
<span class="id">HB</span>.<span class="gallina-kwd">end</span>.<br/>
<br/>
<span class="id">HB</span>.<span class="id">factory</span><span class="vernacular"> Record</span><span class="id"> SplitSurjFun_Inj</span><span class="id"> {aT</span><span class="id"> rT}</span><span class="id"> {A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT}</span><span class="id"> {B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> rT}</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> aT</span><span class="id"> -&gt;</span><span class="id"> rT</span>)<span class="id"> of</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">@SplitSurjFun</span><span class="id"> _</span><span class="id"> _</span><span class="id"> A</span><span class="id"> B</span><span class="id"> f</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id">{</span><span class="id"> inj</span><span class="id"> :</span><span class="id"> {in</span><span class="id"> A</span><span class="id"> &amp;,</span><span class="id"> injective</span><span class="id"> f}</span><span class="id"> }</span>.<br/>
<span class="id">HB</span>.<span class="id">builders</span><span class="vernacular"> Context</span><span class="id"> {aT</span><span class="id"> rT}</span><span class="id"> {A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT}</span><span class="id"> {B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> rT}</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> aT</span><span class="id"> -&gt;</span><span class="id"> rT</span>)<span class="id"> of</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">@SplitSurjFun_Inj</span><span class="id"> _</span><span class="id"> _</span><span class="id"> A</span><span class="id"> B</span><span class="id"> f</span>.<br/>
&nbsp;&nbsp;<span class="vernacular">Local</span><span class="vernacular"> Lemma</span><span class="id"> funK</span><span class="id"> :</span><span class="id"> {in</span><span class="id"> A,</span><span class="id"> cancel</span><span class="id"> f</span><span class="id"> f^-1%FUN}</span>.<br/>
<details>
&nbsp;&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
 <span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> Ax;</span><span class="id"> apply:</span><span class="id"> inj;</span><span class="id"> rewrite</span><span class="id"> ?invK</span><span class="id"> ?mem_fun</span>. Qed.</div></details>
&nbsp;&nbsp;<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> Inv_Can</span>.<span class="id">Build</span><span class="id"> aT</span><span class="id"> rT</span><span class="id"> _</span><span class="id"> f</span><span class="id"> funK</span>.<br/>
<span class="id">HB</span>.<span class="gallina-kwd">end</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> Inverses</span>.<br/>
<span class="vernacular">Context</span><span class="id"> aT</span><span class="id"> rT</span><span class="id"> {A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT}</span><span class="id"> {B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> rT}</span>.<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {inj</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> rT}</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">SurjFun_Inj</span>.<span class="id">Build</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> [fun</span><span class="id"> f</span><span class="gallina-kwd"> in</span><span class="id"> A]</span><span class="id"> 'inj_f</span>.<br/>
<span class="vernacular">End</span><span class="id"> Inverses</span>.<br/>
<br/>
<div class="ssrdoc md">
## Simple Factories
</div>
<br/>
<span class="vernacular">Section</span><span class="id"> Pinj</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {aT</span><span class="id"> rT}</span><span class="id"> {A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT}</span><span class="id"> {f</span><span class="id"> :</span><span class="id"> aT</span><span class="id"> -&gt;</span><span class="id"> rT}</span> (<span class="id">finj</span><span class="id"> :</span><span class="id"> {in</span><span class="id"> A</span><span class="id"> &amp;,</span><span class="id"> injective</span><span class="id"> f}</span>).<br/>
<span class="id">#[local]</span><span class="id"> HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> Inj</span>.<span class="id">Build</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> f</span><span class="id"> finj</span>.<br/>
<span class="vernacular">Lemma</span><span class="id"> Pinj</span><span class="id"> :</span><span class="id"> {i</span><span class="id"> :</span><span class="id"> {inj</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> rT}</span><span class="id"> |</span><span class="id"> f</span><span class="id"> =</span><span class="id"> i}</span><br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="gallina-kwd"> exists</span><span class="id"> [inj</span><span class="id"> of</span><span class="id"> f]</span>. Qed.</div></details>
<span class="vernacular">End</span><span class="id"> Pinj</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> Pfun</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {aT</span><span class="id"> rT}</span><span class="id"> {A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT}</span><span class="id"> {B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> rT}</span><span class="id"> {f</span><span class="id"> :</span><span class="id"> aT</span><span class="id"> -&gt;</span><span class="id"> rT}</span><br/>
&nbsp;&nbsp;(<span class="id">ffun</span><span class="id"> :</span><span class="id"> {homo</span><span class="id"> f</span><span class="id"> :</span><span class="id"> x</span><span class="id"> /</span><span class="id"> A</span><span class="id"> x</span><span class="id"> &gt;-&gt;</span><span class="id"> B</span><span class="id"> x}</span>).<br/>
<span class="vernacular">Let</span><span class="id"> g</span><span class="id"> :</span><span class="id"> _</span><span class="id"> -&gt;</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> f</span>.<br/>
<span class="id">#[local]</span><span class="id"> HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> isFun</span>.<span class="id">Build</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> g</span><span class="id"> ffun</span>.<br/>
<span class="vernacular">Lemma</span><span class="id"> Pfun</span><span class="id"> :</span><span class="id"> {i</span><span class="id"> :</span><span class="id"> {fun</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span><span class="id"> |</span><span class="id"> f</span><span class="id"> =</span><span class="id"> i}</span><br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="gallina-kwd"> exists</span><span class="id"> [fun</span><span class="id"> of</span><span class="id"> g]</span>. Qed.</div></details>
<span class="vernacular">End</span><span class="id"> Pfun</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> injPfun</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {aT</span><span class="id"> rT}</span><span class="id"> {A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT}</span><span class="id"> {B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> rT}</span><span class="id"> {f</span><span class="id"> :</span><span class="id"> {inj</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> rT}}</span><br/>
&nbsp;&nbsp;&nbsp;(<span class="id">ffun</span><span class="id"> :</span><span class="id"> {homo</span><span class="id"> f</span><span class="id"> :</span><span class="id"> x</span><span class="id"> /</span><span class="id"> A</span><span class="id"> x</span><span class="id"> &gt;-&gt;</span><span class="id"> B</span><span class="id"> x}</span>).<br/>
<span class="vernacular">Let</span><span class="id"> g</span><span class="id"> :</span><span class="id"> _</span><span class="id"> -&gt;</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> f</span>.<br/>
<span class="id">#[local]</span><span class="id"> HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> Inject</span>.<span class="id">on</span><span class="id"> g</span>.<br/>
<span class="id">#[local]</span><span class="id"> HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> isFun</span>.<span class="id">Build</span><span class="id"> _</span><span class="id"> _</span><span class="id"> A</span><span class="id"> B</span><span class="id"> g</span><span class="id"> ffun</span>.<br/>
<span class="vernacular">Lemma</span><span class="id"> injPfun</span><span class="id"> :</span><span class="id"> {i</span><span class="id"> :</span><span class="id"> {injfun</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span><span class="id"> |</span><span class="id"> f</span><span class="id"> =</span><span class="id"> i</span><span class="id"> :&gt;</span> (_<span class="id"> -&gt;</span><span class="id"> _</span>)<span class="id">}</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="gallina-kwd"> exists</span><span class="id"> [injfun</span><span class="id"> of</span><span class="id"> g]</span>. Qed.</div></details>
<span class="vernacular">End</span><span class="id"> injPfun</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> funPinj</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {aT</span><span class="id"> rT}</span><span class="id"> {A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT}</span><span class="id"> {B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> rT}</span><span class="id"> {f</span><span class="id"> :</span><span class="id"> {fun</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}}</span><br/>
&nbsp;&nbsp;(<span class="id">finj</span><span class="id"> :</span><span class="id"> {in</span><span class="id"> A</span><span class="id"> &amp;,</span><span class="id"> injective</span><span class="id"> f}</span>).<br/>
<span class="vernacular">Let</span><span class="id"> g</span><span class="id"> :</span><span class="id"> _</span><span class="id"> -&gt;</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> f</span>.<br/>
<span class="id">#[local]</span><span class="id"> HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> Fun</span>.<span class="id">on</span><span class="id"> g</span>.<br/>
<span class="id">#[local]</span><span class="id"> HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> Inj</span>.<span class="id">Build</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> g</span><span class="id"> finj</span>.<br/>
<span class="vernacular">Lemma</span><span class="id"> funPinj</span><span class="id"> :</span><span class="id"> {i</span><span class="id"> :</span><span class="id"> {injfun</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span><span class="id"> |</span><span class="id"> f</span><span class="id"> =</span><span class="id"> i}</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="gallina-kwd"> exists</span><span class="id"> [injfun</span><span class="id"> of</span><span class="id"> g];</span><span class="id"> apply/funP</span>. Qed.</div></details>
<span class="vernacular">End</span><span class="id"> funPinj</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> funPsurj</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {aT</span><span class="id"> rT}</span><span class="id"> {A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT}</span><span class="id"> {B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> rT}</span><span class="id"> {f</span><span class="id"> :</span><span class="id"> {fun</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}}</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">fsurj</span><span class="id"> :</span><span class="id"> set_surj</span><span class="id"> A</span><span class="id"> B</span><span class="id"> f</span>).<br/>
<span class="vernacular">Let</span><span class="id"> g</span><span class="id"> :</span><span class="id"> _</span><span class="id"> -&gt;</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> f</span>.<br/>
<span class="id">#[local]</span><span class="id"> HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> Fun</span>.<span class="id">on</span><span class="id"> g</span>.<br/>
<span class="id">#[local]</span><span class="id"> HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :</span><span class="id"> OCanV</span><span class="id"> _</span><span class="id"> _</span><span class="id"> A</span><span class="id"> B</span><span class="id"> g</span><span class="id"> :=</span><span class="id"> fsurj</span>.<br/>
<span class="vernacular">Lemma</span><span class="id"> funPsurj</span><span class="id"> :</span><span class="id"> {s</span><span class="id"> :</span><span class="id"> {surjfun</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span><span class="id"> |</span><span class="id"> f</span><span class="id"> =</span><span class="id"> s}</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="gallina-kwd"> exists</span><span class="id"> [surjfun</span><span class="id"> of</span><span class="id"> g];</span><span class="id"> apply/funP</span>. Qed.</div></details>
<span class="vernacular">End</span><span class="id"> funPsurj</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> surjPfun</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {aT</span><span class="id"> rT}</span><span class="id"> {A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT}</span><span class="id"> {B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> rT}</span><span class="id"> {f</span><span class="id"> :</span><span class="id"> {surj</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}}</span><br/>
&nbsp;&nbsp;&nbsp;(<span class="id">ffun</span><span class="id"> :</span><span class="id"> {homo</span><span class="id"> f</span><span class="id"> :</span><span class="id"> x</span><span class="id"> /</span><span class="id"> A</span><span class="id"> x</span><span class="id"> &gt;-&gt;</span><span class="id"> B</span><span class="id"> x}</span>).<br/>
<span class="vernacular">Let</span><span class="id"> g</span><span class="id"> :</span><span class="id"> _</span><span class="id"> -&gt;</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> f</span>.<br/>
<span class="id">#[local]</span><span class="id"> HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> Surject</span>.<span class="id">on</span><span class="id"> g</span>.<br/>
<span class="id">#[local]</span><span class="id"> HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> isFun</span>.<span class="id">Build</span><span class="id"> _</span><span class="id"> _</span><span class="id"> A</span><span class="id"> B</span><span class="id"> g</span><span class="id"> ffun</span>.<br/>
<span class="vernacular">Lemma</span><span class="id"> surjPfun</span><span class="id"> :</span><span class="id"> {s</span><span class="id"> :</span><span class="id"> {surjfun</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span><span class="id"> |</span><span class="id"> f</span><span class="id"> =</span><span class="id"> s</span><span class="id"> :&gt;</span> (_<span class="id"> -&gt;</span><span class="id"> _</span>)<span class="id">}</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="gallina-kwd"> exists</span><span class="id"> [surjfun</span><span class="id"> of</span><span class="id"> g]</span>. Qed.</div></details>
<span class="vernacular">End</span><span class="id"> surjPfun</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> Psplitinj</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {aT</span><span class="id"> rT}</span><span class="id"> {A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT}</span><span class="id"> {f</span><span class="id"> :</span><span class="id"> aT</span><span class="id"> -&gt;</span><span class="id"> rT}</span><span class="id"> {g}</span> (<span class="id">funK</span><span class="id"> :</span><span class="id"> {in</span><span class="id"> A,</span><span class="id"> cancel</span><span class="id"> f</span><span class="id"> g}</span>).<br/>
<span class="id">#[local]</span><span class="id"> HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> Can</span>.<span class="id">Build</span><span class="id"> _</span><span class="id"> _</span><span class="id"> A</span><span class="id"> f</span><span class="id"> funK</span>.<br/>
<span class="vernacular">Lemma</span><span class="id"> Psplitinj</span><span class="id"> :</span><span class="id"> {i</span><span class="id"> :</span><span class="id"> {splitinj</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> rT}</span><span class="id"> |</span><span class="id"> f</span><span class="id"> =</span><span class="id"> i}</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="gallina-kwd"> exists</span><span class="id"> [splitinj</span><span class="id"> of</span><span class="id"> f]</span>. Qed.</div></details>
<span class="vernacular">End</span><span class="id"> Psplitinj</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> funPsplitinj</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {aT</span><span class="id"> rT}</span><span class="id"> {A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT}</span><span class="id"> {B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> rT}</span><span class="id"> {f</span><span class="id"> :</span><span class="id"> {fun</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}}</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {g}</span> (<span class="id">funK</span><span class="id"> :</span><span class="id"> {in</span><span class="id"> A,</span><span class="id"> cancel</span><span class="id"> f</span><span class="id"> g}</span>).<br/>
<span class="vernacular">Let</span><span class="id"> f'</span><span class="id"> :</span><span class="id"> _</span><span class="id"> -&gt;</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> f</span>.<br/>
<span class="id">#[local]</span><span class="id"> HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> Fun</span>.<span class="id">on</span><span class="id"> f'</span>.<br/>
<span class="id">#[local]</span><span class="id"> HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> Can</span>.<span class="id">Build</span><span class="id"> _</span><span class="id"> _</span><span class="id"> A</span><span class="id"> f'</span><span class="id"> funK</span>.<br/>
<span class="vernacular">Lemma</span><span class="id"> funPsplitinj</span><span class="id"> :</span><span class="id"> {i</span><span class="id"> :</span><span class="id"> {splitinjfun</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span><span class="id"> |</span><span class="id"> f</span><span class="id"> =</span><span class="id"> i}</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="gallina-kwd"> exists</span><span class="id"> [splitinjfun</span><span class="id"> of</span><span class="id"> f'];</span><span class="id"> apply/funP</span>. Qed.</div></details>
<span class="vernacular">End</span><span class="id"> funPsplitinj</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> PsplitinjT</span><span class="id"> {aT</span><span class="id"> rT}</span><span class="id"> {f</span><span class="id"> :</span><span class="id"> aT</span><span class="id"> -&gt;</span><span class="id"> rT}</span><span class="id"> {g}</span><span class="id"> :</span><span class="id"> cancel</span><span class="id"> f</span><span class="id"> g</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">{i</span><span class="id"> :</span><span class="id"> {splitinj</span><span class="id"> [set:</span><span class="id"> aT]</span><span class="id"> &gt;-&gt;</span><span class="id"> rT}</span><span class="id"> |</span><span class="id"> f</span><span class="id"> =</span><span class="id"> i}</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move/in1W/Psplitinj</span>. Qed.</div></details>
<br/>
<span class="vernacular">Section</span><span class="id"> funPsplitsurj</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {aT</span><span class="id"> rT}</span><span class="id"> {A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT}</span><span class="id"> {B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> rT}</span><span class="id"> {f</span><span class="id"> :</span><span class="id"> {fun</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}}</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {g</span><span class="id"> :</span><span class="id"> {fun</span><span class="id"> B</span><span class="id"> &gt;-&gt;</span><span class="id"> A}}</span> (<span class="id">funK</span><span class="id"> :</span><span class="id"> {in</span><span class="id"> B,</span><span class="id"> cancel</span><span class="id"> g</span><span class="id"> f}</span>).<br/>
<span class="vernacular">Let</span><span class="id"> f'</span><span class="id"> :</span><span class="id"> _</span><span class="id"> -&gt;</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> f</span>.<br/>
<span class="id">#[local]</span><span class="id"> HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> Fun</span>.<span class="id">on</span><span class="id"> f'</span>.<br/>
<span class="id">#[local]</span><span class="id"> HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> CanV</span>.<span class="id">Build</span><span class="id"> _</span><span class="id"> _</span><span class="id"> A</span><span class="id"> B</span><span class="id"> f'</span><span class="id"> funS</span><span class="id"> funK</span>.<br/>
<span class="vernacular">Lemma</span><span class="id"> funPsplitsurj</span><span class="id"> :</span><span class="id"> {s</span><span class="id"> :</span><span class="id"> {splitsurjfun</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span><span class="id"> |</span><span class="id"> f</span><span class="id"> =</span><span class="id"> s</span><span class="id"> :&gt;</span> (_<span class="id"> -&gt;</span><span class="id"> _</span>)<span class="id">}</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="gallina-kwd"> exists</span><span class="id"> [splitsurjfun</span><span class="id"> of</span><span class="id"> f']</span>. Qed.</div></details>
<span class="vernacular">End</span><span class="id"> funPsplitsurj</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> PsplitsurjT</span><span class="id"> {aT</span><span class="id"> rT}</span><span class="id"> {f</span><span class="id"> :</span><span class="id"> aT</span><span class="id"> -&gt;</span><span class="id"> rT}</span><span class="id"> {g}</span><span class="id"> :</span><span class="id"> cancel</span><span class="id"> g</span><span class="id"> f</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">{s</span><span class="id"> :</span><span class="id"> {splitsurjfun</span><span class="id"> [set:</span><span class="id"> aT]</span><span class="id"> &gt;-&gt;</span><span class="id"> [set:</span><span class="id"> rT]}</span><span class="id"> |</span><span class="id"> f</span><span class="id"> =</span><span class="id"> s}</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd">by</span><span class="id"> move/in1W/</span>(<span class="id">@funPsplitsurj</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> [fun</span><span class="id"> of</span><span class="id"> totalfun</span><span class="id"> f]</span><span class="id"> [fun</span><span class="id"> of</span><span class="id"> totalfun</span><span class="id"> g]</span>).<br/>
Qed.</div></details>
<br/>
<div class="ssrdoc md">
## Instances
</div>
<br/>
<div class="doc">The identity is a split bijection </div>
<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> T</span><span class="id"> A</span><span class="id"> :=</span><span class="id"> @Can2</span>.<span class="id">Build</span><span class="id"> T</span><span class="id"> T</span><span class="id"> A</span><span class="id"> A</span><span class="id"> idfun</span><span class="id"> idfun</span><br/>
&nbsp;&nbsp;&nbsp;(<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> y</span><span class="id"> =&gt;</span><span class="id"> y</span>) (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> y</span><span class="id"> =&gt;</span><span class="id"> y</span>) (<span class="gallina-kwd">fun</span><span class="id"> _</span><span class="id"> _</span><span class="id"> =&gt;</span><span class="id"> erefl</span>) (<span class="gallina-kwd">fun</span><span class="id"> _</span><span class="id"> _</span><span class="id"> =&gt;</span><span class="id"> erefl</span>).<br/>
<br/>
<div class="doc">Iteration preserves Fun, Injectivity, and Surjectivity </div>
<span class="vernacular">Section</span><span class="id"> iter_inv</span>.<br/>
<br/>
<span class="vernacular">Context</span><span class="id"> {aT}</span><span class="id"> {A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT}</span>.<br/>
<br/>
<span class="vernacular">Local</span><span class="vernacular"> Lemma</span><span class="id"> iter_fun_subproof</span><span class="id"> n</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {fun</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> A}</span>)<span class="id"> :</span><span class="id"> isFun</span><span class="id"> _</span><span class="id"> _</span><span class="id"> A</span><span class="id"> A</span> (<span class="id">iter</span><span class="id"> n</span><span class="id"> f</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">split</span><span class="id"> =&gt;</span><span class="id"> x;</span><span class="id"> elim:</span><span class="id"> n</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> n</span><span class="id"> /[apply]</span><span class="id"> ?;</span><span class="id"> apply/</span>(<span class="id">fun_image_sub</span><span class="id"> f</span>).<br/>
<span class="gallina-kwd">by</span><span class="gallina-kwd"> exists</span> (<span class="id">iter</span><span class="id"> n</span><span class="id"> f</span><span class="id"> x</span>).<br/>
Qed.</div></details>
<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> n</span><span class="id"> f</span><span class="id"> :=</span><span class="id"> iter_fun_subproof</span><span class="id"> n</span><span class="id"> f</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> OInv</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {f</span><span class="id"> :</span><span class="id"> {oinv</span><span class="id"> aT</span><span class="id"> &gt;-&gt;</span><span class="id"> aT}}</span>.<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> n</span><span class="id"> :=</span><span class="id"> OInv</span>.<span class="id">Build</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">iter</span><span class="id"> n</span><span class="id"> f</span>)<br/>
&nbsp;&nbsp;(<span class="id">iter</span><span class="id"> n</span> (<span class="id">obind</span><span class="id"> 'oinv_f</span>)<span class="id"> \o</span><span class="id"> some</span>).<br/>
<span class="vernacular">Lemma</span><span class="id"> oinv_iter</span><span class="id"> n</span><span class="id"> :</span><span class="id"> 'oinv_</span>(<span class="id">iter</span><span class="id"> n</span><span class="id"> f</span>)<span class="id"> =</span><span class="id"> iter</span><span class="id"> n</span> (<span class="id">obind</span><span class="id"> 'oinv_f</span>)<span class="id"> \o</span><span class="id"> some</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> []</span>. Qed.</div></details>
<span class="vernacular">End</span><span class="id"> OInv</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> OInv</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {f</span><span class="id"> :</span><span class="id"> {inv</span><span class="id"> aT</span><span class="id"> &gt;-&gt;</span><span class="id"> aT}}</span>.<br/>
<span class="vernacular">Lemma</span><span class="id"> some_iter_inv</span><span class="id"> n</span><span class="id"> :</span><span class="id"> olift</span> (<span class="id">iter</span><span class="id"> n</span><span class="id"> f^-1</span>)<span class="id"> =</span><span class="id"> 'oinv_</span>(<span class="id">iter</span><span class="id"> n</span><span class="id"> f</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">elim:</span><span class="id"> n</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> n</span><span class="id"> IH;</span><span class="id"> rewrite</span><span class="id"> iterfSr</span><span class="id"> olift_comp</span><span class="id"> IH</span><span class="id"> ?oinv_iter</span><span class="id"> -compA</span>.<br/>
<span class="id">rewrite</span> (_<span class="id"> :</span><span class="id"> Some</span><span class="id"> \o</span><span class="id"> f^-1</span><span class="id"> =</span><span class="id"> 'oinv_f</span>)<span class="id">;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> iterfSr;</span><span class="id"> congr</span> (_<span class="id"> \o</span><span class="id"> _</span>).<br/>
<span class="gallina-kwd">by</span><span class="id"> apply/funeqP</span><span class="id"> =&gt;</span><span class="id"> ?</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> some_inv</span>.<br/>
Qed.</div></details>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> n</span><span class="id"> :=</span><span class="id"> OInv_Inv</span>.<span class="id">Build</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">iter</span><span class="id"> n</span><span class="id"> f</span>) (<span class="id">some_iter_inv</span><span class="id"> n</span>).<br/>
<span class="vernacular">Lemma</span><span class="id"> inv_iter</span><span class="id"> n</span><span class="id"> :</span> (<span class="id">iter</span><span class="id"> n</span><span class="id"> f</span>)<span class="id">^-1</span><span class="id"> =</span><span class="id"> iter</span><span class="id"> n</span><span class="id"> f^-1</span><br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> []</span>. Qed.</div></details>
<span class="vernacular">End</span><span class="id"> OInv</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> iter_can_subproof</span><span class="id"> n</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {injfun</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> A}</span>)<span class="id"> :</span><span class="id"> OInv_Can</span><span class="id"> aT</span><span class="id"> aT</span><span class="id"> A</span> (<span class="id">iter</span><span class="id"> n</span><span class="id"> f</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">split=&gt;</span><span class="id"> x</span><span class="id"> Ax;</span><span class="id"> rewrite</span><span class="id"> oinv_iter</span><span class="id"> /=;</span><span class="id"> elim:</span><span class="id"> n=&gt;</span><span class="id"> //</span><span class="id"> n</span><span class="id"> IH</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> iterfSr</span><span class="id"> /=</span><span class="id"> funoK</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> mem_fun</span>.<br/>
Qed.</div></details>
<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> f</span><span class="id"> g</span><span class="id"> :=</span><span class="id"> iter_can_subproof</span><span class="id"> f</span><span class="id"> g</span>.<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> n</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {injfun</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> A}</span>)<span class="id"> :=</span><span class="id"> Inject</span>.<span class="id">on</span> (<span class="id">iter</span><span class="id"> n</span><span class="id"> f</span>).<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> n</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {splitinjfun</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> A}</span>)<span class="id"> :=</span><span class="id"> Inject</span>.<span class="id">on</span> (<span class="id">iter</span><span class="id"> n</span><span class="id"> f</span>).<br/>
<span class="vernacular">End</span><span class="id"> iter_inv</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> iter_surj</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {aT}</span><span class="id"> {A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT}</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> iter_surj_subproof</span><span class="id"> n</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {surj</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> A}</span>)<span class="id"> :</span><span class="id"> OInv_CanV</span><span class="id"> _</span><span class="id"> _</span><span class="id"> A</span><span class="id"> A</span> (<span class="id">iter</span><span class="id"> n</span><span class="id"> f</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">split;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> funS</span>.<br/>
<span class="id">elim:</span><span class="id"> n=&gt;</span><span class="id"> //</span><span class="id"> n</span><span class="id"> IH;</span><span class="id"> rewrite</span><span class="id"> oinv_iter</span><span class="id"> iterfSr</span><span class="id"> iterfS</span>.<br/>
<span class="id">apply:</span> (<span class="id">@ocan_in_comp</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">mem</span><span class="id"> A</span>))<span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> last</span><span class="id"> exact:</span><span class="id"> oinvK</span>.<br/>
<span class="id">elim:</span><span class="id"> n</span><span class="id"> {IH}</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> n</span><span class="id"> IH</span><span class="id"> x</span><span class="id"> Ax;</span><span class="id"> move:</span> (<span class="id">IH</span><span class="id"> _</span><span class="id"> Ax</span>)<span class="id">;</span><span class="id"> rewrite</span><span class="id"> pred_oapp_set</span><span class="id"> ?inE</span>.<br/>
<span class="id">case=&gt;</span><span class="id"> y</span><span class="id"> Ay</span><span class="id"> /=</span><span class="id"> ynf;</span><span class="id"> case:</span> (<span class="id">@oinvS</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> f</span><span class="id"> _</span><span class="id"> Ay</span>)<span class="id"> =&gt;</span><span class="id"> z</span><span class="id"> ?</span><span class="id"> zfinv;</span><span class="gallina-kwd"> exists</span><span class="id"> z</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> zfinv</span><span class="id"> /=</span><span class="id"> -ynf</span>.<br/>
Qed.</div></details>
<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> n</span><span class="id"> f</span><span class="id"> :=</span><span class="id"> iter_surj_subproof</span><span class="id"> n</span><span class="id"> f</span>.<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> n</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {splitsurj</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> A}</span>)<span class="id"> :=</span><span class="id"> Surject</span>.<span class="id">on</span> (<span class="id">iter</span><span class="id"> n</span><span class="id"> f</span>).<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> n</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {surjfun</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> A}</span>)<span class="id"> :=</span><span class="id"> Surject</span>.<span class="id">on</span> (<span class="id">iter</span><span class="id"> n</span><span class="id"> f</span>).<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> n</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {splitsurjfun</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> A}</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">Surject</span>.<span class="id">on</span> (<span class="id">iter</span><span class="id"> n</span><span class="id"> f</span>).<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> n</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {bij</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> A}</span>)<span class="id"> :=</span><span class="id"> Surject</span>.<span class="id">on</span> (<span class="id">iter</span><span class="id"> n</span><span class="id"> f</span>).<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> n</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {splitbij</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> A}</span>)<span class="id"> :=</span><span class="id"> Surject</span>.<span class="id">on</span> (<span class="id">iter</span><span class="id"> n</span><span class="id"> f</span>).<br/>
<br/>
<span class="vernacular">End</span><span class="id"> iter_surj</span>.<br/>
<br/>
<div class="doc">Unbind </div>
<br/>
<span class="vernacular">Section</span><span class="id"> Unbind</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {aT</span><span class="id"> rT}</span><span class="id"> {A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT}</span><span class="id"> {B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> rT}</span> (<span class="id">dflt</span><span class="id"> :</span><span class="id"> aT</span><span class="id"> -&gt;</span><span class="id"> rT</span>).<br/>
<span class="vernacular">Definition</span><span class="id"> unbind</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> aT</span><span class="id"> -&gt;</span><span class="id"> option</span><span class="id"> rT</span>)<span class="id"> x</span><span class="id"> :=</span><span class="id"> odflt</span> (<span class="id">dflt</span><span class="id"> x</span>) (<span class="id">f</span><span class="id"> x</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> unbind_fun_subproof</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {fun</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> some</span><span class="id"> @`</span><span class="id"> B}</span>)<span class="id"> :</span><span class="id"> isFun</span><span class="id"> _</span><span class="id"> _</span><span class="id"> A</span><span class="id"> B</span> (<span class="id">unbind</span><span class="id"> f</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> /unbind;</span><span class="id"> split=&gt;</span><span class="id"> x</span><span class="id"> /'funS_f</span><span class="id"> [y</span><span class="id"> Bu</span><span class="id"> &lt;-]</span>. Qed.</div></details>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> f</span><span class="id"> :=</span><span class="id"> unbind_fun_subproof</span><span class="id"> f</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> Oinv</span>.<br/>
<span class="vernacular">Context</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {oinv</span><span class="id"> aT</span><span class="id"> &gt;-&gt;</span><span class="id"> option</span><span class="id"> rT}</span>).<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> OInv</span>.<span class="id">Build</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">unbind</span><span class="id"> f</span>) (<span class="id">'oinv_f</span><span class="id"> \o</span><span class="id"> some</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> oinv_unbind</span><span class="id"> :</span><span class="id"> 'oinv_</span>(<span class="id">unbind</span><span class="id"> f</span>)<span class="id"> =</span><span class="id"> 'oinv_f</span><span class="id"> \o</span><span class="id"> some</span><br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> []</span>. Qed.</div></details>
<span class="vernacular">End</span><span class="id"> Oinv</span>.<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {oinvfun</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> some</span><span class="id"> @`</span><span class="id"> B}</span>)<span class="id"> :=</span><span class="id"> Fun</span>.<span class="id">on</span> (<span class="id">unbind</span><span class="id"> f</span>).<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> Inv</span>.<br/>
<span class="vernacular">Context</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {inv</span><span class="id"> aT</span><span class="id"> &gt;-&gt;</span><span class="id"> option</span><span class="id"> rT}</span>).<br/>
<span class="vernacular">Lemma</span><span class="id"> inv_unbind_subproof</span><span class="id"> :</span><span class="id"> olift</span> (<span class="id">f^-1</span><span class="id"> \o</span><span class="id"> some</span>)<span class="id"> =</span><span class="id"> 'oinv_</span>(<span class="id">unbind</span><span class="id"> f</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> olift_comp</span><span class="id"> oliftV</span>. Qed.</div></details>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> OInv_Inv</span>.<span class="id">Build</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">unbind</span><span class="id"> f</span>)<span class="id"> inv_unbind_subproof</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> inv_unbind</span><span class="id"> :</span> (<span class="id">unbind</span><span class="id"> f</span>)<span class="id">^-1</span><span class="id"> =</span><span class="id"> f^-1</span><span class="id"> \o</span><span class="id"> some</span><br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> []</span>. Qed.</div></details>
<span class="vernacular">End</span><span class="id"> Inv</span>.<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {invfun</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> some</span><span class="id"> @`</span><span class="id"> B}</span>)<span class="id"> :=</span><span class="id"> Fun</span>.<span class="id">on</span> (<span class="id">unbind</span><span class="id"> f</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> unbind_inj_subproof</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {injfun</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> some</span><span class="id"> @`</span><span class="id"> B}</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id">@OInv_Can</span><span class="id"> _</span><span class="id"> _</span><span class="id"> A</span> (<span class="id">unbind</span><span class="id"> f</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">split=&gt;</span><span class="id"> x</span><span class="id"> Ax;</span><span class="id"> rewrite</span><span class="id"> oinv_unbind</span><span class="id"> /unbind/=;</span><span class="id"> have</span><span class="id"> &lt;-</span><span class="id"> :=</span><span class="id"> 'funoK_f</span><span class="id"> Ax</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> have</span><span class="id"> [y</span><span class="id"> By</span><span class="id"> /=</span><span class="id"> &lt;-]</span><span class="id"> :=</span><span class="id"> 'funS_f</span> (<span class="id">set_mem</span><span class="id"> Ax</span>).<br/>
Qed.</div></details>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> f</span><span class="id"> :=</span><span class="id"> unbind_inj_subproof</span><span class="id"> f</span>.<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {splitinjfun</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> some</span><span class="id"> @`</span><span class="id"> B}</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">Inject</span>.<span class="id">on</span> (<span class="id">unbind</span><span class="id"> f</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> unbind_surj_subproof</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {surj</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> some</span><span class="id"> @`</span><span class="id"> B}</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id">@OInv_CanV</span><span class="id"> _</span><span class="id"> _</span><span class="id"> A</span><span class="id"> B</span> (<span class="id">unbind</span><span class="id"> f</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">split=&gt;</span><span class="id"> [b|b</span><span class="id"> /set_mem]</span><span class="id"> Bb;</span><span class="id"> rewrite</span><span class="id"> oinv_unbind</span><span class="id"> /unbind/=</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> case:</span><span class="id"> oinvP</span><span class="id"> =&gt;</span><span class="id"> [|a];</span><span class="id"> [exists</span><span class="id"> b</span><span class="id"> |</span><span class="gallina-kwd"> exists</span><span class="id"> a]</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> case:</span><span class="id"> oinvP</span><span class="id"> =&gt;</span><span class="id"> [|a</span><span class="id"> Aa</span><span class="id"> /=</span><span class="id"> -&gt;];</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="gallina-kwd"> exists</span><span class="id"> b</span>.<br/>
Qed.</div></details>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> f</span><span class="id"> :=</span><span class="id"> unbind_surj_subproof</span><span class="id"> f</span>.<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {surjfun</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> some</span><span class="id"> @`</span><span class="id"> B}</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">Surject</span>.<span class="id">on</span> (<span class="id">unbind</span><span class="id"> f</span>).<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {splitsurj</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> some</span><span class="id"> @`</span><span class="id"> B}</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">Surject</span>.<span class="id">on</span> (<span class="id">unbind</span><span class="id"> f</span>).<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {splitsurjfun</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> some</span><span class="id"> @`</span><span class="id"> B}</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">Surject</span>.<span class="id">on</span> (<span class="id">unbind</span><span class="id"> f</span>).<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {bij</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> some</span><span class="id"> @`</span><span class="id"> B}</span>)<span class="id"> :=</span><span class="id"> Surject</span>.<span class="id">on</span> (<span class="id">unbind</span><span class="id"> f</span>).<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {splitbij</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> some</span><span class="id"> @`</span><span class="id"> B}</span>)<span class="id"> :=</span><span class="id"> Bij</span>.<span class="id">on</span> (<span class="id">unbind</span><span class="id"> f</span>).<br/>
<br/>
<span class="vernacular">End</span><span class="id"> Unbind</span>.<br/>
<br/>
<div class="doc">Odflt </div>
<br/>
<span class="vernacular">Section</span><span class="id"> Odflt</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {T}</span><span class="id"> {A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T}</span> (<span class="id">x</span><span class="id"> :</span><span class="id"> T</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> odflt_unbind</span><span class="id"> :</span><span class="id"> odflt</span><span class="id"> x</span><span class="id"> =</span><span class="id"> unbind</span> (<span class="id">fun=&gt;</span><span class="id"> x</span>)<span class="id"> idfun</span><br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> []</span>. Qed.</div></details>
<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> Inv</span>.<span class="id">Build</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">odflt</span><span class="id"> x</span>)<span class="id"> some</span>.<br/>
<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> SplitBij</span>.<span class="id">copy</span> (<span class="id">odflt</span><span class="id"> x</span>)<br/>
&nbsp;&nbsp;<span class="id">[the</span><span class="id"> {splitbij</span><span class="id"> some</span><span class="id"> @`</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> A}</span><span class="id"> of</span><span class="id"> @unbind</span> (<span class="id">option</span><span class="id"> T</span>)<span class="id"> T</span> (<span class="id">fun=&gt;</span><span class="id"> x</span>)<span class="id"> idfun]</span>.<br/>
<br/>
<span class="vernacular">End</span><span class="id"> Odflt</span>.<br/>
<br/>
<div class="doc">Subtypes </div>
<br/>
<span class="vernacular">Section</span><span class="id"> SubType</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {T</span><span class="id"> :</span><span class="id"> Type}</span><span class="id"> {P</span><span class="id"> :</span><span class="id"> pred</span><span class="id"> T}</span> (<span class="id">sT</span><span class="id"> :</span><span class="id"> subType</span><span class="id"> P</span>) (<span class="id">x0</span><span class="id"> :</span><span class="id"> sT</span>).<br/>
<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> OInv</span>.<span class="id">Build</span><span class="id"> sT</span><span class="id"> T</span><span class="id"> val</span><span class="id"> insub</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> oinv_val</span><span class="id"> :</span><span class="id"> 'oinv_val</span><span class="id"> =</span><span class="id"> insub</span><br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> []</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> val_bij_subproof</span><span class="id"> :</span><span class="id"> OInv_Can2</span><span class="id"> sT</span><span class="id"> T</span><span class="id"> setT</span><span class="id"> [set`</span><span class="id"> P]</span><span class="id"> val</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">apply:</span> (<span class="id">OInv_Can2</span>.<span class="id">Build</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> val</span> (<span class="gallina-kwd">fun</span><span class="id"> x</span> <span class="id"> _</span><span class="id"> =&gt;</span><span class="id"> valP</span><span class="id"> x</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_ (<span class="id">in1W</span><span class="id"> valK</span>) (<span class="id">in1W</span> (<span class="id">insubK</span><span class="id"> _</span>))).<br/>
<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> Px</span><span class="id"> /=;</span><span class="gallina-kwd"> exists</span> (<span class="id">Sub</span><span class="id"> x</span><span class="id"> Px</span>)<span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> rewrite</span><span class="id"> oinv_val</span><span class="id"> insubT</span>.<br/>
Qed.</div></details>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> val_bij_subproof</span>.<br/>
<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> Bij</span>.<span class="id">copy</span><span class="id"> insub</span><span class="id"> 'oinv_val</span>.<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> SplitBij</span>.<span class="id">copy</span> (<span class="id">insubd</span><span class="id"> x0</span>)<br/>
&nbsp;&nbsp;&nbsp;(<span class="id">odflt</span><span class="id"> x0</span><span class="id"> \o</span><span class="id"> 'split_</span>(<span class="id">fun=&gt;</span><span class="id"> val</span><span class="id"> x0</span>)<span class="id"> insub</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> inv_insubd</span><span class="id"> :</span> (<span class="id">insubd</span><span class="id"> x0</span>)<span class="id">^-1</span><span class="id"> =</span><span class="id"> val</span><br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> []</span>. Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> SubType</span>.<br/>
<br/>
<div class="doc">To setT </div>
<br/>
<span class="vernacular">Definition</span><span class="id"> to_setT</span><span class="id"> {T}</span> (<span class="id">x</span><span class="id"> :</span><span class="id"> T</span>)<span class="id"> :</span><span class="id"> [set:</span><span class="id"> T]</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">@SigSub</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> x</span> (<span class="id">mem_set</span><span class="id"> I</span><span class="id"> :</span><span class="id"> x</span><span class="id"> \in</span><span class="id"> setT</span>).<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> T</span><span class="id"> :=</span><span class="id"> Can</span>.<span class="id">Build</span><span class="id"> T</span><span class="id"> [set:</span><span class="id"> T]</span><span class="id"> setT</span><span class="id"> to_setT</span><br/>
&nbsp;&nbsp;((<span class="gallina-kwd">fun</span><span class="id"> _</span><span class="id"> _</span><span class="id"> =&gt;</span><span class="id"> erefl</span>)<span class="id"> :</span><span class="id"> {in</span><span class="id"> setT,</span><span class="id"> cancel</span><span class="id"> to_setT</span><span class="id"> val}</span>).<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> T</span><span class="id"> :=</span><span class="id"> isFun</span>.<span class="id">Build</span><span class="id"> T</span><span class="id"> _</span><span class="id"> setT</span><span class="id"> setT</span><span class="id"> to_setT</span> (<span class="gallina-kwd">fun</span><span class="id"> _</span><span class="id"> _</span><span class="id"> =&gt;</span><span class="id"> I</span>).<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> T</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">SplitInjFun_CanV</span>.<span class="id">Build</span><span class="id"> T</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> to_setT</span> (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> y</span><span class="id"> =&gt;</span><span class="id"> I</span>)<span class="id"> inj</span>.<br/>
<span class="vernacular">Definition</span><span class="id"> setTbij</span><span class="id"> {T}</span><span class="id"> :=</span><span class="id"> [splitbij</span><span class="id"> of</span><span class="id"> @to_setT</span><span class="id"> T]</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> inv_to_setT</span><span class="id"> T</span><span class="id"> :</span> (<span class="id">@to_setT</span><span class="id"> T</span>)<span class="id">^-1</span><span class="id"> =</span><span class="id"> val</span><br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> []</span>. Qed.</div></details>
<br/>
<div class="doc">Subfun </div>
<br/>
<span class="vernacular">Section</span><span class="id"> subfun</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {T}</span><span class="id"> {A</span><span class="id"> B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T}</span>.<br/>
<br/>
<span class="vernacular">Definition</span><span class="id"> subfun</span> (<span class="id">AB</span><span class="id"> :</span><span class="id"> A</span><span class="id"> `&lt;=`</span><span class="id"> B</span>) (<span class="id">a</span><span class="id"> :</span><span class="id"> A</span>)<span class="id"> :</span><span class="id"> B</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">SigSub</span> (<span class="id">mem_set</span> (<span class="id">AB</span><span class="id"> _</span> (<span class="id">set_valP</span><span class="id"> a</span>))).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> subfun_inj</span><span class="id"> {AB</span><span class="id"> :</span><span class="id"> A</span><span class="id"> `&lt;=`</span><span class="id"> B}</span><span class="id"> :</span><span class="id"> injective</span> (<span class="id">subfun</span><span class="id"> AB</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> y</span><span class="id"> /</span>(<span class="id">congr1</span><span class="id"> val</span>)<span class="id">/=</span><span class="id"> /val_inj</span>. Qed.</div></details>
<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">AB</span><span class="id"> :</span><span class="id"> A</span><span class="id"> `&lt;=`</span><span class="id"> B</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">SurjFun</span>.<span class="id">copy</span> (<span class="id">subfun</span><span class="id"> AB</span>)<span class="id"> [fun</span><span class="id"> subfun</span><span class="id"> AB</span><span class="gallina-kwd"> in</span><span class="id"> setT]</span>.<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span>  (<span class="id">AB</span><span class="id"> :</span><span class="id"> A</span><span class="id"> `&lt;=`</span><span class="id"> B</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">SurjFun_Inj</span>.<span class="id">Build</span><span class="id"> A</span><span class="id"> B</span><span class="id"> setT</span> (<span class="id">subfun</span><span class="id"> AB</span><span class="id"> @`</span><span class="id"> setT</span>) (<span class="id">subfun</span><span class="id"> AB</span>) (<span class="id">in2W</span><span class="id"> subfun_inj</span>).<br/>
<br/>
<span class="vernacular">End</span><span class="id"> subfun</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> subfun_eq</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {T}</span><span class="id"> {A</span><span class="id"> B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T}</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> subfun_imageT</span> (<span class="id">AB</span><span class="id"> :</span><span class="id"> A</span><span class="id"> `&lt;=`</span><span class="id"> B</span>) (<span class="id">BA</span><span class="id"> :</span><span class="id"> B</span><span class="id"> `&lt;=`</span><span class="id"> A</span>)<span class="id"> :</span><span class="id"> subfun</span><span class="id"> AB</span><span class="id"> @`</span><span class="id"> setT</span><span class="id"> =</span><span class="id"> setT</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd">by</span><span class="id"> apply/seteqP;</span><span class="id"> split=&gt;</span><span class="id"> x</span><span class="id"> //=</span><span class="id"> _;</span><span class="gallina-kwd"> exists</span> (<span class="id">subfun</span><span class="id"> BA</span><span class="id"> x</span>)<span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact/val_inj</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> subfun_inv_subproof</span> (<span class="id">AB</span><span class="id"> :</span><span class="id"> A</span><span class="id"> =</span><span class="id"> B</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">olift</span> (<span class="id">subfun</span> (<span class="id">subsetCW</span><span class="id"> AB</span>))<span class="id"> =</span><span class="id"> 'oinv_</span>(<span class="id">subfun</span> (<span class="id">subsetW</span><span class="id"> AB</span>)).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">set</span><span class="id"> g</span><span class="id"> :=</span><span class="id"> subfun</span><span class="id"> _;</span><span class="id"> set</span><span class="id"> f</span><span class="id"> :=</span><span class="id"> subfun</span><span class="id"> _;</span><span class="id"> apply/funext</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> /=</span>.<br/>
<span class="id">apply:</span><span class="id"> 'inj_</span>(<span class="id">oapp</span><span class="id"> f</span><span class="id"> x</span>)<span class="id"> =&gt;</span><span class="id"> //=</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> inE/=;</span><span class="id"> eexists</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> inE/=;</span><span class="id"> apply:</span><span class="id"> 'oinvS_f;</span><span class="gallina-kwd"> exists</span> (<span class="id">g</span><span class="id"> x</span>)<span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> apply/val_inj</span>.<br/>
<span class="id">rewrite</span><span class="id"> oinvK</span><span class="id"> ?inE//=;</span><span class="id"> first</span><span class="id"> exact/val_inj</span>.<br/>
<span class="gallina-kwd">by</span><span class="gallina-kwd"> exists</span> (<span class="id">g</span><span class="id"> x</span>)<span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> apply/val_inj</span>.<br/>
Qed.</div></details>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">AB</span><span class="id"> :</span><span class="id"> A</span><span class="id"> =</span><span class="id"> B</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">OInv_Inv</span>.<span class="id">Build</span><span class="id"> A</span><span class="id"> B</span> (<span class="id">subfun</span> (<span class="id">subsetW</span><span class="id"> AB</span>)) (<span class="id">subfun_inv_subproof</span><span class="id"> AB</span>).<br/>
<br/>
<span class="vernacular">End</span><span class="id"> subfun_eq</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> seteqfun</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {T</span><span class="id"> :</span><span class="id"> Type}</span>.<br/>
<br/>
<span class="vernacular">Definition</span><span class="id"> seteqfun</span><span class="id"> {A</span><span class="id"> B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T}</span> (<span class="id">AB</span><span class="id"> :</span><span class="id"> A</span><span class="id"> =</span><span class="id"> B</span>)<span class="id"> :=</span><span class="id"> subfun</span> (<span class="id">subsetW</span><span class="id"> AB</span>).<br/>
<br/>
<span class="vernacular">Context</span><span class="id"> {A</span><span class="id"> B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T}</span> (<span class="id">AB</span><span class="id"> :</span><span class="id"> A</span><span class="id"> =</span><span class="id"> B</span>).<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> Inv</span>.<span class="id">Build</span><span class="id"> A</span><span class="id"> B</span> (<span class="id">seteqfun</span><span class="id"> AB</span>) (<span class="id">seteqfun</span> (<span class="id">esym</span><span class="id"> AB</span>)).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> seteqfun_can2_subproof</span><span class="id"> :</span><span class="id"> Inv_Can2</span><span class="id"> A</span><span class="id"> B</span><span class="id"> setT</span><span class="id"> setT</span> (<span class="id">seteqfun</span><span class="id"> AB</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> split;</span><span class="id"> rewrite</span><span class="id"> /seteqfun//;</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> _;</span><span class="id"> apply/val_inj</span>. Qed.</div></details>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> seteqfun_can2_subproof</span>.<br/>
<br/>
<span class="vernacular">End</span><span class="id"> seteqfun</span>.<br/>
<br/>
<div class="doc">Inclusion </div>
<br/>
<span class="vernacular">Section</span><span class="id"> incl</span>.<br/>
<span class="vernacular">Context</span> <span class="id"> {T}</span><span class="id"> {A</span><span class="id"> B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T}</span>.<br/>
<span class="vernacular">Definition</span><span class="id"> incl</span> (<span class="id">AB</span><span class="id"> :</span><span class="id"> A</span><span class="id"> `&lt;=`</span><span class="id"> B</span>)<span class="id"> :=</span><span class="id"> @id</span><span class="id"> T</span>.<br/>
<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">AB</span><span class="id"> :</span><span class="id"> A</span><span class="id"> `&lt;=`</span><span class="id"> B</span>)<span class="id"> :=</span><span class="id"> Inv</span>.<span class="id">Build</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">incl</span><span class="id"> AB</span>)<span class="id"> id</span>.<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">AB</span><span class="id"> :</span><span class="id"> A</span><span class="id"> `&lt;=`</span><span class="id"> B</span>)<span class="id"> :=</span><span class="id"> isFun</span>.<span class="id">Build</span><span class="id"> _</span><span class="id"> _</span><span class="id"> A</span><span class="id"> B</span> (<span class="id">incl</span><span class="id"> AB</span>)<span class="id"> AB</span>.<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">AB</span><span class="id"> :</span><span class="id"> A</span><span class="id"> `&lt;=`</span><span class="id"> B</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">Inv_Can</span>.<span class="id">Build</span><span class="id"> _</span><span class="id"> _</span><span class="id"> A</span> (<span class="id">incl</span><span class="id"> AB</span>) (<span class="gallina-kwd">fun</span><span class="id"> _</span><span class="id"> _</span><span class="id"> =&gt;</span><span class="id"> erefl</span>).<br/>
<br/>
<span class="vernacular">Definition</span><span class="id"> eqincl</span> (<span class="id">AB</span><span class="id"> :</span><span class="id"> A</span><span class="id"> =</span><span class="id"> B</span>)<span class="id"> :=</span><span class="id"> incl</span> (<span class="id">subsetW</span><span class="id"> AB</span>).<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> AB</span><span class="id"> :=</span><span class="id"> Inversible</span>.<span class="id">on</span> (<span class="id">eqincl</span><span class="id"> AB</span>).<br/>
<span class="vernacular">Lemma</span><span class="id"> eqincl_surj</span><span class="id"> AB</span><span class="id"> :</span><span class="id"> Inv_Can2</span><span class="id"> _</span><span class="id"> _</span><span class="id"> A</span><span class="id"> B</span> (<span class="id">eqincl</span><span class="id"> AB</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> split=&gt;</span><span class="id"> //</span><span class="id"> x;</span><span class="id"> rewrite</span><span class="id"> /eqincl</span><span class="id"> /incl/=</span><span class="id"> /</span>(<span class="id">_^-1</span>)<span class="id">/inv/=</span><span class="id"> AB</span>. Qed.</div></details>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> AB</span><span class="id"> :=</span><span class="id"> eqincl_surj</span><span class="id"> AB</span>.<br/>
<br/>
<span class="vernacular">End</span><span class="id"> incl</span>.<br/>
<span class="vernacular">Notation</span><span class="id"> inclT</span><span class="id"> A</span><span class="id"> :=</span> (<span class="id">incl</span> (<span class="id">@subsetT</span><span class="id"> _</span><span class="id"> _</span>)).<br/>
<br/>
<div class="doc">Ad hoc function </div>
<br/>
<span class="vernacular">Section</span><span class="id"> mkfun</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {aT}</span><span class="id"> {rT}</span><span class="id"> {A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT}</span><span class="id"> {B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> rT}</span>.<br/>
<span class="vernacular">Notation</span><span class="id"> isfun</span><span class="id"> f</span><span class="id"> :=</span><span class="id"> {homo</span><span class="id"> f</span><span class="id"> :</span><span class="id"> x</span><span class="id"> /</span><span class="id"> A</span><span class="id"> x</span><span class="id"> &gt;-&gt;</span><span class="id"> B</span><span class="id"> x}</span>.<br/>
<span class="vernacular">Definition</span><span class="id"> mkfun</span><span class="id"> f</span> (<span class="id">fAB</span><span class="id"> :</span><span class="id"> isfun</span><span class="id"> f</span>)<span class="id"> :=</span><span class="id"> f</span>.<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> f</span><span class="id"> fAB</span><span class="id"> :=</span><span class="id"> @isFun</span>.<span class="id">Build</span><span class="id"> _</span><span class="id"> _</span><span class="id"> A</span><span class="id"> B</span> (<span class="id">@mkfun</span><span class="id"> f</span><span class="id"> fAB</span>)<span class="id"> fAB</span>.<br/>
<span class="vernacular">Definition</span><span class="id"> mkfun_fun</span><span class="id"> f</span><span class="id"> fAB</span><span class="id"> :=</span><span class="id"> [fun</span><span class="id"> of</span><span class="id"> @mkfun</span><span class="id"> f</span><span class="id"> fAB]</span>.<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {inj</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> rT}</span>)<span class="id"> fAB</span><span class="id"> :=</span><span class="id"> Inject</span>.<span class="id">on</span> (<span class="id">@mkfun</span><span class="id"> f</span><span class="id"> fAB</span>).<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {splitinj</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> rT}</span>)<span class="id"> fAB</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">SplitInj</span>.<span class="id">on</span> (<span class="id">@mkfun</span><span class="id"> f</span><span class="id"> fAB</span>).<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {surj</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<span class="id"> fAB</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">Surject</span>.<span class="id">on</span> (<span class="id">@mkfun</span><span class="id"> f</span><span class="id"> fAB</span>).<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {splitsurj</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<span class="id"> fAB</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">SplitSurj</span>.<span class="id">on</span> (<span class="id">@mkfun</span><span class="id"> f</span><span class="id"> fAB</span>).<br/>
<span class="vernacular">End</span><span class="id"> mkfun</span>.<br/>
<br/>
<div class="doc">set_val </div>
<br/>
<span class="vernacular">Section</span><span class="id"> set_val</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {T}</span><span class="id"> {A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T}</span>.<br/>
<span class="vernacular">Definition</span><span class="id"> set_val</span><span class="id"> :</span><span class="id"> A</span><span class="id"> -&gt;</span><span class="id"> T</span><span class="id"> :=</span><span class="id"> eqincl</span> (<span class="id">set_mem_set</span><span class="id"> A</span>)<span class="id"> \o</span><span class="id"> val</span>.<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> Bij</span>.<span class="id">on</span><span class="id"> set_val</span>.<br/>
<span class="vernacular">Lemma</span><span class="id"> oinv_set_val</span><span class="id"> :</span><span class="id"> 'oinv_set_val</span><span class="id"> =</span><span class="id"> insub</span><br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> []</span>. Qed.</div></details>
<span class="vernacular">Lemma</span><span class="id"> set_valE</span><span class="id"> :</span><span class="id"> set_val</span><span class="id"> =</span><span class="id"> val</span><br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> []</span>. Qed.</div></details>
<span class="vernacular">End</span><span class="id"> set_val</span>.<br/>
<br/>
<span class="id">#[global]</span><br/>
<span class="vernacular">Hint</span><span class="id"> Extern</span><span class="id"> 0</span> (<span class="id">is_true</span> (<span class="id">set_val</span><span class="id"> _</span><span class="id"> \in</span><span class="id"> _</span>))<span class="id"> =&gt;</span><span class="id"> solve</span><span class="id"> [apply:</span><span class="id"> valP]</span><span class="id"> :</span><span class="id"> core</span>.<br/>
<br/>
<div class="doc">Squash </div>
<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> T</span><span class="id"> :=</span><span class="id"> CanV</span>.<span class="id">Build</span><span class="id"> T</span><span class="id"> $|T|</span><span class="id"> setT</span><span class="id"> setT</span><span class="id"> squash</span> (<span class="gallina-kwd">fun</span><span class="id"> _</span><span class="id"> _</span><span class="id"> =&gt;</span><span class="id"> I</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">in1W</span><span class="id"> unsquashK</span>).<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> T</span><span class="id"> :=</span><span class="id"> SplitInj</span>.<span class="id">copy</span> (<span class="id">@unsquash</span><span class="id"> T</span>)<span class="id"> squash^-1%FUN</span>.<br/>
<span class="vernacular">Definition</span><span class="id"> ssquash</span><span class="id"> {T}</span><span class="id"> :=</span><span class="id"> [splitsurj</span><span class="id"> of</span><span class="id"> @squash</span><span class="id"> T]</span>.<br/>
<br/>
<div class="doc">pickle and unpickle </div>
<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> countType</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">Inj</span>.<span class="id">Build</span><span class="id"> _</span><span class="id"> _</span><span class="id"> setT</span> (<span class="id">@choice</span>.<span class="id">pickle</span><span class="id"> T</span>) (<span class="id">in2W</span> (<span class="id">pcan_inj</span><span class="id"> choice</span>.<span class="id">pickleK</span>)).<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> countType</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">isFun</span>.<span class="id">Build</span><span class="id"> _</span><span class="id"> _</span><span class="id"> setT</span><span class="id"> setT</span> (<span class="id">@choice</span>.<span class="id">pickle</span><span class="id"> T</span>) (<span class="gallina-kwd">fun</span><span class="id"> _</span><span class="id"> _</span><span class="id"> =&gt;</span><span class="id"> I</span>).<br/>
<br/>
<div class="doc">set0fun </div>
<br/>
<span class="vernacular">Lemma</span><span class="id"> set0fun_inj</span><span class="id"> {P</span><span class="id"> T}</span><span class="id"> :</span><span class="id"> injective</span> (<span class="id">@set0fun</span><span class="id"> P</span><span class="id"> T</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> case=&gt;</span><span class="id"> x</span><span class="id"> x0;</span><span class="id"> have</span><span class="id"> :=</span><span class="id"> set_mem</span><span class="id"> x0</span>. Qed.</div></details>
<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> P</span><span class="id"> T</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">Inj</span>.<span class="id">Build</span> (<span class="id">@set0</span><span class="id"> T</span>)<span class="id"> P</span><span class="id"> setT</span><span class="id"> set0fun</span> (<span class="id">in2W</span><span class="id"> set0fun_inj</span>).<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> P</span><span class="id"> T</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">isFun</span>.<span class="id">Build</span><span class="id"> _</span><span class="id"> _</span><span class="id"> setT</span><span class="id"> setT</span> (<span class="id">@set0fun</span><span class="id"> P</span><span class="id"> T</span>) (<span class="gallina-kwd">fun</span><span class="id"> _</span><span class="id"> _</span><span class="id"> =&gt;</span><span class="id"> I</span>).<br/>
<br/>
<div class="doc">cast_ord </div>
<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> {m</span><span class="id"> n}</span><span class="id"> {eq_mn</span><span class="id"> :</span><span class="id"> m</span><span class="id"> =</span><span class="id"> n}</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">Can2</span>.<span class="id">Build</span><span class="id"> 'I_m</span><span class="id"> 'I_n</span><span class="id"> setT</span><span class="id"> setT</span> (<span class="id">cast_ord</span><span class="id"> eq_mn</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="gallina-kwd">fun</span><span class="id"> _</span><span class="id"> _</span><span class="id"> =&gt;</span><span class="id"> I</span>) (<span class="gallina-kwd">fun</span><span class="id"> _</span><span class="id"> _</span><span class="id"> =&gt;</span><span class="id"> I</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">in1W</span> (<span class="id">cast_ordK</span><span class="id"> _</span>)) (<span class="id">in1W</span> (<span class="id">cast_ordKV</span><span class="id"> _</span>)).<br/>
<br/>
<div class="doc">enum_val &amp; enum_rank </div>
<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> finType</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">Can2</span>.<span class="id">Build</span><span class="id"> T</span><span class="id"> _</span><span class="id"> setT</span><span class="id"> setT</span><span class="id"> enum_rank</span> (<span class="gallina-kwd">fun</span><span class="id"> _</span><span class="id"> _</span><span class="id"> =&gt;</span><span class="id"> I</span>) (<span class="gallina-kwd">fun</span><span class="id"> _</span><span class="id"> _</span><span class="id"> =&gt;</span><span class="id"> I</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">in1W</span><span class="id"> enum_rankK</span>) (<span class="id">in1W</span><span class="id"> enum_valK</span>).<br/>
<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> finType</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">Can2</span>.<span class="id">Build</span><span class="id"> _</span><span class="id"> T</span><span class="id"> setT</span><span class="id"> setT</span><span class="id"> enum_val</span> (<span class="gallina-kwd">fun</span><span class="id"> _</span><span class="id"> _</span><span class="id"> =&gt;</span><span class="id"> I</span>) (<span class="gallina-kwd">fun</span><span class="id"> _</span><span class="id"> _</span><span class="id"> =&gt;</span><span class="id"> I</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">in1W</span><span class="id"> enum_valK</span>) (<span class="id">in1W</span><span class="id"> enum_rankK</span>).<br/>
<br/>
<div class="doc">Finset val </div>
<br/>
<span class="vernacular">Definition</span><span class="id"> finset_val</span><span class="id"> {T</span><span class="id"> :</span><span class="id"> choiceType}</span><span class="id"> {X</span><span class="id"> :</span><span class="id"> {fset</span><span class="id"> T}}</span> (<span class="id">x</span><span class="id"> :</span><span class="id"> X</span>)<span class="id"> :</span><span class="id"> [set`</span><span class="id"> X]</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">exist</span> (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> \in</span><span class="id"> [set`</span><span class="id"> X]</span>) (<span class="id">val</span><span class="id"> x</span>) (<span class="id">mem_set</span> (<span class="id">valP</span><span class="id"> x</span>)).<br/>
<span class="vernacular">Definition</span><span class="id"> val_finset</span><span class="id"> {T</span><span class="id"> :</span><span class="id"> choiceType}</span><span class="id"> {X</span><span class="id"> :</span><span class="id"> {fset</span><span class="id"> T}}</span> (<span class="id">x</span><span class="id"> :</span><span class="id"> [set`</span><span class="id"> X]</span>)<span class="id"> :</span><span class="id"> X</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">[`</span><span class="id"> set_mem</span> (<span class="id">valP</span><span class="id"> x</span>)<span class="id">]%fset</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> finset_valK</span><span class="id"> {T</span><span class="id"> :</span><span class="id"> choiceType}</span><span class="id"> {X</span><span class="id"> :</span><span class="id"> {fset</span><span class="id"> T}}</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">cancel</span> (<span class="id">@finset_val</span><span class="id"> T</span><span class="id"> X</span>)<span class="id"> val_finset</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> x;</span><span class="id"> apply/val_inj</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> val_finsetK</span><span class="id"> {T</span><span class="id"> :</span><span class="id"> choiceType}</span><span class="id"> {X</span><span class="id"> :</span><span class="id"> {fset</span><span class="id"> T}}</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">cancel</span> (<span class="id">@val_finset</span><span class="id"> T</span><span class="id"> X</span>)<span class="id"> finset_val</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> x;</span><span class="id"> apply/val_inj</span>. Qed.</div></details>
<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> <span class="id"> {T</span><span class="id"> :</span><span class="id"> choiceType}</span><span class="id"> {X</span><span class="id"> :</span><span class="id"> {fset</span><span class="id"> T}}</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">Can2</span>.<span class="id">Build</span><span class="id"> X</span><span class="id"> _</span><span class="id"> setT</span><span class="id"> setT</span><span class="id"> finset_val</span> (<span class="gallina-kwd">fun</span><span class="id"> _</span><span class="id"> _</span><span class="id"> =&gt;</span><span class="id"> I</span>) (<span class="gallina-kwd">fun</span><span class="id"> _</span><span class="id"> _</span><span class="id"> =&gt;</span><span class="id"> I</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">in1W</span><span class="id"> finset_valK</span>) (<span class="id">in1W</span><span class="id"> val_finsetK</span>).<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> <span class="id"> {T</span><span class="id"> :</span><span class="id"> choiceType}</span><span class="id"> {X</span><span class="id"> :</span><span class="id"> {fset</span><span class="id"> T}}</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">Can2</span>.<span class="id">Build</span><span class="id"> _</span><span class="id"> X</span><span class="id"> setT</span><span class="id"> setT</span><span class="id"> val_finset</span> (<span class="gallina-kwd">fun</span><span class="id"> _</span><span class="id"> _</span><span class="id"> =&gt;</span><span class="id"> I</span>) (<span class="gallina-kwd">fun</span><span class="id"> _</span><span class="id"> _</span><span class="id"> =&gt;</span><span class="id"> I</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">in1W</span><span class="id"> val_finsetK</span>) (<span class="id">in1W</span><span class="id"> finset_valK</span>).<br/>
<br/>
<div class="doc">'I_n and `I_n </div>
<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> n</span><span class="id"> :=</span><span class="id"> Can2</span>.<span class="id">Build</span><span class="id"> _</span><span class="id"> _</span><span class="id"> setT</span><span class="id"> setT</span> (<span class="id">@ordII</span><span class="id"> n</span>)<br/>
&nbsp;&nbsp;&nbsp;(<span class="gallina-kwd">fun</span><span class="id"> _</span><span class="id"> _</span><span class="id"> =&gt;</span><span class="id"> I</span>) (<span class="gallina-kwd">fun</span><span class="id"> _</span><span class="id"> _</span><span class="id"> =&gt;</span><span class="id"> I</span>) (<span class="id">in1W</span><span class="id"> ordIIK</span>) (<span class="id">in1W</span><span class="id"> IIordK</span>).<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> n</span><span class="id"> :=</span><span class="id"> SplitBij</span>.<span class="id">copy</span> (<span class="id">@IIord</span><span class="id"> n</span>) (<span class="id">ordII^-1</span>).<br/>
<br/>
<div class="ssrdoc md">
## Glueing
</div>
<br/>
<span class="vernacular">Definition</span><span class="id"> glue</span><span class="id"> {T</span><span class="id"> T'}</span><span class="id"> {X</span><span class="id"> Y</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T}</span><span class="id"> {A</span><span class="id"> B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T'}</span><br/>
&nbsp;&nbsp;<span class="id">of</span><span class="id"> [disjoint</span><span class="id"> X</span><span class="id"> &amp;</span><span class="id"> Y]</span><span class="id"> &amp;</span><span class="id"> [disjoint</span><span class="id"> A</span><span class="id"> &amp;</span><span class="id"> B]</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">fun</span> (<span class="id">f</span><span class="id"> g</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> T'</span>) (<span class="id">u</span><span class="id"> :</span><span class="id"> T</span>)<span class="id"> =&gt;</span><span class="gallina-kwd"> if</span><span class="id"> u</span><span class="id"> \in</span><span class="id"> X</span><span class="gallina-kwd"> then</span><span class="id"> f</span><span class="id"> u</span><span class="gallina-kwd"> else</span><span class="id"> g</span><span class="id"> u</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> Glue12</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {T</span><span class="id"> T'}</span><span class="id"> {X</span><span class="id"> Y</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T}</span><span class="id"> {A</span><span class="id"> B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T'}</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {XY</span><span class="id"> :</span><span class="id"> [disjoint</span><span class="id"> X</span><span class="id"> &amp;</span><span class="id"> Y]}</span><span class="id"> {AB</span><span class="id"> :</span><span class="id"> [disjoint</span><span class="id"> A</span><span class="id"> &amp;</span><span class="id"> B]}</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Notation</span><span class="id"> gl</span><span class="id"> :=</span> (<span class="id">glue</span><span class="id"> XY</span><span class="id"> AB</span>).<br/>
<br/>
<span class="vernacular">Definition</span><span class="id"> glue1</span> (<span class="id">f</span><span class="id"> g</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> T'</span>)<span class="id"> :</span><span class="id"> {in</span><span class="id"> X,</span><span class="id"> gl</span><span class="id"> f</span><span class="id"> g</span><span class="id"> =1</span><span class="id"> f}</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> x;</span><span class="id"> rewrite</span><span class="id"> /glue</span><span class="id"> =&gt;</span><span class="id"> -&gt;</span>. Qed.</div></details>
<br/>
<span class="vernacular">Definition</span><span class="id"> glue2</span> (<span class="id">f</span><span class="id"> g</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> T'</span>)<span class="id"> :</span><span class="id"> {in</span><span class="id"> Y,</span><span class="id"> gl</span><span class="id"> f</span><span class="id"> g</span><span class="id"> =1</span><span class="id"> g}</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> x</span><span class="id"> /set_mem</span><span class="id"> Yx;</span><span class="id"> rewrite</span><span class="id"> /glue;</span><span class="id"> case:</span><span class="id"> ifPn</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> /set_mem</span><span class="id"> Xx</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> move:</span><span class="id"> XY</span><span class="id"> =&gt;</span><span class="id"> /disj_setPS/</span>(_<span class="id"> x</span> (<span class="id">conj</span><span class="id"> Xx</span><span class="id"> Yx</span>)).<br/>
Qed.</div></details>
<span class="vernacular">End</span><span class="id"> Glue12</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> Glue</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {T</span><span class="id"> T'}</span><span class="id"> {X</span><span class="id"> Y</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T}</span><span class="id"> {A</span><span class="id"> B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T'}</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {XY</span><span class="id"> :</span><span class="id"> [disjoint</span><span class="id"> X</span><span class="id"> &amp;</span><span class="id"> Y]}</span><span class="id"> {AB</span><span class="id"> :</span><span class="id"> [disjoint</span><span class="id"> A</span><span class="id"> &amp;</span><span class="id"> B]}</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Notation</span><span class="id"> gl</span><span class="id"> :=</span> (<span class="id">glue</span><span class="id"> XY</span><span class="id"> AB</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> glue_fun_subproof</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {fun</span><span class="id"> X</span><span class="id"> &gt;-&gt;</span><span class="id"> A}</span>) (<span class="id">g</span><span class="id"> :</span><span class="id"> {fun</span><span class="id"> Y</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">isFun</span><span class="id"> T</span><span class="id"> T'</span> (<span class="id">X</span><span class="id"> `|`</span><span class="id"> Y</span>) (<span class="id">A</span><span class="id"> `|`</span><span class="id"> B</span>) (<span class="id">gl</span><span class="id"> f</span><span class="id"> g</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd">by</span><span class="id"> split=&gt;</span><span class="id"> x</span><span class="id"> []xP;</span><span class="id"> [left;</span><span class="id"> rewrite</span><span class="id"> glue1|right;</span><span class="id"> rewrite</span><span class="id"> glue2];</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> ?inE//;</span><span class="id"> apply:</span><span class="id"> funS</span>.<br/>
Qed.</div></details>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> f</span><span class="id"> g</span><span class="id"> :=</span><span class="id"> glue_fun_subproof</span><span class="id"> f</span><span class="id"> g</span>.<br/>
<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> g</span><span class="id"> :</span><span class="id"> {oinv</span><span class="id"> T</span><span class="id"> &gt;-&gt;</span><span class="id"> T'}</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">OInv</span>.<span class="id">Build</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">gl</span><span class="id"> f</span><span class="id"> g</span>) (<span class="id">glue</span><span class="id"> AB</span> (<span class="id">eqbRL</span><span class="id"> disj_set_some</span><span class="id"> XY</span>)<span class="id"> 'oinv_f</span><span class="id"> 'oinv_g</span>).<br/>
<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span>  (<span class="id">f</span><span class="id"> :</span><span class="id"> {oinvfun</span><span class="id"> X</span><span class="id"> &gt;-&gt;</span><span class="id"> A}</span>) (<span class="id">g</span><span class="id"> :</span><span class="id"> {oinvfun</span><span class="id"> Y</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">OInversible</span>.<span class="id">on</span> (<span class="id">gl</span><span class="id"> f</span><span class="id"> g</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> oinv_glue</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {oinv</span><span class="id"> T</span><span class="id"> &gt;-&gt;</span><span class="id"> T'}</span>) (<span class="id">g</span><span class="id"> :</span><span class="id"> {oinv</span><span class="id"> T</span><span class="id"> &gt;-&gt;</span><span class="id"> T'}</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">'oinv_</span>(<span class="id">gl</span><span class="id"> f</span><span class="id"> g</span>)<span class="id"> =</span><span class="id"> glue</span><span class="id"> AB</span> (<span class="id">eqbRL</span><span class="id"> disj_set_some</span><span class="id"> XY</span>)<span class="id"> 'oinv_f</span><span class="id"> 'oinv_g</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> []</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> some_inv_glue_subproof</span> (<span class="id">f</span><span class="id"> g</span><span class="id"> :</span><span class="id"> {inv</span><span class="id"> T</span><span class="id"> &gt;-&gt;</span><span class="id"> T'}</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">some</span><span class="id"> \o</span> (<span class="id">glue</span><span class="id"> AB</span><span class="id"> XY</span><span class="id"> f^-1</span><span class="id"> g^-1</span>)<span class="id"> =</span><span class="id"> 'oinv_</span>(<span class="id">gl</span><span class="id"> f</span><span class="id"> g</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd">by</span><span class="id"> apply/funext</span><span class="id"> =&gt;</span><span class="id"> y;</span><span class="id"> rewrite</span><span class="id"> oinv_glue</span><span class="id"> /glue</span><span class="id"> /=</span><span class="id"> [LHS]fun_if</span><span class="id"> !some_inv</span>.<br/>
Qed.</div></details>
<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> g</span><span class="id"> :</span><span class="id"> {inv</span><span class="id"> T</span><span class="id"> &gt;-&gt;</span><span class="id"> T'}</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">OInv_Inv</span>.<span class="id">Build</span><span class="id"> T</span><span class="id"> T'</span> (<span class="id">gl</span><span class="id"> f</span><span class="id"> g</span>) (<span class="id">some_inv_glue_subproof</span><span class="id"> f</span><span class="id"> g</span>).<br/>
<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {invfun</span><span class="id"> X</span><span class="id"> &gt;-&gt;</span><span class="id"> A}</span>) (<span class="id">g</span><span class="id"> :</span><span class="id"> {invfun</span><span class="id"> Y</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">Inversible</span>.<span class="id">on</span> (<span class="id">gl</span><span class="id"> f</span><span class="id"> g</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> inv_glue</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {invfun</span><span class="id"> X</span><span class="id"> &gt;-&gt;</span><span class="id"> A}</span>) (<span class="id">g</span><span class="id"> :</span><span class="id"> {invfun</span><span class="id"> Y</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;(<span class="id">gl</span><span class="id"> f</span><span class="id"> g</span>)<span class="id">^-1</span><span class="id"> =</span><span class="id"> glue</span><span class="id"> AB</span><span class="id"> XY</span><span class="id"> f^-1</span><span class="id"> g^-1</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> []</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> glueo_can_subproof</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {injfun</span><span class="id"> X</span><span class="id"> &gt;-&gt;</span><span class="id"> A}</span>) (<span class="id">g</span><span class="id"> :</span><span class="id"> {injfun</span><span class="id"> Y</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">OInv_Can</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">X</span><span class="id"> `|`</span><span class="id"> Y</span>) (<span class="id">gl</span><span class="id"> f</span><span class="id"> g</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">split=&gt;</span><span class="id"> x;</span><span class="id"> rewrite</span><span class="id"> inE</span><span class="id"> =&gt;</span><span class="id"> -[]</span><span class="id"> xP;</span><span class="id"> rewrite</span><span class="id"> oinv_glue</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> [glue</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> x]glue1</span><span class="id"> ?inE//</span><span class="id"> glue1</span><span class="id"> ?funoK</span><span class="id"> ?inE//;</span><span class="id"> apply:</span><span class="id"> funS</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> [glue</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> x]glue2</span><span class="id"> ?inE//</span><span class="id"> glue2</span><span class="id"> ?funoK</span><span class="id"> ?inE//;</span><span class="id"> apply:</span><span class="id"> funS</span>.<br/>
Qed.</div></details>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> f</span><span class="id"> g</span><span class="id"> :=</span><span class="id"> glueo_can_subproof</span><span class="id"> f</span><span class="id"> g</span>.<br/>
<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {splitinjfun</span><span class="id"> X</span><span class="id"> &gt;-&gt;</span><span class="id"> A}</span>)<br/>
&nbsp;&nbsp;(<span class="id">g</span><span class="id"> :</span><span class="id"> {splitinjfun</span><span class="id"> Y</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<span class="id"> :=</span><span class="id"> Inject</span>.<span class="id">on</span> (<span class="id">gl</span><span class="id"> f</span><span class="id"> g</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> glue_canv_subproof</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {surj</span><span class="id"> X</span><span class="id"> &gt;-&gt;</span><span class="id"> A}</span>) (<span class="id">g</span><span class="id"> :</span><span class="id"> {surj</span><span class="id"> Y</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">OInv_CanV</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">X</span><span class="id"> `|`</span><span class="id"> Y</span>) (<span class="id">A</span><span class="id"> `|`</span><span class="id"> B</span>) (<span class="id">gl</span><span class="id"> f</span><span class="id"> g</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">split=&gt;</span><span class="id"> [z|y</span><span class="id"> /set_mem</span><span class="id"> []</span><span class="id"> yP];</span><span class="id"> rewrite</span><span class="id"> oinv_glue</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> []</span><span class="id"> zP</span><span class="id"> /=;</span><span class="id"> [rewrite</span><span class="id"> glue1|rewrite</span><span class="id"> glue2];</span><span class="id"> rewrite</span><span class="id"> ?inE//;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">case:</span><span class="id"> oinvP=&gt;</span><span class="id"> //</span><span class="id"> x</span><span class="id"> xX</span><span class="id"> _;</span><span class="gallina-kwd"> exists</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> [left|right]</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> glue1</span><span class="id"> ?inE//;</span><span class="id"> case:</span><span class="id"> oinvP=&gt;</span><span class="id"> //=</span><span class="id"> x</span><span class="id"> xX</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> glue1</span><span class="id"> ?inE</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> glue2</span><span class="id"> ?inE//;</span><span class="id"> case:</span><span class="id"> oinvP=&gt;</span><span class="id"> //=</span><span class="id"> x</span><span class="id"> xX</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> glue2</span><span class="id"> ?inE</span>.<br/>
Qed.</div></details>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> f</span><span class="id"> g</span><span class="id"> :=</span><span class="id"> glue_canv_subproof</span><span class="id"> f</span><span class="id"> g</span>.<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {surjfun</span><span class="id"> X</span><span class="id"> &gt;-&gt;</span><span class="id"> A}</span>) (<span class="id">g</span><span class="id"> :</span><span class="id"> {surjfun</span><span class="id"> Y</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">Surject</span>.<span class="id">on</span> (<span class="id">gl</span><span class="id"> f</span><span class="id"> g</span>).<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {splitsurj</span><span class="id"> X</span><span class="id"> &gt;-&gt;</span><span class="id"> A}</span>) (<span class="id">g</span><span class="id"> :</span><span class="id"> {splitsurj</span><span class="id"> Y</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">Surject</span>.<span class="id">on</span> (<span class="id">gl</span><span class="id"> f</span><span class="id"> g</span>).<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {splitsurjfun</span><span class="id"> X</span><span class="id"> &gt;-&gt;</span><span class="id"> A}</span>) (<span class="id">g</span><span class="id"> :</span><span class="id"> {splitsurjfun</span><span class="id"> Y</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">Surject</span>.<span class="id">on</span> (<span class="id">gl</span><span class="id"> f</span><span class="id"> g</span>).<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {bij</span><span class="id"> X</span><span class="id"> &gt;-&gt;</span><span class="id"> A}</span>) (<span class="id">g</span><span class="id"> :</span><span class="id"> {bij</span><span class="id"> Y</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">Surject</span>.<span class="id">on</span> (<span class="id">gl</span><span class="id"> f</span><span class="id"> g</span>).<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {splitbij</span><span class="id"> X</span><span class="id"> &gt;-&gt;</span><span class="id"> A}</span>) (<span class="id">g</span><span class="id"> :</span><span class="id"> {splitbij</span><span class="id"> Y</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">Surject</span>.<span class="id">on</span> (<span class="id">gl</span><span class="id"> f</span><span class="id"> g</span>).<br/>
<br/>
<span class="vernacular">End</span><span class="id"> Glue</span>.<br/>
<br/>
<div class="doc">Z-module addition is a bijection </div>
<br/>
<span class="vernacular">Section</span><span class="id"> addition</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {V</span><span class="id"> :</span><span class="id"> zmodType}</span> (<span class="id">x</span><span class="id"> :</span><span class="id"> V</span>).<br/>
<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> Inv</span>.<span class="id">Build</span><span class="id"> V</span><span class="id"> V</span> (<span class="id">+%R</span><span class="id"> x</span>) (<span class="id">+%R</span> (<span class="id">-</span><span class="id"> x</span>)).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> inv_addr</span><span class="id"> :</span> (<span class="id">+%R</span><span class="id"> x</span>)<span class="id">^-1</span><span class="id"> =</span> (<span class="id">+%R</span> (<span class="id">-</span><span class="id"> x</span>))<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> []</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> addr_can2_subproof</span><span class="id"> :</span><span class="id"> Inv_Can2</span><span class="id"> V</span><span class="id"> V</span><span class="id"> setT</span><span class="id"> setT</span> (<span class="id">+%R</span><span class="id"> x</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> y</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> inv_addr</span><span class="id"> ?GRing</span>.<span class="id">addKr</span><span class="id"> ?GRing</span>.<span class="id">addNKr</span>. Qed.</div></details>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> addr_can2_subproof</span>.<br/>
<br/>
<span class="vernacular">End</span><span class="id"> addition</span>.<br/>
<br/>
<div class="doc">Z-module opposite is a bijection </div>
<br/>
<span class="vernacular">Section</span><span class="id"> addition</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {V</span><span class="id"> :</span><span class="id"> zmodType}</span> (<span class="id">x</span><span class="id"> :</span><span class="id"> V</span>).<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ring_scope</span>.<br/>
<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> Inv</span>.<span class="id">Build</span><span class="id"> V</span><span class="id"> V</span> (<span class="id">-%R</span>) (<span class="id">-%R</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> inv_oppr</span><span class="id"> :</span> (<span class="id">-%R</span>)<span class="id">^-1%FUN</span><span class="id"> =</span> (<span class="id">-%R</span>)<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> []</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> oppr_can2_subproof</span><span class="id"> :</span><span class="id"> Inv_Can2</span><span class="id"> V</span><span class="id"> V</span><span class="id"> setT</span><span class="id"> setT</span> (<span class="id">-%R</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> y</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> inv_oppr</span><span class="id"> ?GRing</span>.<span class="id">opprK</span>. Qed.</div></details>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> oppr_can2_subproof</span>.<br/>
<br/>
<span class="vernacular">End</span><span class="id"> addition</span>.<br/>
<br/>
<div class="doc">emtpyType </div>
<br/>
<span class="vernacular">Section</span><span class="id"> empty</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {T</span><span class="id"> :</span><span class="id"> emptyType}</span><span class="id"> {T'</span><span class="id"> :</span><span class="id"> Type}</span><span class="id"> {X</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T}</span>.<br/>
<span class="vernacular">Implicit</span><span class="gallina-kwd"> Type</span><span class="id"> Y</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T'</span>.<br/>
<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> OInv</span>.<span class="id">Build</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">@any</span><span class="id"> T</span><span class="id"> T'</span>) (<span class="id">fun=&gt;</span><span class="id"> None</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> empty_can_subproof</span><span class="id"> :</span><span class="id"> OInv_Can</span><span class="id"> T</span><span class="id"> T'</span><span class="id"> X</span><span class="id"> any</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> split=&gt;</span><span class="id"> x;</span><span class="id"> rewrite</span><span class="id"> empty_eq0</span><span class="id"> inE</span>. Qed.</div></details>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> empty_can_subproof</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> empty_fun_subproof</span><span class="id"> Y</span><span class="id"> :</span><span class="id"> isFun</span><span class="id"> T</span><span class="id"> T'</span><span class="id"> X</span><span class="id"> Y</span><span class="id"> any</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> split=&gt;</span><span class="id"> x;</span><span class="id"> rewrite</span><span class="id"> empty_eq0</span>. Qed.</div></details>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> Y</span><span class="id"> :=</span><span class="id"> empty_fun_subproof</span><span class="id"> Y</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> empty_canv_subproof</span><span class="id"> :</span><span class="id"> OInv_CanV</span><span class="id"> T</span><span class="id"> T'</span><span class="id"> X</span><span class="id"> set0</span><span class="id"> any</span><br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> split</span>. Qed.</div></details>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> empty_canv_subproof</span>.<br/>
<br/>
<span class="vernacular">End</span><span class="id"> empty</span>.<br/>
<br/>
<div class="ssrdoc md">
## Theory of surjection
</div>
<br/>
<span class="vernacular">Section</span><span class="id"> surj_lemmas</span>.<br/>
<span class="vernacular">Variables</span><span class="id"> aT</span><span class="id"> rT</span><span class="id"> :</span><span class="gallina-kwd"> Type</span>.<br/>
<span class="vernacular">Implicit</span><span class="id"> Types</span> (<span class="id">A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT</span>) (<span class="id">B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> rT</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> aT</span><span class="id"> -&gt;</span><span class="id"> rT</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> surj_id</span><span class="id"> A</span><span class="id"> :</span><span class="id"> set_surj</span><span class="id"> A</span><span class="id"> A</span> (<span class="id">@idfun</span><span class="id"> aT</span>)<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id"> exact:</span><span class="id"> surj</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> surj_set0</span><span class="id"> B</span><span class="id"> f</span><span class="id"> :</span><span class="id"> set_surj</span><span class="id"> set0</span><span class="id"> B</span><span class="id"> f</span><span class="id"> -&gt;</span><span class="id"> B</span><span class="id"> =</span><span class="id"> set0</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> Bf;</span><span class="id"> rewrite</span><span class="id"> predeqE</span><span class="id"> =&gt;</span><span class="id"> u;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> /Bf</span><span class="id"> [t</span><span class="id"> []]</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> surjE</span><span class="id"> f</span><span class="id"> A</span><span class="id"> B</span><span class="id"> :</span><span class="id"> set_surj</span><span class="id"> A</span><span class="id"> B</span><span class="id"> f</span><span class="id"> =</span> (<span class="id">B</span><span class="id"> `&lt;=`</span><span class="id"> f</span><span class="id"> @`</span><span class="id"> A</span>)<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> []</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> surj_image_eq</span><span class="id"> B</span><span class="id"> A</span><span class="id"> f</span><span class="id"> :</span><span class="id"> f</span><span class="id"> @`</span><span class="id"> A</span><span class="id"> `&lt;=`</span><span class="id"> B</span><span class="id"> -&gt;</span><span class="id"> set_surj</span><span class="id"> A</span><span class="id"> B</span><span class="id"> f</span><span class="id"> -&gt;</span><span class="id"> f</span><span class="id"> @`</span><span class="id"> A</span><span class="id"> =</span><span class="id"> B</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> fAB;</span><span class="id"> rewrite</span><span class="id"> eqEsubset</span><span class="id"> =&gt;</span><span class="id"> BfA</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> subl_surj</span><span class="id"> A</span><span class="id"> A'</span><span class="id"> B</span><span class="id"> f</span><span class="id"> :</span><span class="id"> A</span><span class="id"> `&lt;=`</span><span class="id"> A'</span><span class="id"> -&gt;</span><span class="id"> set_surj</span><span class="id"> A</span><span class="id"> B</span><span class="id"> f</span><span class="id"> -&gt;</span><span class="id"> set_surj</span><span class="id"> A'</span><span class="id"> B</span><span class="id"> f</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> /</span>(<span class="id">@image_subset</span><span class="id"> _</span><span class="id"> _</span><span class="id"> f</span>)<span class="id">/</span>(<span class="id">subset_trans</span><span class="id"> _</span>)<span class="id">;</span><span class="id"> apply</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> subr_surj</span><span class="id"> A</span><span class="id"> B</span><span class="id"> B'</span><span class="id"> f</span><span class="id"> :</span><span class="id"> B'</span><span class="id"> `&lt;=`</span><span class="id"> B</span><span class="id"> -&gt;</span><span class="id"> set_surj</span><span class="id"> A</span><span class="id"> B</span><span class="id"> f</span><span class="id"> -&gt;</span><span class="id"> set_surj</span><span class="id"> A</span><span class="id"> B'</span><span class="id"> f</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id"> exact:</span><span class="id"> subset_trans</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> can_surj</span><span class="id"> g</span><span class="id"> f</span> (<span class="id">A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT</span>) (<span class="id">B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> rT</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">{in</span><span class="id"> B,</span><span class="id"> cancel</span><span class="id"> g</span><span class="id"> f}</span><span class="id"> -&gt;</span><span class="id"> g</span><span class="id"> @`</span><span class="id"> B</span><span class="id"> `&lt;=`</span><span class="id"> A</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">set_surj</span><span class="id"> A</span><span class="id"> B</span><span class="id"> f</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> gK</span><span class="id"> gBA</span><span class="id"> y</span><span class="id"> By;</span><span class="id"> suff</span><span class="id"> :</span><span class="id"> A</span> (<span class="id">g</span><span class="id"> y</span>)<span class="gallina-kwd"> by</span><span class="gallina-kwd"> exists</span> (<span class="id">g</span><span class="id"> y</span>)<span class="id">;</span><span class="id"> rewrite</span><span class="id"> ?gK</span><span class="id"> ?inE</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> have</span><span class="id"> :=</span><span class="id"> image_subP</span>.<span class="id">1</span><span class="id"> gBA</span><span class="id"> y;</span><span class="id"> apply</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> surj_epi</span><span class="id"> sT</span><span class="id"> A</span><span class="id"> B</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> aT</span><span class="id"> -&gt;</span><span class="id"> rT</span>) (<span class="id">g</span><span class="id"> g'</span><span class="id"> :</span><span class="id"> rT</span><span class="id"> -&gt;</span><span class="id"> sT</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">set_surj</span><span class="id"> A</span><span class="id"> B</span><span class="id"> f</span><span class="id"> -&gt;</span><span class="id"> {in</span><span class="id"> A,</span><span class="id"> g</span><span class="id"> \o</span><span class="id"> f</span><span class="id"> =1</span><span class="id"> g'</span><span class="id"> \o</span><span class="id"> f}</span><span class="id"> -&gt;</span><span class="id"> {in</span><span class="id"> B,</span><span class="id"> g</span><span class="id"> =1</span><span class="id"> g'}</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> fS</span><span class="id"> eqfg</span><span class="id"> y</span><span class="id"> /set_mem</span><span class="id"> By;</span><span class="id"> suff:</span><span class="id"> B</span><span class="id"> `&lt;=`</span><span class="id"> [set</span><span class="id"> y</span><span class="id"> |</span><span class="id"> g</span><span class="id"> y</span><span class="id"> =</span><span class="id"> g'</span><span class="id"> y]</span><span class="gallina-kwd"> by</span><span class="id"> exact</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> subset_trans</span><span class="id"> fS</span><span class="id"> _</span><span class="id"> =&gt;</span><span class="id"> _</span><span class="id"> [a</span><span class="id"> /mem_set</span><span class="id"> Aa</span><span class="id"> &lt;-]</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> [LHS]eqfg</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> epiP</span><span class="id"> A</span><span class="id"> B</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> aT</span><span class="id"> -&gt;</span><span class="id"> rT</span>)<span class="id"> :</span><span class="id"> set_surj</span><span class="id"> A</span><span class="id"> B</span><span class="id"> f</span><span class="id"> &lt;-&gt;</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">forall</span><span class="id"> sT</span> (<span class="id">g</span><span class="id"> g'</span><span class="id"> :</span><span class="id"> rT</span><span class="id"> -&gt;</span><span class="id"> sT</span>)<span class="id">,</span><span class="id"> {in</span><span class="id"> A,</span><span class="id"> g</span><span class="id"> \o</span><span class="id"> f</span><span class="id"> =1</span><span class="id"> g'</span><span class="id"> \o</span><span class="id"> f}</span><span class="id"> -&gt;</span><span class="id"> {in</span><span class="id"> B,</span><span class="id"> g</span><span class="id"> =1</span><span class="id"> g'}</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">split=&gt;</span><span class="id"> [*|</span><span class="id"> f_epi</span><span class="id"> y</span><span class="id"> By];</span><span class="id"> first</span><span class="id"> exact:</span> (<span class="id">@surj_epi</span><span class="id"> _</span><span class="id"> A</span><span class="id"> B</span><span class="id"> f</span>).<br/>
<span class="id">have</span><span class="id"> -&gt;</span><span class="id"> //</span><span class="id"> :=</span><span class="id"> f_epi</span><span class="id"> _</span><span class="id"> [set</span><span class="id"> f</span><span class="id"> x</span><span class="id"> |</span><span class="id"> x</span><span class="gallina-kwd"> in</span><span class="id"> A]</span><span class="id"> setT;</span><span class="id"> last</span><span class="id"> exact:</span><span class="id"> mem_set</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> /set_mem</span><span class="id"> xA;</span><span class="id"> apply/propT;</span><span class="gallina-kwd"> exists</span><span class="id"> x</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> surj_lemmas</span>.<br/>
<span class="vernacular">Arguments</span><span class="id"> can_surj</span><span class="id"> {aT</span><span class="id"> rT}</span><span class="id"> g</span><span class="id"> [f</span><span class="id"> A</span><span class="id"> B]</span>.<br/>
<span class="vernacular">Arguments</span><span class="id"> surj_epi</span><span class="id"> {aT</span><span class="id"> rT</span><span class="id"> sT}</span><span class="id"> A</span><span class="id"> {B}</span><span class="id"> f</span><span class="id"> {g}</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> surj_comp</span><span class="id"> T1</span><span class="id"> T2</span><span class="id"> T3</span> (<span class="id">A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T1</span>) (<span class="id">B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T2</span>) (<span class="id">C</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T3</span>)<span class="id"> f</span><span class="id"> g:</span><br/>
&nbsp;&nbsp;<span class="id">set_surj</span><span class="id"> A</span><span class="id"> B</span><span class="id"> f</span><span class="id"> -&gt;</span><span class="id"> set_surj</span><span class="id"> B</span><span class="id"> C</span><span class="id"> g</span><span class="id"> -&gt;</span><span class="id"> set_surj</span><span class="id"> A</span><span class="id"> C</span> (<span class="id">g</span><span class="id"> \o</span><span class="id"> f</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> fS</span><span class="id"> gS;</span><span class="id"> apply:</span><span class="id"> 'surj_</span>(<span class="id">gS</span><span class="id"> \o</span><span class="id"> fS</span>). Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> image_eq</span><span class="id"> {aT</span><span class="id"> rT}</span><span class="id"> {A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT}</span><span class="id"> {B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> rT}</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {surjfun</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<span class="id"> :</span><span class="id"> f</span><span class="id"> @`</span><span class="id"> A</span><span class="id"> =</span><span class="id"> B</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id"> exact:</span><span class="id"> surj_image_eq</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> oinv_image_sub</span><span class="id"> {aT</span><span class="id"> rT</span><span class="id"> :</span><span class="id"> Type}</span><span class="id"> {A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT}</span><span class="id"> {B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> rT}</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">f</span><span class="id"> :</span><span class="id"> {surj</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<span class="id"> {C</span><span class="id"> :</span><span class="id"> set</span><span class="id"> rT}</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">C</span><span class="id"> `&lt;=`</span><span class="id"> B</span><span class="id"> -&gt;</span><span class="id"> 'oinv_f</span><span class="id"> @`</span><span class="id"> C</span><span class="id"> `&lt;=`</span><span class="id"> some</span><span class="id"> @`</span> (<span class="id">f</span><span class="id"> @^-1`</span><span class="id"> C</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> CB</span><span class="id"> x</span><span class="id"> [/=</span><span class="id"> y</span><span class="id"> Cy</span><span class="id"> &lt;-];</span><span class="id"> case:</span><span class="id"> 'oinvP_f</span><span class="id"> =&gt;</span><span class="id"> [|a</span><span class="id"> Aa</span><span class="id"> fay];</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> CB</span>.<br/>
<span class="gallina-kwd">by</span><span class="gallina-kwd"> exists</span><span class="id"> a</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> rewrite</span><span class="id"> fay</span>.<br/>
Qed.</div></details>
<span class="vernacular">Arguments</span><span class="id"> oinv_image_sub</span><span class="id"> {aT</span><span class="id"> rT</span><span class="id"> A</span><span class="id"> B}</span><span class="id"> f</span><span class="id"> {C}</span><span class="id"> _</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> oinv_Iimage_sub</span><span class="id"> {aT</span><span class="id"> rT</span><span class="id"> :</span><span class="id"> Type}</span><span class="id"> {A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT}</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {inj</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> rT}</span>)<span class="id"> {C</span><span class="id"> :</span><span class="id"> set</span><span class="id"> rT}</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">C</span><span class="id"> `&lt;=`</span><span class="id"> f</span><span class="id"> @`</span><span class="id"> A</span><span class="id"> -&gt;</span><span class="id"> some</span><span class="id"> @`</span> (<span class="id">A</span><span class="id"> `&amp;`</span><span class="id"> f</span><span class="id"> @^-1`</span><span class="id"> C</span>)<span class="id"> `&lt;=`</span><span class="id"> 'oinv_f</span><span class="id"> @`</span><span class="id"> C</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> ?</span><span class="id"> _</span><span class="id"> [a</span><span class="id"> [?</span><span class="id"> ?]</span><span class="id"> &lt;-];</span><span class="gallina-kwd"> exists</span> (<span class="id">f</span><span class="id"> a</span>)<span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> rewrite</span><span class="id"> funoK</span><span class="id"> ?inE</span>. Qed.</div></details>
<span class="vernacular">Arguments</span><span class="id"> oinv_Iimage_sub</span><span class="id"> {aT</span><span class="id"> rT</span><span class="id"> A}</span><span class="id"> f</span><span class="id"> {C}</span><span class="id"> _</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> oinv_sub_image</span><span class="id"> {aT</span><span class="id"> rT}</span><span class="id"> {A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT}</span><span class="id"> {B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> rT}</span><span class="id"> {f</span><span class="id"> :</span><span class="id"> {bij</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}}</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id">{C</span><span class="id"> :</span><span class="id"> set</span><span class="id"> rT}</span> (<span class="id">CB</span><span class="id"> :</span><span class="id"> C</span><span class="id"> `&lt;=`</span><span class="id"> B</span>)<span class="id"> :</span><span class="id"> 'oinv_f</span><span class="id"> @`</span><span class="id"> C</span><span class="id"> =</span><span class="id"> some</span><span class="id"> @`</span> (<span class="id">A</span><span class="id"> `&amp;`</span><span class="id"> f</span><span class="id"> @^-1`</span><span class="id"> C</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">apply/seteqP;</span><span class="id"> split;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> oinv_Iimage_sub;</span><span class="id"> rewrite</span><span class="id"> image_eq</span>.<br/>
<span class="id">rewrite</span><span class="id"> some_setI</span><span class="id"> subsetI;</span><span class="id"> split;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> oinv_image_sub</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply:</span> (<span class="id">subset_trans</span> (<span class="id">image_subset</span><span class="id"> CB</span>))<span class="id">;</span><span class="id"> rewrite</span><span class="id"> image_eq</span>.<br/>
Qed.</div></details>
<span class="vernacular">Arguments</span><span class="id"> oinv_sub_image</span><span class="id"> {aT</span><span class="id"> rT</span><span class="id"> A</span><span class="id"> B}</span><span class="id"> f</span><span class="id"> {C}</span><span class="id"> _</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> preimageEoinv</span><span class="id"> {aT</span><span class="id"> rT}</span><span class="id"> {B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> rT}</span><span class="id"> {f</span><span class="id"> :</span><span class="id"> {bij</span><span class="id"> [set:</span><span class="id"> aT]</span><span class="id"> &gt;-&gt;</span><span class="id"> B}}</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id">{C</span><span class="id"> :</span><span class="id"> set</span><span class="id"> rT}</span> (<span class="id">CB</span><span class="id"> :</span><span class="id"> C</span><span class="id"> `&lt;=`</span><span class="id"> B</span>)<span class="id"> :</span><span class="id"> some</span><span class="id"> @`</span> (<span class="id">f</span><span class="id"> @^-1`</span><span class="id"> C</span>)<span class="id"> =</span><span class="id"> 'oinv_f</span><span class="id"> @`</span><span class="id"> C</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> oinv_sub_image//</span><span class="id"> setTI</span>. Qed.</div></details>
<span class="vernacular">Arguments</span><span class="id"> preimageEoinv</span><span class="id"> {aT</span><span class="id"> rT</span><span class="id"> B}</span><span class="id"> f</span><span class="id"> {C}</span><span class="id"> _</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> inv_image_sub</span><span class="id"> {aT</span><span class="id"> rT</span><span class="id"> :</span><span class="id"> Type}</span><span class="id"> {A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT}</span><span class="id"> {B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> rT}</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">f</span><span class="id"> :</span><span class="id"> {splitsurj</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<span class="id"> {C</span><span class="id"> :</span><span class="id"> set</span><span class="id"> rT}</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">C</span><span class="id"> `&lt;=`</span><span class="id"> B</span><span class="id"> -&gt;</span><span class="id"> f^-1</span><span class="id"> @`</span><span class="id"> C</span><span class="id"> `&lt;=`</span><span class="id"> f</span><span class="id"> @^-1`</span><span class="id"> C</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> CB</span><span class="id"> x</span><span class="id"> [/=</span><span class="id"> y</span><span class="id"> Cy</span><span class="id"> &lt;-];</span><span class="id"> rewrite</span><span class="id"> invK//</span><span class="id"> mem_set//;</span><span class="id"> apply:</span><span class="id"> CB</span>. Qed.</div></details>
<span class="vernacular">Arguments</span><span class="id"> inv_image_sub</span><span class="id"> {aT</span><span class="id"> rT</span><span class="id"> A</span><span class="id"> B}</span><span class="id"> f</span><span class="id"> {C}</span><span class="id"> _</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> inv_Iimage_sub</span><span class="id"> {aT</span><span class="id"> rT</span><span class="id"> :</span><span class="id"> Type}</span><span class="id"> {A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT}</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {splitinj</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> rT}</span>)<span class="id"> {C</span><span class="id"> :</span><span class="id"> set</span><span class="id"> rT}</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">C</span><span class="id"> `&lt;=`</span><span class="id"> f</span><span class="id"> @`</span><span class="id"> A</span><span class="id"> -&gt;</span> <span class="id"> A</span><span class="id"> `&amp;`</span><span class="id"> f</span><span class="id"> @^-1`</span><span class="id"> C</span><span class="id"> `&lt;=`</span><span class="id"> f^-1</span><span class="id"> @`</span><span class="id"> C</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> CB</span><span class="id"> x</span><span class="id"> [Ax</span><span class="id"> Cfx];</span><span class="gallina-kwd"> exists</span> (<span class="id">f</span><span class="id"> x</span>)<span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> rewrite</span><span class="id"> funK//</span><span class="id"> mem_set</span>. Qed.</div></details>
<span class="vernacular">Arguments</span><span class="id"> inv_Iimage_sub</span><span class="id"> {aT</span><span class="id"> rT</span><span class="id"> A}</span><span class="id"> f</span><span class="id"> {C}</span><span class="id"> _</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> inv_sub_image</span><span class="id"> {aT</span><span class="id"> rT}</span><span class="id"> {A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT}</span><span class="id"> {B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> rT}</span><span class="id"> {f</span><span class="id"> :</span><span class="id"> {splitbij</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}}</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">{C</span><span class="id"> :</span><span class="id"> set</span><span class="id"> rT}</span> (<span class="id">CB</span><span class="id"> :</span><span class="id"> C</span><span class="id"> `&lt;=`</span><span class="id"> B</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">f^-1</span><span class="id"> @`</span><span class="id"> C</span><span class="id"> =</span><span class="id"> A</span><span class="id"> `&amp;`</span><span class="id"> f</span><span class="id"> @^-1`</span><span class="id"> C</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> image_some_inj;</span><span class="id"> rewrite</span><span class="id"> image_comp</span><span class="id"> [Some</span><span class="id"> \o</span><span class="id"> _]oliftV</span><span class="id"> oinv_sub_image</span>.<br/>
Qed.</div></details>
<span class="vernacular">Arguments</span><span class="id"> inv_sub_image</span><span class="id"> {aT</span><span class="id"> rT</span><span class="id"> A</span><span class="id"> B}</span><span class="id"> f</span><span class="id"> {C}</span><span class="id"> _</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> preimageEinv</span><span class="id"> {aT</span><span class="id"> rT}</span><span class="id"> {B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> rT}</span><span class="id"> {f</span><span class="id"> :</span><span class="id"> {splitbij</span><span class="id"> [set:</span><span class="id"> aT]</span><span class="id"> &gt;-&gt;</span><span class="id"> B}}</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">{C</span><span class="id"> :</span><span class="id"> set</span><span class="id"> rT}</span> (<span class="id">CB</span><span class="id"> :</span><span class="id"> C</span><span class="id"> `&lt;=`</span><span class="id"> B</span>)<span class="id"> :</span><span class="id"> f</span><span class="id"> @^-1`</span><span class="id"> C</span><span class="id"> =</span><span class="id"> f^-1</span><span class="id"> @`</span><span class="id"> C</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> inv_sub_image//</span><span class="id"> setTI</span>. Qed.</div></details>
<span class="vernacular">Arguments</span><span class="id"> preimageEinv</span><span class="id"> {aT</span><span class="id"> rT</span><span class="id"> B}</span><span class="id"> f</span><span class="id"> {C}</span><span class="id"> _</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> reindex_bigcup</span><span class="id"> {aT</span><span class="id"> rT</span><span class="id"> I}</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> aT</span><span class="id"> -&gt;</span><span class="id"> I</span>) (<span class="id">P</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT</span>) (<span class="id">Q</span><span class="id"> :</span><span class="id"> set</span><span class="id"> I</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">F</span><span class="id"> :</span><span class="id"> I</span><span class="id"> -&gt;</span><span class="id"> set</span><span class="id"> rT</span>)<span class="id"> :</span><span class="id"> set_fun</span><span class="id"> P</span><span class="id"> Q</span><span class="id"> f</span><span class="id"> -&gt;</span><span class="id"> set_surj</span><span class="id"> P</span><span class="id"> Q</span><span class="id"> f</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">\bigcup_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> Q</span>)<span class="id"> F</span><span class="id"> x</span><span class="id"> =</span><span class="id"> \bigcup_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> P</span>)<span class="id"> F</span> (<span class="id">f</span><span class="id"> x</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> /image_subP</span><span class="id"> fPQ</span><span class="id"> /</span>(<span class="id">surj_image_eq</span><span class="id"> fPQ</span>)<span class="id">&lt;-;</span><span class="id"> rewrite</span><span class="id"> bigcup_image</span>.<br/>
Qed.</div></details>
<span class="vernacular">Arguments</span><span class="id"> reindex_bigcup</span><span class="id"> {aT</span><span class="id"> rT</span><span class="id"> I}</span><span class="id"> f</span><span class="id"> P</span><span class="id"> Q</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> reindex_bigcap</span><span class="id"> {aT</span><span class="id"> rT</span><span class="id"> I}</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> aT</span><span class="id"> -&gt;</span><span class="id"> I</span>) (<span class="id">P</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT</span>) (<span class="id">Q</span><span class="id"> :</span><span class="id"> set</span><span class="id"> I</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">F</span><span class="id"> :</span><span class="id"> I</span><span class="id"> -&gt;</span><span class="id"> set</span><span class="id"> rT</span>)<span class="id"> :</span><span class="id"> set_fun</span><span class="id"> P</span><span class="id"> Q</span><span class="id"> f</span><span class="id"> -&gt;</span><span class="id"> set_surj</span><span class="id"> P</span><span class="id"> Q</span><span class="id"> f</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">\bigcap_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> Q</span>)<span class="id"> F</span><span class="id"> x</span><span class="id"> =</span><span class="id"> \bigcap_</span>(<span class="id">x</span><span class="gallina-kwd"> in</span><span class="id"> P</span>)<span class="id"> F</span> (<span class="id">f</span><span class="id"> x</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> /image_subP</span><span class="id"> fPQ</span><span class="id"> /</span>(<span class="id">surj_image_eq</span><span class="id"> fPQ</span>)<span class="id">&lt;-;</span><span class="id"> rewrite</span><span class="id"> bigcap_image</span>.<br/>
Qed.</div></details>
<span class="vernacular">Arguments</span><span class="id"> reindex_bigcap</span><span class="id"> {aT</span><span class="id"> rT</span><span class="id"> I}</span><span class="id"> f</span><span class="id"> P</span><span class="id"> Q</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> bigcap_bigcup</span><span class="id"> T</span><span class="id"> I</span><span class="id"> J</span> (<span class="id">D</span><span class="id"> :</span><span class="id"> set</span><span class="id"> I</span>) (<span class="id">E</span><span class="id"> :</span><span class="id"> set</span><span class="id"> J</span>) (<span class="id">F</span><span class="id"> :</span><span class="id"> I</span><span class="id"> -&gt;</span><span class="id"> J</span><span class="id"> -&gt;</span><span class="id"> set</span><span class="id"> T</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">J</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">\bigcap_</span>(<span class="id">i</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> \bigcup_</span>(<span class="id">j</span><span class="gallina-kwd"> in</span><span class="id"> E</span>)<span class="id"> F</span><span class="id"> i</span><span class="id"> j</span><span class="id"> =</span><br/>
&nbsp;&nbsp;<span class="id">\bigcup_</span>(<span class="id">f</span><span class="gallina-kwd"> in</span><span class="id"> set_fun</span><span class="id"> D</span><span class="id"> E</span>)<span class="id"> \bigcap_</span>(<span class="id">i</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> F</span><span class="id"> i</span> (<span class="id">f</span><span class="id"> i</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> j;</span><span class="id"> apply/seteqP;</span><span class="id"> split=&gt;</span><span class="id"> x</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> /</span>(_<span class="id"> _</span><span class="id"> _</span>)<span class="id">/cid2</span><span class="id"> ff</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> /</span>(<span class="id">all_sig2_cond</span><span class="id"> j</span>) (<span class="id">i</span><span class="id"> :</span><span class="id"> I</span>)<span class="id"> :</span><span class="id"> i</span><span class="id"> \in</span><span class="id"> D</span><span class="id"> -&gt;</span><span class="id"> {x0</span><span class="id"> :</span><span class="id"> J</span><span class="id"> |</span><span class="id"> E</span><span class="id"> x0</span><span class="id"> &amp;</span><span class="id"> F</span><span class="id"> i</span><span class="id"> x0</span><span class="id"> x}</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> /set_mem;</span><span class="id"> apply:</span><span class="id"> ff</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> [f</span><span class="id"> /</span>(_<span class="id"> _</span> (<span class="id">mem_set</span><span class="id"> _</span>))<span class="id">Ef</span><span class="id"> /</span>(_<span class="id"> _</span> (<span class="id">mem_set</span><span class="id"> _</span>))<span class="id">Ff];</span><span class="gallina-kwd"> exists</span><span class="id"> f</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> [f</span><span class="id"> fDE</span><span class="id"> fF</span><span class="id"> i</span><span class="id"> Fi];</span><span class="gallina-kwd"> exists</span> (<span class="id">f</span><span class="id"> i</span>)<span class="id">;</span><span class="id"> [apply:</span><span class="id"> fDE|apply:</span><span class="id"> fF]</span>.<br/>
Qed.</div></details>
<br/>
<div class="doc">Injections </div>
<br/>
<span class="vernacular">Lemma</span><span class="id"> trivIset_inj</span><span class="id"> T</span><span class="id"> I</span> (<span class="id">D</span><span class="id"> :</span><span class="id"> set</span><span class="id"> I</span>) (<span class="id">F</span><span class="id"> :</span><span class="id"> I</span><span class="id"> -&gt;</span><span class="id"> set</span><span class="id"> T</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">forall</span><span class="id"> i,</span><span class="id"> D</span><span class="id"> i</span><span class="id"> -&gt;</span><span class="id"> F</span><span class="id"> i</span><span class="id"> !=set0</span>)<span class="id"> -&gt;</span><span class="id"> trivIset</span><span class="id"> D</span><span class="id"> F</span><span class="id"> -&gt;</span><span class="id"> set_inj</span><span class="id"> D</span><span class="id"> F</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> FN0</span><span class="id"> Ftriv</span><span class="id"> i</span><span class="id"> j;</span><span class="id"> rewrite</span><span class="id"> !inE</span><span class="id"> =&gt;</span><span class="id"> Di</span><span class="id"> Dj</span><span class="id"> Fij</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> Ftriv</span><span class="id"> Di</span> (<span class="id">Dj</span>)<span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> Fij</span><span class="id"> setIid;</span><span class="id"> apply:</span><span class="id"> FN0</span>.<br/>
Qed.</div></details>
<br/>
<div class="doc">Bijections </div>
<br/>
<span class="vernacular">Section</span><span class="id"> set_bij_lemmas</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {aT</span><span class="id"> rT</span><span class="id"> :</span><span class="id"> Type}</span><span class="id"> {A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT}</span><span class="id"> {B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> rT}</span><span class="id"> {f</span><span class="id"> :</span><span class="id"> aT</span><span class="id"> -&gt;</span><span class="id"> rT}</span>.<br/>
<span class="vernacular">Definition</span><span class="id"> fun_set_bij</span><span class="id"> of</span><span class="id"> set_bij</span><span class="id"> A</span><span class="id"> B</span><span class="id"> f</span><span class="id"> :=</span><span class="id"> f</span>.<br/>
<span class="vernacular">Context</span> (<span class="id">fbij</span><span class="id"> :</span><span class="id"> set_bij</span><span class="id"> A</span><span class="id"> B</span><span class="id"> f</span>).<br/>
<span class="vernacular">Local</span><span class="vernacular"> Notation</span><span class="id"> g</span><span class="id"> :=</span> (<span class="id">fun_set_bij</span><span class="id"> fbij</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> set_bij_inj</span><span class="id"> :</span><span class="id"> {in</span><span class="id"> A</span><span class="id"> &amp;,</span><span class="id"> injective</span><span class="id"> f}</span><br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> case:</span><span class="id"> fbij</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> set_bij_homo</span><span class="id"> :</span><span class="id"> {homo</span><span class="id"> f</span><span class="id"> :</span><span class="id"> x</span><span class="id"> /</span><span class="id"> A</span><span class="id"> x</span><span class="id"> &gt;-&gt;</span><span class="id"> B</span><span class="id"> x}</span><br/>
<details>
&nbsp;<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> case:</span><span class="id"> fbij</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> set_bij_sub</span><span class="id"> :</span><span class="id"> f</span><span class="id"> @`</span><span class="id"> A</span><span class="id"> `&lt;=`</span><span class="id"> B</span><br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id"> exact/image_subP/set_bij_homo</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> set_bij_surj</span><span class="id"> :</span><span class="id"> set_surj</span><span class="id"> A</span><span class="id"> B</span><span class="id"> f</span><br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> case:</span><span class="id"> fbij</span>. Qed.</div></details>
<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :</span><span class="id"> OCanV</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> g</span><span class="id"> :=</span><span class="id"> set_bij_surj</span>.<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> isFun</span>.<span class="id">Build</span><span class="id"> _</span><span class="id"> _</span><span class="id"> A</span><span class="id"> B</span><span class="id"> g</span><span class="id"> set_bij_homo</span>.<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> SurjFun_Inj</span>.<span class="id">Build</span><span class="id"> _</span><span class="id"> _</span><span class="id"> A</span><span class="id"> B</span><span class="id"> g</span><span class="id"> set_bij_inj</span>.<br/>
<br/>
<span class="vernacular">End</span><span class="id"> set_bij_lemmas</span>.<br/>
<span class="vernacular">Coercion</span><span class="id"> fun_set_bij</span><span class="id"> :</span><span class="id"> set_bij</span><span class="id"> &gt;-&gt;</span><span class="id"> Funclass</span>.<br/>
<br/>
<span class="vernacular">Coercion</span><span class="id"> set_bij_bijfun</span><span class="id"> aT</span><span class="id"> rT</span> (<span class="id">A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT</span>) (<span class="id">B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> rT</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> aT</span><span class="id"> -&gt;</span><span class="id"> rT</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">fS</span><span class="id"> :</span><span class="id"> set_bij</span><span class="id"> A</span><span class="id"> B</span><span class="id"> f</span>)<span class="id"> :=</span><span class="id"> Bij</span>.<span class="id">on</span> (<span class="id">fun_set_bij</span><span class="id"> fS</span>).<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> Pbij</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {aT</span><span class="id"> rT}</span><span class="id"> {A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT}</span><span class="id"> {B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> rT}</span><span class="id"> {f</span><span class="id"> :</span><span class="id"> aT</span><span class="id"> -&gt;</span><span class="id"> rT}</span> (<span class="id">fbij</span><span class="id"> :</span><span class="id"> set_bij</span><span class="id"> A</span><span class="id"> B</span><span class="id"> f</span>).<br/>
<span class="id">#[local]</span><span class="id"> HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :</span><span class="id"> @Bij</span><span class="id"> _</span><span class="id"> _</span><span class="id"> A</span><span class="id"> B</span><span class="id"> f</span><span class="id"> :=</span><span class="id"> fbij</span>.<br/>
<span class="vernacular">Definition</span><span class="id"> bij_of_set_bijection</span><span class="id"> :=</span><span class="id"> [bij</span><span class="id"> of</span><span class="id"> f]</span>.<br/>
<span class="vernacular">Lemma</span><span class="id"> Pbij</span><span class="id"> :</span><span class="id"> {s</span><span class="id"> :</span><span class="id"> {bij</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span><span class="id"> |</span><span class="id"> f</span><span class="id"> =</span><span class="id"> s}</span><br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="gallina-kwd"> exists</span><span class="id"> [bij</span><span class="id"> of</span><span class="id"> f]</span>. Qed.</div></details>
<span class="vernacular">End</span><span class="id"> Pbij</span>.<br/>
<span class="vernacular">Coercion</span><span class="id"> bij_of_set_bijection</span><span class="id"> :</span><span class="id"> set_bij</span><span class="id"> &gt;-&gt;</span><span class="id"> Bij</span>.<span class="id">type</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> bij</span><span class="id"> {aT</span><span class="id"> rT}</span><span class="id"> {A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT}</span><span class="id"> {B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> rT}</span><span class="id"> {f</span><span class="id"> :</span><span class="id"> {bij</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}}</span><span class="id"> :</span><span class="id"> set_bij</span><span class="id"> A</span><span class="id"> B</span><span class="id"> f</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id"> split=&gt;</span><span class="id"> //</span>. Qed.</div></details>
<span class="vernacular">Definition</span><span class="id"> phant_bij</span><span class="id"> aT</span><span class="id"> rT</span> (<span class="id">A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT</span>) (<span class="id">B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> rT</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> {bij</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<span class="id"> of</span><br/>
&nbsp;&nbsp;<span class="id">phantom</span> (_<span class="id"> -&gt;</span><span class="id"> _</span>)<span class="id"> f</span><span class="id"> :=</span><span class="id"> @bij</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> f</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;''bij_' f&quot;</span><span class="id"> :=</span> (<span class="id">phant_bij</span> (<span class="id">Phantom</span> (_<span class="id"> -&gt;</span><span class="id"> _</span>)<span class="id"> f</span>))<span class="id"> :</span><span class="id"> form_scope</span>.<br/>
<span class="id">#[global]</span><span class="vernacular"> Hint</span><span class="id"> Extern</span><span class="id"> 0</span> (<span class="id">set_bij</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span>)<span class="id"> =&gt;</span><span class="id"> solve</span><span class="id"> [apply:</span><span class="id"> bij]</span><span class="id"> :</span><span class="id"> core</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> PbijTT</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {aT</span><span class="id"> rT}</span><span class="id"> {f</span><span class="id"> :</span><span class="id"> aT</span><span class="id"> -&gt;</span><span class="id"> rT}</span> (<span class="id">fbijTT</span><span class="id"> :</span><span class="id"> bijective</span><span class="id"> f</span>).<br/>
<span class="id">#[local]</span><span class="id"> HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> @BijTT</span>.<span class="id">Build</span><span class="id"> _</span><span class="id"> _</span><span class="id"> f</span><span class="id"> fbijTT</span>.<br/>
<span class="vernacular">Definition</span><span class="id"> bijection_of_bijective</span><span class="id"> :=</span><span class="id"> [splitbij</span><span class="id"> of</span><span class="id"> f]</span>.<br/>
<span class="vernacular">Lemma</span><span class="id"> PbijTT</span><span class="id"> :</span><span class="id"> {s</span><span class="id"> :</span><span class="id"> {splitbij</span><span class="id"> [set:</span><span class="id"> aT]</span><span class="id"> &gt;-&gt;</span><span class="id"> [set:</span><span class="id"> rT]}</span><span class="id"> |</span><span class="id"> f</span><span class="id"> =</span><span class="id"> s}</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="gallina-kwd"> exists</span><span class="id"> [splitbij</span><span class="id"> of</span><span class="id"> f]</span>. Qed.</div></details>
<span class="vernacular">End</span><span class="id"> PbijTT</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> setTT_bijective</span><span class="id"> aT</span><span class="id"> rT</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> aT</span><span class="id"> -&gt;</span><span class="id"> rT</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">set_bij</span><span class="id"> [set:</span><span class="id"> aT]</span><span class="id"> [set:</span><span class="id"> rT]</span><span class="id"> f</span><span class="id"> =</span><span class="id"> bijective</span><span class="id"> f</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">apply/propext;</span><span class="id"> split=&gt;</span><span class="id"> [[]|/PbijTT[{}f</span><span class="id"> -&gt;]]</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> _</span><span class="id"> fI</span><span class="id"> /</span>(_<span class="id"> _</span><span class="id"> I</span>)<span class="id">-/</span>(_<span class="id"> _</span>)<span class="id">/cid2-/all_sig2[g</span><span class="id"> _</span><span class="id"> gK]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="gallina-kwd"> exists</span><span class="id"> g</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> x;</span><span class="id"> apply:</span><span class="id"> fI;</span><span class="id"> rewrite</span><span class="id"> ?inE</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> split=&gt;</span><span class="id"> //</span><span class="id"> [x</span><span class="id"> y</span><span class="id"> _</span><span class="id"> _</span><span class="id"> /'inj_f//|y</span><span class="id"> _];</span><span class="gallina-kwd"> exists</span> (<span class="id">f^-1</span><span class="id"> y</span>)<span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> rewrite</span><span class="id"> funK</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> bijTT</span><span class="id"> {aT</span><span class="id"> rT}</span> <span class="id"> {f</span><span class="id"> :</span><span class="id"> {bij</span><span class="id"> [set:</span><span class="id"> aT]</span><span class="id"> &gt;-&gt;</span><span class="id"> [set:</span><span class="id"> rT]}}</span><span class="id"> :</span><span class="id"> bijective</span><span class="id"> f</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> -setTT_bijective</span>. Qed.</div></details>
<span class="vernacular">Definition</span><span class="id"> phant_bijTT</span><span class="id"> aT</span><span class="id"> rT</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {bij</span><span class="id"> [set:</span><span class="id"> aT]</span><span class="id"> &gt;-&gt;</span><span class="id"> [set:</span><span class="id"> rT]}</span>)<br/>
&nbsp;&nbsp;&nbsp;<span class="id">of</span><span class="id"> phantom</span> (_<span class="id"> -&gt;</span><span class="id"> _</span>)<span class="id"> f</span><span class="id"> :=</span><span class="id"> @bijTT</span><span class="id"> _</span><span class="id"> _</span><span class="id"> f</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;''bijTT_'  f&quot;</span><span class="id"> :=</span> (<span class="id">phant_bijTT</span> (<span class="id">Phantom</span> (_<span class="id"> -&gt;</span><span class="id"> _</span>)<span class="id"> f</span>))<span class="id"> :</span><span class="id"> form_scope</span>.<br/>
<span class="id">#[global]</span><span class="vernacular"> Hint</span><span class="id"> Extern</span><span class="id"> 0</span> (<span class="id">bijective</span><span class="id"> _</span>)<span class="id"> =&gt;</span><span class="id"> solve</span><span class="id"> [apply:</span><span class="id"> bijTT]</span><span class="id"> :</span><span class="id"> core</span>.<br/>
<br/>
<div class="ssrdoc md">
## Patching and restrictions
</div>
<br/>
<span class="vernacular">Section</span><span class="id"> patch</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {aT</span><span class="id"> rT</span><span class="id"> :</span><span class="id"> Type}</span> (<span class="id">d</span><span class="id"> :</span><span class="id"> aT</span><span class="id"> -&gt;</span><span class="id"> rT</span>) (<span class="id">A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT</span>).<br/>
<span class="vernacular">Definition</span><span class="id"> patch</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> aT</span><span class="id"> -&gt;</span><span class="id"> rT</span>)<span class="id"> u</span><span class="id"> :=</span><span class="gallina-kwd"> if</span><span class="id"> u</span><span class="id"> \in</span><span class="id"> A</span><span class="gallina-kwd"> then</span><span class="id"> f</span><span class="id"> u</span><span class="gallina-kwd"> else</span><span class="id"> d</span><span class="id"> u</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> patchT</span><span class="id"> f</span><span class="id"> :</span><span class="id"> {in</span><span class="id"> A,</span><span class="id"> patch</span><span class="id"> f</span><span class="id"> =1</span><span class="id"> f}</span><br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> /patch</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> -&gt;</span>. Qed.</div></details>
<span class="vernacular">Lemma</span><span class="id"> patchN</span><span class="id"> f</span><span class="id"> :</span><span class="id"> {in</span><span class="id"> [predC</span><span class="id"> A],</span><span class="id"> patch</span><span class="id"> f</span><span class="id"> =1</span><span class="id"> d}</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> /patch</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> /negPf/=</span><span class="id"> -&gt;</span>. Qed.</div></details>
<span class="vernacular">Lemma</span><span class="id"> patchC</span><span class="id"> f</span><span class="id"> :</span><span class="id"> {in</span><span class="id"> ~`</span><span class="id"> A,</span><span class="id"> patch</span><span class="id"> f</span><span class="id"> =1</span><span class="id"> d}</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> u</span><span class="id"> /set_mem/=</span><span class="id"> NAu;</span><span class="id"> rewrite</span><span class="id"> patchN</span><span class="id"> ?inE//=</span><span class="id"> notin_setE</span>. Qed.</div></details>
<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> f</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">SurjFun</span>.<span class="id">copy</span> (<span class="id">patch</span><span class="id"> f</span>)<span class="id"> [fun</span><span class="id"> patch</span><span class="id"> f</span><span class="gallina-kwd"> in</span><span class="id"> A]</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> inj</span>.<br/>
<span class="vernacular">Context</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {inj</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> rT}</span>).<br/>
<span class="vernacular">Let</span><span class="id"> g</span><span class="id"> :=</span><span class="id"> patch</span><span class="id"> f</span>.<br/>
<span class="vernacular">Lemma</span><span class="id"> patch_inj_subproof</span><span class="id"> :</span><span class="id"> Inj</span><span class="id"> aT</span><span class="id"> rT</span><span class="id"> A</span><span class="id"> g</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> split=&gt;</span><span class="id"> x</span><span class="id"> y</span><span class="id"> xA</span><span class="id"> yA;</span><span class="id"> rewrite</span><span class="id"> /g</span><span class="id"> !patchT//;</span><span class="id"> apply:</span><span class="id"> inj</span>. Qed.</div></details>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> patch_inj_subproof</span>.<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> Inject</span>.<span class="id">copy</span> (<span class="id">patch</span><span class="id"> f</span>)<span class="id"> [fun</span><span class="id"> g</span><span class="gallina-kwd"> in</span><span class="id"> A]</span>.<br/>
<span class="vernacular">End</span><span class="id"> inj</span>.<br/>
<br/>
<span class="vernacular">End</span><span class="id"> patch</span>.<br/>
<span class="vernacular">Notation</span><span class="id"> restrict</span><span class="id"> :=</span> (<span class="id">patch</span> (<span class="id">fun=&gt;</span><span class="id"> point</span>)).<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;f \_ D&quot;</span><span class="id"> :=</span> (<span class="id">restrict</span><span class="id"> D</span><span class="id"> f</span>)<span class="id"> :</span><span class="id"> function_scope</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> patchE</span><span class="id"> aT</span> (<span class="id">rT</span><span class="id"> :</span><span class="id"> pointedType</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> aT</span><span class="id"> -&gt;</span><span class="id"> rT</span>) (<span class="id">B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT</span>)<span class="id"> x</span><span class="id"> :</span><br/>
&nbsp;&nbsp;(<span class="id">f</span><span class="id"> \_</span><span class="id"> B</span>)<span class="id"> x</span><span class="id"> =</span><span class="gallina-kwd"> if</span><span class="id"> x</span><span class="id"> \in</span><span class="id"> B</span><span class="gallina-kwd"> then</span><span class="id"> f</span><span class="id"> x</span><span class="gallina-kwd"> else</span><span class="id"> point</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> []</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> patch_pred</span><span class="id"> {I</span><span class="id"> T}</span> (<span class="id">D</span><span class="id"> :</span><span class="id"> {pred</span><span class="id"> I}</span>) (<span class="id">d</span><span class="id"> f</span><span class="id"> :</span><span class="id"> I</span><span class="id"> -&gt;</span><span class="id"> T</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">patch</span><span class="id"> d</span><span class="id"> D</span><span class="id"> f</span><span class="id"> =</span><span class="gallina-kwd"> fun</span><span class="id"> i</span><span class="id"> =&gt;</span><span class="gallina-kwd"> if</span><span class="id"> D</span><span class="id"> i</span><span class="gallina-kwd"> then</span><span class="id"> f</span><span class="id"> i</span><span class="gallina-kwd"> else</span><span class="id"> d</span><span class="id"> i</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> apply/funext</span><span class="id"> =&gt;</span><span class="id"> i;</span><span class="id"> rewrite</span><span class="id"> /patch</span><span class="id"> mem_setE</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> preimage_restrict</span> (<span class="id">aT</span><span class="id"> :</span><span class="gallina-kwd"> Type</span>) (<span class="id">rT</span><span class="id"> :</span><span class="id"> pointedType</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">f</span><span class="id"> :</span><span class="id"> aT</span><span class="id"> -&gt;</span><span class="id"> rT</span>) (<span class="id">D</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT</span>) (<span class="id">B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> rT</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;(<span class="id">f</span><span class="id"> \_</span><span class="id"> D</span>)<span class="id"> @^-1`</span><span class="id"> B</span><span class="id"> =</span> (<span class="gallina-kwd">if</span><span class="id"> point</span><span class="id"> \in</span><span class="id"> B</span><span class="gallina-kwd"> then</span><span class="id"> ~`</span><span class="id"> D</span><span class="gallina-kwd"> else</span><span class="id"> set0</span>)<span class="id"> `|`</span><span class="id"> D</span><span class="id"> `&amp;`</span><span class="id"> f</span><span class="id"> @^-1`</span><span class="id"> B</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> /preimage/=</span><span class="id"> /patch;</span><span class="id"> apply/predeqP</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> /=;</span><span class="id"> split</span>.<br/>
&nbsp;&nbsp;<span class="id">case:</span><span class="id"> ifPn;</span><span class="id"> rewrite</span><span class="id"> ?</span>(<span class="id">inE,</span><span class="id"> notin_setE</span>)<span class="id">;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> right</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> NDx</span><span class="id"> Bp;</span><span class="id"> rewrite</span><span class="id"> ifT</span><span class="id"> ?inE//=;</span><span class="id"> left</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> [|[Dx</span><span class="id"> Bfx]];</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> ifT</span><span class="id"> ?inE</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> case:</span><span class="id"> ifP;</span><span class="id"> rewrite</span><span class="id"> //</span><span class="id"> inE</span><span class="id"> =&gt;</span><span class="id"> Bp</span><span class="id"> NDx;</span><span class="id"> case:</span><span class="id"> ifPn;</span><span class="id"> rewrite</span><span class="id"> //</span><span class="id"> inE</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> comp_patch</span><span class="id"> {aT</span><span class="id"> rT</span><span class="id"> sT</span><span class="id"> :</span><span class="id"> Type}</span> (<span class="id">g</span><span class="id"> :</span><span class="id"> aT</span><span class="id"> -&gt;</span><span class="id"> rT</span>)<span class="id"> D</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> aT</span><span class="id"> -&gt;</span><span class="id"> rT</span>) (<span class="id">h</span><span class="id"> :</span><span class="id"> rT</span><span class="id"> -&gt;</span><span class="id"> sT</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">h</span><span class="id"> \o</span><span class="id"> patch</span><span class="id"> g</span><span class="id"> D</span><span class="id"> f</span><span class="id"> =</span><span class="id"> patch</span> (<span class="id">h</span><span class="id"> \o</span><span class="id"> g</span>)<span class="id"> D</span> (<span class="id">h</span><span class="id"> \o</span><span class="id"> f</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> apply/funext</span><span class="id"> =&gt;</span><span class="id"> x;</span><span class="id"> rewrite</span><span class="id"> /patch/=;</span><span class="id"> case:</span><span class="id"> ifP</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> patch_setI</span><span class="id"> {aT</span><span class="id"> rT</span><span class="id"> :</span><span class="id"> Type}</span> (<span class="id">g</span><span class="id"> :</span><span class="id"> aT</span><span class="id"> -&gt;</span><span class="id"> rT</span>)<span class="id"> D</span><span class="id"> D'</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> aT</span><span class="id"> -&gt;</span><span class="id"> rT</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id">patch</span><span class="id"> g</span> (<span class="id">D</span><span class="id"> `&amp;`</span><span class="id"> D'</span>)<span class="id"> f</span><span class="id"> =</span><span class="id"> patch</span><span class="id"> g</span><span class="id"> D</span> (<span class="id">patch</span><span class="id"> g</span><span class="id"> D'</span><span class="id"> f</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">apply/funext</span><span class="id"> =&gt;</span><span class="id"> x;</span><span class="id"> rewrite</span><span class="id"> /patch/=</span><span class="id"> in_setI</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> case:</span> (<span class="id">x</span><span class="id"> \in</span><span class="id"> D</span>) (<span class="id">x</span><span class="id"> \in</span><span class="id"> D'</span>)<span class="id"> =&gt;</span><span class="id"> []</span><span class="id"> []</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> patch_set0</span><span class="id"> {aT</span><span class="id"> rT</span><span class="id"> :</span><span class="id"> Type}</span> (<span class="id">g</span><span class="id"> :</span><span class="id"> aT</span><span class="id"> -&gt;</span><span class="id"> rT</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> aT</span><span class="id"> -&gt;</span><span class="id"> rT</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">patch</span><span class="id"> g</span><span class="id"> set0</span><span class="id"> f</span><span class="id"> =</span><span class="id"> g</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> apply/funext</span><span class="id"> =&gt;</span><span class="id"> x;</span><span class="id"> rewrite</span><span class="id"> /patch</span><span class="id"> in_set0</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> patch_setT</span><span class="id"> {aT</span><span class="id"> rT</span><span class="id"> :</span><span class="id"> Type}</span> (<span class="id">g</span><span class="id"> :</span><span class="id"> aT</span><span class="id"> -&gt;</span><span class="id"> rT</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> aT</span><span class="id"> -&gt;</span><span class="id"> rT</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">patch</span><span class="id"> g</span><span class="id"> setT</span><span class="id"> f</span><span class="id"> =</span><span class="id"> f</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> apply/funext</span><span class="id"> =&gt;</span><span class="id"> x;</span><span class="id"> rewrite</span><span class="id"> /patch</span><span class="id"> in_setT</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> restrict_comp</span><span class="id"> {aT}</span><span class="id"> {rT</span><span class="id"> sT</span><span class="id"> :</span><span class="id"> pointedType}</span> (<span class="id">h</span><span class="id"> :</span><span class="id"> rT</span><span class="id"> -&gt;</span><span class="id"> sT</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> aT</span><span class="id"> -&gt;</span><span class="id"> rT</span>)<span class="id"> D</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">h</span><span class="id"> point</span><span class="id"> =</span><span class="id"> point</span><span class="id"> -&gt;</span> (<span class="id">h</span><span class="id"> \o</span><span class="id"> f</span>)<span class="id"> \_</span><span class="id"> D</span><span class="id"> =</span><span class="id"> h</span><span class="id"> \o</span> (<span class="id">f</span><span class="id"> \_</span><span class="id"> D</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> hp;</span><span class="id"> apply/funext</span><span class="id"> =&gt;</span><span class="id"> x;</span><span class="id"> rewrite</span><span class="id"> /patch/=;</span><span class="id"> case:</span><span class="id"> ifP</span>. Qed.</div></details>
<span class="vernacular">Arguments</span><span class="id"> restrict_comp</span><span class="id"> {aT</span><span class="id"> rT</span><span class="id"> sT}</span><span class="id"> h</span><span class="id"> f</span><span class="id"> D</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> trivIset_restr</span> (<span class="id">T</span><span class="id"> I</span><span class="id"> :</span><span class="gallina-kwd"> Type</span>) (<span class="id">D</span><span class="id"> D'</span><span class="id"> :</span><span class="id"> set</span><span class="id"> I</span>) (<span class="id">F</span><span class="id"> :</span><span class="id"> I</span><span class="id"> -&gt;</span><span class="id"> set</span><span class="id"> T</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">trivIset</span><span class="id"> D'</span> (<span class="id">F</span><span class="id"> \_</span><span class="id"> D</span>)<span class="id"> =</span><span class="id"> trivIset</span> (<span class="id">D</span><span class="id"> `&amp;`</span><span class="id"> D'</span>)<span class="id"> F</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">apply/propext;</span><span class="id"> split=&gt;</span><span class="id"> FDtriv</span><span class="id"> i</span><span class="id"> j</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> [Di</span><span class="id"> D'i]</span><span class="id"> [Dj</span><span class="id"> D'j]</span><span class="id"> [x</span><span class="id"> [Fix</span><span class="id"> Fjx]];</span><span class="id"> apply:</span><span class="id"> FDtriv</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="gallina-kwd"> exists</span><span class="id"> x;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> ?patchT</span><span class="id"> ?in_setE</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> D'i</span><span class="id"> D'j</span><span class="id"> [x</span><span class="id"> []];</span><span class="id"> rewrite</span><span class="id"> /patch</span>.<br/>
<span class="id">do</span><span class="id"> 2![case:</span><span class="id"> ifPn</span><span class="id"> =&gt;</span><span class="id"> //];</span><span class="id"> rewrite</span><span class="id"> !in_setE</span><span class="id"> =&gt;</span><span class="id"> Di</span><span class="id"> Dj</span><span class="id"> Fix</span><span class="id"> Fjx</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> FDtriv</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="gallina-kwd"> exists</span><span class="id"> x</span>.<br/>
Qed.</div></details>
<br/>
<div class="ssrdoc md">
## Restriction of domain and codomain
</div>
<br/>
<span class="vernacular">Section</span><span class="id"> RestrictionLeft</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {U</span><span class="id"> V</span><span class="id"> :</span><span class="id"> Type}</span> (<span class="id">v</span><span class="id"> :</span><span class="id"> V</span>)<span class="id"> {A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> U}</span><span class="id"> {B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> V}</span>.<br/>
<br/>
<span class="vernacular">Local</span><span class="vernacular"> Notation</span><span class="id"> restrict</span><span class="id"> :=</span> (<span class="id">patch</span> (<span class="id">fun=&gt;</span><span class="id"> v</span>)<span class="id"> A</span>).<br/>
<br/>
<span class="vernacular">Definition</span><span class="id"> sigL</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> U</span><span class="id"> -&gt;</span><span class="id"> V</span>)<span class="id"> :</span><span class="id"> A</span><span class="id"> -&gt;</span><span class="id"> V</span><span class="id"> :=</span><span class="id"> f</span><span class="id"> \o</span><span class="id"> set_val</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> sigL_isfun</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {fun</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<span class="id"> :</span><span class="id"> isFun</span><span class="id"> _</span><span class="id"> _</span><span class="id"> [set:</span><span class="id"> A]</span><span class="id"> B</span> (<span class="id">sigL</span><span class="id"> f</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> split=&gt;</span><span class="id"> x</span><span class="id"> _;</span><span class="id"> apply:</span><span class="id"> funS</span>. Qed.</div></details>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {fun</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<span class="id"> :=</span><span class="id"> sigL_isfun</span><span class="id"> f</span>.<br/>
<br/>
<span class="vernacular">Definition</span><span class="id"> sigLfun</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {fun</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<span class="id"> :=</span><span class="id"> [fun</span><span class="id"> of</span><span class="id"> sigL</span><span class="id"> f]</span>.<br/>
<span class="vernacular">Definition</span><span class="id"> valL_</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> A</span><span class="id"> -&gt;</span><span class="id"> V</span>)<span class="id"> :</span><span class="id"> U</span><span class="id"> -&gt;</span><span class="id"> V</span><span class="id"> :=</span> ((<span class="id">@oapp</span><span class="id"> _</span><span class="id"> _</span>)<span class="id">^~</span><span class="id"> v</span>)<span class="id"> f</span><span class="id"> \o</span><span class="id"> 'oinv_set_val</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> valL_isfun</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {fun</span><span class="id"> [set:</span><span class="id"> A]</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">isFun</span><span class="id"> _</span><span class="id"> _</span><span class="id"> A</span><span class="id"> B</span> (<span class="id">valL_</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> _</span><span class="id"> -&gt;</span><span class="id"> _</span>)).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> split=&gt;</span><span class="id"> x</span><span class="id"> Ax;</span><span class="id"> apply:</span><span class="id"> funS</span>. Qed.</div></details>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {fun</span><span class="id"> [set:</span><span class="id"> A]</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<span class="id"> :=</span><span class="id"> valL_isfun</span><span class="id"> f</span>.<br/>
<span class="vernacular">Definition</span><span class="id"> valLfun_</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {fun</span><span class="id"> [set:</span><span class="id"> A]</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<span class="id"> :=</span><span class="id"> [fun</span><span class="id"> of</span><span class="id"> valL_</span><span class="id"> f]</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> sigLE</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> U</span><span class="id"> -&gt;</span><span class="id"> V</span>)<span class="id"> x</span> (<span class="id">xA</span><span class="id"> :</span><span class="id"> x</span><span class="id"> \in</span><span class="id"> A</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">sigL</span><span class="id"> f</span> (<span class="id">SigSub</span><span class="id"> xA</span>)<span class="id"> =</span><span class="id"> f</span><span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id"> done</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> eq_sigLP</span> (<span class="id">f</span><span class="id"> g</span><span class="id"> :</span><span class="id"> U</span><span class="id"> -&gt;</span><span class="id"> V</span>)<span class="id">:</span><br/>
&nbsp;&nbsp;<span class="id">{in</span><span class="id"> A,</span><span class="id"> f</span><span class="id"> =1</span><span class="id"> g}</span><span class="id"> &lt;-&gt;</span><span class="id"> sigL</span><span class="id"> f</span><span class="id"> =</span><span class="id"> sigL</span><span class="id"> g</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">split=&gt;</span><span class="id"> [eq_f_g</span><span class="id"> |</span><span class="id"> Rfg</span><span class="id"> u</span><span class="id"> uA];</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> apply/funext</span><span class="id"> =&gt;</span><span class="id"> -[x];</span><span class="id"> apply:</span><span class="id"> eq_f_g</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> have</span><span class="id"> :=</span><span class="id"> congr1</span> (<span class="id">@^~</span> (<span class="id">exist</span><span class="id"> _</span><span class="id"> u</span><span class="id"> uA</span>))<span class="id"> Rfg</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> eq_sigLfunP</span> (<span class="id">f</span><span class="id"> g</span><span class="id"> :</span><span class="id"> {fun</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">{in</span><span class="id"> A,</span><span class="id"> f</span><span class="id"> =1</span><span class="id"> g}</span><span class="id"> &lt;-&gt;</span><span class="id"> sigLfun</span><span class="id"> f</span><span class="id"> =</span><span class="id"> sigLfun</span><span class="id"> g</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> eq_sigLP</span><span class="id"> funP</span><span class="id"> funeqP</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> sigLK</span><span class="id"> :</span><span class="id"> valL_</span><span class="id"> \o</span><span class="id"> sigL</span><span class="id"> =</span><span class="id"> restrict</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> funeq2E</span><span class="id"> =&gt;</span><span class="id"> f</span><span class="id"> u;</span><span class="id"> rewrite</span><span class="id"> /valL_</span><span class="id"> /sigL</span><span class="id"> /restrict</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> oinv_set_val/=;</span><span class="id"> case:</span><span class="id"> ifPn</span><span class="id"> =&gt;</span><span class="id"> uA;</span><span class="id"> [rewrite</span><span class="id"> insubT|rewrite</span><span class="id"> insubN]</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> valLK</span><span class="id"> :</span><span class="id"> cancel</span><span class="id"> valL_</span><span class="id"> sigL</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> f;</span><span class="id"> rewrite</span><span class="id"> /valL_</span><span class="id"> /sigL</span><span class="id"> /restrict</span><span class="id"> oinv_set_val</span>.<br/>
<span class="id">apply/funext=&gt;</span><span class="id"> a</span><span class="id"> /=;</span><span class="id"> have</span><span class="id"> aA</span><span class="id"> :</span><span class="id"> set_val</span><span class="id"> a</span><span class="id"> \in</span><span class="id"> A</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> valP</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> insubT//=;</span><span class="id"> congr</span><span class="id"> f;</span><span class="id"> apply/val_inj</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> valLfunK</span><span class="id"> :</span><span class="id"> cancel</span><span class="id"> valLfun_</span><span class="id"> sigLfun</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> f;</span><span class="id"> apply/funP/funeqP;</span><span class="id"> exact:</span><span class="id"> valLK</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> sigL_valL</span><span class="id"> :</span><span class="id"> sigL</span><span class="id"> \o</span><span class="id"> valL_</span><span class="id"> =</span><span class="id"> id</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id"> exact/funext/valLK</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> sigL_valLfun</span><span class="id"> :</span><span class="id"> sigLfun</span><span class="id"> \o</span><span class="id"> valLfun_</span><span class="id"> =</span><span class="id"> id</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id"> exact/funext/valLfunK</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> sigL_restrict</span><span class="id"> :</span><span class="id"> sigL</span><span class="id"> \o</span><span class="id"> restrict</span><span class="id"> =</span><span class="id"> sigL</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> funeq2E</span><span class="id"> =&gt;</span><span class="id"> f</span><span class="id"> -[u</span><span class="id"> Au]</span><span class="id"> /=</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /sigL</span><span class="id"> /restrict</span><span class="id"> /valL_</span><span class="id"> /patch</span><span class="id"> /=</span><span class="id"> Au</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> image_sigL</span> <span class="id"> :</span><span class="id"> range</span><span class="id"> sigL</span><span class="id"> =</span><span class="id"> setT</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> eqEsubset;</span><span class="id"> split=&gt;</span><span class="id"> //=</span><span class="id"> f</span><span class="id"> _;</span><span class="gallina-kwd"> exists</span> (<span class="id">valL_</span><span class="id"> f</span>)<span class="id">=&gt;//</span>.<br/>
<span class="id">exact:</span><span class="id"> valLK</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> eq_restrictP</span> (<span class="id">f</span><span class="id"> g</span><span class="id"> :</span><span class="id"> U</span><span class="id"> -&gt;</span><span class="id"> V</span>)<span class="id">:</span><span class="id"> {in</span><span class="id"> A,</span><span class="id"> f</span><span class="id"> =1</span><span class="id"> g}</span><span class="id"> &lt;-&gt;</span><span class="id"> restrict</span><span class="id"> f</span><span class="id"> =</span><span class="id"> restrict</span><span class="id"> g</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> eq_sigLP</span><span class="id"> -sigLK/=;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> [-&gt;//|/</span>(<span class="id">can_inj</span><span class="id"> valLK</span>)<span class="id">]</span>. Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> RestrictionLeft</span>.<br/>
<span class="vernacular">Arguments</span><span class="id"> sigL</span><span class="id"> {U</span><span class="id"> V}</span><span class="id"> A</span><span class="id"> f</span><span class="id"> u</span><span class="id"> /</span>.<br/>
<span class="vernacular">Arguments</span><span class="id"> sigLE</span><span class="id"> {U</span><span class="id"> V}</span><span class="id"> A</span><span class="id"> f</span><span class="id"> x</span>.<br/>
<span class="vernacular">Arguments</span><span class="id"> valL_</span><span class="id"> {U</span><span class="id"> V}</span><span class="id"> v</span><span class="id"> {A}</span><span class="id"> f</span><span class="id"> u</span><span class="id"> /</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;''valL_' v&quot;</span><span class="id"> :=</span> (<span class="id">valL_</span><span class="id"> v</span>)<span class="id"> :</span><span class="id"> form_scope</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;''valLfun_' v&quot;</span><span class="id"> :=</span> (<span class="id">valLfun_</span><span class="id"> v</span>)<span class="id"> :</span><span class="id"> form_scope</span>.<br/>
<span class="vernacular">Notation</span><span class="id"> valL</span><span class="id"> :=</span> (<span class="id">valL_</span><span class="id"> point</span>).<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> RestrictionRight</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {U</span><span class="id"> V</span><span class="id"> :</span><span class="id"> Type}</span><span class="id"> {A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> V}</span>.<br/>
<br/>
<span class="vernacular">Definition</span><span class="id"> sigR</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {fun</span><span class="id"> [set:</span><span class="id"> U]</span><span class="id"> &gt;-&gt;</span><span class="id"> A}</span>) (<span class="id">u</span><span class="id"> :</span><span class="id"> U</span>)<span class="id"> :</span><span class="id"> A</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">SigSub</span> (<span class="id">mem_set</span> (<span class="id">'funS_f</span><span class="id"> I</span>)<span class="id"> :</span><span class="id"> f</span><span class="id"> u</span><span class="id"> \in</span><span class="id"> A</span>).<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> f</span><span class="id"> :=</span><span class="id"> Fun</span>.<span class="id">copy</span> (<span class="id">sigR</span><span class="id"> f</span>) (<span class="id">totalfun</span><span class="id"> _</span>).<br/>
<br/>
<span class="vernacular">Definition</span><span class="id"> valR</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> U</span><span class="id"> -&gt;</span><span class="id"> A</span>)<span class="id"> :=</span><span class="id"> set_val</span><span class="id"> \o</span><span class="id"> totalfun</span><span class="id"> f</span>.<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> f</span><span class="id"> :=</span><span class="id"> Fun</span>.<span class="id">on</span> (<span class="id">valR</span><span class="id"> f</span>).<br/>
<br/>
<span class="vernacular">Definition</span><span class="id"> valR_fun</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> U</span><span class="id"> -&gt;</span><span class="id"> A</span>)<span class="id"> :</span><span class="id"> {fun</span><span class="id"> [set:</span><span class="id"> U]</span><span class="id"> &gt;-&gt;</span><span class="id"> A}</span><span class="id"> :=</span><span class="id"> [fun</span><span class="id"> of</span><span class="id"> valR</span><span class="id"> f]</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> sigRK</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {fun</span><span class="id"> [set:</span><span class="id"> U]</span><span class="id"> &gt;-&gt;</span><span class="id"> A}</span>)<span class="id"> :</span><span class="id"> valR</span> (<span class="id">sigR</span><span class="id"> f</span>)<span class="id"> =</span><span class="id"> f</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> []</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> sigR_funK</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {fun</span><span class="id"> [set:</span><span class="id"> U]</span><span class="id"> &gt;-&gt;</span><span class="id"> A}</span>)<span class="id"> :</span><span class="id"> valR_fun</span> (<span class="id">sigR</span><span class="id"> f</span>)<span class="id"> =</span><span class="id"> f</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> apply/funP/funeqP;</span><span class="id"> apply:</span><span class="id"> sigRK</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> valRP</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> U</span><span class="id"> -&gt;</span><span class="id"> A</span>)<span class="id"> x</span><span class="id"> :</span><span class="id"> A</span> (<span class="id">valR</span><span class="id"> f</span><span class="id"> x</span>)<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id"> exact:</span><span class="id"> set_valP</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> valRK</span><span class="id"> :</span><span class="id"> cancel</span><span class="id"> valR_fun</span><span class="id"> sigR</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> f;</span><span class="id"> apply/funext</span><span class="id"> =&gt;</span><span class="id"> x;</span><span class="id"> apply/val_inj</span>. Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> RestrictionRight</span>.<br/>
<span class="vernacular">Arguments</span><span class="id"> sigR</span><span class="id"> {U</span><span class="id"> V</span><span class="id"> A}</span><span class="id"> f</span><span class="id"> u</span><span class="id"> /</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> RestrictionLeftInv</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {U</span><span class="id"> V</span><span class="id"> :</span><span class="id"> Type}</span> (<span class="id">v</span><span class="id"> :</span><span class="id"> V</span>)<span class="id"> {A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> U}</span><span class="id"> {B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> V}</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Notation</span><span class="id"> rl</span><span class="id"> :=</span> (<span class="id">sigL</span><span class="id"> A</span>).<br/>
<span class="vernacular">Local</span><span class="vernacular"> Notation</span><span class="id"> rr</span><span class="id"> :=</span><span class="id"> sigR</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Notation</span><span class="id"> el</span><span class="id"> :=</span><span class="id"> 'valL_v</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Notation</span><span class="id"> er</span><span class="id"> :=</span><span class="id"> valR</span>.<br/>
<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {oinv</span><span class="id"> U</span><span class="id"> &gt;-&gt;</span><span class="id"> V}</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">@OInv</span>.<span class="id">Build</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">rl</span><span class="id"> f</span>) (<span class="id">obind</span><span class="id"> insub</span><span class="id"> \o</span><span class="id"> 'oinv_f</span>).<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {oinvfun</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<span class="id"> :=</span><span class="id"> Fun</span>.<span class="id">on</span> (<span class="id">rl</span><span class="id"> f</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> oinv_sigL</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {oinv</span><span class="id"> U</span><span class="id"> &gt;-&gt;</span><span class="id"> V}</span>)<span class="id"> :</span><span class="id"> 'oinv_</span>(<span class="id">rl</span><span class="id"> f</span>)<span class="id"> =</span><span class="id"> obind</span><span class="id"> insub</span><span class="id"> \o</span><span class="id"> 'oinv_f</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> []</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> sigL_inj_subproof</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {inj</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> V}</span>)<span class="id"> :</span><span class="id"> @OInv_Can</span><span class="id"> _</span><span class="id"> _</span><span class="id"> setT</span> (<span class="id">rl</span><span class="id"> f</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd">by</span><span class="id"> split=&gt;</span><span class="id"> x</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> oinv_sigL/=</span><span class="id"> funoK//=</span><span class="id"> [insub</span><span class="id"> _]'funoK_val</span><span class="id"> ?inE</span>.<br/>
Qed.</div></details>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> f</span><span class="id"> :=</span><span class="id"> sigL_inj_subproof</span><span class="id"> f</span>.<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {injfun</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<span class="id"> :=</span><span class="id"> Fun</span>.<span class="id">on</span> (<span class="id">rl</span><span class="id"> f</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> sigL_surj_subproof</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {surj</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<span class="id"> :</span><span class="id"> @OInv_CanV</span><span class="id"> _</span><span class="id"> _</span><span class="id"> setT</span><span class="id"> B</span> (<span class="id">rl</span><span class="id"> f</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">split=&gt;</span><span class="id"> [b|b</span><span class="id"> /set_mem]</span><span class="id"> Bb;</span><span class="id"> rewrite</span><span class="id"> ?oinv_sigL/=</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="id">have</span><span class="id"> [x</span><span class="id"> /mem_set</span><span class="id"> Ax</span><span class="id"> &lt;-]/=</span><span class="id"> :=</span><span class="id"> 'oinvS_f</span><span class="id"> Bb;</span><span class="gallina-kwd"> exists</span> (<span class="id">SigSub</span><span class="id"> Ax</span>)<span class="id"> =&gt;</span><span class="id"> //=</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="id">case:</span><span class="id"> insubP</span><span class="id"> =&gt;</span><span class="id"> [a</span><span class="id"> Aa/=</span><span class="id"> eqx|];</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> Ax</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> congr</span><span class="id"> Some;</span><span class="id"> apply/val_inj</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /rl/=</span><span class="id"> oapp_comp/=</span><span class="id"> -oinv_val</span><span class="id"> -inv_omap/=</span><span class="id"> invK</span><span class="id"> ?oinvK</span><span class="id"> ?mem_fun</span><span class="id"> ?inE</span>.<br/>
Qed.</div></details>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> f</span><span class="id"> :=</span><span class="id"> sigL_surj_subproof</span><span class="id"> f</span>.<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {surjfun</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<span class="id"> :=</span><span class="id"> Fun</span>.<span class="id">on</span> (<span class="id">rl</span><span class="id"> f</span>).<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {bij</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<span class="id"> :=</span><span class="id"> Fun</span>.<span class="id">on</span> (<span class="id">rl</span><span class="id"> f</span>).<br/>
<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {oinvfun</span><span class="id"> [set:</span><span class="id"> V]</span><span class="id"> &gt;-&gt;</span><span class="id"> A}</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">@OInv</span>.<span class="id">Build</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">rr</span><span class="id"> f</span>) (<span class="id">rl</span><span class="id"> 'oinv_f</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> oinv_sigR</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {oinvfun</span><span class="id"> [set:</span><span class="id"> V]</span><span class="id"> &gt;-&gt;</span><span class="id"> A}</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">'oinv_</span>(<span class="id">rr</span><span class="id"> f</span>)<span class="id"> =</span> (<span class="id">rl</span><span class="id"> 'oinv_f</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> []</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> sigR_inj_subproof</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {injfun</span><span class="id"> [set:</span><span class="id"> V]</span><span class="id"> &gt;-&gt;</span><span class="id"> A}</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id">@OInv_Can</span><span class="id"> _</span><span class="id"> _</span><span class="id"> setT</span> (<span class="id">rr</span><span class="id"> f</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> split=&gt;</span><span class="id"> x</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> oinv_sigR/=</span><span class="id"> set_valE/=</span><span class="id"> funoK</span><span class="id"> ?inE</span>. Qed.</div></details>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> f</span><span class="id"> :=</span><span class="id"> sigR_inj_subproof</span><span class="id"> f</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> sigR_surj_subproof</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {surjfun</span><span class="id"> [set:</span><span class="id"> V]</span><span class="id"> &gt;-&gt;</span><span class="id"> A}</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">@OInv_CanV</span><span class="id"> _</span><span class="id"> _</span><span class="id"> setT</span><span class="id"> setT</span> (<span class="id">rr</span><span class="id"> f</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">split=&gt;</span><span class="id"> a</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> ?oinv_sigL/=</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> have</span><span class="id"> [x</span><span class="id"> _</span><span class="id"> xeq]</span><span class="id"> :=</span><span class="id"> 'oinvS_f</span> (<span class="id">set_valP</span><span class="id"> a</span>)<span class="id">;</span><span class="gallina-kwd"> exists</span><span class="id"> x</span>.<br/>
<span class="id">apply/val_inj=&gt;</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> oinv_sigR/=</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> case:</span><span class="id"> oinvP=&gt;</span><span class="id"> //=;</span><span class="id"> apply:</span><span class="id"> set_valP</span>.<br/>
Qed.</div></details>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> f</span><span class="id"> :=</span><span class="id"> sigR_surj_subproof</span><span class="id"> f</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> sigR_some_inv</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {invfun</span><span class="id"> [set:</span><span class="id"> V]</span><span class="id"> &gt;-&gt;</span><span class="id"> A}</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">olift</span> (<span class="id">rl</span><span class="id"> f^-1</span>)<span class="id"> =</span><span class="id"> 'oinv_</span>(<span class="id">rr</span><span class="id"> f</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> oinv_sigR</span><span class="id"> olift_comp</span><span class="id"> oliftV</span>. Qed.</div></details>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {bij</span><span class="id"> [set:</span><span class="id"> V]</span><span class="id"> &gt;-&gt;</span><span class="id"> A}</span>)<span class="id"> :=</span><span class="id"> Fun</span>.<span class="id">on</span> (<span class="id">rr</span><span class="id"> f</span>).<br/>
<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {invfun</span><span class="id"> [set:</span><span class="id"> V]</span><span class="id"> &gt;-&gt;</span><span class="id"> A}</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id">@OInv_Inv</span>.<span class="id">Build</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">rr</span><span class="id"> f</span>) (<span class="id">rl</span><span class="id"> f^-1</span>) (<span class="id">sigR_some_inv</span><span class="id"> f</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> inv_sigR</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {invfun</span><span class="id"> [set:</span><span class="id"> V]</span><span class="id"> &gt;-&gt;</span><span class="id"> A}</span>)<span class="id"> :</span> (<span class="id">rr</span><span class="id"> f</span>)<span class="id">^-1</span><span class="id"> =</span> (<span class="id">rl</span><span class="id"> f^-1</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> []</span>. Qed.</div></details>
<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {splitinjfun</span><span class="id"> [set:</span><span class="id"> V]</span><span class="id"> &gt;-&gt;</span><span class="id"> A}</span>)<span class="id"> :=</span><span class="id"> Inject</span>.<span class="id">on</span> (<span class="id">rr</span><span class="id"> f</span>).<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {splitsurjfun</span><span class="id"> [set:</span><span class="id"> V]</span><span class="id"> &gt;-&gt;</span><span class="id"> A}</span>)<span class="id"> :=</span><span class="id"> Surject</span>.<span class="id">on</span> (<span class="id">rr</span><span class="id"> f</span>).<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {splitbij</span><span class="id"> [set:</span><span class="id"> V]</span><span class="id"> &gt;-&gt;</span><span class="id"> A}</span>)<span class="id"> :=</span><span class="id"> Fun</span>.<span class="id">on</span> (<span class="id">rr</span><span class="id"> f</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> sigL_some_inv</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {splitbij</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> [set:</span><span class="id"> V]}</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">olift</span> (<span class="id">rr</span><span class="id"> [fun</span><span class="id"> of</span><span class="id"> f^-1]</span>)<span class="id"> =</span><span class="id"> 'oinv_</span>(<span class="id">rl</span><span class="id"> f</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">apply/funext=&gt;</span><span class="id"> x</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> oinv_sigL</span><span class="id"> /=</span><span class="id"> /sigR/=</span><span class="id"> /olift/=</span>.<br/>
<span class="id">case:</span><span class="id"> oinvP</span><span class="id"> =&gt;</span><span class="id"> //=</span><span class="id"> u</span><span class="id"> Au</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> insubT</span><span class="id"> ?inE//</span><span class="id"> =&gt;</span><span class="id"> memAu</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> congr</span> (<span class="id">Some</span><span class="id"> _</span>)<span class="id">;</span><span class="id"> apply/val_inj=&gt;</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> funK</span>.<br/>
Qed.</div></details>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {splitbij</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> [set:</span><span class="id"> V]}</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">OInv_Inv</span>.<span class="id">Build</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">rl</span><span class="id"> f</span>) (<span class="id">sigL_some_inv</span><span class="id"> f</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> inv_sigL</span>  (<span class="id">f</span><span class="id"> :</span><span class="id"> {splitbij</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> [set:</span><span class="id"> V]}</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;(<span class="id">rl</span><span class="id"> f</span>)<span class="id">^-1</span><span class="id"> =</span> (<span class="id">rr</span><span class="id"> [fun</span><span class="id"> of</span><span class="id"> f^-1]</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> []</span>. Qed.</div></details>
<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {oinv</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> V}</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">@OInv</span>.<span class="id">Build</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">el</span><span class="id"> f</span>) (<span class="id">omap</span><span class="id"> set_val</span><span class="id"> \o</span><span class="id"> 'oinv_f</span>).<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {oinvfun</span><span class="id"> [set:</span><span class="id"> A]</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<span class="id"> :=</span><span class="id"> Fun</span>.<span class="id">on</span> (<span class="id">el</span><span class="id"> f</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> oinv_valL</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {oinv</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> V}</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">'oinv_</span>(<span class="id">el</span><span class="id"> f</span>)<span class="id"> =</span><span class="id"> omap</span><span class="id"> set_val</span><span class="id"> \o</span><span class="id"> 'oinv_f</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> []</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> oapp_comp_x</span><span class="id"> {aT</span><span class="id"> rT</span><span class="id"> sT}</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> aT</span><span class="id"> -&gt;</span><span class="id"> rT</span>) (<span class="id">g</span><span class="id"> :</span><span class="id"> rT</span><span class="id"> -&gt;</span><span class="id"> sT</span>) (<span class="id">x</span><span class="id"> :</span><span class="id"> rT</span>)<span class="id"> y</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">oapp</span> (<span class="id">g</span><span class="id"> \o</span><span class="id"> f</span>) (<span class="id">g</span><span class="id"> x</span>)<span class="id"> y</span><span class="id"> =</span><span class="id"> g</span> (<span class="id">oapp</span><span class="id"> f</span><span class="id"> x</span><span class="id"> y</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> case:</span><span class="id"> y</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> valL_inj_subproof</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {inj</span><span class="id"> [set:</span><span class="id"> A]</span><span class="id"> &gt;-&gt;</span><span class="id"> V}</span>)<span class="id"> :</span><span class="id"> @OInv_Can</span><span class="id"> _</span><span class="id"> _</span><span class="id"> A</span> (<span class="id">el</span><span class="id"> f</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">split=&gt;</span><span class="id"> x</span><span class="id"> /set_mem</span><span class="id"> xA;</span><span class="id"> rewrite</span><span class="id"> oinv_valL/=</span><span class="id"> -oapp_comp_x</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> case:</span><span class="id"> oinvP=&gt;</span><span class="id"> //=</span><span class="id"> a</span><span class="id"> _</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> funoK</span><span class="id"> ?inE</span>.<br/>
Qed.</div></details>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> f</span><span class="id"> :=</span><span class="id"> valL_inj_subproof</span><span class="id"> f</span>.<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {injfun</span><span class="id"> [set:</span><span class="id"> A]</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<span class="id"> :=</span><span class="id"> Inject</span>.<span class="id">on</span> (<span class="id">el</span><span class="id"> f</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> valL_surj_subproof</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {surj</span><span class="id"> [set:</span><span class="id"> A]</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<span class="id"> :</span><span class="id"> @OInv_CanV</span><span class="id"> _</span><span class="id"> _</span><span class="id"> A</span><span class="id"> B</span> (<span class="id">el</span><span class="id"> f</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">split=&gt;</span><span class="id"> [b|b</span><span class="id"> /set_mem]</span><span class="id"> Bb;</span><span class="id"> rewrite</span><span class="id"> ?oinv_valL/=</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> case:</span><span class="id"> oinvP</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> =&gt;</span><span class="id"> a;</span><span class="gallina-kwd"> exists</span> (<span class="id">set_val</span><span class="id"> a</span>)<span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> apply:</span><span class="id"> set_valP</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> case:</span><span class="id"> oinvP</span><span class="id"> =&gt;</span><span class="id"> //=</span><span class="id"> a</span><span class="id"> _</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> funoK//</span><span class="id"> inE</span>.<br/>
Qed.</div></details>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> f</span><span class="id"> :=</span><span class="id"> valL_surj_subproof</span><span class="id"> f</span>.<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {surjfun</span><span class="id"> [set:</span><span class="id"> A]</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<span class="id"> :=</span><span class="id"> Surject</span>.<span class="id">on</span> (<span class="id">el</span><span class="id"> f</span>).<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {bij</span><span class="id"> [set:</span><span class="id"> A]</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<span class="id"> :=</span><span class="id"> Surject</span>.<span class="id">on</span> (<span class="id">el</span><span class="id"> f</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> valL_some_inv</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {inv</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> V}</span>)<span class="id"> :</span><span class="id"> olift</span> (<span class="id">er</span><span class="id"> f^-1</span>)<span class="id"> =</span><span class="id"> 'oinv_</span>(<span class="id">el</span><span class="id"> f</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> oinv_valL/=</span><span class="id"> olift_comp</span><span class="id"> -oliftV</span>. Qed.</div></details>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {inv</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> V}</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">OInv_Inv</span>.<span class="id">Build</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">el</span><span class="id"> f</span>) (<span class="id">valL_some_inv</span><span class="id"> f</span>).<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {invfun</span><span class="id"> [set:</span><span class="id"> A]</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<span class="id"> :=</span><span class="id"> Fun</span>.<span class="id">on</span> (<span class="id">el</span><span class="id"> f</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> inv_valL</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {inv</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> V}</span>)<span class="id"> :</span> (<span class="id">el</span><span class="id"> f</span>)<span class="id">^-1</span><span class="id"> =</span><span class="id"> er</span><span class="id"> f^-1</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> []</span>. Qed.</div></details>
<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {splitinj</span><span class="id"> [set:</span><span class="id"> A]</span><span class="id"> &gt;-&gt;</span><span class="id"> V}</span>)<span class="id"> :=</span><span class="id"> Inject</span>.<span class="id">on</span> (<span class="id">el</span><span class="id"> f</span>).<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {splitinjfun</span><span class="id"> [set:</span><span class="id"> A]</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<span class="id"> :=</span><span class="id"> Fun</span>.<span class="id">on</span> (<span class="id">el</span><span class="id"> f</span>).<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {splitsurj</span><span class="id"> [set:</span><span class="id"> A]</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<span class="id"> :=</span><span class="id"> Surject</span>.<span class="id">on</span> (<span class="id">el</span><span class="id"> f</span>).<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {splitsurjfun</span><span class="id"> [set:</span><span class="id"> A]</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<span class="id"> :=</span><span class="id"> Fun</span>.<span class="id">on</span> (<span class="id">el</span><span class="id"> f</span>).<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {splitbij</span><span class="id"> [set:</span><span class="id"> A]</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<span class="id"> :=</span><span class="id"> Fun</span>.<span class="id">on</span> (<span class="id">el</span><span class="id"> f</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> sigL_injP</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> U</span><span class="id"> -&gt;</span><span class="id"> V</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">injective</span> (<span class="id">rl</span><span class="id"> f</span>)<span class="id"> &lt;-&gt;</span><span class="id"> {in</span><span class="id"> A</span><span class="id"> &amp;,</span><span class="id"> injective</span><span class="id"> f}</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">split=&gt;</span><span class="id"> [f_inj</span><span class="id"> x</span><span class="id"> y</span><span class="id"> Ax</span><span class="id"> Ay|/Pinj[{}f-&gt;</span><span class="id"> //]];</span><span class="id"> last</span><span class="id"> first</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> eqfxy;</span><span class="id"> suff</span><span class="id"> [-&gt;]</span><span class="id"> :</span><span class="id"> SigSub</span><span class="id"> Ax</span><span class="id"> =</span><span class="id"> SigSub</span><span class="id"> Ay</span><span class="gallina-kwd"> by</span><span class="id"> [];</span><span class="id"> apply:</span><span class="id"> f_inj</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> sigL_surjP</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> U</span><span class="id"> -&gt;</span><span class="id"> V</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">set_surj</span><span class="id"> [set:</span><span class="id"> A]</span><span class="id"> B</span> (<span class="id">rl</span><span class="id"> f</span>)<span class="id"> &lt;-&gt;</span><span class="id"> set_surj</span><span class="id"> A</span><span class="id"> B</span><span class="id"> f</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">split=&gt;</span><span class="id"> [fsurj</span><span class="id"> b</span><span class="id"> Bb/=|/Psurj[{}f-&gt;]//]</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> have</span><span class="id"> [a</span><span class="id"> _</span><span class="id"> &lt;-]</span><span class="id"> :=</span><span class="id"> fsurj</span><span class="id"> _</span><span class="id"> Bb;</span><span class="gallina-kwd"> exists</span> (<span class="id">set_val</span><span class="id"> a</span>)<span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> apply:</span><span class="id"> set_valP</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> sigL_funP</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> U</span><span class="id"> -&gt;</span><span class="id"> V</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">set_fun</span><span class="id"> [set:</span><span class="id"> A]</span><span class="id"> B</span> (<span class="id">rl</span><span class="id"> f</span>)<span class="id"> &lt;-&gt;</span><span class="id"> set_fun</span><span class="id"> A</span><span class="id"> B</span><span class="id"> f</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">split=&gt;</span><span class="id"> [ffun</span><span class="id"> u</span><span class="id"> Au/=|/Pfun[{}f-&gt;]//]</span>.<br/>
<span class="id">exact:</span> (<span class="id">ffun</span> (<span class="id">SigSub</span> (<span class="id">mem_set</span><span class="id"> Au</span>))).<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> sigL_bijP</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> U</span><span class="id"> -&gt;</span><span class="id"> V</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">set_bij</span><span class="id"> [set:</span><span class="id"> A]</span><span class="id"> B</span> (<span class="id">rl</span><span class="id"> f</span>)<span class="id"> &lt;-&gt;</span><span class="id"> set_bij</span><span class="id"> A</span><span class="id"> B</span><span class="id"> f</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">split=&gt;</span><span class="id"> [[F</span><span class="id"> /in2TT</span><span class="id"> I</span><span class="id"> S]|/Pbij[{}f-&gt;]//]</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> split;</span><span class="id"> [exact/sigL_funP|exact/sigL_injP|exact/sigL_surjP]</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> valL_injP</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> A</span><span class="id"> -&gt;</span><span class="id"> V</span>)<span class="id"> :</span><span class="id"> {in</span><span class="id"> A</span><span class="id"> &amp;,</span><span class="id"> injective</span> (<span class="id">el</span><span class="id"> f</span>)<span class="id">}</span><span class="id"> &lt;-&gt;</span><span class="id"> injective</span><span class="id"> f</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> -sigL_injP</span><span class="id"> valLK</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> valL_surjP</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> A</span><span class="id"> -&gt;</span><span class="id"> V</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">set_surj</span><span class="id"> A</span><span class="id"> B</span> (<span class="id">el</span><span class="id"> f</span>)<span class="id"> &lt;-&gt;</span><span class="id"> set_surj</span><span class="id"> setT</span><span class="id"> B</span><span class="id"> f</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> -sigL_surjP</span><span class="id"> valLK</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> valLfunP</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> A</span><span class="id"> -&gt;</span><span class="id"> V</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">set_fun</span><span class="id"> A</span><span class="id"> B</span> (<span class="id">el</span><span class="id"> f</span>)<span class="id"> &lt;-&gt;</span><span class="id"> set_fun</span><span class="id"> setT</span><span class="id"> B</span><span class="id"> f</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> -sigL_funP</span><span class="id"> valLK</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> valL_bijP</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> A</span><span class="id"> -&gt;</span><span class="id"> V</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">set_bij</span><span class="id"> A</span><span class="id"> B</span> (<span class="id">el</span><span class="id"> f</span>)<span class="id"> &lt;-&gt;</span><span class="id"> set_bij</span><span class="id"> setT</span><span class="id"> B</span><span class="id"> f</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> -sigL_bijP</span><span class="id"> valLK</span>. Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> RestrictionLeftInv</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> ExtentionLeftInv</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {U</span><span class="id"> V</span><span class="id"> :</span><span class="id"> Type}</span><span class="id"> {A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> U}</span><span class="id"> {B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> V}</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Notation</span><span class="id"> el</span><span class="id"> :=</span><span class="id"> 'valL_None</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Notation</span><span class="id"> er</span><span class="id"> :=</span><span class="id"> valR</span>.<br/>
<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {oinv</span><span class="id"> V</span><span class="id"> &gt;-&gt;</span><span class="id"> A}</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">@OInv</span>.<span class="id">Build</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">er</span><span class="id"> f</span>) (<span class="id">el</span><span class="id"> 'oinv_f</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> oinv_valR</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {oinv</span><span class="id"> V</span><span class="id"> &gt;-&gt;</span><span class="id"> A}</span>)<span class="id"> :</span><span class="id"> 'oinv_</span>(<span class="id">er</span><span class="id"> f</span>)<span class="id"> =</span> (<span class="id">el</span><span class="id"> 'oinv_f</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> []</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> valR_inj_subproof</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {inj</span><span class="id"> [set:</span><span class="id"> V]</span><span class="id"> &gt;-&gt;</span><span class="id"> A}</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id">@OInv_Can</span><span class="id"> _</span><span class="id"> _</span><span class="id"> setT</span> (<span class="id">er</span><span class="id"> f</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> split=&gt;</span><span class="id"> x</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> /er</span><span class="id"> oinv_valR/=</span><span class="id"> funoK/=</span><span class="id"> ?funoK</span><span class="id"> ?inE</span>. Qed.</div></details>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> f</span><span class="id"> :=</span><span class="id"> valR_inj_subproof</span><span class="id"> f</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> valR_surj_subproof</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {surj</span><span class="id"> [set:</span><span class="id"> V]</span><span class="id"> &gt;-&gt;</span><span class="id"> [set:</span><span class="id"> A]}</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">@OInv_CanV</span><span class="id"> _</span><span class="id"> _</span><span class="id"> setT</span><span class="id"> A</span> (<span class="id">er</span><span class="id"> f</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">split=&gt;</span><span class="id"> [a|a</span><span class="id"> /set_mem]</span><span class="id"> Aa;</span><span class="id"> rewrite</span><span class="id"> ?oinv_valR/=</span><span class="id"> oinv_set_val</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> insubT</span><span class="id"> ?inE//</span><span class="id"> =&gt;</span><span class="id"> memaA</span><span class="id"> /=;</span><span class="id"> case:</span><span class="id"> oinvP</span><span class="id"> =&gt;</span><span class="id"> //=</span><span class="id"> x;</span><span class="gallina-kwd"> exists</span><span class="id"> x</span>.<br/>
<span class="id">rewrite</span><span class="id"> insubT</span><span class="id"> ?inE//</span><span class="id"> =&gt;</span><span class="id"> memaA/=;</span><span class="id"> case:</span><span class="id"> oinvP</span><span class="id"> =&gt;</span><span class="id"> //=</span><span class="id"> x</span><span class="id"> _</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /er/=</span><span class="id"> /totalfun</span><span class="id"> =&gt;</span><span class="id"> -&gt;</span>.<br/>
Qed.</div></details>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> f</span><span class="id"> :=</span><span class="id"> valR_surj_subproof</span><span class="id"> f</span>.<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {bij</span><span class="id"> [set:</span><span class="id"> V]</span><span class="id"> &gt;-&gt;</span><span class="id"> [set:</span><span class="id"> A]}</span>)<span class="id"> :=</span><span class="id"> Fun</span>.<span class="id">on</span> (<span class="id">er</span><span class="id"> f</span>).<br/>
<br/>
<span class="vernacular">End</span><span class="id"> ExtentionLeftInv</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> Restrictions2</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {U</span><span class="id"> V</span><span class="id"> :</span><span class="id"> Type}</span> (<span class="id">v</span><span class="id"> :</span><span class="id"> V</span>)<span class="id"> {A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> U}</span><span class="id"> {B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> V}</span>.<br/>
<br/>
<span class="vernacular">Local</span><span class="vernacular"> Notation</span><span class="id"> valL</span><span class="id"> :=</span><span class="id"> 'valL_v</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Notation</span><span class="id"> valLfun</span><span class="id"> :=</span><span class="id"> 'valLfun_v</span>.<br/>
<br/>
<span class="vernacular">Definition</span><span class="id"> sigLR</span><span class="id"> :=</span><span class="id"> sigR</span><span class="id"> \o</span> (<span class="id">@sigLfun</span><span class="id"> U</span><span class="id"> V</span><span class="id"> A</span><span class="id"> B</span>).<br/>
<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {fun</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">Fun</span>.<span class="id">copy</span> (<span class="id">sigLR</span><span class="id"> f</span>) (<span class="id">totalfun</span><span class="id"> _</span>).<br/>
<br/>
<span class="vernacular">Definition</span><span class="id"> valLR</span><span class="id"> :</span> (<span class="id">A</span><span class="id"> -&gt;</span><span class="id"> B</span>)<span class="id"> -&gt;</span><span class="id"> U</span><span class="id"> -&gt;</span><span class="id"> V</span><span class="id"> :=</span><span class="id"> valL</span><span class="id"> \o</span><span class="id"> valR_fun</span>.<br/>
<span class="vernacular">Definition</span><span class="id"> valLRfun</span><span class="id"> :</span> (<span class="id">A</span><span class="id"> -&gt;</span><span class="id"> B</span>)<span class="id"> -&gt;</span><span class="id"> {fun</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span><span class="id"> :=</span><span class="id"> valLfun</span><span class="id"> \o</span><span class="id"> valR_fun</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> valLRE</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> A</span><span class="id"> -&gt;</span><span class="id"> B</span>)<span class="id"> :</span><span class="id"> valLR</span><span class="id"> f</span><span class="id"> =</span><span class="id"> valL</span> (<span class="id">valR</span><span class="id"> f</span>)<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> []</span>. Qed.</div></details>
<span class="vernacular">Lemma</span><span class="id"> valLRfunE</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> A</span><span class="id"> -&gt;</span><span class="id"> B</span>)<span class="id"> :</span><span class="id"> valLRfun</span><span class="id"> f</span><span class="id"> =</span><span class="id"> [fun</span><span class="id"> of</span><span class="id"> valLR</span><span class="id"> f]</span><br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> []</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> sigL2K</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {fun</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<span class="id"> :</span><span class="id"> {in</span><span class="id"> A,</span><span class="id"> valLR</span> (<span class="id">sigLR</span><span class="id"> f</span>)<span class="id"> =1</span><span class="id"> f}</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> apply/eq_sigLP;</span><span class="id"> rewrite</span><span class="id"> valLK</span><span class="id"> sigR_funK</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> valLRK</span><span class="id"> :</span><span class="id"> cancel</span><span class="id"> valLRfun</span><span class="id"> sigLR</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> f;</span><span class="id"> rewrite</span><span class="id"> /sigLR</span><span class="id"> /valLR</span><span class="id"> /=</span><span class="id"> valLfunK</span><span class="id"> valRK</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> valLRfun_inj</span><span class="id"> :</span><span class="id"> injective</span><span class="id"> valLRfun</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> f</span><span class="id"> g</span><span class="id"> eqefg;</span><span class="id"> rewrite</span><span class="id"> -[LHS]valLRK</span><span class="id"> eqefg</span><span class="id"> valLRK</span>. Qed.</div></details>
<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {oinvfun</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<span class="id"> :=</span><span class="id"> OInversible</span>.<span class="id">on</span> (<span class="id">sigLR</span><span class="id"> f</span>).<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {injfun</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<span class="id"> :=</span><span class="id"> Inject</span>.<span class="id">on</span> (<span class="id">sigLR</span><span class="id"> f</span>).<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {surjfun</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<span class="id"> :=</span><span class="id"> Surject</span>.<span class="id">on</span> (<span class="id">sigLR</span><span class="id"> f</span>).<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {bij</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<span class="id"> :=</span><span class="id"> Fun</span>.<span class="id">on</span> (<span class="id">sigLR</span><span class="id"> f</span>).<br/>
<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {oinv</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<span class="id"> :=</span><span class="id"> OInvFun</span>.<span class="id">on</span> (<span class="id">valLR</span><span class="id"> f</span>).<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {inj</span><span class="id"> [set:</span><span class="id"> A]</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<span class="id"> :=</span><span class="id"> Inject</span>.<span class="id">on</span> (<span class="id">valLR</span><span class="id"> f</span>).<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {surj</span><span class="id"> [set:</span><span class="id"> A]</span><span class="id"> &gt;-&gt;</span><span class="id"> [set:</span><span class="id"> B]}</span>)<span class="id"> :=</span><span class="id"> Surject</span>.<span class="id">on</span> (<span class="id">valLR</span><span class="id"> f</span>).<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {bij</span><span class="id"> [set:</span><span class="id"> A]</span><span class="id"> &gt;-&gt;</span><span class="id"> [set:</span><span class="id"> B]}</span>)<span class="id"> :=</span><span class="id"> Fun</span>.<span class="id">on</span> (<span class="id">valLR</span><span class="id"> f</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> sigLR_injP</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {fun</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">injective</span> (<span class="id">sigLR</span><span class="id"> f</span>)<span class="id"> &lt;-&gt;</span><span class="id"> {in</span><span class="id"> A</span><span class="id"> &amp;,</span><span class="id"> injective</span><span class="id"> f}</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">split=&gt;</span><span class="id"> [f_inj</span><span class="id"> x</span><span class="id"> y</span><span class="id"> Ax</span><span class="id"> Ay|/funPinj[{}f-&gt;</span><span class="id"> //]];</span><span class="id"> last</span><span class="id"> first</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> eqfxy;</span><span class="id"> suff</span><span class="id"> [-&gt;]</span><span class="id"> :</span><span class="id"> SigSub</span><span class="id"> Ax</span><span class="id"> =</span><span class="id"> SigSub</span><span class="id"> Ay</span><span class="gallina-kwd"> by</span><span class="id"> []</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> f_inj;</span><span class="id"> apply/val_inj</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> valLR_injP</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> A</span><span class="id"> -&gt;</span><span class="id"> B</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">{in</span><span class="id"> A</span><span class="id"> &amp;,</span><span class="id"> injective</span> (<span class="id">valLR</span><span class="id"> f</span>)<span class="id">}</span><span class="id"> &lt;-&gt;</span><span class="id"> injective</span><span class="id"> f</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> -sigLR_injP</span><span class="id"> valLRK</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> sigLR_surjP</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {fun</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">set_surj</span><span class="id"> setT</span><span class="id"> setT</span> (<span class="id">sigLR</span><span class="id"> f</span>)<span class="id"> &lt;-&gt;</span><span class="id"> set_surj</span><span class="id"> A</span><span class="id"> B</span><span class="id"> f</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">split=&gt;</span><span class="id"> [fsurj</span><span class="id"> b</span><span class="id"> Bb/=|/funPsurj[{}f-&gt;]//]</span>.<br/>
<span class="id">have</span><span class="id"> [x</span><span class="id"> _</span><span class="id"> /</span>(<span class="id">congr1</span><span class="id"> val</span>)<span class="id">/=</span><span class="id"> &lt;-]</span><span class="id"> :=</span><span class="id"> fsurj</span> (<span class="id">SigSub</span> (<span class="id">mem_set</span><span class="id"> Bb</span>))<span class="id"> I</span>.<br/>
<span class="gallina-kwd">by</span><span class="gallina-kwd"> exists</span> (<span class="id">set_val</span><span class="id"> x</span>)<span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> apply:</span><span class="id"> set_valP</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> valLR_surjP</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> A</span><span class="id"> -&gt;</span><span class="id"> B</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">set_surj</span><span class="id"> A</span><span class="id"> B</span> (<span class="id">valLR</span><span class="id"> f</span>)<span class="id"> &lt;-&gt;</span><span class="id"> set_surj</span><span class="id"> setT</span><span class="id"> setT</span><span class="id"> f</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> -sigLR_surjP</span><span class="id"> valLRK</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> sigLR_bijP</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> U</span><span class="id"> -&gt;</span><span class="id"> V</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">set_bij</span><span class="id"> A</span><span class="id"> B</span><span class="id"> f</span><span class="id"> &lt;-&gt;</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">exists</span> (<span class="id">fAB</span><span class="id"> :</span><span class="id"> {homo</span><span class="id"> f</span><span class="id"> :</span><span class="id"> x</span><span class="id"> /</span><span class="id"> A</span><span class="id"> x</span><span class="id"> &gt;-&gt;</span><span class="id"> B</span><span class="id"> x}</span>)<span class="id">,</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">bijective</span> (<span class="id">sigLR</span><span class="id"> [fun</span><span class="id"> of</span><span class="id"> mkfun</span><span class="id"> fAB]</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">split=&gt;</span><span class="id"> [[F</span><span class="id"> I</span><span class="id"> S]|[fAB]]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">exists</span><span class="id"> F;</span><span class="id"> rewrite</span><span class="id"> -setTT_bijective</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> split;</span><span class="id"> [|apply:</span><span class="id"> in2W;</span><span class="id"> apply/sigLR_injP|apply/sigLR_surjP]</span>.<br/>
<span class="id">rewrite</span><span class="id"> -setTT_bijective</span><span class="id"> /set_bij</span>.<br/>
<span class="id">set</span><span class="id"> g</span><span class="id"> :=</span><span class="id"> [fun</span><span class="id"> of</span><span class="id"> mkfun</span><span class="id"> fAB]</span><span class="id"> =&gt;</span><span class="id"> -[_</span><span class="id"> /in2TT</span><span class="id"> I</span><span class="id"> S];</span><span class="id"> pose</span><span class="id"> h</span><span class="id"> :</span><span class="id"> _</span><span class="id"> -&gt;</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> g</span>.<br/>
<span class="id">rewrite</span><span class="id"> -[f]/h</span><span class="id"> {}/h;</span><span class="id"> move:</span><span class="id"> g</span><span class="id"> =&gt;</span><span class="id"> g</span><span class="gallina-kwd"> in</span><span class="id"> I</span><span class="id"> S</span><span class="id"> *</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> split;</span><span class="id"> [apply/image_subP|apply/sigLR_injP|apply/sigLR_surjP]</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> sigLRfun_bijP</span><span class="id"> f</span><span class="id"> :</span><span class="id"> bijective</span> (<span class="id">sigLR</span><span class="id"> f</span>)<span class="id"> &lt;-&gt;</span><span class="id"> set_bij</span><span class="id"> A</span><span class="id"> B</span><span class="id"> f</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> sigLR_bijP;</span><span class="id"> split=&gt;</span><span class="id"> [fbij|[fAB]];</span><span class="id"> [exists</span><span class="id"> funS|];</span><br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span> (_<span class="id"> :</span><span class="id"> [fun</span><span class="id"> of</span><span class="id"> _]</span><span class="id"> =</span><span class="id"> f</span>)<span class="id">//;</span><span class="id"> apply/funP</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> valLR_bijP</span><span class="id"> f</span><span class="id"> :</span><span class="id"> set_bij</span><span class="id"> A</span><span class="id"> B</span> (<span class="id">valLR</span><span class="id"> f</span>)<span class="id"> &lt;-&gt;</span><span class="id"> bijective</span><span class="id"> f</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> -sigLRfun_bijP</span><span class="id"> valLRK</span>. Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> Restrictions2</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> set_bij_basic_lemmas</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {aT</span><span class="id"> rT</span><span class="id"> :</span><span class="id"> Type}</span>.<br/>
<span class="vernacular">Implicit</span><span class="id"> Types</span> (<span class="id">A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT</span>) (<span class="id">B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> rT</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> aT</span><span class="id"> -&gt;</span><span class="id"> rT</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> eq_set_bijRL</span><span class="id"> A</span><span class="id"> B</span><span class="id"> f</span><span class="id"> g</span><span class="id"> :</span><span class="id"> {in</span><span class="id"> A,</span><span class="id"> f</span><span class="id"> =1</span><span class="id"> g}</span><span class="id"> -&gt;</span><span class="id"> set_bij</span><span class="id"> A</span><span class="id"> B</span><span class="id"> f</span><span class="id"> -&gt;</span><span class="id"> set_bij</span><span class="id"> A</span><span class="id"> B</span><span class="id"> g</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> /eq_sigLP</span><span class="id"> +</span><span class="id"> /sigL_bijP</span><span class="id"> =&gt;</span><span class="id"> -&gt;</span><span class="id"> /sigL_bijP</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> eq_set_bijLR</span><span class="id"> A</span><span class="id"> B</span><span class="id"> f</span><span class="id"> g</span><span class="id"> :</span><span class="id"> {in</span><span class="id"> A,</span><span class="id"> f</span><span class="id"> =1</span><span class="id"> g}</span><span class="id"> -&gt;</span><span class="id"> set_bij</span><span class="id"> A</span><span class="id"> B</span><span class="id"> g</span><span class="id"> -&gt;</span><span class="id"> set_bij</span><span class="id"> A</span><span class="id"> B</span><span class="id"> f</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> /eq_sigLP</span><span class="id"> +</span><span class="id"> /sigL_bijP</span><span class="id"> =&gt;</span><span class="id"> &lt;-</span><span class="id"> /sigL_bijP</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> eq_set_bij</span><span class="id"> A</span><span class="id"> B</span><span class="id"> f</span><span class="id"> g</span><span class="id"> :</span><span class="id"> {in</span><span class="id"> A,</span><span class="id"> f</span><span class="id"> =1</span><span class="id"> g}</span><span class="id"> -&gt;</span><span class="id"> set_bij</span><span class="id"> A</span><span class="id"> B</span><span class="id"> f</span><span class="id"> =</span><span class="id"> set_bij</span><span class="id"> A</span><span class="id"> B</span><span class="id"> g</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> eqfg;</span><span class="id"> apply/propeqP;</span><span class="id"> split;</span><span class="id"> [apply:</span><span class="id"> eq_set_bijRL</span><span class="id"> |</span><span class="id"> apply:</span><span class="id"> eq_set_bijLR]</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> bij_omap</span><span class="id"> A</span><span class="id"> B</span><span class="id"> f</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">set_bij</span> (<span class="id">some</span><span class="id"> @`</span><span class="id"> A</span>) (<span class="id">some</span><span class="id"> @`</span><span class="id"> B</span>) (<span class="id">omap</span><span class="id"> f</span>)<span class="id"> &lt;-&gt;</span><span class="id"> set_bij</span><span class="id"> A</span><span class="id"> B</span><span class="id"> f</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">split=&gt;</span><span class="id"> [/Pbij[b</span><span class="id"> mapfb]|/Pbij[{}f-&gt;//]]</span>.<br/>
<span class="id">suff</span><span class="id"> -&gt;</span><span class="id"> :</span><span class="id"> f</span><span class="id"> =</span><span class="id"> unbind</span><span class="id"> f</span> (<span class="id">b</span><span class="id"> \o</span><span class="id"> some</span>)<span class="id"> :&gt;</span> (_<span class="id"> -&gt;</span><span class="id"> _</span>)<span class="gallina-kwd"> by</span><span class="id"> []</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply/funext=&gt;</span><span class="id"> x;</span><span class="id"> rewrite</span><span class="id"> -mapfb</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> bij_olift</span><span class="id"> A</span><span class="id"> B</span><span class="id"> f</span><span class="id"> :</span><span class="id"> set_bij</span><span class="id"> A</span> (<span class="id">some</span><span class="id"> @`</span><span class="id"> B</span>) (<span class="id">olift</span><span class="id"> f</span>)<span class="id"> &lt;-&gt;</span><span class="id"> set_bij</span><span class="id"> A</span><span class="id"> B</span><span class="id"> f</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">split=&gt;</span><span class="id"> [/Pbij[b</span><span class="id"> liftfb]|/Pbij[{}f-&gt;//]]</span>.<br/>
<span class="id">suff</span><span class="id"> -&gt;</span><span class="id"> :</span><span class="id"> f</span><span class="id"> =</span><span class="id"> unbind</span><span class="id"> f</span><span class="id"> b</span><span class="id"> :&gt;</span> (_<span class="id"> -&gt;</span><span class="id"> _</span>)<span class="gallina-kwd"> by</span><span class="id"> []</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply/funext=&gt;</span><span class="id"> x;</span><span class="id"> rewrite</span><span class="id"> -liftfb</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> set_bij_basic_lemmas</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> bij_sub_sym</span><span class="id"> {aT</span><span class="id"> rT}</span><span class="id"> {A</span><span class="id"> C</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT}</span><span class="id"> {B</span><span class="id"> D</span><span class="id"> :</span><span class="id"> set</span><span class="id"> rT}</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">f</span><span class="id"> :</span><span class="id"> {bij</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<span class="id"> :</span><span class="id"> C</span><span class="id"> `&lt;=`</span><span class="id"> A</span><span class="id"> -&gt;</span><span class="id"> D</span><span class="id"> `&lt;=`</span><span class="id"> B</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">set_bij</span><span class="id"> D</span> (<span class="id">some</span><span class="id"> @`</span><span class="id"> C</span>)<span class="id"> 'oinv_f</span><span class="id"> &lt;-&gt;</span><span class="id"> set_bij</span><span class="id"> C</span><span class="id"> D</span><span class="id"> f</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> CA</span><span class="id"> DB;</span><span class="id"> gen</span><span class="id"> have</span><span class="id"> oinv_bij</span><span class="id"> :</span><span class="id"> aT</span><span class="id"> rT</span><span class="id"> A</span><span class="id"> C</span><span class="id"> B</span><span class="id"> D</span><span class="id"> CA</span><span class="id"> DB</span><span class="id"> f</span><span class="id"> /</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">set_bij</span><span class="id"> C</span><span class="id"> D</span><span class="id"> f</span><span class="id"> -&gt;</span><span class="id"> set_bij</span><span class="id"> D</span> (<span class="id">some</span><span class="id"> @`</span><span class="id"> C</span>)<span class="id"> 'oinv_f;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">split=&gt;</span><span class="id"> bij_oinv;</span><span class="id"> last</span><span class="id"> exact:</span><span class="id"> oinv_bij</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply/bij_omap;</span><span class="id"> rewrite</span><span class="id"> -oinvV;</span><span class="id"> apply:</span><span class="id"> oinv_bij</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> apply:</span><span class="id"> image_subset</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> /Pbij[fC</span><span class="id"> ffC];</span><span class="id"> suff</span><span class="id"> /eq_set_bij-&gt;</span><span class="id"> :</span><span class="id"> {in</span><span class="id"> D,</span><span class="id"> 'oinv_f</span><span class="id"> =1</span><span class="id"> 'oinv_fC}</span><span class="gallina-kwd"> by</span><span class="id"> []</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> x</span><span class="id"> xD;</span><span class="id"> apply:</span><span class="id"> 'inj_</span>(<span class="id">oapp</span><span class="id"> f</span><span class="id"> x</span>)<span class="id">;</span><span class="id"> rewrite</span><span class="id"> ?mem_fun//=</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> apply/subsetP</span><span class="id"> :</span><span class="id"> x</span><span class="id"> xD</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> have</span><span class="id"> :=</span><span class="id"> mem_set</span> ((<span class="id">image_subset</span><span class="id"> CA</span>)<span class="id"> _</span> (<span class="id">'oinvS_fC</span> (<span class="id">set_mem</span><span class="id"> xD</span>))).<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> oinvK</span><span class="id"> ?ffC</span><span class="id"> ?oinvK//</span><span class="id"> ?</span>(<span class="id">subsetP</span>.<span class="id">2</span><span class="id"> _</span><span class="id"> _</span><span class="id"> xD</span>).<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> splitbij_sub_sym</span><span class="id"> {aT</span><span class="id"> rT}</span><span class="id"> {A</span><span class="id"> C</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT}</span><span class="id"> {B</span><span class="id"> D</span><span class="id"> :</span><span class="id"> set</span><span class="id"> rT}</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">f</span><span class="id"> :</span><span class="id"> {splitbij</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<span class="id"> :</span><span class="id"> C</span><span class="id"> `&lt;=`</span><span class="id"> A</span><span class="id"> -&gt;</span><span class="id"> D</span><span class="id"> `&lt;=`</span><span class="id"> B</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">set_bij</span><span class="id"> D</span><span class="id"> C</span><span class="id"> f^-1</span><span class="id"> &lt;-&gt;</span><span class="id"> set_bij</span><span class="id"> C</span><span class="id"> D</span><span class="id"> f</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> CA</span><span class="id"> DB;</span><span class="id"> rewrite</span><span class="id"> -bij_sub_sym//</span><span class="id"> -oliftV</span><span class="id"> bij_olift</span>. Qed.</div></details>
<br/>
<span class="vernacular">Section</span><span class="id"> set_bij_lemmas</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {aT</span><span class="id"> rT</span><span class="id"> :</span><span class="id"> Type}</span>.<br/>
<span class="vernacular">Implicit</span><span class="id"> Types</span> (<span class="id">A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT</span>) (<span class="id">B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> rT</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> aT</span><span class="id"> -&gt;</span><span class="id"> rT</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> set_bij00</span><span class="id"> T</span><span class="id"> U</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> U</span>)<span class="id"> :</span><span class="id"> set_bij</span><span class="id"> set0</span><span class="id"> set0</span><span class="id"> f</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> split=&gt;</span><span class="id"> [_</span><span class="id"> []//|x</span><span class="id"> y|//];</span><span class="id"> rewrite</span><span class="id"> inE</span>. Qed.</div></details>
<span class="vernacular">Hint</span><span class="id"> Resolve</span><span class="id"> set_bij00</span><span class="id"> :</span><span class="id"> core</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> inj_bij</span><span class="id"> A</span><span class="id"> f</span><span class="id"> :</span><span class="id"> {in</span><span class="id"> A</span><span class="id"> &amp;,</span><span class="id"> injective</span><span class="id"> f}</span><span class="id"> -&gt;</span><span class="id"> set_bij</span><span class="id"> A</span> (<span class="id">f</span><span class="id"> @`</span><span class="id"> A</span>)<span class="id"> f</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> /Pinj[{}f-&gt;];</span><span class="id"> apply:</span><span class="id"> 'bij_[fun</span><span class="id"> f</span><span class="gallina-kwd"> in</span><span class="id"> A]</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> bij_subl</span><span class="id"> A</span><span class="id"> B</span><span class="id"> C</span><span class="id"> D</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {bij</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<span class="id"> :</span><span class="id"> C</span><span class="id"> `&lt;=`</span><span class="id"> A</span><span class="id"> -&gt;</span><span class="id"> f</span><span class="id"> @`</span><span class="id"> C</span><span class="id"> =</span><span class="id"> D</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">set_bij</span><span class="id"> C</span><span class="id"> D</span><span class="id"> f</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> /homo_setP</span><span class="id"> CA</span><span class="id"> &lt;-;</span><span class="id"> split=&gt;</span><span class="id"> //</span><span class="id"> x</span><span class="id"> y</span><span class="id"> /CA</span><span class="id"> +</span><span class="id"> /CA</span><span class="id"> +;</span><span class="id"> apply:</span><span class="id"> inj</span>. Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> set_bij_lemmas</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> set_bij_lemmas</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {aT</span><span class="id"> rT</span><span class="id"> :</span><span class="id"> Type}</span>.<br/>
<span class="vernacular">Implicit</span><span class="id"> Types</span> (<span class="id">A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT</span>) (<span class="id">B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> rT</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> aT</span><span class="id"> -&gt;</span><span class="id"> rT</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> bij_subr</span><span class="id"> A</span><span class="id"> B</span><span class="id"> C</span><span class="id"> D</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {bij</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<span class="id"> :</span><span class="id"> C</span><span class="id"> =</span><span class="id"> A</span><span class="id"> `&amp;`</span> (<span class="id">f</span><span class="id"> @^-1`</span><span class="id"> D</span>)<span class="id"> -&gt;</span><span class="id"> D</span><span class="id"> `&lt;=`</span><span class="id"> B</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">set_bij</span><span class="id"> C</span><span class="id"> D</span><span class="id"> f</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> -&gt;</span><span class="id"> DB;</span><span class="id"> apply/bij_sub_sym=&gt;</span><span class="id"> //;</span><span class="id"> apply:</span><span class="id"> bij_subl</span><span class="id"> =&gt;</span><span class="id"> //=</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> oinv_sub_image</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> bij_sub</span><span class="id"> A</span><span class="id"> B</span><span class="id"> C</span><span class="id"> D</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {bij</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<span class="id"> :</span><span class="id"> C</span><span class="id"> `&lt;=`</span><span class="id"> A</span><span class="id"> -&gt;</span><span class="id"> D</span><span class="id"> `&lt;=`</span><span class="id"> B</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">{homo</span><span class="id"> f</span><span class="id"> :</span><span class="id"> x</span><span class="id"> /</span><span class="id"> C</span><span class="id"> x</span><span class="id"> &gt;-&gt;</span><span class="id"> D</span><span class="id"> x}</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">{homo</span><span class="id"> 'oinv_f</span><span class="id"> :</span><span class="id"> x</span><span class="id"> /</span><span class="id"> D</span><span class="id"> x</span><span class="id"> &gt;-&gt;</span> (<span class="id">some</span><span class="id"> @`</span><span class="id"> C</span>)<span class="id"> x}</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">set_bij</span><span class="id"> C</span><span class="id"> D</span><span class="id"> f</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> CA</span><span class="id"> DB</span><span class="id"> fCD</span><span class="id"> fDC;</span><span class="id"> apply:</span><span class="id"> bij_subl</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> apply/seteqP;</span><span class="id"> split</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply/image_subP</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> y</span><span class="id"> /[dup]/[dup]</span><span class="id"> Dy</span><span class="id"> /DB</span><span class="id"> By</span><span class="id"> /fDC</span><span class="id"> [x</span><span class="id"> Cx]/=</span><span class="id"> xfy;</span><span class="gallina-kwd"> exists</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> move:</span><span class="id"> xfy</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> case:</span><span class="id"> oinvP</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> a</span><span class="id"> Aa</span><span class="id"> _</span><span class="id"> [-&gt;]</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> splitbij_sub</span><span class="id"> A</span><span class="id"> B</span><span class="id"> C</span><span class="id"> D</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {splitbij</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>)<span class="id"> :</span><span class="id"> C</span><span class="id"> `&lt;=`</span><span class="id"> A</span><span class="id"> -&gt;</span><span class="id"> D</span><span class="id"> `&lt;=`</span><span class="id"> B</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">{homo</span><span class="id"> f</span><span class="id"> :</span><span class="id"> x</span><span class="id"> /</span><span class="id"> C</span><span class="id"> x</span><span class="id"> &gt;-&gt;</span><span class="id"> D</span><span class="id"> x}</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">{homo</span><span class="id"> f^-1</span><span class="id"> :</span><span class="id"> x</span><span class="id"> /</span><span class="id"> D</span><span class="id"> x</span><span class="id"> &gt;-&gt;</span><span class="id"> C</span><span class="id"> x}</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">set_bij</span><span class="id"> C</span><span class="id"> D</span><span class="id"> f</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> CA</span><span class="id"> DB</span><span class="id"> /</span>(<span class="id">bij_sub</span><span class="id"> CA</span><span class="id"> DB</span>)<span class="id"> /[swap]</span><span class="id"> fDC;</span><span class="id"> apply=&gt;</span><span class="id"> x</span><span class="id"> Dx</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -some_inv/=;</span><span class="gallina-kwd"> exists</span> (<span class="id">f^-1</span><span class="id"> x</span>)<span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> apply:</span><span class="id"> fDC</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> can2_bij</span><span class="id"> A</span><span class="id"> B</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> {fun</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span>) (<span class="id">g</span><span class="id"> :</span><span class="id"> {fun</span><span class="id"> B</span><span class="id"> &gt;-&gt;</span><span class="id"> A}</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">{in</span><span class="id"> A,</span><span class="id"> cancel</span><span class="id"> f</span><span class="id"> g}</span><span class="id"> -&gt;</span><span class="id"> {in</span><span class="id"> B,</span><span class="id"> cancel</span><span class="id"> g</span><span class="id"> f}</span><span class="id"> -&gt;</span><span class="id"> set_bij</span><span class="id"> A</span><span class="id"> B</span><span class="id"> f</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> /can_in_inj</span><span class="id"> finj</span><span class="id"> /can_surj</span><span class="id"> gK;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> apply:</span><span class="id"> gK</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> bij_sub_setUrl</span><span class="id"> A</span><span class="id"> B</span><span class="id"> B'</span><span class="id"> f</span><span class="id"> :</span><span class="id"> [disjoint</span><span class="id"> B</span><span class="id"> &amp;</span><span class="id"> B']</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">set_bij</span><span class="id"> A</span> (<span class="id">B</span><span class="id"> `|`</span><span class="id"> B'</span>)<span class="id"> f</span><span class="id"> -&gt;</span><span class="id"> set_bij</span> (<span class="id">A</span><span class="id"> `\`</span><span class="id"> f</span><span class="id"> @^-1`</span><span class="id"> B'</span>)<span class="id"> B</span><span class="id"> f</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> /disj_setPS</span><span class="id"> BB'</span><span class="id"> /Pbij[{}f-&gt;];</span><span class="id"> apply:</span><span class="id"> bij_subr;</span><span class="id"> last</span><span class="id"> exact:</span><span class="id"> subsetUl</span>.<br/>
<span class="id">apply/seteqP;</span><span class="id"> split=&gt;</span><span class="id"> x</span><span class="id"> /=</span><span class="id"> [Ax</span><span class="id"> Bfx];</span><span class="id"> split=&gt;</span><span class="id"> //;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> have</span><span class="id"> []</span><span class="id"> :=</span><span class="id"> 'funS_f</span><span class="id"> Ax</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> B'fx;</span><span class="id"> apply:</span> (<span class="id">BB'</span> (<span class="id">f</span><span class="id"> x</span>)).<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> bij_sub_setUrr</span><span class="id"> A</span><span class="id"> B</span><span class="id"> B'</span><span class="id"> f</span><span class="id"> :</span><span class="id"> [disjoint</span><span class="id"> B</span><span class="id"> &amp;</span><span class="id"> B']</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">set_bij</span><span class="id"> A</span> (<span class="id">B</span><span class="id"> `|`</span><span class="id"> B'</span>)<span class="id"> f</span><span class="id"> -&gt;</span><span class="id"> set_bij</span> (<span class="id">A</span><span class="id"> `\`</span><span class="id"> f</span><span class="id"> @^-1`</span><span class="id"> B</span>)<span class="id"> B'</span><span class="id"> f</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> setUC</span><span class="id"> disj_set_sym;</span><span class="id"> apply:</span><span class="id"> bij_sub_setUrl</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> bij_sub_setUll</span><span class="id"> A</span><span class="id"> A'</span><span class="id"> B</span><span class="id"> f</span><span class="id"> :</span><span class="id"> [disjoint</span><span class="id"> A</span><span class="id"> &amp;</span><span class="id"> A']</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">set_bij</span> (<span class="id">A</span><span class="id"> `|`</span><span class="id"> A'</span>)<span class="id"> B</span><span class="id"> f</span><span class="id"> -&gt;</span><span class="id"> set_bij</span><span class="id"> A</span> (<span class="id">B</span><span class="id"> `\`</span><span class="id"> f</span><span class="id"> @`</span><span class="id"> A'</span>)<span class="id"> f</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> /disj_setPS</span><span class="id"> AA'</span><span class="id"> /Pbij[{}f-&gt;]</span>.<br/>
<span class="id">apply:</span><span class="id"> bij_sub</span><span class="id"> =&gt;</span><span class="id"> [|?</span><span class="id"> []//||];</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> subsetUl</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> x</span><span class="id"> Ax</span><span class="id"> /=;</span><span class="id"> split;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> funS;</span><span class="id"> left</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> [y]</span><span class="id"> A'y</span><span class="id"> /inj;</span><span class="id"> rewrite</span><span class="id"> !inE/=</span><span class="id"> =&gt;yx;</span><span class="id"> apply:</span> (<span class="id">AA'</span><span class="id"> x</span>).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> split=&gt;</span><span class="id"> //;</span><span class="id"> rewrite</span><span class="id"> -yx</span><span class="id"> //;</span><span class="id"> [right|left]</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> z</span><span class="id"> [Bz</span><span class="id"> /=</span><span class="id"> /not_exists2P</span><span class="id"> /contrapT]</span><span class="id"> A'fxz</span>.<br/>
<span class="id">case:</span><span class="id"> oinvP=&gt;</span><span class="id"> //</span><span class="id"> x</span><span class="id"> AA'x</span><span class="id"> fxz;</span><span class="gallina-kwd"> exists</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> have</span><span class="id"> :=</span><span class="id"> A'fxz</span><span class="id"> x;</span><span class="id"> rewrite</span><span class="id"> fxz</span><span class="id"> =&gt;</span><span class="id"> -[|//];</span><span class="id"> case:</span><span class="id"> AA'x</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> bij_sub_setUlr</span><span class="id"> A</span><span class="id"> A'</span><span class="id"> B</span><span class="id"> f</span><span class="id"> :</span><span class="id"> [disjoint</span><span class="id"> A</span><span class="id"> &amp;</span><span class="id"> A']</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">set_bij</span> (<span class="id">A</span><span class="id"> `|`</span><span class="id"> A'</span>)<span class="id"> B</span><span class="id"> f</span><span class="id"> -&gt;</span><span class="id"> set_bij</span><span class="id"> A'</span> (<span class="id">B</span><span class="id"> `\`</span><span class="id"> f</span><span class="id"> @`</span><span class="id"> A</span>)<span class="id"> f</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> setUC</span><span class="id"> disj_set_sym;</span><span class="id"> apply:</span><span class="id"> bij_sub_setUll</span>. Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> set_bij_lemmas</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> bij_II_D1</span><span class="id"> T</span><span class="id"> n</span> (<span class="id">A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> nat</span><span class="id"> -&gt;</span><span class="id"> T</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">set_bij</span><span class="id"> `I_n</span>.<span class="id">+1</span><span class="id"> A</span><span class="id"> f</span><span class="id"> -&gt;</span><span class="id"> set_bij</span><span class="id"> `I_n</span> (<span class="id">A</span><span class="id"> `\</span><span class="id"> f</span><span class="id"> n</span>)<span class="id"> f</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> IIS</span><span class="id"> -image_set1;</span><span class="id"> apply:</span><span class="id"> bij_sub_setUll</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply/disj_setPS</span><span class="id"> =&gt;</span><span class="id"> i</span><span class="id"> [/=</span><span class="id"> /[swap]-&gt;];</span><span class="id"> rewrite</span><span class="id"> ltnn</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> set_bij_comp</span><span class="id"> T1</span><span class="id"> T2</span><span class="id"> T3</span> (<span class="id">A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T1</span>) (<span class="id">B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T2</span>) (<span class="id">C</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T3</span>)<span class="id"> f</span><span class="id"> g</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">set_bij</span><span class="id"> A</span><span class="id"> B</span><span class="id"> f</span><span class="id"> -&gt;</span><span class="id"> set_bij</span><span class="id"> B</span><span class="id"> C</span><span class="id"> g</span><span class="id"> -&gt;</span><span class="id"> set_bij</span><span class="id"> A</span><span class="id"> C</span> (<span class="id">g</span><span class="id"> \o</span><span class="id"> f</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> /Pbij[{}f-&gt;]</span><span class="id"> /Pbij[{}g-&gt;];</span><span class="id"> apply:</span><span class="id"> 'bij_</span>(<span class="id">g</span><span class="id"> \o</span><span class="id"> f</span>). Qed.</div></details>
<br/>
<span class="vernacular">Section</span><span class="id"> pointed_inverse</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {T</span><span class="id"> U}</span> (<span class="id">dflt</span><span class="id"> :</span><span class="id"> U</span><span class="id"> -&gt;</span><span class="id"> T</span>) (<span class="id">A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T</span>).<br/>
<span class="vernacular">Implicit</span><span class="id"> Types</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> U</span>) (<span class="id">i</span><span class="id"> :</span><span class="id"> {inj</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> U}</span>).<br/>
<br/>
<span class="vernacular">Definition</span><span class="id"> pinv_</span><span class="id"> f</span><span class="id"> :=</span> (<span class="id">'split_dflt</span><span class="id"> [fun</span><span class="id"> f</span><span class="gallina-kwd"> in</span><span class="id"> A]</span>)<span class="id">^-1</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Notation</span><span class="id"> pinv</span><span class="id"> :=</span><span class="id"> pinv_</span>.<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> f</span><span class="id"> :=</span><span class="id"> Inv</span>.<span class="id">Build</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">pinv</span><span class="id"> f</span>)<span class="id"> f</span>.<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> f</span><span class="id"> :=</span><span class="id"> Fun</span>.<span class="id">on</span> (<span class="id">pinv</span><span class="id"> f</span>).<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> f</span><span class="id"> :=</span><span class="id"> SplitInjFun</span>.<span class="id">on</span> (<span class="id">pinv</span><span class="id"> f</span>).<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> i</span><span class="id"> :=</span><span class="id"> SplitBij</span>.<span class="id">on</span> (<span class="id">pinv</span><span class="id"> i</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> pinvK</span><span class="id"> f</span><span class="id"> :</span><span class="id"> {in</span><span class="id"> f</span><span class="id"> @`</span><span class="id"> A,</span><span class="id"> cancel</span> (<span class="id">pinv</span><span class="id"> f</span>)<span class="id"> f}</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id"> exact:</span><span class="id"> 'funK_</span>(<span class="id">pinv</span><span class="id"> f</span>). Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> pinvKV</span><span class="id"> f</span><span class="id"> :</span><span class="id"> {in</span><span class="id"> A</span><span class="id"> &amp;,</span><span class="id"> injective</span><span class="id"> f}</span><span class="id"> -&gt;</span><span class="id"> {in</span><span class="id"> A,</span><span class="id"> cancel</span><span class="id"> f</span> (<span class="id">pinv</span><span class="id"> f</span>)<span class="id">}</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> /Pinj[{}f-&gt;];</span><span class="id"> apply:</span><span class="id"> funK</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> injpinv_surj</span><span class="id"> f</span><span class="id"> :</span><span class="id"> {in</span><span class="id"> A</span><span class="id"> &amp;,</span><span class="id"> injective</span><span class="id"> f}</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">set_surj</span> (<span class="id">f</span><span class="id"> @`</span><span class="id"> A</span>)<span class="id"> A</span> (<span class="id">pinv</span><span class="id"> f</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> /Pinj[{}f-&gt;];</span><span class="id"> apply:</span><span class="id"> surj</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> injpinv_image</span><span class="id"> f</span><span class="id"> :</span><span class="id"> {in</span><span class="id"> A</span><span class="id"> &amp;,</span><span class="id"> injective</span><span class="id"> f}</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">pinv</span><span class="id"> f</span><span class="id"> @`</span> (<span class="id">f</span><span class="id"> @`</span><span class="id"> A</span>)<span class="id"> =</span><span class="id"> A</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> /Pinj[{}f-&gt;];</span><span class="id"> rewrite</span><span class="id"> image_eq</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> injpinv_bij</span><span class="id"> f</span><span class="id"> :</span><span class="id"> {in</span><span class="id"> A</span><span class="id"> &amp;,</span><span class="id"> injective</span><span class="id"> f}</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">set_bij</span> (<span class="id">f</span><span class="id"> @`</span><span class="id"> A</span>)<span class="id"> A</span> (<span class="id">pinv</span><span class="id"> f</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> /Pinj[{}f-&gt;];</span><span class="id"> apply:</span><span class="id"> bij</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> surjpK</span><span class="id"> B</span><span class="id"> f</span><span class="id"> :</span><span class="id"> set_surj</span><span class="id"> A</span><span class="id"> B</span><span class="id"> f</span><span class="id"> -&gt;</span><span class="id"> {in</span><span class="id"> B,</span><span class="id"> cancel</span> (<span class="id">pinv</span><span class="id"> f</span>)<span class="id"> f}</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> /homo_setP</span><span class="id"> BfA;</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> /BfA</span><span class="id"> xfA;</span><span class="id"> rewrite</span><span class="id"> pinvK</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> surjpinv_image_sub</span><span class="id"> B</span><span class="id"> f</span><span class="id"> :</span><span class="id"> set_surj</span><span class="id"> A</span><span class="id"> B</span><span class="id"> f</span><span class="id"> -&gt;</span><span class="id"> pinv</span><span class="id"> f</span><span class="id"> @`</span><span class="id"> B</span><span class="id"> `&lt;=`</span><span class="id"> A</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> fsurj;</span><span class="id"> apply:</span> (<span class="id">subset_trans</span> (<span class="id">image_subset</span><span class="id"> fsurj</span>)). Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> surjpinv_inj</span><span class="id"> B</span><span class="id"> f</span><span class="id"> :</span><span class="id"> set_surj</span><span class="id"> A</span><span class="id"> B</span><span class="id"> f</span><span class="id"> -&gt;</span><span class="id"> {in</span><span class="id"> B</span><span class="id"> &amp;,</span><span class="id"> injective</span> (<span class="id">pinv</span><span class="id"> f</span>)<span class="id">}</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> /homo_setP/sub_in2;</span><span class="id"> apply</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> surjpinv_bij</span><span class="id"> B</span><span class="id"> f</span> (<span class="id">g</span><span class="id"> :=</span><span class="id"> pinv</span><span class="id"> f</span>)<span class="id"> :</span><span class="id"> set_surj</span><span class="id"> A</span><span class="id"> B</span><span class="id"> f</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">set_bij</span><span class="id"> B</span> (<span class="id">g</span><span class="id"> @`</span><span class="id"> B</span>)<span class="id"> g</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> f_surj;</span><span class="id"> split=&gt;</span><span class="id"> //;</span><span class="id"> apply:</span><span class="id"> surjpinv_inj</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> bijpinv_bij</span><span class="id"> B</span><span class="id"> f</span><span class="id"> :</span><span class="id"> set_bij</span><span class="id"> A</span><span class="id"> B</span><span class="id"> f</span><span class="id"> -&gt;</span><span class="id"> set_bij</span><span class="id"> B</span><span class="id"> A</span> (<span class="id">pinv</span><span class="id"> f</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> /Pbij[{}f-&gt;];</span><span class="id"> have</span><span class="id"> /=</span><span class="id"> :=</span><span class="id"> 'bij_</span>(<span class="id">pinv</span><span class="id"> f</span>)<span class="id">;</span><span class="id"> rewrite</span><span class="id"> image_eq</span>. Qed.</div></details>
<br/>
<span class="vernacular">Section</span><span class="id"> pPbij</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {B:</span><span class="id"> set</span><span class="id"> U}</span><span class="id"> {f</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> U}</span> (<span class="id">fbij</span><span class="id"> :</span><span class="id"> set_bij</span><span class="id"> A</span><span class="id"> B</span><span class="id"> f</span>).<br/>
<span class="vernacular">Lemma</span><span class="id"> pPbij_</span><span class="id"> :</span><span class="id"> {s</span><span class="id"> :</span><span class="id"> {splitbij</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span><span class="id"> |</span><span class="id"> f</span><span class="id"> =</span><span class="id"> s}</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">pose</span><span class="id"> h</span><span class="id"> :=</span><span class="id"> [splitbij</span><span class="id"> of</span><span class="id"> 'split_dflt</span><span class="id"> [fun</span><span class="id"> fbij</span><span class="gallina-kwd"> in</span><span class="id"> A]];</span><span class="id"> have</span><span class="id"> :</span><span class="id"> f</span><span class="id"> =</span><span class="id"> h</span><span class="gallina-kwd"> by</span><span class="id"> []</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> move:</span><span class="id"> h;</span><span class="id"> rewrite</span><span class="id"> /=</span> (<span class="id">image_eq</span><span class="id"> fbij</span>)<span class="id"> =&gt;</span><span class="id"> h;</span><span class="gallina-kwd"> exists</span><span class="id"> h</span>.<br/>
Qed.</div></details>
<span class="vernacular">End</span><span class="id"> pPbij</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> pPinj</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {f</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> U}</span> (<span class="id">finj</span><span class="id"> :</span><span class="id"> {in</span><span class="id"> A</span><span class="id"> &amp;,</span><span class="id"> injective</span><span class="id"> f}</span>).<br/>
<span class="vernacular">Lemma</span><span class="id"> pPinj_</span><span class="id"> :</span><span class="id"> {i</span><span class="id"> :</span><span class="id"> {splitinj</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> U}</span><span class="id"> |</span><span class="id"> f</span><span class="id"> =</span><span class="id"> i}</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd">by</span><span class="id"> move:</span><span class="id"> finj</span><span class="id"> =&gt;</span><span class="id"> /Pinj[g</span><span class="id"> -&gt;];</span><span class="gallina-kwd"> exists</span><span class="id"> [splitinj</span><span class="id"> of</span><span class="id"> 'split_dflt</span><span class="id"> [fun</span><span class="id"> g</span><span class="gallina-kwd"> in</span><span class="id"> A]]</span>.<br/>
Qed.</div></details>
<span class="vernacular">End</span><span class="id"> pPinj</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> injpPfun</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> U}</span><span class="id"> {f</span><span class="id"> :</span><span class="id"> {inj</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> U}}</span> (<span class="id">ffun</span><span class="id"> :</span><span class="id"> {homo</span><span class="id"> f</span><span class="id"> :</span><span class="id"> x</span><span class="id"> /</span><span class="id"> A</span><span class="id"> x</span><span class="id"> &gt;-&gt;</span><span class="id"> B</span><span class="id"> x}</span>).<br/>
<span class="vernacular">Let</span><span class="id"> g</span><span class="id"> :</span><span class="id"> _</span><span class="id"> -&gt;</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> f</span>.<br/>
<span class="id">#[local]</span><span class="id"> HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> SplitInj</span>.<span class="id">copy</span><span class="id"> g</span> (<span class="id">'split_dflt</span><span class="id"> [fun</span><span class="id"> g</span><span class="gallina-kwd"> in</span><span class="id"> A]</span>).<br/>
<span class="id">#[local]</span><span class="id"> HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> isFun</span>.<span class="id">Build</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> g</span><span class="id"> ffun</span>.<br/>
<span class="vernacular">Lemma</span><span class="id"> injpPfun_</span><span class="id"> :</span><span class="id"> {i</span><span class="id"> :</span><span class="id"> {splitinjfun</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span><span class="id"> |</span><span class="id"> f</span><span class="id"> =</span><span class="id"> i</span><span class="id"> :&gt;</span> (_<span class="id"> -&gt;</span><span class="id"> _</span>)<span class="id">}</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="gallina-kwd"> exists</span><span class="id"> [splitinjfun</span><span class="id"> of</span><span class="id"> g]</span>. Qed.</div></details>
<span class="vernacular">End</span><span class="id"> injpPfun</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> funpPinj</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> U}</span><span class="id"> {f</span><span class="id"> :</span><span class="id"> {fun</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}}</span> (<span class="id">finj</span><span class="id"> :</span><span class="id"> {in</span><span class="id"> A</span><span class="id"> &amp;,</span><span class="id"> injective</span><span class="id"> f}</span>).<br/>
<span class="vernacular">Lemma</span><span class="id"> funpPinj_</span><span class="id"> :</span><span class="id"> {i</span><span class="id"> :</span><span class="id"> {splitinjfun</span><span class="id"> A</span><span class="id"> &gt;-&gt;</span><span class="id"> B}</span><span class="id"> |</span><span class="id"> f</span><span class="id"> =</span><span class="id"> i</span><span class="id"> :&gt;</span> (_<span class="id"> -&gt;</span><span class="id"> _</span>)<span class="id">}</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move:</span><span class="id"> finj</span><span class="id"> 'funS_f</span><span class="id"> =&gt;</span><span class="id"> /pPinj_[g</span><span class="id"> -&gt;]/injpPfun_</span>. Qed.</div></details>
<span class="vernacular">End</span><span class="id"> funpPinj</span>.<br/>
<br/>
<span class="vernacular">End</span><span class="id"> pointed_inverse</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;''pinv_' dflt&quot;</span><span class="id"> :=</span> (<span class="id">pinv_</span><span class="id"> dflt</span>)<span class="id"> :</span><span class="id"> form_scope</span>.<br/>
<span class="vernacular">Notation</span><span class="id"> pinv</span><span class="id"> :=</span><span class="id"> 'pinv_</span>(<span class="id">fun=&gt;</span><span class="id"> point</span>).<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;''pPbij_' dflt&quot;</span><span class="id"> :=</span> (<span class="id">pPbij_</span><span class="id"> dflt</span>)<span class="id"> :</span><span class="id"> form_scope</span>.<br/>
<span class="vernacular">Notation</span><span class="id"> pPbij</span><span class="id"> :=</span><span class="id"> 'pPbij_</span>(<span class="id">fun=&gt;</span><span class="id"> point</span>).<br/>
<span class="vernacular">Notation</span><span class="id"> selfPbij</span><span class="id"> :=</span><span class="id"> 'pPbij_id</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;''pPinj_' dflt&quot;</span><span class="id"> :=</span> (<span class="id">pPinj_</span><span class="id"> dflt</span>)<span class="id"> :</span><span class="id"> form_scope</span>.<br/>
<span class="vernacular">Notation</span><span class="id"> pPinj</span><span class="id"> :=</span><span class="id"> 'pPinj_</span>(<span class="id">fun=&gt;</span><span class="id"> point</span>).<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;''injpPfun_' dflt&quot;</span><span class="id"> :=</span> (<span class="id">injpPfun_</span><span class="id"> dflt</span>)<span class="id"> :</span><span class="id"> form_scope</span>.<br/>
<span class="vernacular">Notation</span><span class="id"> injpPfun</span><span class="id"> :=</span><span class="id"> 'injpPfun_</span>(<span class="id">fun=&gt;</span><span class="id"> point</span>).<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;''funpPinj_' dflt&quot;</span><span class="id"> :=</span> (<span class="id">funpPinj_</span><span class="id"> dflt</span>)<span class="id"> :</span><span class="id"> form_scope</span>.<br/>
<span class="vernacular">Notation</span><span class="id"> funpPinj</span><span class="id"> :=</span><span class="id"> 'funpPinj_</span>(<span class="id">fun=&gt;</span><span class="id"> point</span>).<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> function_space</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ring_scope</span>.<br/>
<span class="vernacular">Import</span><span class="id"> GRing</span>.<span class="id">Theory</span>.<br/>
<br/>
<span class="vernacular">Definition</span><span class="id"> cst</span><span class="id"> {T</span><span class="id"> T'</span><span class="id"> :</span><span class="id"> Type}</span> (<span class="id">x</span><span class="id"> :</span><span class="id"> T'</span>)<span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> T'</span><span class="id"> :=</span><span class="id"> fun=&gt;</span><span class="id"> x</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> preimage_cst</span><span class="id"> {aT</span><span class="id"> rT</span><span class="id"> :</span><span class="id"> Type}</span> (<span class="id">a</span><span class="id"> :</span><span class="id"> aT</span>) (<span class="id">A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> aT</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">@cst</span><span class="id"> rT</span><span class="id"> _</span><span class="id"> a</span><span class="id"> @^-1`</span><span class="id"> A</span><span class="id"> =</span><span class="gallina-kwd"> if</span><span class="id"> a</span><span class="id"> \in</span><span class="id"> A</span><span class="gallina-kwd"> then</span><span class="id"> setT</span><span class="gallina-kwd"> else</span><span class="id"> set0</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">apply/seteqP;</span><span class="id"> rewrite</span><span class="id"> /preimage;</span><span class="id"> split;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> *;</span><span class="id"> rewrite</span><span class="id"> mem_set</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> case:</span><span class="id"> ifPn</span><span class="id"> =&gt;</span><span class="id"> [/[!inE]</span><span class="id"> ?//|_];</span><span class="id"> exact:</span><span class="id"> sub0set</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Obligation</span><span class="vernacular"> Tactic</span><span class="id"> :=</span><span class="id"> idtac</span>.<br/>
<br/>
<span class="id">Program</span><span class="vernacular"> Definition</span><span class="id"> fct_zmodMixin</span> (<span class="id">T</span><span class="id"> :</span><span class="gallina-kwd"> Type</span>) (<span class="id">M</span><span class="id"> :</span><span class="id"> zmodType</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">@GRing</span>.<span class="id">isZmodule</span>.<span class="id">Build</span> (<span class="id">T</span><span class="id"> -&gt;</span><span class="id"> M</span>)<span class="id"> \0</span> (<span class="gallina-kwd">fun</span><span class="id"> f</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> -</span><span class="id"> f</span><span class="id"> x</span>) (<span class="gallina-kwd">fun</span><span class="id"> f</span><span class="id"> g</span><span class="id"> =&gt;</span><span class="id"> f</span><span class="id"> \+</span><span class="id"> g</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_<span class="id"> _</span><span class="id"> _</span><span class="id"> _</span>.<br/>
<details>
<summary class="toggleproof">Next Obligation.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> T</span><span class="id"> M</span><span class="id"> f</span><span class="id"> g</span><span class="id"> h;</span><span class="id"> rewrite</span><span class="id"> funeqE=&gt;</span><span class="id"> x</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> addrA</span>. Qed.</div></details>
<details>
<summary class="toggleproof">Next Obligation.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> T</span><span class="id"> M</span><span class="id"> f</span><span class="id"> g;</span><span class="id"> rewrite</span><span class="id"> funeqE=&gt;</span><span class="id"> x</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> addrC</span>. Qed.</div></details>
<details>
<summary class="toggleproof">Next Obligation.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> T</span><span class="id"> M</span><span class="id"> f;</span><span class="id"> rewrite</span><span class="id"> funeqE=&gt;</span><span class="id"> x</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> add0r</span>. Qed.</div></details>
<details>
<summary class="toggleproof">Next Obligation.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> T</span><span class="id"> M</span><span class="id"> f;</span><span class="id"> rewrite</span><span class="id"> funeqE=&gt;</span><span class="id"> x</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> addNr</span>. Qed.</div></details>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">T</span><span class="id"> :</span><span class="gallina-kwd"> Type</span>) (<span class="id">M</span><span class="id"> :</span><span class="id"> zmodType</span>)<span class="id"> :=</span><span class="id"> fct_zmodMixin</span><span class="id"> T</span><span class="id"> M</span>.<br/>
<br/>
<span class="id">Program</span><span class="vernacular"> Definition</span><span class="id"> fct_ringMixin</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> pointedType</span>) (<span class="id">M</span><span class="id"> :</span><span class="id"> ringType</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">@GRing</span>.<span class="id">Zmodule_isRing</span>.<span class="id">Build</span> (<span class="id">T</span><span class="id"> -&gt;</span><span class="id"> M</span>) (<span class="id">cst</span><span class="id"> 1</span>) (<span class="gallina-kwd">fun</span><span class="id"> f</span><span class="id"> g</span><span class="id"> =&gt;</span><span class="id"> f</span><span class="id"> \*</span><span class="id"> g</span>)<span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span>.<br/>
<details>
<summary class="toggleproof">Next Obligation.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> T</span><span class="id"> M</span><span class="id"> f</span><span class="id"> g</span><span class="id"> h;</span><span class="id"> rewrite</span><span class="id"> funeqE=&gt;</span><span class="id"> x</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> mulrA</span>. Qed.</div></details>
<details>
<summary class="toggleproof">Next Obligation.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> T</span><span class="id"> M</span><span class="id"> f;</span><span class="id"> rewrite</span><span class="id"> funeqE=&gt;</span><span class="id"> x</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> mul1r</span>. Qed.</div></details>
<details>
<summary class="toggleproof">Next Obligation.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> T</span><span class="id"> M</span><span class="id"> f;</span><span class="id"> rewrite</span><span class="id"> funeqE=&gt;</span><span class="id"> x</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> mulr1</span>. Qed.</div></details>
<details>
<summary class="toggleproof">Next Obligation.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> T</span><span class="id"> M</span><span class="id"> f</span><span class="id"> g</span><span class="id"> h;</span><span class="id"> rewrite</span><span class="id"> funeqE=&gt;</span><span class="id"> x/=;</span><span class="id"> rewrite</span><span class="id"> mulrDl</span>. Qed.</div></details>
<details>
<summary class="toggleproof">Next Obligation.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> T</span><span class="id"> M</span><span class="id"> f</span><span class="id"> g</span><span class="id"> h;</span><span class="id"> rewrite</span><span class="id"> funeqE=&gt;</span><span class="id"> x/=;</span><span class="id"> rewrite</span><span class="id"> mulrDr</span>. Qed.</div></details>
<details>
<summary class="toggleproof">Next Obligation.</summary>
<div class="proofscript">
<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> T</span><span class="id"> M</span><span class="id"> ;</span><span class="id"> apply/eqP;</span><span class="id"> rewrite</span><span class="id"> funeqE</span><span class="id"> =&gt;</span><span class="id"> /</span>(_<span class="id"> point</span>)<span class="id"> /eqP;</span><span class="id"> rewrite</span><span class="id"> oner_eq0</span>.<br/>
Qed.</div></details>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> pointedType</span>) (<span class="id">M</span><span class="id"> :</span><span class="id"> ringType</span>)<span class="id"> :=</span><span class="id"> fct_ringMixin</span><span class="id"> T</span><span class="id"> M</span>.<br/>
<br/>
<span class="id">Program</span><span class="vernacular"> Definition</span><span class="id"> fct_comRingType</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> pointedType</span>) (<span class="id">M</span><span class="id"> :</span><span class="id"> comRingType</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">GRing</span>.<span class="id">Ring_hasCommutativeMul</span>.<span class="id">Build</span> (<span class="id">T</span><span class="id"> -&gt;</span><span class="id"> M</span>)<span class="id"> _</span>.<br/>
<details>
<summary class="toggleproof">Next Obligation.</summary>
<div class="proofscript">
<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> T</span><span class="id"> M</span><span class="id"> f</span><span class="id"> g;</span><span class="id"> rewrite</span><span class="id"> funeqE</span><span class="id"> =&gt;</span><span class="id"> x;</span><span class="id"> rewrite</span><span class="id"> /GRing</span>.<span class="id">mul/=</span><span class="id"> mulrC</span>.<br/>
Qed.</div></details>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> pointedType</span>) (<span class="id">M</span><span class="id"> :</span><span class="id"> comRingType</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">fct_comRingType</span><span class="id"> T</span><span class="id"> M</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> fct_lmod</span>.<br/>
<span class="vernacular">Variables</span> (<span class="id">U</span><span class="id"> :</span><span class="gallina-kwd"> Type</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> ringType</span>) (<span class="id">V</span><span class="id"> :</span><span class="id"> lmodType</span><span class="id"> R</span>).<br/>
<span class="id">Program</span><span class="vernacular"> Definition</span><span class="id"> fct_lmodMixin</span><span class="id"> :=</span><span class="id"> @GRing</span>.<span class="id">Zmodule_isLmodule</span>.<span class="id">Build</span><span class="id"> R</span> (<span class="id">U</span><span class="id"> -&gt;</span><span class="id"> V</span>)<br/>
&nbsp;&nbsp;(<span class="gallina-kwd">fun</span><span class="id"> k</span><span class="id"> f</span><span class="id"> =&gt;</span><span class="id"> k</span><span class="id"> \*:</span><span class="id"> f</span>)<span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span>.<br/>
<details>
<summary class="toggleproof">Next Obligation.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> k</span><span class="id"> f</span><span class="id"> v;</span><span class="id"> rewrite</span><span class="id"> funeqE=&gt;</span><span class="id"> x;</span><span class="id"> exact:</span><span class="id"> scalerA</span>. Qed.</div></details>
<details>
<summary class="toggleproof">Next Obligation.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> f;</span><span class="id"> rewrite</span><span class="id"> funeqE=&gt;</span><span class="id"> x</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> scale1r</span>. Qed.</div></details>
<details>
<summary class="toggleproof">Next Obligation.</summary>
<div class="proofscript">
<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> f</span><span class="id"> g</span><span class="id"> h;</span><span class="id"> rewrite</span><span class="id"> funeqE</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> scalerDr</span>.<br/>
Qed.</div></details>
<details>
<summary class="toggleproof">Next Obligation.</summary>
<div class="proofscript">
<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> f</span><span class="id"> g</span><span class="id"> h;</span><span class="id"> rewrite</span><span class="id"> funeqE</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> scalerDl</span>.<br/>
Qed.</div></details>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> fct_lmodMixin</span>.<br/>
<span class="vernacular">End</span><span class="id"> fct_lmod</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> fct_sumE</span> (<span class="id">I</span><span class="id"> T</span><span class="id"> :</span><span class="gallina-kwd"> Type</span>) (<span class="id">M</span><span class="id"> :</span><span class="id"> zmodType</span>)<span class="id"> r</span> (<span class="id">P</span><span class="id"> :</span><span class="id"> {pred</span><span class="id"> I}</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> I</span><span class="id"> -&gt;</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> M</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">x</span><span class="id"> :</span><span class="id"> T</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;(<span class="id">\sum_</span>(<span class="id">i</span><span class="id"> &lt;-</span><span class="id"> r</span><span class="id"> |</span><span class="id"> P</span><span class="id"> i</span>)<span class="id"> f</span><span class="id"> i</span>)<span class="id"> x</span><span class="id"> =</span><span class="id"> \sum_</span>(<span class="id">i</span><span class="id"> &lt;-</span><span class="id"> r</span><span class="id"> |</span><span class="id"> P</span><span class="id"> i</span>)<span class="id"> f</span><span class="id"> i</span><span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> elim/big_rec2:</span><span class="id"> _</span><span class="id"> =&gt;</span><span class="id"> //=</span><span class="id"> i</span><span class="id"> y</span><span class="id"> ?</span><span class="id"> Pi</span><span class="id"> &lt;-</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> mul_funC</span> (<span class="id">T</span><span class="id"> :</span><span class="gallina-kwd"> Type</span>)<span class="id"> {R</span><span class="id"> :</span><span class="id"> comSemiRingType}</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> R</span>) (<span class="id">r</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">r</span><span class="id"> \*o</span><span class="id"> f</span><span class="id"> =</span><span class="id"> r</span><span class="id"> \o*</span><span class="id"> f</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> apply/funext</span><span class="id"> =&gt;</span><span class="id"> x/=;</span><span class="id"> rewrite</span><span class="id"> mulrC</span>. Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> function_space</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> function_space_lemmas</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ring_scope</span>.<br/>
<span class="vernacular">Import</span><span class="id"> GRing</span>.<span class="id">Theory</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> addrfctE</span> (<span class="id">T</span><span class="id"> :</span><span class="gallina-kwd"> Type</span>) (<span class="id">K</span><span class="id"> :</span><span class="id"> zmodType</span>) (<span class="id">f</span><span class="id"> g</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> K</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">f</span><span class="id"> +</span><span class="id"> g</span><span class="id"> =</span> (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> f</span><span class="id"> x</span><span class="id"> +</span><span class="id"> g</span><span class="id"> x</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> []</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> sumrfctE</span> (<span class="id">T</span><span class="id"> :</span><span class="gallina-kwd"> Type</span>) (<span class="id">K</span><span class="id"> :</span><span class="id"> zmodType</span>) (<span class="id">s</span><span class="id"> :</span><span class="id"> seq</span> (<span class="id">T</span><span class="id"> -&gt;</span><span class="id"> K</span>))<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">\sum_</span>(<span class="id">f</span><span class="id"> &lt;-</span><span class="id"> s</span>)<span class="id"> f</span><span class="id"> =</span> (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> \sum_</span>(<span class="id">f</span><span class="id"> &lt;-</span><span class="id"> s</span>)<span class="id"> f</span><span class="id"> x</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> apply/funext</span><span class="id"> =&gt;</span><span class="id"> x;elim/big_ind2</span><span class="id"> :</span><span class="id"> _</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> _</span><span class="id"> a</span><span class="id"> _</span><span class="id"> b</span><span class="id"> &lt;-</span><span class="id"> &lt;-</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> opprfctE</span> (<span class="id">T</span><span class="id"> :</span><span class="gallina-kwd"> Type</span>) (<span class="id">K</span><span class="id"> :</span><span class="id"> zmodType</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> K</span>)<span class="id"> :</span><span class="id"> -</span><span class="id"> f</span><span class="id"> =</span> (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> -</span><span class="id"> f</span><span class="id"> x</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> []</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> mulrfctE</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> pointedType</span>) (<span class="id">K</span><span class="id"> :</span><span class="id"> ringType</span>) (<span class="id">f</span><span class="id"> g</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> K</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">f</span><span class="id"> *</span><span class="id"> g</span><span class="id"> =</span> (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> f</span><span class="id"> x</span><span class="id"> *</span><span class="id"> g</span><span class="id"> x</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> []</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> scalrfctE</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> pointedType</span>) (<span class="id">K</span><span class="id"> :</span><span class="id"> ringType</span>) (<span class="id">L</span><span class="id"> :</span><span class="id"> lmodType</span><span class="id"> K</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">k</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> L</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">k</span><span class="id"> *:</span><span class="id"> f</span><span class="id"> =</span> (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> :</span><span class="id"> T</span><span class="id"> =&gt;</span><span class="id"> k</span><span class="id"> *:</span><span class="id"> f</span><span class="id"> x</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> []</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> cstE</span> (<span class="id">T</span><span class="id"> T':</span><span class="gallina-kwd"> Type</span>) (<span class="id">x</span><span class="id"> :</span><span class="id"> T</span>)<span class="id"> :</span><span class="id"> cst</span><span class="id"> x</span><span class="id"> =</span><span class="gallina-kwd"> fun</span><span class="id"> _:</span><span class="id"> T'</span><span class="id"> =&gt;</span><span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> []</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> exprfctE</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> pointedType</span>) (<span class="id">K</span><span class="id"> :</span><span class="id"> ringType</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> K</span>)<span class="id"> n</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">f</span><span class="id"> ^+</span><span class="id"> n</span><span class="id"> =</span> (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> f</span><span class="id"> x</span><span class="id"> ^+</span><span class="id"> n</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> elim:</span><span class="id"> n</span><span class="id"> =&gt;</span><span class="id"> [|n</span><span class="id"> h];</span><span class="id"> rewrite</span><span class="id"> funeqE=&gt;</span><span class="id"> ?;</span><span class="id"> rewrite</span><span class="id"> ?expr0</span><span class="id"> ?exprS</span><span class="id"> ?h</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> compE</span> (<span class="id">T1</span><span class="id"> T2</span><span class="id"> T3</span><span class="id"> :</span><span class="gallina-kwd"> Type</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> T1</span><span class="id"> -&gt;</span><span class="id"> T2</span>) (<span class="id">g</span><span class="id"> :</span><span class="id"> T2</span><span class="id"> -&gt;</span><span class="id"> T3</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">g</span><span class="id"> \o</span><span class="id"> f</span><span class="id"> =</span><span class="gallina-kwd"> fun</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> g</span> (<span class="id">f</span><span class="id"> x</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> []</span>. Qed.</div></details>
<br/>
<span class="vernacular">Definition</span><span class="id"> fctE</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;(<span class="id">cstE,</span><span class="id"> compE,</span><span class="id"> opprfctE,</span><span class="id"> addrfctE,</span><span class="id"> mulrfctE,</span><span class="id"> scalrfctE,</span><span class="id"> exprfctE</span>).<br/>
<br/>
<span class="vernacular">End</span><span class="id"> function_space_lemmas</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> inv_funK</span><span class="id"> T</span> (<span class="id">R</span><span class="id"> :</span><span class="id"> unitRingType</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> R</span>)<span class="id"> :</span><span class="id"> f\^-1\^-1%R</span><span class="id"> =</span><span class="id"> f</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> apply/funeqP</span><span class="id"> =&gt;</span><span class="id"> x;</span><span class="id"> rewrite</span><span class="id"> /inv_fun/=</span><span class="id"> GRing</span>.<span class="id">invrK</span>. Qed.</div></details>

      <div class="footer"><hr/>Generated by <a href="https://github.com/yoshihiro503/coq2html/">a fork of coq2html</a></div>
    </div>
  </div>
    </main>
</body>
</html>
