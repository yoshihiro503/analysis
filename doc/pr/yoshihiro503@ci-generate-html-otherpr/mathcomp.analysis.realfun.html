
<!DOCTYPE html>
<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Module mathcomp.analysis.realfun</title>
<meta name="description" content="Documentation of Coq module mathcomp.analysis.realfun" />
<link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.css">
<script src="https://cdn.jsdelivr.net/npm/markdown-it/dist/markdown-it.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/markdown-it-texmath/texmath.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/darkmode-js@1.5.7/lib/darkmode-js.min.js"></script>
<link href="coq2html.css" rel="stylesheet" type="text/css" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script type="text/javascript" src="coq2html.js"> </script>
</head>

<body onload="init()">

  <main>
    <div class="sidebar">
      <h2>Files</h2>
      
    </div>

  <div class="coq">

    <div class="content">
      <p><a href="./index.html">Top</a></p>
      <h1 class="title">Module mathcomp.analysis.realfun</h1>
<span class="vernacular">From</span><span class="id"> HB</span><span class="vernacular"> Require</span><span class="vernacular"> Import</span><span class="id"> structures</span>.<br/>
<span class="vernacular">From</span><span class="id"> mathcomp</span><span class="vernacular"> Require</span><span class="vernacular"> Import</span><span class="id"> all_ssreflect</span><span class="id"> ssralg</span><span class="id"> ssrint</span><span class="id"> ssrnum</span><span class="id"> archimedean</span>.<br/>
<span class="vernacular">From</span><span class="id"> mathcomp</span><span class="vernacular"> Require</span><span class="vernacular"> Import</span><span class="id"> matrix</span><span class="id"> interval</span><span class="id"> zmodp</span><span class="id"> vector</span><span class="id"> fieldext</span><span class="id"> falgebra</span>.<br/>
<span class="vernacular">From</span><span class="id"> mathcomp</span><span class="vernacular"> Require</span><span class="vernacular"> Import</span><span class="id"> finmap</span>.<br/>
<span class="vernacular">From</span><span class="id"> mathcomp</span><span class="vernacular"> Require</span><span class="vernacular"> Import</span><span class="id"> mathcomp_extra</span><span class="id"> boolp</span><span class="id"> classical_sets</span><span class="id"> functions</span>.<br/>
<span class="vernacular">From</span><span class="id"> mathcomp</span><span class="vernacular"> Require</span><span class="vernacular"> Import</span><span class="id"> cardinality</span><span class="id"> ereal</span><span class="id"> reals</span><span class="id"> signed</span>.<br/>
<span class="vernacular">From</span><span class="id"> mathcomp</span><span class="vernacular"> Require</span><span class="vernacular"> Import</span><span class="id"> topology</span><span class="id"> prodnormedzmodule</span><span class="id"> tvs</span><span class="id"> normedtype</span><span class="id"> derive</span>.<br/>
<span class="vernacular">From</span><span class="id"> mathcomp</span><span class="vernacular"> Require</span><span class="vernacular"> Import</span><span class="id"> sequences</span><span class="id"> real_interval</span>.<br/>
<br/>
<div class="ssrdoc md">
# Real-valued functions over reals

This file provides properties of standard real-valued functions over real
numbers (e.g., the continuity of the inverse of a continuous function).

```
     nondecreasing_fun f == the function f is non-decreasing
     nonincreasing_fun f == the function f is non-increasing
        increasing_fun f == the function f is (strictly) increasing
        decreasing_fun f == the function f is (strictly) decreasing

  derivable_oo_continuous_bnd f x y == f is derivable in `]x, y[ and
                            continuous up to the boundary, i.e.,
                            f @ x^'+ --&gt; f x  and  f @ y^'- --&gt; f y

     itv_partition a b s == s is a partition of the interval `[a, b]
      itv_partitionL s c == the left side of splitting a partition at c
      itv_partitionR s c == the right side of splitting a partition at c
       variation a b f s == the sum of f at all points in the partition s
        variations a b f == the set of all variations of f between a and b
 bounded_variation a b f == all variations of f are bounded
   total_variation a b f == the sup over all variations of f from a to b
            neg_tv a f x == the decreasing component of f
            pos_tv a f x == the increasing component of f

```

* Limit superior and inferior for functions:
```
  lime_sup f a/lime_inf f a == limit sup/inferior of the extended real-
                            valued function f at point a
```

</div>
<br/>
<span class="gallina-kwd">Set</span><span class="vernacular"> Implicit</span><span class="vernacular"> Arguments</span>.<br/>
<span class="vernacular">Unset</span><span class="vernacular"> Strict</span><span class="vernacular"> Implicit</span>.<br/>
<span class="vernacular">Unset</span><span class="vernacular"> Printing</span><span class="vernacular"> Implicit</span><span class="vernacular"> Defensive</span>.<br/>
<br/>
<span class="vernacular">Import</span><span class="id"> Order</span>.<span class="id">TTheory</span><span class="id"> GRing</span>.<span class="id">Theory</span><span class="id"> Num</span>.<span class="id">Def</span><span class="id"> Num</span>.<span class="id">Theory</span>.<br/>
<span class="vernacular">Import</span><span class="id"> numFieldTopology</span>.<span class="vernacular">Exports</span>.<br/>
<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> classical_set_scope</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ring_scope</span>.<br/>
<br/>
<span class="vernacular">Import</span><span class="id"> numFieldNormedType</span>.<span class="vernacular">Exports</span>.<br/>
<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;'nondecreasing_fun' f&quot;</span><span class="id"> :=</span> (<span class="id">{homo</span><span class="id"> f</span><span class="id"> :</span><span class="id"> n</span><span class="id"> m</span><span class="id"> /</span> (<span class="id">n</span><span class="id"> &lt;=</span><span class="id"> m</span>)<span class="id">%O</span><span class="id"> &gt;-&gt;</span> (<span class="id">n</span><span class="id"> &lt;=</span><span class="id"> m</span>)<span class="id">%O}</span>)<br/>
&nbsp;&nbsp;(<span class="gallina-kwd">at</span><span class="id"> level</span><span class="id"> 10</span>).<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;'nonincreasing_fun' f&quot;</span><span class="id"> :=</span> (<span class="id">{homo</span><span class="id"> f</span><span class="id"> :</span><span class="id"> n</span><span class="id"> m</span><span class="id"> /</span> (<span class="id">n</span><span class="id"> &lt;=</span><span class="id"> m</span>)<span class="id">%O</span><span class="id"> &gt;-&gt;</span> (<span class="id">n</span><span class="id"> &gt;=</span><span class="id"> m</span>)<span class="id">%O}</span>)<br/>
&nbsp;&nbsp;(<span class="gallina-kwd">at</span><span class="id"> level</span><span class="id"> 10</span>).<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;'increasing_fun' f&quot;</span><span class="id"> :=</span> (<span class="id">{mono</span><span class="id"> f</span><span class="id"> :</span><span class="id"> n</span><span class="id"> m</span><span class="id"> /</span> (<span class="id">n</span><span class="id"> &lt;=</span><span class="id"> m</span>)<span class="id">%O</span><span class="id"> &gt;-&gt;</span> (<span class="id">n</span><span class="id"> &lt;=</span><span class="id"> m</span>)<span class="id">%O}</span>)<br/>
&nbsp;&nbsp;(<span class="gallina-kwd">at</span><span class="id"> level</span><span class="id"> 10</span>).<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;'decreasing_fun' f&quot;</span><span class="id"> :=</span> (<span class="id">{mono</span><span class="id"> f</span><span class="id"> :</span><span class="id"> n</span><span class="id"> m</span><span class="id"> /</span> (<span class="id">n</span><span class="id"> &lt;=</span><span class="id"> m</span>)<span class="id">%O</span><span class="id"> &gt;-&gt;</span> (<span class="id">n</span><span class="id"> &gt;=</span><span class="id"> m</span>)<span class="id">%O}</span>)<br/>
&nbsp;&nbsp;(<span class="gallina-kwd">at</span><span class="id"> level</span><span class="id"> 10</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> nondecreasing_funN</span><span class="id"> {R</span><span class="id"> :</span><span class="id"> realType}</span><span class="id"> a</span><span class="id"> b</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">{in</span><span class="id"> `[a,</span><span class="id"> b]</span><span class="id"> &amp;,</span><span class="id"> nondecreasing_fun</span><span class="id"> f}</span><span class="id"> &lt;-&gt;</span><br/>
&nbsp;&nbsp;<span class="id">{in</span><span class="id"> `[a,</span><span class="id"> b]</span><span class="id"> &amp;,</span><span class="id"> nonincreasing_fun</span> (<span class="id">\-</span><span class="id"> f</span>)<span class="id">}</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">split=&gt;</span><span class="id"> [h</span><span class="id"> m</span><span class="id"> n</span><span class="id"> mab</span><span class="id"> nab</span><span class="id"> mn|h</span><span class="id"> m</span><span class="id"> n</span><span class="id"> mab</span><span class="id"> nab</span><span class="id"> mn];</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> lerNr</span><span class="id"> opprK</span><span class="id"> h</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -</span>(<span class="id">opprK</span> (<span class="id">f</span><span class="id"> n</span>))<span class="id"> -lerNr</span><span class="id"> h</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> nonincreasing_funN</span><span class="id"> {R</span><span class="id"> :</span><span class="id"> realType}</span><span class="id"> a</span><span class="id"> b</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">{in</span><span class="id"> `[a,</span><span class="id"> b]</span><span class="id"> &amp;,</span><span class="id"> nonincreasing_fun</span><span class="id"> f}</span><span class="id"> &lt;-&gt;</span><br/>
&nbsp;&nbsp;<span class="id">{in</span><span class="id"> `[a,</span><span class="id"> b]</span><span class="id"> &amp;,</span><span class="id"> nondecreasing_fun</span> (<span class="id">\-</span><span class="id"> f</span>)<span class="id">}</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">apply:</span><span class="id"> iff_sym;</span><span class="id"> apply:</span> (<span class="id">iff_trans</span> (<span class="id">nondecreasing_funN</span><span class="id"> a</span><span class="id"> b</span> (<span class="id">\-</span><span class="id"> f</span>))).<br/>
<span class="id">rewrite</span><span class="id"> [in</span><span class="id"> X</span><span class="gallina-kwd"> in</span><span class="id"> _</span><span class="id"> &lt;-&gt;</span><span class="id"> X]</span>(_<span class="id"> :</span><span class="id"> f</span><span class="id"> =</span><span class="id"> \-</span> (<span class="id">\-</span><span class="id"> f</span>))<span class="id">//</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply/funext</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> opprK</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Section</span><span class="id"> fun_cvg</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> fun_cvg_realFieldType</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {R</span><span class="id"> :</span><span class="id"> realFieldType}</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> cvg_addrl</span> (<span class="id">M</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span><span class="id"> M</span><span class="id"> +</span><span class="id"> r</span><span class="id"> @[r</span><span class="id"> --&gt;</span><span class="id"> +oo]</span><span class="id"> --&gt;</span><span class="id"> +oo</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> P</span><span class="id"> [r</span><span class="id"> [rreal</span><span class="id"> rP]];</span><span class="gallina-kwd"> exists</span> (<span class="id">r</span><span class="id"> -</span><span class="id"> M</span>)<span class="id">;</span><span class="id"> split</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> realB//</span><span class="id"> num_real</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> m;</span><span class="id"> rewrite</span><span class="id"> ltrBlDl</span><span class="id"> =&gt;</span><span class="id"> /rP</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> cvg_addrr</span> (<span class="id">M</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span> (<span class="id">r</span><span class="id"> +</span><span class="id"> M</span>)<span class="id"> @[r</span><span class="id"> --&gt;</span><span class="id"> +oo]</span><span class="id"> --&gt;</span><span class="id"> +oo</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> under</span><span class="id"> [X</span><span class="gallina-kwd"> in</span><span class="id"> X</span><span class="id"> @</span><span class="id"> _]funext</span><span class="id"> =&gt;</span><span class="id"> n</span><span class="id"> do</span><span class="id"> rewrite</span><span class="id"> addrC;</span><span class="id"> exact:</span><span class="id"> cvg_addrl</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> cvg_centerr</span> (<span class="id">M</span><span class="id"> :</span><span class="id"> R</span>) (<span class="id">T</span><span class="id"> :</span><span class="id"> topologicalType</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> T</span>) (<span class="id">l</span><span class="id"> :</span><span class="id"> T</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;(<span class="id">f</span> (<span class="id">n</span><span class="id"> -</span><span class="id"> M</span>)<span class="id"> @[n</span><span class="id"> --&gt;</span><span class="id"> +oo]</span><span class="id"> --&gt;</span><span class="id"> l</span>)<span class="id"> =</span> (<span class="id">f</span><span class="id"> r</span><span class="id"> @[r</span><span class="id"> --&gt;</span><span class="id"> +oo]</span><span class="id"> --&gt;</span><span class="id"> l</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> propeqE;</span><span class="id"> split;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> cvg_comp;</span><span class="id"> exact:</span><span class="id"> cvg_addrr</span>.<br/>
<span class="id">gen</span><span class="id"> have</span><span class="id"> cD</span><span class="id"> :</span><span class="id"> f</span><span class="id"> l</span><span class="id"> /</span><span class="id"> f</span><span class="id"> r</span><span class="id"> @[r</span><span class="id"> --&gt;</span><span class="id"> +oo]</span><span class="id"> --&gt;</span><span class="id"> l</span><span class="id"> -&gt;</span><span class="id"> f</span> (<span class="id">n</span><span class="id"> +</span><span class="id"> M</span>)<span class="id"> @[n</span><span class="id"> --&gt;</span><span class="id"> +oo]</span><span class="id"> --&gt;</span><span class="id"> l</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> cvg_comp;</span><span class="id"> exact:</span><span class="id"> cvg_addrr</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> /cD</span><span class="id"> /=</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> under</span><span class="id"> [X</span><span class="gallina-kwd"> in</span><span class="id"> X</span><span class="id"> @</span><span class="id"> _</span><span class="id"> --&gt;</span><span class="id"> l]funext</span><span class="id"> =&gt;</span><span class="id"> n</span><span class="id"> do</span><span class="id"> rewrite</span><span class="id"> addrK</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> cvg_shiftr</span> (<span class="id">M</span><span class="id"> :</span><span class="id"> R</span>) (<span class="id">T</span><span class="id"> :</span><span class="id"> topologicalType</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> T</span>) (<span class="id">l</span><span class="id"> :</span><span class="id"> T</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;(<span class="id">f</span> (<span class="id">n</span><span class="id"> +</span><span class="id"> M</span>)<span class="id"> @[n</span><span class="id"> --&gt;</span><span class="id"> +oo]--&gt;</span><span class="id"> l</span>)<span class="id"> =</span> (<span class="id">f</span><span class="id"> r</span><span class="id"> @[r</span><span class="id"> --&gt;</span><span class="id"> +oo]</span><span class="id"> --&gt;</span><span class="id"> l</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> propeqE;</span><span class="id"> split;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> cvg_comp;</span><span class="id"> exact:</span><span class="id"> cvg_addrr</span>.<br/>
<span class="id">rewrite</span><span class="id"> -[X</span><span class="gallina-kwd"> in</span><span class="id"> X</span><span class="id"> -&gt;</span><span class="id"> _]</span>(<span class="id">cvg_centerr</span><span class="id"> M</span>)<span class="id">;</span><span class="id"> apply:</span><span class="id"> cvg_trans</span><span class="id"> =&gt;</span><span class="id"> /=</span>.<br/>
<span class="id">apply:</span><span class="id"> near_eq_cvg;</span><span class="id"> near</span><span class="id"> do</span><span class="id"> rewrite</span><span class="id"> subrK;</span><span class="gallina-kwd"> exists</span><span class="id"> M</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> num_real</span>.<br/>
<span class="id">Unshelve</span>.<span class="id"> all:</span><span class="gallina-kwd"> by</span><span class="id"> end_near</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> left_right_continuousP</span><span class="id"> {T</span><span class="id"> :</span><span class="id"> topologicalType}</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> T</span>)<span class="id"> x</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">f</span><span class="id"> @</span><span class="id"> x^'-</span><span class="id"> --&gt;</span><span class="id"> f</span><span class="id"> x</span><span class="id"> /\</span><span class="id"> f</span><span class="id"> @</span><span class="id"> x^'+</span><span class="id"> --&gt;</span><span class="id"> f</span><span class="id"> x</span><span class="id"> &lt;-&gt;</span><span class="id"> f</span><span class="id"> @</span><span class="id"> x</span><span class="id"> --&gt;</span><span class="id"> f</span><span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">split;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> cts;</span><span class="id"> split;</span><span class="id"> exact:</span><span class="id"> cvg_within_filter</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> [+</span><span class="id"> +]</span><span class="id"> U</span><span class="id"> /=</span><span class="id"> Uz</span><span class="id"> =&gt;</span><span class="id"> /</span>(_<span class="id"> U</span><span class="id"> Uz</span>)<span class="id"> +</span><span class="id"> /</span>(_<span class="id"> U</span><span class="id"> Uz</span>)<span class="id">;</span><span class="id"> near_simpl</span>.<br/>
<span class="id">rewrite</span><span class="id"> !near_withinE</span><span class="id"> =&gt;</span><span class="id"> lf</span><span class="id"> rf;</span><span class="id"> apply:</span><span class="id"> filter_app</span><span class="id"> lf;</span><span class="id"> apply:</span><span class="id"> filter_app</span><span class="id"> rf</span>.<br/>
<span class="id">near=&gt;</span><span class="id"> t</span><span class="id"> =&gt;</span><span class="id"> xlt</span><span class="id"> xgt;</span><span class="id"> have</span><span class="id"> :=</span><span class="id"> @real_leVge</span><span class="id"> R</span><span class="id"> x</span><span class="id"> t;</span><span class="id"> rewrite</span><span class="id"> !num_real</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> /</span>(_<span class="id"> isT</span><span class="id"> isT</span>)<span class="id"> /orP;</span><span class="id"> rewrite</span><span class="id"> !le_eqVlt</span><span class="id"> =&gt;</span><span class="id"> -[|]</span><span class="id"> /predU1P[|//]</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> &lt;-;</span><span class="id"> exact:</span><span class="id"> nbhs_singleton</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> -&gt;;</span><span class="id"> exact:</span><span class="id"> nbhs_singleton</span>.<br/>
<span class="id">Unshelve</span>.<span class="id"> all:</span><span class="gallina-kwd"> by</span><span class="id"> end_near</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> cvg_at_right_left_dnbhs</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> R</span>) (<span class="id">p</span><span class="id"> :</span><span class="id"> R</span>) (<span class="id">l</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">f</span><span class="id"> x</span><span class="id"> @[x</span><span class="id"> --&gt;</span><span class="id"> p^'+]</span><span class="id"> --&gt;</span><span class="id"> l</span><span class="id"> -&gt;</span><span class="id"> f</span><span class="id"> x</span><span class="id"> @[x</span><span class="id"> --&gt;</span><span class="id"> p^'-]</span><span class="id"> --&gt;</span><span class="id"> l</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">f</span><span class="id"> x</span><span class="id"> @[x</span><span class="id"> --&gt;</span><span class="id"> p^']</span><span class="id"> --&gt;</span><span class="id"> l</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> /cvgrPdist_le</span><span class="id"> fppl</span><span class="id"> /cvgrPdist_le</span><span class="id"> fpnl;</span><span class="id"> apply/cvgrPdist_le</span><span class="id"> =&gt;</span><span class="id"> e</span><span class="id"> e0</span>.<br/>
<span class="id">have</span><span class="id"> {fppl}[a</span><span class="id"> /=</span><span class="id"> a0</span><span class="id"> fppl]</span><span class="id"> :=</span><span class="id"> fppl</span><span class="id"> _</span><span class="id"> e0;</span><span class="id"> have</span><span class="id"> {fpnl}[b</span><span class="id"> /=</span><span class="id"> b0</span><span class="id"> fpnl]</span><span class="id"> :=</span><span class="id"> fpnl</span><span class="id"> _</span><span class="id"> e0</span>.<br/>
<span class="id">near=&gt;</span><span class="id"> t</span>.<br/>
<span class="id">have</span><span class="id"> :</span><span class="id"> t</span><span class="id"> !=</span><span class="id"> p</span><span class="gallina-kwd"> by</span><span class="id"> near:</span><span class="id"> t;</span><span class="id"> exact:</span><span class="id"> nbhs_dnbhs_neq</span>.<br/>
<span class="id">rewrite</span><span class="id"> neq_lt</span><span class="id"> =&gt;</span><span class="id"> /orP[tp|pt]</span>.<br/>
<span class="id">-</span><span class="id"> apply:</span><span class="id"> fpnl</span><span class="id"> =&gt;</span><span class="id"> //=;</span><span class="id"> near:</span><span class="id"> t</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">exists</span> (<span class="id">b</span><span class="id"> /</span><span class="id"> 2</span>)<span class="id"> =&gt;</span><span class="id"> //=;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> divr_gt0</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> z/=</span><span class="id"> +</span><span class="id"> _</span><span class="id"> =&gt;</span><span class="id"> /lt_le_trans;</span><span class="id"> apply</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> ler_pdivrMr//</span><span class="id"> ler_pMr//</span><span class="id"> ler1n</span>.<br/>
<span class="id">-</span><span class="id"> apply:</span><span class="id"> fppl</span><span class="id"> =&gt;//=;</span><span class="id"> near:</span><span class="id"> t</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">exists</span> (<span class="id">a</span><span class="id"> /</span><span class="id"> 2</span>)<span class="id"> =&gt;</span><span class="id"> //=;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> divr_gt0</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> z/=</span><span class="id"> +</span><span class="id"> _</span><span class="id"> =&gt;</span><span class="id"> /lt_le_trans;</span><span class="id"> apply</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> ler_pdivrMr//</span><span class="id"> ler_pMr//</span><span class="id"> ler1n</span>.<br/>
<span class="id">Unshelve</span>.<span class="id"> all:</span><span class="gallina-kwd"> by</span><span class="id"> end_near</span>. Qed.</div></details>
<span class="vernacular">End</span><span class="id"> fun_cvg_realFieldType</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> cvgr_fun_cvg_seq</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {R</span><span class="id"> :</span><span class="id"> realType}</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> cvg_at_rightP</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> R</span>) (<span class="id">p</span><span class="id"> l</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">f</span><span class="id"> x</span><span class="id"> @[x</span><span class="id"> --&gt;</span><span class="id"> p^'+]</span><span class="id"> --&gt;</span><span class="id"> l</span><span class="id"> &lt;-&gt;</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">forall</span><span class="id"> u</span><span class="id"> :</span><span class="id"> R^nat,</span> (<span class="gallina-kwd">forall</span><span class="id"> n,</span><span class="id"> u</span><span class="id"> n</span><span class="id"> &gt;</span><span class="id"> p</span>)<span class="id"> /\</span> (<span class="id">u</span><span class="id"> n</span><span class="id"> @[n</span><span class="id"> --&gt;</span><span class="id"> \oo]</span><span class="id"> --&gt;</span><span class="id"> p</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">f</span> (<span class="id">u</span><span class="id"> n</span>)<span class="id"> @[n</span><span class="id"> --&gt;</span><span class="id"> \oo]</span><span class="id"> --&gt;</span><span class="id"> l</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">split=&gt;</span><span class="id"> [/cvgrPdist_le</span><span class="id"> fpl</span><span class="id"> u</span><span class="id"> [up</span><span class="id"> /cvgrPdist_lt</span><span class="id"> ucvg]|pfl]</span>.<br/>
&nbsp;&nbsp;<span class="id">apply/cvgrPdist_le</span><span class="id"> =&gt;</span><span class="id"> e</span><span class="id"> e0</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> [r</span><span class="id"> /=</span><span class="id"> r0</span><span class="id"> {}fpl]</span><span class="id"> :=</span><span class="id"> fpl</span><span class="id"> _</span><span class="id"> e0;</span><span class="id"> have</span><span class="id"> [s</span><span class="id"> /=</span><span class="id"> s0</span><span class="id"> {}ucvg]</span><span class="id"> :=</span><span class="id"> ucvg</span><span class="id"> _</span><span class="id"> r0</span>.<br/>
&nbsp;&nbsp;<span class="id">near=&gt;</span><span class="id"> t;</span><span class="id"> apply:</span><span class="id"> fpl</span><span class="id"> =&gt;</span><span class="id"> //=;</span><span class="id"> apply:</span><span class="id"> ucvg</span><span class="id"> =&gt;</span><span class="id"> /=</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> near:</span><span class="id"> t;</span><span class="gallina-kwd"> exists</span><span class="id"> s</span>.<br/>
<span class="id">apply:</span><span class="id"> contrapT</span><span class="id"> =&gt;</span><span class="id"> fpl;</span><span class="id"> move:</span><span class="id"> pfl;</span><span class="id"> apply/existsNP</span>.<br/>
<span class="id">suff:</span><span class="gallina-kwd"> exists2</span><span class="id"> x</span><span class="id"> :</span><span class="id"> R</span><span class="id"> ^nat,</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="gallina-kwd">forall</span><span class="id"> k,</span><span class="id"> x</span><span class="id"> k</span><span class="id"> &gt;</span><span class="id"> p</span>)<span class="id"> /\</span><span class="id"> x</span><span class="id"> n</span><span class="id"> @[n</span><span class="id"> --&gt;</span><span class="id"> \oo]</span><span class="id"> --&gt;</span><span class="id"> p</span><span class="id"> &amp;</span><span class="id"> ~</span><span class="id"> f</span> (<span class="id">x</span><span class="id"> n</span>)<span class="id"> @[n</span><span class="id"> --&gt;</span><span class="id"> \oo]</span><span class="id"> --&gt;</span><span class="id"> l</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> [x_]</span><span class="id"> h;</span><span class="gallina-kwd"> exists</span><span class="id"> x_;</span><span class="id"> exact/not_implyP</span>.<br/>
<span class="id">have</span><span class="id"> [e</span><span class="id"> He]</span><span class="id"> :</span><span class="gallina-kwd"> exists</span><span class="id"> e</span><span class="id"> :</span><span class="id"> {posnum</span><span class="id"> R},</span><span class="gallina-kwd"> forall</span><span class="id"> d</span><span class="id"> :</span><span class="id"> {posnum</span><span class="id"> R},</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">exists</span><span class="id"> xn</span><span class="id"> :</span><span class="id"> R,</span><span class="id"> [/\</span><span class="id"> xn</span><span class="id"> &gt;</span><span class="id"> p,</span><span class="id"> `|xn</span><span class="id"> -</span><span class="id"> p|</span><span class="id"> &lt;</span><span class="id"> d%:num</span><span class="id"> &amp;</span><span class="id"> `|f</span><span class="id"> xn</span><span class="id"> -</span><span class="id"> l|</span><span class="id"> &gt;=</span><span class="id"> e%:num]</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> contrapT;</span><span class="id"> apply:</span><span class="id"> contra_not</span><span class="id"> fpl</span><span class="id"> =&gt;</span><span class="id"> /forallNP</span><span class="id"> h</span>.<br/>
&nbsp;&nbsp;<span class="id">apply/cvgrPdist_le</span><span class="id"> =&gt;</span><span class="id"> e</span><span class="id"> e0;</span><span class="id"> have</span><span class="id"> /existsNP[d]</span><span class="id"> :=</span><span class="id"> h</span> (<span class="id">PosNum</span><span class="id"> e0</span>).<br/>
&nbsp;&nbsp;<span class="id">move/forallNP</span><span class="id"> =&gt;</span><span class="id"> {}h;</span><span class="id"> near=&gt;</span><span class="id"> t</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> /not_and3P[abs|abs|/negP]</span><span class="id"> :=</span><span class="id"> h</span><span class="id"> t</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> exfalso;</span><span class="id"> apply:</span><span class="id"> abs;</span><span class="id"> near:</span><span class="id"> t;</span><span class="id"> exact:</span><span class="id"> nbhs_right_gt</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> exfalso;</span><span class="id"> apply:</span><span class="id"> abs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> near:</span><span class="id"> t;</span> <span class="gallina-kwd"> by</span><span class="gallina-kwd"> exists</span><span class="id"> d%:num</span><span class="id"> =&gt;</span><span class="id"> //=</span><span class="id"> z/=;</span><span class="id"> rewrite</span><span class="id"> distrC</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> -ltNge</span><span class="id"> distrC</span><span class="id"> =&gt;</span><span class="id"> /ltW</span>.<br/>
<span class="id">have</span><span class="id"> invn</span><span class="id"> n</span><span class="id"> :</span><span class="id"> 0</span><span class="id"> &lt;</span><span class="id"> n</span>.<span class="id">+1%:R^-1</span><span class="id"> :&gt;</span><span class="id"> R</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> invr_gt0</span>.<br/>
<span class="gallina-kwd">exists</span> (<span class="gallina-kwd">fun</span><span class="id"> n</span><span class="id"> =&gt;</span><span class="id"> sval</span> (<span class="id">cid</span> (<span class="id">He</span> (<span class="id">PosNum</span> (<span class="id">invn</span><span class="id"> n</span>))))).<br/>
&nbsp;&nbsp;<span class="id">split</span><span class="id"> =&gt;</span><span class="id"> [k|];</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> /sval/=;</span><span class="id"> case:</span><span class="id"> cid</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> []</span>.<br/>
&nbsp;&nbsp;<span class="id">apply/cvgrPdist_lt</span><span class="id"> =&gt;</span><span class="id"> r</span><span class="id"> r0;</span><span class="id"> near=&gt;</span><span class="id"> t</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> /sval/=;</span><span class="id"> case:</span><span class="id"> cid</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> [px</span><span class="id"> xpt</span><span class="id"> _]</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> distrC</span> (<span class="id">lt_le_trans</span><span class="id"> xpt</span>)<span class="id">//</span><span class="id"> -</span>(<span class="id">@invrK</span><span class="id"> _</span><span class="id"> r</span>)<span class="id"> lef_pV2</span><span class="id"> ?posrE</span><span class="id"> ?invr_gt0//</span>.<br/>
&nbsp;&nbsp;<span class="id">near:</span><span class="id"> t;</span><span class="gallina-kwd"> exists</span><span class="id"> `|ceil</span><span class="id"> r^-1|%N</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> s</span><span class="id"> /=</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -ltnS</span><span class="id"> -</span>(<span class="id">@ltr_nat</span><span class="id"> R</span>)<span class="id"> =&gt;</span><span class="id"> /ltW;</span><span class="id"> apply:</span><span class="id"> le_trans</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> natr_absz</span><span class="id"> gtr0_norm</span><span class="id"> -?ceil_gt0</span><span class="id"> ?invr_gt0//</span><span class="id"> ceil_ge</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> /cvgrPdist_lt/</span>(_<span class="id"> e%:num</span> (<span class="id">ltac:</span>(<span class="gallina-kwd">by</span><span class="id"> []</span>)))<span class="id">[]</span><span class="id"> n</span><span class="id"> _</span><span class="id"> /</span>(_<span class="id"> _</span> (<span class="id">leqnn</span><span class="id"> _</span>)).<br/>
<span class="id">rewrite</span><span class="id"> /sval/=;</span><span class="id"> case:</span><span class="id"> cid</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> x</span><span class="id"> [px</span><span class="id"> xpn]</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> leNgt</span><span class="id"> distrC</span><span class="id"> =&gt;</span><span class="id"> /negP</span>.<br/>
<span class="id">Unshelve</span>.<span class="id"> all:</span><span class="gallina-kwd"> by</span><span class="id"> end_near</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> cvg_at_leftP</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> R</span>) (<span class="id">p</span><span class="id"> l</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">f</span><span class="id"> x</span><span class="id"> @[x</span><span class="id"> --&gt;</span><span class="id"> p^'-]</span><span class="id"> --&gt;</span><span class="id"> l</span><span class="id"> &lt;-&gt;</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">forall</span><span class="id"> u</span><span class="id"> :</span><span class="id"> R^nat,</span> (<span class="gallina-kwd">forall</span><span class="id"> n,</span><span class="id"> u</span><span class="id"> n</span><span class="id"> &lt;</span><span class="id"> p</span>)<span class="id"> /\</span><span class="id"> u</span><span class="id"> n</span><span class="id"> @[n</span><span class="id"> --&gt;</span><span class="id"> \oo]</span><span class="id"> --&gt;</span><span class="id"> p</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">f</span> (<span class="id">u</span><span class="id"> n</span>)<span class="id"> @[n</span><span class="id"> --&gt;</span><span class="id"> \oo]</span><span class="id"> --&gt;</span><span class="id"> l</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">apply:</span> (<span class="id">iff_trans</span> (<span class="id">cvg_at_leftNP</span><span class="id"> f</span><span class="id"> p</span><span class="id"> l</span>)).<br/>
<span class="id">apply:</span> (<span class="id">iff_trans</span> (<span class="id">cvg_at_rightP</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span>)).<br/>
<span class="id">split=&gt;</span><span class="id"> [pfl</span><span class="id"> u</span><span class="id"> [pu</span><span class="id"> up]|pfl</span><span class="id"> u</span><span class="id"> [pu</span><span class="id"> up]]</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -</span>(<span class="id">opprK</span><span class="id"> u</span>)<span class="id">;</span><span class="id"> apply:</span><span class="id"> pfl</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> split;</span><span class="id"> [move=&gt;</span><span class="id"> k;</span><span class="id"> rewrite</span><span class="id"> ltrNr</span><span class="id"> opprK//|exact/cvgNP]</span>.<br/>
<span class="id">apply:</span><span class="id"> pfl</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> split;</span><span class="id"> [move=&gt;</span><span class="id"> k;</span><span class="id"> rewrite</span><span class="id"> ltrNl//|apply/cvgNP</span><span class="id"> =&gt;</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> opprK]</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> cvgr_dnbhsP</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> R</span>) (<span class="id">p</span><span class="id"> l</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">f</span><span class="id"> x</span><span class="id"> @[x</span><span class="id"> --&gt;</span><span class="id"> p^']</span><span class="id"> --&gt;</span><span class="id"> l</span><span class="id"> &lt;-&gt;</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">forall</span><span class="id"> u</span><span class="id"> :</span><span class="id"> R^nat,</span> (<span class="gallina-kwd">forall</span><span class="id"> n,</span><span class="id"> u</span><span class="id"> n</span><span class="id"> !=</span><span class="id"> p</span>)<span class="id"> /\</span> (<span class="id">u</span><span class="id"> n</span><span class="id"> @[n</span><span class="id"> --&gt;</span><span class="id"> \oo]</span><span class="id"> --&gt;</span><span class="id"> p</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">f</span> (<span class="id">u</span><span class="id"> n</span>)<span class="id"> @[n</span><span class="id"> --&gt;</span><span class="id"> \oo]</span><span class="id"> --&gt;</span><span class="id"> l</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">split=&gt;</span><span class="id"> [/cvgrPdist_le</span><span class="id"> fpl</span><span class="id"> u</span><span class="id"> [up</span><span class="id"> /cvgrPdist_lt</span><span class="id"> put]|pfl]</span>.<br/>
&nbsp;&nbsp;<span class="id">apply/cvgrPdist_le</span><span class="id"> =&gt;</span><span class="id"> e</span><span class="id"> /fpl</span><span class="id"> [r</span><span class="id"> /=]</span><span class="id"> /put[n</span><span class="id"> _</span><span class="id"> {}put]</span><span class="id"> {}fpl</span>.<br/>
&nbsp;&nbsp;<span class="id">near=&gt;</span><span class="id"> t;</span><span class="id"> apply:</span><span class="id"> fpl</span><span class="id"> =&gt;</span><span class="id"> //=;</span><span class="id"> apply:</span><span class="id"> put</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> near:</span><span class="id"> t;</span><span class="id"> exact:</span><span class="id"> nbhs_infty_ge</span>.<br/>
<span class="id">apply:</span><span class="id"> cvg_at_right_left_dnbhs</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> apply/cvg_at_rightP</span><span class="id"> =&gt;</span><span class="id"> u</span><span class="id"> [pu</span><span class="id"> ?];</span><span class="id"> apply:</span><span class="id"> pfl;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> n;</span><span class="id"> rewrite</span><span class="id"> gt_eqF</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> apply/cvg_at_leftP</span><span class="id"> =&gt;</span><span class="id"> u</span><span class="id"> [pu</span><span class="id"> ?];</span><span class="id"> apply:</span><span class="id"> pfl;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> n;</span><span class="id"> rewrite</span><span class="id"> lt_eqF</span>.<br/>
<span class="id">Unshelve</span>.<span class="id"> all:</span><span class="id"> end_near</span>. Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> cvgr_fun_cvg_seq</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> cvge_fun_cvg_seq</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {R</span><span class="id"> :</span><span class="id"> realType}</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> cvge_at_rightP</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>) (<span class="id">p</span><span class="id"> l</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">f</span><span class="id"> x</span><span class="id"> @[x</span><span class="id"> --&gt;</span><span class="id"> p^'+]</span><span class="id"> --&gt;</span><span class="id"> l%:E</span><span class="id"> &lt;-&gt;</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">forall</span><span class="id"> u</span><span class="id"> :</span><span class="id"> R^nat,</span> (<span class="gallina-kwd">forall</span><span class="id"> n,</span><span class="id"> u</span><span class="id"> n</span><span class="id"> &gt;</span><span class="id"> p</span>)<span class="id"> /\</span><span class="id"> u</span><span class="id"> n</span><span class="id"> @[n</span><span class="id"> --&gt;</span><span class="id"> \oo]</span><span class="id"> --&gt;</span><span class="id"> p</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">f</span> (<span class="id">u</span><span class="id"> n</span>)<span class="id"> @[n</span><span class="id"> --&gt;</span><span class="id"> \oo]</span><span class="id"> --&gt;</span><span class="id"> l%:E</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">split=&gt;</span><span class="id"> [/fine_cvgP</span><span class="id"> [ffin_num</span><span class="id"> fpl]</span><span class="id"> u</span><span class="id"> [pu</span><span class="id"> up]|h]</span>.<br/>
&nbsp;&nbsp;<span class="id">apply/fine_cvgP;</span><span class="id"> split;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> move/cvg_at_rightP</span><span class="id"> :</span><span class="id"> fpl;</span><span class="id"> exact</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> [e</span><span class="id"> /=</span><span class="id"> e0</span><span class="id"> {}ffin_num]</span><span class="id"> :=</span><span class="id"> ffin_num</span>.<br/>
&nbsp;&nbsp;<span class="id">move/cvgrPdist_lt</span><span class="id"> :</span><span class="id"> up</span><span class="id"> =&gt;</span><span class="id"> /</span>(_<span class="id"> _</span><span class="id"> e0</span>)<span class="id">[s</span><span class="id"> /=</span><span class="id"> s0</span><span class="id"> {}up];</span><span class="id"> near=&gt;</span><span class="id"> t</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> ffin_num</span><span class="id"> =&gt;</span><span class="id"> //=;</span><span class="id"> apply:</span><span class="id"> up</span><span class="id"> =&gt;</span><span class="id"> /=;</span><span class="id"> near:</span><span class="id"> t;</span><span class="gallina-kwd"> exists</span><span class="id"> s</span>.<br/>
<span class="id">suff</span><span class="id"> H</span><span class="id"> :</span><span class="id"> \forall</span><span class="id"> F</span><span class="id"> \near</span><span class="id"> p^'+,</span><span class="id"> f</span><span class="id"> F</span><span class="id"> \is</span><span class="id"> a</span><span class="id"> fin_num</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply/fine_cvgP;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> apply/cvg_at_rightP</span><span class="id"> =&gt;</span><span class="id"> u</span><span class="id"> /h</span><span class="id"> /fine_cvgP[]</span>.<br/>
<span class="id">apply:</span><span class="id"> contrapT</span><span class="id"> =&gt;</span><span class="id"> /not_near_at_rightP</span><span class="id"> abs</span>.<br/>
<span class="id">have</span><span class="id"> invn</span><span class="id"> n</span><span class="id"> :</span><span class="id"> 0</span><span class="id"> &lt;</span><span class="id"> n</span>.<span class="id">+1%:R^-1</span><span class="id"> :&gt;</span><span class="id"> R</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> invr_gt0</span>.<br/>
<span class="id">pose</span><span class="id"> y_</span><span class="id"> n</span><span class="id"> :=</span><span class="id"> sval</span> (<span class="id">cid2</span> (<span class="id">abs</span> (<span class="id">PosNum</span> (<span class="id">invn</span><span class="id"> n</span>)))).<br/>
<span class="id">have</span><span class="id"> py_</span><span class="id"> k</span><span class="id"> :</span><span class="id"> p</span><span class="id"> &lt;</span><span class="id"> y_</span><span class="id"> k</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> /y_</span><span class="id"> /sval/=;</span><span class="id"> case:</span><span class="id"> cid2</span><span class="id"> =&gt;</span><span class="id"> //=</span><span class="id"> x</span><span class="id"> /andP[]</span>.<br/>
<span class="id">have</span><span class="id"> y_p</span><span class="id"> :</span><span class="id"> y_</span><span class="id"> n</span><span class="id"> @[n</span><span class="id"> --&gt;</span><span class="id"> \oo]</span><span class="id"> --&gt;</span><span class="id"> p</span>.<br/>
&nbsp;&nbsp;<span class="id">apply/cvgrPdist_lt</span><span class="id"> =&gt;</span><span class="id"> e</span><span class="id"> e0;</span><span class="id"> near=&gt;</span><span class="id"> t</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> ltr0_norm//</span><span class="id"> ?subr_lt0//</span><span class="id"> opprB</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> /y_</span><span class="id"> /sval/=;</span><span class="id"> case:</span><span class="id"> cid2</span><span class="id"> =&gt;</span><span class="id"> //=</span><span class="id"> x</span><span class="id"> /andP[_</span><span class="id"> +</span><span class="id"> _]</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> ltrBlDr</span><span class="id"> =&gt;</span><span class="id"> /lt_le_trans;</span><span class="id"> apply</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> addrC</span><span class="id"> lerD2r</span><span class="id"> -</span>(<span class="id">invrK</span><span class="id"> e</span>)<span class="id"> lef_pV2//</span><span class="id"> ?posrE</span><span class="id"> ?invr_gt0//</span>.<br/>
&nbsp;&nbsp;<span class="id">near:</span><span class="id"> t</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">exists</span><span class="id"> `|ceil</span><span class="id"> e^-1|%N</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> k</span><span class="id"> /=</span><span class="id"> ek</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> (<span class="id">le_trans</span> (<span class="id">ceil_ge</span><span class="id"> _</span>))<span class="id">//</span> (<span class="id">@le_trans</span><span class="id"> _</span><span class="id"> _</span><span class="id"> `|ceil</span><span class="id"> e^-1|%:~R</span>)<span class="id">//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> ger0_norm</span><span class="id"> -?ceil_ge0//</span> (<span class="id">lt_le_trans</span> (<span class="id">ltrN10</span><span class="id"> _</span>))<span class="id">//</span><span class="id"> invr_ge0//</span><span class="id"> ltW</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move:</span><span class="id"> ek;rewrite</span><span class="id"> -</span>(<span class="id">leq_add2r</span><span class="id"> 1</span>)<span class="id"> !addn1</span><span class="id"> -</span>(<span class="id">ltr_nat</span><span class="id"> R</span>)<span class="id"> =&gt;</span><span class="id"> /ltW</span>.<br/>
<span class="id">have</span><span class="id"> /fine_cvgP[[m</span><span class="id"> _</span><span class="id"> mfy_]</span><span class="id"> /=</span><span class="id"> _]</span><span class="id"> :=</span><span class="id"> h</span><span class="id"> _</span> (<span class="id">conj</span><span class="id"> py_</span><span class="id"> y_p</span>).<br/>
<span class="id">near</span><span class="id"> \oo</span><span class="id"> =&gt;</span><span class="id"> n</span>.<br/>
<span class="id">have</span><span class="id"> mn</span><span class="id"> :</span> (<span class="id">m</span><span class="id"> &lt;=</span><span class="id"> n</span>)<span class="id">%N</span><span class="gallina-kwd"> by</span><span class="id"> near:</span><span class="id"> n;</span><span class="gallina-kwd"> exists</span><span class="id"> m</span>.<br/>
<span class="id">have</span><span class="id"> {mn}</span><span class="id"> :=</span><span class="id"> mfy_</span><span class="id"> _</span><span class="id"> mn</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /y_</span><span class="id"> /sval;</span><span class="id"> case:</span><span class="id"> cid2</span><span class="id"> =&gt;</span><span class="id"> /=</span><span class="id"> x</span><span class="id"> _</span>.<br/>
<span class="id">Unshelve</span>.<span class="id"> all:</span><span class="gallina-kwd"> by</span><span class="id"> end_near</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> cvge_at_leftP</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>) (<span class="id">p</span><span class="id"> l</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">f</span><span class="id"> x</span><span class="id"> @[x</span><span class="id"> --&gt;</span><span class="id"> p^'-]</span><span class="id"> --&gt;</span><span class="id"> l%:E</span><span class="id"> &lt;-&gt;</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">forall</span><span class="id"> u</span><span class="id"> :</span><span class="id"> R^nat,</span> (<span class="gallina-kwd">forall</span><span class="id"> n,</span><span class="id"> u</span><span class="id"> n</span><span class="id"> &lt;</span><span class="id"> p</span>)<span class="id"> /\</span><span class="id"> u</span><span class="id"> n</span><span class="id"> @[n</span><span class="id"> --&gt;</span><span class="id"> \oo]</span><span class="id"> --&gt;</span><span class="id"> p</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">f</span> (<span class="id">u</span><span class="id"> n</span>)<span class="id"> @[n</span><span class="id"> --&gt;</span><span class="id"> \oo]</span><span class="id"> --&gt;</span><span class="id"> l%:E</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">apply:</span> (<span class="id">iff_trans</span> (<span class="id">cvg_at_leftNP</span><span class="id"> f</span><span class="id"> p</span><span class="id"> l%:E</span>)).<br/>
<span class="id">apply:</span> (<span class="id">iff_trans</span> (<span class="id">cvge_at_rightP</span><span class="id"> _</span><span class="id"> _</span><span class="id"> l</span>))<span class="id">;</span><span class="id"> split=&gt;</span><span class="id"> h</span><span class="id"> u</span><span class="id"> [up</span><span class="id"> pu]</span>.<br/>
<span class="id">-</span><span class="id"> rewrite</span> (_<span class="id"> :</span><span class="id"> u</span><span class="id"> =</span><span class="id"> \-</span> (<span class="id">\-</span><span class="id"> u</span>))<span class="id">%R;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> apply/funext</span><span class="id"> =&gt;</span><span class="id"> ?/=;</span><span class="id"> rewrite</span><span class="id"> opprK</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> h;</span><span class="id"> split;</span><span class="id"> [by</span><span class="id"> move=&gt;</span><span class="id"> n;</span><span class="id"> rewrite</span><span class="id"> ltrNl</span><span class="id"> opprK|exact:</span><span class="id"> cvgN]</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> h;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> [n|];</span><span class="id"> [rewrite</span><span class="id"> ltrNl|move/cvgN</span><span class="id"> :</span><span class="id"> pu;</span><span class="id"> rewrite</span><span class="id"> opprK]</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> cvge_fun_cvg_seq</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> cvgr_fun_dvg_seq</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {R</span><span class="id"> :</span><span class="id"> realType}</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> cvg_pinftyP</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> R</span>) (<span class="id">l</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">f</span><span class="id"> x</span><span class="id"> @[x</span><span class="id"> --&gt;</span><span class="id"> +oo]</span><span class="id"> --&gt;</span><span class="id"> l</span><span class="id"> &lt;-&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">forall</span><span class="id"> u</span><span class="id"> :</span><span class="id"> R^nat,</span> (<span class="id">u</span><span class="id"> n</span><span class="id"> @[n</span><span class="id"> --&gt;</span><span class="id"> \oo]</span><span class="id"> --&gt;</span><span class="id"> +oo</span>)<span class="id"> -&gt;</span><span class="id"> f</span> (<span class="id">u</span><span class="id"> n</span>)<span class="id"> @[n</span><span class="id"> --&gt;</span><span class="id"> \oo]</span><span class="id"> --&gt;</span><span class="id"> l</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">split;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> ?</span><span class="id"> ?</span><span class="id"> /cvg_comp;</span><span class="id"> exact</span>.<br/>
<span class="id">apply:</span><span class="id"> contraPP</span><span class="id"> =&gt;</span><span class="id"> noncvg_f;</span><span class="id"> apply/existsNP</span>.<br/>
<span class="id">under</span><span class="id"> eq_exists</span><span class="id"> do</span><span class="id"> rewrite</span><span class="id"> not_implyE;</span><span class="id"> apply/exists2P</span>.<br/>
<span class="id">suff</span><span class="id"> [e</span><span class="id"> e_sep]</span><span class="id"> :</span><span class="gallina-kwd"> exists</span><span class="id"> e</span><span class="id"> :</span><span class="id"> {posnum</span><span class="id"> R},</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">forall</span><span class="id"> A,</span><span class="gallina-kwd"> exists2</span><span class="id"> un,</span><span class="id"> A</span><span class="id"> &lt;</span><span class="id"> un</span><span class="id"> &amp;</span><span class="id"> e%:num</span><span class="id"> &lt;=</span><span class="id"> `|f</span><span class="id"> un</span><span class="id"> -</span><span class="id"> l|</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">exists</span> (<span class="gallina-kwd">fun</span><span class="id"> n</span><span class="id"> =&gt;</span><span class="id"> sval</span> (<span class="id">cid2</span> (<span class="id">e_sep</span><span class="id"> n%:R</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply/cvgryPgt</span><span class="id"> =&gt;</span><span class="id"> A;</span><span class="id"> near=&gt;</span><span class="id"> n;</span><span class="id"> case:</span><span class="id"> cid2</span><span class="id"> =&gt;</span><span class="id"> //=</span><span class="id"> r</span><span class="id"> nr</span><span class="id"> _</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span> (<span class="id">le_lt_trans</span><span class="id"> _</span><span class="id"> nr</span>)<span class="id">//;</span><span class="id"> near:</span><span class="id"> n;</span><span class="id"> exact:</span><span class="id"> nbhs_infty_ger</span>.<br/>
&nbsp;&nbsp;<span class="id">apply/cvgrPdistC_lt</span><span class="id"> =&gt;</span><span class="id"> /=</span><span class="id"> /</span>(_<span class="id"> e%:num</span><span class="id"> ltac:</span>(<span class="gallina-kwd">by</span><span class="id"> []</span>))<span class="id">[N</span><span class="id"> _</span><span class="id"> /</span>(_<span class="id"> _</span> (<span class="id">leqnn</span><span class="id"> N</span>))<span class="id">]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> case:</span><span class="id"> cid2</span><span class="id"> =&gt;</span><span class="id"> uN/=</span><span class="id"> _</span><span class="id"> /le_lt_trans</span><span class="id"> /[apply];</span><span class="id"> rewrite</span><span class="id"> ltxx</span>.<br/>
<span class="id">move:</span><span class="id"> noncvg_f</span><span class="id"> =&gt;</span><span class="id"> /cvgrPdistC_lt</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> -existsPNP</span><span class="id"> =&gt;</span><span class="id"> -[eps</span><span class="id"> eps_gt0]</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> /not_near_inftyP</span><span class="id"> eps_sep;</span><span class="gallina-kwd"> exists</span> (<span class="id">PosNum</span><span class="id"> eps_gt0</span>)<span class="id"> =&gt;</span><span class="id"> A</span><span class="id"> /=</span>.<br/>
<span class="id">have</span><span class="id"> [x</span><span class="id"> x_ltA</span><span class="id"> /negP</span><span class="id"> fxleps]</span><span class="id"> :=</span><span class="id"> eps_sep</span><span class="id"> _</span> (<span class="id">num_real</span><span class="id"> A</span>).<br/>
<span class="gallina-kwd">by</span><span class="gallina-kwd"> exists</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> rewrite</span><span class="id"> leNgt</span>.<br/>
<span class="id">Unshelve</span>.<span class="id"> all:</span><span class="gallina-kwd"> by</span><span class="id"> end_near</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> cvg_ninftyP</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> R</span>) (<span class="id">l</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">f</span><span class="id"> x</span><span class="id"> @[x</span><span class="id"> --&gt;</span><span class="id"> -oo]</span><span class="id"> --&gt;</span><span class="id"> l</span><span class="id"> &lt;-&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">forall</span><span class="id"> u</span><span class="id"> :</span><span class="id"> R^nat,</span> (<span class="id">u</span><span class="id"> n</span><span class="id"> @[n</span><span class="id"> --&gt;</span><span class="id"> \oo]</span><span class="id"> --&gt;</span><span class="id"> -oo</span>)<span class="id"> -&gt;</span><span class="id"> f</span> (<span class="id">u</span><span class="id"> n</span>)<span class="id"> @[n</span><span class="id"> --&gt;</span><span class="id"> \oo]</span><span class="id"> --&gt;</span><span class="id"> l</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> cvgyNP</span><span class="id"> cvg_pinftyP/=</span> (<span class="id">@bij_forall</span><span class="id"> R^nat</span><span class="id"> _</span><span class="id"> -%R</span>)<span class="id">//</span>.<br/>
<span class="id">have</span><span class="id"> u_opp</span> (<span class="id">u</span><span class="id"> :</span><span class="id"> R^nat</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;((<span class="id">-</span><span class="id"> u</span>)<span class="id"> n</span><span class="id"> @[n</span><span class="id"> --&gt;</span><span class="id"> \oo]</span><span class="id"> --&gt;</span><span class="id"> +oo</span>)<span class="id"> =</span> (<span class="id">u</span><span class="id"> n</span><span class="id"> @[n</span><span class="id"> --&gt;</span><span class="id"> \oo]</span><span class="id"> --&gt;</span><span class="id"> -oo</span>).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> propeqE</span><span class="id"> cvgNry</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> under</span><span class="id"> eq_forall</span><span class="id"> do</span><br/>
&nbsp;&nbsp;(<span class="id">rewrite</span><span class="id"> u_opp;</span><span class="id"> under</span> (<span class="id">eq_cvg</span><span class="id"> _</span> (<span class="id">nbhs</span><span class="id"> l</span>))<span class="id"> do</span><span class="id"> rewrite</span><span class="id"> opprK</span>).<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> cvgr_fun_dvg_seq</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> fun_cvg_realType</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {R</span><span class="id"> :</span><span class="id"> realType}</span>.<br/>
<span class="vernacular">Implicit</span><span class="id"> Types</span><span class="id"> f</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> R</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> nondecreasing_cvgr</span><span class="id"> f</span><span class="id"> :</span><span class="id"> nondecreasing_fun</span><span class="id"> f</span><span class="id"> -&gt;</span><span class="id"> has_ubound</span> (<span class="id">range</span><span class="id"> f</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">f</span><span class="id"> r</span><span class="id"> @[r</span><span class="id"> --&gt;</span><span class="id"> +oo]</span><span class="id"> --&gt;</span><span class="id"> sup</span> (<span class="id">range</span><span class="id"> f</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> ndf</span><span class="id"> ubf;</span><span class="id"> set</span><span class="id"> M</span><span class="id"> :=</span><span class="id"> sup</span> (<span class="id">range</span><span class="id"> f</span>).<br/>
<span class="id">have</span><span class="id"> supf</span><span class="id"> :</span><span class="id"> has_sup</span> (<span class="id">range</span><span class="id"> f</span>)<span class="gallina-kwd"> by</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="gallina-kwd"> exists</span> (<span class="id">f</span><span class="id"> 0</span>)<span class="id">,</span><span class="id"> 0</span>.<br/>
<span class="id">apply/cvgrPdist_le</span><span class="id"> =&gt;</span><span class="id"> _/posnumP[e]</span>.<br/>
<span class="id">have</span><span class="id"> [p</span><span class="id"> Mefp]</span><span class="id"> :</span><span class="gallina-kwd"> exists</span><span class="id"> p,</span><span class="id"> M</span><span class="id"> -</span><span class="id"> e%:num</span><span class="id"> &lt;=</span><span class="id"> f</span><span class="id"> p</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> [_</span><span class="id"> -[p</span><span class="id"> _]</span><span class="id"> &lt;-</span><span class="id"> /ltW</span><span class="id"> efp]</span><span class="id"> :=</span><span class="id"> sup_adherent</span> (<span class="id">gt0</span><span class="id"> e</span>)<span class="id"> supf</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="gallina-kwd"> exists</span><span class="id"> p;</span><span class="id"> rewrite</span><span class="id"> efp</span>.<br/>
<span class="id">near=&gt;</span><span class="id"> n;</span><span class="id"> have</span><span class="id"> pn</span><span class="id"> :</span><span class="id"> p</span><span class="id"> &lt;=</span><span class="id"> n</span><span class="gallina-kwd"> by</span><span class="id"> near:</span><span class="id"> n;</span><span class="id"> apply:</span><span class="id"> nbhs_pinfty_ge;</span><span class="id"> rewrite</span><span class="id"> num_real</span>.<br/>
<span class="id">rewrite</span><span class="id"> ler_distlC</span> (<span class="id">le_trans</span><span class="id"> Mefp</span> (<span class="id">ndf</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span>))<span class="id">//=</span> (<span class="id">@le_trans</span><span class="id"> _</span><span class="id"> _</span><span class="id"> M</span>)<span class="id"> ?lerDl//</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> have</span><span class="id"> /ubP</span><span class="id"> :=</span><span class="id"> sup_upper_bound</span><span class="id"> supf;</span><span class="id"> apply;</span><span class="gallina-kwd"> exists</span><span class="id"> n</span>.<br/>
<span class="id">Unshelve</span>.<span class="id"> all:</span><span class="gallina-kwd"> by</span><span class="id"> end_near</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> nonincreasing_at_right_cvgr</span><span class="id"> f</span><span class="id"> a</span> (<span class="id">b</span><span class="id"> :</span><span class="id"> itv_bound</span><span class="id"> R</span>)<span class="id"> :</span> (<span class="id">BRight</span><span class="id"> a</span><span class="id"> &lt;</span><span class="id"> b</span>)<span class="id">%O</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">{in</span><span class="id"> Interval</span> (<span class="id">BRight</span><span class="id"> a</span>)<span class="id"> b</span><span class="id"> &amp;,</span><span class="id"> nonincreasing_fun</span><span class="id"> f}</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">has_ubound</span> (<span class="id">f</span><span class="id"> @`</span><span class="id"> [set`</span><span class="id"> Interval</span> (<span class="id">BRight</span><span class="id"> a</span>)<span class="id"> b]</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">f</span><span class="id"> x</span><span class="id"> @[x</span><span class="id"> --&gt;</span><span class="id"> a</span><span class="id"> ^'+]</span><span class="id"> --&gt;</span><span class="id"> sup</span> (<span class="id">f</span><span class="id"> @`</span><span class="id"> [set`</span><span class="id"> Interval</span> (<span class="id">BRight</span><span class="id"> a</span>)<span class="id"> b]</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> ab</span><span class="id"> lef</span><span class="id"> ubf;</span><span class="id"> set</span><span class="id"> M</span><span class="id"> :=</span><span class="id"> sup</span><span class="id"> _</span>.<br/>
<span class="id">have</span><span class="id"> supf</span><span class="id"> :</span><span class="id"> has_sup</span><span class="id"> [set</span><span class="id"> f</span><span class="id"> x</span><span class="id"> |</span><span class="id"> x</span><span class="gallina-kwd"> in</span><span class="id"> [set`</span><span class="id"> Interval</span> (<span class="id">BRight</span><span class="id"> a</span>)<span class="id"> b]]</span>.<br/>
&nbsp;&nbsp;<span class="id">split</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> case:</span><span class="id"> b</span><span class="id"> ab</span><span class="id"> {lef</span><span class="id"> ubf</span><span class="id"> M}</span><span class="id"> =&gt;</span><span class="id"> [[|]</span><span class="id"> t</span><span class="id"> ta|[]]</span><span class="id"> //=</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> exists</span> (<span class="id">f</span> ((<span class="id">a</span><span class="id"> +</span><span class="id"> t</span>)<span class="id"> /</span><span class="id"> 2</span>))<span class="id">,</span> ((<span class="id">a</span><span class="id"> +</span><span class="id"> t</span>)<span class="id"> /</span><span class="id"> 2</span>)<span class="id"> =&gt;</span><span class="id"> //=</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> in_itv/=</span><span class="id"> !midf_lt</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> exists</span> (<span class="id">f</span> ((<span class="id">a</span><span class="id"> +</span><span class="id"> t</span>)<span class="id"> /</span><span class="id"> 2</span>))<span class="id">,</span> ((<span class="id">a</span><span class="id"> +</span><span class="id"> t</span>)<span class="id"> /</span><span class="id"> 2</span>)<span class="id"> =&gt;</span><span class="id"> //=</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> in_itv/=</span><span class="id"> midf_lt//</span><span class="id"> midf_le//</span><span class="id"> ltW</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="gallina-kwd"> exists</span> (<span class="id">f</span> (<span class="id">a</span><span class="id"> +</span><span class="id"> 1</span>))<span class="id">,</span> (<span class="id">a</span><span class="id"> +</span><span class="id"> 1</span>)<span class="id"> =&gt;</span><span class="id"> //=;</span><span class="id"> rewrite</span><span class="id"> in_itv/=</span><span class="id"> ltrDl</span><span class="id"> andbT</span>.<br/>
<span class="id">apply/cvgrPdist_le</span><span class="id"> =&gt;</span><span class="id"> _/posnumP[e]</span>.<br/>
<span class="id">have</span><span class="id"> {supf}</span><span class="id"> [p</span><span class="id"> [ap</span><span class="id"> pb]]</span><span class="id"> :</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">exists</span><span class="id"> p,</span><span class="id"> [/\</span><span class="id"> a</span><span class="id"> &lt;</span><span class="id"> p,</span> (<span class="id">BLeft</span><span class="id"> p</span><span class="id"> &lt;</span><span class="id"> b</span>)<span class="id">%O</span><span class="id"> &amp;</span><span class="id"> M</span><span class="id"> -</span><span class="id"> e%:num</span><span class="id"> &lt;=</span><span class="id"> f</span><span class="id"> p]</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> [_</span><span class="id"> -[p</span><span class="id"> apb]</span><span class="id"> &lt;-</span><span class="id"> /ltW</span><span class="id"> efp]</span><span class="id"> :=</span><span class="id"> sup_adherent</span> (<span class="id">gt0</span><span class="id"> e</span>)<span class="id"> supf</span>.<br/>
&nbsp;&nbsp;<span class="id">move:</span><span class="id"> apb;</span><span class="id"> rewrite</span><span class="id"> /=</span><span class="id"> in_itv/=</span><span class="id"> -[X</span><span class="gallina-kwd"> in</span><span class="id"> _</span><span class="id"> &amp;&amp;</span><span class="id"> X]/</span>(<span class="id">BLeft</span><span class="id"> p</span><span class="id"> &lt;</span><span class="id"> b</span>)<span class="id">%O</span><span class="id"> =&gt;</span><span class="id"> /andP[ap</span><span class="id"> pb]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="gallina-kwd"> exists</span><span class="id"> p;</span><span class="id"> split</span>.<br/>
<span class="id">rewrite</span><span class="id"> lerBlDr</span><span class="id"> {}/M</span>.<br/>
<span class="id">move:</span><span class="id"> b</span><span class="id"> ab</span><span class="id"> pb</span><span class="id"> lef</span><span class="id"> ubf</span><span class="id"> =&gt;</span><span class="id"> [[|]</span><span class="id"> b|[//|]]</span><span class="id"> ab</span><span class="id"> pb</span><span class="id"> lef</span><span class="id"> ubf;</span><span class="id"> set</span><span class="id"> M</span><span class="id"> :=</span><span class="id"> sup</span><span class="id"> _</span><span class="id"> =&gt;</span><span class="id"> Mefp</span>.<br/>
<span class="id">-</span><span class="id"> near=&gt;</span><span class="id"> r;</span><span class="id"> rewrite</span><span class="id"> ler_distl;</span><span class="id"> apply/andP;</span><span class="id"> split</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="id"> suff:</span><span class="id"> f</span><span class="id"> r</span><span class="id"> &lt;=</span><span class="id"> M</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> le_trans;</span><span class="id"> rewrite</span><span class="id"> lerBlDr</span><span class="id"> lerDl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> sup_ubound</span><span class="id"> =&gt;</span><span class="id"> //=;</span><span class="gallina-kwd"> exists</span><span class="id"> r</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> rewrite</span><span class="id"> in_itv/=</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply/andP;</span><span class="id"> split;</span><span class="id"> near:</span><span class="id"> r;</span><span class="id"> [exact:</span><span class="id"> nbhs_right_gt|exact:</span><span class="id"> nbhs_right_lt]</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="id"> rewrite</span> (<span class="id">le_trans</span><span class="id"> Mefp</span>)<span class="id">//</span><span class="id"> lerD2r</span><span class="id"> lef//=;</span><span class="id"> last</span><span class="id"> 2</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> in_itv/=</span><span class="id"> ap</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> near:</span><span class="id"> r;</span><span class="id"> exact:</span><span class="id"> nbhs_right_le</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply/andP;</span><span class="id"> split;</span><span class="id"> near:</span><span class="id"> r;</span><span class="id"> [exact:</span><span class="id"> nbhs_right_gt|exact:</span><span class="id"> nbhs_right_lt]</span>.<br/>
<span class="id">-</span><span class="id"> near=&gt;</span><span class="id"> r;</span><span class="id"> rewrite</span><span class="id"> ler_distl;</span><span class="id"> apply/andP;</span><span class="id"> split</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="id"> suff:</span><span class="id"> f</span><span class="id"> r</span><span class="id"> &lt;=</span><span class="id"> M</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> le_trans;</span><span class="id"> rewrite</span><span class="id"> lerBlDr</span><span class="id"> lerDl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> sup_ubound</span><span class="id"> =&gt;</span><span class="id"> //=;</span><span class="gallina-kwd"> exists</span><span class="id"> r</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> rewrite</span><span class="id"> in_itv/=</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply/andP;</span><span class="id"> split;</span><span class="id"> near:</span><span class="id"> r;</span><span class="id"> [exact:</span><span class="id"> nbhs_right_gt|exact:</span><span class="id"> nbhs_right_le]</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="id"> rewrite</span> (<span class="id">le_trans</span><span class="id"> Mefp</span>)<span class="id">//</span><span class="id"> lerD2r</span><span class="id"> lef//=;</span><span class="id"> last</span><span class="id"> 2</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> in_itv/=</span><span class="id"> ap</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> near:</span><span class="id"> r;</span><span class="id"> exact:</span><span class="id"> nbhs_right_le</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply/andP;</span><span class="id"> split;</span><span class="id"> near:</span><span class="id"> r;</span><span class="id"> [exact:</span><span class="id"> nbhs_right_gt|exact:</span><span class="id"> nbhs_right_le]</span>.<br/>
<span class="id">-</span><span class="id"> near=&gt;</span><span class="id"> r;</span><span class="id"> rewrite</span><span class="id"> ler_distl;</span><span class="id"> apply/andP;</span><span class="id"> split</span>.<br/>
&nbsp;&nbsp;<span class="id">suff:</span><span class="id"> f</span><span class="id"> r</span><span class="id"> &lt;=</span><span class="id"> M</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> le_trans;</span><span class="id"> rewrite</span><span class="id"> lerBlDr</span><span class="id"> lerDl</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> sup_ubound</span><span class="id"> =&gt;</span><span class="id"> //=;</span><span class="gallina-kwd"> exists</span><span class="id"> r</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> rewrite</span><span class="id"> in_itv/=</span><span class="id"> andbT</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> near:</span><span class="id"> r;</span><span class="id"> apply:</span><span class="id"> nbhs_right_gt</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> (<span class="id">le_trans</span><span class="id"> Mefp</span>)<span class="id">//</span><span class="id"> lerD2r</span><span class="id"> lef//</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> in_itv/=</span><span class="id"> andbT;</span><span class="id"> near:</span><span class="id"> r;</span><span class="id"> exact:</span><span class="id"> nbhs_right_gt</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> in_itv/=</span><span class="id"> ap</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> near:</span><span class="id"> r;</span><span class="id"> exact:</span><span class="id"> nbhs_right_le</span>.<br/>
<span class="id">Unshelve</span>.<span class="id"> all:</span><span class="gallina-kwd"> by</span><span class="id"> end_near</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> nonincreasing_at_right_is_cvgr</span><span class="id"> f</span><span class="id"> a</span><span class="id"> :</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">\forall</span><span class="id"> x</span><span class="id"> \near</span><span class="id"> a^'+,</span><span class="id"> {in</span><span class="id"> `]a,</span><span class="id"> x[</span><span class="id"> &amp;,</span><span class="id"> nonincreasing_fun</span><span class="id"> f}</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">\forall</span><span class="id"> x</span><span class="id"> \near</span><span class="id"> a^'+,</span><span class="id"> has_ubound</span> (<span class="id">f</span><span class="id"> @`</span><span class="id"> `]a,</span><span class="id"> x[</span>))<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">cvg</span> (<span class="id">f</span><span class="id"> x</span><span class="id"> @[x</span><span class="id"> --&gt;</span><span class="id"> a</span><span class="id"> ^'+]</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> nif</span><span class="id"> ubf;</span><span class="id"> apply/cvg_ex;</span><span class="id"> near</span><span class="id"> a^'+</span><span class="id"> =&gt;</span><span class="id"> b</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> eexists;</span><span class="id"> apply:</span> (<span class="id">@nonincreasing_at_right_cvgr</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">BLeft</span><span class="id"> b</span>))<span class="id">;</span><br/>
&nbsp;&nbsp;<span class="id">[rewrite</span><span class="id"> bnd_simp|near:</span><span class="id"> b</span>..<span class="id">]</span>.<br/>
<span class="id">Unshelve</span>.<span class="id"> all:</span><span class="gallina-kwd"> by</span><span class="id"> end_near</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> nondecreasing_at_right_cvgr</span><span class="id"> f</span><span class="id"> a</span> (<span class="id">b</span><span class="id"> :</span><span class="id"> itv_bound</span><span class="id"> R</span>)<span class="id"> :</span> (<span class="id">BRight</span><span class="id"> a</span><span class="id"> &lt;</span><span class="id"> b</span>)<span class="id">%O</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">{in</span><span class="id"> Interval</span> (<span class="id">BRight</span><span class="id"> a</span>)<span class="id"> b</span><span class="id"> &amp;,</span><span class="id"> nondecreasing_fun</span><span class="id"> f}</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">has_lbound</span> (<span class="id">f</span><span class="id"> @`</span><span class="id"> [set`</span><span class="id"> Interval</span> (<span class="id">BRight</span><span class="id"> a</span>)<span class="id"> b]</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">f</span><span class="id"> x</span><span class="id"> @[x</span><span class="id"> --&gt;</span><span class="id"> a</span><span class="id"> ^'+]</span><span class="id"> --&gt;</span><span class="id"> inf</span> (<span class="id">f</span><span class="id"> @`</span><span class="id"> [set`</span><span class="id"> Interval</span> (<span class="id">BRight</span><span class="id"> a</span>)<span class="id"> b]</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> ab</span><span class="id"> nif</span><span class="id"> hlb;</span><span class="id"> set</span><span class="id"> M</span><span class="id"> :=</span><span class="id"> inf</span><span class="id"> _</span>.<br/>
<span class="id">have</span><span class="id"> ndNf</span><span class="id"> :</span><span class="id"> {in</span><span class="id"> Interval</span> (<span class="id">BRight</span><span class="id"> a</span>)<span class="id"> b</span><span class="id"> &amp;,</span><span class="id"> nonincreasing_fun</span> (<span class="id">\-</span><span class="id"> f</span>)<span class="id">}</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> r</span><span class="id"> s</span><span class="id"> rab</span><span class="id"> sab</span><span class="id"> /nif;</span><span class="id"> rewrite</span><span class="id"> lerN2;</span><span class="id"> exact</span>.<br/>
<span class="id">have</span><span class="id"> hub</span><span class="id"> :</span><span class="id"> has_ubound</span><span class="id"> [set</span> (<span class="id">\-</span><span class="id"> f</span>)<span class="id"> x</span><span class="id"> |</span><span class="id"> x</span><span class="gallina-kwd"> in</span><span class="id"> [set`</span><span class="id"> Interval</span> (<span class="id">BRight</span><span class="id"> a</span>)<span class="id"> b]]</span>.<br/>
&nbsp;&nbsp;<span class="id">apply/has_ub_lbN;</span><span class="id"> rewrite</span><span class="id"> image_comp/=</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> [X</span><span class="gallina-kwd"> in</span><span class="id"> has_lbound</span><span class="id"> X]</span>(_<span class="id"> :</span><span class="id"> _</span><span class="id"> =</span><span class="id"> f</span><span class="id"> @`</span><span class="id"> [set`</span><span class="id"> Interval</span> (<span class="id">BRight</span><span class="id"> a</span>)<span class="id"> b]</span>)<span class="id">//</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> eq_imagel</span><span class="id"> =&gt;</span><span class="id"> y</span><span class="id"> _</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> opprK</span>.<br/>
<span class="id">have</span><span class="id"> /cvgN</span><span class="id"> :=</span><span class="id"> nonincreasing_at_right_cvgr</span><span class="id"> ab</span><span class="id"> ndNf</span><span class="id"> hub</span>.<br/>
<span class="id">rewrite</span><span class="id"> opprK</span><span class="id"> [X</span><span class="gallina-kwd"> in</span><span class="id"> _</span><span class="id"> --&gt;</span><span class="id"> X</span><span class="id"> -&gt;</span><span class="id"> _]</span>(_<span class="id"> :</span><span class="id"> _</span><span class="id"> =</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">inf</span> (<span class="id">f</span><span class="id"> @`</span><span class="id"> [set`</span><span class="id"> Interval</span> (<span class="id">BRight</span><span class="id"> a</span>)<span class="id"> b]</span>))<span class="id">//</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /inf;</span><span class="id"> congr</span> (<span class="id">-</span><span class="id"> sup</span><span class="id"> _</span>)<span class="id">;</span><span class="id"> rewrite</span><span class="id"> image_comp/=;</span><span class="id"> exact:</span><span class="id"> eq_imagel</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> nondecreasing_at_right_is_cvgr</span><span class="id"> f</span><span class="id"> a</span><span class="id"> :</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">\forall</span><span class="id"> x</span><span class="id"> \near</span><span class="id"> a^'+,</span><span class="id"> {in</span><span class="id"> `]a,</span><span class="id"> x[</span><span class="id"> &amp;,</span><span class="id"> nondecreasing_fun</span><span class="id"> f}</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">\forall</span><span class="id"> x</span><span class="id"> \near</span><span class="id"> a^'+,</span><span class="id"> has_lbound</span> (<span class="id">f</span><span class="id"> @`</span><span class="id"> `]a,</span><span class="id"> x[</span>))<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">cvg</span> (<span class="id">f</span><span class="id"> x</span><span class="id"> @[x</span><span class="id"> --&gt;</span><span class="id"> a</span><span class="id"> ^'+]</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> ndf</span><span class="id"> lbf;</span><span class="id"> apply/cvg_ex;</span><span class="id"> near</span><span class="id"> a^'+</span><span class="id"> =&gt;</span><span class="id"> b</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> eexists;</span><span class="id"> apply:</span> (<span class="id">@nondecreasing_at_right_cvgr</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">BLeft</span><span class="id"> b</span>))<span class="id">;</span><br/>
&nbsp;&nbsp;<span class="id">[rewrite</span><span class="id"> bnd_simp|near:</span><span class="id"> b</span>..<span class="id">]</span>.<br/>
<span class="id">Unshelve</span>.<span class="id"> all:</span><span class="gallina-kwd"> by</span><span class="id"> end_near</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> nondecreasing_at_left_is_cvgr</span><span class="id"> f</span><span class="id"> a</span><span class="id"> :</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">\forall</span><span class="id"> x</span><span class="id"> \near</span><span class="id"> a^'-,</span><span class="id"> {in</span><span class="id"> `]x,</span><span class="id"> a[</span><span class="id"> &amp;,</span><span class="id"> {homo</span><span class="id"> f</span><span class="id"> :</span><span class="id"> n</span><span class="id"> m</span><span class="id"> /</span><span class="id"> n</span><span class="id"> &lt;=</span><span class="id"> m}}</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">\forall</span><span class="id"> x</span><span class="id"> \near</span><span class="id"> a^'-,</span><span class="id"> has_ubound</span><span class="id"> [set</span><span class="id"> f</span><span class="id"> y</span><span class="id"> |</span><span class="id"> y</span><span class="gallina-kwd"> in</span><span class="id"> `]x,</span><span class="id"> a[]</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">cvg</span> (<span class="id">f</span><span class="id"> x</span><span class="id"> @[x</span><span class="id"> --&gt;</span><span class="id"> a^'-]</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> ndf</span><span class="id"> ubf;</span><span class="id"> suff:</span><span class="id"> cvg</span> ((<span class="id">f</span><span class="id"> \o</span><span class="id"> -%R</span>)<span class="id"> x</span><span class="id"> @[x</span><span class="id"> --&gt;</span> (<span class="id">-</span><span class="id"> a</span>)<span class="id">^'+]</span>).<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> /cvg_ex[/=</span><span class="id"> l</span><span class="id"> fal]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply/cvg_ex;</span><span class="gallina-kwd"> exists</span><span class="id"> l;</span><span class="id"> exact/cvg_at_leftNP</span>.<br/>
<span class="id">apply:</span><span class="id"> @nonincreasing_at_right_is_cvgr</span>.<br/>
<span class="id">-</span><span class="id"> rewrite</span><span class="id"> at_rightN</span><span class="id"> near_simpl;</span><span class="id"> apply:</span><span class="id"> filterS</span><span class="id"> ndf</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> ndf</span><span class="id"> y</span><span class="id"> z</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -2!oppr_itvoo</span><span class="id"> =&gt;</span><span class="id"> yxa</span><span class="id"> zxa</span><span class="id"> yz;</span><span class="id"> rewrite</span><span class="id"> ndf//</span><span class="id"> lerNr</span><span class="id"> opprK</span>.<br/>
<span class="id">-</span><span class="id"> rewrite</span><span class="id"> at_rightN</span><span class="id"> near_simpl;</span><span class="id"> apply:</span><span class="id"> filterS</span><span class="id"> ubf</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> [r</span><span class="id"> ubf]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">exists</span><span class="id"> r</span><span class="id"> =&gt;</span><span class="id"> _/=</span><span class="id"> [s</span><span class="id"> sax</span><span class="id"> &lt;-];</span><span class="id"> rewrite</span><span class="id"> ubf//=;</span><span class="gallina-kwd"> exists</span> (<span class="id">-</span><span class="id"> s</span>)<span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> oppr_itvoo</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Let</span><span class="id"> nondecreasing_at_right_is_cvgrW</span><span class="id"> f</span><span class="id"> a</span><span class="id"> b</span><span class="id"> r</span><span class="id"> :</span><span class="id"> a</span><span class="id"> &lt;</span><span class="id"> r</span><span class="id"> -&gt;</span><span class="id"> r</span><span class="id"> &lt;</span><span class="id"> b</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">{in</span><span class="id"> `[a,</span><span class="id"> b]</span><span class="id"> &amp;,</span><span class="id"> nondecreasing_fun</span><span class="id"> f}</span><span class="id"> -&gt;</span><span class="id"> cvg</span> (<span class="id">f</span><span class="id"> x</span><span class="id"> @[x</span><span class="id"> --&gt;</span><span class="id"> r^'+]</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> ar</span><span class="id"> rb</span><span class="id"> ndf</span><span class="id"> H;</span><span class="id"> apply:</span><span class="id"> nondecreasing_at_right_is_cvgr</span>.<br/>
<span class="id">-</span><span class="id"> near=&gt;</span><span class="id"> s</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> y</span><span class="id"> xrs</span><span class="id"> yrs</span><span class="id"> xy;</span><span class="id"> rewrite</span><span class="id"> ndf//</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> subset_itvW</span><span class="id"> xrs;</span><span class="id"> exact/ltW</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> subset_itvW</span><span class="id"> yrs;</span><span class="id"> exact/ltW</span>.<br/>
<span class="id">-</span><span class="id"> near=&gt;</span><span class="id"> x;</span><span class="gallina-kwd"> exists</span> (<span class="id">f</span><span class="id"> r</span>)<span class="id"> =&gt;</span><span class="id"> _</span><span class="id"> /=</span><span class="id"> [s</span><span class="id"> srx</span><span class="id"> &lt;-];</span><span class="id"> rewrite</span><span class="id"> ndf//</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> subset_itv_oo_cc;</span><span class="id"> rewrite</span><span class="id"> in_itv/=</span><span class="id"> ar</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> subset_itvW</span><span class="id"> srx;</span><span class="id"> exact/ltW</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> move:</span><span class="id"> srx;</span><span class="id"> rewrite</span><span class="id"> in_itv/=</span><span class="id"> =&gt;</span><span class="id"> /andP[/ltW]</span>.<br/>
<span class="id">Unshelve</span>.<span class="id"> all:</span><span class="gallina-kwd"> by</span><span class="id"> end_near</span>. Qed.</div></details>
<br/>
<span class="vernacular">Let</span><span class="id"> nondecreasing_at_left_is_cvgrW</span><span class="id"> f</span><span class="id"> a</span><span class="id"> b</span><span class="id"> r</span><span class="id"> :</span><span class="id"> a</span><span class="id"> &lt;</span><span class="id"> r</span><span class="id"> -&gt;</span><span class="id"> r</span><span class="id"> &lt;</span><span class="id"> b</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">{in</span><span class="id"> `[a,</span><span class="id"> b]</span><span class="id"> &amp;,</span><span class="id"> nondecreasing_fun</span><span class="id"> f}</span><span class="id"> -&gt;</span><span class="id"> cvg</span> (<span class="id">f</span><span class="id"> x</span><span class="id"> @[x</span><span class="id"> --&gt;</span><span class="id"> r^'-]</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> ar</span><span class="id"> rb</span><span class="id"> ndf</span><span class="id"> H;</span><span class="id"> apply:</span><span class="id"> nondecreasing_at_left_is_cvgr</span>.<br/>
<span class="id">-</span><span class="id"> near=&gt;</span><span class="id"> s</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> y</span><span class="id"> xrs</span><span class="id"> yrs</span><span class="id"> xy;</span><span class="id"> rewrite</span><span class="id"> ndf//</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> subset_itvW</span><span class="id"> xrs;</span><span class="id"> exact/ltW</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> subset_itvW</span><span class="id"> yrs;</span><span class="id"> exact/ltW</span>.<br/>
<span class="id">-</span><span class="id"> near=&gt;</span><span class="id"> x;</span><span class="gallina-kwd"> exists</span> (<span class="id">f</span><span class="id"> r</span>)<span class="id"> =&gt;</span><span class="id"> _</span><span class="id"> /=</span><span class="id"> [s</span><span class="id"> srx</span><span class="id"> &lt;-];</span><span class="id"> rewrite</span><span class="id"> ndf//</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> subset_itvW</span><span class="id"> srx;</span><span class="id"> exact/ltW</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> subset_itv_oo_cc;</span><span class="id"> rewrite</span><span class="id"> in_itv/=</span><span class="id"> ar</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> move:</span><span class="id"> srx;</span><span class="id"> rewrite</span><span class="id"> in_itv/=</span><span class="id"> =&gt;</span><span class="id"> /andP[_</span><span class="id"> /ltW]</span>.<br/>
<span class="id">Unshelve</span>.<span class="id"> all:</span><span class="gallina-kwd"> by</span><span class="id"> end_near</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> nondecreasing_at_left_at_right</span><span class="id"> f</span><span class="id"> a</span><span class="id"> b</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">{in</span><span class="id"> `[a,</span><span class="id"> b]</span><span class="id"> &amp;,</span><span class="id"> nondecreasing_fun</span><span class="id"> f}</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">{in</span><span class="id"> `]a,</span><span class="id"> b[,</span><span class="gallina-kwd"> forall</span><span class="id"> r,</span><span class="id"> lim</span> (<span class="id">f</span><span class="id"> x</span><span class="id"> @[x</span><span class="id"> --&gt;</span><span class="id"> r^'-]</span>)<span class="id"> &lt;=</span><span class="id"> lim</span> (<span class="id">f</span><span class="id"> x</span><span class="id"> @[x</span><span class="id"> --&gt;</span><span class="id"> r^'+]</span>)<span class="id">}</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> ndf</span><span class="id"> r;</span><span class="id"> rewrite</span><span class="id"> in_itv/=</span><span class="id"> =&gt;</span><span class="id"> /andP[ar</span><span class="id"> rb];</span><span class="id"> apply:</span><span class="id"> limr_ge</span>.<br/>
&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> nondecreasing_at_right_is_cvgrW</span><span class="id"> ndf</span>.<br/>
<span class="id">near=&gt;</span><span class="id"> x;</span><span class="id"> apply:</span><span class="id"> limr_le;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> nondecreasing_at_left_is_cvgrW</span><span class="id"> ndf</span>.<br/>
<span class="id">near=&gt;</span><span class="id"> y;</span><span class="id"> rewrite</span><span class="id"> ndf//</span><span class="id"> ?in_itv/=</span>.<br/>
<span class="id">-</span><span class="id"> apply/andP;</span><span class="id"> split;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> near:</span><span class="id"> y;</span><span class="id"> apply:</span><span class="id"> nbhs_left_ge</span>.<br/>
&nbsp;&nbsp;<span class="id">exact:</span> (<span class="id">le_trans</span><span class="id"> _</span> (<span class="id">ltW</span><span class="id"> rb</span>)).<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span> (<span class="id">le_trans</span> (<span class="id">ltW</span><span class="id"> ar</span>))<span class="id">/=</span><span class="id"> ltW</span>.<br/>
<span class="id">-</span><span class="id"> exact:</span> (<span class="id">@le_trans</span><span class="id"> _</span><span class="id"> _</span><span class="id"> r</span>).<br/>
<span class="id">Unshelve</span>.<span class="id"> all:</span><span class="gallina-kwd"> by</span><span class="id"> end_near</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> nonincreasing_at_left_at_right</span><span class="id"> f</span><span class="id"> a</span><span class="id"> b</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">{in</span><span class="id"> `[a,</span><span class="id"> b]</span><span class="id"> &amp;,</span><span class="id"> nonincreasing_fun</span><span class="id"> f}</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">{in</span><span class="id"> `]a,</span><span class="id"> b[,</span><span class="gallina-kwd"> forall</span><span class="id"> r,</span><span class="id"> lim</span> (<span class="id">f</span><span class="id"> x</span><span class="id"> @[x</span><span class="id"> --&gt;</span><span class="id"> r^'-]</span>)<span class="id"> &gt;=</span><span class="id"> lim</span> (<span class="id">f</span><span class="id"> x</span><span class="id"> @[x</span><span class="id"> --&gt;</span><span class="id"> r^'+]</span>)<span class="id">}</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> nif;</span><span class="id"> have</span><span class="id"> ndNf</span><span class="id"> :</span><span class="id"> {in</span><span class="id"> `[a,</span><span class="id"> b]</span><span class="id"> &amp;,</span><span class="id"> nondecreasing_fun</span> (<span class="id">-%R</span><span class="id"> \o</span><span class="id"> f</span>)<span class="id">}</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> y</span><span class="id"> xab</span><span class="id"> yab</span><span class="id"> xy</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> lerNl</span><span class="id"> opprK</span><span class="id"> nif</span>.<br/>
<span class="id">move/nondecreasing_at_left_at_right</span><span class="id"> :</span> (<span class="id">ndNf</span>)<span class="id"> =&gt;</span><span class="id"> H</span><span class="id"> x</span>.<br/>
<span class="id">rewrite</span><span class="id"> in_itv/=</span><span class="id"> =&gt;</span><span class="id"> /andP[ax</span><span class="id"> xb];</span><span class="id"> rewrite</span><span class="id"> -[leLHS]opprK</span><span class="id"> lerNl</span><span class="id"> -!limN//</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> H;</span><span class="id"> rewrite</span><span class="id"> !in_itv/=</span><span class="id"> ax</span>.<br/>
<span class="id">-</span><span class="id"> rewrite</span><span class="id"> -</span>(<span class="id">opprK</span><span class="id"> f</span>)<span class="id">;</span><span class="id"> apply:</span><span class="id"> is_cvgN</span>.<br/>
&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> nondecreasing_at_right_is_cvgrW</span><span class="id"> ndNf</span>.<br/>
<span class="id">-</span><span class="id"> rewrite</span><span class="id"> -</span>(<span class="id">opprK</span><span class="id"> f</span>)<span class="id">;apply:</span><span class="id"> is_cvgN</span>.<br/>
&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> nondecreasing_at_left_is_cvgrW</span><span class="id"> ndNf</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> fun_cvg_realType</span>.<br/>
<span class="vernacular">Arguments</span><span class="id"> nondecreasing_at_right_cvgr</span><span class="id"> {R</span><span class="id"> f</span><span class="id"> a}</span><span class="id"> b</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> fun_cvg_ereal</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {R</span><span class="id"> :</span><span class="id"> realType}</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> nondecreasing_cvge</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">nondecreasing_fun</span><span class="id"> f</span><span class="id"> -&gt;</span><span class="id"> f</span><span class="id"> r</span><span class="id"> @[r</span><span class="id"> --&gt;</span><span class="id"> +oo%R]</span><span class="id"> --&gt;</span><span class="id"> ereal_sup</span> (<span class="id">range</span><span class="id"> f</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> ndf;</span><span class="id"> set</span><span class="id"> S</span><span class="id"> :=</span><span class="id"> range</span><span class="id"> f;</span><span class="id"> set</span><span class="id"> l</span><span class="id"> :=</span><span class="id"> ereal_sup</span><span class="id"> S</span>.<br/>
<span class="id">have</span><span class="id"> [Spoo|Spoo]</span><span class="id"> :=</span><span class="id"> pselect</span> (<span class="id">S</span><span class="id"> +oo</span>).<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> [N</span><span class="id"> Nf]</span><span class="id"> :</span><span class="gallina-kwd"> exists</span><span class="id"> N,</span><span class="gallina-kwd"> forall</span><span class="id"> n,</span> (<span class="id">n</span><span class="id"> &gt;=</span><span class="id"> N</span>)<span class="id">%R</span><span class="id"> -&gt;</span><span class="id"> f</span><span class="id"> n</span><span class="id"> =</span><span class="id"> +oo</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">case:</span><span class="id"> Spoo</span><span class="id"> =&gt;</span><span class="id"> N</span><span class="id"> _</span><span class="id"> uNoo;</span><span class="gallina-kwd"> exists</span><span class="id"> N</span><span class="id"> =&gt;</span><span class="id"> n</span><span class="id"> Nn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> have</span><span class="id"> :=</span><span class="id"> ndf</span><span class="id"> _</span><span class="id"> _</span><span class="id"> Nn;</span><span class="id"> rewrite</span><span class="id"> uNoo</span><span class="id"> leye_eq</span><span class="id"> =&gt;</span><span class="id"> /eqP</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> -&gt;</span><span class="id"> :</span><span class="id"> l</span><span class="id"> =</span><span class="id"> +oo</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> /l</span><span class="id"> /ereal_sup;</span><span class="id"> exact:</span><span class="id"> supremum_pinfty</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -</span>(<span class="id">cvg_shiftr</span><span class="id"> `|N|</span>)<span class="id">;</span><span class="id"> apply:</span><span class="id"> cvg_near_cst</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">exists</span><span class="id"> N;</span><span class="id"> split;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> num_real</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> /ltW</span><span class="id"> Nx;</span><span class="id"> rewrite</span><span class="id"> Nf//</span><span class="id"> ler_wpDr</span>.<br/>
<span class="id">have</span><span class="id"> [lpoo|lpoo]</span><span class="id"> :=</span><span class="id"> eqVneq</span><span class="id"> l</span><span class="id"> +oo</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> lpoo;</span><span class="id"> apply/cvgeyPge</span><span class="id"> =&gt;</span><span class="id"> M</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> /ereal_sup_gt[_</span><span class="id"> [n</span><span class="id"> _]</span><span class="id"> &lt;-</span><span class="id"> Mun]</span><span class="id"> :</span><span class="id"> M%:E</span><span class="id"> &lt;</span><span class="id"> l</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> lpoo//</span><span class="id"> ltry</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">exists</span><span class="id"> n;</span><span class="id"> split;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> num_real</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> m</span><span class="id"> /=</span><span class="id"> nm;</span><span class="id"> rewrite</span> (<span class="id">le_trans</span> (<span class="id">ltW</span><span class="id"> Mun</span>))<span class="id">//</span><span class="id"> ndf//</span><span class="id"> ltW</span>.<br/>
<span class="id">have</span><span class="id"> [fnoo|fnoo]</span><span class="id"> :=</span><span class="id"> pselect</span> (<span class="id">f</span><span class="id"> =</span><span class="id"> cst</span><span class="id"> -oo</span>).<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> /l</span> (_<span class="id"> :</span><span class="id"> S</span><span class="id"> =</span><span class="id"> [set</span><span class="id"> -oo]</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> ereal_sup1</span><span class="id"> fnoo;</span><span class="id"> exact:</span><span class="id"> cvg_cst</span>.<br/>
&nbsp;&nbsp;<span class="id">apply/seteqP;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> [_</span><span class="id"> [n</span><span class="id"> _]</span><span class="id"> &lt;-</span><span class="id"> /[!fnoo]//|_</span><span class="id"> -&gt;]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /S</span><span class="id"> fnoo;</span><span class="gallina-kwd"> exists</span><span class="id"> 0%R</span>.<br/>
<span class="id">have</span><span class="id"> [/ereal_sup_ninfty</span><span class="id"> lnoo|lnoo]</span><span class="id"> :=</span><span class="id"> eqVneq</span><span class="id"> l</span><span class="id"> -oo</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> exfalso;</span><span class="id"> apply/fnoo/funext</span><span class="id"> =&gt;</span><span class="id"> n;</span><span class="id"> rewrite</span> (<span class="id">lnoo</span> (<span class="id">f</span><span class="id"> n</span>))<span class="id">//;</span><span class="gallina-kwd"> exists</span><span class="id"> n</span>.<br/>
<span class="id">have</span><span class="id"> l_fin_num</span><span class="id"> :</span><span class="id"> l</span><span class="id"> \is</span><span class="id"> a</span><span class="id"> fin_num</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> fin_numE</span><span class="id"> lpoo</span><span class="id"> lnoo</span>.<br/>
<span class="id">set</span><span class="id"> A</span><span class="id"> :=</span><span class="id"> [set</span><span class="id"> n</span><span class="id"> |</span><span class="id"> f</span><span class="id"> n</span><span class="id"> =</span><span class="id"> -oo];</span><span class="id"> set</span><span class="id"> B</span><span class="id"> :=</span><span class="id"> [set</span><span class="id"> n</span><span class="id"> |</span><span class="id"> f</span><span class="id"> n</span><span class="id"> !=</span><span class="id"> -oo]</span>.<br/>
<span class="id">have</span><span class="id"> f_fin_num</span><span class="id"> n</span><span class="id"> :</span><span class="id"> B</span><span class="id"> n</span><span class="id"> -&gt;</span><span class="id"> f</span><span class="id"> n</span><span class="id"> \is</span><span class="id"> a</span><span class="id"> fin_num</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> Bn;</span><span class="id"> rewrite</span><span class="id"> fin_numE</span><span class="id"> Bn/=</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> contra_notN</span><span class="id"> Spoo</span><span class="id"> =&gt;</span><span class="id"> /eqP</span><span class="id"> unpoo;</span><span class="gallina-kwd"> exists</span><span class="id"> n</span>.<br/>
<span class="id">have</span><span class="id"> [x</span><span class="id"> Bx]</span><span class="id"> :</span><span class="id"> B</span><span class="id"> !=set0</span>.<br/>
&nbsp;&nbsp;<span class="id">apply/set0P/negP</span><span class="id"> =&gt;</span><span class="id"> /eqP</span><span class="id"> B0;</span><span class="id"> apply/fnoo/funext</span><span class="id"> =&gt;</span><span class="id"> n</span>.<br/>
&nbsp;&nbsp;<span class="id">apply/eqP/negPn/negP</span><span class="id"> =&gt;</span><span class="id"> unnoo</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move/seteqP</span><span class="id"> :</span><span class="id"> B0</span><span class="id"> =&gt;</span><span class="id"> [+</span><span class="id"> _]</span><span class="id"> =&gt;</span><span class="id"> /</span>(_<span class="id"> n</span>)<span class="id">;</span><span class="id"> apply</span>.<br/>
<span class="id">have</span><span class="id"> xB</span><span class="id"> r</span><span class="id"> :</span> (<span class="id">x</span><span class="id"> &lt;=</span><span class="id"> r</span>)<span class="id">%R</span><span class="id"> -&gt;</span><span class="id"> B</span><span class="id"> r</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> /ndf</span><span class="id"> xr;</span><span class="id"> apply/negP</span><span class="id"> =&gt;</span><span class="id"> /eqP</span><span class="id"> urnoo</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move:</span><span class="id"> xr;</span><span class="id"> rewrite</span><span class="id"> urnoo</span><span class="id"> leeNy_eq;</span><span class="id"> exact/negP</span>.<br/>
<span class="id">rewrite</span><span class="id"> -</span>(<span class="id">@fineK</span><span class="id"> _</span><span class="id"> l</span>)<span class="id">//;</span><span class="id"> apply/fine_cvgP;</span><span class="id"> split</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">exists</span><span class="id"> x;</span><span class="id"> split;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> num_real</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> r</span><span class="id"> A1r;</span><span class="id"> rewrite</span><span class="id"> f_fin_num</span><span class="id"> //;</span><span class="id"> exact/xB/ltW</span>.<br/>
<span class="id">set</span><span class="id"> g</span><span class="id"> :=</span><span class="gallina-kwd"> fun</span><span class="id"> n</span><span class="id"> =&gt;</span><span class="gallina-kwd"> if</span> (<span class="id">n</span><span class="id"> &lt;</span><span class="id"> x</span>)<span class="id">%R</span><span class="gallina-kwd"> then</span><span class="id"> fine</span> (<span class="id">f</span><span class="id"> x</span>)<span class="gallina-kwd"> else</span><span class="id"> fine</span> (<span class="id">f</span><span class="id"> n</span>).<br/>
<span class="id">have</span><span class="id"> &lt;-</span><span class="id"> :</span><span class="id"> sup</span> (<span class="id">range</span><span class="id"> g</span>)<span class="id"> =</span><span class="id"> fine</span><span class="id"> l</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> EFin_inj;</span><span class="id"> rewrite</span><span class="id"> -ereal_sup_EFin//;</span><span class="id"> last</span><span class="id"> 2</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> exists</span> (<span class="id">fine</span><span class="id"> l</span>)<span class="id"> =&gt;</span><span class="id"> /=</span><span class="id"> _</span><span class="id"> [m</span><span class="id"> _</span><span class="id"> &lt;-];</span><span class="id"> rewrite</span><span class="id"> /g</span><span class="id"> /=</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">have</span><span class="id"> [mx|xm]</span><span class="id"> :=</span><span class="id"> ltP</span><span class="id"> m</span><span class="id"> x</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> fine_le//</span><span class="id"> ?f_fin_num//;</span><span class="id"> apply:</span><span class="id"> ereal_sup_ubound;</span><span class="gallina-kwd"> exists</span><span class="id"> x</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> fine_le//</span><span class="id"> ?f_fin_num//;</span><span class="id"> first</span><span class="id"> exact/xB</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> ereal_sup_ubound;</span><span class="gallina-kwd"> exists</span><span class="id"> m</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="gallina-kwd"> exists</span> (<span class="id">g</span><span class="id"> 0%R</span>)<span class="id">,</span><span class="id"> 0%R</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> fineK//;</span><span class="id"> apply/eqP;</span><span class="id"> rewrite</span><span class="id"> eq_le;</span><span class="id"> apply/andP;</span><span class="id"> split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> le_ereal_sup</span><span class="id"> =&gt;</span><span class="id"> _</span><span class="id"> /=</span><span class="id"> [_</span><span class="id"> [m</span><span class="id"> _]</span><span class="id"> &lt;-]</span><span class="id"> &lt;-</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> /g;</span><span class="id"> have</span><span class="id"> [_|xm]</span><span class="id"> :=</span><span class="id"> ltP</span><span class="id"> m</span><span class="id"> x</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> fineK//</span><span class="id"> ?f_fin_num//;</span><span class="gallina-kwd"> exists</span><span class="id"> x</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> fineK//</span><span class="id"> ?f_fin_num//;</span><span class="id"> [exists</span><span class="id"> m|exact/xB]</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> ub_ereal_sup</span><span class="id"> =&gt;</span><span class="id"> /=</span><span class="id"> _</span><span class="id"> [m</span><span class="id"> _]</span><span class="id"> &lt;-</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> [mx|xm]</span><span class="id"> :=</span><span class="id"> ltP</span><span class="id"> m</span><span class="id"> x</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> (<span class="id">le_trans</span> (<span class="id">ndf</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">ltW</span><span class="id"> mx</span>)))<span class="id">//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> ereal_sup_ubound</span><span class="id"> =&gt;</span><span class="id"> /=;</span><span class="gallina-kwd"> exists</span> (<span class="id">fine</span> (<span class="id">f</span><span class="id"> x</span>))<span class="id">;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> fineK//</span><span class="id"> f_fin_num</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="gallina-kwd"> exists</span><span class="id"> m</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> rewrite</span><span class="id"> /g</span><span class="id"> mx</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> ereal_sup_ubound</span><span class="id"> =&gt;</span><span class="id"> /=;</span><span class="gallina-kwd"> exists</span> (<span class="id">fine</span> (<span class="id">f</span><span class="id"> m</span>))<span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="gallina-kwd"> exists</span><span class="id"> m</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> rewrite</span><span class="id"> /g</span><span class="id"> ltNge</span><span class="id"> xm</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> fineK</span><span class="id"> ?f_fin_num//;</span><span class="id"> exact:</span><span class="id"> xB</span>.<br/>
<span class="id">suff:</span><span class="id"> g</span><span class="id"> x</span><span class="id"> @[x</span><span class="id"> --&gt;</span><span class="id"> +oo%R]</span><span class="id"> --&gt;</span><span class="id"> sup</span> (<span class="id">range</span><span class="id"> g</span>).<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> cvg_trans;</span><span class="id"> apply:</span><span class="id"> near_eq_cvg;</span><span class="id"> near=&gt;</span><span class="id"> n</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> /g</span><span class="id"> ifF//;</span><span class="id"> apply/negbTE;</span><span class="id"> rewrite</span><span class="id"> -leNgt</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> near:</span><span class="id"> n;</span><span class="id"> apply:</span><span class="id"> nbhs_pinfty_ge;</span><span class="id"> rewrite</span><span class="id"> num_real</span>.<br/>
<span class="id">apply:</span><span class="id"> nondecreasing_cvgr</span>.<br/>
<span class="id">-</span><span class="id"> move=&gt;</span><span class="id"> m</span><span class="id"> n</span><span class="id"> mn;</span><span class="id"> rewrite</span><span class="id"> /g</span><span class="id"> /=;</span><span class="id"> have</span><span class="id"> [_|xm]</span><span class="id"> :=</span><span class="id"> ltP</span><span class="id"> m</span><span class="id"> x</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="id"> have</span><span class="id"> [nx|nx]</span><span class="id"> :=</span><span class="id"> ltP</span><span class="id"> n</span><span class="id"> x;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> fine_le//</span><span class="id"> f_fin_num</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> fine_le//</span><span class="id"> ?f_fin_num//;</span><span class="id"> [exact:</span><span class="id"> xB|exact:</span><span class="id"> ndf]</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="id"> rewrite</span><span class="id"> ltNge</span> (<span class="id">le_trans</span><span class="id"> xm</span><span class="id"> mn</span>)<span class="id">//=</span><span class="id"> fine_le</span><span class="id"> ?f_fin_num//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">*</span><span class="id"> exact:</span><span class="id"> xB</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">*</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> xB;</span><span class="id"> rewrite</span> (<span class="id">le_trans</span><span class="id"> xm</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">*</span><span class="id"> exact/ndf</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> exists</span> (<span class="id">fine</span><span class="id"> l</span>)<span class="id"> =&gt;</span><span class="id"> /=</span><span class="id"> _</span><span class="id"> [m</span><span class="id"> _</span><span class="id"> &lt;-];</span><span class="id"> rewrite</span><span class="id"> /g</span><span class="id"> /=</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -lee_fin</span> (<span class="id">fineK</span><span class="id"> l_fin_num</span>)<span class="id">;</span><span class="id"> apply:</span><span class="id"> ereal_sup_ubound</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> [_|xm]</span><span class="id"> :=</span><span class="id"> ltP</span><span class="id"> m</span><span class="id"> x;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> fineK//</span><span class="id"> ?f_fin_num//;</span><span class="id"> eexists</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> fineK//</span><span class="id"> ?f_fin_num//;</span><span class="id"> [exists</span><span class="id"> m|exact/xB]</span>.<br/>
<span class="id">Unshelve</span>.<span class="id"> all:</span><span class="gallina-kwd"> by</span><span class="id"> end_near</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> nondecreasing_is_cvge</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">nondecreasing_fun</span><span class="id"> f</span><span class="id"> -&gt;</span> (<span class="id">cvg</span> (<span class="id">f</span><span class="id"> r</span><span class="id"> @[r</span><span class="id"> --&gt;</span><span class="id"> +oo]</span>))<span class="id">%R</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> u_nd</span><span class="id"> u_ub;</span><span class="id"> apply:</span><span class="id"> cvgP;</span><span class="id"> exact:</span><span class="id"> nondecreasing_cvge</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> nondecreasing_at_right_cvge</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id"> a</span> (<span class="id">b</span><span class="id"> :</span><span class="id"> itv_bound</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">BRight</span><span class="id"> a</span><span class="id"> &lt;</span><span class="id"> b</span>)<span class="id">%O</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">{in</span><span class="id"> Interval</span> (<span class="id">BRight</span><span class="id"> a</span>)<span class="id"> b</span><span class="id"> &amp;,</span><span class="id"> nondecreasing_fun</span><span class="id"> f}</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">f</span><span class="id"> x</span><span class="id"> @[x</span><span class="id"> --&gt;</span><span class="id"> a</span><span class="id"> ^'+]</span><span class="id"> --&gt;</span><span class="id"> ereal_inf</span> (<span class="id">f</span><span class="id"> @`</span><span class="id"> [set`</span><span class="id"> Interval</span> (<span class="id">BRight</span><span class="id"> a</span>)<span class="id"> b]</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> ab</span><span class="id"> ndf;</span><span class="id"> set</span><span class="id"> S</span><span class="id"> :=</span> (<span class="id">X</span><span class="gallina-kwd"> in</span><span class="id"> ereal_inf</span><span class="id"> X</span>)<span class="id">;</span><span class="id"> set</span><span class="id"> l</span><span class="id"> :=</span><span class="id"> ereal_inf</span><span class="id"> S</span>.<br/>
<span class="id">have</span><span class="id"> [Snoo|Snoo]</span><span class="id"> :=</span><span class="id"> pselect</span> (<span class="id">S</span><span class="id"> -oo</span>).<br/>
&nbsp;&nbsp;<span class="id">case:</span> (<span class="id">Snoo</span>)<span class="id"> =&gt;</span><span class="id"> N/=</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> in_itv/=</span><span class="id"> -[X</span><span class="gallina-kwd"> in</span><span class="id"> _</span><span class="id"> &amp;&amp;</span><span class="id"> X]/</span>(<span class="id">BLeft</span><span class="id"> N</span><span class="id"> &lt;</span><span class="id"> b</span>)<span class="id">%O</span><span class="id"> =&gt;</span><span class="id"> /andP[aN</span><span class="id"> Nb]</span><span class="id"> fNpoo</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> Nf</span><span class="id"> n</span><span class="id"> :</span> (<span class="id">a</span><span class="id"> &lt;</span><span class="id"> n</span><span class="id"> &lt;=</span><span class="id"> N</span>)<span class="id">%R</span><span class="id"> -&gt;</span><span class="id"> f</span><span class="id"> n</span><span class="id"> =</span><span class="id"> -oo</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> /andP[an</span><span class="id"> nN];</span><span class="id"> apply/eqP</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> eq_le</span><span class="id"> leNye</span><span class="id"> andbT</span><span class="id"> -fNpoo</span><span class="id"> ndf//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> in_itv/=</span><span class="id"> -[X</span><span class="gallina-kwd"> in</span><span class="id"> _</span><span class="id"> &amp;&amp;</span><span class="id"> X]/</span>(<span class="id">BLeft</span><span class="id"> n</span><span class="id"> &lt;</span><span class="id"> b</span>)<span class="id">%O</span><span class="id"> an</span> (<span class="id">le_lt_trans</span><span class="id"> _</span><span class="id"> Nb</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> in_itv/=</span><span class="id"> -[X</span><span class="gallina-kwd"> in</span><span class="id"> _</span><span class="id"> &amp;&amp;</span><span class="id"> X]/</span>(<span class="id">BLeft</span><span class="id"> N</span><span class="id"> &lt;</span><span class="id"> b</span>)<span class="id">%O</span> (<span class="id">lt_le_trans</span><span class="id"> an</span><span class="id"> nN</span>).<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> -&gt;</span><span class="id"> :</span><span class="id"> l</span><span class="id"> =</span><span class="id"> -oo</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /l</span><span class="id"> /ereal_inf</span><span class="id"> /ereal_sup</span><span class="id"> supremum_pinfty//=;</span><span class="gallina-kwd"> exists</span><span class="id"> -oo</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> cvg_near_cst;</span><span class="gallina-kwd"> exists</span> (<span class="id">N</span><span class="id"> -</span><span class="id"> a</span>)<span class="id">%R</span><span class="id"> =&gt;</span><span class="id"> /=;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> subr_gt0</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> y</span><span class="id"> /=</span><span class="id"> +</span><span class="id"> ay;</span><span class="id"> rewrite</span><span class="id"> ltr0_norm</span><span class="id"> ?subr_lt0//</span><span class="id"> opprB</span><span class="id"> =&gt;</span><span class="id"> ayNa</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> Nf//</span><span class="id"> ay/=</span><span class="id"> -</span>(<span class="id">subrK</span><span class="id"> a</span><span class="id"> y</span>)<span class="id"> -lerBrDr</span><span class="id"> ltW</span>.<br/>
<span class="id">have</span><span class="id"> [lnoo|lnoo]</span><span class="id"> :=</span><span class="id"> eqVneq</span><span class="id"> l</span><span class="id"> -oo</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> lnoo;</span><span class="id"> apply/cvgeNyPle</span><span class="id"> =&gt;</span><span class="id"> M</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> /ereal_inf_lt[x</span><span class="id"> [y]]/=</span><span class="id"> :</span><span class="id"> M%:E</span><span class="id"> &gt;</span><span class="id"> l</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> lnoo</span><span class="id"> ltNyr</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> in_itv/=</span><span class="id"> -[X</span><span class="gallina-kwd"> in</span><span class="id"> _</span><span class="id"> &amp;&amp;</span><span class="id"> X]/</span>(<span class="id">BLeft</span><span class="id"> y</span><span class="id"> &lt;</span><span class="id"> b</span>)<span class="id">%O/=</span><span class="id"> =&gt;</span><span class="id"> /andP[ay</span><span class="id"> yb]</span><span class="id"> &lt;-</span><span class="id"> fyM</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">exists</span> (<span class="id">y</span><span class="id"> -</span><span class="id"> a</span>)<span class="id">%R</span><span class="id"> =&gt;</span><span class="id"> /=;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> subr_gt0</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> z</span><span class="id"> /=</span><span class="id"> +</span><span class="id"> az</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> ltr0_norm</span><span class="id"> ?subr_lt0//</span><span class="id"> opprB</span><span class="id"> ltrBlDr</span><span class="id"> subrK</span><span class="id"> =&gt;</span><span class="id"> zy</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> (<span class="id">le_trans</span><span class="id"> _</span> (<span class="id">ltW</span><span class="id"> fyM</span>))<span class="id">//</span><span class="id"> ndf</span><span class="id"> ?ltW//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> in_itv/=</span><span class="id"> -[X</span><span class="gallina-kwd"> in</span><span class="id"> _</span><span class="id"> &amp;&amp;</span><span class="id"> X]/</span>(<span class="id">BLeft</span><span class="id"> z</span><span class="id"> &lt;</span><span class="id"> b</span>)<span class="id">%O/=</span><span class="id"> az/=</span> (<span class="id">lt_trans</span><span class="id"> _</span><span class="id"> yb</span>).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> in_itv/=</span><span class="id"> -[X</span><span class="gallina-kwd"> in</span><span class="id"> _</span><span class="id"> &amp;&amp;</span><span class="id"> X]/</span>(<span class="id">BLeft</span><span class="id"> y</span><span class="id"> &lt;</span><span class="id"> b</span>)<span class="id">%O/=</span> (<span class="id">lt_trans</span><span class="id"> az</span><span class="id"> zy</span>).<br/>
<span class="id">have</span><span class="id"> [fpoo|fpoo]</span><span class="id"> :=</span><span class="id"> pselect</span><span class="id"> {in</span><span class="id"> Interval</span> (<span class="id">BRight</span><span class="id"> a</span>)<span class="id"> b,</span><span class="gallina-kwd"> forall</span><span class="id"> x,</span><span class="id"> f</span><span class="id"> x</span><span class="id"> =</span><span class="id"> +oo}</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> {}/l</span><span class="gallina-kwd"> in</span><span class="id"> lnoo</span><span class="id"> *;</span><span class="id"> rewrite</span><span class="id"> {}/S</span><span class="gallina-kwd"> in</span><span class="id"> Snoo</span><span class="id"> lnoo</span><span class="id"> *</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> [X</span><span class="gallina-kwd"> in</span><span class="id"> ereal_inf</span><span class="id"> X]</span>(_<span class="id"> :</span><span class="id"> _</span><span class="id"> =</span><span class="id"> [set</span><span class="id"> +oo]</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> ereal_inf1;</span><span class="id"> apply/cvgeyPgey;</span><span class="id"> near=&gt;</span><span class="id"> M</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">move:</span><span class="id"> b</span><span class="id"> ab</span><span class="id"> {ndf</span><span class="id"> lnoo</span><span class="id"> Snoo}</span><span class="id"> fpoo</span><span class="id"> =&gt;</span><span class="id"> [[|]</span><span class="id"> b|[//|]]</span><span class="id"> ab</span><span class="id"> fpoo</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="id"> near=&gt;</span><span class="id"> x;</span><span class="id"> rewrite</span><span class="id"> fpoo</span><span class="id"> ?leey//</span><span class="id"> in_itv/=</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply/andP;</span><span class="id"> split;</span><span class="id"> near:</span><span class="id"> x;</span><span class="id"> [exact:</span><span class="id"> nbhs_right_gt|exact:</span><span class="id"> nbhs_right_lt]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="id"> near=&gt;</span><span class="id"> x;</span><span class="id"> rewrite</span><span class="id"> fpoo</span><span class="id"> ?leey//</span><span class="id"> in_itv/=</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply/andP;</span><span class="id"> split;</span><span class="id"> near:</span><span class="id"> x;</span><span class="id"> [exact:</span><span class="id"> nbhs_right_gt|exact:</span><span class="id"> nbhs_right_le]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="id"> near=&gt;</span><span class="id"> x;</span><span class="id"> rewrite</span><span class="id"> fpoo</span><span class="id"> ?leey//</span><span class="id"> in_itv/=</span><span class="id"> andbT</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> near:</span><span class="id"> x;</span><span class="id"> exact:</span><span class="id"> nbhs_right_gt</span>.<br/>
&nbsp;&nbsp;<span class="id">apply/seteqP;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> [_</span><span class="id"> [n</span><span class="id"> _]</span><span class="id"> &lt;-</span><span class="id"> /[!fpoo]//|_</span><span class="id"> -&gt;]</span>.<br/>
&nbsp;&nbsp;<span class="id">move:</span><span class="id"> b</span><span class="id"> ab</span><span class="id"> ndf</span><span class="id"> lnoo</span><span class="id"> Snoo</span><span class="id"> fpoo</span><span class="id"> =&gt;</span><span class="id"> [[|]</span><span class="id"> s|[//|]]</span><span class="id"> ab</span><span class="id"> ndf</span><span class="id"> lnoo</span><span class="id"> Snoo</span><span class="id"> fpoo</span><span class="id"> /=</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="gallina-kwd"> exists</span> ((<span class="id">a</span><span class="id"> +</span><span class="id"> s</span>)<span class="id"> /</span><span class="id"> 2</span>)<span class="id">%R;</span><span class="id"> rewrite</span><span class="id"> ?fpoo//</span><span class="id"> in_itv/=</span><span class="id"> !midf_lt</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="gallina-kwd"> exists</span> ((<span class="id">a</span><span class="id"> +</span><span class="id"> s</span>)<span class="id"> /</span><span class="id"> 2</span>)<span class="id">%R;</span><span class="id"> rewrite</span><span class="id"> ?fpoo//</span><span class="id"> in_itv/=</span><span class="id"> !</span>(<span class="id">midf_lt,</span><span class="id"> midf_le</span>)<span class="id">//</span><span class="id"> ltW</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="gallina-kwd"> exists</span> (<span class="id">a</span><span class="id"> +</span><span class="id"> 1</span>)<span class="id">%R;</span><span class="id"> rewrite</span><span class="id"> ?fpoo//</span><span class="id"> in_itv/=</span><span class="id"> andbT</span><span class="id"> ltrDl</span>.<br/>
<span class="id">have</span><span class="id"> [/ereal_inf_pinfty</span><span class="id"> lpoo|lpoo]</span><span class="id"> :=</span><span class="id"> eqVneq</span><span class="id"> l</span><span class="id"> +oo</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> exfalso;</span><span class="id"> apply/fpoo</span><span class="id"> =&gt;</span><span class="id"> r</span><span class="id"> rab;</span><span class="id"> rewrite</span> (<span class="id">lpoo</span> (<span class="id">f</span><span class="id"> r</span>))<span class="id">//;</span><span class="gallina-kwd"> exists</span><span class="id"> r</span>.<br/>
<span class="id">have</span><span class="id"> l_fin_num</span><span class="id"> :</span><span class="id"> l</span><span class="id"> \is</span><span class="id"> a</span><span class="id"> fin_num</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> fin_numE</span><span class="id"> lpoo</span><span class="id"> lnoo</span>.<br/>
<span class="id">set</span><span class="id"> A</span><span class="id"> :=</span><span class="id"> [set</span><span class="id"> r</span><span class="id"> |</span><span class="id"> [/\</span> (<span class="id">a</span><span class="id"> &lt;</span><span class="id"> r</span>)<span class="id">%R,</span> (<span class="id">BLeft</span><span class="id"> r</span><span class="id"> &lt;</span><span class="id"> b</span>)<span class="id">%O</span><span class="id"> &amp;</span><span class="id"> f</span><span class="id"> r</span><span class="id"> !=</span><span class="id"> +oo]]</span>.<br/>
<span class="id">have</span><span class="id"> f_fin_num</span><span class="id"> r</span><span class="id"> :</span><span class="id"> r</span><span class="id"> \in</span><span class="id"> A</span><span class="id"> -&gt;</span><span class="id"> f</span><span class="id"> r</span><span class="id"> \is</span><span class="id"> a</span><span class="id"> fin_num</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> inE</span><span class="id"> /A/=</span><span class="id"> =&gt;</span><span class="id"> -[ar</span><span class="id"> rb]</span><span class="id"> frnoo;</span><span class="id"> rewrite</span><span class="id"> fin_numE</span><span class="id"> frnoo</span><span class="id"> andbT</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> contra_notN</span><span class="id"> Snoo</span><span class="id"> =&gt;</span><span class="id"> /eqP</span><span class="id"> frpoo</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="gallina-kwd"> exists</span><span class="id"> r</span><span class="id"> =&gt;</span><span class="id"> //=;</span><span class="id"> rewrite</span><span class="id"> in_itv/=</span><span class="id"> -[X</span><span class="gallina-kwd"> in</span><span class="id"> _</span><span class="id"> &amp;&amp;</span><span class="id"> X]/</span>(<span class="id">BLeft</span><span class="id"> r</span><span class="id"> &lt;</span><span class="id"> b</span>)<span class="id">%O</span><span class="id"> ar</span><span class="id"> rb</span>.<br/>
<span class="id">have</span><span class="id"> [x</span><span class="id"> [ax</span><span class="id"> xb</span><span class="id"> fxpoo]]</span><span class="id"> :</span><span class="id"> A</span><span class="id"> !=set0</span>.<br/>
&nbsp;&nbsp;<span class="id">apply/set0P/negP</span><span class="id"> =&gt;</span><span class="id"> /eqP</span><span class="id"> A0;</span><span class="id"> apply/fpoo</span><span class="id"> =&gt;</span><span class="id"> x</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> in_itv/=</span><span class="id"> -[X</span><span class="gallina-kwd"> in</span><span class="id"> _</span><span class="id"> &amp;&amp;</span><span class="id"> X]/</span>(<span class="id">BLeft</span><span class="id"> x</span><span class="id"> &lt;</span><span class="id"> b</span>)<span class="id">%O</span><span class="id"> =&gt;</span><span class="id"> /andP[ax</span><span class="id"> xb]</span>.<br/>
&nbsp;&nbsp;<span class="id">apply/eqP/negPn/negP</span><span class="id"> =&gt;</span><span class="id"> unnoo</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move/seteqP</span><span class="id"> :</span><span class="id"> A0</span><span class="id"> =&gt;</span><span class="id"> [+</span><span class="id"> _]</span><span class="id"> =&gt;</span><span class="id"> /</span>(_<span class="id"> x</span>)<span class="id">;</span><span class="id"> apply;</span><span class="id"> rewrite</span><span class="id"> /A/=</span><span class="id"> ax</span>.<br/>
<span class="id">have</span><span class="id"> axA</span><span class="id"> r</span><span class="id"> :</span> (<span class="id">a</span><span class="id"> &lt;</span><span class="id"> r</span><span class="id"> &lt;=</span><span class="id"> x</span>)<span class="id">%R</span><span class="id"> -&gt;</span><span class="id"> r</span><span class="id"> \in</span><span class="id"> A</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> /andP[ar</span><span class="id"> rx];</span><span class="id"> move:</span> (<span class="id">rx</span>)<span class="id"> =&gt;</span><span class="id"> /ndf</span><span class="id"> rafx;</span><span class="id"> rewrite</span><span class="id"> /A</span><span class="id"> /=</span><span class="id"> inE;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span> (<span class="id">le_lt_trans</span><span class="id"> _</span><span class="id"> xb</span>).<br/>
&nbsp;&nbsp;<span class="id">apply/negP</span><span class="id"> =&gt;</span><span class="id"> /eqP</span><span class="id"> urnoo</span>.<br/>
&nbsp;&nbsp;<span class="id">move:</span><span class="id"> rafx;</span><span class="id"> rewrite</span><span class="id"> urnoo</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> in_itv/=</span><span class="id"> -[X</span><span class="gallina-kwd"> in</span><span class="id"> _</span><span class="id"> &amp;&amp;</span><span class="id"> X]/</span>(<span class="id">BLeft</span><span class="id"> r</span><span class="id"> &lt;</span><span class="id"> b</span>)<span class="id">%O</span><span class="id"> ar/=</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> in_itv/=</span><span class="id"> -[X</span><span class="gallina-kwd"> in</span><span class="id"> _</span><span class="id"> &amp;&amp;</span><span class="id"> X]/</span>(<span class="id">BLeft</span><span class="id"> x</span><span class="id"> &lt;</span><span class="id"> b</span>)<span class="id">%O</span><span class="id"> ax/=</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> leye_eq</span> (<span class="id">negbTE</span><span class="id"> fxpoo</span>)<span class="id"> -falseE;</span><span class="id"> apply;</span><span class="id"> rewrite</span> (<span class="id">le_lt_trans</span><span class="id"> _</span><span class="id"> xb</span>).<br/>
<span class="id">rewrite</span><span class="id"> -</span>(<span class="id">@fineK</span><span class="id"> _</span><span class="id"> l</span>)<span class="id">//;</span><span class="id"> apply/fine_cvgP;</span><span class="id"> split</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">exists</span> (<span class="id">x</span><span class="id"> -</span><span class="id"> a</span>)<span class="id">%R</span><span class="id"> =&gt;</span><span class="id"> /=;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> subr_gt0</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> z</span><span class="id"> /=</span><span class="id"> +</span><span class="id"> az</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> ltr0_norm</span><span class="id"> ?subr_lt0//</span><span class="id"> opprB</span><span class="id"> ltrBlDr</span><span class="id"> subrK//</span><span class="id"> =&gt;</span><span class="id"> zx</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> f_fin_num//</span><span class="id"> axA//</span><span class="id"> az/=</span><span class="id"> ltW</span>.<br/>
<span class="id">set</span><span class="id"> g</span><span class="id"> :=</span><span class="gallina-kwd"> fun</span><span class="id"> n</span><span class="id"> =&gt;</span><span class="gallina-kwd"> if</span> (<span class="id">a</span><span class="id"> &lt;</span><span class="id"> n</span><span class="id"> &lt;</span><span class="id"> x</span>)<span class="id">%R</span><span class="gallina-kwd"> then</span><span class="id"> fine</span> (<span class="id">f</span><span class="id"> n</span>)<span class="gallina-kwd"> else</span><span class="id"> fine</span> (<span class="id">f</span><span class="id"> x</span>).<br/>
<span class="id">have</span><span class="id"> &lt;-</span><span class="id"> :</span><span class="id"> inf</span><span class="id"> [set</span><span class="id"> g</span><span class="id"> x</span><span class="id"> |</span><span class="id"> x</span><span class="gallina-kwd"> in</span><span class="id"> [set`</span><span class="id"> Interval</span> (<span class="id">BRight</span><span class="id"> a</span>)<span class="id"> b]]</span><span class="id"> =</span><span class="id"> fine</span><span class="id"> l</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> EFin_inj;</span><span class="id"> rewrite</span><span class="id"> -ereal_inf_EFin//;</span><span class="id"> last</span><span class="id"> 2</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> exists</span> (<span class="id">fine</span><span class="id"> l</span>)<span class="id"> =&gt;</span><span class="id"> /=</span><span class="id"> _</span><span class="id"> [m</span><span class="id"> _</span><span class="id"> &lt;-];</span><span class="id"> rewrite</span><span class="id"> /g</span><span class="id"> /=</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">case:</span><span class="id"> ifPn</span><span class="id"> =&gt;</span><span class="id"> [/andP[am</span><span class="id"> mx]|]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> fine_le//</span><span class="id"> ?f_fin_num//;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> axA//</span><span class="id"> am</span> (<span class="id">ltW</span><span class="id"> mx</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> ereal_inf_lbound;</span><span class="gallina-kwd"> exists</span><span class="id"> m</span><span class="id"> =&gt;</span><span class="id"> //=</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> in_itv/=</span><span class="id"> -[X</span><span class="gallina-kwd"> in</span><span class="id"> _</span><span class="id"> &amp;&amp;</span><span class="id"> X]/</span>(<span class="id">BLeft</span><span class="id"> m</span><span class="id"> &lt;</span><span class="id"> b</span>)<span class="id">%O</span><span class="id"> am/=</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span> (<span class="id">le_lt_trans</span><span class="id"> _</span><span class="id"> xb</span>)<span class="id"> ?ltW</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> negb_and</span><span class="id"> -!leNgt</span><span class="id"> =&gt;</span><span class="id"> /orP[ma|xm]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> fine_le//</span><span class="id"> ?f_fin_num</span><span class="id"> ?inE//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> ereal_inf_lbound;</span><span class="gallina-kwd"> exists</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> //=</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> in_itv/=</span><span class="id"> -[X</span><span class="gallina-kwd"> in</span><span class="id"> _</span><span class="id"> &amp;&amp;</span><span class="id"> X]/</span>(<span class="id">BLeft</span><span class="id"> x</span><span class="id"> &lt;</span><span class="id"> b</span>)<span class="id">%O</span><span class="id"> ax</span><span class="id"> xb</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> fine_le//</span><span class="id"> ?f_fin_num</span><span class="id"> ?inE//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> ereal_inf_lbound;</span><span class="gallina-kwd"> exists</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> //=</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> in_itv/=</span><span class="id"> -[X</span><span class="gallina-kwd"> in</span><span class="id"> _</span><span class="id"> &amp;&amp;</span><span class="id"> X]/</span>(<span class="id">BLeft</span><span class="id"> x</span><span class="id"> &lt;</span><span class="id"> b</span>)<span class="id">%O</span><span class="id"> ax</span><span class="id"> xb</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="id"> rewrite</span><span class="id"> {}/l</span><span class="gallina-kwd"> in</span><span class="id"> lnoo</span><span class="id"> lpoo</span><span class="id"> l_fin_num</span><span class="id"> *</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> {}/S</span><span class="gallina-kwd"> in</span><span class="id"> Snoo</span><span class="id"> lnoo</span><span class="id"> lpoo</span><span class="id"> l_fin_num</span><span class="id"> *</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> {}/A</span><span class="gallina-kwd"> in</span><span class="id"> f_fin_num</span><span class="id"> axA</span><span class="id"> *</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">move:</span><span class="id"> b</span><span class="id"> ab</span><span class="id"> {xb</span><span class="id"> ndf</span><span class="id"> lnoo</span><span class="id"> lpoo</span><span class="id"> l_fin_num</span><span class="id"> f_fin_num</span><span class="id"> Snoo</span><span class="id"> fpoo</span><span class="id"> axA}</span><span class="id"> =&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">[[|]</span><span class="id"> s|[//|]]</span><span class="id"> ab</span><span class="id"> /=</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> exists</span> (<span class="id">g</span> ((<span class="id">a</span><span class="id"> +</span><span class="id"> s</span>)<span class="id"> /</span><span class="id"> 2</span>))<span class="id">%R,</span> ((<span class="id">a</span><span class="id"> +</span><span class="id"> s</span>)<span class="id"> /</span><span class="id"> 2</span>)<span class="id">%R</span><span class="id"> =&gt;</span><span class="id"> //=</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /=</span><span class="id"> in_itv/=</span><span class="id"> !midf_lt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> exists</span> (<span class="id">g</span> ((<span class="id">a</span><span class="id"> +</span><span class="id"> s</span>)<span class="id"> /</span><span class="id"> 2</span>))<span class="id">%R,</span> ((<span class="id">a</span><span class="id"> +</span><span class="id"> s</span>)<span class="id"> /</span><span class="id"> 2</span>)<span class="id">%R</span><span class="id"> =&gt;</span><span class="id"> //=</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /=</span><span class="id"> in_itv/=</span><span class="id"> !</span>(<span class="id">midf_lt,</span><span class="id"> midf_le</span>)<span class="id">//</span><span class="id"> ltW</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> exists</span> (<span class="id">g</span> (<span class="id">a</span><span class="id"> +</span><span class="id"> 1</span>)<span class="id">%R</span>)<span class="id">,</span> (<span class="id">a</span><span class="id"> +</span><span class="id"> 1</span>)<span class="id">%R</span><span class="id"> =&gt;</span><span class="id"> //=</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> in_itv/=</span><span class="id"> andbT</span><span class="id"> ltrDl</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> fineK//;</span><span class="id"> apply/eqP;</span><span class="id"> rewrite</span><span class="id"> eq_le;</span><span class="id"> apply/andP;</span><span class="id"> split;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> le_ereal_inf</span><span class="id"> =&gt;</span><span class="id"> _</span><span class="id"> /=</span><span class="id"> [_</span><span class="id"> [m</span><span class="id"> _]</span><span class="id"> &lt;-]</span><span class="id"> &lt;-</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> /g;</span><span class="id"> case:</span><span class="id"> ifPn</span><span class="id"> =&gt;</span><span class="id"> [/andP[am</span><span class="id"> mx]|]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> fineK//</span><span class="id"> ?f_fin_num//;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> axA//</span><span class="id"> am</span><span class="id"> ltW</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">exists</span><span class="id"> m</span><span class="id"> =&gt;</span><span class="id"> //=</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> in_itv/=</span><span class="id"> -[X</span><span class="gallina-kwd"> in</span><span class="id"> _</span><span class="id"> &amp;&amp;</span><span class="id"> X]/</span>(<span class="id">BLeft</span><span class="id"> m</span><span class="id"> &lt;</span><span class="id"> b</span>)<span class="id">%O</span><span class="id"> am/=</span> (<span class="id">lt_trans</span><span class="id"> _</span><span class="id"> xb</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> negb_and</span><span class="id"> -!leNgt</span><span class="id"> =&gt;</span><span class="id"> /orP[ma|xm]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> fineK//;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> f_fin_num</span><span class="id"> ?inE</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">exists</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> //=</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> in_itv/=</span><span class="id"> -[X</span><span class="gallina-kwd"> in</span><span class="id"> _</span><span class="id"> &amp;&amp;</span><span class="id"> X]/</span>(<span class="id">BLeft</span><span class="id"> x</span><span class="id"> &lt;</span><span class="id"> b</span>)<span class="id">%O</span><span class="id"> ax</span><span class="id"> xb</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">exists</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> /=</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> in_itv/=</span><span class="id"> -[X</span><span class="gallina-kwd"> in</span><span class="id"> _</span><span class="id"> &amp;&amp;</span><span class="id"> X]/</span>(<span class="id">BLeft</span><span class="id"> x</span><span class="id"> &lt;</span><span class="id"> b</span>)<span class="id">%O</span><span class="id"> ax</span><span class="id"> xb</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> fineK//</span><span class="id"> f_fin_num</span><span class="id"> ?inE</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> lb_ereal_inf</span><span class="id"> =&gt;</span><span class="id"> /=</span><span class="id"> y</span><span class="id"> [m]</span><span class="id"> /=</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> in_itv/=</span><span class="id"> -[X</span><span class="gallina-kwd"> in</span><span class="id"> _</span><span class="id"> &amp;&amp;</span><span class="id"> X]/</span>(<span class="id">BLeft</span><span class="id"> m</span><span class="id"> &lt;</span><span class="id"> b</span>)<span class="id">%O</span><span class="id"> =&gt;</span><span class="id"> /andP[am</span><span class="id"> mb]</span><span class="id"> &lt;-{y}</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> [mx|xm]</span><span class="id"> :=</span><span class="id"> ltP</span><span class="id"> m</span><span class="id"> x</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> ereal_inf_lbound</span><span class="id"> =&gt;</span><span class="id"> /=;</span><span class="gallina-kwd"> exists</span> (<span class="id">fine</span> (<span class="id">f</span><span class="id"> m</span>))<span class="id">;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> fineK//</span><span class="id"> f_fin_num//</span><span class="id"> axA//</span><span class="id"> am</span> (<span class="id">ltW</span><span class="id"> mx</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="gallina-kwd"> exists</span><span class="id"> m;</span><span class="id"> [rewrite</span><span class="id"> in_itv/=</span><span class="id"> am|rewrite</span><span class="id"> /g</span><span class="id"> am</span><span class="id"> mx]</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> (<span class="id">@le_trans</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> x</span>))<span class="id">//;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> ndf</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> rewrite</span><span class="id"> in_itv//=</span><span class="id"> ?ax</span><span class="id"> ?am</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> ereal_inf_lbound</span><span class="id"> =&gt;</span><span class="id"> /=;</span><span class="gallina-kwd"> exists</span> (<span class="id">fine</span> (<span class="id">f</span><span class="id"> x</span>))<span class="id">;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> fineK//</span><span class="id"> f_fin_num</span><span class="id"> ?inE</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="gallina-kwd"> exists</span><span class="id"> x;</span><span class="id"> [rewrite</span><span class="id"> in_itv/=</span><span class="id"> ax|rewrite</span><span class="id"> /g</span><span class="id"> ltxx</span><span class="id"> andbF]</span>.<br/>
<span class="id">suff:</span><span class="id"> g</span><span class="id"> x</span><span class="id"> @[x</span><span class="id"> --&gt;</span><span class="id"> a^'+]</span><span class="id"> --&gt;</span><span class="id"> inf</span><span class="id"> [set</span><span class="id"> g</span><span class="id"> x</span><span class="id"> |</span><span class="id"> x</span><span class="gallina-kwd"> in</span><span class="id"> [set`</span><span class="id"> Interval</span> (<span class="id">BRight</span><span class="id"> a</span>)<span class="id"> b]]</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> cvg_trans;</span><span class="id"> apply:</span><span class="id"> near_eq_cvg;</span><span class="id"> near=&gt;</span><span class="id"> n</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> /g</span><span class="id"> /=;</span><span class="id"> case:</span><span class="id"> ifPn</span><span class="id"> =&gt;</span><span class="id"> [//|]</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> negb_and</span><span class="id"> -!leNgt</span><span class="id"> =&gt;</span><span class="id"> /orP[na|xn]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exfalso</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">move:</span><span class="id"> na;</span><span class="id"> rewrite</span><span class="id"> leNgt</span><span class="id"> =&gt;</span><span class="id"> /negP;</span><span class="id"> apply</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> near:</span><span class="id"> n;</span><span class="id"> exact:</span><span class="id"> nbhs_right_gt</span>.<br/>
&nbsp;&nbsp;<span class="id">suff</span><span class="id"> nx</span><span class="id"> :</span> (<span class="id">n</span><span class="id"> &lt;</span><span class="id"> x</span>)<span class="id">%R</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> ltNge</span><span class="id"> xn</span><span class="gallina-kwd"> in</span><span class="id"> nx</span>.<br/>
&nbsp;&nbsp;<span class="id">near:</span><span class="id"> n;</span><span class="gallina-kwd"> exists</span> ((<span class="id">x</span><span class="id"> -</span><span class="id"> a</span>)<span class="id"> /</span><span class="id"> 2</span>)<span class="id">%R;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> /=</span><span class="id"> divr_gt0//</span><span class="id"> subr_gt0</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> y</span><span class="id"> /=</span><span class="id"> /[swap]</span><span class="id"> ay</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> ltr0_norm//</span><span class="id"> ?subr_lt0//</span><span class="id"> opprB</span><span class="id"> ltrBlDr</span><span class="id"> =&gt;</span><span class="id"> /lt_le_trans;</span><span class="id"> apply</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -lerBrDr</span><span class="id"> ler_pdivrMr//</span><span class="id"> ler_pMr//</span><span class="id"> ?ler1n//</span><span class="id"> subr_gt0</span>.<br/>
<span class="id">apply:</span><span class="id"> nondecreasing_at_right_cvgr</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
<span class="id">-</span><span class="id"> move=&gt;</span><span class="id"> m</span><span class="id"> n;</span><span class="id"> rewrite</span><span class="id"> !in_itv/=</span><span class="id"> -[X</span><span class="gallina-kwd"> in</span><span class="id"> _</span><span class="id"> &amp;&amp;</span><span class="id"> X]/</span>(<span class="id">BLeft</span><span class="id"> m</span><span class="id"> &lt;</span><span class="id"> b</span>)<span class="id">%O</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -[X</span><span class="gallina-kwd"> in</span><span class="id"> _</span><span class="id"> -&gt;</span><span class="id"> _</span><span class="id"> &amp;&amp;</span><span class="id"> X</span><span class="id"> -&gt;</span><span class="id"> _]/</span>(<span class="id">BLeft</span><span class="id"> n</span><span class="id"> &lt;</span><span class="id"> b</span>)<span class="id">%O</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> /andP[am</span><span class="id"> mb]</span><span class="id"> /andP[an</span><span class="id"> nb]</span><span class="id"> mn</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> /g</span><span class="id"> /=;</span><span class="id"> case:</span><span class="id"> ifPn</span><span class="id"> =&gt;</span><span class="id"> [/andP[_</span><span class="id"> mx]|]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> (<span class="id">lt_le_trans</span><span class="id"> am</span><span class="id"> mn</span>)<span class="id"> /=;</span><span class="id"> have</span><span class="id"> [nx|nn0]</span><span class="id"> :=</span><span class="id"> ltP</span><span class="id"> n</span><span class="id"> x</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> fine_le</span><span class="id"> ?f_fin_num</span><span class="id"> ?ndf//;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> axA//</span><span class="id"> am</span> (<span class="id">ltW</span><span class="id"> mx</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> axA//</span> (<span class="id">ltW</span><span class="id"> nx</span>)<span class="id"> andbT</span> (<span class="id">lt_le_trans</span><span class="id"> am</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> in_itv/=</span><span class="id"> am</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> in_itv/=</span><span class="id"> an</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> fine_le</span><span class="id"> ?f_fin_num//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> axA//</span><span class="id"> am</span> (<span class="id">ltW</span> (<span class="id">lt_le_trans</span><span class="id"> mx</span><span class="id"> _</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> inE</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">+</span><span class="id"> rewrite</span><span class="id"> ndf//;</span><span class="id"> last</span><span class="id"> exact/ltW</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> !in_itv/=</span><span class="id"> am</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> !in_itv/=</span><span class="id"> ax</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> negb_and</span><span class="id"> -!leNgt</span><span class="id"> =&gt;</span><span class="id"> /orP[|xm];</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> leNgt</span><span class="id"> am</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span> (<span class="id">lt_le_trans</span><span class="id"> am</span><span class="id"> mn</span>)<span class="id">/=</span><span class="id"> ltNge</span> (<span class="id">le_trans</span><span class="id"> xm</span><span class="id"> mn</span>).<br/>
<span class="id">-</span><span class="gallina-kwd"> exists</span> (<span class="id">fine</span><span class="id"> l</span>)<span class="id"> =&gt;</span><span class="id"> /=</span><span class="id"> _</span><span class="id"> [m</span><span class="id"> _</span><span class="id"> &lt;-];</span><span class="id"> rewrite</span><span class="id"> /g</span><span class="id"> /=</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -lee_fin</span> (<span class="id">fineK</span><span class="id"> l_fin_num</span>)<span class="id">;</span><span class="id"> apply:</span><span class="id"> ereal_inf_lbound</span>.<br/>
&nbsp;&nbsp;<span class="id">case:</span><span class="id"> ifPn</span><span class="id"> =&gt;</span><span class="id"> [/andP[am</span><span class="id"> mn0]|]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> fineK//;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> f_fin_num//</span><span class="id"> axA//</span><span class="id"> am</span> (<span class="id">ltW</span><span class="id"> mn0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">exists</span><span class="id"> m</span><span class="id"> =&gt;</span><span class="id"> //=</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> in_itv/=</span><span class="id"> -[X</span><span class="gallina-kwd"> in</span><span class="id"> _</span><span class="id"> &amp;&amp;</span><span class="id"> X]/</span>(<span class="id">BLeft</span><span class="id"> m</span><span class="id"> &lt;</span><span class="id"> b</span>)<span class="id">%O</span><span class="id"> am</span> (<span class="id">lt_trans</span><span class="id"> _</span><span class="id"> xb</span>).<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> negb_and</span><span class="id"> -!leNgt</span><span class="id"> =&gt;</span><span class="id"> /orP[ma|xm]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> fineK//;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="gallina-kwd"> exists</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> //=;</span><span class="id"> rewrite</span><span class="id"> in_itv/=</span><span class="id"> ax</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> f_fin_num</span><span class="id"> ?inE</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> fineK//</span><span class="id"> ?f_fin_num</span><span class="id"> ?inE//;</span><span class="gallina-kwd"> exists</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> //=;</span><span class="id"> rewrite</span><span class="id"> in_itv/=</span><span class="id"> ax</span>.<br/>
<span class="id">Unshelve</span>.<span class="id"> all:</span><span class="gallina-kwd"> by</span><span class="id"> end_near</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> nondecreasing_at_right_is_cvge</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>) (<span class="id">a</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">\forall</span><span class="id"> x</span><span class="id"> \near</span><span class="id"> a^'+,</span><span class="id"> {in</span><span class="id"> `]a,</span><span class="id"> x[</span><span class="id"> &amp;,</span><span class="id"> nondecreasing_fun</span><span class="id"> f}</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">cvg</span> (<span class="id">f</span><span class="id"> x</span><span class="id"> @[x</span><span class="id"> --&gt;</span><span class="id"> a</span><span class="id"> ^'+]</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> ndf;</span><span class="id"> apply/cvg_ex;</span><span class="id"> near</span><span class="id"> a^'+</span><span class="id"> =&gt;</span><span class="id"> b</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> eexists;</span><span class="id"> apply:</span> (<span class="id">@nondecreasing_at_right_cvge</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">BLeft</span><span class="id"> b</span>))<span class="id">;</span><br/>
&nbsp;&nbsp;<span class="id">[rewrite</span><span class="id"> bnd_simp|near:</span><span class="id"> b</span>..<span class="id">]</span>.<br/>
<span class="id">Unshelve</span>.<span class="id"> all:</span><span class="gallina-kwd"> by</span><span class="id"> end_near</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> nonincreasing_at_right_cvge</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id"> a</span> (<span class="id">b</span><span class="id"> :</span><span class="id"> itv_bound</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">BRight</span><span class="id"> a</span><span class="id"> &lt;</span><span class="id"> b</span>)<span class="id">%O</span><span class="id"> -&gt;</span><span class="id"> {in</span><span class="id"> Interval</span> (<span class="id">BRight</span><span class="id"> a</span>)<span class="id"> b</span><span class="id"> &amp;,</span><span class="id"> nonincreasing_fun</span><span class="id"> f}</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">f</span><span class="id"> x</span><span class="id"> @[x</span><span class="id"> --&gt;</span><span class="id"> a</span><span class="id"> ^'+]</span><span class="id"> --&gt;</span><span class="id"> ereal_sup</span> (<span class="id">f</span><span class="id"> @`</span><span class="id"> [set`</span><span class="id"> Interval</span> (<span class="id">BRight</span><span class="id"> a</span>)<span class="id"> b]</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> ab</span><span class="id"> nif;</span><span class="id"> have</span><span class="id"> ndNf</span><span class="id"> :</span><span class="id"> {in</span><span class="id"> Interval</span> (<span class="id">BRight</span><span class="id"> a</span>)<span class="id"> b</span><span class="id"> &amp;,</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">{homo</span> (<span class="id">\-</span><span class="id"> f</span>)<span class="id"> :</span><span class="id"> n</span><span class="id"> m</span><span class="id"> /</span> (<span class="id">n</span><span class="id"> &lt;=</span><span class="id"> m</span>)<span class="id">%R</span><span class="id"> &gt;-&gt;</span><span class="id"> n</span><span class="id"> &lt;=</span><span class="id"> m}}</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> r</span><span class="id"> s</span><span class="id"> rab</span><span class="id"> sab</span><span class="id"> /nif;</span><span class="id"> rewrite</span><span class="id"> leeN2;</span><span class="id"> exact</span>.<br/>
<span class="id">have</span><span class="id"> /cvgeN</span><span class="id"> :=</span><span class="id"> nondecreasing_at_right_cvge</span><span class="id"> ab</span><span class="id"> ndNf</span>.<br/>
<span class="id">under</span><span class="id"> eq_fun</span><span class="id"> do</span><span class="id"> rewrite</span><span class="id"> oppeK</span>.<br/>
<span class="id">set</span><span class="id"> lhs</span><span class="id"> :=</span> (<span class="id">X</span><span class="gallina-kwd"> in</span><span class="id"> _</span><span class="id"> --&gt;</span><span class="id"> X</span><span class="id"> -&gt;</span><span class="id"> _</span>)<span class="id">;</span><span class="id"> set</span><span class="id"> rhs</span><span class="id"> :=</span> (<span class="id">X</span><span class="gallina-kwd"> in</span><span class="id"> _</span><span class="id"> -&gt;</span><span class="id"> _</span><span class="id"> --&gt;</span><span class="id"> X</span>).<br/>
<span class="id">suff</span><span class="id"> :</span><span class="id"> lhs</span><span class="id"> =</span><span class="id"> rhs</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> -&gt;</span>.<br/>
<span class="id">rewrite</span><span class="id"> {}/rhs</span><span class="id"> {}/lhs;</span><span class="id"> rewrite</span><span class="id"> /ereal_inf</span><span class="id"> oppeK;</span><span class="id"> congr</span><span class="id"> ereal_sup</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> image_comp/=;</span><span class="id"> apply:</span><span class="id"> eq_imagel</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> _</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> oppeK</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> nonincreasing_at_right_is_cvge</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id"> a</span><span class="id"> :</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">\forall</span><span class="id"> x</span><span class="id"> \near</span><span class="id"> a^'+,</span><span class="id"> {in</span><span class="id"> `]a,</span><span class="id"> x[</span><span class="id"> &amp;,</span><span class="id"> nonincreasing_fun</span><span class="id"> f}</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">cvg</span> (<span class="id">f</span><span class="id"> x</span><span class="id"> @[x</span><span class="id"> --&gt;</span><span class="id"> a</span><span class="id"> ^'+]</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> nif;</span><span class="id"> apply/cvg_ex;</span><span class="id"> near</span><span class="id"> a^'+</span><span class="id"> =&gt;</span><span class="id"> b</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> eexists;</span><span class="id"> apply:</span> (<span class="id">@nonincreasing_at_right_cvge</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">BLeft</span><span class="id"> b</span>))<span class="id">;</span><br/>
&nbsp;&nbsp;<span class="id">[rewrite</span><span class="id"> bnd_simp|near:</span><span class="id"> b</span>..<span class="id">]</span>.<br/>
<span class="id">Unshelve</span>.<span class="id"> all:</span><span class="gallina-kwd"> by</span><span class="id"> end_near</span>. Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> fun_cvg_ereal</span>.<br/>
<br/>
<span class="vernacular">End</span><span class="id"> fun_cvg</span>.<br/>
<span class="vernacular">Arguments</span><span class="id"> nondecreasing_at_right_cvge</span><span class="id"> {R</span><span class="id"> f</span><span class="id"> a}</span><span class="id"> b</span>.<br/>
<span class="vernacular">Arguments</span><span class="id"> nondecreasing_at_right_is_cvge</span><span class="id"> {R</span><span class="id"> f</span><span class="id"> a}</span>.<br/>
<span class="vernacular">Arguments</span><span class="id"> nonincreasing_at_right_cvge</span><span class="id"> {R</span><span class="id"> f</span><span class="id"> a}</span><span class="id"> b</span>.<br/>
<span class="vernacular">Arguments</span><span class="id"> nonincreasing_at_right_is_cvge</span><span class="id"> {R</span><span class="id"> f</span><span class="id"> a}</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> lime_sup_inf</span>.<br/>
<span class="vernacular">Variable</span><span class="id"> R</span><span class="id"> :</span><span class="id"> realType</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<span class="vernacular">Implicit</span><span class="id"> Types</span> (<span class="id">f</span><span class="id"> g</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>) (<span class="id">a</span><span class="id"> r</span><span class="id"> s</span><span class="id"> l</span><span class="id"> :</span><span class="id"> R</span>).<br/>
<br/>
<span class="vernacular">Definition</span><span class="id"> lime_sup</span><span class="id"> f</span><span class="id"> a</span><span class="id"> :</span><span class="id"> \bar</span><span class="id"> R</span><span class="id"> :=</span><span class="id"> limf_esup</span><span class="id"> f</span><span class="id"> a^'</span>.<br/>
<br/>
<span class="vernacular">Definition</span><span class="id"> lime_inf</span><span class="id"> f</span><span class="id"> a</span><span class="id"> :</span><span class="id"> \bar</span><span class="id"> R</span><span class="id"> :=</span><span class="id"> -</span><span class="id"> lime_sup</span> (<span class="id">\-</span><span class="id"> f</span>)<span class="id"> a</span>.<br/>
<br/>
<span class="vernacular">Let</span><span class="id"> sup_ball</span><span class="id"> f</span><span class="id"> a</span><span class="id"> r</span><span class="id"> :=</span><span class="id"> ereal_sup</span><span class="id"> [set</span><span class="id"> f</span><span class="id"> x</span><span class="id"> |</span><span class="id"> x</span><span class="gallina-kwd"> in</span><span class="id"> ball</span><span class="id"> a</span><span class="id"> r</span><span class="id"> `\</span><span class="id"> a]</span>.<br/>
<br/>
<span class="vernacular">Let</span><span class="id"> sup_ball_le</span><span class="id"> f</span><span class="id"> a</span><span class="id"> r</span><span class="id"> s</span><span class="id"> :</span> (<span class="id">r</span><span class="id"> &lt;=</span><span class="id"> s</span>)<span class="id">%R</span><span class="id"> -&gt;</span><span class="id"> sup_ball</span><span class="id"> f</span><span class="id"> a</span><span class="id"> r</span><span class="id"> &lt;=</span><span class="id"> sup_ball</span><span class="id"> f</span><span class="id"> a</span><span class="id"> s</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> rs;</span><span class="id"> apply:</span><span class="id"> ub_ereal_sup</span><span class="id"> =&gt;</span><span class="id"> /=</span><span class="id"> _</span><span class="id"> /=</span><span class="id"> [t</span><span class="id"> [rt</span><span class="id"> ta]</span><span class="id"> &lt;-]</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> ereal_sup_ubound</span><span class="id"> =&gt;</span><span class="id"> /=;</span><span class="gallina-kwd"> exists</span><span class="id"> t</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> le_ball</span><span class="id"> rt</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Let</span><span class="id"> sup_ball_is_cvg</span><span class="id"> f</span><span class="id"> a</span><span class="id"> :</span><span class="id"> cvg</span> (<span class="id">sup_ball</span><span class="id"> f</span><span class="id"> a</span><span class="id"> e</span><span class="id"> @[e</span><span class="id"> --&gt;</span><span class="id"> 0^'+]</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">apply:</span><span class="id"> nondecreasing_at_right_is_cvge;</span><span class="id"> near=&gt;</span><span class="id"> e</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> y;</span><span class="id"> rewrite</span><span class="id"> !in_itv/=</span><span class="id"> =&gt;</span><span class="id"> /andP[x0</span><span class="id"> xe]</span><span class="id"> /andP[y0</span><span class="id"> ye]</span><span class="id"> /sup_ball_le</span>.<br/>
<span class="id">Unshelve</span>.<span class="id"> all:</span><span class="gallina-kwd"> by</span><span class="id"> end_near</span>. Qed.</div></details>
<br/>
<span class="vernacular">Let</span><span class="id"> inf_ball</span><span class="id"> f</span><span class="id"> a</span><span class="id"> r</span><span class="id"> :=</span><span class="id"> -</span><span class="id"> sup_ball</span> (<span class="id">\-</span><span class="id"> f</span>)<span class="id"> a</span><span class="id"> r</span>.<br/>
<br/>
<span class="vernacular">Let</span><span class="id"> inf_ballE</span><span class="id"> f</span><span class="id"> a</span><span class="id"> r</span><span class="id"> :</span><span class="id"> inf_ball</span><span class="id"> f</span><span class="id"> a</span><span class="id"> r</span><span class="id"> =</span><span class="id"> ereal_inf</span><span class="id"> [set</span><span class="id"> f</span><span class="id"> x</span><span class="id"> |</span><span class="id"> x</span><span class="gallina-kwd"> in</span><span class="id"> ball</span><span class="id"> a</span><span class="id"> r</span><span class="id"> `\</span><span class="id"> a]</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /inf_ball</span><span class="id"> /ereal_inf;</span><span class="id"> congr</span> (<span class="id">-</span><span class="id"> _</span>)<span class="id">;</span><span class="id"> rewrite</span><span class="id"> /sup_ball</span><span class="id"> -image_comp</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Let</span><span class="id"> inf_ball_le</span><span class="id"> f</span><span class="id"> a</span><span class="id"> r</span><span class="id"> s</span><span class="id"> :</span> (<span class="id">s</span><span class="id"> &lt;=</span><span class="id"> r</span>)<span class="id">%R</span><span class="id"> -&gt;</span><span class="id"> inf_ball</span><span class="id"> f</span><span class="id"> a</span><span class="id"> r</span><span class="id"> &lt;=</span><span class="id"> inf_ball</span><span class="id"> f</span><span class="id"> a</span><span class="id"> s</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> sr;</span><span class="id"> rewrite</span><span class="id"> /inf_ball</span><span class="id"> leeNl</span><span class="id"> oppeK</span><span class="id"> sup_ball_le</span>. Qed.</div></details>
<br/>
<span class="vernacular">Let</span><span class="id"> inf_ball_is_cvg</span><span class="id"> f</span><span class="id"> a</span><span class="id"> :</span><span class="id"> cvg</span> (<span class="id">inf_ball</span><span class="id"> f</span><span class="id"> a</span><span class="id"> e</span><span class="id"> @[e</span><span class="id"> --&gt;</span><span class="id"> 0^'+]</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">apply:</span><span class="id"> nonincreasing_at_right_is_cvge;</span><span class="id"> near=&gt;</span><span class="id"> e</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> y;</span><span class="id"> rewrite</span><span class="id"> !in_itv/=</span><span class="id"> =&gt;</span><span class="id"> /andP[x0</span><span class="id"> xe]</span><span class="id"> /andP[y0</span><span class="id"> ye]</span><span class="id"> /inf_ball_le</span>.<br/>
<span class="id">Unshelve</span>.<span class="id"> all:</span><span class="gallina-kwd"> by</span><span class="id"> end_near</span>. Qed.</div></details>
<br/>
<span class="vernacular">Let</span><span class="id"> le_sup_ball</span><span class="id"> f</span><span class="id"> g</span><span class="id"> a</span><span class="id"> :</span><br/>
&nbsp;&nbsp;(<span class="id">\forall</span><span class="id"> r</span><span class="id"> \near</span><span class="id"> 0^'+,</span><span class="gallina-kwd"> forall</span><span class="id"> y</span><span class="id"> :</span><span class="id"> R,</span><span class="id"> y</span><span class="id"> !=</span><span class="id"> a</span><span class="id"> -&gt;</span><span class="id"> ball</span><span class="id"> a</span><span class="id"> r</span><span class="id"> y</span><span class="id"> -&gt;</span><span class="id"> f</span><span class="id"> y</span><span class="id"> &lt;=</span><span class="id"> g</span><span class="id"> y</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">\forall</span><span class="id"> r</span><span class="id"> \near</span><span class="id"> 0^'+,</span><span class="id"> sup_ball</span><span class="id"> f</span><span class="id"> a</span><span class="id"> r</span><span class="id"> &lt;=</span><span class="id"> sup_ball</span><span class="id"> g</span><span class="id"> a</span><span class="id"> r</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> [e/=</span><span class="id"> e0</span><span class="id"> fg]</span>.<br/>
<span class="id">near=&gt;</span><span class="id"> r;</span><span class="id"> apply:</span><span class="id"> ub_ereal_sup</span><span class="id"> =&gt;</span><span class="id"> /=</span><span class="id"> _</span><span class="id"> [s</span><span class="id"> [pas</span><span class="id"> /=</span><span class="id"> /eqP</span><span class="id"> ps]]</span><span class="id"> &lt;-</span>.<br/>
<span class="id">rewrite</span> (<span class="id">@le_trans</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">g</span><span class="id"> s</span>))<span class="id">//</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span> (<span class="id">fg</span><span class="id"> r</span>)<span class="id">//=</span><span class="id"> sub0r</span><span class="id"> normrN</span><span class="id"> gtr0_norm</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> ereal_sup_ubound</span><span class="id"> =&gt;</span><span class="id"> /=;</span><span class="gallina-kwd"> exists</span><span class="id"> s</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact/eqP</span>.<br/>
<span class="id">Unshelve</span>.<span class="id"> all:</span><span class="gallina-kwd"> by</span><span class="id"> end_near</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> lime_sup_lim</span><span class="id"> f</span><span class="id"> a</span><span class="id"> :</span><span class="id"> lime_sup</span><span class="id"> f</span><span class="id"> a</span><span class="id"> =</span><span class="id"> lim</span> (<span class="id">sup_ball</span><span class="id"> f</span><span class="id"> a</span><span class="id"> e</span><span class="id"> @[e</span><span class="id"> --&gt;</span><span class="id"> 0^'+]</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">apply/eqP;</span><span class="id"> rewrite</span><span class="id"> eq_le;</span><span class="id"> apply/andP;</span><span class="id"> split</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> lime_ge</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> near=&gt;</span><span class="id"> e;</span><span class="id"> apply:</span><span class="id"> ereal_inf_lbound</span><span class="id"> =&gt;</span><span class="id"> /=</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="gallina-kwd"> exists</span> (<span class="id">ball</span><span class="id"> a</span><span class="id"> e</span><span class="id"> `\</span><span class="id"> a</span>)<span class="id"> =&gt;</span><span class="id"> //=;</span><span class="id"> exact:</span><span class="id"> dnbhs_ball</span>.<br/>
<span class="id">apply:</span><span class="id"> lb_ereal_inf</span><span class="id"> =&gt;</span><span class="id"> /=</span><span class="id"> _</span><span class="id"> [A</span><span class="id"> [r</span><span class="id"> /=</span><span class="id"> r0</span><span class="id"> arA]</span><span class="id"> &lt;-]</span>.<br/>
<span class="id">apply:</span><span class="id"> lime_le</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> near=&gt;</span><span class="id"> e</span>.<br/>
<span class="id">apply:</span><span class="id"> le_ereal_sup</span><span class="id"> =&gt;</span><span class="id"> _</span><span class="id"> [s</span><span class="id"> [ase</span><span class="id"> /eqP</span><span class="id"> sa]</span><span class="id"> &lt;-</span><span class="id"> /=]</span>.<br/>
<span class="gallina-kwd">exists</span><span class="id"> s</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> apply:</span><span class="id"> arA</span><span class="id"> =&gt;</span><span class="id"> //=;</span><span class="id"> apply:</span> (<span class="id">lt_le_trans</span><span class="id"> ase</span>).<br/>
<span class="gallina-kwd">by</span><span class="id"> near:</span><span class="id"> e;</span><span class="id"> exact:</span><span class="id"> nbhs_right_le</span>.<br/>
<span class="id">Unshelve</span>.<span class="id"> all:</span><span class="gallina-kwd"> by</span><span class="id"> end_near</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> lime_inf_lim</span><span class="id"> f</span><span class="id"> a</span><span class="id"> :</span><span class="id"> lime_inf</span><span class="id"> f</span><span class="id"> a</span><span class="id"> =</span><span class="id"> lim</span> (<span class="id">inf_ball</span><span class="id"> f</span><span class="id"> a</span><span class="id"> e</span><span class="id"> @[e</span><span class="id"> --&gt;</span><span class="id"> 0^'+]</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> /lime_inf</span><span class="id"> lime_sup_lim</span><span class="id"> -limeN;</span><span class="id"> last</span><span class="id"> exact:</span><span class="id"> sup_ball_is_cvg</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /sup_ball;</span><span class="id"> under</span><span class="id"> eq_fun</span><span class="id"> do</span><span class="id"> rewrite</span><span class="id"> -image_comp</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> lime_supE</span><span class="id"> f</span><span class="id"> a</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">lime_sup</span><span class="id"> f</span><span class="id"> a</span><span class="id"> =</span><span class="id"> ereal_inf</span><span class="id"> [set</span><span class="id"> sup_ball</span><span class="id"> f</span><span class="id"> a</span><span class="id"> e</span><span class="id"> |</span><span class="id"> e</span><span class="gallina-kwd"> in</span><span class="id"> `]0,</span><span class="id"> +oo[</span><span class="id"> ]%R</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> lime_sup_lim;</span><span class="id"> apply/cvg_lim</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
<span class="id">apply:</span><span class="id"> nondecreasing_at_right_cvge</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> y;</span><span class="id"> rewrite</span><span class="id"> !in_itv/=</span><span class="id"> !andbT</span><span class="id"> =&gt;</span><span class="id"> x0</span><span class="id"> y0;</span><span class="id"> exact:</span><span class="id"> sup_ball_le</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> lime_infE</span><span class="id"> f</span><span class="id"> a</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">lime_inf</span><span class="id"> f</span><span class="id"> a</span><span class="id"> =</span><span class="id"> ereal_sup</span><span class="id"> [set</span><span class="id"> inf_ball</span><span class="id"> f</span><span class="id"> a</span><span class="id"> e</span><span class="id"> |</span><span class="id"> e</span><span class="gallina-kwd"> in</span><span class="id"> `]0,</span><span class="id"> +oo[</span><span class="id"> ]%R</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> /lime_inf</span><span class="id"> lime_supE</span><span class="id"> /ereal_inf</span><span class="id"> oppeK</span><span class="id"> image_comp</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> lime_infN</span><span class="id"> f</span><span class="id"> a</span><span class="id"> :</span><span class="id"> lime_inf</span> (<span class="id">\-</span><span class="id"> f</span>)<span class="id"> a</span><span class="id"> =</span><span class="id"> -</span><span class="id"> lime_sup</span><span class="id"> f</span><span class="id"> a</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> /lime_sup</span><span class="id"> -limf_einfN</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> lime_supN</span><span class="id"> f</span><span class="id"> a</span><span class="id"> :</span><span class="id"> lime_sup</span> (<span class="id">\-</span><span class="id"> f</span>)<span class="id"> a</span><span class="id"> =</span><span class="id"> -</span><span class="id"> lime_inf</span><span class="id"> f</span><span class="id"> a</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> /lime_inf</span><span class="id"> oppeK</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> __deprecated__lime_sup_ge0</span><span class="id"> f</span><span class="id"> a</span><span class="id"> :</span> (<span class="gallina-kwd">forall</span><span class="id"> x,</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> f</span><span class="id"> x</span>)<span class="id"> -&gt;</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> lime_sup</span><span class="id"> f</span><span class="id"> a</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> f0;</span><span class="id"> exact:</span><span class="id"> limf_esup_ge0</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> lime_inf_ge0</span><span class="id"> f</span><span class="id"> a</span><span class="id"> :</span> (<span class="gallina-kwd">forall</span><span class="id"> x,</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> f</span><span class="id"> x</span>)<span class="id"> -&gt;</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> lime_inf</span><span class="id"> f</span><span class="id"> a</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> f0;</span><span class="id"> rewrite</span><span class="id"> lime_inf_lim;</span><span class="id"> apply:</span><span class="id"> lime_ge;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> inf_ball_is_cvg</span>.<br/>
<span class="id">near=&gt;</span><span class="id"> b;</span><span class="id"> rewrite</span><span class="id"> inf_ballE</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> lb_ereal_inf</span><span class="id"> =&gt;</span><span class="id"> /=</span><span class="id"> _</span><span class="id"> [r</span><span class="id"> [abr/=</span><span class="id"> ra]]</span><span class="id"> &lt;-;</span><span class="id"> exact:</span><span class="id"> f0</span>.<br/>
<span class="id">Unshelve</span>.<span class="id"> all:</span><span class="gallina-kwd"> by</span><span class="id"> end_near</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> lime_supD</span><span class="id"> f</span><span class="id"> g</span><span class="id"> a</span><span class="id"> :</span><span class="id"> lime_sup</span><span class="id"> f</span><span class="id"> a</span><span class="id"> +?</span><span class="id"> lime_sup</span><span class="id"> g</span><span class="id"> a</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">lime_sup</span> (<span class="id">f</span><span class="id"> \+</span><span class="id"> g</span>)<span class="id">%E</span><span class="id"> a</span><span class="id"> &lt;=</span><span class="id"> lime_sup</span><span class="id"> f</span><span class="id"> a</span><span class="id"> +</span><span class="id"> lime_sup</span><span class="id"> g</span><span class="id"> a</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> fg;</span><span class="id"> rewrite</span><span class="id"> !lime_sup_lim</span><span class="id"> -limeD//;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -!lime_sup_lim</span>.<br/>
<span class="id">apply:</span><span class="id"> lee_lim</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
<span class="id">-</span><span class="id"> apply:</span><span class="id"> nondecreasing_at_right_is_cvge;</span><span class="id"> near=&gt;</span><span class="id"> e</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> y;</span><span class="id"> rewrite</span><span class="id"> !in_itv/=</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> /andP[?</span><span class="id"> ?]</span><span class="id"> /andP[?</span><span class="id"> ?]</span><span class="id"> xy;</span><span class="id"> apply:</span><span class="id"> leeD</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> sup_ball_le</span>.<br/>
<span class="id">-</span><span class="id"> near=&gt;</span><span class="id"> a0;</span><span class="id"> apply:</span><span class="id"> ub_ereal_sup</span><span class="id"> =&gt;</span><span class="id"> _</span><span class="id"> /=</span><span class="id"> [a1</span><span class="id"> [a1ae</span><span class="id"> a1a]]</span><span class="id"> &lt;-</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> leeD;</span><span class="id"> apply:</span><span class="id"> ereal_sup_ubound</span><span class="id"> =&gt;</span><span class="id"> /=;</span><span class="gallina-kwd"> exists</span><span class="id"> a1</span>.<br/>
<span class="id">Unshelve</span>.<span class="id"> all:</span><span class="gallina-kwd"> by</span><span class="id"> end_near</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> lime_sup_le</span><span class="id"> f</span><span class="id"> g</span><span class="id"> a</span><span class="id"> :</span><br/>
&nbsp;&nbsp;(<span class="id">\forall</span><span class="id"> r</span><span class="id"> \near</span><span class="id"> 0^'+,</span><span class="gallina-kwd"> forall</span><span class="id"> y,</span><span class="id"> y</span><span class="id"> !=</span><span class="id"> a</span><span class="id"> -&gt;</span><span class="id"> ball</span><span class="id"> a</span><span class="id"> r</span><span class="id"> y</span><span class="id"> -&gt;</span><span class="id"> f</span><span class="id"> y</span><span class="id"> &lt;=</span><span class="id"> g</span><span class="id"> y</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">lime_sup</span><span class="id"> f</span><span class="id"> a</span><span class="id"> &lt;=</span><span class="id"> lime_sup</span><span class="id"> g</span><span class="id"> a</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> fg;</span><span class="id"> rewrite</span><span class="id"> !lime_sup_lim;</span><span class="id"> apply:</span><span class="id"> lee_lim</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> le_sup_ball</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> lime_inf_sup</span><span class="id"> f</span><span class="id"> a</span><span class="id"> :</span><span class="id"> lime_inf</span><span class="id"> f</span><span class="id"> a</span><span class="id"> &lt;=</span><span class="id"> lime_sup</span><span class="id"> f</span><span class="id"> a</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> lime_inf_lim</span><span class="id"> lime_sup_lim;</span><span class="id"> apply:</span><span class="id"> lee_lim</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
<span class="id">near=&gt;</span><span class="id"> r;</span><span class="id"> rewrite</span><span class="id"> ereal_sup_le//</span>.<br/>
<span class="id">have</span><span class="id"> ?</span><span class="id"> :</span><span class="gallina-kwd"> exists2</span><span class="id"> x,</span><span class="id"> ball</span><span class="id"> a</span><span class="id"> r</span><span class="id"> x</span><span class="id"> /\</span><span class="id"> x</span><span class="id"> &lt;&gt;</span><span class="id"> a</span><span class="id"> &amp;</span><span class="id"> f</span><span class="id"> x</span><span class="id"> =</span><span class="id"> f</span> (<span class="id">a</span><span class="id"> +</span><span class="id"> r</span><span class="id"> /</span><span class="id"> 2</span>)<span class="id">%R</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">exists</span> (<span class="id">a</span><span class="id"> +</span><span class="id"> r</span><span class="id"> /</span><span class="id"> 2</span>)<span class="id">%R</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> /ball/=</span><span class="id"> opprD</span><span class="id"> addrA</span><span class="id"> subrr</span><span class="id"> sub0r</span><span class="id"> normrN</span><span class="id"> gtr0_norm</span><span class="id"> ?divr_gt0//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> ltr_pdivrMr//</span><span class="id"> ltr_pMr//</span><span class="id"> ltr1n</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply/eqP;</span><span class="id"> rewrite</span><span class="id"> gt_eqF//</span><span class="id"> ltr_pwDr//</span><span class="id"> divr_gt0</span>.<br/>
<span class="gallina-kwd">by</span><span class="gallina-kwd"> exists</span> (<span class="id">f</span> (<span class="id">a</span><span class="id"> +</span><span class="id"> r</span><span class="id"> /</span><span class="id"> 2</span>))<span class="id"> =&gt;</span><span class="id"> //=;</span><span class="id"> rewrite</span><span class="id"> inf_ballE</span><span class="id"> ereal_inf_lbound</span>.<br/>
<span class="id">Unshelve</span>.<span class="id"> all:</span><span class="gallina-kwd"> by</span><span class="id"> end_near</span>. Qed.</div></details>
<br/>
<span class="vernacular">Local</span><span class="vernacular"> Lemma</span><span class="id"> lim_lime_sup'</span><span class="id"> f</span><span class="id"> a</span><span class="id"> l</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">f</span><span class="id"> r</span><span class="id"> @[r</span><span class="id"> --&gt;</span><span class="id"> a]</span><span class="id"> --&gt;</span><span class="id"> l%:E</span><span class="id"> -&gt;</span><span class="id"> lime_sup</span><span class="id"> f</span><span class="id"> a</span><span class="id"> &lt;=</span><span class="id"> l%:E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> fpA;</span><span class="id"> apply/lee_addgt0Pr</span><span class="id"> =&gt;</span><span class="id"> e</span><span class="id"> e0;</span><span class="id"> rewrite</span><span class="id"> lime_sup_lim</span>.<br/>
<span class="id">apply:</span><span class="id"> lime_le</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
<span class="id">move/fine_cvg</span><span class="id"> :</span> (<span class="id">fpA</span>)<span class="id"> =&gt;</span><span class="id"> /cvgrPdist_le</span><span class="id"> fpA1</span>.<br/>
<span class="id">move/fcvg_is_fine</span><span class="id"> :</span> (<span class="id">fpA</span>)<span class="id">;</span><span class="id"> rewrite</span><span class="id"> near_map</span><span class="id"> =&gt;</span><span class="id"> -[d</span><span class="id"> d0]</span><span class="id"> fpA2</span>.<br/>
<span class="id">have</span><span class="id"> :=</span><span class="id"> fpA1</span><span class="id"> _</span><span class="id"> e0</span><span class="id"> =&gt;</span><span class="id"> -[q</span><span class="id"> /=</span><span class="id"> q0]</span><span class="id"> H</span>.<br/>
<span class="id">near=&gt;</span><span class="id"> x;</span><span class="id"> apply:</span><span class="id"> ub_ereal_sup</span><span class="id"> =&gt;</span><span class="id"> //=</span><span class="id"> _</span><span class="id"> [y</span><span class="id"> [pry</span><span class="id"> /=</span><span class="id"> yp</span><span class="id"> &lt;-]]</span>.<br/>
<span class="id">have</span><span class="id"> ?</span><span class="id"> :</span><span class="id"> f</span><span class="id"> y</span><span class="id"> \is</span><span class="id"> a</span><span class="id"> fin_num</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> fpA2</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> /ball_</span><span class="id"> /=</span> (<span class="id">lt_le_trans</span><span class="id"> pry</span>)<span class="id">//</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> near:</span><span class="id"> x;</span><span class="id"> exact:</span><span class="id"> nbhs_right_le</span>.<br/>
<span class="id">rewrite</span><span class="id"> -lee_subel_addl//</span><span class="id"> -</span>(<span class="id">@fineK</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> y</span>))<span class="id"> //</span><span class="id"> -EFinB</span><span class="id"> lee_fin</span>.<br/>
<span class="id">rewrite</span> (<span class="id">le_trans</span> (<span class="id">ler_norm</span><span class="id"> _</span>))<span class="id">//</span><span class="id"> distrC</span><span class="id"> H//</span><span class="id"> /ball_/=</span><span class="id"> ltr_distlC</span>.<br/>
<span class="id">move:</span><span class="id"> pry;</span><span class="id"> rewrite</span><span class="id"> /ball/=</span><span class="id"> ltr_distlC</span><span class="id"> =&gt;</span><span class="id"> /andP[pay</span><span class="id"> ypa]</span>.<br/>
<span class="id">have</span><span class="id"> xq</span><span class="id"> :</span> (<span class="id">x</span><span class="id"> &lt;=</span><span class="id"> q</span>)<span class="id">%R</span><span class="gallina-kwd"> by</span><span class="id"> near:</span><span class="id"> x;</span><span class="id"> exact:</span><span class="id"> nbhs_right_le</span>.<br/>
<span class="id">apply/andP;</span><span class="id"> split</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span> (<span class="id">le_lt_trans</span><span class="id"> _</span><span class="id"> pay</span>)<span class="id">//</span><span class="id"> lerB</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span> (<span class="id">lt_le_trans</span><span class="id"> ypa</span>)<span class="id">//</span><span class="id"> lerD2l</span>.<br/>
<span class="id">Unshelve</span>.<span class="id"> all:</span><span class="gallina-kwd"> by</span><span class="id"> end_near</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Local</span><span class="vernacular"> Lemma</span><span class="id"> lim_lime_inf'</span><span class="id"> f</span><span class="id"> a</span> (<span class="id">l</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">f</span><span class="id"> r</span><span class="id"> @[r</span><span class="id"> --&gt;</span><span class="id"> a]</span><span class="id"> --&gt;</span><span class="id"> l%:E</span><span class="id"> -&gt;</span><span class="id"> l%:E</span><span class="id"> &lt;=</span><span class="id"> lime_inf</span><span class="id"> f</span><span class="id"> a</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> fpA;</span><span class="id"> apply/lee_subgt0Pr</span><span class="id"> =&gt;</span><span class="id"> e</span><span class="id"> e0;</span><span class="id"> rewrite</span><span class="id"> lime_inf_lim</span>.<br/>
<span class="id">apply:</span><span class="id"> lime_ge</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
<span class="id">move/fine_cvg</span><span class="id"> :</span> (<span class="id">fpA</span>)<span class="id"> =&gt;</span><span class="id"> /cvgrPdist_le</span><span class="id"> fpA1</span>.<br/>
<span class="id">move/fcvg_is_fine</span><span class="id"> :</span> (<span class="id">fpA</span>)<span class="id">;</span><span class="id"> rewrite</span><span class="id"> near_map</span><span class="id"> =&gt;</span><span class="id"> -[d</span><span class="id"> d0]</span><span class="id"> fpA2</span>.<br/>
<span class="id">have</span><span class="id"> :=</span><span class="id"> fpA1</span><span class="id"> _</span><span class="id"> e0</span><span class="id"> =&gt;</span><span class="id"> -[q</span><span class="id"> /=</span><span class="id"> q0]</span><span class="id"> H</span>.<br/>
<span class="id">near=&gt;</span><span class="id"> x</span>.<br/>
<span class="id">rewrite</span><span class="id"> inf_ballE</span>.<br/>
<span class="id">apply:</span><span class="id"> lb_ereal_inf</span><span class="id"> =&gt;</span><span class="id"> //=</span><span class="id"> _</span><span class="id"> [y</span><span class="id"> [pry</span><span class="id"> /=</span><span class="id"> yp</span><span class="id"> &lt;-]]</span>.<br/>
<span class="id">have</span><span class="id"> ?</span><span class="id"> :</span><span class="id"> f</span><span class="id"> y</span><span class="id"> \is</span><span class="id"> a</span><span class="id"> fin_num</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> fpA2</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> /ball_</span><span class="id"> /=</span> (<span class="id">lt_le_trans</span><span class="id"> pry</span>)<span class="id">//</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> near:</span><span class="id"> x;</span><span class="id"> exact:</span><span class="id"> nbhs_right_le</span>.<br/>
<span class="id">rewrite</span><span class="id"> -</span>(<span class="id">@fineK</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> y</span>))<span class="id"> //</span><span class="id"> -EFinB</span><span class="id"> lee_fin</span><span class="id"> lerBlDr</span><span class="id"> -lerBlDl</span>.<br/>
<span class="id">rewrite</span> (<span class="id">le_trans</span> (<span class="id">ler_norm</span><span class="id"> _</span>))<span class="id">//</span><span class="id"> H//</span><span class="id"> /ball_/=</span><span class="id"> ltr_distlC</span>.<br/>
<span class="id">move:</span><span class="id"> pry;</span><span class="id"> rewrite</span><span class="id"> /ball/=</span><span class="id"> ltr_distlC</span><span class="id"> =&gt;</span><span class="id"> /andP[pay</span><span class="id"> ypa]</span>.<br/>
<span class="id">have</span><span class="id"> xq</span><span class="id"> :</span> (<span class="id">x</span><span class="id"> &lt;=</span><span class="id"> q</span>)<span class="id">%R</span><span class="gallina-kwd"> by</span><span class="id"> near:</span><span class="id"> x;</span><span class="id"> exact:</span><span class="id"> nbhs_right_le</span>.<br/>
<span class="id">apply/andP;</span><span class="id"> split</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span> (<span class="id">le_lt_trans</span><span class="id"> _</span><span class="id"> pay</span>)<span class="id">//</span><span class="id"> lerB</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span> (<span class="id">lt_le_trans</span><span class="id"> ypa</span>)<span class="id">//</span><span class="id"> lerD2l</span>.<br/>
<span class="id">Unshelve</span>.<span class="id"> all:</span><span class="gallina-kwd"> by</span><span class="id"> end_near</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> lim_lime_inf</span><span class="id"> f</span><span class="id"> a</span> (<span class="id">l</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">f</span><span class="id"> r</span><span class="id"> @[r</span><span class="id"> --&gt;</span><span class="id"> a]</span><span class="id"> --&gt;</span><span class="id"> l%:E</span><span class="id"> -&gt;</span><span class="id"> lime_inf</span><span class="id"> f</span><span class="id"> a</span><span class="id"> =</span><span class="id"> l%:E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> h;</span><span class="id"> apply/eqP;</span><span class="id"> rewrite</span><span class="id"> eq_le</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> lim_lime_inf'//</span><span class="id"> andbT</span> (<span class="id">le_trans</span> (<span class="id">lime_inf_sup</span><span class="id"> _</span><span class="id"> _</span>))<span class="id">//</span><span class="id"> lim_lime_sup'</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> lim_lime_sup</span><span class="id"> f</span><span class="id"> a</span> (<span class="id">l</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">f</span><span class="id"> r</span><span class="id"> @[r</span><span class="id"> --&gt;</span><span class="id"> a]</span><span class="id"> --&gt;</span><span class="id"> l%:E</span><span class="id"> -&gt;</span><span class="id"> lime_sup</span><span class="id"> f</span><span class="id"> a</span><span class="id"> =</span><span class="id"> l%:E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> h;</span><span class="id"> apply/eqP;</span><span class="id"> rewrite</span><span class="id"> eq_le</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> lim_lime_sup'//=</span> (<span class="id">le_trans</span><span class="id"> _</span> (<span class="id">lime_inf_sup</span><span class="id"> _</span><span class="id"> _</span>))<span class="id">//</span><span class="id"> lim_lime_inf'</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Local</span><span class="vernacular"> Lemma</span><span class="id"> lime_supP</span><span class="id"> f</span><span class="id"> a</span><span class="id"> l</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">lime_sup</span><span class="id"> f</span><span class="id"> a</span><span class="id"> =</span><span class="id"> l%:E</span><span class="id"> -&gt;</span><span class="gallina-kwd"> forall</span><span class="id"> e</span><span class="id"> :</span><span class="id"> {posnum</span><span class="id"> R},</span><span class="gallina-kwd"> exists</span><span class="id"> d</span><span class="id"> :</span><span class="id"> {posnum</span><span class="id"> R},</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">forall</span><span class="id"> x,</span> (<span class="id">ball</span><span class="id"> a</span><span class="id"> d%:num</span><span class="id"> `\</span><span class="id"> a</span>)<span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> f</span><span class="id"> x</span><span class="id"> &lt;</span><span class="id"> l%:E</span><span class="id"> +</span><span class="id"> e%:num%:E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> lime_supE</span><span class="id"> =&gt;</span><span class="id"> fal</span>.<br/>
<span class="id">have</span><span class="id"> H</span> (<span class="id">e</span><span class="id"> :</span><span class="id"> {posnum</span><span class="id"> R}</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">exists</span><span class="id"> d</span><span class="id"> :</span><span class="id"> {posnum</span><span class="id"> R},</span><span class="id"> l%:E</span><span class="id"> &lt;=</span><span class="id"> sup_ball</span><span class="id"> f</span><span class="id"> a</span><span class="id"> d%:num</span><span class="id"> &lt;</span><span class="id"> l%:E</span><span class="id"> +</span><span class="id"> e%:num%:E</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> contrapT</span><span class="id"> =&gt;</span><span class="id"> /forallNP</span><span class="id"> H</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> :</span><span class="id"> ereal_inf</span><span class="id"> [set</span><span class="id"> sup_ball</span><span class="id"> f</span><span class="id"> a</span><span class="id"> r</span><span class="id"> |</span><span class="id"> r</span><span class="gallina-kwd"> in</span><span class="id"> `]0%R,</span><span class="id"> +oo[]</span><span class="id"> \is</span><span class="id"> a</span><span class="id"> fin_num</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> fal</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> /lb_ereal_inf_adherent-/</span>(_<span class="id"> e%:num</span><span class="id"> ltac:</span>(<span class="gallina-kwd">by</span><span class="id"> []</span>))<span class="id">[y]</span><span class="id"> /=</span>.<br/>
&nbsp;&nbsp;<span class="id">case=&gt;</span><span class="id"> r;</span><span class="id"> rewrite</span><span class="id"> in_itv/=</span><span class="id"> andbT</span><span class="id"> =&gt;</span><span class="id"> r0</span><span class="id"> &lt;-{y}</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> ltNge</span><span class="id"> =&gt;</span><span class="id"> /negP;</span><span class="id"> apply</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> /negP</span><span class="id"> :=</span><span class="id"> H</span> (<span class="id">PosNum</span><span class="id"> r0</span>).<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> negb_and</span><span class="id"> =&gt;</span><span class="id"> /orP[|]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -ltNge</span><span class="id"> =&gt;</span><span class="id"> farl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">have</span><span class="id"> :</span><span class="id"> ereal_inf</span><span class="id"> [set</span><span class="id"> sup_ball</span><span class="id"> f</span><span class="id"> a</span><span class="id"> r</span><span class="id"> |</span><span class="id"> r</span><span class="gallina-kwd"> in</span><span class="id"> `]0%R,</span><span class="id"> +oo[]</span><span class="id"> &lt;</span><span class="id"> l%:E</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> (<span class="id">le_lt_trans</span><span class="id"> _</span><span class="id"> farl</span>)<span class="id">//;</span><span class="id"> apply:</span><span class="id"> ereal_inf_lbound</span><span class="id"> =&gt;</span><span class="id"> /=;</span><span class="gallina-kwd"> exists</span><span class="id"> r</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> in_itv/=</span><span class="id"> r0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> fal</span><span class="id"> ltxx</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -leNgt;</span><span class="id"> apply:</span><span class="id"> le_trans;</span><span class="id"> rewrite</span><span class="id"> leeD2r//</span><span class="id"> fal</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> e;</span><span class="id"> have</span><span class="id"> [d</span><span class="id"> /andP[lfp</span><span class="id"> fpe]]</span><span class="id"> :=</span><span class="id"> H</span><span class="id"> e</span>.<br/>
<span class="gallina-kwd">exists</span><span class="id"> d</span><span class="id"> =&gt;</span><span class="id"> r</span><span class="id"> /=</span><span class="id"> []</span><span class="id"> prd</span><span class="id"> rp</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span> (<span class="id">le_lt_trans</span><span class="id"> _</span><span class="id"> fpe</span>)<span class="id">//;</span><span class="id"> apply:</span><span class="id"> ereal_sup_ubound</span><span class="id"> =&gt;</span><span class="id"> /=;</span><span class="gallina-kwd"> exists</span><span class="id"> r</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Local</span><span class="vernacular"> Lemma</span><span class="id"> lime_infP</span><span class="id"> f</span><span class="id"> a</span><span class="id"> l</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">lime_inf</span><span class="id"> f</span><span class="id"> a</span><span class="id"> =</span><span class="id"> l%:E</span><span class="id"> -&gt;</span><span class="gallina-kwd"> forall</span><span class="id"> e</span><span class="id"> :</span><span class="id"> {posnum</span><span class="id"> R},</span><span class="gallina-kwd"> exists</span><span class="id"> d</span><span class="id"> :</span><span class="id"> {posnum</span><span class="id"> R},</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">forall</span><span class="id"> x,</span> (<span class="id">ball</span><span class="id"> a</span><span class="id"> d%:num</span><span class="id"> `\</span><span class="id"> a</span>)<span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> l%:E</span><span class="id"> -</span><span class="id"> e%:num%:E</span><span class="id"> &lt;</span><span class="id"> f</span><span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> /</span>(<span class="id">congr1</span><span class="id"> oppe</span>)<span class="id">;</span><span class="id"> rewrite</span><span class="id"> -lime_supN</span><span class="id"> =&gt;</span><span class="id"> /lime_supP</span><span class="id"> =&gt;</span><span class="id"> H</span><span class="id"> e</span>.<br/>
<span class="id">have</span><span class="id"> [d</span><span class="id"> {}H]</span><span class="id"> :=</span><span class="id"> H</span><span class="id"> e</span>.<br/>
<span class="gallina-kwd">by</span><span class="gallina-kwd"> exists</span><span class="id"> d</span><span class="id"> =&gt;</span><span class="id"> r</span><span class="id"> /H;</span><span class="id"> rewrite</span><span class="id"> lteNl</span><span class="id"> oppeD//</span><span class="id"> EFinN</span><span class="id"> oppeK</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> lime_sup_inf_at_right</span><span class="id"> f</span><span class="id"> a</span><span class="id"> l</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">lime_sup</span><span class="id"> f</span><span class="id"> a</span><span class="id"> =</span><span class="id"> l%:E</span><span class="id"> -&gt;</span><span class="id"> lime_inf</span><span class="id"> f</span><span class="id"> a</span><span class="id"> =</span><span class="id"> l%:E</span><span class="id"> -&gt;</span><span class="id"> f</span><span class="id"> x</span><span class="id"> @[x</span><span class="id"> --&gt;</span><span class="id"> a^'+]</span><span class="id"> --&gt;</span><span class="id"> l%:E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> supfpl</span><span class="id"> inffpl;</span><span class="id"> apply/cvge_at_rightP</span><span class="id"> =&gt;</span><span class="id"> u</span><span class="id"> [pu</span><span class="id"> up]</span>.<br/>
<span class="id">have</span><span class="id"> fu</span><span class="id"> :</span><span class="id"> \forall</span><span class="id"> n</span><span class="id"> \near</span><span class="id"> \oo,</span><span class="id"> f</span> (<span class="id">u</span><span class="id"> n</span>)<span class="id"> \is</span><span class="id"> a</span><span class="id"> fin_num</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> [dsup</span><span class="id"> Hdsup]</span><span class="id"> :=</span><span class="id"> lime_supP</span><span class="id"> supfpl</span> (<span class="id">PosNum</span><span class="id"> ltr01</span>).<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> [dinf</span><span class="id"> Hdinf]</span><span class="id"> :=</span><span class="id"> lime_infP</span><span class="id"> inffpl</span> (<span class="id">PosNum</span><span class="id"> ltr01</span>).<br/>
&nbsp;&nbsp;<span class="id">near=&gt;</span><span class="id"> n;</span><span class="id"> rewrite</span><span class="id"> fin_numE;</span><span class="id"> apply/andP;</span><span class="id"> split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply/eqP</span><span class="id"> =&gt;</span><span class="id"> fxnoo</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">suff</span><span class="id"> :</span> (<span class="id">ball</span><span class="id"> a</span><span class="id"> dinf%:num</span><span class="id"> `\</span><span class="id"> a</span>) (<span class="id">u</span><span class="id"> n</span>)<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> /Hdinf;</span><span class="id"> rewrite</span><span class="id"> fxnoo</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> apply/eqP;</span><span class="id"> rewrite</span><span class="id"> gt_eqF</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> near:</span><span class="id"> n;</span><span class="id"> move/cvgrPdist_lt</span><span class="id"> :</span><span class="id"> up;</span><span class="id"> exact</span>.<br/>
&nbsp;&nbsp;<span class="id">apply/eqP</span><span class="id"> =&gt;</span><span class="id"> fxnoo</span>.<br/>
&nbsp;&nbsp;<span class="id">suff</span><span class="id"> :</span> (<span class="id">ball</span><span class="id"> a</span><span class="id"> dsup%:num</span><span class="id"> `\</span><span class="id"> a</span>) (<span class="id">u</span><span class="id"> n</span>)<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> /Hdsup;</span><span class="id"> rewrite</span><span class="id"> fxnoo</span>.<br/>
&nbsp;&nbsp;<span class="id">split;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> apply/eqP;</span><span class="id"> rewrite</span><span class="id"> gt_eqF</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> near:</span><span class="id"> n;</span><span class="id"> move/cvgrPdist_lt</span><span class="id"> :</span><span class="id"> up;</span><span class="id"> exact</span>.<br/>
<span class="id">apply/fine_cvgP;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> /=;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> fu</span>.<br/>
<span class="id">apply/cvgrPdist_le</span><span class="id"> =&gt;</span><span class="id"> _/posnumP[e]</span>.<br/>
<span class="id">have</span><span class="id"> [d1</span><span class="id"> Hd1]</span><span class="id"> :</span><span class="gallina-kwd"> exists</span><span class="id"> d1</span><span class="id"> :</span><span class="id"> {posnum</span><span class="id"> R},</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">l%:E</span><span class="id"> -</span><span class="id"> e%:num%:E</span><span class="id"> &lt;=</span><span class="id"> ereal_inf</span><span class="id"> [set</span><span class="id"> f</span><span class="id"> x</span><span class="id"> |</span><span class="id"> x</span><span class="gallina-kwd"> in</span><span class="id"> ball</span><span class="id"> a</span><span class="id"> d1%:num</span><span class="id"> `\</span><span class="id"> a]</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> :</span><span class="id"> l%:E</span><span class="id"> -</span><span class="id"> e%:num%:E</span><span class="id"> &lt;</span><span class="id"> lime_inf</span><span class="id"> f</span><span class="id"> a</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> inffpl</span><span class="id"> lteBlDr//</span><span class="id"> lteDl</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> lime_infE</span><span class="id"> =&gt;</span><span class="id"> /ereal_sup_gt[x</span><span class="id"> /=</span><span class="id"> [r]];</span><span class="id"> rewrite</span><span class="id"> in_itv/=</span><span class="id"> andbT</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> r0</span><span class="id"> &lt;-{x}</span><span class="id"> H;</span><span class="gallina-kwd"> exists</span> (<span class="id">PosNum</span><span class="id"> r0</span>)<span class="id">;</span><span class="id"> rewrite</span><span class="id"> ltW//</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -inf_ballE</span>.<br/>
<span class="id">have</span><span class="id"> [d2</span><span class="id"> Hd2]</span><span class="id"> :</span><span class="gallina-kwd"> exists</span><span class="id"> d2</span><span class="id"> :</span><span class="id"> {posnum</span><span class="id"> R},</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ereal_sup</span><span class="id"> [set</span><span class="id"> f</span><span class="id"> x</span><span class="id"> |</span><span class="id"> x</span><span class="gallina-kwd"> in</span><span class="id"> ball</span><span class="id"> a</span><span class="id"> d2%:num</span><span class="id"> `\</span><span class="id"> a]</span><span class="id"> &lt;=</span><span class="id"> l%:E</span><span class="id"> +</span><span class="id"> e%:num%:E</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> :</span><span class="id"> lime_sup</span><span class="id"> f</span><span class="id"> a</span><span class="id"> &lt;</span><span class="id"> l%:E</span><span class="id"> +</span><span class="id"> e%:num%:E</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> supfpl</span><span class="id"> lteDl</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> lime_supE</span><span class="id"> =&gt;</span><span class="id"> /ereal_inf_lt[x</span><span class="id"> /=</span><span class="id"> [r]];</span><span class="id"> rewrite</span><span class="id"> in_itv/=</span><span class="id"> andbT</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> r0</span><span class="id"> &lt;-{x}</span><span class="id"> H;</span><span class="gallina-kwd"> exists</span> (<span class="id">PosNum</span><span class="id"> r0</span>)<span class="id">;</span><span class="id"> rewrite</span><span class="id"> ltW</span>.<br/>
<span class="id">pose</span><span class="id"> d</span><span class="id"> :=</span><span class="id"> minr</span><span class="id"> d1%:num</span><span class="id"> d2%:num</span>.<br/>
<span class="id">have</span><span class="id"> d0</span><span class="id"> :</span> (<span class="id">0</span><span class="id"> &lt;</span><span class="id"> d</span>)<span class="id">%R</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> lt_min;</span><span class="id"> apply/andP;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //=</span>.<br/>
<span class="id">move/cvgrPdist_lt</span><span class="id"> :</span><span class="id"> up</span><span class="id"> =&gt;</span><span class="id"> /</span>(_<span class="id"> _</span><span class="id"> d0</span>)<span class="id">[m</span><span class="id"> _]</span><span class="id"> {}ucvg</span>.<br/>
<span class="id">near=&gt;</span><span class="id"> n</span>.<br/>
<span class="id">rewrite</span><span class="id"> /=</span><span class="id"> ler_distlC;</span><span class="id"> apply/andP;</span><span class="id"> split</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -lee_fin</span><span class="id"> EFinB</span> (<span class="id">le_trans</span><span class="id"> Hd1</span>)<span class="id">//</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> (<span class="id">@le_trans</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">ereal_inf</span><span class="id"> [set</span><span class="id"> f</span><span class="id"> x</span><span class="id"> |</span><span class="id"> x</span><span class="gallina-kwd"> in</span><span class="id"> ball</span><span class="id"> a</span><span class="id"> d</span><span class="id"> `\</span><span class="id"> a]</span>))<span class="id">//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> le_ereal_inf</span><span class="id"> =&gt;</span><span class="id"> _/=</span><span class="id"> [r</span><span class="id"> [adr</span><span class="id"> ra]</span><span class="id"> &lt;-];</span><span class="gallina-kwd"> exists</span><span class="id"> r</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /ball/=</span> (<span class="id">lt_le_trans</span><span class="id"> adr</span>)<span class="id">//</span><span class="id"> /d</span><span class="id"> ge_min</span><span class="id"> lexx</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> ereal_inf_lbound</span><span class="id"> =&gt;</span><span class="id"> /=;</span><span class="gallina-kwd"> exists</span> (<span class="id">u</span><span class="id"> n</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> apply/eqP;</span><span class="id"> rewrite</span><span class="id"> eq_sym</span><span class="id"> lt_eqF</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> ucvg</span><span class="id"> =&gt;</span><span class="id"> //=;</span><span class="id"> near:</span><span class="id"> n;</span><span class="gallina-kwd"> exists</span><span class="id"> m</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> fineK//;</span><span class="gallina-kwd"> by</span><span class="id"> near:</span><span class="id"> n</span>.<br/>
<span class="id">rewrite</span><span class="id"> -lee_fin</span><span class="id"> EFinD</span> (<span class="id">le_trans</span><span class="id"> _</span><span class="id"> Hd2</span>)<span class="id">//</span>.<br/>
<span class="id">rewrite</span> (<span class="id">@le_trans</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">ereal_sup</span><span class="id"> [set</span><span class="id"> f</span><span class="id"> x</span><span class="id"> |</span><span class="id"> x</span><span class="gallina-kwd"> in</span><span class="id"> ball</span><span class="id"> a</span><span class="id"> d</span><span class="id"> `\</span><span class="id"> a]</span>))<span class="id">//;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> le_ereal_sup</span><span class="id"> =&gt;</span><span class="id"> z/=</span><span class="id"> [r</span><span class="id"> [adr</span><span class="id"> rp]</span><span class="id"> &lt;-{z}];</span><span class="gallina-kwd"> exists</span><span class="id"> r</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /ball/=</span> (<span class="id">lt_le_trans</span><span class="id"> adr</span>)<span class="id">//</span><span class="id"> /d</span><span class="id"> ge_min</span><span class="id"> lexx</span><span class="id"> orbT</span>.<br/>
<span class="id">apply:</span><span class="id"> ereal_sup_ubound</span><span class="id"> =&gt;</span><span class="id"> /=;</span><span class="gallina-kwd"> exists</span> (<span class="id">u</span><span class="id"> n</span>).<br/>
&nbsp;&nbsp;<span class="id">split;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> apply/eqP;</span><span class="id"> rewrite</span><span class="id"> eq_sym</span><span class="id"> lt_eqF</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> ucvg</span><span class="id"> =&gt;</span><span class="id"> //=;</span><span class="id"> near:</span><span class="id"> n;</span><span class="gallina-kwd"> exists</span><span class="id"> m</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> fineK//;</span><span class="id"> near:</span><span class="id"> n</span>.<br/>
<span class="id">Unshelve</span>.<span class="id"> all:</span><span class="gallina-kwd"> by</span><span class="id"> end_near</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> lime_sup_inf_at_left</span><span class="id"> f</span><span class="id"> a</span><span class="id"> l</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">lime_sup</span><span class="id"> f</span><span class="id"> a</span><span class="id"> =</span><span class="id"> l%:E</span><span class="id"> -&gt;</span><span class="id"> lime_inf</span><span class="id"> f</span><span class="id"> a</span><span class="id"> =</span><span class="id"> l%:E</span><span class="id"> -&gt;</span><span class="id"> f</span><span class="id"> x</span><span class="id"> @[x</span><span class="id"> --&gt;</span><span class="id"> a^'-]</span><span class="id"> --&gt;</span><span class="id"> l%:E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> supfal</span><span class="id"> inffal;</span><span class="id"> apply/cvg_at_leftNP/lime_sup_inf_at_right</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> /lime_sup</span><span class="id"> -limf_esup_dnbhsN</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> /lime_inf</span><span class="id"> /lime_sup</span><span class="id"> -</span>(<span class="id">limf_esup_dnbhsN</span> (<span class="id">-%E</span><span class="id"> \o</span><span class="id"> f</span>))<span class="id"> limf_esupN</span><span class="id"> oppeK</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> lime_sup_inf</span>.<br/>
<span class="id">#[deprecated</span>(<span class="id">since=</span><span class="id">&quot;mathcomp-analysis 1.3.0&quot;</span><span class="id">,</span><span class="id"> note=</span><span class="id">&quot;use `limf_esup_ge0` instead&quot;</span>)<span class="id">]</span><br/>
<span class="vernacular">Notation</span><span class="id"> lime_sup_ge0</span><span class="id"> :=</span><span class="id"> __deprecated__lime_sup_ge0</span> (<span class="id">only</span><span class="id"> parsing</span>).<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> derivable_oo_continuous_bnd</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {R</span><span class="id"> :</span><span class="id"> numFieldType}</span><span class="id"> {V</span><span class="id"> :</span><span class="id"> normedModType</span><span class="id"> R}</span>.<br/>
<br/>
<span class="vernacular">Definition</span><span class="id"> derivable_oo_continuous_bnd</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> V</span>) (<span class="id">x</span><span class="id"> y</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">[/\</span><span class="id"> {in</span><span class="id"> `]x,</span><span class="id"> y[,</span><span class="gallina-kwd"> forall</span><span class="id"> x,</span><span class="id"> derivable</span><span class="id"> f</span><span class="id"> x</span><span class="id"> 1},</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">f</span><span class="id"> @</span><span class="id"> x^'+</span><span class="id"> --&gt;</span><span class="id"> f</span><span class="id"> x</span><span class="id"> &amp;</span><span class="id"> f</span><span class="id"> @</span><span class="id"> y^'-</span><span class="id"> --&gt;</span><span class="id"> f</span><span class="id"> y]</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> derivable_oo_continuous_bnd_within</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> V</span>) (<span class="id">x</span><span class="id"> y</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">derivable_oo_continuous_bnd</span><span class="id"> f</span><span class="id"> x</span><span class="id"> y</span><span class="id"> -&gt;</span><span class="id"> {within</span><span class="id"> `[x,</span><span class="id"> y],</span><span class="id"> continuous</span><span class="id"> f}</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> [fxy</span><span class="id"> fxr</span><span class="id"> fyl];</span><span class="id"> apply/subspace_continuousP</span><span class="id"> =&gt;</span><span class="id"> z</span><span class="id"> /=</span>.<br/>
<span class="id">rewrite</span><span class="id"> in_itv/=</span><span class="id"> =&gt;</span><span class="id"> /andP[];</span><span class="id"> rewrite</span><span class="id"> le_eqVlt</span><span class="id"> =&gt;</span><span class="id"> /predU1P[&lt;-{z}</span><span class="id"> xy|]</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> :=</span><span class="id"> cvg_at_right_within</span><span class="id"> fxr;</span><span class="id"> apply:</span><span class="id"> cvg_trans;</span><span class="id"> apply:</span><span class="id"> cvg_app</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> within_subset</span><span class="id"> =&gt;</span><span class="id"> z/=;</span><span class="id"> rewrite</span><span class="id"> in_itv/=</span><span class="id"> =&gt;</span><span class="id"> /andP[]</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> /[swap]</span>.<br/>
<span class="id">rewrite</span><span class="id"> le_eqVlt</span><span class="id"> =&gt;</span><span class="id"> /predU1P[-&gt;{z}</span><span class="id"> xy|zy</span><span class="id"> xz]</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> :=</span><span class="id"> cvg_at_left_within</span><span class="id"> fyl;</span><span class="id"> apply:</span><span class="id"> cvg_trans;</span><span class="id"> apply:</span><span class="id"> cvg_app</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> within_subset</span><span class="id"> =&gt;</span><span class="id"> z/=;</span><span class="id"> rewrite</span><span class="id"> in_itv/=</span><span class="id"> =&gt;</span><span class="id"> /andP[]</span>.<br/>
<span class="id">apply:</span><span class="id"> cvg_within_filter</span>.<br/>
<span class="id">apply/differentiable_continuous;</span><span class="id"> rewrite</span><span class="id"> -derivable1_diffP</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> fxy;</span><span class="id"> rewrite</span><span class="id"> in_itv/=</span><span class="id"> xz</span><span class="id"> zy</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> derivable_oo_continuous_bnd</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> real_inverse_functions</span>.<br/>
<span class="vernacular">Variable</span><span class="id"> R</span><span class="id"> :</span><span class="id"> realType</span>.<br/>
<span class="vernacular">Implicit</span><span class="id"> Types</span> (<span class="id">a</span><span class="id"> b</span><span class="id"> :</span><span class="id"> R</span>) (<span class="id">f</span><span class="id"> g</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> R</span>).<br/>
<br/>
<div class="doc">This lemma should be used with caution. Generally `{within I, continuous f}`
   is what one would intend. So having `{in I, continuous f}` as a condition
   may indicate potential issues at the endpoints of the interval. </div>
<span class="vernacular">Lemma</span><span class="id"> continuous_subspace_itv</span> (<span class="id">I</span><span class="id"> :</span><span class="id"> interval</span><span class="id"> R</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">{in</span><span class="id"> I,</span><span class="id"> continuous</span><span class="id"> f}</span><span class="id"> -&gt;</span><span class="id"> {within</span><span class="id"> [set`</span><span class="id"> I],</span><span class="id"> continuous</span><span class="id"> f}</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> ctsf;</span><span class="id"> apply:</span><span class="id"> continuous_in_subspaceT</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> Ix;</span><span class="id"> apply:</span><span class="id"> ctsf</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> move:</span><span class="id"> Ix;</span><span class="id"> rewrite</span><span class="id"> inE</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> itv_continuous_inj_le</span><span class="id"> f</span> (<span class="id">I</span><span class="id"> :</span><span class="id"> interval</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">exists</span><span class="id"> x</span><span class="id"> y,</span><span class="id"> [/\</span><span class="id"> x</span><span class="id"> \in</span><span class="id"> I,</span><span class="id"> y</span><span class="id"> \in</span><span class="id"> I,</span><span class="id"> x</span><span class="id"> &lt;</span><span class="id"> y</span><span class="id"> &amp;</span><span class="id"> f</span><span class="id"> x</span><span class="id"> &lt;=</span><span class="id"> f</span><span class="id"> y]</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">{within</span><span class="id"> [set`</span><span class="id"> I],</span><span class="id"> continuous</span><span class="id"> f}</span><span class="id"> -&gt;</span><span class="id"> {in</span><span class="id"> I</span><span class="id"> &amp;,</span><span class="id"> injective</span><span class="id"> f}</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">{in</span><span class="id"> I</span><span class="id"> &amp;,</span><span class="id"> {mono</span><span class="id"> f</span><span class="id"> :</span><span class="id"> x</span><span class="id"> y</span><span class="id"> /</span><span class="id"> x</span><span class="id"> &lt;=</span><span class="id"> y}}</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">gen</span><span class="id"> have</span><span class="id"> fxy</span><span class="id"> :</span><span class="id"> f</span><span class="id"> /</span><span class="id"> {in</span><span class="id"> I</span><span class="id"> &amp;,</span><span class="id"> injective</span><span class="id"> f}</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">{in</span><span class="id"> I</span><span class="id"> &amp;,</span><span class="gallina-kwd"> forall</span><span class="id"> x</span><span class="id"> y,</span><span class="id"> x</span><span class="id"> &lt;</span><span class="id"> y</span><span class="id"> -&gt;</span><span class="id"> f</span><span class="id"> x</span><span class="id"> !=</span><span class="id"> f</span><span class="id"> y}</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> fI</span><span class="id"> x</span><span class="id"> y</span><span class="id"> xI</span><span class="id"> yI</span><span class="id"> xLy;</span><span class="id"> apply/negP</span><span class="id"> =&gt;</span><span class="id"> /eqP</span><span class="id"> /fI</span><span class="id"> =&gt;</span><span class="id"> /</span>(_<span class="id"> xI</span><span class="id"> yI</span>)<span class="id"> xy</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move:</span><span class="id"> xLy;</span><span class="id"> rewrite</span><span class="id"> xy</span><span class="id"> ltxx</span>.<br/>
<span class="id">gen</span><span class="id"> have</span><span class="id"> main</span><span class="id"> :</span><span class="id"> f</span><span class="id"> /</span><span class="gallina-kwd"> forall</span><span class="id"> c,</span><span class="id"> {within</span><span class="id"> [set`</span><span class="id"> I],</span><span class="id"> continuous</span><span class="id"> f}</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">{in</span><span class="id"> I</span><span class="id"> &amp;,</span><span class="id"> injective</span><span class="id"> f}</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">{in</span><span class="id"> I</span><span class="id"> &amp;,</span><span class="gallina-kwd"> forall</span><span class="id"> a</span><span class="id"> b,</span><span class="id"> f</span><span class="id"> a</span><span class="id"> &lt;</span><span class="id"> f</span><span class="id"> b</span><span class="id"> -&gt;</span><span class="id"> a</span><span class="id"> &lt;</span><span class="id"> c</span><span class="id"> -&gt;</span><span class="id"> c</span><span class="id"> &lt;</span><span class="id"> b</span><span class="id"> -&gt;</span><span class="id"> f</span><span class="id"> a</span><span class="id"> &lt;</span><span class="id"> f</span><span class="id"> c</span><span class="id"> /\</span><span class="id"> f</span><span class="id"> c</span><span class="id"> &lt;</span><span class="id"> f</span><span class="id"> b}</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> c</span><span class="id"> fC</span><span class="id"> fI</span><span class="id"> a</span><span class="id"> b</span><span class="id"> aI</span><span class="id"> bI</span><span class="id"> faLfb</span><span class="id"> aLc</span><span class="id"> cLb</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> intP</span><span class="id"> :=</span><span class="id"> interval_is_interval</span><span class="id"> aI</span><span class="id"> bI</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> cI</span><span class="id"> :</span><span class="id"> c</span><span class="id"> \in</span><span class="id"> I</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> intP//</span> (<span class="id">ltW</span><span class="id"> aLc</span>)<span class="id"> ltW</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> ctsACf</span><span class="id"> :</span><span class="id"> {within</span><span class="id"> `[a,</span><span class="id"> c],</span><span class="id"> continuous</span><span class="id"> f}</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span> (<span class="id">continuous_subspaceW</span><span class="id"> _</span><span class="id"> fC</span>)<span class="id"> =&gt;</span><span class="id"> x;</span><span class="id"> rewrite</span><span class="id"> /=</span><span class="id"> inE</span><span class="id"> =&gt;</span><span class="id"> /itvP</span><span class="id"> axc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> intP//</span><span class="id"> axc/=</span> (<span class="id">le_trans</span><span class="id"> _</span> (<span class="id">ltW</span><span class="id"> cLb</span>))<span class="id">//</span><span class="id"> axc</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> ctsCBf</span><span class="id"> :</span><span class="id"> {within</span><span class="id"> `[c,</span><span class="id"> b],</span><span class="id"> continuous</span><span class="id"> f}</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span> (<span class="id">continuous_subspaceW</span><span class="id"> _</span><span class="id"> fC</span>)<span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> inE</span><span class="id"> =&gt;</span><span class="id"> /itvP</span><span class="id"> axc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> intP//</span><span class="id"> axc</span><span class="id"> andbT</span> (<span class="id">le_trans</span> (<span class="id">ltW</span><span class="id"> aLc</span>))<span class="id"> ?axc</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> [aLb</span><span class="id"> alb']</span><span class="id"> :</span><span class="id"> a</span><span class="id"> &lt;</span><span class="id"> b</span><span class="id"> /\</span><span class="id"> a</span><span class="id"> &lt;=</span><span class="id"> b</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> ltW</span> (<span class="id">lt_trans</span><span class="id"> aLc</span>).<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> [faLfc|fcLfa|/eqP</span><span class="id"> faEfc]</span><span class="id"> /=</span><span class="id"> :=</span><span class="id"> ltrgtP</span> (<span class="id">f</span><span class="id"> a</span>) (<span class="id">f</span><span class="id"> c</span>).<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> split;</span><span class="id"> rewrite</span><span class="id"> //</span><span class="id"> lt_neqAle</span><span class="id"> fxy</span><span class="id"> //</span><span class="id"> leNgt;</span><span class="id"> apply/negP</span><span class="id"> =&gt;</span><span class="id"> fbLfc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">have</span><span class="id"> :=</span><span class="id"> fbLfc;</span><span class="id"> suff</span><span class="id"> /eqP</span><span class="id"> -&gt;</span><span class="id"> :</span><span class="id"> c</span><span class="id"> ==</span><span class="id"> b</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> ltxx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> eq_le</span> (<span class="id">ltW</span><span class="id"> cLb</span>)<span class="id"> /=</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">have</span><span class="id"> [d</span><span class="id"> /andP[ad</span><span class="id"> dc]</span><span class="id"> fdEfb]</span><span class="id"> :</span><span class="gallina-kwd"> exists2</span><span class="id"> d,</span><span class="id"> a</span><span class="id"> &lt;=</span><span class="id"> d</span><span class="id"> &lt;=</span><span class="id"> c</span><span class="id"> &amp;</span><span class="id"> f</span><span class="id"> d</span><span class="id"> =</span><span class="id"> f</span><span class="id"> b</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">have</span><span class="id"> aLc'</span><span class="id"> :</span><span class="id"> a</span><span class="id"> &lt;=</span><span class="id"> c</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> ltW</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> IVT</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> case:</span><span class="id"> ltrgtP</span><span class="id"> faLfc;</span><span class="id"> rewrite</span><span class="id"> //</span> (<span class="id">ltW</span><span class="id"> faLfb</span>)<span class="id"> //</span><span class="id"> ltW</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -</span>(<span class="id">fI</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> fdEfb</span>)<span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">move:</span><span class="id"> ad</span><span class="id"> dc;</span><span class="id"> rewrite</span><span class="id"> le_eqVlt</span><span class="id"> =&gt;/predU1P[&lt;-//|</span><span class="id"> /ltW</span><span class="id"> L]</span><span class="id"> dc</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> intP//</span><span class="id"> L</span> (<span class="id">le_trans</span><span class="id"> _</span> (<span class="id">ltW</span><span class="id"> cLb</span>)).<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> have</span><span class="id"> [fbLfc</span><span class="id"> |</span><span class="id"> fcLfb</span><span class="id"> |</span><span class="id"> fbEfc]</span><span class="id"> /=</span><span class="id"> :=</span><span class="id"> ltrgtP</span> (<span class="id">f</span><span class="id"> b</span>) (<span class="id">f</span><span class="id"> c</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> have</span><span class="id"> :=</span><span class="id"> lt_trans</span><span class="id"> fbLfc</span><span class="id"> fcLfa;</span><span class="id"> rewrite</span><span class="id"> ltNge</span> (<span class="id">ltW</span><span class="id"> faLfb</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">+</span><span class="id"> have</span><span class="id"> [d</span><span class="id"> /andP[cLd</span><span class="id"> dLb]</span><span class="id"> /eqP]</span><span class="id"> :</span><span class="gallina-kwd"> exists2</span><span class="id"> d,</span><span class="id"> c</span><span class="id"> &lt;=</span><span class="id"> d</span><span class="id"> &lt;=</span><span class="id"> b</span><span class="id"> &amp;</span><span class="id"> f</span><span class="id"> d</span><span class="id"> =</span><span class="id"> f</span><span class="id"> a</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">have</span><span class="id"> cLb'</span><span class="id"> :</span><span class="id"> c</span><span class="id"> &lt;=</span><span class="id"> b</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> ltW</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> IVT</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> case:</span><span class="id"> ltrgtP</span><span class="id"> fcLfb;</span><span class="id"> rewrite</span><span class="id"> //</span><span class="id"> !ltW</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">have</span><span class="id"> /</span>(<span class="id">fxy</span><span class="id"> f</span><span class="id"> fI</span>)<span class="id"> :</span><span class="id"> a</span><span class="id"> &lt;</span><span class="id"> d</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span> (<span class="id">lt_le_trans</span><span class="id"> aLc</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">suff</span><span class="id"> dI'</span><span class="id"> :</span><span class="id"> d</span><span class="id"> \in</span><span class="id"> I</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> eq_sym=&gt;</span><span class="id"> /</span>(_<span class="id"> aI</span><span class="id"> dI'</span>)<span class="id"> =&gt;</span><span class="id"> /negbTE</span><span class="id"> -&gt;</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">move:</span><span class="id"> dLb;</span><span class="id"> rewrite</span><span class="id"> le_eqVlt</span><span class="id"> =&gt;</span><span class="id"> /predU1P[-&gt;//|/ltW</span><span class="id"> db]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> intP//</span><span class="id"> db</span>  (<span class="id">le_trans</span> (<span class="id">ltW</span><span class="id"> aLc</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> move:</span><span class="id"> fcLfa;</span><span class="id"> rewrite</span><span class="id"> -fbEfc</span><span class="id"> ltNge</span> (<span class="id">ltW</span><span class="id"> faLfb</span>).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move/</span>(<span class="id">fxy</span><span class="id"> _</span><span class="id"> fI</span>)<span class="id"> :</span><span class="id"> aLc=&gt;</span><span class="id"> /</span>(_<span class="id"> aI</span><span class="id"> cI</span>)<span class="id">;</span><span class="id"> rewrite</span><span class="id"> faEfc</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> [u</span><span class="id"> [v</span><span class="id"> [uI</span><span class="id"> vI</span><span class="id"> ulv</span><span class="id"> +]]]</span><span class="id"> fC</span><span class="id"> fI;</span><span class="id"> rewrite</span><span class="id"> le_eqVlt</span><span class="id"> =&gt;</span><span class="id"> /predU1P[fufv|fuLfv]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move/fI:</span><span class="id"> fufv</span><span class="id"> =&gt;</span><span class="id"> /</span>(_<span class="id"> uI</span><span class="id"> vI</span>)<span class="id"> uv;</span><span class="id"> move:</span><span class="id"> ulv;</span><span class="id"> rewrite</span><span class="id"> uv</span><span class="id"> ltxx</span>.<br/>
<span class="id">have</span><span class="id"> aux</span><span class="id"> a</span><span class="id"> c</span><span class="id"> b</span><span class="id"> :</span><span class="id"> a</span><span class="id"> \in</span><span class="id"> I</span><span class="id"> -&gt;</span><span class="id"> b</span><span class="id"> \in</span><span class="id"> I</span><span class="id"> -&gt;</span><span class="id"> a</span><span class="id"> &lt;</span><span class="id"> c</span><span class="id"> -&gt;</span><span class="id"> c</span><span class="id"> &lt;</span><span class="id"> b</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;(<span class="id">f</span><span class="id"> a</span><span class="id"> &lt;</span><span class="id"> f</span><span class="id"> c</span><span class="id"> -&gt;</span><span class="id"> f</span><span class="id"> a</span><span class="id"> &lt;</span><span class="id"> f</span><span class="id"> b</span><span class="id"> /\</span><span class="id"> f</span><span class="id"> c</span><span class="id"> &lt;</span><span class="id"> f</span><span class="id"> b</span>)<span class="id"> /\</span><br/>
&nbsp;&nbsp;&nbsp;(<span class="id">f</span><span class="id"> c</span><span class="id"> &lt;</span><span class="id"> f</span><span class="id"> b</span><span class="id"> -&gt;</span><span class="id"> f</span><span class="id"> a</span><span class="id"> &lt;</span><span class="id"> f</span><span class="id"> b</span><span class="id"> /\</span><span class="id"> f</span><span class="id"> a</span><span class="id"> &lt;</span><span class="id"> f</span><span class="id"> c</span>).<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> aI</span><span class="id"> bI</span><span class="id"> aLc</span><span class="id"> cLb;</span><span class="id"> have</span><span class="id"> aLb</span><span class="id"> :=</span><span class="id"> lt_trans</span><span class="id"> aLc</span><span class="id"> cLb</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> cI</span><span class="id"> :</span><span class="id"> c</span><span class="id"> \in</span><span class="id"> I</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span> (<span class="id">interval_is_interval</span><span class="id"> aI</span><span class="id"> bI</span>)<span class="id">//</span> (<span class="id">ltW</span><span class="id"> aLc</span>)<span class="id">/=</span><span class="id"> ltW</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> fanfb</span><span class="id"> :</span><span class="id"> f</span><span class="id"> a</span><span class="id"> !=</span><span class="id"> f</span><span class="id"> b</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span> (<span class="id">fxy</span><span class="id"> f</span><span class="id"> fI</span>).<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> decr</span><span class="id"> :</span><span class="id"> f</span><span class="id"> b</span> <span class="id"> &lt;</span><span class="id"> f</span><span class="id"> a</span><span class="id"> -&gt;</span><span class="id"> f</span><span class="id"> b</span><span class="id"> &lt;</span><span class="id"> f</span><span class="id"> c</span><span class="id"> /\</span><span class="id"> f</span><span class="id"> c</span><span class="id"> &lt;</span><span class="id"> f</span><span class="id"> a</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">have</span><span class="id"> ofC</span><span class="id"> :</span><span class="id"> {within</span><span class="id"> [set`</span><span class="id"> I],</span><span class="id"> continuous</span> (<span class="id">-f</span>)<span class="id">}</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> ?;</span><span class="id"> apply:</span><span class="id"> continuous_comp;</span><span class="id"> [exact:</span><span class="id"> fC</span><span class="id"> |</span><span class="id"> exact:</span><span class="id"> continuousN]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">have</span><span class="id"> ofI</span><span class="id"> :</span><span class="id"> {in</span><span class="id"> I</span><span class="id"> &amp;,</span><span class="id"> injective</span> (<span class="id">-f</span>)<span class="id">}</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;&gt;</span><span class="id"> ?</span><span class="id"> ?</span><span class="id"> /oppr_inj/fI</span><span class="id"> -&gt;</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -[X</span><span class="gallina-kwd"> in</span><span class="id"> X</span><span class="id"> &lt;</span><span class="id"> _</span><span class="id"> -&gt;</span><span class="id"> _]</span>(<span class="id">opprK</span> (<span class="id">f</span><span class="id"> b</span>))<span class="id"> ltrNl</span><span class="id"> =&gt;</span><span class="id"> ofaLofb</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">have</span><span class="id"> :=</span><span class="id"> main</span><span class="id"> _</span><span class="id"> c</span><span class="id"> ofC</span><span class="id"> ofI</span><span class="id"> a</span><span class="id"> b</span><span class="id"> aI</span><span class="id"> bI</span><span class="id"> ofaLofb</span><span class="id"> aLc</span><span class="id"> cLb</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span> (<span class="id">do</span><span class="id"> 2</span><span class="id"> rewrite</span><span class="id"> ltrNl</span><span class="id"> opprK</span>)<span class="id">;</span><span class="id"> rewrite</span><span class="id"> and_comm</span>.<br/>
&nbsp;&nbsp;<span class="id">split=&gt;</span><span class="id"> [faLfc|fcLfb]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">suff</span><span class="id"> L</span><span class="id"> :</span><span class="id"> f</span><span class="id"> a</span><span class="id"> &lt;</span><span class="id"> f</span><span class="id"> b</span><span class="gallina-kwd"> by</span><span class="id"> have</span><span class="id"> []</span><span class="id"> :=</span><span class="id"> main</span><span class="id"> f</span><span class="id"> c</span><span class="id"> fC</span><span class="id"> fI</span><span class="id"> a</span><span class="id"> b</span><span class="id"> aI</span><span class="id"> bI</span><span class="id"> L</span><span class="id"> aLc</span><span class="id"> cLb</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> case:</span><span class="id"> ltgtP</span><span class="id"> decr</span><span class="id"> fanfb</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> fbfa</span><span class="id"> []//;</span><span class="id"> case:</span><span class="id"> ltgtP</span><span class="id"> faLfc</span>.<br/>
&nbsp;&nbsp;<span class="id">suff</span><span class="id"> L</span><span class="id"> :</span><span class="id"> f</span><span class="id"> a</span><span class="id"> &lt;</span><span class="id"> f</span><span class="id"> b</span><span class="gallina-kwd"> by</span><span class="id"> have</span><span class="id"> []</span><span class="id"> :=</span><span class="id"> main</span><span class="id"> f</span><span class="id"> c</span><span class="id"> fC</span><span class="id"> fI</span><span class="id"> a</span><span class="id"> b</span><span class="id"> aI</span><span class="id"> bI</span><span class="id"> L</span><span class="id"> aLc</span><span class="id"> cLb</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> case:</span><span class="id"> ltgtP</span><span class="id"> decr</span><span class="id"> fanfb</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> fbfa</span><span class="id"> []//;</span><span class="id"> case:</span><span class="id"> ltgtP</span><span class="id"> fcLfb</span>.<br/>
<span class="id">have{main</span><span class="id"> fC}</span><span class="id"> whole</span><span class="id"> a</span><span class="id"> c</span><span class="id"> b</span><span class="id"> :=</span><span class="id"> main</span><span class="id"> f</span><span class="id"> c</span><span class="id"> fC</span><span class="id"> fI</span><span class="id"> a</span><span class="id"> b</span>.<br/>
<span class="id">have</span><span class="id"> low</span><span class="id"> a</span><span class="id"> c</span><span class="id"> b</span><span class="id"> :</span><span class="id"> f</span><span class="id"> a</span><span class="id"> &lt;</span><span class="id"> f</span><span class="id"> c</span><span class="id"> -&gt;</span><span class="id"> a</span><span class="id"> \in</span><span class="id"> I</span><span class="id"> -&gt;</span><span class="id"> b</span><span class="id"> \in</span><span class="id"> I</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">a</span><span class="id"> &lt;</span><span class="id"> c</span><span class="id"> -&gt;</span><span class="id"> c</span><span class="id"> &lt;</span><span class="id"> b</span><span class="id"> -&gt;</span><span class="id"> f</span><span class="id"> a</span><span class="id"> &lt;</span><span class="id"> f</span><span class="id"> b</span><span class="id"> /\</span><span class="id"> f</span><span class="id"> c</span><span class="id"> &lt;</span><span class="id"> f</span><span class="id"> b</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> L</span><span class="id"> aI</span><span class="id"> bI</span><span class="id"> ac</span><span class="id"> cb;</span><span class="id"> case:</span> (<span class="id">aux</span><span class="id"> a</span><span class="id"> c</span><span class="id"> b</span><span class="id"> aI</span><span class="id"> bI</span><span class="id"> ac</span><span class="id"> cb</span>)<span class="id">=&gt;</span><span class="id"> [/</span>(_<span class="id"> L</span>)<span class="id">]</span>.<br/>
<span class="id">have</span><span class="id"> high</span><span class="id"> a</span><span class="id"> c</span><span class="id"> b</span><span class="id"> :</span><span class="id"> f</span><span class="id"> c</span><span class="id"> &lt;</span><span class="id"> f</span><span class="id"> b</span><span class="id"> -&gt;</span><span class="id"> a</span><span class="id"> \in</span><span class="id"> I</span><span class="id"> -&gt;</span><span class="id"> b</span><span class="id"> \in</span><span class="id"> I</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">a</span><span class="id"> &lt;</span><span class="id"> c</span><span class="id"> -&gt;</span><span class="id"> c</span><span class="id"> &lt;</span><span class="id"> b</span><span class="id"> -&gt;</span><span class="id"> f</span><span class="id"> a</span><span class="id"> &lt;</span><span class="id"> f</span><span class="id"> b</span><span class="id"> /\</span><span class="id"> f</span><span class="id"> a</span><span class="id"> &lt;</span><span class="id"> f</span><span class="id"> c</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> L</span><span class="id"> aI</span><span class="id"> bI</span><span class="id"> ac</span><span class="id"> cb;</span><span class="id"> case:</span> (<span class="id">aux</span><span class="id"> a</span><span class="id"> c</span><span class="id"> b</span><span class="id"> aI</span><span class="id"> bI</span><span class="id"> ac</span><span class="id"> cb</span>)<span class="id">=&gt;</span><span class="id"> [_</span><span class="id"> /</span>(_<span class="id"> L</span>)<span class="id">]</span>.<br/>
<span class="id">apply:</span><span class="id"> le_mono_in</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> y</span><span class="id"> xI</span><span class="id"> yI</span><span class="id"> xLy</span>.<br/>
<span class="id">have</span><span class="id"> [uLx</span><span class="id"> |</span><span class="id"> xLu</span><span class="id"> |</span><span class="id"> xu]</span><span class="id"> :=</span><span class="id"> ltrgtP</span><span class="id"> u</span><span class="id"> x</span>.<br/>
<span class="id">-</span><span class="id"> suff</span><span class="id"> fuLfx</span><span class="id"> :</span><span class="id"> f</span><span class="id"> u</span><span class="id"> &lt;</span><span class="id"> f</span><span class="id"> x</span><span class="gallina-kwd"> by</span><span class="id"> have</span><span class="id"> []</span><span class="id"> :=</span><span class="id"> low</span><span class="id"> u</span><span class="id"> x</span><span class="id"> y</span><span class="id"> fuLfx</span><span class="id"> uI</span><span class="id"> yI</span><span class="id"> uLx</span><span class="id"> xLy</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> [xLv</span><span class="id"> |</span><span class="id"> vLx</span><span class="id"> |</span><span class="id"> -&gt;</span><span class="id"> //]</span><span class="id"> :=</span><span class="id"> ltrgtP</span><span class="id"> x</span><span class="id"> v;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> case:</span> (<span class="id">whole</span><span class="id"> u</span><span class="id"> x</span><span class="id"> v</span>).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> case:</span> (<span class="id">low</span><span class="id"> u</span><span class="id"> v</span><span class="id"> x</span>).<br/>
<span class="id">-</span><span class="id"> have</span><span class="id"> fxLfu</span><span class="id"> :</span><span class="id"> f</span><span class="id"> x</span><span class="id"> &lt;</span><span class="id"> f</span><span class="id"> u</span><span class="gallina-kwd"> by</span><span class="id"> have</span><span class="id"> []</span><span class="id"> :=</span><span class="id"> high</span><span class="id"> x</span><span class="id"> u</span><span class="id"> v</span><span class="id"> fuLfv</span><span class="id"> xI</span><span class="id"> vI</span><span class="id"> xLu</span><span class="id"> ulv</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> [yLu</span><span class="id"> |</span><span class="id"> uLy</span><span class="id"> |</span><span class="id"> -&gt;</span><span class="id"> //]</span><span class="id"> :=</span><span class="id"> ltrgtP</span><span class="id"> y</span><span class="id"> u;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> case:</span> (<span class="id">whole</span><span class="id"> x</span><span class="id"> y</span><span class="id"> u</span>).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> case:</span> (<span class="id">low</span><span class="id"> x</span><span class="id"> u</span><span class="id"> y</span>).<br/>
<span class="id">move:</span><span class="id"> xLy;</span><span class="id"> rewrite</span><span class="id"> -xu</span><span class="id"> =&gt;</span><span class="id"> uLy</span>.<br/>
<span class="id">have</span><span class="id"> [yLv</span><span class="id"> |</span><span class="id"> vLy</span><span class="id"> |</span><span class="id"> -&gt;</span><span class="id"> //]</span><span class="id"> :=</span><span class="id"> ltrgtP</span><span class="id"> y</span><span class="id"> v;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> case:</span> (<span class="id">whole</span><span class="id"> u</span><span class="id"> y</span><span class="id"> v</span>).<br/>
<span class="gallina-kwd">by</span><span class="id"> case:</span> (<span class="id">low</span><span class="id"> u</span><span class="id"> v</span><span class="id"> y</span>).<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> itv_continuous_inj_ge</span><span class="id"> f</span> (<span class="id">I</span><span class="id"> :</span><span class="id"> interval</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">exists</span><span class="id"> x</span><span class="id"> y,</span><span class="id"> [/\</span><span class="id"> x</span><span class="id"> \in</span><span class="id"> I,</span><span class="id"> y</span><span class="id"> \in</span><span class="id"> I,</span><span class="id"> x</span><span class="id"> &lt;</span><span class="id"> y</span><span class="id"> &amp;</span><span class="id"> f</span><span class="id"> y</span><span class="id"> &lt;=</span><span class="id"> f</span><span class="id"> x]</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">{within</span><span class="id"> [set`</span><span class="id"> I],</span><span class="id"> continuous</span><span class="id"> f}</span><span class="id"> -&gt;</span><span class="id"> {in</span><span class="id"> I</span><span class="id"> &amp;,</span><span class="id"> injective</span><span class="id"> f}</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">{in</span><span class="id"> I</span><span class="id"> &amp;,</span><span class="id"> {mono</span><span class="id"> f</span><span class="id"> :</span><span class="id"> x</span><span class="id"> y</span><span class="id"> /~</span><span class="id"> x</span><span class="id"> &lt;=</span><span class="id"> y}}</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> [a</span><span class="id"> [b</span><span class="id"> [aI</span><span class="id"> bI</span><span class="id"> ab</span><span class="id"> fbfa]]]</span><span class="id"> fC</span><span class="id"> fI</span><span class="id"> x</span><span class="id"> y</span><span class="id"> xI</span><span class="id"> yI</span>.<br/>
<span class="id">suff</span><span class="id"> :</span> (<span class="id">-</span><span class="id"> f</span>)<span class="id"> y</span><span class="id"> &lt;=</span> (<span class="id">-</span><span class="id"> f</span>)<span class="id"> x</span><span class="id"> =</span> (<span class="id">y</span><span class="id"> &lt;=</span><span class="id"> x</span>)<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> lerNl</span><span class="id"> opprK</span>.<br/>
<span class="id">apply:</span><span class="id"> itv_continuous_inj_le</span><span class="id"> xI</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> [|x1</span><span class="id"> x1I</span><span class="id"> |</span><span class="id"> x1</span><span class="id"> x2</span><span class="id"> x1I</span><span class="id"> x2I]</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="gallina-kwd"> exists</span><span class="id"> a,</span><span class="id"> b;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> rewrite</span><span class="id"> lerNl</span><span class="id"> opprK</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> apply/continuousN/fC</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> move/oppr_inj;</span><span class="id"> apply/fI</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> itv_continuous_inj_mono</span><span class="id"> f</span> (<span class="id">I</span><span class="id"> :</span><span class="id"> interval</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">{within</span><span class="id"> [set`</span><span class="id"> I],</span><span class="id"> continuous</span><span class="id"> f}</span><span class="id"> -&gt;</span><span class="id"> {in</span><span class="id"> I</span><span class="id"> &amp;,</span><span class="id"> injective</span><span class="id"> f}</span><span class="id"> -&gt;</span><span class="id"> monotonous</span><span class="id"> I</span><span class="id"> f</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> fC</span><span class="id"> fI</span>.<br/>
<span class="id">case:</span> (<span class="id">pselect</span> (<span class="gallina-kwd">exists</span><span class="id"> a</span><span class="id"> b,</span><span class="id"> [/\</span><span class="id"> a</span><span class="id"> \in</span><span class="id"> I</span><span class="id"> ,</span><span class="id"> b</span><span class="id"> \in</span><span class="id"> I</span><span class="id"> &amp;</span><span class="id"> a</span><span class="id"> &lt;</span><span class="id"> b]</span>))<span class="id">;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> N2I;</span><span class="id"> left</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> y</span><span class="id"> xI</span><span class="id"> yI;</span><span class="id"> suff</span><span class="id"> -&gt;</span><span class="id"> :</span><span class="id"> x</span><span class="id"> =</span><span class="id"> y</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> ?lexx</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> contra_notP</span><span class="id"> N2I</span><span class="id"> =&gt;</span><span class="id"> /eqP;</span><span class="id"> case:</span><span class="id"> ltgtP;</span><span class="id"> [exists</span><span class="id"> x,</span><span class="id"> y|exists</span><span class="id"> y,</span><span class="id"> x|]</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> [a</span><span class="id"> [b</span><span class="id"> [aI</span><span class="id"> bI</span><span class="id"> lt_ab]]]</span>.<br/>
<span class="id">have</span><span class="id"> /orP[faLfb|fbLfa]</span><span class="id"> :=</span><span class="id"> le_total</span> (<span class="id">f</span><span class="id"> a</span>) (<span class="id">f</span><span class="id"> b</span>).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> left;</span><span class="id"> apply:</span><span class="id"> itv_continuous_inj_le</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="gallina-kwd"> exists</span><span class="id"> a,</span><span class="id"> b;</span><span class="id"> rewrite</span><span class="id"> ?faLfb</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> right;</span><span class="id"> apply:</span><span class="id"> itv_continuous_inj_ge</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="gallina-kwd"> exists</span><span class="id"> a,</span><span class="id"> b;</span><span class="id"> rewrite</span><span class="id"> ?fbLfa</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> segment_continuous_inj_le</span><span class="id"> f</span><span class="id"> a</span><span class="id"> b</span><span class="id"> :</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">f</span><span class="id"> a</span><span class="id"> &lt;=</span><span class="id"> f</span><span class="id"> b</span><span class="id"> -&gt;</span><span class="id"> {within</span><span class="id"> `[a,</span><span class="id"> b],</span><span class="id"> continuous</span><span class="id"> f}</span><span class="id"> -&gt;</span><span class="id"> {in</span><span class="id"> `[a,</span><span class="id"> b]</span><span class="id"> &amp;,</span><span class="id"> injective</span><span class="id"> f}</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">{in</span><span class="id"> `[a,</span><span class="id"> b]</span><span class="id"> &amp;,</span><span class="id"> {mono</span><span class="id"> f</span><span class="id"> :</span><span class="id"> x</span><span class="id"> y</span><span class="id"> /</span><span class="id"> x</span><span class="id"> &lt;=</span><span class="id"> y}}</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> fafb</span><span class="id"> fct</span><span class="id"> finj;</span><span class="id"> have</span><span class="id"> [//|]</span><span class="id"> :=</span><span class="id"> itv_continuous_inj_mono</span><span class="id"> fct</span><span class="id"> finj</span>.<br/>
<span class="id">have</span><span class="id"> [aLb|bLa|&lt;-]</span><span class="id"> :=</span><span class="id"> ltrgtP</span><span class="id"> a</span><span class="id"> b;</span><span class="id"> first</span><span class="id"> 1</span><span class="id"> last</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> _</span><span class="id"> x</span><span class="id"> ?;</span><span class="id"> rewrite</span><span class="id"> itv_ge//</span><span class="id"> -ltNge</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> _</span><span class="id"> x</span><span class="id"> y</span><span class="id"> /itvxxP-&gt;</span><span class="id"> /itvxxP-&gt;;</span><span class="id"> rewrite</span><span class="id"> !lexx</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> /</span>(_<span class="id"> a</span><span class="id"> b</span>)<span class="id">;</span><span class="id"> rewrite</span><span class="id"> !bound_itvE</span><span class="id"> fafb</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> /</span>(_ (<span class="id">ltW</span><span class="id"> aLb</span>) (<span class="id">ltW</span><span class="id"> aLb</span>))<span class="id">;</span><span class="id"> rewrite</span><span class="id"> lt_geF</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> segment_continuous_inj_ge</span><span class="id"> f</span><span class="id"> a</span><span class="id"> b</span><span class="id"> :</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">f</span><span class="id"> a</span><span class="id"> &gt;=</span><span class="id"> f</span><span class="id"> b</span><span class="id"> -&gt;</span><span class="id"> {within</span><span class="id"> `[a,</span><span class="id"> b],</span><span class="id"> continuous</span><span class="id"> f}</span><span class="id"> -&gt;</span><span class="id"> {in</span><span class="id"> `[a,</span><span class="id"> b]</span><span class="id"> &amp;,</span><span class="id"> injective</span><span class="id"> f}</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">{in</span><span class="id"> `[a,</span><span class="id"> b]</span><span class="id"> &amp;,</span><span class="id"> {mono</span><span class="id"> f</span><span class="id"> :</span><span class="id"> x</span><span class="id"> y</span><span class="id"> /~</span><span class="id"> x</span><span class="id"> &lt;=</span><span class="id"> y}}</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> fafb</span><span class="id"> fct</span><span class="id"> finj;</span><span class="id"> have</span><span class="id"> [|//]</span><span class="id"> :=</span><span class="id"> itv_continuous_inj_mono</span><span class="id"> fct</span><span class="id"> finj</span>.<br/>
<span class="id">have</span><span class="id"> [aLb|bLa|&lt;-]</span><span class="id"> :=</span><span class="id"> ltrgtP</span><span class="id"> a</span><span class="id"> b;</span><span class="id"> first</span><span class="id"> 1</span><span class="id"> last</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> _</span><span class="id"> x</span><span class="id"> ?;</span><span class="id"> rewrite</span><span class="id"> itv_ge//</span><span class="id"> -ltNge</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> _</span><span class="id"> x</span><span class="id"> y</span><span class="id"> /itvxxP-&gt;</span><span class="id"> /itvxxP-&gt;;</span><span class="id"> rewrite</span><span class="id"> !lexx</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> /</span>(_<span class="id"> b</span><span class="id"> a</span>)<span class="id">;</span><span class="id"> rewrite</span><span class="id"> !bound_itvE</span><span class="id"> fafb</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> /</span>(_ (<span class="id">ltW</span><span class="id"> aLb</span>) (<span class="id">ltW</span><span class="id"> aLb</span>))<span class="id">;</span><span class="id"> rewrite</span><span class="id"> lt_geF</span>.<br/>
Qed.</div></details>
<br/>
<div class="doc">The condition "f a &lt;= f b" is unnecessary because the last
    interval condition is vacuously true otherwise. </div>
<span class="vernacular">Lemma</span><span class="id"> segment_can_le</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span><span class="id"> g</span><span class="id"> :</span><span class="id"> a</span><span class="id"> &lt;=</span><span class="id"> b</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">{within</span><span class="id"> `[a,</span><span class="id"> b],</span><span class="id"> continuous</span><span class="id"> f}</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">{in</span><span class="id"> `[a,</span><span class="id"> b],</span><span class="id"> cancel</span><span class="id"> f</span><span class="id"> g}</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">{in</span><span class="id"> `[f</span><span class="id"> a,</span><span class="id"> f</span><span class="id"> b]</span><span class="id"> &amp;,</span><span class="id"> {mono</span><span class="id"> g</span><span class="id"> :</span><span class="id"> x</span><span class="id"> y</span><span class="id"> /</span><span class="id"> x</span><span class="id"> &lt;=</span><span class="id"> y}}</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> aLb</span><span class="id"> ctf</span><span class="id"> fK;</span><span class="id"> have</span><span class="id"> [fbLfa</span><span class="id"> |</span><span class="id"> faLfb]</span><span class="id"> :=</span><span class="id"> ltrP</span> (<span class="id">f</span><span class="id"> b</span>) (<span class="id">f</span><span class="id"> a</span>).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> y;</span><span class="id"> rewrite</span><span class="id"> itv_ge//</span><span class="id"> -ltNge</span>.<br/>
<span class="id">have</span><span class="id"> [aab</span><span class="id"> bab]</span><span class="id"> :</span><span class="id"> a</span><span class="id"> \in</span><span class="id"> `[a,</span><span class="id"> b]</span><span class="id"> /\</span><span class="id"> b</span><span class="id"> \in</span><span class="id"> `[a,</span><span class="id"> b]</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> !bound_itvE</span>.<br/>
<span class="id">case:</span><span class="id"> ltgtP</span><span class="id"> faLfb</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> [faLfb</span><span class="id"> _|-&gt;</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> /itvxxP-&gt;</span><span class="id"> /itvxxP-&gt;];</span><span class="id"> rewrite</span><span class="id"> ?lexx//</span>.<br/>
<span class="id">have</span><span class="id"> lt_ab</span><span class="id"> :</span><span class="id"> a</span><span class="id"> &lt;</span><span class="id"> b</span><span class="gallina-kwd"> by</span><span class="id"> case:</span> (<span class="id">ltgtP</span><span class="id"> a</span><span class="id"> b</span>)<span class="id"> aLb</span><span class="id"> faLfb</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> -&gt;;</span><span class="id"> rewrite</span><span class="id"> ltxx</span>.<br/>
<span class="id">have</span><span class="id"> w</span><span class="id"> :</span><span class="gallina-kwd"> exists</span><span class="id"> x</span><span class="id"> y,</span><span class="id"> [/\</span><span class="id"> x</span><span class="id"> \in</span><span class="id"> `[a,</span><span class="id"> b],</span><span class="id"> y</span><span class="id"> \in</span><span class="id"> `[a,</span><span class="id"> b],</span><span class="id"> x</span><span class="id"> &lt;</span><span class="id"> y</span><span class="id"> &amp;</span><span class="id"> f</span><span class="id"> x</span><span class="id"> &lt;=</span><span class="id"> f</span><span class="id"> y]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="gallina-kwd"> exists</span><span class="id"> a,</span><span class="id"> b;</span><span class="id"> rewrite</span><span class="id"> !bound_itvE</span> (<span class="id">ltW</span><span class="id"> faLfb</span>).<br/>
<span class="id">have</span><span class="id"> fle</span><span class="id"> :=</span><span class="id"> itv_continuous_inj_le</span><span class="id"> w</span><span class="id"> ctf</span> (<span class="id">can_in_inj</span><span class="id"> fK</span>).<br/>
<span class="id">move=&gt;</span><span class="id"> x</span><span class="id"> y</span><span class="id"> xin</span><span class="id"> yin;</span><span class="id"> have</span><span class="id"> :=</span><span class="id"> IVT</span><span class="id"> aLb</span><span class="id"> ctf</span>.<br/>
<span class="id">case:</span> (<span class="id">ltrgtP</span> (<span class="id">f</span><span class="id"> a</span>) (<span class="id">f</span><span class="id"> b</span>))<span class="id"> faLfb</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> _</span><span class="id"> _</span><span class="id"> ivt</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> have</span><span class="id"> [[u</span><span class="id"> uin</span><span class="id"> &lt;-]</span><span class="id"> [v</span><span class="id"> vin</span><span class="id"> &lt;-]]</span><span class="id"> :=</span> (<span class="id">ivt</span><span class="id"> _</span><span class="id"> xin,</span><span class="id"> ivt</span><span class="id"> _</span><span class="id"> yin</span>)<span class="id">;</span><span class="id"> rewrite</span><span class="id"> !fK//</span><span class="id"> !fle</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Section</span><span class="id"> negation_itv</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Definition</span><span class="id"> itvN_oppr</span><span class="id"> a</span><span class="id"> b</span><span class="id"> :=</span><span class="id"> @GRing</span>.<span class="id">opp</span><span class="id"> R</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Lemma</span><span class="id"> itv_oppr_is_fun</span><span class="id"> a</span><span class="id"> b</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">isFun</span><span class="id"> _</span><span class="id"> _</span><span class="id"> `[-</span><span class="id"> b,</span><span class="id"> -</span><span class="id"> a]%classic</span><span class="id"> `[a,</span><span class="id"> b]%classic</span> (<span class="id">itvN_oppr</span><span class="id"> a</span><span class="id"> b</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> split=&gt;</span><span class="id"> x</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> oppr_itvcc</span>. Qed.</div></details>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> a</span><span class="id"> b</span><span class="id"> :=</span><span class="id"> itv_oppr_is_fun</span><span class="id"> a</span><span class="id"> b</span>.<br/>
<span class="vernacular">End</span><span class="id"> negation_itv</span>.<br/>
<br/>
<div class="doc">The condition "f b &lt;= f a" is unnecessary---see seg...increasing above    </div>
<span class="vernacular">Lemma</span><span class="id"> segment_can_ge</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span><span class="id"> g</span><span class="id"> :</span><span class="id"> a</span><span class="id"> &lt;=</span><span class="id"> b</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">{within</span><span class="id"> `[a,</span><span class="id"> b],</span><span class="id"> continuous</span><span class="id"> f}</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">{in</span><span class="id"> `[a,</span><span class="id"> b],</span><span class="id"> cancel</span><span class="id"> f</span><span class="id"> g}</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">{in</span><span class="id"> `[f</span><span class="id"> b,</span><span class="id"> f</span><span class="id"> a]</span><span class="id"> &amp;,</span><span class="id"> {mono</span><span class="id"> g</span><span class="id"> :</span><span class="id"> x</span><span class="id"> y</span><span class="id"> /~</span><span class="id"> x</span><span class="id"> &lt;=</span><span class="id"> y}}</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> aLb</span><span class="id"> fC</span><span class="id"> fK</span><span class="id"> x</span><span class="id"> y</span><span class="id"> xfbfa</span><span class="id"> yfbfa;</span><span class="id"> rewrite</span><span class="id"> -lerN2</span>.<br/>
<span class="id">apply:</span> (<span class="id">@segment_can_le</span> (<span class="id">-</span><span class="id"> b</span>) (<span class="id">-</span><span class="id"> a</span>) (<span class="id">f</span><span class="id"> \o</span><span class="id"> -%R</span>) (<span class="id">-</span><span class="id"> g</span>))<span class="id">;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> /=</span><span class="id"> ?lerN2</span><span class="id"> ?opprK</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="id">pose</span><span class="id"> fun_neg</span><span class="id"> :</span><span class="id"> subspace</span><span class="id"> `[-b,-a]</span><span class="id"> -&gt;</span><span class="id"> subspace</span><span class="id"> `[a,b]</span><span class="id"> :=</span><span class="id"> itvN_oppr</span><span class="id"> a</span><span class="id"> b</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> z;</span><span class="id"> apply:</span> (<span class="id">@continuous_comp</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> [fun</span><span class="id"> of</span><span class="id"> fun_neg]</span>)<span class="id">;</span><span class="id"> last</span><span class="id"> exact:</span><span class="id"> fC</span>.<br/>
&nbsp;&nbsp;<span class="id">exact/subspaceT_continuous/continuous_subspaceT/opp_continuous</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> z</span><span class="id"> zab;</span><span class="id"> rewrite</span><span class="id"> -[-</span><span class="id"> g]/</span>(<span class="id">@GRing</span>.<span class="id">opp</span><span class="id"> _</span><span class="id"> \o</span><span class="id"> g</span>)<span class="id">/=</span><span class="id"> fK</span><span class="id"> ?opprK//</span><span class="id"> oppr_itvcc</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> segment_can_mono</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span><span class="id"> g</span><span class="id"> :</span><span class="id"> a</span><span class="id"> &lt;=</span><span class="id"> b</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">{within</span><span class="id"> `[a,</span><span class="id"> b],</span><span class="id"> continuous</span><span class="id"> f}</span><span class="id"> -&gt;</span><span class="id"> {in</span><span class="id"> `[a,</span><span class="id"> b],</span><span class="id"> cancel</span><span class="id"> f</span><span class="id"> g}</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">monotonous</span> (<span class="id">f</span><span class="id"> @`[a,</span><span class="id"> b]</span>)<span class="id"> g</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> le_ab</span><span class="id"> fct</span><span class="id"> fK;</span><span class="id"> rewrite</span><span class="id"> /monotonous/=;</span><span class="id"> case:</span><span class="id"> ltrgtP</span><span class="id"> =&gt;</span><span class="id"> fab;</span><span class="id"> [left|right</span>..<span class="id">];</span><br/>
&nbsp;&nbsp;<span class="id">do</span><span class="id"> ?by</span><span class="id"> [apply:</span><span class="id"> segment_can_le|apply:</span><span class="id"> segment_can_ge]</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> y</span><span class="id"> /itvxxP&lt;-</span><span class="id"> /itvxxP&lt;-;</span><span class="id"> rewrite</span><span class="id"> !lexx</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> segment_continuous_surjective</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span><span class="id"> :</span><span class="id"> a</span><span class="id"> &lt;=</span><span class="id"> b</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">{within</span><span class="id"> `[a,</span><span class="id"> b],</span><span class="id"> continuous</span><span class="id"> f}</span><span class="id"> -&gt;</span><span class="id"> set_surj</span><span class="id"> `[a,</span><span class="id"> b]</span> (<span class="id">f</span><span class="id"> @`[a,</span><span class="id"> b]</span>)<span class="id"> f</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> ?</span><span class="id"> fct</span><span class="id"> y/=</span><span class="id"> /IVT[]//</span><span class="id"> x;</span><span class="gallina-kwd"> exists</span><span class="id"> x</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> segment_continuous_le_surjective</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span><span class="id"> :</span><span class="id"> a</span><span class="id"> &lt;=</span><span class="id"> b</span><span class="id"> -&gt;</span><span class="id"> f</span><span class="id"> a</span><span class="id"> &lt;=</span><span class="id"> f</span><span class="id"> b</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">{within</span><span class="id"> `[a,</span><span class="id"> b],</span><span class="id"> continuous</span><span class="id"> f}</span><span class="id"> -&gt;</span><span class="id"> set_surj</span><span class="id"> `[a,</span><span class="id"> b]</span><span class="id"> `[f</span><span class="id"> a,</span><span class="id"> f</span><span class="id"> b]</span><span class="id"> f</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> le_ab</span><span class="id"> f_ab</span><span class="id"> /</span>(<span class="id">segment_continuous_surjective</span><span class="id"> le_ab</span>).<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span> (<span class="id">min_idPl</span><span class="id"> _</span>)<span class="id">//</span> (<span class="id">max_idPr</span><span class="id"> _</span>).<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> segment_continuous_ge_surjective</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span><span class="id"> :</span><span class="id"> a</span><span class="id"> &lt;=</span><span class="id"> b</span><span class="id"> -&gt;</span><span class="id"> f</span><span class="id"> b</span><span class="id"> &lt;=</span><span class="id"> f</span><span class="id"> a</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">{within</span><span class="id"> `[a,</span><span class="id"> b],</span><span class="id"> continuous</span><span class="id"> f}</span><span class="id"> -&gt;</span><span class="id"> set_surj</span><span class="id"> `[a,</span><span class="id"> b]</span><span class="id"> `[f</span><span class="id"> b,</span><span class="id"> f</span><span class="id"> a]</span><span class="id"> f</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> le_ab</span><span class="id"> f_ab</span><span class="id"> /</span>(<span class="id">segment_continuous_surjective</span><span class="id"> le_ab</span>).<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span> (<span class="id">min_idPr</span><span class="id"> _</span>)<span class="id">//</span> (<span class="id">max_idPl</span><span class="id"> _</span>).<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> continuous_inj_image_segment</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span><span class="id"> :</span><span class="id"> a</span><span class="id"> &lt;=</span><span class="id"> b</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">{within</span><span class="id"> `[a,</span><span class="id"> b],</span><span class="id"> continuous</span><span class="id"> f}</span><span class="id"> -&gt;</span><span class="id"> {in</span><span class="id"> `[a,</span><span class="id"> b]</span><span class="id"> &amp;,</span><span class="id"> injective</span><span class="id"> f}</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">f</span><span class="id"> @`</span><span class="id"> `[a,</span><span class="id"> b]</span><span class="id"> =</span><span class="id"> f</span><span class="id"> @`[a,</span><span class="id"> b]%classic</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> leab</span><span class="id"> fct</span><span class="id"> finj;</span><span class="id"> apply:</span><span class="id"> mono_surj_image_segment</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> itv_continuous_inj_mono</span>.<br/>
<span class="id">exact:</span><span class="id"> segment_continuous_surjective</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> continuous_inj_image_segmentP</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span><span class="id"> :</span><span class="id"> a</span><span class="id"> &lt;=</span><span class="id"> b</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">{within</span><span class="id"> `[a,</span><span class="id"> b],</span><span class="id"> continuous</span><span class="id"> f}</span><span class="id"> -&gt;</span><span class="id"> {in</span><span class="id"> `[a,</span><span class="id"> b]</span><span class="id"> &amp;,</span><span class="id"> injective</span><span class="id"> f}</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">forall</span><span class="id"> y,</span><span class="id"> reflect</span> (<span class="gallina-kwd">exists2</span><span class="id"> x,</span><span class="id"> x</span><span class="id"> \in</span><span class="id"> `[a,</span><span class="id"> b]</span><span class="id"> &amp;</span><span class="id"> f</span><span class="id"> x</span><span class="id"> =</span><span class="id"> y</span>) (<span class="id">y</span><span class="id"> \in</span><span class="id"> f</span><span class="id"> @`[a,</span><span class="id"> b]</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> /continuous_inj_image_segment/[apply]/[apply]/predeqP</span><span class="id"> +</span><span class="id"> y</span><span class="id"> =&gt;</span><span class="id"> /</span>(_<span class="id"> y</span>)<span class="id"> faby</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply/</span>(<span class="id">equivP</span><span class="id"> idP</span>)<span class="id">;</span><span class="id"> symmetry</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> segment_continuous_can_sym</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span><span class="id"> g</span><span class="id"> :</span><span class="id"> a</span><span class="id"> &lt;=</span><span class="id"> b</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">{within</span><span class="id"> `[a,</span><span class="id"> b],</span><span class="id"> continuous</span><span class="id"> f}</span><span class="id"> -&gt;</span><span class="id"> {in</span><span class="id"> `[a,</span><span class="id"> b],</span><span class="id"> cancel</span><span class="id"> f</span><span class="id"> g}</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">{in</span><span class="id"> f</span><span class="id"> @`[a,</span><span class="id"> b],</span><span class="id"> cancel</span><span class="id"> g</span><span class="id"> f}</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> aLb</span><span class="id"> ctf</span><span class="id"> fK;</span><span class="id"> have</span><span class="id"> g_mono</span><span class="id"> :=</span><span class="id"> segment_can_mono</span><span class="id"> aLb</span><span class="id"> ctf</span><span class="id"> fK</span>.<br/>
<span class="id">have</span><span class="id"> f_mono</span><span class="id"> :=</span><span class="id"> itv_continuous_inj_mono</span><span class="id"> ctf</span> (<span class="id">can_in_inj</span><span class="id"> fK</span>).<br/>
<span class="id">have</span><span class="id"> f_surj</span><span class="id"> :=</span><span class="id"> segment_continuous_surjective</span><span class="id"> aLb</span><span class="id"> ctf</span>.<br/>
<span class="id">have</span><span class="id"> fIP</span><span class="id"> :=</span><span class="id"> mono_surj_image_segmentP</span><span class="id"> aLb</span><span class="id"> f_mono</span><span class="id"> f_surj</span>.<br/>
<span class="id">suff:</span><span class="id"> {in</span><span class="id"> f</span><span class="id"> @`[a,</span><span class="id"> b],</span><span class="id"> {on</span><span class="id"> `[a,</span><span class="id"> b],</span><span class="id"> cancel</span><span class="id"> g</span><span class="id"> &amp;</span><span class="id"> f}}</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> gK</span><span class="id"> _</span><span class="id"> /fIP[x</span><span class="id"> xab</span><span class="id"> &lt;-];</span><span class="id"> rewrite</span><span class="id"> fK</span>.<br/>
<span class="id">have:</span><span class="id"> {in</span><span class="id"> f</span><span class="id"> @`[a,</span><span class="id"> b]</span><span class="id"> &amp;,</span><span class="id"> {on</span><span class="id"> `[a,</span><span class="id"> b]</span> <span class="id"> &amp;,</span><span class="id"> injective</span><span class="id"> g}}</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> _</span><span class="id"> _</span><span class="id"> /fIP</span><span class="id"> [x</span><span class="id"> xab</span><span class="id"> &lt;-]</span><span class="id"> /fIP[y</span><span class="id"> yab</span><span class="id"> &lt;-];</span><span class="id"> rewrite</span><span class="id"> !fK//</span><span class="id"> =&gt;</span><span class="id"> _</span><span class="id"> _</span><span class="id"> -&gt;</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply/ssrbool</span>.<span class="id">inj_can_sym_in_on</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> xab;</span><span class="id"> rewrite</span><span class="id"> ?fK</span><span class="id"> ?mono_mem_image_segment</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> segment_continuous_le_can_sym</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span><span class="id"> g</span><span class="id"> :</span><span class="id"> a</span><span class="id"> &lt;=</span><span class="id"> b</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">{within</span><span class="id"> `[a,</span><span class="id"> b],</span><span class="id"> continuous</span><span class="id"> f}</span><span class="id"> -&gt;</span><span class="id"> {in</span><span class="id"> `[a,</span><span class="id"> b],</span><span class="id"> cancel</span><span class="id"> f</span><span class="id"> g}</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">{in</span><span class="id"> `[f</span><span class="id"> a,</span><span class="id"> f</span><span class="id"> b],</span><span class="id"> cancel</span><span class="id"> g</span><span class="id"> f}</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> aLb</span><span class="id"> fct</span><span class="id"> fK</span><span class="id"> x</span><span class="id"> xfafb;</span><span class="id"> apply:</span> (<span class="id">segment_continuous_can_sym</span><span class="id"> aLb</span><span class="id"> fct</span><span class="id"> fK</span>).<br/>
<span class="id">have</span><span class="id"> :</span><span class="id"> f</span><span class="id"> a</span><span class="id"> &lt;=</span><span class="id"> f</span><span class="id"> b</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span> (<span class="id">itvP</span><span class="id"> xfafb</span>).<br/>
<span class="gallina-kwd">by</span><span class="id"> case:</span><span class="id"> ltrgtP</span><span class="id"> xfafb</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> -&gt;</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> segment_continuous_ge_can_sym</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span><span class="id"> g</span><span class="id"> :</span><span class="id"> a</span><span class="id"> &lt;=</span><span class="id"> b</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">{within</span><span class="id"> `[a,</span><span class="id"> b],</span><span class="id"> continuous</span><span class="id"> f}</span><span class="id"> -&gt;</span><span class="id"> {in</span><span class="id"> `[a,</span><span class="id"> b],</span><span class="id"> cancel</span><span class="id"> f</span><span class="id"> g}</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">{in</span><span class="id"> `[f</span><span class="id"> b,</span><span class="id"> f</span><span class="id"> a],</span><span class="id"> cancel</span><span class="id"> g</span><span class="id"> f}</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> aLb</span><span class="id"> fct</span><span class="id"> fK</span><span class="id"> x</span><span class="id"> xfafb;</span><span class="id"> apply:</span> (<span class="id">segment_continuous_can_sym</span><span class="id"> aLb</span><span class="id"> fct</span><span class="id"> fK</span>).<br/>
<span class="id">have</span><span class="id"> :</span><span class="id"> f</span><span class="id"> a</span><span class="id"> &gt;=</span><span class="id"> f</span><span class="id"> b</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span> (<span class="id">itvP</span><span class="id"> xfafb</span>).<br/>
<span class="gallina-kwd">by</span><span class="id"> case:</span><span class="id"> ltrgtP</span><span class="id"> xfafb</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> -&gt;</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> segment_inc_surj_continuous</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span><span class="id"> :</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">{in</span><span class="id"> `[a,</span><span class="id"> b]</span><span class="id"> &amp;,</span><span class="id"> {mono</span><span class="id"> f</span><span class="id"> :</span><span class="id"> x</span><span class="id"> y</span><span class="id"> /</span><span class="id"> x</span><span class="id"> &lt;=</span><span class="id"> y}}</span><span class="id"> -&gt;</span><span class="id"> set_surj</span><span class="id"> `[a,</span><span class="id"> b]</span><span class="id"> `[f</span><span class="id"> a,</span><span class="id"> f</span><span class="id"> b]</span><span class="id"> f</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">{within</span><span class="id"> `[a,</span><span class="id"> b],</span><span class="id"> continuous</span><span class="id"> f}</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> fle</span><span class="id"> f_surj;</span><span class="id"> have</span><span class="id"> [f_inj</span><span class="id"> flt]</span><span class="id"> :=</span> (<span class="id">inc_inj_in</span><span class="id"> fle,</span><span class="id"> leW_mono_in</span><span class="id"> fle</span>).<br/>
<span class="id">have</span><span class="id"> [aLb|bLa|]</span><span class="id"> :=</span><span class="id"> ltgtP</span><span class="id"> a</span><span class="id"> b;</span><span class="id"> first</span><span class="id"> last</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> -&gt;;</span><span class="id"> rewrite</span><span class="id"> set_itv1;</span><span class="id"> exact:</span><span class="id"> continuous_subspace1</span>.<br/>
<span class="id">-</span><span class="id"> rewrite</span><span class="id"> continuous_subspace_in</span><span class="id"> =&gt;</span><span class="id"> z</span><span class="id"> /set_mem</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> in_itv</span><span class="id"> /=</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> /andP[/le_trans]</span><span class="id"> /[apply];</span><span class="id"> rewrite</span><span class="id"> leNgt</span><span class="id"> bLa</span>.<br/>
<span class="id">have</span><span class="id"> le_ab</span><span class="id"> :</span><span class="id"> a</span><span class="id"> &lt;=</span><span class="id"> b</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> ltW</span>.<br/>
<span class="id">have</span><span class="id"> [aab</span><span class="id"> bab]</span><span class="id"> :</span><span class="id"> a</span><span class="id"> \in</span><span class="id"> `[a,</span><span class="id"> b]</span><span class="id"> /\</span><span class="id"> b</span><span class="id"> \in</span><span class="id"> `[a,</span><span class="id"> b]</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> !bound_itvE</span><span class="id"> ltW</span>.<br/>
<span class="id">have</span><span class="id"> fab</span><span class="id"> :</span><span class="id"> f</span><span class="id"> @`</span><span class="id"> `[a,</span><span class="id"> b]</span><span class="id"> =</span><span class="id"> `[f</span><span class="id"> a,</span><span class="id"> f</span><span class="id"> b]%classic</span><span class="gallina-kwd"> by</span><span class="id"> exact:inc_surj_image_segment</span>.<br/>
<span class="id">pose</span><span class="id"> g</span><span class="id"> :=</span><span class="id"> pinv</span><span class="id"> `[a,</span><span class="id"> b]</span><span class="id"> f;</span><span class="id"> have</span><span class="id"> fK</span><span class="id"> :</span><span class="id"> {in</span><span class="id"> `[a,</span><span class="id"> b],</span><span class="id"> cancel</span><span class="id"> f</span><span class="id"> g}</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -[mem</span><span class="id"> _]mem_setE;</span><span class="id"> apply:</span><span class="id"> pinvKV;</span><span class="id"> rewrite</span><span class="id"> !mem_setE</span>.<br/>
<span class="id">have</span><span class="id"> gK</span><span class="id"> :</span><span class="id"> {in</span><span class="id"> `[f</span><span class="id"> a,</span><span class="id"> f</span><span class="id"> b],</span><span class="id"> cancel</span><span class="id"> g</span><span class="id"> f}</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> z</span><span class="id"> zab;</span><span class="id"> rewrite</span><span class="id"> pinvK//</span><span class="id"> fab</span><span class="id"> inE</span>.<br/>
<span class="id">have</span><span class="id"> gle</span><span class="id"> :</span><span class="id"> {in</span><span class="id"> `[f</span><span class="id"> a,</span><span class="id"> f</span><span class="id"> b]</span><span class="id"> &amp;,</span><span class="id"> {mono</span><span class="id"> g</span><span class="id"> :</span><span class="id"> x</span><span class="id"> y</span><span class="id"> /</span><span class="id"> x</span><span class="id"> &lt;=</span><span class="id"> y}}</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> can_mono_in</span> (<span class="id">fle</span>)<span class="id">;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> *;</span><span class="id"> rewrite</span><span class="id"> gK</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> z</span><span class="id"> zfab;</span><span class="id"> have</span><span class="id"> {zfab}</span><span class="id"> :</span><span class="id"> `[f</span><span class="id"> a,</span><span class="id"> f</span><span class="id"> b]%classic</span><span class="id"> z</span><span class="gallina-kwd"> by</span><span class="id"> []</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -fab</span><span class="id"> =&gt;</span><span class="id"> -[x</span><span class="id"> xab</span><span class="id"> &lt;-];</span><span class="id"> rewrite</span><span class="id"> fK</span>.<br/>
<span class="id">have</span><span class="id"> glt</span><span class="id"> :=</span><span class="id"> leW_mono_in</span><span class="id"> gle</span>.<br/>
<span class="id">rewrite</span><span class="id"> continuous_subspace_in</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> xab</span>.<br/>
<span class="id">have</span><span class="id"> xabcc</span><span class="id"> :</span><span class="id"> x</span><span class="id"> \in</span><span class="id"> `[a,</span><span class="id"> b]</span><span class="gallina-kwd"> by</span><span class="id"> move:</span><span class="id"> xab;</span><span class="id"> rewrite</span><span class="id"> mem_setE</span>.<br/>
<span class="id">have</span><span class="id"> fxab</span><span class="id"> :</span><span class="id"> f</span><span class="id"> x</span><span class="id"> \in</span><span class="id"> `[f</span><span class="id"> a,</span><span class="id"> f</span><span class="id"> b]</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> in_itv/=</span><span class="id"> !fle</span>.<br/>
<span class="id">have</span><span class="id"> :=</span><span class="id"> xabcc;</span><span class="id"> rewrite</span><span class="id"> in_itv</span><span class="id"> //=</span><span class="id"> =&gt;</span><span class="id"> /andP</span><span class="id"> [ax</span><span class="id"> xb]</span>.<br/>
<span class="id">apply/cvgrPdist_lt</span><span class="id"> =&gt;</span><span class="id"> _</span><span class="id"> /posnumP[e];</span><span class="id"> rewrite</span><span class="id"> !near_simpl;</span><span class="id"> near=&gt;</span><span class="id"> y</span>.<br/>
<span class="id">rewrite</span> (<span class="id">@le_lt_trans</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">e%:num</span><span class="id"> /</span><span class="id"> 2%:R</span>))<span class="id">//;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> ltr_pdivrMr//</span><span class="id"> ltr_pMr//</span><span class="id"> ltr1n</span>.<br/>
<span class="id">rewrite</span><span class="id"> ler_distlC;</span><span class="id"> near:</span><span class="id"> y</span>.<br/>
<span class="id">pose</span><span class="id"> u</span><span class="id"> :=</span><span class="id"> minr</span> (<span class="id">f</span><span class="id"> x</span><span class="id"> +</span><span class="id"> e%:num</span><span class="id"> /</span><span class="id"> 2</span>) (<span class="id">f</span><span class="id"> b</span>).<br/>
<span class="id">pose</span><span class="id"> l</span><span class="id"> :=</span><span class="id"> maxr</span> (<span class="id">f</span><span class="id"> x</span><span class="id"> -</span><span class="id"> e%:num</span><span class="id"> /</span><span class="id"> 2</span>) (<span class="id">f</span><span class="id"> a</span>).<br/>
<span class="id">have</span><span class="id"> ufab</span><span class="id"> :</span><span class="id"> u</span><span class="id"> \in</span><span class="id"> `[f</span><span class="id"> a,</span><span class="id"> f</span><span class="id"> b]</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> !in_itv</span><span class="id"> /=</span><span class="id"> ge_min</span><span class="id"> ?le_min</span><span class="id"> lexx</span><span class="id"> ?fle</span><span class="id"> //</span><span class="id"> le_ab</span><span class="id"> orbT</span><span class="id"> ?andbT</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> ler_wpDr</span><span class="id"> //</span><span class="id"> fle</span>.<br/>
<span class="id">have</span><span class="id"> lfab</span><span class="id"> :</span><span class="id"> l</span><span class="id"> \in</span><span class="id"> `[f</span><span class="id"> a,</span><span class="id"> f</span><span class="id"> b]</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> !in_itv/=</span><span class="id"> ge_max</span><span class="id"> ?le_max</span><span class="id"> lexx</span><span class="id"> ?fle//</span><span class="id"> le_ab</span><span class="id"> orbT</span><span class="id"> ?andbT</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> lerBlDr</span><span class="id"> ler_wpDr//</span><span class="id"> fle</span><span class="id"> //</span><span class="id"> lexx</span>.<br/>
<span class="id">have</span><span class="id"> guab</span><span class="id"> :</span><span class="id"> g</span><span class="id"> u</span><span class="id"> \in</span><span class="id"> `[a,</span><span class="id"> b]</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> !in_itv;</span><span class="id"> apply/andP;</span><span class="id"> split;</span><span class="id"> have</span><span class="id"> :=</span><span class="id"> ufab;</span><span class="id"> rewrite</span><span class="id"> in_itv</span><span class="id"> =&gt;</span><span class="id"> /andP</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> case;</span><span class="id"> rewrite</span><span class="id"> /=</span><span class="id"> -[f</span><span class="id"> _</span><span class="id"> &lt;=</span><span class="id"> _]gle</span><span class="id"> //</span><span class="id"> ?fK</span><span class="id"> //</span><span class="id"> bound_itvE</span><span class="id"> fle</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> case</span><span class="id"> =&gt;</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> /=</span><span class="id"> -[_</span><span class="id"> &lt;=</span><span class="id"> f</span><span class="id"> _]gle</span><span class="id"> //</span><span class="id"> ?fK</span><span class="id"> //</span><span class="id"> bound_itvE</span><span class="id"> fle</span>.<br/>
<span class="id">have</span><span class="id"> glab</span><span class="id"> :</span><span class="id"> g</span><span class="id"> l</span><span class="id"> \in</span><span class="id"> `[a,</span><span class="id"> b]</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> !in_itv;</span><span class="id"> apply/andP;</span><span class="id"> split;</span><span class="id"> have</span><span class="id"> :=</span><span class="id"> lfab;</span><span class="id"> rewrite</span><span class="id"> in_itv</span><span class="id"> /=</span><span class="id"> =&gt;</span><span class="id"> /andP</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> case;</span><span class="id"> rewrite</span><span class="id"> -[f</span><span class="id"> _</span><span class="id"> &lt;=</span><span class="id"> _]gle</span><span class="id"> //</span><span class="id"> ?fK</span><span class="id"> //</span><span class="id"> bound_itvE</span><span class="id"> fle</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> case</span><span class="id"> =&gt;</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> -[_</span><span class="id"> &lt;=</span><span class="id"> f</span><span class="id"> _]gle</span><span class="id"> //</span><span class="id"> ?fK</span><span class="id"> //</span><span class="id"> bound_itvE</span><span class="id"> fle</span>.<br/>
<span class="id">have</span><span class="id"> faltu</span><span class="id"> :</span><span class="id"> f</span><span class="id"> a</span><span class="id"> &lt;</span><span class="id"> u</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> /u</span><span class="id"> comparable_lt_min</span><span class="id"> ?real_comparable</span><span class="id"> ?num_real//</span><span class="id"> flt//</span><span class="id"> aLb</span><span class="id"> andbT</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span> (<span class="id">@le_lt_trans</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> x</span>))<span class="id"> ?fle//</span><span class="id"> ltrDl</span>.<br/>
<span class="id">have</span><span class="id"> lltfb</span><span class="id"> :</span><span class="id"> l</span><span class="id"> &lt;</span><span class="id"> f</span><span class="id"> b</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> /u</span><span class="id"> comparable_gt_max</span><span class="id"> ?real_comparable</span><span class="id"> ?num_real//</span><span class="id"> flt//</span><span class="id"> aLb</span><span class="id"> andbT</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span> (<span class="id">@lt_le_trans</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> x</span>))<span class="id"> ?fle//</span><span class="id"> ltrBlDr</span><span class="id"> ltrDl</span>.<br/>
<span class="id">case:</span><span class="id"> pselect</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> near_withinE;</span><span class="id"> near_simpl</span>.<br/>
<span class="id">have</span><span class="id"> Fnbhs</span><span class="id"> :</span><span class="id"> Filter</span> (<span class="id">nbhs</span><span class="id"> x</span>)<span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> nbhs_filter</span>.<br/>
<span class="id">have</span><span class="id"> :=</span><span class="id"> ax;</span><span class="id"> rewrite</span><span class="id"> le_eqVlt</span><span class="id"> =&gt;</span><span class="id"> /orP[/eqP|]</span><span class="id"> {}ax</span>.<br/>
&nbsp;&nbsp;<span class="id">near=&gt;</span><span class="id"> y</span><span class="id"> =&gt;</span><span class="id"> /[dup]</span><span class="id"> yab;</span><span class="id"> rewrite</span><span class="id"> /=</span><span class="id"> in_itv</span><span class="id"> =&gt;</span><span class="id"> /andP[ay</span><span class="id"> yb];</span><span class="id"> apply/andP;</span><span class="id"> split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span> (<span class="id">@le_trans</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> a</span>))<span class="id"> ?fle//</span><span class="id"> lerBlDr</span><span class="id"> ax</span><span class="id"> ler_wpDr</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> ltW;</span><span class="id"> suff</span><span class="id"> :</span><span class="id"> f</span><span class="id"> y</span><span class="id"> &lt;</span><span class="id"> u</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> lt_min</span><span class="id"> =&gt;</span><span class="id"> /andP[-&gt;]</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -?[f</span><span class="id"> y</span><span class="id"> &lt;</span><span class="id"> _]glt//</span><span class="id"> ?fK//;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> in_itv</span><span class="id"> /=</span><span class="id"> !fle</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> near:</span><span class="id"> y;</span><span class="id"> near_simpl;</span><span class="id"> apply:</span><span class="id"> open_lt;</span><span class="id"> rewrite</span><span class="id"> /=</span><span class="id"> -flt</span><span class="id"> ?gK//</span><span class="id"> -ax</span>.<br/>
<span class="id">have</span><span class="id"> :=</span><span class="id"> xb;</span><span class="id"> rewrite</span><span class="id"> le_eqVlt</span><span class="id"> =&gt;</span><span class="id"> /orP[/eqP</span><span class="id"> {}xb</span><span class="id"> {ax}|{}xb]</span>.<br/>
&nbsp;&nbsp;<span class="id">near=&gt;</span><span class="id"> y</span><span class="id"> =&gt;</span><span class="id"> /[dup]</span><span class="id"> yab;</span><span class="id"> rewrite</span><span class="id"> /=</span><span class="id"> in_itv</span><span class="id"> /=</span><span class="id"> =&gt;</span><span class="id"> /andP[ay</span><span class="id"> yb]</span>.<br/>
&nbsp;&nbsp;<span class="id">apply/andP;</span><span class="id"> split;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span> (<span class="id">@le_trans</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> b</span>))<span class="id"> ?fle//</span><span class="id"> xb</span><span class="id"> ler_wpDr</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> ltW;</span><span class="id"> suff</span><span class="id"> :</span><span class="id"> l</span><span class="id"> &lt;</span><span class="id"> f</span><span class="id"> y</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> gt_max</span><span class="id"> =&gt;</span><span class="id"> /andP[-&gt;]</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -?[_</span><span class="id"> &lt;</span><span class="id"> f</span><span class="id"> y]glt//</span><span class="id"> ?fK//;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> in_itv</span><span class="id"> /=</span><span class="id"> !fle</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> near:</span><span class="id"> y;</span><span class="id"> near_simpl;</span><span class="id"> apply:</span><span class="id"> open_gt;</span><span class="id"> rewrite</span><span class="id"> /=</span><span class="id"> -flt//</span><span class="id"> gK//</span><span class="id"> xb</span>.<br/>
<span class="id">have</span><span class="id"> xoab</span><span class="id"> :</span><span class="id"> x</span><span class="id"> \in</span><span class="id"> `]a,</span><span class="id"> b[</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> in_itv</span><span class="id"> /=;</span><span class="id"> apply/andP;</span><span class="id"> split</span>.<br/>
<span class="id">near=&gt;</span><span class="id"> y;</span><span class="id"> suff:</span><span class="id"> l</span><span class="id"> &lt;=</span><span class="id"> f</span><span class="id"> y</span><span class="id"> &lt;=</span><span class="id"> u</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> ge_max</span><span class="id"> le_min</span><span class="id"> -!andbA</span><span class="id"> =&gt;</span><span class="id"> /and4P[-&gt;</span><span class="id"> _</span><span class="id"> -&gt;]</span>.<br/>
<span class="id">have</span><span class="id"> ?</span><span class="id"> :</span><span class="id"> y</span><span class="id"> \in</span><span class="id"> `[a,</span><span class="id"> b]</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> subset_itv_oo_cc;</span><span class="id"> near:</span><span class="id"> y;</span><span class="id"> exact:</span><span class="id"> near_in_itvoo</span>.<br/>
<span class="id">have</span><span class="id"> fyab</span><span class="id"> :</span><span class="id"> f</span><span class="id"> y</span><span class="id"> \in</span><span class="id"> `[f</span><span class="id"> a,</span><span class="id"> f</span><span class="id"> b]</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> in_itv/=</span><span class="id"> !fle//</span><span class="id"> ?ltW</span>.<br/>
<span class="id">rewrite</span><span class="id"> -[l</span><span class="id"> &lt;=</span><span class="id"> _]gle</span><span class="id"> -?[_</span><span class="id"> &lt;=</span><span class="id"> u]gle//</span><span class="id"> ?fK</span><span class="id"> //</span>.<br/>
<span class="id">apply:</span><span class="id"> subset_itv_oo_cc;</span><span class="id"> near:</span><span class="id"> y;</span><span class="id"> apply:</span><span class="id"> near_in_itvoo;</span><span class="id"> rewrite</span><span class="id"> in_itv</span><span class="id"> /=</span>.<br/>
<span class="id">rewrite</span><span class="id"> -[x]fK</span><span class="id"> //</span><span class="id"> !glt//=</span><span class="id"> lt_min</span><span class="id"> gt_max</span><span class="id"> ?andbT</span><span class="id"> ltrBlDr</span><span class="id"> ltr_pwDr</span><span class="id"> //</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply/and3P;</span><span class="id"> split;</span><span class="id"> rewrite</span><span class="id"> //</span><span class="id"> flt</span>.<br/>
<span class="id">Unshelve</span>.<span class="id"> all:</span><span class="gallina-kwd"> by</span><span class="id"> end_near</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> segment_dec_surj_continuous</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span><span class="id"> :</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">{in</span><span class="id"> `[a,</span><span class="id"> b]</span><span class="id"> &amp;,</span><span class="id"> {mono</span><span class="id"> f</span><span class="id"> :</span><span class="id"> x</span><span class="id"> y</span><span class="id"> /~</span><span class="id"> x</span><span class="id"> &lt;=</span><span class="id"> y}}</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">set_surj</span><span class="id"> `[a,</span><span class="id"> b]</span><span class="id"> `[f</span><span class="id"> b,</span><span class="id"> f</span><span class="id"> a]</span><span class="id"> f</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">{within</span><span class="id"> `[a,</span><span class="id"> b],</span><span class="id"> continuous</span><span class="id"> f}</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> fge</span><span class="id"> f_surj;</span><span class="id"> suff:</span><span class="id"> {within</span><span class="id"> `[a,</span><span class="id"> b],</span><span class="id"> continuous</span> (<span class="id">-</span><span class="id"> f</span>)<span class="id">}</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> contNf</span><span class="id"> x</span><span class="id"> xab;</span><span class="id"> rewrite</span><span class="id"> -[f]opprK</span>.<br/>
&nbsp;&nbsp;<span class="id">exact/continuous_comp/opp_continuous/contNf</span>.<br/>
<span class="id">apply:</span><span class="id"> segment_inc_surj_continuous</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> y</span><span class="id"> xab</span><span class="id"> yab;</span><span class="id"> rewrite</span><span class="id"> lerN2</span><span class="id"> fge</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> y</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> -oppr_itvcc</span><span class="id"> =&gt;</span><span class="id"> /f_surj[x</span><span class="id"> ?</span><span class="id"> /</span>(<span class="id">canLR</span><span class="id"> opprK</span>)<span class="id">&lt;-];</span><span class="gallina-kwd"> exists</span><span class="id"> x</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> segment_mono_surj_continuous</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span><span class="id"> :</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">monotonous</span><span class="id"> `[a,</span><span class="id"> b]</span><span class="id"> f</span><span class="id"> -&gt;</span><span class="id"> set_surj</span><span class="id"> `[a,</span><span class="id"> b]</span> (<span class="id">f</span><span class="id"> @`[a,</span><span class="id"> b]</span>)<span class="id"> f</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">{within</span><span class="id"> `[a,</span><span class="id"> b],</span><span class="id"> continuous</span><span class="id"> f}</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> continuous_subspace_in</span><span class="id"> =&gt;</span><span class="id"> -[fle|fge]</span><span class="id"> f_surj</span><span class="id"> x</span><span class="id"> /set_mem</span><span class="id"> /=</span><span class="id"> xab</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> leab</span><span class="id"> :</span><span class="id"> a</span><span class="id"> &lt;=</span><span class="id"> b</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span> (<span class="id">itvP</span><span class="id"> xab</span>).<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> fafb</span><span class="id"> :</span><span class="id"> f</span><span class="id"> a</span><span class="id"> &lt;=</span><span class="id"> f</span><span class="id"> b</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> fle</span><span class="id"> //</span><span class="id"> ?bound_itvE</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> segment_inc_surj_continuous</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> case:</span><span class="id"> ltrP</span><span class="id"> f_surj</span><span class="id"> fafb</span>.<br/>
<span class="id">have</span><span class="id"> leab</span><span class="id"> :</span><span class="id"> a</span><span class="id"> &lt;=</span><span class="id"> b</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span> (<span class="id">itvP</span><span class="id"> xab</span>).<br/>
<span class="id">have</span><span class="id"> fafb</span><span class="id"> :</span><span class="id"> f</span><span class="id"> b</span><span class="id"> &lt;=</span><span class="id"> f</span><span class="id"> a</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> fge</span><span class="id"> //</span><span class="id"> ?bound_itvE</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> segment_dec_surj_continuous</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> case:</span><span class="id"> ltrP</span><span class="id"> f_surj</span><span class="id"> fafb</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> segment_can_le_continuous</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span><span class="id"> g</span><span class="id"> :</span><span class="id"> a</span><span class="id"> &lt;=</span><span class="id"> b</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">{within</span><span class="id"> `[a,</span><span class="id"> b],</span><span class="id"> continuous</span><span class="id"> f}</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">{in</span><span class="id"> `[a,</span><span class="id"> b],</span><span class="id"> cancel</span><span class="id"> f</span><span class="id"> g}</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">{within</span><span class="id"> `[</span>(<span class="id">f</span><span class="id"> a</span>)<span class="id">,</span> (<span class="id">f</span><span class="id"> b</span>)<span class="id">],</span><span class="id"> continuous</span><span class="id"> g}</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> aLb</span><span class="id"> ctf;</span><span class="id"> rewrite</span><span class="id"> continuous_subspace_in</span><span class="id"> =&gt;</span><span class="id"> fK</span><span class="id"> x</span><span class="id"> /set_mem</span><span class="id"> /=</span><span class="id"> xab</span>.<br/>
<span class="id">have</span><span class="id"> faLfb</span><span class="id"> :</span><span class="id"> f</span><span class="id"> a</span><span class="id"> &lt;=</span><span class="id"> f</span><span class="id"> b</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span> (<span class="id">itvP</span><span class="id"> xab</span>).<br/>
<span class="id">apply:</span><span class="id"> segment_inc_surj_continuous;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> segment_can_le</span>.<br/>
<span class="id">rewrite</span><span class="id"> !fK</span><span class="id"> ?bound_itvE//=;</span><span class="id"> apply:</span> (<span class="id">@can_surj</span><span class="id"> _</span><span class="id"> _</span><span class="id"> f</span>)<span class="id">;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> mem_setE</span>.<br/>
<span class="id">exact/image_subP/mem_inc_segment/segment_continuous_inj_le/</span>(<span class="id">can_in_inj</span><span class="id"> fK</span>).<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> segment_can_ge_continuous</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span><span class="id"> g</span><span class="id"> :</span><span class="id"> a</span><span class="id"> &lt;=</span><span class="id"> b</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">{within</span><span class="id"> `[a,</span><span class="id"> b],</span><span class="id"> continuous</span><span class="id"> f}</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">{in</span><span class="id"> `[a,</span><span class="id"> b],</span><span class="id"> cancel</span><span class="id"> f</span><span class="id"> g}</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">{within</span><span class="id"> `[</span>(<span class="id">f</span><span class="id"> b</span>)<span class="id">,</span> (<span class="id">f</span><span class="id"> a</span>)<span class="id">],</span><span class="id"> continuous</span><span class="id"> g}</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> aLb</span><span class="id"> ctf;</span><span class="id"> rewrite</span><span class="id"> continuous_subspace_in</span><span class="id"> =&gt;</span><span class="id"> fK</span><span class="id"> x</span><span class="id"> /set_mem</span><span class="id"> /=</span><span class="id"> xab</span>.<br/>
<span class="id">have</span><span class="id"> fbLfa</span><span class="id"> :</span><span class="id"> f</span><span class="id"> b</span><span class="id"> &lt;=</span><span class="id"> f</span><span class="id"> a</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span> (<span class="id">itvP</span><span class="id"> xab</span>).<br/>
<span class="id">apply:</span><span class="id"> segment_dec_surj_continuous;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> segment_can_ge</span>.<br/>
<span class="id">rewrite</span><span class="id"> !fK</span><span class="id"> ?bound_itvE//=;</span><span class="id"> apply:</span> (<span class="id">@can_surj</span><span class="id"> _</span><span class="id"> _</span><span class="id"> f</span>)<span class="id">;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> mem_setE</span>.<br/>
<span class="id">exact/image_subP/mem_dec_segment/segment_continuous_inj_ge/</span>(<span class="id">can_in_inj</span><span class="id"> fK</span>).<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> segment_can_continuous</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span><span class="id"> g</span><span class="id"> :</span><span class="id"> a</span><span class="id"> &lt;=</span><span class="id"> b</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">{within</span><span class="id"> `[a,</span><span class="id"> b],</span><span class="id"> continuous</span><span class="id"> f}</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">{in</span><span class="id"> `[a,</span><span class="id"> b],</span><span class="id"> cancel</span><span class="id"> f</span><span class="id"> g}</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">{within</span><span class="id"> f</span><span class="id"> @`[a,</span><span class="id"> b],</span><span class="id"> continuous</span><span class="id"> g}</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> aLb</span><span class="id"> crf</span><span class="id"> fK</span><span class="id"> x;</span><span class="id"> case:</span><span class="id"> lerP</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> _;</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> [apply:</span><span class="id"> segment_can_ge_continuous|apply:</span><span class="id"> segment_can_le_continuous]</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> near_can_continuousAcan_sym</span><span class="id"> f</span><span class="id"> g</span> (<span class="id">x</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">{near</span><span class="id"> x,</span><span class="id"> cancel</span><span class="id"> f</span><span class="id"> g}</span><span class="id"> -&gt;</span><span class="id"> {near</span><span class="id"> x,</span><span class="id"> continuous</span><span class="id"> f}</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">{near</span><span class="id"> f</span><span class="id"> x,</span><span class="id"> continuous</span><span class="id"> g}</span><span class="id"> /\</span><span class="id"> {near</span><span class="id"> f</span><span class="id"> x,</span><span class="id"> cancel</span><span class="id"> g</span><span class="id"> f}</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> fK</span><span class="id"> fct;</span><span class="id"> near</span> (<span class="id">0</span><span class="id"> :</span><span class="id"> R</span>)<span class="id">^'+</span><span class="id"> =&gt;</span><span class="id"> e;</span><span class="id"> have</span><span class="id"> e_gt0</span><span class="id"> :</span><span class="id"> 0</span><span class="id"> &lt;</span><span class="id"> e</span><span class="gallina-kwd"> by</span><span class="id"> []</span>.<br/>
<span class="id">have</span><span class="id"> xBeLxDe</span><span class="id"> :</span><span class="id"> x</span><span class="id"> -</span><span class="id"> e</span><span class="id"> &lt;=</span><span class="id"> x</span><span class="id"> +</span><span class="id"> e</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> lerD2l</span><span class="id"> gt0_cp</span>.<br/>
<span class="id">have</span><span class="id"> fcte</span><span class="id"> :</span><span class="id"> {in</span><span class="id"> `[x</span><span class="id"> -</span><span class="id"> e,</span><span class="id"> x</span><span class="id"> +</span><span class="id"> e],</span><span class="id"> continuous</span><span class="id"> f}</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> near:</span><span class="id"> e;</span><span class="id"> apply/at_right_in_segment</span>.<br/>
<span class="id">have</span><span class="id"> fwcte</span><span class="id"> :</span><span class="id"> {within</span><span class="id"> `[x</span><span class="id"> -</span><span class="id"> e,</span><span class="id"> x</span><span class="id"> +</span><span class="id"> e],</span><span class="id"> continuous</span><span class="id"> f}</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> continuous_in_subspaceT</span><span class="id"> =&gt;</span><span class="id"> y</span><span class="id"> yI</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> fcte;</span><span class="id"> move/set_mem:</span><span class="id"> yI</span>.<br/>
<span class="id">have</span><span class="id"> fKe</span><span class="id"> :</span><span class="id"> {in</span><span class="id"> `[x</span><span class="id"> -</span><span class="id"> e,</span><span class="id"> x</span><span class="id"> +</span><span class="id"> e],</span><span class="id"> cancel</span><span class="id"> f</span><span class="id"> g}</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> near:</span><span class="id"> e;</span><span class="id"> apply/at_right_in_segment</span>.<br/>
<span class="id">have</span><span class="id"> nearfx</span><span class="id"> :</span><span class="id"> \forall</span><span class="id"> y</span><span class="id"> \near</span><span class="id"> f</span><span class="id"> x,</span><span class="id"> y</span><span class="id"> \in</span><span class="id"> f</span><span class="id"> @`]</span>(<span class="id">x</span><span class="id"> -</span><span class="id"> e</span>)<span class="id">,</span> (<span class="id">x</span><span class="id"> +</span><span class="id"> e</span>)<span class="id">[</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> near_in_itv;</span><span class="id"> apply:</span><span class="id"> mono_mem_image_itvoo;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> in_itv/=</span><span class="id"> -ltr_distlC</span><span class="id"> subrr</span><span class="id"> normr0</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> itv_continuous_inj_mono</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span> (<span class="id">@can_in_inj</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> g</span>)<span class="id">;</span><span class="id"> near:</span><span class="id"> e;</span><span class="id"> apply/at_right_in_segment</span>.<br/>
<span class="id">have</span><span class="id"> fxI</span><span class="id"> :</span><span class="id"> f</span><span class="id"> x</span><span class="id"> \in</span><span class="id"> f</span><span class="id"> @`]x</span><span class="id"> -</span><span class="id"> e,</span><span class="id"> x</span><span class="id"> +</span><span class="id"> e[</span><span class="gallina-kwd"> by</span><span class="id"> exact:</span> (<span class="id">nbhs_singleton</span><span class="id"> nearfx</span>).<br/>
<span class="id">split;</span><span class="id"> near=&gt;</span><span class="id"> y;</span><span class="id"> first</span><span class="id"> last</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> (<span class="id">@segment_continuous_can_sym</span> (<span class="id">x</span><span class="id"> -</span><span class="id"> e</span>) (<span class="id">x</span><span class="id"> +</span><span class="id"> e</span>))<span class="id">//</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> subset_itv_oo_cc;</span><span class="id"> near:</span><span class="id"> y</span>.<br/>
<span class="id">near:</span><span class="id"> y;</span><span class="id"> apply:</span> (<span class="id">filter_app</span><span class="id"> _</span><span class="id"> _</span><span class="id"> nearfx</span>)<span class="id">;</span><span class="id"> near_simpl;</span><span class="id"> near=&gt;</span><span class="id"> y</span><span class="id"> =&gt;</span><span class="id"> yfe</span>.<br/>
<span class="id">have</span><span class="id"> :</span><span class="id"> {within</span><span class="id"> f</span><span class="id"> @`]x</span><span class="id"> -</span><span class="id"> e,</span> (<span class="id">x</span><span class="id"> +</span><span class="id"> e</span>)<span class="id">[,</span><span class="id"> continuous</span><span class="id"> g}</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> continuous_subspaceW;</span><span class="id"> last</span><span class="id"> exact:</span> (<span class="id">segment_can_continuous</span><span class="id"> _</span><span class="id"> fwcte</span><span class="id"> _</span>).<br/>
&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> subset_itv_oo_cc</span>.<br/>
<span class="id">rewrite</span><span class="id"> continuous_open_subspace;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> apply;</span><span class="id"> exact:</span><span class="id"> mem_set</span>.<br/>
<span class="id">exact:</span><span class="id"> interval_open</span>.<br/>
<span class="id">Unshelve</span>.<span class="id"> all:</span><span class="gallina-kwd"> by</span><span class="id"> end_near</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> near_can_continuous</span><span class="id"> f</span><span class="id"> g</span> (<span class="id">x</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">{near</span><span class="id"> x,</span><span class="id"> cancel</span><span class="id"> f</span><span class="id"> g}</span><span class="id"> -&gt;</span><span class="id"> {near</span><span class="id"> x,</span><span class="id"> continuous</span><span class="id"> f}</span><span class="id"> -&gt;</span><span class="id"> {near</span><span class="id"> f</span><span class="id"> x,</span><span class="id"> continuous</span><span class="id"> g}</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> fK</span><span class="id"> fct;</span><span class="id"> have</span><span class="id"> []</span><span class="id"> :=</span><span class="id"> near_can_continuousAcan_sym</span><span class="id"> fK</span><span class="id"> fct</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> near_continuous_can_sym</span><span class="id"> f</span><span class="id"> g</span> (<span class="id">x</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">{near</span><span class="id"> x,</span><span class="id"> continuous</span><span class="id"> f}</span><span class="id"> -&gt;</span><span class="id"> {near</span><span class="id"> x,</span><span class="id"> cancel</span><span class="id"> f</span><span class="id"> g}</span><span class="id"> -&gt;</span><span class="id"> {near</span><span class="id"> f</span><span class="id"> x,</span><span class="id"> cancel</span><span class="id"> g</span><span class="id"> f}</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> fct</span><span class="id"> fK;</span><span class="id"> have</span><span class="id"> []</span><span class="id"> :=</span><span class="id"> near_can_continuousAcan_sym</span><span class="id"> fK</span><span class="id"> fct</span>. Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> real_inverse_functions</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> real_inverse_function_instances</span>.<br/>
<span class="vernacular">Variable</span><span class="id"> R</span><span class="id"> :</span><span class="id"> realType</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> exprn_continuous</span><span class="id"> n</span><span class="id"> :</span><span class="id"> continuous</span> (<span class="id">@GRing</span>.<span class="id">exp</span><span class="id"> R</span><span class="id"> ^~</span><span class="id"> n</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> x;</span><span class="id"> elim:</span><span class="id"> n=&gt;</span><span class="id"> [|n</span><span class="id"> /</span>(<span class="id">continuousM</span><span class="id"> cvg_id</span>)<span class="id"> ih];</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> cst_continuous</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /continuous_at</span><span class="id"> exprS;</span><span class="id"> under</span><span class="id"> eq_fun</span><span class="id"> do</span><span class="id"> rewrite</span><span class="id"> exprS;</span><span class="id"> exact:</span><span class="id"> ih</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> sqr_continuous</span><span class="id"> :</span><span class="id"> continuous</span> (<span class="id">@exprz</span><span class="id"> R</span><span class="id"> ^~</span><span class="id"> 2</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id"> exact:</span> (<span class="id">@exprn_continuous</span><span class="id"> 2%N</span>). Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> sqrt_continuous</span><span class="id"> :</span><span class="id"> continuous</span> (<span class="id">@Num</span>.<span class="id">sqrt</span><span class="id"> R</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> x;</span><span class="id"> case:</span> (<span class="id">ltrgtP</span><span class="id"> x</span><span class="id"> 0</span>)<span class="id"> =&gt;</span><span class="id"> [xlt0</span><span class="id"> |</span><span class="id"> xgt0</span><span class="id"> |</span><span class="id"> -&gt;]</span>.<br/>
<span class="id">-</span><span class="id"> apply:</span> (<span class="id">near_cst_continuous</span><span class="id"> 0</span>).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> near</span><span class="id"> do</span><span class="id"> rewrite</span><span class="id"> ltr0_sqrtr//;</span><span class="id"> apply:</span> (<span class="id">cvgr_lt</span><span class="id"> x</span>).<br/>
&nbsp;&nbsp;<span class="id">pose</span><span class="id"> I</span><span class="id"> b</span><span class="id"> :</span><span class="id"> set</span><span class="id"> R</span><span class="id"> :=</span><span class="id"> [set`</span><span class="id"> `]0</span><span class="id"> ^+</span><span class="id"> 2,</span><span class="id"> b</span><span class="id"> ^+</span><span class="id"> 2[]</span>.<br/>
&nbsp;&nbsp;<span class="id">suff</span><span class="id"> main</span><span class="id"> b</span><span class="id"> :</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> b</span><span class="id"> -&gt;</span><span class="id"> {in</span><span class="id"> I</span><span class="id"> b,</span><span class="id"> continuous</span> (<span class="id">@Num</span>.<span class="id">sqrt</span><span class="id"> R</span>)<span class="id">}</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">near</span><span class="id"> +oo_R</span><span class="id"> =&gt;</span><span class="id"> M;</span><span class="id"> apply:</span> (<span class="id">main</span><span class="id"> M</span>)<span class="id">;</span><span class="id"> rewrite</span><span class="id"> //</span><span class="id"> /I</span><span class="id"> !inE/=</span><span class="id"> in_itv/=</span><span class="id"> expr0n</span><span class="id"> xgt0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -ltr_sqrt</span><span class="id"> ?exprn_gt0//</span><span class="id"> sqrtr_sqr</span><span class="id"> gtr0_norm/=</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> b0;</span><span class="id"> rewrite</span><span class="id"> -continuous_open_subspace;</span><span class="id"> last</span><span class="id"> exact:</span><span class="id"> interval_open</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> continuous_subspaceW;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> subset_itv_oo_cc</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span> (<span class="id">@segment_can_le_continuous</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">@GRing</span>.<span class="id">exp</span><span class="id"> _^~</span><span class="id"> _</span>))<span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> continuous_subspaceT;</span><span class="id"> exact:</span><span class="id"> exprn_continuous</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> y</span><span class="id"> y0b;</span><span class="id"> rewrite</span><span class="id"> sqrtr_sqr</span><span class="id"> ger0_norm//</span> (<span class="id">itvP</span><span class="id"> y0b</span>).<br/>
<span class="id">-</span><span class="id"> rewrite</span><span class="id"> /continuous_at</span><span class="id"> sqrtr0;</span><span class="id"> apply/cvgr0Pnorm_lt</span><span class="id"> =&gt;</span><span class="id"> _</span><span class="id"> /posnumP[e];</span><span class="id"> near=&gt;</span><span class="id"> y</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> [ylt0|yge0]</span><span class="id"> :=</span><span class="id"> ltrP</span><span class="id"> y</span><span class="id"> 0;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> ltr0_sqrtr</span><span class="id"> ?normr0</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> ger0_norm</span><span class="id"> ?sqrtr_ge0//;</span><span class="id"> have:</span><span class="id"> `|y|</span><span class="id"> &lt;</span><span class="id"> e%:num</span><span class="id"> ^+</span><span class="id"> 2</span><span class="gallina-kwd"> by</span><span class="id"> []</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -ltr_sqrt//</span><span class="id"> ger0_norm//</span><span class="id"> sqrtr_sqr</span><span class="id"> ger0_norm</span>.<br/>
<span class="id">Unshelve</span>.<span class="id"> all:</span><span class="gallina-kwd"> by</span><span class="id"> end_near</span>. Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> real_inverse_function_instances</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> is_derive_inverse</span>.<br/>
<span class="vernacular">Variable</span><span class="id"> R</span><span class="id"> :</span><span class="id"> realType</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> is_derive1_caratheodory</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> R</span>) (<span class="id">x</span><span class="id"> a</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">is_derive</span><span class="id"> x</span><span class="id"> 1</span><span class="id"> f</span><span class="id"> a</span><span class="id"> &lt;-&gt;</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">exists</span><span class="id"> g,</span><span class="id"> [/\</span><span class="gallina-kwd"> forall</span><span class="id"> z,</span><span class="id"> f</span><span class="id"> z</span><span class="id"> -</span><span class="id"> f</span><span class="id"> x</span><span class="id"> =</span><span class="id"> g</span><span class="id"> z</span><span class="id"> *</span> (<span class="id">z</span><span class="id"> -</span><span class="id"> x</span>)<span class="id">,</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">{for</span><span class="id"> x,</span><span class="id"> continuous</span><span class="id"> g}</span><span class="id"> &amp;</span><span class="id"> g</span><span class="id"> x</span><span class="id"> =</span><span class="id"> a]</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">split</span><span class="id"> =&gt;</span><span class="id"> [Hd|[g</span><span class="id"> [fxE</span><span class="id"> Cg</span><span class="id"> gxE]]]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">exists</span> (<span class="gallina-kwd">fun</span><span class="id"> z</span><span class="id"> =&gt;</span><span class="gallina-kwd"> if</span><span class="id"> z</span><span class="id"> ==</span><span class="id"> x</span><span class="gallina-kwd"> then</span><span class="id"> a</span><span class="gallina-kwd"> else</span> (<span class="id">f</span>(<span class="id">z</span>)<span class="id"> -</span><span class="id"> f</span>(<span class="id">x</span>))<span class="id"> /</span> (<span class="id">z</span><span class="id"> -</span><span class="id"> x</span>))<span class="id">;</span><span class="id"> split</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> move=&gt;</span><span class="id"> z;</span><span class="id"> case:</span><span class="id"> eqP</span><span class="id"> =&gt;</span><span class="id"> [-&gt;|/eqP];</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> !subrr</span><span class="id"> mulr0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -subr_eq0</span><span class="id"> =&gt;</span><span class="id"> /divfK-&gt;</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> apply/continuous_withinNshiftx;</span><span class="id"> rewrite</span><span class="id"> eqxx</span><span class="id"> /=</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">pose</span><span class="id"> g1</span><span class="id"> h</span><span class="id"> :=</span> (<span class="id">h^-1</span><span class="id"> *:</span> ((<span class="id">f</span><span class="id"> \o</span><span class="id"> shift</span><span class="id"> x</span>)<span class="id"> h%:A</span><span class="id"> -</span><span class="id"> f</span><span class="id"> x</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">have</span><span class="id"> F1</span><span class="id"> :</span><span class="id"> g1</span><span class="id"> @</span><span class="id"> 0^'</span><span class="id"> --&gt;</span><span class="id"> a</span><span class="gallina-kwd"> by</span><span class="id"> case:</span><span class="id"> Hd</span><span class="id"> =&gt;</span><span class="id"> H1</span><span class="id"> &lt;-</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> cvg_trans</span><span class="id"> F1;</span><span class="id"> apply:</span><span class="id"> near_eq_cvg;</span><span class="id"> rewrite</span><span class="id"> /g1</span><span class="id"> !fctE</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">near=&gt;</span><span class="id"> i</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> ifN;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> addrK</span><span class="id"> mulrC</span><span class="id"> /=</span><span class="id"> [_%:A]mulr1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -subr_eq0</span><span class="id"> addrK</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> near:</span><span class="id"> i;</span><span class="id"> rewrite</span><span class="id"> near_withinE</span><span class="id"> /=</span><span class="id"> near_simpl;</span><span class="id"> near=&gt;</span><span class="id"> x1</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> eqxx</span>.<br/>
<span class="id">suff</span><span class="id"> Hf</span><span class="id"> :</span><span class="id"> h^-1</span><span class="id"> *:</span> ((<span class="id">f</span><span class="id"> \o</span><span class="id"> shift</span><span class="id"> x</span>)<span class="id"> h%:A</span><span class="id"> -</span><span class="id"> f</span><span class="id"> x</span>)<span class="id"> @[h</span><span class="id"> --&gt;</span><span class="id"> 0^']</span><span class="id"> --&gt;</span><span class="id"> a</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> F1</span><span class="id"> :</span><span class="id"> 'D_1</span><span class="id"> f</span><span class="id"> x</span><span class="id"> =</span><span class="id"> a</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> cvg_lim</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -F1</span><span class="gallina-kwd"> in</span><span class="id"> Hf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> constructor</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> F1</span><span class="id"> :</span>  (<span class="id">g</span><span class="id"> \o</span><span class="id"> shift</span><span class="id"> x</span>)<span class="id"> y</span><span class="id"> @[y</span><span class="id"> --&gt;</span><span class="id"> 0^']</span><span class="id"> --&gt;</span><span class="id"> a</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -gxE;</span><span class="id"> apply/continuous_withinNshiftx</span>.<br/>
<span class="id">apply:</span><span class="id"> cvg_trans</span><span class="id"> F1;</span><span class="id"> apply:</span><span class="id"> near_eq_cvg</span>.<br/>
<span class="id">near=&gt;</span><span class="id"> y</span>.<br/>
<span class="id">rewrite</span><span class="id"> /=</span><span class="id"> fxE</span><span class="id"> /=</span><span class="id"> addrK</span><span class="id"> [_%:A]mulr1</span>.<br/>
<span class="id">suff</span><span class="id"> yNZ</span><span class="id"> :</span><span class="id"> y</span><span class="id"> !=</span><span class="id"> 0</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> [RHS]mulrC</span><span class="id"> mulfK</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> near:</span><span class="id"> y;</span><span class="id"> rewrite</span><span class="id"> near_withinE</span><span class="id"> /=</span><span class="id"> near_simpl;</span><span class="id"> near=&gt;</span><span class="id"> x1</span>.<br/>
<span class="id">Unshelve</span>.<span class="id"> all:</span><span class="gallina-kwd"> by</span><span class="id"> end_near</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> is_derive_0_is_cst</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> R</span>)<span class="id"> x</span><span class="id"> y</span><span class="id"> :</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">forall</span><span class="id"> x,</span><span class="id"> is_derive</span><span class="id"> x</span> (<span class="id">1</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> f</span><span class="id"> 0</span>)<span class="id"> -&gt;</span><span class="id"> f</span><span class="id"> x</span><span class="id"> =</span><span class="id"> f</span><span class="id"> y</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> Hd</span>.<br/>
<span class="id">wlog</span><span class="id"> xLy</span><span class="id"> :</span><span class="id"> x</span><span class="id"> y</span><span class="id"> /</span><span class="id"> x</span><span class="id"> &lt;=</span><span class="id"> y</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> H;</span><span class="id"> case:</span> (<span class="id">leP</span><span class="id"> x</span><span class="id"> y</span>)<span class="id"> =&gt;</span><span class="id"> [/H</span><span class="id"> |/ltW</span><span class="id"> /H]</span>.<br/>
<span class="id">rewrite</span><span class="id"> -</span>(<span class="id">subKr</span> (<span class="id">f</span><span class="id"> y</span>) (<span class="id">f</span><span class="id"> x</span>)).<br/>
<span class="id">have</span><span class="id"> [|</span><span class="id"> _</span><span class="id"> _]</span><span class="id"> :=</span><span class="id"> MVT_segment</span><span class="id"> xLy;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> mul0r</span><span class="id"> =&gt;</span><span class="id"> -&gt;;</span><span class="id"> rewrite</span><span class="id"> subr0</span>.<br/>
<span class="id">apply/continuous_subspaceT=&gt;</span><span class="id"> r</span>.<br/>
<span class="id">exact/differentiable_continuous/derivable1_diffP</span>.<br/>
Qed.</div></details>
<br/>
<span class="id">Global</span><span class="vernacular"> Instance</span><span class="id"> is_derive1_comp</span> (<span class="id">f</span><span class="id"> g</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> R</span>) (<span class="id">x</span><span class="id"> a</span><span class="id"> b</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">is_derive</span> (<span class="id">g</span><span class="id"> x</span>)<span class="id"> 1</span><span class="id"> f</span><span class="id"> a</span><span class="id"> -&gt;</span><span class="id"> is_derive</span><span class="id"> x</span><span class="id"> 1</span><span class="id"> g</span><span class="id"> b</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">is_derive</span><span class="id"> x</span><span class="id"> 1</span> (<span class="id">f</span><span class="id"> \o</span><span class="id"> g</span>) (<span class="id">a</span><span class="id"> *</span><span class="id"> b</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> [fgxv</span><span class="id"> &lt;-{a}]</span><span class="id"> [gv</span><span class="id"> &lt;-{b}];</span><span class="id"> apply:</span> (<span class="id">@DeriveDef</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">f</span><span class="id"> \o</span><span class="id"> g</span>)).<br/>
&nbsp;&nbsp;<span class="id">apply/derivable1_diffP/differentiable_comp;</span><span class="id"> first</span><span class="id"> exact/derivable1_diffP</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move/derivable1_diffP</span><span class="gallina-kwd"> in</span><span class="id"> fgxv</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -derive1E</span> (<span class="id">derive1_comp</span><span class="id"> gv</span><span class="id"> fgxv</span>)<span class="id"> 2!derive1E</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> is_deriveV</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> R</span>) (<span class="id">x</span><span class="id"> t</span><span class="id"> v</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">f</span><span class="id"> x</span><span class="id"> !=</span><span class="id"> 0</span><span class="id"> -&gt;</span><span class="id"> is_derive</span><span class="id"> x</span><span class="id"> v</span><span class="id"> f</span><span class="id"> t</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">is_derive</span><span class="id"> x</span><span class="id"> v</span> (<span class="gallina-kwd">fun</span><span class="id"> y</span><span class="id"> =&gt;</span> (<span class="id">f</span><span class="id"> y</span>)<span class="id">^-1</span>) (<span class="id">-</span> (<span class="id">f</span><span class="id"> x</span>)<span class="id"> ^-</span><span class="id"> 2</span><span class="id"> *:</span><span class="id"> t</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> fxNZ</span><span class="id"> Df</span>.<br/>
<span class="id">constructor;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> derivableV</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> case:</span><span class="id"> Df</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> deriveV</span><span class="id"> //;</span><span class="id"> case:</span><span class="id"> Df</span><span class="id"> =&gt;</span><span class="id"> _</span><span class="id"> -&gt;</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> is_derive_inverse</span> (<span class="id">f</span><span class="id"> g</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> R</span>)<span class="id"> l</span><span class="id"> x</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">{near</span><span class="id"> x,</span><span class="id"> cancel</span><span class="id"> f</span><span class="id"> g}</span> <span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">{near</span><span class="id"> x,</span><span class="id"> continuous</span><span class="id"> f}</span> <span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">is_derive</span><span class="id"> x</span><span class="id"> 1</span><span class="id"> f</span><span class="id"> l</span><span class="id"> -&gt;</span><span class="id"> l</span><span class="id"> !=</span><span class="id"> 0</span><span class="id"> -&gt;</span><span class="id"> is_derive</span> (<span class="id">f</span><span class="id"> x</span>)<span class="id"> 1</span><span class="id"> g</span><span class="id"> l^-1</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> fgK</span><span class="id"> fC</span><span class="id"> fD</span><span class="id"> lNZ</span>.<br/>
<span class="id">have</span><span class="id"> /is_derive1_caratheodory</span><span class="id"> [h</span><span class="id"> [fE</span><span class="id"> hC</span><span class="id"> hxE]]</span><span class="id"> :=</span><span class="id"> fD</span>.<br/>
<span class="comment">(*&nbsp;There&nbsp;should&nbsp;be&nbsp;something&nbsp;simpler&nbsp;*)</span><br/>
<span class="id">have</span><span class="id"> gfxE</span><span class="id"> :</span><span class="id"> g</span> (<span class="id">f</span><span class="id"> x</span>)<span class="id"> =</span><span class="id"> x</span><span class="gallina-kwd"> by</span><span class="id"> have</span><span class="id"> [d</span><span class="id"> Hd]:=</span><span class="id"> nbhs_ex</span><span class="id"> fgK;</span><span class="id"> apply:</span><span class="id"> Hd</span>.<br/>
<span class="id">pose</span><span class="id"> g1</span><span class="id"> y</span><span class="id"> :=</span><span class="gallina-kwd"> if</span><span class="id"> y</span><span class="id"> ==</span><span class="id"> f</span><span class="id"> x</span><span class="gallina-kwd"> then</span> (<span class="id">h</span> (<span class="id">g</span><span class="id"> y</span>))<span class="id">^-1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">else</span> (<span class="id">g</span><span class="id"> y</span><span class="id"> -</span><span class="id"> g</span> (<span class="id">f</span><span class="id"> x</span>))<span class="id"> /</span> (<span class="id">y</span><span class="id"> -</span><span class="id"> f</span><span class="id"> x</span>).<br/>
<span class="id">apply/is_derive1_caratheodory</span>.<br/>
<span class="gallina-kwd">exists</span><span class="id"> g1;</span><span class="id"> split;</span><span class="id"> first</span><span class="id"> 2</span><span class="id"> last</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> /g1</span><span class="id"> eqxx</span><span class="id"> gfxE</span><span class="id"> hxE</span>.<br/>
<span class="id">-</span><span class="id"> move=&gt;</span><span class="id"> z;</span><span class="id"> rewrite</span><span class="id"> /g1;</span><span class="id"> case:</span><span class="id"> eqP</span><span class="id"> =&gt;</span><span class="id"> [-&gt;|/eqP];</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> !subrr</span><span class="id"> mulr0</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -subr_eq0</span><span class="id"> =&gt;</span><span class="id"> /divfK</span>.<br/>
<span class="id">have</span><span class="id"> F1</span><span class="id"> :</span> (<span class="id">h</span> (<span class="id">g</span><span class="id"> x</span>))<span class="id">^-1</span><span class="id"> @[x</span><span class="id"> --&gt;</span><span class="id"> f</span><span class="id"> x]</span><span class="id"> --&gt;</span><span class="id"> g1</span> (<span class="id">f</span><span class="id"> x</span>).<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> /g1</span><span class="id"> eqxx;</span><span class="id"> apply:</span><span class="id"> continuousV;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> /=</span><span class="id"> gfxE</span><span class="id"> hxE</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> continuous_comp;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> gfxE</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> nbhs_singleton</span> (<span class="id">near_can_continuous</span><span class="id"> _</span><span class="id"> _</span>).<br/>
<span class="id">apply:</span><span class="id"> cvg_sub0</span><span class="id"> F1</span>.<br/>
<span class="id">apply/cvgrPdist_lt</span><span class="id"> =&gt;</span><span class="id"> eps</span><span class="id"> eps_gt0</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> !near_simpl</span><span class="id"> /=</span>.<br/>
<span class="id">near=&gt;</span><span class="id"> y;</span><span class="id"> rewrite</span><span class="id"> sub0r</span><span class="id"> normrN</span><span class="id"> !fctE</span>.<br/>
<span class="id">have</span><span class="id"> fgyE</span><span class="id"> :</span><span class="id"> f</span> (<span class="id">g</span><span class="id"> y</span>)<span class="id"> =</span><span class="id"> y</span><span class="gallina-kwd"> by</span><span class="id"> near:</span><span class="id"> y;</span><span class="id"> apply:</span><span class="id"> near_continuous_can_sym</span>.<br/>
<span class="id">rewrite</span><span class="id"> /g1;</span><span class="id"> case:</span><span class="id"> eqP</span><span class="id"> =&gt;</span><span class="id"> [_|/eqP</span><span class="id"> x1Dfx];</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> subrr</span><span class="id"> normr0</span>.<br/>
<span class="id">have</span><span class="id"> -&gt;</span><span class="id"> :</span><span class="id"> y</span><span class="id"> -</span><span class="id"> f</span><span class="id"> x</span> <span class="id"> =</span><span class="id"> h</span> (<span class="id">g</span><span class="id"> y</span>)<span class="id"> *</span> (<span class="id">g</span><span class="id"> y</span><span class="id"> -</span><span class="id"> x</span>)<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> -fE</span><span class="id"> fgyE</span>.<br/>
<span class="id">rewrite</span><span class="id"> gfxE</span><span class="id"> invfM</span><span class="id"> mulrC</span><span class="id"> divfK</span><span class="id"> ?subrr</span><span class="id"> ?normr0</span><span class="id"> //</span><span class="id"> subr_eq0</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> contra</span><span class="id"> x1Dfx</span><span class="id"> =&gt;</span><span class="id"> /eqP&lt;-;</span><span class="id"> apply/eqP</span>.<br/>
<span class="id">Unshelve</span>.<span class="id"> all:</span><span class="gallina-kwd"> by</span><span class="id"> end_near</span>. Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> is_derive_inverse</span>.<br/>
<br/>
<span class="id">#[global]</span><span class="vernacular"> Hint</span><span class="id"> Extern</span><span class="id"> 0</span> (<span class="id">is_derive</span><span class="id"> _</span><span class="id"> _</span> (<span class="gallina-kwd">fun</span><span class="id"> _</span><span class="id"> =&gt;</span> (_<span class="id"> _</span>)<span class="id">^-1</span>)<span class="id"> _</span>)<span class="id"> =&gt;</span><br/>
&nbsp;&nbsp;(<span class="id">eapply</span><span class="id"> is_deriveV;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> []</span>)<span class="id"> :</span><span class="id"> typeclass_instances</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> interval_partition</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {R</span><span class="id"> :</span><span class="id"> realType}</span>.<br/>
<span class="vernacular">Implicit</span><span class="gallina-kwd"> Type</span> (<span class="id">a</span><span class="id"> b</span><span class="id"> :</span><span class="id"> R</span>) (<span class="id">s</span><span class="id"> :</span><span class="id"> seq</span><span class="id"> R</span>).<br/>
<br/>
<div class="doc">a :: s is a partition of the interval <span class="bracket"><span class="id">a</span>, <span class="id">b</span></span> </div>
<span class="vernacular">Definition</span><span class="id"> itv_partition</span><span class="id"> a</span><span class="id"> b</span><span class="id"> s</span><span class="id"> :=</span><span class="id"> [/\</span><span class="id"> path</span><span class="id"> &lt;%R</span><span class="id"> a</span><span class="id"> s</span><span class="id"> &amp;</span><span class="id"> last</span><span class="id"> a</span><span class="id"> s</span><span class="id"> ==</span><span class="id"> b]</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> itv_partition_nil</span><span class="id"> a</span><span class="id"> b</span><span class="id"> :</span><span class="id"> itv_partition</span><span class="id"> a</span><span class="id"> b</span><span class="id"> [::]</span><span class="id"> -&gt;</span><span class="id"> a</span><span class="id"> =</span><span class="id"> b</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> [_</span><span class="id"> /eqP</span><span class="id"> &lt;-]</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> itv_partition_cons</span><span class="id"> a</span><span class="id"> b</span><span class="id"> x</span><span class="id"> s</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">itv_partition</span><span class="id"> a</span><span class="id"> b</span> (<span class="id">x</span><span class="id"> ::</span><span class="id"> s</span>)<span class="id"> -&gt;</span><span class="id"> itv_partition</span><span class="id"> x</span><span class="id"> b</span><span class="id"> s</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> /itv_partition/=</span><span class="id"> =&gt;</span><span class="id"> -[/andP[]]</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> itv_partition1</span><span class="id"> a</span><span class="id"> b</span><span class="id"> :</span><span class="id"> a</span><span class="id"> &lt;</span><span class="id"> b</span><span class="id"> -&gt;</span><span class="id"> itv_partition</span><span class="id"> a</span><span class="id"> b</span><span class="id"> [::</span><span class="id"> b]</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> /itv_partition</span><span class="id"> /=</span><span class="id"> =&gt;</span><span class="id"> -&gt;</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> itv_partition_size_neq0</span><span class="id"> a</span><span class="id"> b</span><span class="id"> s</span><span class="id"> :</span><br/>
&nbsp;&nbsp;(<span class="id">size</span><span class="id"> s</span><span class="id"> &gt;</span><span class="id"> 0</span>)<span class="id">%N</span><span class="id"> -&gt;</span><span class="id"> itv_partition</span><span class="id"> a</span><span class="id"> b</span><span class="id"> s</span><span class="id"> -&gt;</span><span class="id"> a</span><span class="id"> &lt;</span><span class="id"> b</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">elim:</span><span class="id"> s</span><span class="id"> a</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> x</span><span class="id"> [_</span><span class="id"> a</span><span class="id"> _|h</span><span class="id"> t</span><span class="id"> ih</span><span class="id"> a</span><span class="id"> _];</span><span class="id"> rewrite</span><span class="id"> /itv_partition</span><span class="id"> /=</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> andbT</span><span class="id"> =&gt;</span><span class="id"> -[ax</span><span class="id"> /eqP</span><span class="id"> &lt;-]</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> []</span><span class="id"> /andP[ax</span><span class="id"> /andP[xy]</span><span class="id"> ht</span><span class="id"> /eqP</span><span class="id"> tb]</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span> (<span class="id">lt_trans</span><span class="id"> ax</span>)<span class="id">//</span><span class="id"> ih//</span><span class="id"> /itv_partition</span><span class="id"> /=</span><span class="id"> xy/=</span><span class="id"> tb</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> itv_partitionxx</span><span class="id"> a</span><span class="id"> s</span><span class="id"> :</span><span class="id"> itv_partition</span><span class="id"> a</span><span class="id"> a</span><span class="id"> s</span><span class="id"> -&gt;</span><span class="id"> s</span><span class="id"> =</span><span class="id"> [::]</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">case:</span><span class="id"> s</span><span class="id"> =&gt;</span><span class="id"> //=</span><span class="id"> h</span><span class="id"> t</span><span class="id"> [/=</span><span class="id"> /andP[ah</span><span class="id"> /lt_path_min/allP</span><span class="id"> ht]</span><span class="id"> /eqP</span><span class="id"> hta]</span>.<br/>
<span class="id">suff</span><span class="id"> :</span><span class="id"> h</span><span class="id"> &lt;</span><span class="id"> a</span><span class="gallina-kwd"> by</span><span class="id"> move/lt_trans</span><span class="id"> =&gt;</span><span class="id"> /</span>(_<span class="id"> _</span><span class="id"> ah</span>)<span class="id">;</span><span class="id"> rewrite</span><span class="id"> ltxx</span>.<br/>
<span class="id">apply/ht;</span><span class="id"> rewrite</span><span class="id"> -hta</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> have</span><span class="id"> :=</span><span class="id"> mem_last</span><span class="id"> h</span><span class="id"> t;</span><span class="id"> rewrite</span><span class="id"> inE</span><span class="id"> hta</span><span class="id"> lt_eqF</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> itv_partition_le</span><span class="id"> a</span><span class="id"> b</span><span class="id"> s</span><span class="id"> :</span><span class="id"> itv_partition</span><span class="id"> a</span><span class="id"> b</span><span class="id"> s</span><span class="id"> -&gt;</span><span class="id"> a</span><span class="id"> &lt;=</span><span class="id"> b</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">case:</span><span class="id"> s</span><span class="id"> =&gt;</span><span class="id"> [/itv_partition_nil</span><span class="id"> -&gt;//|h</span><span class="id"> t</span><span class="id"> /itv_partition_size_neq0</span><span class="id"> -</span><span class="id"> /</span>(_<span class="id"> _</span>)<span class="id">/ltW]</span>.<br/>
<span class="id">exact</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> itv_partition_cat</span><span class="id"> a</span><span class="id"> b</span><span class="id"> c</span><span class="id"> s</span><span class="id"> t</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">itv_partition</span><span class="id"> a</span><span class="id"> b</span><span class="id"> s</span><span class="id"> -&gt;</span><span class="id"> itv_partition</span><span class="id"> b</span><span class="id"> c</span><span class="id"> t</span><span class="id"> -&gt;</span><span class="id"> itv_partition</span><span class="id"> a</span><span class="id"> c</span> (<span class="id">s</span><span class="id"> ++</span><span class="id"> t</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> /itv_partition</span><span class="id"> =&gt;</span><span class="id"> -[sa</span><span class="id"> /eqP</span><span class="id"> asb]</span><span class="id"> [bt</span><span class="id"> btc]</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> cat_path//</span><span class="id"> sa</span><span class="id"> /=</span><span class="id"> last_cat</span><span class="id"> asb</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> itv_partition_nth_size</span><span class="id"> def</span><span class="id"> a</span><span class="id"> b</span><span class="id"> s</span><span class="id"> :</span><span class="id"> itv_partition</span><span class="id"> a</span><span class="id"> b</span><span class="id"> s</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">nth</span><span class="id"> def</span> (<span class="id">a</span><span class="id"> ::</span><span class="id"> s</span>) (<span class="id">size</span><span class="id"> s</span>)<span class="id"> =</span><span class="id"> b</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd">by</span><span class="id"> elim:</span><span class="id"> s</span><span class="id"> a</span><span class="id"> =&gt;</span><span class="id"> [a/=</span><span class="id"> /itv_partition_nil//|y</span><span class="id"> t</span><span class="id"> ih</span><span class="id"> a</span><span class="id"> /=</span><span class="id"> /itv_partition_cons/ih]</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> itv_partition_nth_ge</span><span class="id"> a</span><span class="id"> b</span><span class="id"> s</span><span class="id"> m</span><span class="id"> :</span> (<span class="id">m</span><span class="id"> &lt;</span> (<span class="id">size</span><span class="id"> s</span>).<span class="id">+1</span>)<span class="id">%N</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">itv_partition</span><span class="id"> a</span><span class="id"> b</span><span class="id"> s</span><span class="id"> -&gt;</span><span class="id"> a</span><span class="id"> &lt;=</span><span class="id"> nth</span><span class="id"> b</span> (<span class="id">a</span><span class="id"> ::</span><span class="id"> s</span>)<span class="id"> m</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">elim:</span><span class="id"> m</span><span class="id"> s</span><span class="id"> a</span><span class="id"> b</span><span class="id"> =&gt;</span><span class="id"> [s</span><span class="id"> a</span><span class="id"> b</span><span class="id"> _//|n</span><span class="id"> ih</span><span class="id"> [//|h</span><span class="id"> t]</span><span class="id"> a</span><span class="id"> b]</span>.<br/>
<span class="id">rewrite</span><span class="id"> ltnS</span><span class="id"> =&gt;</span><span class="id"> nh</span><span class="id"> [/=</span><span class="id"> /andP[ah</span><span class="id"> ht]</span><span class="id"> lb]</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span> (<span class="id">le_trans</span> (<span class="id">ltW</span><span class="id"> ah</span>))<span class="id">//</span><span class="id"> ih</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> itv_partition_nth_le</span><span class="id"> a</span><span class="id"> b</span><span class="id"> s</span><span class="id"> m</span><span class="id"> :</span> (<span class="id">m</span><span class="id"> &lt;</span> (<span class="id">size</span><span class="id"> s</span>).<span class="id">+1</span>)<span class="id">%N</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">itv_partition</span><span class="id"> a</span><span class="id"> b</span><span class="id"> s</span><span class="id"> -&gt;</span><span class="id"> nth</span><span class="id"> b</span> (<span class="id">a</span><span class="id"> ::</span><span class="id"> s</span>)<span class="id"> m</span><span class="id"> &lt;=</span><span class="id"> b</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">elim:</span><span class="id"> m</span><span class="id"> s</span><span class="id"> a</span><span class="id"> =&gt;</span><span class="id"> [s</span><span class="id"> a</span><span class="id"> _|n</span><span class="id"> ih];</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> itv_partition_le</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> [//|a</span><span class="id"> h</span><span class="id"> t</span><span class="id"> /=</span><span class="id"> nt]</span><span class="id"> H;</span><span class="id"> rewrite</span><span class="id"> ih//;</span><span class="id"> exact:</span><span class="id"> itv_partition_cons</span><span class="id"> H</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> nondecreasing_fun_itv_partition</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span><span class="id"> s</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">{in</span><span class="id"> `[a,</span><span class="id"> b]</span><span class="id"> &amp;,</span><span class="id"> nondecreasing_fun</span><span class="id"> f}</span><span class="id"> -&gt;</span><span class="id"> itv_partition</span><span class="id"> a</span><span class="id"> b</span><span class="id"> s</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">let</span><span class="id"> F</span><span class="id"> :</span><span class="id"> nat</span><span class="id"> -&gt;</span><span class="id"> R</span><span class="id"> :=</span><span class="id"> f</span><span class="id"> \o</span><span class="id"> nth</span><span class="id"> b</span> (<span class="id">a</span><span class="id"> ::</span><span class="id"> s</span>)<span class="gallina-kwd"> in</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">forall</span><span class="id"> k,</span> (<span class="id">k</span><span class="id"> &lt;</span><span class="id"> size</span><span class="id"> s</span>)<span class="id">%N</span><span class="id"> -&gt;</span><span class="id"> F</span><span class="id"> k</span><span class="id"> &lt;=</span><span class="id"> F</span><span class="id"> k</span>.<span class="id">+1</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> ndf</span><span class="id"> abs</span><span class="id"> F</span><span class="id"> k</span><span class="id"> ks</span>.<br/>
<span class="id">have</span><span class="id"> [_]</span><span class="id"> :=</span><span class="id"> nondecreasing_seqP</span><span class="id"> F;</span><span class="id"> apply</span><span class="id"> =&gt;</span><span class="id"> m</span><span class="id"> n</span><span class="id"> mn;</span><span class="id"> rewrite</span><span class="id"> /F/=</span>.<br/>
<span class="id">have</span><span class="id"> [ms|ms]</span><span class="id"> :=</span><span class="id"> ltnP</span><span class="id"> m</span> (<span class="id">size</span><span class="id"> s</span>).<span class="id">+1;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> nth_default//</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> [|ns]</span><span class="id"> :=</span><span class="id"> ltnP</span><span class="id"> n</span> (<span class="id">size</span><span class="id"> s</span>).<span class="id">+1;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> nth_default</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> /</span>(<span class="id">leq_ltn_trans</span><span class="id"> mn</span>)<span class="id">;</span><span class="id"> rewrite</span><span class="id"> ltnS</span><span class="id"> leqNgt</span><span class="id"> ms</span>.<br/>
<span class="id">have</span><span class="id"> [ns|ns]</span><span class="id"> :=</span><span class="id"> ltnP</span><span class="id"> n</span> (<span class="id">size</span><span class="id"> s</span>).<span class="id">+1;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> [in</span><span class="id"> leRHS]nth_default//=;</span><span class="id"> apply/ndf/itv_partition_nth_le</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> in_itv/=</span><span class="id"> itv_partition_nth_le//</span><span class="id"> andbT</span><span class="id"> itv_partition_nth_ge</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> in_itv/=</span><span class="id"> lexx</span><span class="id"> andbT;</span><span class="id"> exact:</span> (<span class="id">itv_partition_le</span><span class="id"> abs</span>).<br/>
<span class="id">move:</span><span class="id"> abs;</span><span class="id"> rewrite</span><span class="id"> /itv_partition</span><span class="id"> =&gt;</span><span class="id"> -[]</span><span class="id"> sa</span><span class="id"> sab</span>.<br/>
<span class="id">move:</span><span class="id"> mn;</span><span class="id"> rewrite</span><span class="id"> leq_eqVlt</span><span class="id"> =&gt;</span><span class="id"> /predU1P[-&gt;//|mn]</span>.<br/>
<span class="id">apply/ndf/ltW/sorted_ltn_nth</span><span class="id"> =&gt;</span><span class="id"> //=;</span><span class="id"> last</span><span class="id"> exact:</span><span class="id"> lt_trans</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> in_itv/=</span><span class="id"> itv_partition_nth_le//</span><span class="id"> andbT</span><span class="id"> itv_partition_nth_ge</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> in_itv/=</span><span class="id"> itv_partition_nth_le//</span><span class="id"> andbT</span><span class="id"> itv_partition_nth_ge</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> nonincreasing_fun_itv_partition</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span><span class="id"> s</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">{in</span><span class="id"> `[a,</span><span class="id"> b]</span><span class="id"> &amp;,</span><span class="id"> nonincreasing_fun</span><span class="id"> f}</span><span class="id"> -&gt;</span><span class="id"> itv_partition</span><span class="id"> a</span><span class="id"> b</span><span class="id"> s</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">let</span><span class="id"> F</span><span class="id"> :</span><span class="id"> nat</span><span class="id"> -&gt;</span><span class="id"> R</span><span class="id"> :=</span><span class="id"> f</span><span class="id"> \o</span><span class="id"> nth</span><span class="id"> b</span> (<span class="id">a</span><span class="id"> ::</span><span class="id"> s</span>)<span class="gallina-kwd"> in</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">forall</span><span class="id"> k,</span> (<span class="id">k</span><span class="id"> &lt;</span><span class="id"> size</span><span class="id"> s</span>)<span class="id">%N</span><span class="id"> -&gt;</span><span class="id"> F</span><span class="id"> k</span>.<span class="id">+1</span><span class="id"> &lt;=</span><span class="id"> F</span><span class="id"> k</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move/nonincreasing_funN</span><span class="id"> =&gt;</span><span class="id"> ndNf</span><span class="id"> abs</span><span class="id"> F</span><span class="id"> k</span><span class="id"> ks;</span><span class="id"> rewrite</span><span class="id"> -</span>(<span class="id">opprK</span> (<span class="id">F</span><span class="id"> k</span>))<span class="id"> lerNr</span>.<br/>
<span class="id">exact:</span> (<span class="id">nondecreasing_fun_itv_partition</span><span class="id"> ndNf</span><span class="id"> abs</span>).<br/>
Qed.</div></details>
<br/>
<div class="doc">given a partition of <span class="bracket"><span class="id">a</span>, <span class="id">b</span></span> and c, returns a partition of <span class="bracket"><span class="id">a</span>, <span class="id">c</span></span> </div>
<span class="vernacular">Definition</span><span class="id"> itv_partitionL</span><span class="id"> s</span><span class="id"> c</span><span class="id"> :=</span><span class="id"> rcons</span><span class="id"> [seq</span><span class="id"> x</span><span class="id"> &lt;-</span><span class="id"> s</span><span class="id"> |</span><span class="id"> x</span><span class="id"> &lt;</span><span class="id"> c]</span><span class="id"> c</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> itv_partitionLP</span><span class="id"> a</span><span class="id"> b</span><span class="id"> c</span><span class="id"> s</span><span class="id"> :</span><span class="id"> a</span><span class="id"> &lt;</span><span class="id"> c</span><span class="id"> -&gt;</span><span class="id"> c</span><span class="id"> &lt;</span><span class="id"> b</span><span class="id"> -&gt;</span><span class="id"> itv_partition</span><span class="id"> a</span><span class="id"> b</span><span class="id"> s</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">itv_partition</span><span class="id"> a</span><span class="id"> c</span> (<span class="id">itv_partitionL</span><span class="id"> s</span><span class="id"> c</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> ac</span><span class="id"> bc</span><span class="id"> []</span><span class="id"> al</span><span class="id"> /eqP</span><span class="id"> htb;</span><span class="id"> split</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> /itv_partitionL</span><span class="id"> rcons_path/=;</span><span class="id"> apply/andP;</span><span class="id"> split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> path_filter</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> lt_trans</span>.<br/>
&nbsp;&nbsp;<span class="id">exact:</span> (<span class="id">last_filterP</span><span class="id"> [pred</span><span class="id"> x</span><span class="id"> |</span><span class="id"> x</span><span class="id"> &lt;</span><span class="id"> c]</span>).<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /itv_partitionL</span><span class="id"> last_rcons</span>.<br/>
Qed.</div></details>
<br/>
<div class="doc">given a partition of <span class="bracket"><span class="id">a</span>, <span class="id">b</span></span> and c, returns a partition of <span class="bracket"><span class="id">c</span>, <span class="id">b</span></span> </div>
<span class="vernacular">Definition</span><span class="id"> itv_partitionR</span><span class="id"> s</span><span class="id"> c</span><span class="id"> :=</span><span class="id"> [seq</span><span class="id"> x</span><span class="id"> &lt;-</span><span class="id"> s</span><span class="id"> |</span><span class="id"> c</span><span class="id"> &lt;</span><span class="id"> x]</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> itv_partitionRP</span><span class="id"> a</span><span class="id"> b</span><span class="id"> c</span><span class="id"> s</span><span class="id"> :</span><span class="id"> a</span><span class="id"> &lt;</span><span class="id"> c</span><span class="id"> -&gt;</span><span class="id"> c</span><span class="id"> &lt;</span><span class="id"> b</span><span class="id"> -&gt;</span><span class="id"> itv_partition</span><span class="id"> a</span><span class="id"> b</span><span class="id"> s</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">itv_partition</span><span class="id"> c</span><span class="id"> b</span> (<span class="id">itv_partitionR</span><span class="id"> s</span><span class="id"> c</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> ac</span><span class="id"> cb</span><span class="id"> []</span><span class="id"> sa</span><span class="id"> /eqP</span><span class="id"> alb;</span><span class="id"> rewrite</span><span class="id"> /itv_partition;</span><span class="id"> split</span>.<br/>
&nbsp;&nbsp;<span class="id">move:</span><span class="id"> sa;</span><span class="id"> rewrite</span><span class="id"> lt_path_sortedE</span><span class="id"> =&gt;</span><span class="id"> /andP[allas</span><span class="id"> ss]</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> lt_path_sortedE</span><span class="id"> filter_all/=</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> sorted_filter</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> lt_trans</span>.<br/>
<span class="id">exact/eqP/</span>(<span class="id">path_lt_last_filter</span><span class="id"> ac</span>).<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> in_itv_partition</span><span class="id"> c</span><span class="id"> s</span><span class="id"> :</span><span class="id"> sorted</span><span class="id"> &lt;%R</span><span class="id"> s</span><span class="id"> -&gt;</span><span class="id"> c</span><span class="id"> \in</span><span class="id"> s</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">s</span><span class="id"> =</span><span class="id"> itv_partitionL</span><span class="id"> s</span><span class="id"> c</span><span class="id"> ++</span><span class="id"> itv_partitionR</span><span class="id"> s</span><span class="id"> c</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">elim:</span><span class="id"> s</span><span class="id"> c</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> h</span><span class="id"> t</span><span class="id"> ih</span><span class="id"> c</span><span class="id"> /=</span><span class="id"> ht</span>.<br/>
<span class="id">rewrite</span><span class="id"> inE</span><span class="id"> =&gt;</span><span class="id"> /predU1P[-&gt;{c}/=|ct]</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> ltxx</span><span class="id"> /itv_partitionL</span><span class="id"> /=</span><span class="id"> ltxx</span><span class="id"> /itv_partitionR/=</span><span class="id"> path_lt_filter0//=</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> path_lt_filterT</span>.<br/>
<span class="id">rewrite</span><span class="id"> /itv_partitionL/=;</span><span class="id"> case:</span><span class="id"> ifPn</span><span class="id"> =&gt;</span><span class="id"> [hc|]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> ltNge</span> (<span class="id">ltW</span><span class="id"> hc</span>)<span class="id">/=</span><span class="id"> /=</span><span class="id"> [in</span><span class="id"> LHS]</span>(<span class="id">ih</span><span class="id"> _</span><span class="id"> _</span><span class="id"> ct</span>)<span class="id">//;</span><span class="id"> exact:</span><span class="id"> path_sorted</span><span class="id"> ht</span>.<br/>
<span class="id">rewrite</span><span class="id"> -leNgt</span><span class="id"> le_eqVlt</span><span class="id"> =&gt;</span><span class="id"> /predU1P[ch|ch]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> ch</span><span class="id"> ltxx</span><span class="id"> path_lt_filter0//=</span><span class="id"> /itv_partitionR</span><span class="id"> path_lt_filterT</span>.<br/>
<span class="id">move:</span><span class="id"> ht;</span><span class="id"> rewrite</span><span class="id"> lt_path_sortedE</span><span class="id"> =&gt;</span><span class="id"> /andP[/allP/</span>(_<span class="id"> _</span><span class="id"> ct</span>)<span class="id">]</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> /lt_trans-/</span>(_<span class="id"> _</span><span class="id"> ch</span>)<span class="id">;</span><span class="id"> rewrite</span><span class="id"> ltxx</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> notin_itv_partition</span><span class="id"> c</span><span class="id"> s</span><span class="id"> :</span><span class="id"> sorted</span><span class="id"> &lt;%R</span><span class="id"> s</span><span class="id"> -&gt;</span><span class="id"> c</span><span class="id"> \notin</span><span class="id"> s</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">s</span><span class="id"> =</span><span class="id"> [seq</span><span class="id"> x</span><span class="id"> &lt;-</span><span class="id"> s</span><span class="id"> |</span><span class="id"> x</span><span class="id"> &lt;</span><span class="id"> c]</span><span class="id"> ++</span><span class="id"> itv_partitionR</span><span class="id"> s</span><span class="id"> c</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">elim:</span><span class="id"> s</span><span class="id"> c</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> h</span><span class="id"> t</span><span class="id"> ih</span><span class="id"> c</span><span class="id"> /=</span><span class="id"> ht</span>.<br/>
<span class="id">rewrite</span><span class="id"> inE</span><span class="id"> negb_or</span><span class="id"> =&gt;</span><span class="id"> /andP[];</span><span class="id"> rewrite</span><span class="id"> neq_lt</span><span class="id"> =&gt;</span><span class="id"> /orP[ch|ch]</span><span class="id"> ct</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> ch</span><span class="id"> ltNge</span> (<span class="id">ltW</span><span class="id"> ch</span>)<span class="id">/=</span><span class="id"> path_lt_filter0/=</span><span class="id"> /itv_partitionR;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> path_lt_head</span><span class="id"> ht</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> path_lt_filterT//;</span><span class="id"> exact:</span><span class="id"> path_lt_head</span><span class="id"> ht</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> ch/=</span><span class="id"> ltNge</span> (<span class="id">ltW</span><span class="id"> ch</span>)<span class="id">/=</span><span class="id"> -ih//;</span><span class="id"> exact:</span><span class="id"> path_sorted</span><span class="id"> ht</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> itv_partition_rev</span><span class="id"> a</span><span class="id"> b</span><span class="id"> s</span><span class="id"> :</span><span class="id"> itv_partition</span><span class="id"> a</span><span class="id"> b</span><span class="id"> s</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">itv_partition</span> (<span class="id">-</span><span class="id"> b</span>) (<span class="id">-</span><span class="id"> a</span>) (<span class="id">rev</span> (<span class="id">belast</span> (<span class="id">-</span><span class="id"> a</span>) (<span class="id">map</span><span class="id"> -%R</span><span class="id"> s</span>))).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> [sa</span><span class="id"> /eqP</span><span class="id"> alb];</span><span class="id"> split</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> (_<span class="id"> :</span><span class="id"> -</span><span class="id"> b</span><span class="id"> =</span><span class="id"> last</span> (<span class="id">-</span><span class="id"> a</span>) (<span class="id">map</span><span class="id"> -%R</span><span class="id"> s</span>))<span class="id">;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> last_map</span><span class="id"> alb</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> rev_path//</span><span class="id"> path_map</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> sub_path</span><span class="id"> sa</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> y</span><span class="id"> xy/=;</span><span class="id"> rewrite</span><span class="id"> ltrNr</span><span class="id"> opprK</span>.<br/>
<span class="id">case:</span><span class="id"> s</span><span class="id"> sa</span><span class="id"> alb</span><span class="id"> =&gt;</span><span class="id"> [_</span><span class="id"> &lt;-//|h</span><span class="id"> t]</span><span class="id"> /=</span><span class="id"> /andP[ah</span><span class="id"> ht]</span><span class="id"> &lt;-{b}</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> rev_cons</span><span class="id"> last_rcons</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> interval_partition</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> variation</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {R</span><span class="id"> :</span><span class="id"> realType}</span>.<br/>
<span class="vernacular">Implicit</span><span class="id"> Types</span> (<span class="id">a</span><span class="id"> b</span><span class="id"> :</span><span class="id"> R</span>) (<span class="id">f</span><span class="id"> g</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> R</span>).<br/>
<br/>
<span class="vernacular">Definition</span><span class="id"> variation</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span><span class="id"> s</span><span class="id"> :=</span><span class="gallina-kwd"> let</span><span class="id"> F</span><span class="id"> :=</span><span class="id"> f</span><span class="id"> \o</span><span class="id"> nth</span><span class="id"> b</span> (<span class="id">a</span><span class="id"> ::</span><span class="id"> s</span>)<span class="gallina-kwd"> in</span><br/>
&nbsp;&nbsp;<span class="id">\sum_</span>(<span class="id">0</span><span class="id"> &lt;=</span><span class="id"> n</span><span class="id"> &lt;</span><span class="id"> size</span><span class="id"> s</span>)<span class="id"> `|F</span><span class="id"> n</span>.<span class="id">+1</span><span class="id"> -</span><span class="id"> F</span><span class="id"> n|%R</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> variation_zip</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span><span class="id"> s</span><span class="id"> :</span><span class="id"> itv_partition</span><span class="id"> a</span><span class="id"> b</span><span class="id"> s</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">variation</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span><span class="id"> s</span><span class="id"> =</span><span class="id"> \sum_</span>(<span class="id">x</span><span class="id"> &lt;-</span><span class="id"> zip</span><span class="id"> s</span> (<span class="id">a</span><span class="id"> ::</span><span class="id"> s</span>))<span class="id"> `|f</span><span class="id"> x</span>.<span class="id">1</span><span class="id"> -</span><span class="id"> f</span><span class="id"> x</span>.<span class="id">2|</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">elim:</span><span class="id"> s</span><span class="id"> a</span><span class="id"> b</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> [a</span><span class="id"> b|h</span><span class="id"> t</span><span class="id"> ih</span><span class="id"> a</span><span class="id"> b]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /itv_partition</span><span class="id"> /=</span><span class="id"> =&gt;</span><span class="id"> -[_</span><span class="id"> /eqP</span><span class="id"> &lt;-];</span><span class="id"> rewrite</span><span class="id"> /variation/=</span><span class="id"> !big_nil</span>.<br/>
<span class="id">rewrite</span><span class="id"> /itv_partition</span><span class="id"> /variation</span><span class="id"> =&gt;</span><span class="id"> -[]/=</span><span class="id"> /andP[ah</span><span class="id"> ht]</span><span class="id"> /eqP</span><span class="id"> htb</span>.<br/>
<span class="id">rewrite</span><span class="id"> big_nat_recl//=</span><span class="id"> big_cons/=;</span><span class="id"> congr</span><span class="id"> +%R</span>.<br/>
<span class="id">have</span><span class="id"> /ih</span><span class="id"> :</span><span class="id"> itv_partition</span><span class="id"> h</span><span class="id"> b</span><span class="id"> t</span><span class="gallina-kwd"> by</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact/eqP</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /variation</span><span class="id"> =&gt;</span><span class="id"> -&gt;;</span><span class="id"> rewrite</span><span class="id"> !big_seq;</span><span class="id"> apply/eq_bigr</span><span class="id"> =&gt;</span><span class="id"> r</span><span class="id"> rt</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> variation_prev</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span><span class="id"> s</span><span class="id"> :</span><span class="id"> itv_partition</span><span class="id"> a</span><span class="id"> b</span><span class="id"> s</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">variation</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span><span class="id"> s</span><span class="id"> =</span><span class="id"> \sum_</span>(<span class="id">x</span><span class="id"> &lt;-</span><span class="id"> s</span>)<span class="id"> `|f</span><span class="id"> x</span><span class="id"> -</span><span class="id"> f</span> (<span class="id">prev</span> (<span class="id">locked</span> (<span class="id">a</span><span class="id"> ::</span><span class="id"> s</span>))<span class="id"> x</span>)<span class="id">|</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> []</span><span class="id"> sa</span><span class="id"> /eqP</span><span class="id"> asb;</span><span class="id"> rewrite</span><span class="id"> /variation</span><span class="id"> [in</span><span class="id"> LHS]/=</span> (<span class="id">big_nth</span><span class="id"> b</span>)<span class="id"> !big_nat</span>.<br/>
<span class="id">apply:</span><span class="id"> eq_bigr</span><span class="id"> =&gt;</span><span class="id"> i</span><span class="id"> /andP[_</span><span class="id"> si];</span><span class="id"> congr</span> (<span class="id">`|</span><span class="id"> _</span><span class="id"> -</span><span class="id"> f</span><span class="id"> _</span><span class="id"> |</span>).<br/>
<span class="id">rewrite</span><span class="id"> -lock</span>.<br/>
<span class="id">rewrite</span><span class="id"> prev_nth</span><span class="id"> inE</span><span class="id"> gt_eqF;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -[a]/</span>(<span class="id">nth</span><span class="id"> b</span> (<span class="id">a</span><span class="id"> ::</span><span class="id"> s</span>)<span class="id"> 0</span>)<span class="id"> -[ltRHS]/</span>(<span class="id">nth</span><span class="id"> b</span> (<span class="id">a</span><span class="id"> ::</span><span class="id"> s</span>)<span class="id"> i</span>.<span class="id">+1</span>).<br/>
&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> lt_sorted_ltn_nth</span>.<br/>
<span class="id">rewrite</span><span class="id"> orFb</span><span class="id"> mem_nth//</span><span class="id"> index_uniq//</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> set_nth_default</span><span class="id"> =&gt;</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> ltnS</span><span class="id"> ltnW</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply:</span> (<span class="id">sorted_uniq</span><span class="id"> lt_trans</span>)<span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> apply:</span><span class="id"> path_sorted</span><span class="id"> sa</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> variation_next</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span><span class="id"> s</span><span class="id"> :</span><span class="id"> itv_partition</span><span class="id"> a</span><span class="id"> b</span><span class="id"> s</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">variation</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span><span class="id"> s</span><span class="id"> =</span><br/>
&nbsp;&nbsp;<span class="id">\sum_</span>(<span class="id">x</span><span class="id"> &lt;-</span><span class="id"> belast</span><span class="id"> a</span><span class="id"> s</span>)<span class="id"> `|f</span> (<span class="id">next</span> (<span class="id">locked</span> (<span class="id">a</span><span class="id"> ::</span><span class="id"> s</span>))<span class="id"> x</span>)<span class="id"> -</span><span class="id"> f</span><span class="id"> x|</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> []</span><span class="id"> sa</span><span class="id"> /eqP</span><span class="id"> asb;</span><span class="id"> rewrite</span><span class="id"> /variation</span><span class="id"> [in</span><span class="id"> LHS]/=</span> (<span class="id">big_nth</span><span class="id"> b</span>)<span class="id"> !big_nat</span>.<br/>
<span class="id">rewrite</span><span class="id"> size_belast;</span><span class="id"> apply:</span><span class="id"> eq_bigr</span><span class="id"> =&gt;</span><span class="id"> i</span><span class="id"> /andP[_</span><span class="id"> si]</span>.<br/>
<span class="id">congr</span> (<span class="id">`|</span><span class="id"> f</span><span class="id"> _</span><span class="id"> -</span><span class="id"> f</span><span class="id"> _</span><span class="id"> |</span>)<span class="id">;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> lastI</span><span class="id"> -cats1</span><span class="id"> nth_cat</span><span class="id"> size_belast//</span><span class="id"> si</span>.<br/>
<span class="id">rewrite</span><span class="id"> -lock</span><span class="id"> next_nth</span>.<br/>
<span class="id">rewrite</span><span class="id"> {1}lastI</span><span class="id"> mem_rcons</span><span class="id"> inE</span><span class="id"> mem_nth</span><span class="id"> ?size_belast//</span><span class="id"> orbT</span>.<br/>
<span class="id">rewrite</span><span class="id"> lastI</span><span class="id"> -cats1</span><span class="id"> index_cat</span><span class="id"> mem_nth</span><span class="id"> ?size_belast//</span>.<br/>
<span class="id">rewrite</span><span class="id"> index_uniq</span><span class="id"> ?size_belast//</span>.<br/>
&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> set_nth_default</span>.<br/>
<span class="id">have</span><span class="id"> /lt_sorted_uniq</span><span class="id"> :</span><span class="id"> sorted</span><span class="id"> &lt;%R</span> (<span class="id">a</span><span class="id"> ::</span><span class="id"> s</span>)<span class="gallina-kwd"> by</span><span class="id"> []</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> lastI</span><span class="id"> rcons_uniq</span><span class="id"> =&gt;</span><span class="id"> /andP[]</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> variation_nil</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span><span class="id"> :</span><span class="id"> variation</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span><span class="id"> [::]</span><span class="id"> =</span><span class="id"> 0</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> /variation/=</span><span class="id"> big_nil</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> variation_ge0</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span><span class="id"> s</span><span class="id"> :</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> variation</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span><span class="id"> s</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id"> exact/sumr_ge0</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> variationN</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span><span class="id"> s</span><span class="id"> :</span><span class="id"> variation</span><span class="id"> a</span><span class="id"> b</span> (<span class="id">\-</span><span class="id"> f</span>)<span class="id"> s</span><span class="id"> =</span><span class="id"> variation</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span><span class="id"> s</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /variation;</span><span class="id"> apply:</span><span class="id"> eq_bigr</span><span class="id"> =&gt;</span><span class="id"> k</span><span class="id"> _</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> -opprD</span><span class="id"> normrN</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> variation_le</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span><span class="id"> g</span><span class="id"> s</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">variation</span><span class="id"> a</span><span class="id"> b</span> (<span class="id">f</span><span class="id"> \+</span><span class="id"> g</span>)<span class="id">%R</span><span class="id"> s</span><span class="id"> &lt;=</span><span class="id"> variation</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span><span class="id"> s</span><span class="id"> +</span><span class="id"> variation</span><span class="id"> a</span><span class="id"> b</span><span class="id"> g</span><span class="id"> s</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> [in</span><span class="id"> leRHS]/variation</span><span class="id"> -big_split/=</span>.<br/>
<span class="id">apply:</span><span class="id"> ler_sum</span><span class="id"> =&gt;</span><span class="id"> k</span><span class="id"> _;</span><span class="id"> apply:</span><span class="id"> le_trans;</span><span class="id"> last</span><span class="id"> exact:</span><span class="id"> ler_normD</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /=</span><span class="id"> addrACA</span><span class="id"> addrA</span><span class="id"> opprD</span><span class="id"> addrA</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> nondecreasing_variation</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span><span class="id"> s</span><span class="id"> :</span><span class="id"> {in</span><span class="id"> `[a,</span><span class="id"> b]</span><span class="id"> &amp;,</span><span class="id"> nondecreasing_fun</span><span class="id"> f}</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">itv_partition</span><span class="id"> a</span><span class="id"> b</span><span class="id"> s</span><span class="id"> -&gt;</span><span class="id"> variation</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span><span class="id"> s</span><span class="id"> =</span><span class="id"> f</span><span class="id"> b</span><span class="id"> -</span><span class="id"> f</span><span class="id"> a</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> ndf</span><span class="id"> abs;</span><span class="id"> rewrite</span><span class="id"> /variation;</span><span class="id"> set</span><span class="id"> F</span><span class="id"> :</span><span class="id"> nat</span><span class="id"> -&gt;</span><span class="id"> R</span><span class="id"> :=</span><span class="id"> f</span><span class="id"> \o</span><span class="id"> nth</span><span class="id"> _</span> (<span class="id">a</span><span class="id"> ::</span><span class="id"> s</span>).<br/>
<span class="id">transitivity</span> (<span class="id">\sum_</span>(<span class="id">0</span><span class="id"> &lt;=</span><span class="id"> n</span><span class="id"> &lt;</span><span class="id"> size</span><span class="id"> s</span>) (<span class="id">F</span><span class="id"> n</span>.<span class="id">+1</span><span class="id"> -</span><span class="id"> F</span><span class="id"> n</span>)).<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> !big_nat;</span><span class="id"> apply:</span><span class="id"> eq_bigr</span><span class="id"> =&gt;</span><span class="id"> k;</span><span class="id"> rewrite</span><span class="id"> leq0n/=</span><span class="id"> =&gt;</span><span class="id"> ks</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> ger0_norm//</span><span class="id"> subr_ge0;</span><span class="id"> exact:</span><span class="id"> nondecreasing_fun_itv_partition</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> telescope_sumr//</span><span class="id"> /F/=</span> (<span class="id">itv_partition_nth_size</span><span class="id"> _</span><span class="id"> abs</span>).<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> nonincreasing_variation</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span><span class="id"> s</span><span class="id"> :</span><span class="id"> {in</span><span class="id"> `[a,</span><span class="id"> b]</span><span class="id"> &amp;,</span><span class="id"> nonincreasing_fun</span><span class="id"> f}</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">itv_partition</span><span class="id"> a</span><span class="id"> b</span><span class="id"> s</span><span class="id"> -&gt;</span><span class="id"> variation</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span><span class="id"> s</span><span class="id"> =</span><span class="id"> f</span><span class="id"> a</span><span class="id"> -</span><span class="id"> f</span><span class="id"> b</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> /nonincreasing_funN</span><span class="id"> ndNf</span><span class="id"> abs;</span><span class="id"> have</span><span class="id"> :=</span><span class="id"> nondecreasing_variation</span><span class="id"> ndNf</span><span class="id"> abs</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> opprK</span><span class="id"> addrC</span><span class="id"> =&gt;</span><span class="id"> &lt;-;</span><span class="id"> rewrite</span><span class="id"> variationN</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> variationD</span><span class="id"> a</span><span class="id"> b</span><span class="id"> c</span><span class="id"> f</span><span class="id"> s</span><span class="id"> t</span><span class="id"> :</span><span class="id"> a</span><span class="id"> &lt;=</span><span class="id"> c</span><span class="id"> -&gt;</span><span class="id"> c</span><span class="id"> &lt;=</span><span class="id"> b</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">itv_partition</span><span class="id"> a</span><span class="id"> c</span><span class="id"> s</span><span class="id"> -&gt;</span><span class="id"> itv_partition</span><span class="id"> c</span><span class="id"> b</span><span class="id"> t</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">variation</span><span class="id"> a</span><span class="id"> c</span><span class="id"> f</span><span class="id"> s</span><span class="id"> +</span><span class="id"> variation</span><span class="id"> c</span><span class="id"> b</span><span class="id"> f</span><span class="id"> t</span><span class="id"> =</span><span class="id"> variation</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span> (<span class="id">s</span><span class="id"> ++</span><span class="id"> t</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> le_eqVlt</span><span class="id"> =&gt;</span><span class="id"> /predU1P[&lt;-{c}</span><span class="id"> cb|ac]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> /itv_partitionxx</span><span class="id"> -&gt;;</span><span class="id"> rewrite</span><span class="id"> variation_nil</span><span class="id"> add0r</span>.<br/>
<span class="id">rewrite</span><span class="id"> le_eqVlt</span><span class="id"> =&gt;</span><span class="id"> /predU1P[&lt;-{b}|cb]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> ?</span><span class="id"> /itv_partitionxx</span><span class="id"> -&gt;;</span><span class="id"> rewrite</span><span class="id"> variation_nil</span><span class="id"> addr0</span><span class="id"> cats0</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> acs</span><span class="id"> cbt;</span><span class="id"> rewrite</span><span class="id"> /variation</span><span class="id"> /=</span><span class="id"> [in</span><span class="id"> RHS]/index_iota</span><span class="id"> subn0</span><span class="id"> size_cat</span>.<br/>
<span class="id">rewrite</span><span class="id"> iotaD</span><span class="id"> add0n</span><span class="id"> big_cat/=</span><span class="id"> -[in</span><span class="id"> X</span><span class="gallina-kwd"> in</span><span class="id"> _</span><span class="id"> =</span><span class="id"> X</span><span class="id"> +</span><span class="id"> _]</span>(<span class="id">subn0</span> (<span class="id">size</span><span class="id"> s</span>))<span class="id">;</span><span class="id"> congr</span><span class="id"> +%R</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -/</span>(<span class="id">index_iota</span><span class="id"> 0</span> (<span class="id">size</span><span class="id"> s</span>))<span class="id"> 2!big_nat</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> eq_bigr</span><span class="id"> =&gt;</span><span class="id"> k</span><span class="id"> /[!leq0n]</span><span class="id"> /=</span><span class="id"> ks</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> nth_cat</span><span class="id"> ks</span><span class="id"> -cat_cons</span><span class="id"> nth_cat</span><span class="id"> /=</span><span class="id"> ltnS</span> (<span class="id">ltnW</span><span class="id"> ks</span>).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> !</span>(<span class="id">set_nth_default</span><span class="id"> b</span><span class="id"> c</span>)<span class="id">//=</span><span class="id"> ltnS</span><span class="id"> ltnW</span>.<br/>
<span class="id">rewrite</span><span class="id"> -[in</span><span class="id"> RHS]</span>(<span class="id">addnK</span> (<span class="id">size</span><span class="id"> s</span>) (<span class="id">size</span><span class="id"> t</span>)).<br/>
<span class="id">rewrite</span><span class="id"> -/</span>(<span class="id">index_iota</span> (<span class="id">size</span><span class="id"> s</span>) (<span class="id">size</span><span class="id"> t</span><span class="id"> +</span><span class="id"> size</span><span class="id"> s</span>)).<br/>
<span class="id">rewrite</span><span class="id"> -{1}[in</span><span class="id"> RHS]</span>(<span class="id">add0n</span> (<span class="id">size</span><span class="id"> s</span>))<span class="id"> big_addn</span><span class="id"> addnK</span><span class="id"> 2!big_nat;</span><span class="id"> apply:</span><span class="id"> eq_bigr</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> k</span><span class="id"> /[!leq0n]/=</span><span class="id"> kt</span>.<br/>
<span class="id">rewrite</span><span class="id"> nth_cat</span><span class="id"> {1}</span>(<span class="id">addnC</span><span class="id"> k</span>)<span class="id"> -ltn_subRL</span><span class="id"> subnn</span><span class="id"> ltn0</span><span class="id"> addnK</span>.<br/>
<span class="id">case:</span><span class="id"> k</span><span class="id"> kt</span><span class="id"> =&gt;</span><span class="id"> [t0</span><span class="id"> /=|k</span><span class="id"> kt]</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> add0n</span><span class="id"> -cat_cons</span><span class="id"> nth_cat/=</span><span class="id"> ltnS</span><span class="id"> leqnn</span><span class="id"> -last_nth</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> case:</span><span class="id"> acs</span><span class="id"> =&gt;</span><span class="id"> _</span><span class="id"> /eqP</span><span class="id"> -&gt;</span>.<br/>
<span class="id">rewrite</span><span class="id"> addSnnS</span> (<span class="id">addnC</span><span class="id"> k</span>)<span class="id"> -cat_cons</span><span class="id"> nth_cat/=</span><span class="id"> -ltn_subRL</span><span class="id"> subnn</span><span class="id"> ltn0</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -</span>(<span class="id">addnC</span><span class="id"> k</span>)<span class="id"> addnK</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> variation_itv_partitionLR</span><span class="id"> a</span><span class="id"> b</span><span class="id"> c</span><span class="id"> f</span><span class="id"> s</span><span class="id"> :</span><span class="id"> a</span><span class="id"> &lt;</span><span class="id"> c</span><span class="id"> -&gt;</span><span class="id"> c</span><span class="id"> &lt;</span><span class="id"> b</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">itv_partition</span><span class="id"> a</span><span class="id"> b</span><span class="id"> s</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">variation</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span><span class="id"> s</span><span class="id"> &lt;=</span><span class="id"> variation</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span> (<span class="id">itv_partitionL</span><span class="id"> s</span><span class="id"> c</span><span class="id"> ++</span><span class="id"> itv_partitionR</span><span class="id"> s</span><span class="id"> c</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> ac</span><span class="id"> bc</span><span class="id"> abs;</span><span class="id"> have</span><span class="id"> [cl|cl]</span><span class="id"> :=</span><span class="id"> boolP</span> (<span class="id">c</span><span class="id"> \in</span><span class="id"> s</span>).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -in_itv_partition//;</span><span class="id"> case:</span><span class="id"> abs</span><span class="id"> =&gt;</span><span class="id"> /path_sorted</span>.<br/>
<span class="id">rewrite</span><span class="id"> /itv_partitionL</span><span class="id"> [in</span><span class="id"> leLHS]</span>(<span class="id">notin_itv_partition</span><span class="id"> _</span><span class="id"> cl</span>)<span class="id">//;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> path_sorted;</span><span class="id"> case:</span><span class="id"> abs</span><span class="id"> =&gt;</span><span class="id"> +</span><span class="id"> _;</span><span class="id"> exact</span>.<br/>
<span class="id">rewrite</span><span class="id"> -notin_itv_partition//;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> path_sorted;</span><span class="id"> case:</span><span class="id"> abs</span><span class="id"> =&gt;</span><span class="id"> /=</span><span class="id"> +</span><span class="id"> _;</span><span class="id"> exact</span>.<br/>
<span class="id">rewrite</span><span class="id"> !variation_zip//;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> itv_partition_cat;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">[exact:</span> (<span class="id">itv_partitionLP</span><span class="id"> _</span><span class="id"> bc</span>)<span class="id">|exact:</span> (<span class="id">itv_partitionRP</span><span class="id"> ac</span>)<span class="id">]</span>.<br/>
<span class="id">rewrite</span><span class="id"> [in</span><span class="id"> leLHS]</span>(<span class="id">notin_itv_partition</span><span class="id"> _</span><span class="id"> cl</span>)<span class="id">;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> path_sorted;</span><span class="id"> case:</span><span class="id"> abs</span><span class="id"> =&gt;</span><span class="id"> +</span><span class="id"> _;</span><span class="id"> exact</span>.<br/>
<span class="id">set</span><span class="id"> L</span><span class="id"> :=</span><span class="id"> [seq</span><span class="id"> x</span><span class="id"> &lt;-</span><span class="id"> s</span><span class="id"> |</span><span class="id"> x</span><span class="id"> &lt;</span><span class="id"> c]</span>.<br/>
<span class="id">rewrite</span><span class="id"> -cats1</span><span class="id"> -catA</span>.<br/>
<span class="id">move:</span><span class="id"> L</span><span class="id"> =&gt;</span><span class="id"> L</span>.<br/>
<span class="id">set</span><span class="id"> B</span><span class="id"> :=</span><span class="id"> itv_partitionR</span><span class="id"> s</span><span class="id"> c</span>.<br/>
<span class="id">move:</span><span class="id"> B</span><span class="id"> =&gt;</span><span class="id"> B</span>.<br/>
<span class="id">elim/last_ind</span><span class="id"> :</span><span class="id"> L</span><span class="id"> =&gt;</span><span class="id"> [|L0</span><span class="id"> L1</span><span class="id"> _]</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> !cat0s</span><span class="id"> /=;</span><span class="id"> case:</span><span class="id"> B</span><span class="id"> =&gt;</span><span class="id"> [|B0</span><span class="id"> B1]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> big_nil</span><span class="id"> big_cons/=</span><span class="id"> big_nil</span><span class="id"> addr0</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> !big_cons/=</span><span class="id"> addrA</span><span class="id"> lerD//</span><span class="id"> [leRHS]addrC</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span> (<span class="id">le_trans</span><span class="id"> _</span> (<span class="id">ler_normD</span><span class="id"> _</span><span class="id"> _</span>))<span class="id">//</span><span class="id"> addrA</span><span class="id"> subrK</span>.<br/>
<span class="id">rewrite</span><span class="id"> -cats1</span>.<br/>
<span class="id">rewrite</span> (_<span class="id"> :</span><span class="id"> a</span><span class="id"> ::</span><span class="id"> _</span><span class="id"> ++</span><span class="id"> B</span><span class="id"> =</span> (<span class="id">a</span><span class="id"> ::</span><span class="id"> L0</span>)<span class="id"> ++</span><span class="id"> [::</span><span class="id"> L1]</span><span class="id"> ++</span><span class="id"> B</span>)<span class="id">//;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -!catA</span><span class="id"> -cat_cons</span>.<br/>
<span class="id">rewrite</span><span class="id"> zip_cat;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> cats1</span><span class="id"> size_rcons</span>.<br/>
<span class="id">rewrite</span> (_<span class="id"> :</span><span class="id"> a</span><span class="id"> ::</span><span class="id"> _</span><span class="id"> ++</span><span class="id"> _</span><span class="id"> ++</span><span class="id"> B</span><span class="id"> =</span> (<span class="id">a</span><span class="id"> ::</span><span class="id"> L0</span>)<span class="id"> ++</span><span class="id"> [::</span><span class="id"> L1]</span><span class="id"> ++</span><span class="id"> [::</span><span class="id"> c]</span><span class="id"> ++</span><span class="id"> B</span>)<span class="id">;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -!catA</span><span class="id"> -cat_cons</span>.<br/>
<span class="id">rewrite</span><span class="id"> zip_cat;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> cats1</span><span class="id"> size_rcons</span>.<br/>
<span class="id">rewrite</span><span class="id"> !big_cat</span><span class="id"> lerD//</span>.<br/>
<span class="id">case:</span><span class="id"> B</span><span class="id"> =&gt;</span><span class="id"> [|B0</span><span class="id"> B1]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /=</span><span class="id"> big_nil</span><span class="id"> big_cons</span><span class="id"> big_nil</span><span class="id"> addr0</span>.<br/>
<span class="id">rewrite</span><span class="id"> -cat1s</span><span class="id"> zip_cat//</span><span class="id"> catA</span>.<br/>
<span class="id">rewrite</span> (_<span class="id"> :</span><span class="id"> [::</span><span class="id"> L1]</span><span class="id"> ++</span><span class="id"> _</span><span class="id"> ++</span><span class="id"> B1</span><span class="id"> =</span> (<span class="id">[::</span><span class="id"> L1]</span><span class="id"> ++</span><span class="id"> [::</span><span class="id"> c]</span>)<span class="id"> ++</span><span class="id"> [::</span><span class="id"> B0]</span><span class="id"> ++</span><span class="id"> B1</span>)<span class="id">;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> catA</span>.<br/>
<span class="id">rewrite</span><span class="id"> zip_cat//</span><span class="id"> !big_cat</span><span class="id"> lerD//=</span><span class="id"> !big_cons</span><span class="id"> !big_nil</span><span class="id"> !addr0/=</span><span class="id"> [leRHS]addrC</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span> (<span class="id">le_trans</span><span class="id"> _</span> (<span class="id">ler_normD</span><span class="id"> _</span><span class="id"> _</span>))<span class="id">//</span><span class="id"> addrA</span><span class="id"> subrK</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> le_variation</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span><span class="id"> s</span><span class="id"> x</span><span class="id"> :</span><span class="id"> variation</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span><span class="id"> s</span><span class="id"> &lt;=</span><span class="id"> variation</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span> (<span class="id">x</span><span class="id"> ::</span><span class="id"> s</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">case:</span><span class="id"> s</span><span class="id"> =&gt;</span><span class="id"> [|h</span><span class="id"> t]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> variation_nil</span><span class="id"> /variation/=</span><span class="id"> big_nat_recl//=</span><span class="id"> big_nil</span><span class="id"> addr0</span>.<br/>
<span class="id">rewrite</span><span class="id"> /variation/=</span><span class="id"> !big_nat_recl//=</span><span class="id"> addrA</span><span class="id"> lerD2r</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span> (<span class="id">le_trans</span><span class="id"> _</span> (<span class="id">ler_normD</span><span class="id"> _</span><span class="id"> _</span>))<span class="id">//</span> (<span class="id">addrC</span> (<span class="id">f</span><span class="id"> x</span><span class="id"> -</span><span class="id"> _</span>))<span class="id"> addrA</span><span class="id"> subrK</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> variation_opp_rev</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span><span class="id"> s</span><span class="id"> :</span><span class="id"> itv_partition</span><span class="id"> a</span><span class="id"> b</span><span class="id"> s</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">variation</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span><span class="id"> s</span><span class="id"> =</span><br/>
&nbsp;&nbsp;<span class="id">variation</span> (<span class="id">-</span><span class="id"> b</span>) (<span class="id">-</span><span class="id"> a</span>) (<span class="id">f</span><span class="id"> \o</span><span class="id"> -%R</span>) (<span class="id">rev</span> (<span class="id">belast</span> (<span class="id">-</span><span class="id"> a</span>) (<span class="id">map</span><span class="id"> -%R</span><span class="id"> s</span>))).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> abl;</span><span class="id"> rewrite</span><span class="id"> belast_map</span><span class="id"> /variation</span><span class="id"> /=</span><span class="id"> [LHS]big_nat_rev/=</span><span class="id"> add0n</span>.<br/>
<span class="id">rewrite</span><span class="id"> size_rev</span><span class="id"> size_map</span><span class="id"> size_belast</span><span class="id"> 2!big_nat</span>.<br/>
<span class="id">apply:</span><span class="id"> eq_bigr</span><span class="id"> =&gt;</span><span class="id"> k;</span><span class="id"> rewrite</span><span class="id"> leq0n</span><span class="id"> /=</span><span class="id"> =&gt;</span><span class="id"> ks</span>.<br/>
<span class="id">rewrite</span><span class="id"> nth_rev</span><span class="id"> ?size_map</span><span class="id"> ?size_belast//</span><span class="id"> [in</span><span class="id"> RHS]distrC</span>.<br/>
<span class="id">rewrite</span> (<span class="id">nth_map</span><span class="id"> a</span>)<span class="id">;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> size_belast</span><span class="id"> ltn_subLR//</span><span class="id"> addSn</span><span class="id"> ltnS</span><span class="id"> leq_addl</span>.<br/>
<span class="id">rewrite</span><span class="id"> opprK</span><span class="id"> -rev_rcons</span><span class="id"> nth_rev</span><span class="id"> ?size_rcons</span><span class="id"> ?size_map</span><span class="id"> ?size_belast</span><span class="id"> 1?ltnW//</span>.<br/>
<span class="id">rewrite</span><span class="id"> subSn//</span><span class="id"> -map_rcons</span> (<span class="id">nth_map</span><span class="id"> b</span>)<span class="id"> ?size_rcons</span><span class="id"> ?size_belast;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> ltnS</span><span class="id"> ltn_subLR//</span><span class="id"> addSn</span><span class="id"> ltnS</span><span class="id"> leq_addl</span>.<br/>
<span class="id">rewrite</span><span class="id"> opprK</span><span class="id"> nth_rcons</span><span class="id"> size_belast</span><span class="id"> -subSn//</span><span class="id"> subSS</span>.<br/>
<span class="id">rewrite</span> (<span class="id">ltn_subLR</span><span class="id"> _</span> (<span class="id">ltnW</span><span class="id"> ks</span>))<span class="id"> if_same</span>.<br/>
<span class="id">case:</span><span class="id"> k</span><span class="id"> =&gt;</span><span class="id"> [|k]</span><span class="gallina-kwd"> in</span><span class="id"> ks</span><span class="id"> *</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> add0n</span><span class="id"> ltnn</span><span class="id"> subn1</span> (_<span class="id"> :</span><span class="id"> nth</span><span class="id"> b</span><span class="id"> s</span><span class="id"> _</span><span class="id"> =</span><span class="id"> b</span>)<span class="id">;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">case:</span><span class="id"> abl</span><span class="id"> ks</span><span class="id"> =&gt;</span><span class="id"> _</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">elim/last_ind</span><span class="id"> :</span><span class="id"> s</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> h</span><span class="id"> t</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> last_rcons</span><span class="id"> =&gt;</span><span class="id"> /eqP</span><span class="id"> -&gt;</span><span class="id"> _</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> nth_rcons</span><span class="id"> size_rcons</span><span class="id"> ltnn</span><span class="id"> eqxx</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> (_<span class="id"> :</span><span class="id"> nth</span><span class="id"> b</span> (<span class="id">a</span><span class="id"> ::</span><span class="id"> s</span>)<span class="id"> _</span><span class="id"> =</span><span class="id"> nth</span><span class="id"> a</span> (<span class="id">belast</span><span class="id"> a</span><span class="id"> s</span>) (<span class="id">size</span><span class="id"> s</span>).<span class="id">-1</span>)<span class="id">//</span>.<br/>
&nbsp;&nbsp;<span class="id">case:</span><span class="id"> abl</span><span class="id"> ks</span><span class="id"> =&gt;</span><span class="id"> _</span>.<br/>
&nbsp;&nbsp;<span class="id">elim/last_ind</span><span class="id"> :</span><span class="id"> s</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> h</span><span class="id"> t</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> last_rcons</span><span class="id"> =&gt;</span><span class="id"> /eqP</span><span class="id"> -&gt;</span><span class="id"> _</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> belast_rcons</span><span class="id"> size_rcons/=</span><span class="id"> -rcons_cons</span><span class="id"> nth_rcons/=</span><span class="id"> ltnS</span><span class="id"> leqnn</span>.<br/>
&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> set_nth_default</span>.<br/>
<span class="id">rewrite</span><span class="id"> addSn</span><span class="id"> ltnS</span><span class="id"> leq_addl//;</span><span class="id"> congr</span> (<span class="id">`|</span><span class="id"> f</span><span class="id"> _</span><span class="id"> -</span><span class="id"> f</span><span class="id"> _</span><span class="id"> |</span>).<br/>
&nbsp;&nbsp;<span class="id">elim/last_ind</span><span class="id"> :</span><span class="id"> s</span><span class="id"> ks</span><span class="id"> {abl}</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> h</span><span class="id"> t</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> size_rcons</span><span class="id"> ltnS</span><span class="id"> =&gt;</span><span class="id"> kh</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> belast_rcons</span><span class="id"> nth_rcons</span><span class="id"> subSS</span><span class="id"> ltn_subLR//</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> addSn</span><span class="id"> ltnS</span><span class="id"> leq_addl//</span><span class="id"> subSn</span>.<br/>
<span class="id">elim/last_ind</span><span class="id"> :</span><span class="id"> s</span><span class="id"> ks</span><span class="id"> {abl}</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> h</span><span class="id"> t</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> size_rcons</span><span class="id"> ltnS</span><span class="id"> =&gt;</span><span class="id"> kh</span>.<br/>
<span class="id">rewrite</span><span class="id"> belast_rcons</span><span class="id"> subSS</span><span class="id"> -rcons_cons</span><span class="id"> nth_rcons</span><span class="id"> /=</span><span class="id"> ltn_subLR//</span>.<br/>
<span class="id">rewrite</span><span class="id"> addnS</span><span class="id"> ltnS</span><span class="id"> leq_addl;</span><span class="id"> apply:</span><span class="id"> set_nth_default</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /=</span><span class="id"> ltnS</span><span class="id"> leq_subLR</span><span class="id"> leq_addl</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> variation_rev_opp</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span><span class="id"> s</span><span class="id"> :</span><span class="id"> itv_partition</span> (<span class="id">-</span><span class="id"> b</span>) (<span class="id">-</span><span class="id"> a</span>)<span class="id"> s</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">variation</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span> (<span class="id">rev</span> (<span class="id">belast</span><span class="id"> b</span> (<span class="id">map</span><span class="id"> -%R</span><span class="id"> s</span>)))<span class="id"> =</span><br/>
&nbsp;&nbsp;<span class="id">variation</span> (<span class="id">-</span><span class="id"> b</span>) (<span class="id">-</span><span class="id"> a</span>) (<span class="id">f</span><span class="id"> \o</span><span class="id"> -%R</span>)<span class="id"> s</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> abs;</span><span class="id"> rewrite</span><span class="id"> [in</span><span class="id"> RHS]variation_opp_rev</span><span class="id"> ?opprK//</span>.<br/>
<span class="id">suff:</span> (<span class="id">f</span><span class="id"> \o</span><span class="id"> -%R</span>)<span class="id"> \o</span><span class="id"> -%R</span><span class="id"> =</span><span class="id"> f</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> -&gt;</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply/funext=&gt;</span><span class="id"> ?</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> opprK</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> variation_subseq</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span> (<span class="id">s</span><span class="id"> t</span><span class="id"> :</span><span class="id"> list</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">itv_partition</span><span class="id"> a</span><span class="id"> b</span><span class="id"> s</span><span class="id"> -&gt;</span><span class="id"> itv_partition</span><span class="id"> a</span><span class="id"> b</span><span class="id"> t</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">subseq</span><span class="id"> s</span><span class="id"> t</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">variation</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span><span class="id"> s</span><span class="id"> &lt;=</span><span class="id"> variation</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span><span class="id"> t</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">elim:</span><span class="id"> t</span><span class="id"> s</span><span class="id"> a</span><span class="id"> =&gt;</span><span class="id"> [?</span><span class="id"> ?</span><span class="id"> ?</span><span class="id"> /=</span><span class="id"> _</span><span class="id"> /eqP</span><span class="id"> -&gt;//|a</span><span class="id"> s</span><span class="id"> IH</span><span class="id"> [|x</span><span class="id"> t]</span><span class="id"> w]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> variation_nil</span><span class="id"> //</span><span class="id"> variation_ge0</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> /[dup]</span><span class="id"> /itv_partition_cons</span><span class="id"> itvxb</span><span class="id"> /[dup]</span><span class="id"> /itv_partition_le</span><span class="id"> wb</span><span class="id"> itvxt</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> /[dup]</span><span class="id"> /itv_partition_cons</span><span class="id"> itvas</span><span class="id"> itvws</span><span class="id"> /=</span>.<br/>
<span class="id">have</span><span class="id"> ab</span><span class="id"> :</span><span class="id"> a</span><span class="id"> &lt;=</span><span class="id"> b</span><span class="gallina-kwd"> by</span><span class="id"> exact:</span> (<span class="id">itv_partition_le</span><span class="id"> itvas</span>).<br/>
<span class="id">have</span><span class="id"> wa</span><span class="id"> :</span><span class="id"> w</span><span class="id"> &lt;</span><span class="id"> a</span><span class="gallina-kwd"> by</span><span class="id"> case:</span><span class="id"> itvws</span><span class="id"> =&gt;</span><span class="id"> /=</span><span class="id"> /andP[]</span>.<br/>
<span class="id">have</span><span class="id"> waW</span><span class="id"> :</span><span class="id"> w</span><span class="id"> &lt;=</span><span class="id"> a</span><span class="id"> :=</span><span class="id"> ltW</span><span class="id"> wa</span>.<br/>
<span class="id">case:</span><span class="id"> ifPn</span><span class="id"> =&gt;</span><span class="id"> [|]</span><span class="id"> nXA</span>.<br/>
&nbsp;&nbsp;<span class="id">move/eqP</span><span class="id"> :</span><span class="id"> nXA</span><span class="id"> itvxt</span><span class="id"> itvxb</span><span class="id"> =&gt;</span><span class="id"> -&gt;</span><span class="id"> itvat</span><span class="id"> itvt</span><span class="id"> /=</span><span class="id"> ta</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -[_</span><span class="id"> ::</span><span class="id"> t]cat1s</span><span class="id"> -[_</span><span class="id"> ::</span><span class="id"> s]cat1s</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -?</span>(<span class="id">@variationD</span><span class="id"> _</span><span class="id"> _</span><span class="id"> a</span>)<span class="id">//;</span><span class="id"> [|exact:</span><span class="id"> itv_partition1</span>..<span class="id">]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> lerD//</span><span class="id"> IH</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> xts;</span><span class="id"> rewrite</span><span class="id"> -[_</span><span class="id"> ::</span><span class="id"> s]cat1s</span><span class="id"> -</span>(<span class="id">@variationD</span><span class="id"> _</span><span class="id"> _</span><span class="id"> a</span>)<span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> itv_partition1</span>.<br/>
<span class="id">have</span><span class="id"> [y</span><span class="id"> [s'</span><span class="id"> s'E]]</span><span class="id"> :</span><span class="gallina-kwd"> exists</span><span class="id"> y</span><span class="id"> s',</span><span class="id"> s</span><span class="id"> =</span><span class="id"> y</span><span class="id"> ::</span><span class="id"> s'</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> case:</span><span class="id"> {itvas</span><span class="id"> itvws</span><span class="id"> IH}</span><span class="id"> s</span><span class="id"> xts</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> y</span><span class="id"> s'</span><span class="id"> ?;</span><span class="gallina-kwd"> exists</span><span class="id"> y,</span><span class="id"> s'</span>.<br/>
<span class="id">apply:</span> (<span class="id">@le_trans</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">variation</span><span class="id"> w</span><span class="id"> b</span><span class="id"> f</span><span class="id"> s</span>)).<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> IH//</span>.<br/>
&nbsp;&nbsp;<span class="id">case:</span><span class="id"> itvws</span><span class="id"> =&gt;</span><span class="id"> /=</span><span class="id"> /andP[_];</span><span class="id"> rewrite</span><span class="id"> s'E</span><span class="id"> /=</span><span class="id"> =&gt;</span><span class="id"> /andP[ay</span><span class="id"> ys'</span><span class="id"> lyb]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> rewrite</span> (<span class="id">path_lt_head</span><span class="id"> wa</span>)<span class="id">//=</span><span class="id"> ys'</span><span class="id"> andbT</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> variationD</span><span class="id"> //;</span><span class="id"> [exact:</span><span class="id"> le_variation</span><span class="id"> |</span><span class="id"> exact:</span><span class="id"> itv_partition1]</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> variation</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> bounded_variation</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {R</span><span class="id"> :</span><span class="id"> realType}</span>.<br/>
<span class="vernacular">Implicit</span><span class="gallina-kwd"> Type</span> (<span class="id">a</span><span class="id"> b</span><span class="id"> :</span><span class="id"> R</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> R</span>).<br/>
<br/>
<span class="vernacular">Definition</span><span class="id"> variations</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span><span class="id"> :=</span><span class="id"> [set</span><span class="id"> variation</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span><span class="id"> l</span><span class="id"> |</span><span class="id"> l</span><span class="gallina-kwd"> in</span><span class="id"> itv_partition</span><span class="id"> a</span><span class="id"> b]</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> variations_variation</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span><span class="id"> s</span><span class="id"> :</span><span class="id"> itv_partition</span><span class="id"> a</span><span class="id"> b</span><span class="id"> s</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">variations</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span> (<span class="id">variation</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span><span class="id"> s</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> abs;</span><span class="gallina-kwd"> exists</span><span class="id"> s</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> variations_neq0</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span><span class="id"> :</span><span class="id"> a</span><span class="id"> &lt;</span><span class="id"> b</span><span class="id"> -&gt;</span><span class="id"> variations</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span><span class="id"> !=set0</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> ab;</span><span class="gallina-kwd"> exists</span> (<span class="id">variation</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span><span class="id"> [::</span><span class="id"> b]</span>)<span class="id">;</span><span class="gallina-kwd"> exists</span><span class="id"> [::</span><span class="id"> b]</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
<span class="id">exact:</span><span class="id"> itv_partition1</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> variationsN</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span><span class="id"> :</span><span class="id"> variations</span><span class="id"> a</span><span class="id"> b</span> (<span class="id">\-</span><span class="id"> f</span>)<span class="id"> =</span><span class="id"> variations</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">apply/seteqP;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> [_</span><span class="id"> [s</span><span class="id"> abs]</span><span class="id"> &lt;-|r</span><span class="id"> [s</span><span class="id"> abs]]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> variationN;</span><span class="id"> exact:</span><span class="id"> variations_variation</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -variationN</span><span class="id"> =&gt;</span><span class="id"> &lt;-;</span><span class="id"> exact:</span><span class="id"> variations_variation</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> variationsxx</span><span class="id"> a</span><span class="id"> f</span><span class="id"> :</span><span class="id"> variations</span><span class="id"> a</span><span class="id"> a</span><span class="id"> f</span><span class="id"> =</span><span class="id"> [set</span><span class="id"> 0]</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">apply/seteqP;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> [x</span><span class="id"> [_</span><span class="id"> /itv_partitionxx</span><span class="id"> -&gt;]|x</span><span class="id"> -&gt;]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /variation</span><span class="id"> big_nil</span><span class="id"> =&gt;</span><span class="id"> &lt;-</span>.<br/>
<span class="gallina-kwd">by</span><span class="gallina-kwd"> exists</span><span class="id"> [::]</span><span class="id"> =&gt;</span><span class="id"> //=;</span><span class="id"> rewrite</span><span class="id"> /variation</span><span class="id"> /=</span><span class="id"> big_nil</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Definition</span><span class="id"> bounded_variation</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span><span class="id"> :=</span><span class="id"> has_ubound</span> (<span class="id">variations</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span>).<br/>
<br/>
<span class="vernacular">Notation</span><span class="id"> BV</span><span class="id"> :=</span><span class="id"> bounded_variation</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> bounded_variationxx</span><span class="id"> a</span><span class="id"> f</span><span class="id"> :</span><span class="id"> BV</span><span class="id"> a</span><span class="id"> a</span><span class="id"> f</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="gallina-kwd"> exists</span><span class="id"> 0</span><span class="id"> =&gt;</span><span class="id"> r;</span><span class="id"> rewrite</span><span class="id"> variationsxx</span><span class="id"> =&gt;</span><span class="id"> -&gt;</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> bounded_variationD</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span><span class="id"> g</span><span class="id"> :</span><span class="id"> a</span><span class="id"> &lt;</span><span class="id"> b</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">BV</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span><span class="id"> -&gt;</span><span class="id"> BV</span><span class="id"> a</span><span class="id"> b</span><span class="id"> g</span><span class="id"> -&gt;</span><span class="id"> BV</span><span class="id"> a</span><span class="id"> b</span> (<span class="id">f</span><span class="id"> \+</span><span class="id"> g</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> ab</span><span class="id"> [r</span><span class="id"> abfr]</span><span class="id"> [s</span><span class="id"> abgs];</span><span class="gallina-kwd"> exists</span> (<span class="id">r</span><span class="id"> +</span><span class="id"> s</span>)<span class="id"> =&gt;</span><span class="id"> _</span><span class="id"> [l</span><span class="id"> abl]</span><span class="id"> &lt;-</span>.<br/>
<span class="id">apply:</span><span class="id"> le_trans;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> variation_le</span>.<br/>
<span class="id">rewrite</span><span class="id"> lerD//</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> abfr;</span><span class="id"> exact:</span><span class="id"> variations_variation</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> abgs;</span><span class="id"> exact:</span><span class="id"> variations_variation</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> bounded_variationN</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span><span class="id"> :</span><span class="id"> BV</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span><span class="id"> -&gt;</span><span class="id"> BV</span><span class="id"> a</span><span class="id"> b</span> (<span class="id">\-</span><span class="id"> f</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> /bounded_variation</span><span class="id"> variationsN</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> bounded_variationl</span><span class="id"> a</span><span class="id"> c</span><span class="id"> b</span><span class="id"> f</span><span class="id"> :</span><span class="id"> a</span><span class="id"> &lt;=</span><span class="id"> c</span><span class="id"> -&gt;</span><span class="id"> c</span><span class="id"> &lt;=</span><span class="id"> b</span><span class="id"> -&gt;</span><span class="id"> BV</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span><span class="id"> -&gt;</span><span class="id"> BV</span><span class="id"> a</span><span class="id"> c</span><span class="id"> f</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> le_eqVlt</span><span class="id"> =&gt;</span><span class="id"> /predU1P[&lt;-{c}</span><span class="id"> ?</span><span class="id"> ?|ac];</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> bounded_variationxx</span>.<br/>
<span class="id">rewrite</span><span class="id"> le_eqVlt</span><span class="id"> =&gt;</span><span class="id"> /predU1P[&lt;-{b}//|cb]</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> [x</span><span class="id"> Hx];</span><span class="gallina-kwd"> exists</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> _</span><span class="id"> [s</span><span class="id"> acs]</span><span class="id"> &lt;-</span>.<br/>
<span class="id">rewrite</span> (<span class="id">@le_trans</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">variation</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span> (<span class="id">rcons</span><span class="id"> s</span><span class="id"> b</span>)))<span class="id">//;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">apply/Hx/variations_variation;</span><span class="id"> case:</span><span class="id"> acs</span><span class="id"> =&gt;</span><span class="id"> sa</span><span class="id"> /eqP</span><span class="id"> asc</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /itv_partition</span><span class="id"> rcons_path</span><span class="id"> last_rcons</span><span class="id"> sa/=</span><span class="id"> asc</span>.<br/>
<span class="id">rewrite</span><span class="id"> {2}/variation</span><span class="id"> size_rcons</span><span class="id"> -[leLHS]addr0</span><span class="id"> big_nat_recr//=</span><span class="id"> lerD//</span>.<br/>
<span class="id">rewrite</span><span class="id"> /variation</span><span class="id"> !big_nat</span><span class="id"> ler_sum//</span><span class="id"> =&gt;</span><span class="id"> k;</span><span class="id"> rewrite</span><span class="id"> leq0n</span><span class="id"> /=</span><span class="id"> =&gt;</span><span class="id"> ks</span>.<br/>
<span class="id">rewrite</span><span class="id"> nth_rcons//</span><span class="id"> ks</span><span class="id"> -cats1</span><span class="id"> -cat_cons</span><span class="id"> nth_cat</span><span class="id"> /=</span><span class="id"> ltnS</span> (<span class="id">ltnW</span><span class="id"> ks</span>).<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> ![in</span><span class="id"> leRHS]</span>(<span class="id">set_nth_default</span><span class="id"> c</span>)<span class="id">//=</span><span class="id"> ltnS</span><span class="id"> ltnW</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> bounded_variationr</span><span class="id"> a</span><span class="id"> c</span><span class="id"> b</span><span class="id"> f</span><span class="id"> :</span><span class="id"> a</span><span class="id"> &lt;=</span><span class="id"> c</span><span class="id"> -&gt;</span><span class="id"> c</span><span class="id"> &lt;=</span><span class="id"> b</span><span class="id"> -&gt;</span><span class="id"> BV</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span><span class="id"> -&gt;</span><span class="id"> BV</span><span class="id"> c</span><span class="id"> b</span><span class="id"> f</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> le_eqVlt</span><span class="id"> =&gt;</span><span class="id"> /predU1P[&lt;-{c}//|ac]</span>.<br/>
<span class="id">rewrite</span><span class="id"> le_eqVlt</span><span class="id"> =&gt;</span><span class="id"> /predU1P[&lt;-{b}</span><span class="id"> ?|cb];</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> bounded_variationxx</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> [x</span><span class="id"> Hx];</span><span class="gallina-kwd"> exists</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> _</span><span class="id"> [s</span><span class="id"> cbs]</span><span class="id"> &lt;-</span>.<br/>
<span class="id">rewrite</span> (<span class="id">@le_trans</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">variation</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span> (<span class="id">c</span><span class="id"> ::</span><span class="id"> s</span>)))<span class="id">//;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">apply/Hx/variations_variation;</span><span class="id"> case:</span><span class="id"> cbs</span><span class="id"> =&gt;</span><span class="id"> cs</span><span class="id"> csb</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /itv_partition/=</span><span class="id"> ac/=</span><span class="id"> cs</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> {2}/variation/=</span><span class="id"> -[leLHS]add0r</span><span class="id"> big_nat_recl//=</span><span class="id"> lerD</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> variations_opp</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">variations</span> (<span class="id">-</span><span class="id"> b</span>) (<span class="id">-</span><span class="id"> a</span>) (<span class="id">f</span><span class="id"> \o</span><span class="id"> -%R</span>)<span class="id"> =</span><span class="id"> variations</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> eqEsubset;</span><span class="id"> split=&gt;</span><span class="id"> [_</span><span class="id"> [s</span><span class="id"> bas</span><span class="id"> &lt;-]|</span><span class="id"> _</span><span class="id"> [s</span><span class="id"> abs</span><span class="id"> &lt;-]]</span>.<br/>
&nbsp;&nbsp;<span class="id">eexists;</span><span class="id"> last</span><span class="id"> exact:</span><span class="id"> variation_rev_opp</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move/itv_partition_rev</span><span class="id"> :</span><span class="id"> bas;</span><span class="id"> rewrite</span><span class="id"> !opprK</span>.<br/>
<span class="id">eexists;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> exact/esym/variation_opp_rev</span>.<br/>
<span class="id">exact:</span><span class="id"> itv_partition_rev</span><span class="id"> abs</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> nondecreasing_bounded_variation</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">{in</span><span class="id"> `[a,</span><span class="id"> b]</span><span class="id"> &amp;,</span><span class="id"> {homo</span><span class="id"> f</span><span class="id"> :</span><span class="id"> x</span><span class="id"> y</span><span class="id"> /</span><span class="id"> x</span><span class="id"> &lt;=</span><span class="id"> y}}</span><span class="id"> -&gt;</span><span class="id"> BV</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> incf;</span><span class="gallina-kwd"> exists</span> (<span class="id">f</span><span class="id"> b</span><span class="id"> -</span><span class="id"> f</span><span class="id"> a</span>)<span class="id"> =&gt;</span><span class="id"> ?</span><span class="id"> [l</span><span class="id"> pabl</span><span class="id"> &lt;-];</span><span class="id"> rewrite</span><span class="id"> le_eqVlt</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> nondecreasing_variation//</span><span class="id"> eqxx</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> bounded_variation</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> total_variation</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {R</span><span class="id"> :</span><span class="id"> realType}</span>.<br/>
<span class="vernacular">Implicit</span><span class="id"> Types</span> (<span class="id">a</span><span class="id"> b</span><span class="id"> :</span><span class="id"> R</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> R</span>).<br/>
<br/>
<span class="vernacular">Definition</span><span class="id"> total_variation</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">ereal_sup</span><span class="id"> [set</span><span class="id"> x%:E</span><span class="id"> |</span><span class="id"> x</span><span class="gallina-kwd"> in</span><span class="id"> variations</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f]</span>.<br/>
<br/>
<span class="vernacular">Notation</span><span class="id"> BV</span><span class="id"> :=</span><span class="id"> bounded_variation</span>.<br/>
<span class="vernacular">Notation</span><span class="id"> TV</span><span class="id"> :=</span><span class="id"> total_variation</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> total_variationxx</span><span class="id"> a</span><span class="id"> f</span><span class="id"> :</span><span class="id"> TV</span><span class="id"> a</span><span class="id"> a</span><span class="id"> f</span><span class="id"> =</span><span class="id"> 0%E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> /total_variation</span><span class="id"> variationsxx</span><span class="id"> image_set1</span><span class="id"> ereal_sup1</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> total_variation_ge</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span><span class="id"> :</span><span class="id"> a</span><span class="id"> &lt;=</span><span class="id"> b</span><span class="id"> -&gt;</span> (<span class="id">`|f</span><span class="id"> b</span><span class="id"> -</span><span class="id"> f</span><span class="id"> a|%:E</span><span class="id"> &lt;=</span><span class="id"> TV</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span>)<span class="id">%E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> le_eqVlt</span><span class="id"> =&gt;</span><span class="id"> /predU1P[&lt;-{b}|ab]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> total_variationxx</span><span class="id"> subrr</span><span class="id"> normr0</span>.<br/>
<span class="id">apply:</span><span class="id"> ereal_sup_ubound</span><span class="id"> =&gt;</span><span class="id"> /=;</span><span class="gallina-kwd"> exists</span> (<span class="id">variation</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span><span class="id"> [::</span><span class="id"> b]</span>).<br/>
&nbsp;&nbsp;<span class="id">exact/variations_variation/itv_partition1</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /variation/=</span><span class="id"> big_nat_recr//=</span><span class="id"> big_nil</span><span class="id"> add0r</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> total_variation_ge0</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span><span class="id"> :</span><span class="id"> a</span><span class="id"> &lt;=</span><span class="id"> b</span><span class="id"> -&gt;</span> (<span class="id">0</span><span class="id"> &lt;=</span><span class="id"> TV</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span>)<span class="id">%E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> ab;</span><span class="id"> rewrite</span> (<span class="id">le_trans</span><span class="id"> _</span> (<span class="id">total_variation_ge</span><span class="id"> _</span><span class="id"> ab</span>)). Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> bounded_variationP</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span><span class="id"> :</span><span class="id"> a</span><span class="id"> &lt;=</span><span class="id"> b</span><span class="id"> -&gt;</span><span class="id"> BV</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span><span class="id"> &lt;-&gt;</span><span class="id"> TV</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span><span class="id"> \is</span><span class="id"> a</span><span class="id"> fin_num</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> le_eqVlt</span><span class="id"> =&gt;</span><span class="id"> /predU1P[&lt;-{b}|ab]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> total_variationxx;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> ?;</span><span class="id"> exact:</span><span class="id"> bounded_variationxx</span>.<br/>
<span class="id">rewrite</span><span class="id"> ge0_fin_numE;</span><span class="id"> last</span><span class="id"> exact/total_variation_ge0/ltW</span>.<br/>
<span class="id">split=&gt;</span><span class="id"> [abf|]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /total_variation</span><span class="id"> ereal_sup_EFin</span><span class="id"> ?ltry//;</span><span class="id"> exact:</span><span class="id"> variations_neq0</span>.<br/>
<span class="id">rewrite</span><span class="id"> /total_variation</span><span class="id"> /bounded_variation</span><span class="id"> ltey</span><span class="id"> =&gt;</span><span class="id"> /eqP;</span><span class="id"> apply:</span><span class="id"> contra_notP</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> move/hasNub_ereal_sup;</span><span class="id"> apply;</span><span class="id"> exact:</span><span class="id"> variations_neq0</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> nondecreasing_total_variation</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span><span class="id"> :</span><span class="id"> a</span><span class="id"> &lt;=</span><span class="id"> b</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">{in</span><span class="id"> `[a,</span><span class="id"> b]</span><span class="id"> &amp;,</span><span class="id"> nondecreasing_fun</span><span class="id"> f}</span><span class="id"> -&gt;</span><span class="id"> TV</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span><span class="id"> =</span> (<span class="id">f</span><span class="id"> b</span><span class="id"> -</span><span class="id"> f</span><span class="id"> a</span>)<span class="id">%:E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> le_eqVlt</span><span class="id"> =&gt;</span><span class="id"> /predU1P[&lt;-{b}</span><span class="id"> ?|ab</span><span class="id"> ndf]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> total_variationxx</span><span class="id"> subrr</span>.<br/>
<span class="id">rewrite</span><span class="id"> /total_variation</span><span class="id"> [X</span><span class="gallina-kwd"> in</span><span class="id"> ereal_sup</span><span class="id"> X]</span>(_<span class="id"> :</span><span class="id"> _</span><span class="id"> =</span><span class="id"> [set</span> (<span class="id">f</span><span class="id"> b</span><span class="id"> -</span><span class="id"> f</span><span class="id"> a</span>)<span class="id">%:E]</span>).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> ereal_sup1</span>.<br/>
<span class="id">apply/seteqP;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> [x/=</span><span class="id"> [s</span><span class="id"> [t</span><span class="id"> abt</span><span class="id"> &lt;-{s}</span><span class="id"> &lt;-{x}]]|x/=</span><span class="id"> -&gt;{x}]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> nondecreasing_variation</span>.<br/>
<span class="gallina-kwd">exists</span> (<span class="id">variation</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span><span class="id"> [::</span><span class="id"> b]</span>)<span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="id">exact/variations_variation/itv_partition1</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> nondecreasing_variation//;</span><span class="id"> exact:</span><span class="id"> itv_partition1</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> total_variationN</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span><span class="id"> :</span><span class="id"> TV</span><span class="id"> a</span><span class="id"> b</span> (<span class="id">\-</span><span class="id"> f</span>)<span class="id"> =</span><span class="id"> TV</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> /TV;</span><span class="id"> rewrite</span><span class="id"> variationsN</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> total_variation_le</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span><span class="id"> g</span><span class="id"> :</span><span class="id"> a</span><span class="id"> &lt;=</span><span class="id"> b</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;(<span class="id">TV</span><span class="id"> a</span><span class="id"> b</span> (<span class="id">f</span><span class="id"> \+</span><span class="id"> g</span>)<span class="id">%R</span><span class="id"> &lt;=</span><span class="id"> TV</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span><span class="id"> +</span><span class="id"> TV</span><span class="id"> a</span><span class="id"> b</span><span class="id"> g</span>)<span class="id">%E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> le_eqVlt</span><span class="id"> =&gt;</span><span class="id"> /predU1P[&lt;-{b}|ab]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> !total_variationxx</span><span class="id"> adde0</span>.<br/>
<span class="id">have</span><span class="id"> [abf|abf]</span><span class="id"> :=</span><span class="id"> pselect</span> (<span class="id">BV</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span>)<span class="id">;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> {2}/total_variation</span><span class="id"> hasNub_ereal_sup//;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> variations_neq0</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> addye</span><span class="id"> ?leey//</span><span class="id"> -ltNye</span> (<span class="id">@lt_le_trans</span><span class="id"> _</span><span class="id"> _</span><span class="id"> 0%E</span>)<span class="id">//</span>.<br/>
&nbsp;&nbsp;<span class="id">exact/total_variation_ge0/ltW</span>.<br/>
<span class="id">have</span><span class="id"> [abg|abg]</span><span class="id"> :=</span><span class="id"> pselect</span> (<span class="id">BV</span><span class="id"> a</span><span class="id"> b</span><span class="id"> g</span>)<span class="id">;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> {3}/total_variation</span><span class="id"> hasNub_ereal_sup//;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> variations_neq0</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> addey</span><span class="id"> ?leey//</span><span class="id"> -ltNye</span> (<span class="id">@lt_le_trans</span><span class="id"> _</span><span class="id"> _</span><span class="id"> 0%E</span>)<span class="id">//</span>.<br/>
&nbsp;&nbsp;<span class="id">exact/total_variation_ge0/ltW</span>.<br/>
<span class="id">move:</span><span class="id"> abf</span><span class="id"> abg</span><span class="id"> =&gt;</span><span class="id"> [r</span><span class="id"> abfr]</span><span class="id"> [s</span><span class="id"> abgs]</span>.<br/>
<span class="id">have</span><span class="id"> BVabfg</span><span class="id"> :</span><span class="id"> BV</span><span class="id"> a</span><span class="id"> b</span> (<span class="id">f</span><span class="id"> \+</span><span class="id"> g</span>).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> bounded_variationD</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> [exists</span><span class="id"> r|exists</span><span class="id"> s]</span>.<br/>
<span class="id">apply:</span><span class="id"> ub_ereal_sup</span><span class="id"> =&gt;</span><span class="id"> y</span><span class="id"> /=</span><span class="id"> [r'</span><span class="id"> [s'</span><span class="id"> abs</span><span class="id"> &lt;-{r'}</span><span class="id"> &lt;-{y}]]</span>.<br/>
<span class="id">apply:</span> (<span class="id">@le_trans</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">variation</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span><span class="id"> s'</span><span class="id"> +</span><span class="id"> variation</span><span class="id"> a</span><span class="id"> b</span><span class="id"> g</span><span class="id"> s'</span>)<span class="id">%:E</span>).<br/>
&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> variation_le</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> EFinD</span><span class="id"> leeD//</span><span class="id"> ereal_sup_le//;</span><br/>
&nbsp;&nbsp;(<span class="id">eexists;</span><span class="id"> last</span><span class="id"> exact:</span><span class="id"> lexx</span>)<span class="id">;</span> (<span class="id">eexists;</span><span class="id"> last</span><span class="id"> reflexivity</span>)<span class="id">;</span><br/>
&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> variations_variation</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Let</span><span class="id"> total_variationD1</span><span class="id"> a</span><span class="id"> b</span><span class="id"> c</span><span class="id"> f</span><span class="id"> :</span><span class="id"> a</span><span class="id"> &lt;=</span><span class="id"> c</span><span class="id"> -&gt;</span><span class="id"> c</span><span class="id"> &lt;=</span><span class="id"> b</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;(<span class="id">TV</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span><span class="id"> &gt;=</span><span class="id"> TV</span><span class="id"> a</span><span class="id"> c</span><span class="id"> f</span><span class="id"> +</span><span class="id"> TV</span><span class="id"> c</span><span class="id"> b</span><span class="id"> f</span>)<span class="id">%E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> le_eqVlt=&gt;</span><span class="id"> /predU1P[&lt;-{c}|ac];</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> total_variationxx</span><span class="id"> add0e</span>.<br/>
<span class="id">rewrite</span><span class="id"> le_eqVlt=&gt;</span><span class="id"> /predU1P[&lt;-{b}|cb];</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> total_variationxx</span><span class="id"> adde0</span>.<br/>
<span class="id">have</span><span class="id"> [abf|abf]</span><span class="id"> :=</span><span class="id"> pselect</span> (<span class="id">BV</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span>)<span class="id">;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> {3}/total_variation</span><span class="id"> hasNub_ereal_sup</span><span class="id"> ?leey//</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> variations_neq0</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> rewrite</span> (<span class="id">lt_trans</span><span class="id"> ac</span>).<br/>
<span class="id">have</span><span class="id"> H</span><span class="id"> s</span><span class="id"> t</span><span class="id"> :</span><span class="id"> itv_partition</span><span class="id"> a</span><span class="id"> c</span><span class="id"> s</span><span class="id"> -&gt;</span><span class="id"> itv_partition</span><span class="id"> c</span><span class="id"> b</span><span class="id"> t</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">TV</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span><span class="id"> &gt;=</span> (<span class="id">variation</span><span class="id"> a</span><span class="id"> c</span><span class="id"> f</span><span class="id"> s</span>)<span class="id">%:E</span><span class="id"> +</span> (<span class="id">variation</span><span class="id"> c</span><span class="id"> b</span><span class="id"> f</span><span class="id"> t</span>)<span class="id">%:E</span>)<span class="id">%E</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> acs</span><span class="id"> cbt;</span><span class="id"> rewrite</span><span class="id"> -EFinD;</span><span class="id"> apply:</span><span class="id"> ereal_sup_le</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">exists</span> (<span class="id">variation</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span> (<span class="id">s</span><span class="id"> ++</span><span class="id"> t</span>))<span class="id">%:E</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">eexists;</span><span class="id"> last</span><span class="id"> reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="gallina-kwd"> exists</span> (<span class="id">s</span><span class="id"> ++</span><span class="id"> t</span>)<span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> itv_partition_cat</span><span class="id"> acs</span><span class="id"> cbt</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> variationD//</span><span class="id"> ltW</span>.<br/>
<span class="id">rewrite</span><span class="id"> [leRHS]ereal_sup_EFin//;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> variations_neq0;</span><span class="id"> rewrite</span> (<span class="id">lt_trans</span><span class="id"> ac</span>).<br/>
<span class="id">have</span><span class="id"> acf</span><span class="id"> :</span><span class="id"> BV</span><span class="id"> a</span><span class="id"> c</span><span class="id"> f</span><span class="id"> :=</span><span class="id"> bounded_variationl</span> (<span class="id">ltW</span><span class="id"> ac</span>) (<span class="id">ltW</span><span class="id"> cb</span>)<span class="id"> abf</span>.<br/>
<span class="id">have</span><span class="id"> cbf</span><span class="id"> :</span><span class="id"> BV</span><span class="id"> c</span><span class="id"> b</span><span class="id"> f</span><span class="id"> :=</span><span class="id"> bounded_variationr</span> (<span class="id">ltW</span><span class="id"> ac</span>) (<span class="id">ltW</span><span class="id"> cb</span>)<span class="id"> abf</span>.<br/>
<span class="id">rewrite</span><span class="id"> {1</span><span class="id"> 2}/total_variation</span><span class="id"> ereal_sup_EFin//;</span><span class="id"> last</span><span class="id"> exact:</span><span class="id"> variations_neq0</span>.<br/>
<span class="id">rewrite</span><span class="id"> ereal_sup_EFin//;</span><span class="id"> last</span><span class="id"> exact:</span><span class="id"> variations_neq0</span>.<br/>
<span class="id">rewrite</span><span class="id"> -EFinD</span><span class="id"> -sup_sumE;</span><span class="id"> last</span><span class="id"> 2</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> variations_neq0</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> variations_neq0</span>.<br/>
<span class="id">apply:</span><span class="id"> le_sup</span>.<br/>
<span class="id">-</span><span class="id"> move=&gt;</span><span class="id"> r/=</span><span class="id"> [s</span><span class="id"> [l'</span><span class="id"> acl'</span><span class="id"> &lt;-{s}]]</span><span class="id"> [t</span><span class="id"> [l</span><span class="id"> cbl]</span><span class="id"> &lt;-{t}</span><span class="id"> &lt;-{r}]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">exists</span> (<span class="id">variation</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span> (<span class="id">l'</span><span class="id"> ++</span><span class="id"> l</span>))<span class="id">;</span><span class="id"> split;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> variationD//</span><span class="id"> ltW</span>.<br/>
&nbsp;&nbsp;<span class="id">exact/variations_variation/</span>(<span class="id">itv_partition_cat</span><span class="id"> acl'</span><span class="id"> cbl</span>).<br/>
<span class="id">-</span><span class="id"> have</span><span class="id"> [r</span><span class="id"> acfr]</span><span class="id"> :=</span><span class="id"> variations_neq0</span><span class="id"> f</span><span class="id"> ac</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> [s</span><span class="id"> cbfs]</span><span class="id"> :=</span><span class="id"> variations_neq0</span><span class="id"> f</span><span class="id"> cb</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="gallina-kwd"> exists</span> (<span class="id">r</span><span class="id"> +</span><span class="id"> s</span>)<span class="id">;</span><span class="gallina-kwd"> exists</span><span class="id"> r</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="gallina-kwd"> exists</span><span class="id"> s</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> apply:</span><span class="id"> variations_neq0;</span><span class="id"> rewrite</span> (<span class="id">lt_trans</span><span class="id"> ac</span>).<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Let</span><span class="id"> total_variationD2</span><span class="id"> a</span><span class="id"> b</span><span class="id"> c</span><span class="id"> f</span><span class="id"> :</span><span class="id"> a</span><span class="id"> &lt;=</span><span class="id"> c</span><span class="id"> -&gt;</span><span class="id"> c</span><span class="id"> &lt;=</span><span class="id"> b</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;(<span class="id">TV</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span><span class="id"> &lt;=</span><span class="id"> TV</span><span class="id"> a</span><span class="id"> c</span><span class="id"> f</span><span class="id"> +</span><span class="id"> TV</span><span class="id"> c</span><span class="id"> b</span><span class="id"> f</span>)<span class="id">%E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> le_eqVlt</span><span class="id"> =&gt;</span><span class="id"> /predU1P[&lt;-{c}|ac];</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> total_variationxx</span><span class="id"> add0e</span>.<br/>
<span class="id">rewrite</span><span class="id"> le_eqVlt</span><span class="id"> =&gt;</span><span class="id"> /predU1P[&lt;-{b}|cb];</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> total_variationxx</span><span class="id"> adde0</span>.<br/>
<span class="id">case</span><span class="id"> :</span> (<span class="id">pselect</span> (<span class="id">bounded_variation</span><span class="id"> a</span><span class="id"> c</span><span class="id"> f</span>))<span class="id">;</span><span class="id"> first</span><span class="id"> last</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> nbdac;</span><span class="id"> have</span><span class="id"> /eqP</span><span class="id"> -&gt;</span><span class="id"> :</span><span class="id"> TV</span><span class="id"> a</span><span class="id"> c</span><span class="id"> f</span><span class="id"> ==</span><span class="id"> +oo%E</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">have:</span> (<span class="id">-oo</span><span class="id"> &lt;</span><span class="id"> TV</span><span class="id"> a</span><span class="id"> c</span><span class="id"> f</span>)<span class="id">%E</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span> (<span class="id">lt_le_trans</span><span class="id"> _</span> (<span class="id">total_variation_ge0</span><span class="id"> f</span> (<span class="id">ltW</span><span class="id"> ac</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> ltNye_eq</span><span class="id"> =&gt;</span><span class="id"> /orP</span><span class="id"> []</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> /bounded_variationP</span><span class="id"> =&gt;</span><span class="id"> /</span>(_ (<span class="id">ltW</span><span class="id"> ac</span>)).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> addye</span><span class="id"> ?leey</span><span class="id"> //</span><span class="id"> -ltNye</span> (<span class="id">@lt_le_trans</span><span class="id"> _</span><span class="id"> _</span><span class="id"> 0</span>)<span class="id">%E</span><span class="id"> //</span><span class="id"> ?total_variation_ge0</span><span class="id"> //</span><span class="id"> ltW</span>.<br/>
<span class="id">case</span><span class="id"> :</span> (<span class="id">pselect</span> (<span class="id">bounded_variation</span><span class="id"> c</span><span class="id"> b</span><span class="id"> f</span>))<span class="id">;</span><span class="id"> first</span><span class="id"> last</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> nbdac;</span><span class="id"> have</span><span class="id"> /eqP</span><span class="id"> -&gt;</span><span class="id"> :</span><span class="id"> TV</span><span class="id"> c</span><span class="id"> b</span><span class="id"> f</span><span class="id"> ==</span><span class="id"> +oo%E</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">have:</span> (<span class="id">-oo</span><span class="id"> &lt;</span><span class="id"> TV</span><span class="id"> c</span><span class="id"> b</span><span class="id"> f</span>)<span class="id">%E</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exact:</span> (<span class="id">lt_le_trans</span><span class="id"> _</span> (<span class="id">total_variation_ge0</span><span class="id"> f</span> (<span class="id">ltW</span><span class="id"> cb</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> ltNye_eq</span><span class="id"> =&gt;</span><span class="id"> /orP</span><span class="id"> []</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> /bounded_variationP</span><span class="id"> =&gt;</span><span class="id"> /</span>(_ (<span class="id">ltW</span><span class="id"> cb</span>)).<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> addey</span><span class="id"> ?leey</span><span class="id"> //</span><span class="id"> -ltNye</span> (<span class="id">@lt_le_trans</span><span class="id"> _</span><span class="id"> _</span><span class="id"> 0%E</span>)<span class="id">//</span>.<br/>
&nbsp;&nbsp;<span class="id">exact/total_variation_ge0/ltW</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> bdAB</span><span class="id"> bdAC</span>.<br/>
<span class="id">rewrite</span><span class="id"> /total_variation</span><span class="id"> [x</span><span class="gallina-kwd"> in</span> (<span class="id">x</span><span class="id"> +</span><span class="id"> _</span>)<span class="id">%E]ereal_sup_EFin</span><span class="id"> //;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> variations_neq0</span>.<br/>
<span class="id">rewrite</span><span class="id"> [x</span><span class="gallina-kwd"> in</span> (_<span class="id"> +</span><span class="id"> x</span>)<span class="id">%E]ereal_sup_EFin</span><span class="id"> //;</span><span class="id"> last</span><span class="id"> exact:</span><span class="id"> variations_neq0</span>.<br/>
<span class="id">rewrite</span><span class="id"> -EFinD</span><span class="id"> -sup_sumE</span><span class="id"> /has_sup;</span><span class="id"> [|</span>(<span class="gallina-kwd">by</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> variations_neq0</span>)..<span class="id">]</span>.<br/>
<span class="id">apply:</span><span class="id"> ub_ereal_sup</span><span class="id"> =&gt;</span><span class="id"> ?</span><span class="id"> [?</span><span class="id"> [l</span><span class="id"> pacl</span><span class="id"> &lt;-</span><span class="id"> &lt;-]];</span><span class="id"> rewrite</span><span class="id"> lee_fin</span>.<br/>
<span class="id">apply:</span> (<span class="id">le_trans</span> (<span class="id">variation_itv_partitionLR</span><span class="id"> _</span><span class="id"> ac</span><span class="id"> _</span><span class="id"> _</span>))<span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
<span class="id">apply:</span><span class="id"> sup_ubound</span><span class="id"> =&gt;</span><span class="id"> /=</span>.<br/>
&nbsp;&nbsp;<span class="id">case:</span><span class="id"> bdAB</span><span class="id"> =&gt;</span><span class="id"> M</span><span class="id"> ubdM;</span><span class="id"> case:</span><span class="id"> bdAC</span><span class="id"> =&gt;</span><span class="id"> N</span><span class="id"> ubdN;</span><span class="gallina-kwd"> exists</span> (<span class="id">N</span><span class="id"> +</span><span class="id"> M</span>).<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> q</span><span class="id"> [?]</span><span class="id"> [i</span><span class="id"> pabi</span><span class="id"> &lt;-]</span><span class="id"> [?</span><span class="id"> [j</span><span class="id"> pbcj</span><span class="id"> &lt;-]]</span><span class="id"> &lt;-</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> lerD;</span><span class="id"> [apply:</span><span class="id"> ubdN;exists</span><span class="id"> i|apply:ubdM;exists</span><span class="id"> j]</span>.<br/>
<span class="gallina-kwd">exists</span> (<span class="id">variation</span><span class="id"> a</span><span class="id"> c</span><span class="id"> f</span> (<span class="id">itv_partitionL</span><span class="id"> l</span><span class="id"> c</span>)).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> variations_variation;</span><span class="id"> exact:</span><span class="id"> itv_partitionLP</span><span class="id"> pacl</span>.<br/>
<span class="gallina-kwd">exists</span> (<span class="id">variation</span><span class="id"> c</span><span class="id"> b</span><span class="id"> f</span> (<span class="id">itv_partitionR</span><span class="id"> l</span><span class="id"> c</span>)).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> variations_variation;</span><span class="id"> exact:</span><span class="id"> itv_partitionRP</span><span class="id"> pacl</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> variationD//</span><span class="id"> ?ltW//;</span><br/>
&nbsp;&nbsp;<span class="id">[exact:</span><span class="id"> itv_partitionLP</span><span class="id"> pacl|exact:</span><span class="id"> itv_partitionRP</span><span class="id"> pacl]</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> total_variationD</span><span class="id"> a</span><span class="id"> b</span><span class="id"> c</span><span class="id"> f</span><span class="id"> :</span><span class="id"> a</span><span class="id"> &lt;=</span><span class="id"> c</span><span class="id"> -&gt;</span><span class="id"> c</span><span class="id"> &lt;=</span><span class="id"> b</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;(<span class="id">TV</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span><span class="id"> =</span><span class="id"> TV</span><span class="id"> a</span><span class="id"> c</span><span class="id"> f</span><span class="id"> +</span><span class="id"> TV</span><span class="id"> c</span><span class="id"> b</span><span class="id"> f</span>)<span class="id">%E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> ac</span><span class="id"> cb;</span><span class="id"> apply/eqP;</span><span class="id"> rewrite</span><span class="id"> eq_le;</span><span class="id"> apply/andP;</span><span class="id"> split;</span><br/>
&nbsp;&nbsp;<span class="id">[exact:</span><span class="id"> total_variationD2|exact:</span><span class="id"> total_variationD1]</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> total_variation</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> variation_continuity</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {R</span><span class="id"> :</span><span class="id"> realType}</span>.<br/>
<span class="vernacular">Implicit</span><span class="gallina-kwd"> Type</span><span class="id"> f</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> R</span>.<br/>
<br/>
<span class="vernacular">Notation</span><span class="id"> BV</span><span class="id"> :=</span><span class="id"> bounded_variation</span>.<br/>
<span class="vernacular">Notation</span><span class="id"> TV</span><span class="id"> :=</span><span class="id"> total_variation</span>.<br/>
<br/>
<span class="vernacular">Definition</span><span class="id"> neg_tv</span><span class="id"> a</span><span class="id"> f</span> (<span class="id">x</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span><span class="id"> \bar</span><span class="id"> R</span><span class="id"> :=</span> ((<span class="id">TV</span><span class="id"> a</span><span class="id"> x</span><span class="id"> f</span><span class="id"> -</span> (<span class="id">f</span><span class="id"> x</span>)<span class="id">%:E</span>)<span class="id"> *</span><span class="id"> 2^-1%:E</span>)<span class="id">%E</span>.<br/>
<br/>
<span class="vernacular">Definition</span><span class="id"> pos_tv</span><span class="id"> a</span><span class="id"> f</span> (<span class="id">x</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span><span class="id"> \bar</span><span class="id"> R</span><span class="id"> :=</span><span class="id"> neg_tv</span><span class="id"> a</span> (<span class="id">\-</span><span class="id"> f</span>)<span class="id"> x</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> total_variation_nondecreasing</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">{in</span><span class="id"> `[a,</span><span class="id"> b]</span><span class="id"> &amp;,</span><span class="id"> nondecreasing_fun</span> (<span class="id">TV</span><span class="id"> a</span><span class="id"> ^~</span><span class="id"> f</span>)<span class="id">}</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> x</span><span class="id"> y;</span><span class="id"> rewrite</span><span class="id"> !in_itv/=</span><span class="id"> =&gt;</span><span class="id"> /andP[ax</span><span class="id"> xb]</span><span class="id"> /andP[ay</span><span class="id"> yb]</span><span class="id"> xy</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span> (<span class="id">total_variationD</span><span class="id"> f</span><span class="id"> ax</span><span class="id"> xy</span>)<span class="id">//</span><span class="id"> leeDl//</span><span class="id"> total_variation_ge0</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> total_variation_bounded_variation</span><span class="id"> a</span><span class="id"> b</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> R</span>)<span class="id"> :</span><span class="id"> a</span><span class="id"> &lt;=</span><span class="id"> b</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">BV</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">BV</span><span class="id"> a</span><span class="id"> b</span> (<span class="id">fine</span><span class="id"> \o</span><span class="id"> TV</span><span class="id"> a</span><span class="id"> ^~</span><span class="id"> f</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> ab</span><span class="id"> BVf;</span><span class="id"> apply/bounded_variationP</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
<span class="id">rewrite</span><span class="id"> ge0_fin_numE;</span><span class="id"> last</span><span class="id"> exact:</span><span class="id"> total_variation_ge0</span>.<br/>
<span class="id">rewrite</span><span class="id"> nondecreasing_total_variation/=</span><span class="id"> ?ltry//</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> x</span><span class="id"> y;</span><span class="id"> rewrite</span><span class="id"> !in_itv!/=</span><span class="id"> =&gt;</span><span class="id"> /andP[ax</span><span class="id"> xb]</span><span class="id"> /andP[ay</span><span class="id"> yb]</span><span class="id"> xy</span>.<br/>
<span class="id">apply:</span><span class="id"> fine_le</span>.<br/>
<span class="id">-</span><span class="id"> exact/</span>(<span class="id">bounded_variationP</span><span class="id"> _</span><span class="id"> ax</span>)<span class="id">/</span>(<span class="id">bounded_variationl</span><span class="id"> ax</span><span class="id"> xb</span>).<br/>
<span class="id">-</span><span class="id"> exact/</span>(<span class="id">bounded_variationP</span><span class="id"> _</span><span class="id"> ay</span>)<span class="id">/</span>(<span class="id">bounded_variationl</span><span class="id"> ay</span><span class="id"> yb</span>).<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span> (<span class="id">@total_variation_nondecreasing</span><span class="id"> _</span><span class="id"> b</span>)<span class="id">;</span><span class="id"> rewrite</span><span class="id"> ?in_itv</span><span class="id"> //=</span><span class="id"> ?ax</span><span class="id"> ?ay</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> neg_tv_nondecreasing</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">{in</span><span class="id"> `[a,</span><span class="id"> b]</span><span class="id"> &amp;,</span><span class="id"> nondecreasing_fun</span> (<span class="id">neg_tv</span><span class="id"> a</span><span class="id"> f</span>)<span class="id">}</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> x</span><span class="id"> y</span><span class="id"> xab</span><span class="id"> yab</span><span class="id"> xy;</span><span class="id"> have</span><span class="id"> ax</span><span class="id"> :</span><span class="id"> a</span><span class="id"> &lt;=</span><span class="id"> x</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move:</span><span class="id"> xab;</span><span class="id"> rewrite</span><span class="id"> in_itv</span><span class="id"> //=</span><span class="id"> =&gt;</span><span class="id"> /andP</span><span class="id"> []</span>.<br/>
<span class="id">rewrite</span><span class="id"> /neg_tv</span><span class="id"> lee_pmul2r</span><span class="id"> //</span><span class="id"> leeBrDl</span><span class="id"> //</span><span class="id"> addeCA</span><span class="id"> -EFinB</span>.<br/>
<span class="id">rewrite</span><span class="id"> [TV</span><span class="id"> a</span><span class="id"> y</span><span class="id"> _]</span>(<span class="id">total_variationD</span><span class="id"> _</span><span class="id"> ax</span><span class="id"> xy</span>)<span class="id"> //</span>.<br/>
<span class="id">apply:</span><span class="id"> leeD</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> apply:</span><span class="id"> le_trans;</span><span class="id"> last</span><span class="id"> exact:</span><span class="id"> total_variation_ge</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> lee_fin</span><span class="id"> ler_norm</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> bounded_variation_pos_neg_tvE</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span><span class="id"> :</span><span class="id"> BV</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">{in</span><span class="id"> `[a,</span><span class="id"> b],</span><span class="id"> f</span><span class="id"> =1</span> (<span class="id">fine</span><span class="id"> \o</span><span class="id"> pos_tv</span><span class="id"> a</span><span class="id"> f</span>)<span class="id"> \-</span> (<span class="id">fine</span><span class="id"> \o</span><span class="id"> neg_tv</span><span class="id"> a</span><span class="id"> f</span>)<span class="id">}</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> bdabf</span><span class="id"> x;</span><span class="id"> rewrite</span><span class="id"> in_itv</span><span class="id"> /=</span><span class="id"> =&gt;</span><span class="id"> /andP</span><span class="id"> [ax</span><span class="id"> xb]</span>.<br/>
<span class="id">have</span><span class="id"> ffin:</span><span class="id"> TV</span><span class="id"> a</span><span class="id"> x</span><span class="id"> f</span><span class="id"> \is</span><span class="id"> a</span><span class="id"> fin_num</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="id">apply/bounded_variationP</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="id">exact:</span> (<span class="id">bounded_variationl</span><span class="id"> _</span><span class="id"> xb</span>).<br/>
<span class="id">have</span><span class="id"> Nffin</span><span class="id"> :</span><span class="id"> TV</span><span class="id"> a</span><span class="id"> x</span> (<span class="id">\-</span><span class="id"> f</span>)<span class="id"> \is</span><span class="id"> a</span><span class="id"> fin_num</span>.<br/>
&nbsp;&nbsp;<span class="id">apply/bounded_variationP</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> apply/bounded_variationN</span>.<br/>
&nbsp;&nbsp;<span class="id">exact:</span> (<span class="id">bounded_variationl</span><span class="id"> ax</span><span class="id"> xb</span>).<br/>
<span class="id">rewrite</span><span class="id"> /pos_tv</span><span class="id"> /neg_tv</span><span class="id"> /=</span><span class="id"> total_variationN</span><span class="id"> -fineB</span><span class="id"> -?muleBl</span><span class="id"> //</span><span class="id"> ?fineM</span><span class="id"> //</span>.<br/>
<span class="id">-</span><span class="id"> rewrite</span><span class="id"> addeAC</span><span class="id"> oppeD</span><span class="id"> //=</span><span class="id"> ?fin_num_adde_defl</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> addeA</span><span class="id"> subee</span><span class="id"> //</span><span class="id"> add0e</span><span class="id"> -EFinD</span><span class="id"> //=</span><span class="id"> opprK</span><span class="id"> mulrDl</span><span class="id"> -splitr</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> fin_numB</span><span class="id"> ?fin_numD</span><span class="id"> ?ffin;</span><span class="id"> apply/andP;</span><span class="id"> split</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> fin_num_adde_defl;</span><span class="id"> rewrite</span><span class="id"> fin_numN</span><span class="id"> fin_numD;</span><span class="id"> apply/andP;</span><span class="id"> split</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> fin_numM</span><span class="id"> //</span><span class="id"> fin_numD;</span><span class="id"> apply/andP;</span><span class="id"> split</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> fin_numM</span><span class="id"> //</span><span class="id"> fin_numD;</span><span class="id"> apply/andP;</span><span class="id"> split</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> fine_neg_tv_nondecreasing</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span><span class="id"> :</span><span class="id"> BV</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">{in</span><span class="id"> `[a,</span><span class="id"> b]</span><span class="id"> &amp;,</span><span class="id"> nondecreasing_fun</span> (<span class="id">fine</span><span class="id"> \o</span><span class="id"> neg_tv</span><span class="id"> a</span><span class="id"> f</span>)<span class="id">}</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> bdv</span><span class="id"> p</span><span class="id"> q</span><span class="id"> pab</span><span class="id"> qab</span><span class="id"> pq</span><span class="id"> /=</span>.<br/>
<span class="id">move:</span> (<span class="id">pab</span>) (<span class="id">qab</span>)<span class="id">;</span><span class="id"> rewrite</span><span class="id"> ?in_itv</span><span class="id"> /=</span><span class="id"> =&gt;</span><span class="id"> /andP[ap</span><span class="id"> pb]</span><span class="id"> /andP[aq</span><span class="id"> qb]</span>.<br/>
<span class="id">apply:</span><span class="id"> fine_le;</span><span class="id"> rewrite</span><span class="id"> /neg_tv</span><span class="id"> ?fin_numM</span><span class="id"> //</span><span class="id"> ?fin_numB</span><span class="id"> /=</span>.<br/>
<span class="id">-</span><span class="id"> apply/andP;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> apply/bounded_variationP</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="id">exact:</span> (<span class="id">bounded_variationl</span><span class="id"> _</span><span class="id"> pb</span>).<br/>
<span class="id">-</span><span class="id"> apply/andP;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> apply/bounded_variationP</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="id">exact:</span> (<span class="id">bounded_variationl</span><span class="id"> _</span><span class="id"> qb</span>).<br/>
<span class="id">exact:</span> (<span class="id">neg_tv_nondecreasing</span><span class="id"> _</span><span class="id"> pab</span>).<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> neg_tv_bounded_variation</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span><span class="id"> :</span><span class="id"> BV</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span><span class="id"> -&gt;</span><span class="id"> BV</span><span class="id"> a</span><span class="id"> b</span> (<span class="id">fine</span><span class="id"> \o</span><span class="id"> neg_tv</span><span class="id"> a</span><span class="id"> f</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> ?;</span><span class="id"> apply:</span><span class="id"> nondecreasing_bounded_variation</span>.<br/>
<span class="id">exact:</span><span class="id"> fine_neg_tv_nondecreasing</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> total_variation_right_continuous</span><span class="id"> a</span><span class="id"> b</span><span class="id"> x</span><span class="id"> f</span><span class="id"> :</span><span class="id"> a</span><span class="id"> &lt;=</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> x</span><span class="id"> &lt;</span><span class="id"> b</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">f</span><span class="id"> @</span><span class="id"> x^'+</span><span class="id"> --&gt;</span><span class="id"> f</span><span class="id"> x</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">BV</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">fine</span><span class="id"> \o</span><span class="id"> TV</span><span class="id"> a</span><span class="id"> ^~</span><span class="id"> f</span><span class="id"> @</span><span class="id"> x^'+</span><span class="id"> --&gt;</span><span class="id"> fine</span> (<span class="id">TV</span><span class="id"> a</span><span class="id"> x</span><span class="id"> f</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> ax</span><span class="id"> xb</span><span class="id"> ctsf</span><span class="id"> bvf;</span><span class="id"> have</span><span class="id"> ?</span><span class="id"> :</span><span class="id"> a</span><span class="id"> &lt;=</span><span class="id"> b</span><span class="gallina-kwd"> by</span><span class="id"> apply:ltW;</span><span class="id"> apply:</span> (<span class="id">le_lt_trans</span><span class="id"> ax</span>).<br/>
<span class="id">apply/cvgrPdist_lt=&gt;</span><span class="id"> _/posnumP[eps]</span>.<br/>
<span class="id">have</span><span class="id"> ?</span><span class="id"> :</span><span class="id"> Filter</span> (<span class="id">nbhs</span><span class="id"> x^'+</span>)<span class="gallina-kwd"> by</span><span class="id"> exact:</span><span class="id"> at_right_proper_filter</span>.<br/>
<span class="id">have</span><span class="id"> xbl</span><span class="id"> :=</span><span class="id"> ltW</span><span class="id"> xb</span>.<br/>
<span class="id">have</span><span class="id"> xbfin</span><span class="id"> :</span><span class="id"> TV</span><span class="id"> x</span><span class="id"> b</span><span class="id"> f</span><span class="id"> \is</span><span class="id"> a</span><span class="id"> fin_num</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply/bounded_variationP</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span> (<span class="id">bounded_variationr</span><span class="id"> _</span><span class="id"> _</span><span class="id"> bvf</span>).<br/>
<span class="id">have</span><span class="id"> [//|?]</span><span class="id"> :=</span><span class="id"> @ub_ereal_sup_adherent</span><span class="id"> R</span><span class="id"> _</span> (<span class="id">eps%:num</span><span class="id"> /</span><span class="id"> 2</span>)<span class="id"> _</span><span class="id"> xbfin</span>.<br/>
<span class="id">case=&gt;</span><span class="id"> ?</span><span class="id"> [l</span><span class="id"> +</span><span class="id"> &lt;-</span><span class="id"> &lt;-];</span><span class="id"> rewrite</span><span class="id"> -/</span>(<span class="id">total_variation</span><span class="id"> x</span><span class="id"> b</span><span class="id"> f</span>).<br/>
<span class="id">move:</span><span class="id"> l</span><span class="id"> =&gt;</span><span class="id"> [|i</span><span class="id"> j]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> /itv_partition_nil</span><span class="id"> /eqP;</span><span class="id"> rewrite</span><span class="id"> lt_eqF</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> [/=</span><span class="id"> /andP[xi</span><span class="id"> ij</span><span class="id"> /eqP</span><span class="id"> ijb]]</span><span class="id"> tv_eps</span>.<br/>
<span class="id">apply:</span><span class="id"> filter_app</span> (<span class="id">nbhs_right_ge</span><span class="id"> _</span>).<br/>
<span class="id">apply:</span><span class="id"> filter_app</span> (<span class="id">nbhs_right_lt</span><span class="id"> xi</span>).<br/>
<span class="id">have</span><span class="id"> e20</span><span class="id"> :</span><span class="id"> 0</span><span class="id"> &lt;</span><span class="id"> eps%:num</span><span class="id"> /</span><span class="id"> 2</span><span class="gallina-kwd"> by</span><span class="id"> []</span>.<br/>
<span class="id">move/cvgrPdist_lt/</span>(_ (<span class="id">eps%:num/2</span>)<span class="id"> e20</span>)<span class="id"> :</span><span class="id"> ctsf;</span><span class="id"> apply:</span><span class="id"> filter_app</span>.<br/>
<span class="id">near=&gt;</span><span class="id"> t</span><span class="id"> =&gt;</span><span class="id"> fxt</span><span class="id"> ti</span><span class="id"> xt;</span><span class="id"> have</span><span class="id"> ta</span><span class="id"> :</span><span class="id"> a</span><span class="id"> &lt;=</span><span class="id"> t</span><span class="gallina-kwd"> by</span><span class="id"> exact:</span> (<span class="id">le_trans</span><span class="id"> ax</span>).<br/>
<span class="id">have</span><span class="id"> tb</span><span class="id"> :</span><span class="id"> t</span><span class="id"> &lt;=</span><span class="id"> b</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span> (<span class="id">le_trans</span> (<span class="id">ltW</span><span class="id"> ti</span>))<span class="id">//</span><span class="id"> -ijb</span><span class="id"> path_lt_le_last</span>.<br/>
<span class="id">rewrite</span><span class="id"> -fineB;</span><span class="id"> last</span><span class="id"> 2</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply/bounded_variationP</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> bounded_variationl</span><span class="id"> bvf</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply/bounded_variationP</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> bounded_variationl</span><span class="id"> bvf</span>.<br/>
<span class="id">rewrite</span> (<span class="id">total_variationD</span><span class="id"> _</span><span class="id"> ax</span><span class="id"> xt</span>).<br/>
<span class="id">have</span><span class="id"> tbfin</span><span class="id"> :</span><span class="id"> TV</span><span class="id"> t</span><span class="id"> b</span><span class="id"> f</span><span class="id"> \is</span><span class="id"> a</span><span class="id"> fin_num</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply/bounded_variationP</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span> (<span class="id">@bounded_variationr</span><span class="id"> _</span><span class="id"> a</span>).<br/>
<span class="id">have</span><span class="id"> xtfin</span><span class="id"> :</span><span class="id"> TV</span><span class="id"> x</span><span class="id"> t</span><span class="id"> f</span><span class="id"> \is</span><span class="id"> a</span><span class="id"> fin_num</span>.<br/>
&nbsp;&nbsp;<span class="id">apply/bounded_variationP</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> apply:</span> (<span class="id">@bounded_variationl</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> b</span>)<span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="id">exact:</span> (<span class="id">@bounded_variationr</span><span class="id"> _</span><span class="id"> a</span>).<br/>
<span class="id">rewrite</span><span class="id"> oppeD</span><span class="id"> ?fin_num_adde_defl//</span><span class="id"> addeA</span><span class="id"> subee</span><span class="id"> //;</span><span class="id"> first</span><span class="id"> last</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply/bounded_variationP</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span> (<span class="id">@bounded_variationl</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> b</span>).<br/>
<span class="id">rewrite</span><span class="id"> sub0e</span><span class="id"> fineN</span><span class="id"> normrN</span><span class="id"> ger0_norm;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> fine_ge0//</span><span class="id"> total_variation_ge0</span>.<br/>
<span class="id">move:</span> (<span class="id">tv_eps</span>)<span class="id">;</span><span class="id"> rewrite</span> (<span class="id">total_variationD</span><span class="id"> f</span><span class="id"> _</span><span class="id"> tb</span>)<span class="id"> //</span>.<br/>
<span class="id">move:</span><span class="id"> xt;</span><span class="id"> rewrite</span><span class="id"> le_eqVlt</span><span class="id"> =&gt;</span><span class="id"> /predU1P[-&gt;|xt]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> total_variationxx/=</span>.<br/>
<span class="id">have</span><span class="id"> :</span><span class="id"> variation</span><span class="id"> x</span><span class="id"> b</span><span class="id"> f</span> (<span class="id">i</span><span class="id"> ::</span><span class="id"> j</span>)<span class="id"> &lt;=</span><span class="id"> variation</span><span class="id"> x</span><span class="id"> t</span><span class="id"> f</span> (<span class="id">t</span><span class="id"> ::</span><span class="id"> nil</span>)<span class="id"> +</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">variation</span><span class="id"> t</span><span class="id"> b</span><span class="id"> f</span> (<span class="id">i</span><span class="id"> ::</span><span class="id"> j</span>).<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> variationD//;</span><span class="id"> last</span><span class="id"> 2</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> itv_partition1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /itv_partition/=</span><span class="id"> ti</span><span class="id"> ij</span><span class="id"> ijb</span>.<br/>
&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> le_variation</span>.<br/>
<span class="id">rewrite</span><span class="id"> -lee_fin</span><span class="id"> =&gt;</span><span class="id"> /lt_le_trans</span><span class="id"> /[apply]</span>.<br/>
<span class="id">rewrite</span><span class="id"> {1}variation_prev;</span><span class="id"> last</span><span class="id"> exact:</span><span class="id"> itv_partition1</span>.<br/>
<span class="id">rewrite</span><span class="id"> /=</span><span class="id"> -addeA</span><span class="id"> -lteBrDr;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> fin_numD;</span><span class="id"> apply/andP</span>.<br/>
<span class="id">rewrite</span><span class="id"> EFinD</span><span class="id"> -lte_fin</span><span class="id"> ?fineK</span><span class="id"> //</span><span class="id"> oppeD</span><span class="id"> //=</span><span class="id"> ?fin_num_adde_defl</span><span class="id"> //</span><span class="id"> opprK</span><span class="id"> addeA</span>.<br/>
<span class="id">move/lt_trans;</span><span class="id"> apply</span>.<br/>
<span class="id">rewrite</span><span class="id"> [in</span><span class="id"> ltRHS]</span>(<span class="id">splitr</span> (<span class="id">eps%:num</span>))<span class="id"> EFinD</span><span class="id"> lteD2rE//</span><span class="id"> -addeA</span>.<br/>
<span class="id">apply:</span> (<span class="id">@le_lt_trans</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">variation</span><span class="id"> x</span><span class="id"> t</span><span class="id"> f</span> (<span class="id">t</span><span class="id"> ::</span><span class="id"> nil</span>))<span class="id">%:E</span>).<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> [in</span><span class="id"> leRHS]variation_prev;</span><span class="id"> last</span><span class="id"> exact:</span><span class="id"> itv_partition1</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> geeDl//</span><span class="id"> sube_le0;</span><span class="id"> apply:</span><span class="id"> ereal_sup_ubound</span><span class="id"> =&gt;</span><span class="id"> /=</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">exists</span> (<span class="id">variation</span><span class="id"> t</span><span class="id"> b</span><span class="id"> f</span> (<span class="id">i</span><span class="id"> ::</span><span class="id"> j</span>))<span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> apply:</span><span class="id"> variations_variation</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /itv_partition/=</span><span class="id"> ijb</span><span class="id"> ij</span><span class="id"> ti</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /variation/=</span><span class="id"> big_nat_recr//=</span><span class="id"> big_nil</span><span class="id"> add0r</span><span class="id"> distrC</span><span class="id"> lte_fin</span>.<br/>
<span class="id">Unshelve</span>.<span class="id"> all:</span><span class="gallina-kwd"> by</span><span class="id"> end_near</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> neg_tv_right_continuous</span><span class="id"> a</span><span class="id"> x</span><span class="id"> b</span><span class="id"> f</span><span class="id"> :</span><span class="id"> a</span><span class="id"> &lt;=</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> x</span><span class="id"> &lt;</span><span class="id"> b</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">BV</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">f</span><span class="id"> @</span><span class="id"> x^'+</span><span class="id"> --&gt;</span><span class="id"> f</span><span class="id"> x</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">fine</span><span class="id"> \o</span><span class="id"> neg_tv</span><span class="id"> a</span><span class="id"> f</span><span class="id"> @</span><span class="id"> x^'+</span><span class="id"> --&gt;</span><span class="id"> fine</span> (<span class="id">neg_tv</span><span class="id"> a</span><span class="id"> f</span><span class="id"> x</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> ax</span><span class="id"> ?</span><span class="id"> bvf</span><span class="id"> fcts;</span><span class="id"> have</span><span class="id"> xb</span><span class="id"> :</span><span class="id"> x</span><span class="id"> &lt;=</span><span class="id"> b</span><span class="gallina-kwd"> by</span><span class="id"> exact:</span><span class="id"> ltW</span>.<br/>
<span class="id">have</span><span class="id"> xbfin</span><span class="id"> :</span><span class="id"> TV</span><span class="id"> a</span><span class="id"> x</span><span class="id"> f</span><span class="id"> \is</span><span class="id"> a</span><span class="id"> fin_num</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply/bounded_variationP</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> bounded_variationl</span><span class="id"> bvf</span>.<br/>
<span class="id">apply:</span><span class="id"> fine_cvg;</span><span class="id"> rewrite</span><span class="id"> /neg_tv</span><span class="id"> fineM</span><span class="id"> //</span><span class="id"> ?fin_numB</span><span class="id"> ?xbfin</span><span class="id"> //=</span><span class="id"> EFinM</span>.<br/>
<span class="id">under</span><span class="id"> eq_fun</span><span class="id"> =&gt;</span><span class="id"> i</span><span class="id"> do</span><span class="id"> rewrite</span><span class="id"> EFinN</span>.<br/>
<span class="id">apply:</span> (<span class="id">@cvg_trans</span><span class="id"> _</span> (((<span class="id">TV</span><span class="id"> a</span><span class="id"> n</span><span class="id"> f</span><span class="id"> -</span> (<span class="id">f</span><span class="id"> n</span>)<span class="id">%:E</span>)<span class="id"> *</span><span class="id"> 2^-1%:E</span>)<span class="id">%E</span><span class="id"> @[n</span><span class="id"> --&gt;</span><span class="id"> x^'+]</span>)).<br/>
&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> cvg_id</span>.<br/>
<span class="id">apply:</span><span class="id"> cvgeMr;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> []</span>.<br/>
<span class="id">rewrite</span><span class="id"> fineD;</span><span class="id"> [|by</span><span class="id"> []</span>..<span class="id">]</span>.<br/>
<span class="id">rewrite</span><span class="id"> EFinB;</span><span class="id"> apply:</span><span class="id"> cvgeB;</span><span class="id"> [by</span><span class="id"> []|</span><span class="id"> |]</span>.<br/>
&nbsp;&nbsp;<span class="id">apply/</span><span class="id"> fine_cvgP;</span><span class="id"> split;</span><span class="id"> first</span><span class="gallina-kwd"> exists</span> (<span class="id">b</span><span class="id"> -</span><span class="id"> x</span>).<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> /=</span><span class="id"> subr_gt0</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> move=&gt;</span><span class="id"> t</span><span class="id"> /=</span><span class="id"> xtbx</span><span class="id"> xt;</span><span class="id"> have</span><span class="id"> ?</span><span class="id"> :</span><span class="id"> a</span><span class="id"> &lt;=</span><span class="id"> t</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> ltW;</span><span class="id"> apply:</span> (<span class="id">le_lt_trans</span><span class="id"> ax</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply/bounded_variationP</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> bounded_variationl</span><span class="id"> bvf</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">move:</span><span class="id"> xtbx;</span><span class="id"> rewrite</span><span class="id"> distrC</span><span class="id"> ger0_norm</span><span class="id"> ?subr_ge0;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> exact:</span><span class="id"> ltW</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> ltrBrDr</span><span class="id"> -addrA</span><span class="id"> [-_</span><span class="id"> +</span><span class="id"> _]addrC</span><span class="id"> subrr</span><span class="id"> addr0</span><span class="id"> =&gt;</span><span class="id"> /ltW</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> total_variation_right_continuous</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> last</span><span class="id"> exact:</span><span class="id"> bvf</span>.<br/>
<span class="id">apply:</span><span class="id"> cvg_comp;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> fcts</span>.<br/>
<span class="id">apply/</span><span class="id"> fine_cvgP;</span><span class="id"> split;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> near=&gt;</span><span class="id"> t</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> have</span><span class="id"> -&gt;</span><span class="id"> :</span><span class="id"> fine</span><span class="id"> \o</span><span class="id"> EFin</span><span class="id"> =</span><span class="id"> id</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> ?;</span><span class="id"> rewrite</span><span class="id"> funeqE</span><span class="id"> =&gt;</span><span class="id"> ?</span><span class="id"> /=</span>.<br/>
<span class="id">Unshelve</span>.<span class="id"> all:</span><span class="gallina-kwd"> by</span><span class="id"> end_near</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> total_variation_opp</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span><span class="id"> :</span><span class="id"> TV</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span><span class="id"> =</span><span class="id"> TV</span> (<span class="id">-</span><span class="id"> b</span>) (<span class="id">-</span><span class="id"> a</span>) (<span class="id">f</span><span class="id"> \o</span><span class="id"> -%R</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> /total_variation</span><span class="id"> variations_opp</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> total_variation_left_continuous</span><span class="id"> a</span><span class="id"> b</span><span class="id"> x</span><span class="id"> f</span><span class="id"> :</span><span class="id"> a</span><span class="id"> &lt;</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> x</span><span class="id"> &lt;=</span><span class="id"> b</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">f</span><span class="id"> @</span><span class="id"> x^'-</span><span class="id"> --&gt;</span><span class="id"> f</span><span class="id"> x</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">BV</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">fine</span><span class="id"> \o</span><span class="id"> TV</span><span class="id"> a</span><span class="id"> ^~</span><span class="id"> f</span><span class="id"> @</span><span class="id"> x^'-</span><span class="id"> --&gt;</span><span class="id"> fine</span> (<span class="id">TV</span><span class="id"> a</span><span class="id"> x</span><span class="id"> f</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> ax</span><span class="id"> xb</span><span class="id"> fNcts</span><span class="id"> bvf</span>.<br/>
<span class="id">apply/cvg_at_leftNP;</span><span class="id"> rewrite</span><span class="id"> total_variation_opp</span>.<br/>
<span class="id">have</span><span class="id"> bvNf</span><span class="id"> :</span><span class="id"> BV</span> (<span class="id">-b</span>) (<span class="id">-a</span>) (<span class="id">f</span><span class="id"> \o</span><span class="id"> -%R</span>).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> case:</span><span class="id"> bvf</span><span class="id"> =&gt;</span><span class="id"> M;</span><span class="id"> rewrite</span><span class="id"> -variations_opp</span><span class="id"> =&gt;</span><span class="id"> ?;</span><span class="gallina-kwd"> exists</span><span class="id"> M</span>.<br/>
<span class="id">have</span><span class="id"> bx</span><span class="id"> :</span><span class="id"> -</span><span class="id"> b</span><span class="id"> &lt;=</span><span class="id"> -</span><span class="id"> x</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> lerNl</span><span class="id"> opprK</span>.<br/>
<span class="id">have</span><span class="id"> xa</span><span class="id"> :</span><span class="id"> -</span><span class="id"> x</span><span class="id"> &lt;</span><span class="id"> -</span><span class="id"> a</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> ltrNl</span><span class="id"> opprK</span>.<br/>
<span class="id">have</span><span class="id"> ?</span><span class="id"> :</span><span class="id"> -</span><span class="id"> x</span><span class="id"> &lt;=</span><span class="id"> -</span><span class="id"> a</span><span class="gallina-kwd"> by</span><span class="id"> exact:</span><span class="id"> ltW</span>.<br/>
<span class="id">have</span><span class="id"> ?</span><span class="id"> :</span><span class="id"> Filter</span> (<span class="id">nbhs</span> (<span class="id">-x</span>)<span class="id">^'+</span>)<span class="gallina-kwd"> by</span><span class="id"> exact:</span><span class="id"> at_right_proper_filter</span>.<br/>
<span class="id">have</span><span class="id"> -&gt;</span><span class="id"> :</span><span class="id"> fine</span> (<span class="id">TV</span> (<span class="id">-x</span>) (<span class="id">-a</span>) (<span class="id">f</span><span class="id"> \o</span><span class="id"> -%R</span>))<span class="id"> =</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">fine</span> (<span class="id">TV</span> (<span class="id">-b</span>) (<span class="id">-a</span>) (<span class="id">f</span><span class="id"> \o</span><span class="id"> -%R</span>))<span class="id"> -</span><span class="id"> fine</span> (<span class="id">TV</span> (<span class="id">-b</span>) (<span class="id">-x</span>) (<span class="id">f</span><span class="id"> \o</span><span class="id"> -%R</span>)).<br/>
&nbsp;&nbsp;<span class="id">apply/eqP;</span><span class="id"> rewrite</span><span class="id"> -subr_eq</span><span class="id"> opprK</span><span class="id"> addrC</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -fineD;</span><span class="id"> last</span><span class="id"> 2</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply/bounded_variationP</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> bounded_variationl</span><span class="id"> bvNf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply/bounded_variationP</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> bounded_variationr</span><span class="id"> bvNf</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -total_variationD</span>.<br/>
<span class="id">have</span><span class="id"> /near_eq_cvg/cvg_trans</span><span class="id"> :</span><span class="id"> {near</span> (<span class="id">-</span><span class="id"> x</span>)<span class="id">^'+,</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="gallina-kwd">fun</span><span class="id"> t</span><span class="id"> =&gt;</span><span class="id"> fine</span> (<span class="id">TV</span> (<span class="id">-</span><span class="id"> b</span>) (<span class="id">-</span><span class="id"> a</span>) (<span class="id">f</span><span class="id"> \o</span><span class="id"> -%R</span>))<span class="id"> -</span><span class="id"> fine</span> (<span class="id">TV</span> (<span class="id">-</span><span class="id"> b</span>)<span class="id"> t</span> (<span class="id">f</span><span class="id"> \o</span><span class="id"> -%R</span>)))<span class="id"> =1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">fine</span><span class="id"> \o</span> (<span class="id">TV</span><span class="id"> a</span>)<span class="id">^~</span><span class="id"> f</span>)<span class="id"> \o</span><span class="id"> -%R}</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> filter_app</span> (<span class="id">nbhs_right_lt</span><span class="id"> xa</span>).<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> filter_app</span> (<span class="id">nbhs_right_ge</span><span class="id"> _</span>).<br/>
&nbsp;&nbsp;<span class="id">near=&gt;</span><span class="id"> t</span><span class="id"> =&gt;</span><span class="id"> xt</span><span class="id"> ta;</span><span class="id"> have</span><span class="id"> ?</span><span class="id"> :</span><span class="id"> -b</span><span class="id"> &lt;=</span><span class="id"> t</span><span class="gallina-kwd"> by</span><span class="id"> exact:</span> (<span class="id">le_trans</span><span class="id"> bx</span>).<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> ?</span><span class="id"> :</span><span class="id"> t</span><span class="id"> &lt;=</span><span class="id"> -a</span><span class="gallina-kwd"> by</span><span class="id"> exact:</span><span class="id"> ltW</span>.<br/>
&nbsp;&nbsp;<span class="id">apply/eqP;</span><span class="id"> rewrite</span><span class="id"> eq_sym</span><span class="id"> -subr_eq</span><span class="id"> opprK</span><span class="id"> addrC</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> /=</span><span class="id"> [TV</span><span class="id"> a</span><span class="id"> _</span><span class="id"> f]total_variation_opp</span><span class="id"> opprK</span><span class="id"> -fineD;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply/bounded_variationP</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> apply:</span><span class="id"> bounded_variationr</span><span class="id"> bvNf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply/bounded_variationP</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> apply:</span><span class="id"> bounded_variationl</span><span class="id"> bvNf</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -total_variationD</span>.<br/>
<span class="id">apply</span>.<br/>
<span class="id">apply:</span><span class="id"> cvgB;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> cvg_cst</span>.<br/>
<span class="id">apply:</span> (<span class="id">total_variation_right_continuous</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> bvNf</span>).<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> lerNl</span><span class="id"> opprK</span><span class="id"> //</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> ltrNl</span><span class="id"> opprK</span><span class="id"> //</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply/cvg_at_leftNP;</span><span class="id"> rewrite</span><span class="id"> /=</span><span class="id"> opprK</span>.<br/>
<span class="id">Unshelve</span>.<span class="id"> all:</span><span class="gallina-kwd"> by</span><span class="id"> end_near</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> total_variation_continuous</span><span class="id"> a</span><span class="id"> b</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> R</span>)<span class="id"> :</span><span class="id"> a</span><span class="id"> &lt;</span><span class="id"> b</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">{within</span><span class="id"> `[a,b],</span><span class="id"> continuous</span><span class="id"> f}</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">BV</span><span class="id"> a</span><span class="id"> b</span><span class="id"> f</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">{within</span><span class="id"> `[a,b],</span><span class="id"> continuous</span> (<span class="id">fine</span><span class="id"> \o</span><span class="id"> TV</span><span class="id"> a</span><span class="id"> ^~</span><span class="id"> f</span>)<span class="id">}</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> ab</span><span class="id"> /</span>(<span class="id">@continuous_within_itvP</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> ab</span>)<span class="id"> [int</span><span class="id"> l</span><span class="id"> r]</span><span class="id"> bdf</span>.<br/>
<span class="id">apply/continuous_within_itvP</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> split</span>.<br/>
<span class="id">-</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> /[dup]</span><span class="id"> xab;</span><span class="id"> rewrite</span><span class="id"> in_itv</span><span class="id"> /=</span><span class="id"> =&gt;</span><span class="id"> /andP</span><span class="id"> [ax</span><span class="id"> xb]</span>.<br/>
&nbsp;&nbsp;<span class="id">apply/left_right_continuousP;</span><span class="id"> split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span> (<span class="id">total_variation_left_continuous</span><span class="id"> _</span> (<span class="id">ltW</span><span class="id"> xb</span>))<span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> have</span><span class="id"> /left_right_continuousP[]</span><span class="id"> :=</span><span class="id"> int</span><span class="id"> x</span><span class="id"> xab</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span> (<span class="id">total_variation_right_continuous</span><span class="id"> _</span><span class="id"> xb</span>)<span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> ltW</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> have</span><span class="id"> /left_right_continuousP[]</span><span class="id"> :=</span><span class="id"> int</span><span class="id"> x</span><span class="id"> xab</span>.<br/>
<span class="id">-</span><span class="id"> exact:</span> (<span class="id">total_variation_right_continuous</span><span class="id"> _</span><span class="id"> ab</span>).<br/>
<span class="id">-</span><span class="id"> exact:</span> (<span class="id">total_variation_left_continuous</span><span class="id"> ab</span>).<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> variation_continuity</span>.<br/>

      <div class="footer"><hr/>Generated by <a href="https://github.com/yoshihiro503/coq2html/">a fork of coq2html</a></div>
    </div>
  </div>
    </main>
</body>
</html>
