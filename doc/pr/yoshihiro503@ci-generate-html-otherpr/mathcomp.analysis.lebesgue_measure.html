
<!DOCTYPE html>
<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Module mathcomp.analysis.lebesgue_measure</title>
<meta name="description" content="Documentation of Coq module mathcomp.analysis.lebesgue_measure" />
<link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.css">
<script src="https://cdn.jsdelivr.net/npm/markdown-it/dist/markdown-it.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/markdown-it-texmath/texmath.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/darkmode-js@1.5.7/lib/darkmode-js.min.js"></script>
<link href="coq2html.css" rel="stylesheet" type="text/css" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script type="text/javascript" src="coq2html.js"> </script>
</head>

<body onload="init()">

  <main>
    <div class="sidebar">
      <h2>Files</h2>
      
    </div>

  <div class="coq">

    <div class="content">
      <p><a href="./index.html">Top</a></p>
      <h1 class="title">Module mathcomp.analysis.lebesgue_measure</h1>
<span class="vernacular">From</span><span class="id"> mathcomp</span><span class="vernacular"> Require</span><span class="vernacular"> Import</span><span class="id"> all_ssreflect</span><span class="id"> ssralg</span><span class="id"> ssrnum</span><span class="id"> ssrint</span><span class="id"> interval</span>.<br/>
<span class="vernacular">From</span><span class="id"> mathcomp</span><span class="vernacular"> Require</span><span class="vernacular"> Import</span><span class="id"> finmap</span><span class="id"> fingroup</span><span class="id"> perm</span><span class="id"> rat</span><span class="id"> archimedean</span>.<br/>
<span class="vernacular">From</span><span class="id"> mathcomp</span><span class="vernacular"> Require</span><span class="vernacular"> Import</span><span class="id"> mathcomp_extra</span><span class="id"> boolp</span><span class="id"> classical_sets</span><span class="id"> functions</span>.<br/>
<span class="vernacular">From</span><span class="id"> mathcomp</span><span class="vernacular"> Require</span><span class="vernacular"> Import</span><span class="id"> cardinality</span><span class="id"> fsbigop</span><span class="id"> reals</span><span class="id"> ereal</span><span class="id"> signed</span>.<br/>
<span class="vernacular">From</span><span class="id"> mathcomp</span><span class="vernacular"> Require</span><span class="vernacular"> Import</span><span class="id"> topology</span><span class="id"> numfun</span><span class="id"> tvs</span><span class="id"> normedtype</span><span class="id"> function_spaces</span>.<br/>
<span class="vernacular">From</span><span class="id"> HB</span><span class="vernacular"> Require</span><span class="vernacular"> Import</span><span class="id"> structures</span>.<br/>
<span class="vernacular">From</span><span class="id"> mathcomp</span><span class="vernacular"> Require</span><span class="vernacular"> Import</span><span class="id"> sequences</span><span class="id"> esum</span><span class="id"> measure</span><span class="id"> real_interval</span><span class="id"> realfun</span><span class="id"> exp</span>.<br/>
<span class="vernacular">From</span><span class="id"> mathcomp</span><span class="vernacular"> Require</span><span class="vernacular"> Export</span><span class="id"> lebesgue_stieltjes_measure</span>.<br/>
<br/>
<div class="ssrdoc md">
# Lebesgue Measure

This file further develops the theory of measurable functions (including
Egorov's theorem), contains a formalization of the Lebesgue measure using
the Measure Extension theorem from measure.v, and proves properties of the
Lebesgue measure such as Vitali's theorem, i.e., given a Vitali cover $V$
of $A$, there exists a countable subcollection $D \subseteq V$ of pairwise
disjoint closed balls such that $\lambda(A \setminus \bigcup_k D_k) = 0$.

Main references:
- Daniel Li, Int√©gration et applications, 2016
- Achim Klenke, Probability Theory 2nd edition, 2014

```
     completed_algebra_gen == generator of the completed Lebesgue
                              sigma-algebra
                  ps_infty == inductive definition of the powerset
                              {0, {-oo}, {+oo}, {-oo,+oo}}
             emeasurable G == sigma-algebra over \bar R built out of the
                              measurables G of a sigma-algebra over R
```

The modules RGenOInfty, RGenInftyO, RGenCInfty, RGenOpens provide proofs
of equivalence between the sigma-algebra generated by open-closed
intervals and the sigma-algebras generated by open rays, closed rays, and
open intervals.

The module NGenCInfty provides a proof of equivalence between the
sigma-algebra for natural numbers and the sigma-algebra generated by
closed rays.

The modules ErealGenOInfty, ErealGenCInfty, ErealGenInftyO provide proofs
of equivalence between emeasurable and the sigma-algebras generated by
open rays and closed rays.

```
          lebesgue_measure == the Lebesgue measure
completed_lebesgue_measure == the completed Lebesgue measure
         elebesgue_measure == the Lebesgue measure extended to \bar R
```

```
    vitali_cover A B V == V is a Vitali cover of A, here B is a
                          collection of non-empty closed balls
```

</div>
<br/>
<span class="gallina-kwd">Set</span><span class="vernacular"> Implicit</span><span class="vernacular"> Arguments</span>.<br/>
<span class="vernacular">Unset</span><span class="vernacular"> Strict</span><span class="vernacular"> Implicit</span>.<br/>
<span class="vernacular">Unset</span><span class="vernacular"> Printing</span><span class="vernacular"> Implicit</span><span class="vernacular"> Defensive</span>.<br/>
<span class="vernacular">Import</span><span class="id"> Order</span>.<span class="id">TTheory</span><span class="id"> GRing</span>.<span class="id">Theory</span><span class="id"> Num</span>.<span class="id">Def</span><span class="id"> Num</span>.<span class="id">Theory</span>.<br/>
<span class="vernacular">Import</span><span class="id"> numFieldNormedType</span>.<span class="vernacular">Exports</span>.<br/>
<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> classical_set_scope</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ring_scope</span>.<br/>
<br/>
<span class="vernacular">Definition</span><span class="id"> completed_algebra_gen</span><span class="id"> d</span><span class="id"> {T</span><span class="id"> :</span><span class="id"> semiRingOfSetsType</span><span class="id"> d}</span><span class="id"> {R</span><span class="id"> :</span><span class="id"> realType}</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">mu</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id"> :</span><span class="id"> set</span><span class="id"> _</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">[set</span><span class="id"> A</span><span class="id"> `|`</span><span class="id"> N</span><span class="id"> |</span><span class="id"> A</span><span class="gallina-kwd"> in</span><span class="id"> d</span>.<span class="id">-measurable</span><span class="id"> &amp;</span><span class="id"> N</span><span class="gallina-kwd"> in</span><span class="id"> mu</span>.<span class="id">-negligible]</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> ps_infty</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {T</span><span class="id"> :</span><span class="id"> Type}</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<br/>
<span class="vernacular">Inductive</span><span class="id"> ps_infty</span><span class="id"> :</span><span class="id"> set</span><span class="id"> \bar</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="gallina-kwd"> Prop</span><span class="id"> :=</span><br/>
<span class="id">|</span><span class="id"> ps_infty0</span><span class="id"> :</span><span class="id"> ps_infty</span><span class="id"> set0</span><br/>
<span class="id">|</span><span class="id"> ps_ninfty</span><span class="id"> :</span><span class="id"> ps_infty</span><span class="id"> [set</span><span class="id"> -oo]</span><br/>
<span class="id">|</span><span class="id"> ps_pinfty</span><span class="id"> :</span><span class="id"> ps_infty</span><span class="id"> [set</span><span class="id"> +oo]</span><br/>
<span class="id">|</span><span class="id"> ps_inftys</span><span class="id"> :</span><span class="id"> ps_infty</span><span class="id"> [set</span><span class="id"> -oo;</span><span class="id"> +oo]</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> ps_inftyP</span> (<span class="id">A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> \bar</span><span class="id"> T</span>)<span class="id"> :</span><span class="id"> ps_infty</span><span class="id"> A</span><span class="id"> &lt;-&gt;</span><span class="id"> A</span><span class="id"> `&lt;=`</span><span class="id"> [set</span><span class="id"> -oo;</span><span class="id"> +oo]</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">split</span><span class="id"> =&gt;</span><span class="id"> [[]//|Aoo]</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> have</span><span class="id"> []</span><span class="id"> :=</span><span class="id"> subset_set2</span><span class="id"> Aoo;</span><span class="id"> move=&gt;</span><span class="id"> -&gt;;</span><span class="id"> constructor</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> setCU_Efin</span> (<span class="id">A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T</span>) (<span class="id">B</span><span class="id"> :</span><span class="id"> set</span><span class="id"> \bar</span><span class="id"> T</span>)<span class="id"> :</span><span class="id"> ps_infty</span><span class="id"> B</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">~`</span> (<span class="id">EFin</span><span class="id"> @`</span><span class="id"> A</span>)<span class="id"> `&amp;`</span><span class="id"> ~`</span><span class="id"> B</span><span class="id"> =</span> (<span class="id">EFin</span><span class="id"> @`</span><span class="id"> ~`</span><span class="id"> A</span>)<span class="id"> `|`</span> (<span class="id">[set</span><span class="id"> -oo%E;</span><span class="id"> +oo%E]</span><span class="id"> `&amp;`</span><span class="id"> ~`</span><span class="id"> B</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> ps_inftyB</span>.<br/>
<span class="id">have</span><span class="id"> -&gt;</span><span class="id"> :</span><span class="id"> ~`</span> (<span class="id">EFin</span><span class="id"> @`</span><span class="id"> A</span>)<span class="id"> =</span><span class="id"> EFin</span><span class="id"> @`</span> (<span class="id">~`</span><span class="id"> A</span>)<span class="id"> `|`</span><span class="id"> [set</span><span class="id"> -oo;</span><span class="id"> +oo]%E</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> EFin_setC</span><span class="id"> setDKU</span><span class="id"> //</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> [|]</span><span class="id"> -&gt;</span><span class="id"> -[]</span>.<br/>
<span class="id">rewrite</span><span class="id"> setIUl;</span><span class="id"> congr</span> (_<span class="id"> `|`</span><span class="id"> _</span>)<span class="id">;</span><span class="id"> rewrite</span><span class="id"> predeqE</span><span class="id"> =&gt;</span><span class="id"> -[x|</span><span class="id"> |];</span><span class="id"> split;</span><span class="id"> try</span><span class="gallina-kwd"> by</span><span class="id"> case</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> []</span><span class="id"> x'</span><span class="id"> Ax'</span><span class="id"> []</span><span class="id"> &lt;-{x};</span><span class="id"> split;</span><span class="id"> [exists</span><span class="id"> x'|case:</span><span class="id"> ps_inftyB</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> -[]]</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> ps_infty</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> salgebra_ereal</span>.<br/>
<span class="vernacular">Variables</span> (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>) (<span class="id">G</span><span class="id"> :</span><span class="id"> set</span> (<span class="id">set</span><span class="id"> R</span>)).<br/>
<span class="vernacular">Let</span><span class="id"> measurableR</span><span class="id"> :</span><span class="id"> set</span> (<span class="id">set</span><span class="id"> R</span>)<span class="id"> :=</span><span class="id"> G</span>.<span class="id">-sigma</span>.<span class="id">-measurable</span>.<br/>
<br/>
<span class="vernacular">Definition</span><span class="id"> emeasurable</span><span class="id"> :</span><span class="id"> set</span> (<span class="id">set</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">[set</span><span class="id"> EFin</span><span class="id"> @`</span><span class="id"> A</span><span class="id"> `|`</span><span class="id"> B</span><span class="id"> |</span><span class="id"> A</span><span class="gallina-kwd"> in</span><span class="id"> measurableR</span><span class="id"> &amp;</span><span class="id"> B</span><span class="gallina-kwd"> in</span><span class="id"> ps_infty]</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> emeasurable0</span><span class="id"> :</span><span class="id"> emeasurable</span><span class="id"> set0</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd">exists</span><span class="id"> set0;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> measurable0</span>.<br/>
<span class="gallina-kwd">by</span><span class="gallina-kwd"> exists</span><span class="id"> set0;</span><span class="id"> rewrite</span><span class="id"> ?setU0//</span><span class="id"> ?image_set0//;</span><span class="id"> constructor</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> emeasurableC</span> (<span class="id">X</span><span class="id"> :</span><span class="id"> set</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id"> :</span><span class="id"> emeasurable</span><span class="id"> X</span><span class="id"> -&gt;</span><span class="id"> emeasurable</span> (<span class="id">~`</span><span class="id"> X</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move</span><span class="id"> =&gt;</span><span class="id"> -[A</span><span class="id"> mA]</span><span class="id"> [B</span><span class="id"> PooB</span><span class="id"> &lt;-];</span><span class="id"> rewrite</span><span class="id"> setCU</span><span class="id"> setCU_Efin</span><span class="id"> //</span>.<br/>
<span class="gallina-kwd">exists</span> (<span class="id">~`</span><span class="id"> A</span>)<span class="id">;</span><span class="id"> [exact:</span><span class="id"> measurableC</span><span class="id"> |</span><span class="gallina-kwd"> exists</span> (<span class="id">[set</span><span class="id"> -oo%E;</span><span class="id"> +oo%E]</span><span class="id"> `&amp;`</span><span class="id"> ~`</span><span class="id"> B</span>)<span class="id"> =&gt;</span><span class="id"> //]</span>.<br/>
<span class="id">case:</span><span class="id"> PooB</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> setC0</span><span class="id"> setIT;</span><span class="id"> constructor</span>.<br/>
<span class="id">-</span><span class="id"> rewrite</span><span class="id"> setIUl</span><span class="id"> setICr</span><span class="id"> set0U</span><span class="id"> -setDE</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> [_</span><span class="id"> -&gt;]</span><span class="id"> :=</span><span class="id"> @setDidPl</span> (<span class="id">\bar</span><span class="id"> R</span>)<span class="id"> [set</span><span class="id"> +oo%E]</span><span class="id"> [set</span><span class="id"> -oo%E];</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> constructor</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> predeqE</span><span class="id"> =&gt;</span><span class="id"> x;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> -[-&gt;]</span>.<br/>
<span class="id">-</span><span class="id"> rewrite</span><span class="id"> setIUl</span><span class="id"> setICr</span><span class="id"> setU0</span><span class="id"> -setDE</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> [_</span><span class="id"> -&gt;]</span><span class="id"> :=</span><span class="id"> @setDidPl</span> (<span class="id">\bar</span><span class="id"> R</span>)<span class="id"> [set</span><span class="id"> -oo%E]</span><span class="id"> [set</span><span class="id"> +oo%E];</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> constructor</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> predeqE</span><span class="id"> =&gt;</span><span class="id"> x;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> -[-&gt;]</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> setICr;</span><span class="id"> constructor</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> bigcupT_emeasurable</span> (<span class="id">F</span><span class="id"> :</span> (<span class="id">set</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id">^nat</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">forall</span><span class="id"> i,</span><span class="id"> emeasurable</span> (<span class="id">F</span><span class="id"> i</span>))<span class="id"> -&gt;</span><span class="id"> emeasurable</span> (<span class="id">\bigcup_i</span> (<span class="id">F</span><span class="id"> i</span>)).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> mF;</span><span class="id"> pose</span><span class="id"> P</span><span class="id"> :=</span><span class="gallina-kwd"> fun</span><span class="id"> i</span><span class="id"> j</span><span class="id"> =&gt;</span><span class="id"> measurableR</span><span class="id"> j</span>.<span class="id">1</span><span class="id"> /\</span><span class="id"> ps_infty</span><span class="id"> j</span>.<span class="id">2</span><span class="id"> /\</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">F</span><span class="id"> i</span><span class="id"> =</span><span class="id"> [set</span><span class="id"> x%:E</span><span class="id"> |</span><span class="id"> x</span><span class="gallina-kwd"> in</span><span class="id"> j</span>.<span class="id">1]</span><span class="id"> `|`</span><span class="id"> j</span>.<span class="id">2</span>.<br/>
<span class="id">have</span><span class="id"> [f</span><span class="id"> fi]</span><span class="id"> :</span><span class="id"> {f</span><span class="id"> :</span><span class="id"> nat</span><span class="id"> -&gt;</span> (<span class="id">set</span><span class="id"> R</span>)<span class="id"> *</span> (<span class="id">set</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id"> &amp;</span><span class="gallina-kwd"> forall</span><span class="id"> i,</span><span class="id"> P</span><span class="id"> i</span> (<span class="id">f</span><span class="id"> i</span>)<span class="id"> }</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> choice</span><span class="id"> =&gt;</span><span class="id"> i;</span><span class="id"> have</span><span class="id"> [x</span><span class="id"> mx</span><span class="id"> [y</span><span class="id"> PSoo'y]</span><span class="id"> xy]</span><span class="id"> :=</span><span class="id"> mF</span><span class="id"> i;</span><span class="gallina-kwd"> exists</span> (<span class="id">x,</span><span class="id"> y</span>).<br/>
<span class="gallina-kwd">exists</span> (<span class="id">\bigcup_i</span> (<span class="id">f</span><span class="id"> i</span>).<span class="id">1</span>).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> bigcupT_measurable</span><span class="id"> =&gt;</span><span class="id"> i;</span><span class="id"> exact:</span> (<span class="id">fi</span><span class="id"> i</span>).<span class="id">1</span>.<br/>
<span class="gallina-kwd">exists</span> (<span class="id">\bigcup_i</span> (<span class="id">f</span><span class="id"> i</span>).<span class="id">2</span>).<br/>
&nbsp;&nbsp;<span class="id">apply/ps_inftyP</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> [n</span><span class="id"> _]</span><span class="id"> fn2x</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> /ps_inftyP</span><span class="id"> :</span><span class="id"> ps_infty</span>(<span class="id">f</span><span class="id"> n</span>).<span class="id">2</span><span class="gallina-kwd"> by</span><span class="id"> have</span><span class="id"> [_</span><span class="id"> []]</span><span class="id"> :=</span><span class="id"> fi</span><span class="id"> n</span>.<br/>
&nbsp;&nbsp;<span class="id">exact</span>.<br/>
<span class="id">rewrite</span><span class="id"> [RHS]</span>(<span class="id">@eq_bigcupr</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="gallina-kwd">fun</span><span class="id"> i</span><span class="id"> =&gt;</span><span class="id"> [set</span><span class="id"> x%:E</span><span class="id"> |</span><span class="id"> x</span><span class="gallina-kwd"> in</span> (<span class="id">f</span><span class="id"> i</span>).<span class="id">1]</span><span class="id"> `|`</span> (<span class="id">f</span><span class="id"> i</span>).<span class="id">2</span>))<span class="id">;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> i;</span><span class="id"> have</span><span class="id"> [_</span><span class="id"> []]</span><span class="id"> :=</span><span class="id"> fi</span><span class="id"> i</span>.<br/>
<span class="id">rewrite</span><span class="id"> bigcupU;</span><span class="id"> congr</span> (_<span class="id"> `|`</span><span class="id"> _</span>).<br/>
<span class="id">rewrite</span><span class="id"> predeqE</span><span class="id"> =&gt;</span><span class="id"> i</span><span class="id"> /=;</span><span class="id"> split=&gt;</span><span class="id"> [[r</span><span class="id"> [n</span><span class="id"> _</span><span class="id"> fn1r</span><span class="id"> &lt;-{i}]]|[n</span><span class="id"> _</span><span class="id"> [r</span><span class="id"> fn1r</span><span class="id"> &lt;-{i}]]];</span><br/>
&nbsp;<span class="gallina-kwd">by</span><span class="id"> [exists</span><span class="id"> n</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="gallina-kwd"> exists</span><span class="id"> r</span><span class="id"> |</span><span class="gallina-kwd"> exists</span><span class="id"> r</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="gallina-kwd"> exists</span><span class="id"> n]</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Definition</span><span class="id"> ereal_isMeasurable</span><span class="id"> :</span><span class="id"> isMeasurable</span><span class="id"> default_measure_display</span> (<span class="id">\bar</span><span class="id"> R</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">isMeasurable</span>.<span class="id">Build</span><span class="id"> _</span><span class="id"> _</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">emeasurable0</span><span class="id"> emeasurableC</span><span class="id"> bigcupT_emeasurable</span>.<br/>
<br/>
<span class="vernacular">End</span><span class="id"> salgebra_ereal</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> puncture_ereal_itv</span>.<br/>
<span class="vernacular">Variable</span><span class="id"> R</span><span class="id"> :</span><span class="id"> realDomainType</span>.<br/>
<span class="vernacular">Implicit</span><span class="id"> Types</span> (<span class="id">y</span><span class="id"> :</span><span class="id"> R</span>) (<span class="id">b</span><span class="id"> :</span><span class="id"> bool</span>).<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> punct_eitv_bndy</span><span class="id"> b</span><span class="id"> y</span><span class="id"> :</span><span class="id"> [set`</span><span class="id"> Interval</span> (<span class="id">BSide</span><span class="id"> b</span><span class="id"> y%:E</span>)<span class="id"> +oo%O]</span><span class="id"> =</span><br/>
&nbsp;&nbsp;<span class="id">EFin</span><span class="id"> @`</span><span class="id"> [set`</span><span class="id"> Interval</span> (<span class="id">BSide</span><span class="id"> b</span><span class="id"> y</span>)<span class="id"> +oo%O]</span><span class="id"> `|`</span><span class="id"> [set</span><span class="id"> +oo]</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> predeqE</span><span class="id"> =&gt;</span><span class="id"> x;</span><span class="id"> split;</span><span class="id"> rewrite</span><span class="id"> /=</span><span class="id"> in_itv</span><span class="id"> andbT</span>.<br/>
<span class="id">-</span><span class="id"> move:</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> [x|</span><span class="id"> |]</span><span class="id"> yxb;</span><span class="id"> [|by</span><span class="id"> right|by</span><span class="id"> case:</span><span class="id"> b</span><span class="id"> yxb]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> left;</span><span class="gallina-kwd"> exists</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> rewrite</span><span class="id"> in_itv</span><span class="id"> /=</span><span class="id"> andbT;</span><span class="id"> case:</span><span class="id"> b</span><span class="id"> yxb</span>.<br/>
<span class="id">-</span><span class="id"> move=&gt;</span><span class="id"> [[r]|-&gt;]</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> in_itv</span><span class="id"> /=</span><span class="id"> andbT</span><span class="id"> =&gt;</span><span class="id"> yxb</span><span class="id"> &lt;-;</span><span class="id"> case:</span><span class="id"> b</span><span class="id"> yxb</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> case:</span><span class="id"> b</span><span class="id"> =&gt;</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> ?</span>(<span class="id">ltry,</span><span class="id"> leey</span>).<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> punct_eitv_Nybnd</span><span class="id"> b</span><span class="id"> y</span><span class="id"> :</span><span class="id"> [set`</span><span class="id"> Interval</span><span class="id"> -oo%O</span> (<span class="id">BSide</span><span class="id"> b</span><span class="id"> y%:E</span>)<span class="id">]</span><span class="id"> =</span><br/>
&nbsp;&nbsp;<span class="id">[set</span><span class="id"> -oo%E]</span><span class="id"> `|`</span><span class="id"> EFin</span><span class="id"> @`</span><span class="id"> [set</span><span class="id"> x</span><span class="id"> |</span><span class="id"> x</span><span class="id"> \in</span><span class="id"> Interval</span><span class="id"> -oo%O</span> (<span class="id">BSide</span><span class="id"> b</span><span class="id"> y</span>)<span class="id">]</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> predeqE</span><span class="id"> =&gt;</span><span class="id"> x;</span><span class="id"> split;</span><span class="id"> rewrite</span><span class="id"> /=</span><span class="id"> in_itv</span>.<br/>
<span class="id">-</span><span class="id"> move:</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> [x|</span><span class="id"> |]</span><span class="id"> yxb;</span><span class="id"> [|by</span><span class="id"> case:</span><span class="id"> b</span><span class="id"> yxb|by</span><span class="id"> left]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> right;</span><span class="gallina-kwd"> exists</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> rewrite</span><span class="id"> in_itv</span><span class="id"> /=</span><span class="id"> andbT;</span><span class="id"> case:</span><span class="id"> b</span><span class="id"> yxb</span>.<br/>
<span class="id">-</span><span class="id"> move=&gt;</span><span class="id"> [-&gt;|[r]]</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> case:</span><span class="id"> b</span><span class="id"> =&gt;</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> ?</span>(<span class="id">ltNyr,</span><span class="id"> leNye</span>).<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> in_itv</span><span class="id"> /=</span><span class="id"> =&gt;</span><span class="id"> yxb</span><span class="id"> &lt;-;</span><span class="id"> case:</span><span class="id"> b</span><span class="id"> yxb</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> punct_eitv_setTR</span><span class="id"> :</span><span class="id"> range</span> (<span class="id">@EFin</span><span class="id"> R</span>)<span class="id"> `|`</span><span class="id"> [set</span><span class="id"> +oo]</span><span class="id"> =</span><span class="id"> [set~</span><span class="id"> -oo]</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> eqEsubset;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> [a</span><span class="id"> [[a'</span><span class="id"> _</span><span class="id"> &lt;-]|-&gt;]|]</span><span class="id"> //</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> [x|</span><span class="id"> |]</span><span class="id"> //=</span><span class="id"> _;</span><span class="id"> [left;</span><span class="gallina-kwd"> exists</span><span class="id"> x|right]</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> punct_eitv_setTL</span><span class="id"> :</span><span class="id"> range</span> (<span class="id">@EFin</span><span class="id"> R</span>)<span class="id"> `|`</span><span class="id"> [set</span><span class="id"> -oo]</span><span class="id"> =</span><span class="id"> [set~</span><span class="id"> +oo]</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> eqEsubset;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> [a</span><span class="id"> [[a'</span><span class="id"> _</span><span class="id"> &lt;-]|-&gt;]|]</span><span class="id"> //</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> [x|</span><span class="id"> |]</span><span class="id"> //=</span><span class="id"> _;</span><span class="id"> [left;</span><span class="gallina-kwd"> exists</span><span class="id"> x|right]</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> puncture_ereal_itv</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> salgebra_R_ssets</span>.<br/>
<span class="vernacular">Variable</span><span class="id"> R</span><span class="id"> :</span><span class="id"> realType</span>.<br/>
<br/>
<span class="vernacular">Definition</span><span class="id"> measurableTypeR</span><span class="id"> :=</span><span class="id"> g_sigma_algebraType</span> (<span class="id">R</span>.<span class="id">-ocitv</span>.<span class="id">-measurable</span>).<br/>
<span class="vernacular">Definition</span><span class="id"> measurableR</span><span class="id"> :</span><span class="id"> set</span> (<span class="id">set</span><span class="id"> R</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;(<span class="id">R</span>.<span class="id">-ocitv</span>.<span class="id">-measurable</span>).<span class="id">-sigma</span>.<span class="id">-measurable</span>.<br/>
<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> Pointed</span>.<span class="id">on</span><span class="id"> R</span>.<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> R_isMeasurable</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">isMeasurable</span><span class="id"> default_measure_display</span><span class="id"> R</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">@isMeasurable</span>.<span class="id">Build</span><span class="id"> _</span><span class="id"> measurableTypeR</span><span class="id"> measurableR</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">measurable0</span> (<span class="id">@measurableC</span><span class="id"> _</span><span class="id"> _</span>) (<span class="id">@bigcupT_measurable</span><span class="id"> _</span><span class="id"> _</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> measurable_set1</span> (<span class="id">r</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span><span class="id"> measurable</span><span class="id"> [set</span><span class="id"> r]</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> set1_bigcap_oc;</span><span class="id"> apply:</span><span class="id"> bigcap_measurable</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> k</span><span class="id"> _</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> sub_sigma_algebra;</span><span class="id"> exact/is_ocitv</span>.<br/>
Qed.</div></details>
<span class="id">#[local]</span><span class="vernacular"> Hint</span><span class="id"> Resolve</span><span class="id"> measurable_set1</span><span class="id"> :</span><span class="id"> core</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> measurable_itv</span> (<span class="id">i</span><span class="id"> :</span><span class="id"> interval</span><span class="id"> R</span>)<span class="id"> :</span><span class="id"> measurable</span><span class="id"> [set`</span><span class="id"> i]</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">have</span><span class="id"> moc</span> (<span class="id">a</span><span class="id"> b</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span><span class="id"> measurable</span><span class="id"> `]a,</span><span class="id"> b]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> sub_sigma_algebra;</span><span class="id"> apply:</span><span class="id"> is_ocitv</span>.<br/>
<span class="id">have</span><span class="id"> mopoo</span> (<span class="id">x</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span><span class="id"> measurable</span><span class="id"> `]x,</span><span class="id"> +oo[</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> itv_bnd_infty_bigcup;</span><span class="id"> exact:</span><span class="id"> bigcup_measurable</span>.<br/>
<span class="id">have</span><span class="id"> mnooc</span> (<span class="id">x</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span><span class="id"> measurable</span><span class="id"> `]-oo,</span><span class="id"> x]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -setCitvr;</span><span class="id"> exact/measurableC</span>.<br/>
<span class="id">have</span><span class="id"> ooE</span> (<span class="id">a</span><span class="id"> b</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span><span class="id"> `]a,</span><span class="id"> b[%classic</span><span class="id"> =</span><span class="id"> `]a,</span><span class="id"> b]</span><span class="id"> `\</span><span class="id"> b</span>.<br/>
&nbsp;&nbsp;<span class="id">case:</span> (<span class="id">boolP</span> (<span class="id">a</span><span class="id"> &lt;</span><span class="id"> b</span>))<span class="id"> =&gt;</span><span class="id"> ab;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> !set_itv_ge</span><span class="id"> ?set0D</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -setUitv1//</span><span class="id"> setUDK//</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> [-&gt;];</span><span class="id"> rewrite</span><span class="id"> /=</span><span class="id"> in_itv/=</span><span class="id"> ltxx</span><span class="id"> andbF</span>.<br/>
<span class="id">have</span><span class="id"> moo</span> (<span class="id">a</span><span class="id"> b</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span><span class="id"> measurable</span><span class="id"> `]a,</span><span class="id"> b[</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> ooE;</span><span class="id"> exact:</span><span class="id"> measurableD</span>.<br/>
<span class="id">have</span><span class="id"> mcc</span> (<span class="id">a</span><span class="id"> b</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span><span class="id"> measurable</span><span class="id"> `[a,</span><span class="id"> b]</span>.<br/>
&nbsp;&nbsp;<span class="id">case:</span> (<span class="id">boolP</span> (<span class="id">a</span><span class="id"> &lt;=</span><span class="id"> b</span>))<span class="id"> =&gt;</span><span class="id"> ab;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> set_itv_ge</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -setU1itv//;</span><span class="id"> apply/measurableU</span>.<br/>
<span class="id">have</span><span class="id"> mco</span> (<span class="id">a</span><span class="id"> b</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span><span class="id"> measurable</span><span class="id"> `[a,</span><span class="id"> b[</span>.<br/>
&nbsp;&nbsp;<span class="id">case:</span> (<span class="id">boolP</span> (<span class="id">a</span><span class="id"> &lt;</span><span class="id"> b</span>))<span class="id"> =&gt;</span><span class="id"> ab;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> set_itv_ge</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -setU1itv//;</span><span class="id"> apply/measurableU</span>.<br/>
<span class="id">have</span><span class="id"> oooE</span> (<span class="id">b</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span><span class="id"> `]-oo,</span><span class="id"> b[%classic</span><span class="id"> =</span><span class="id"> `]-oo,</span><span class="id"> b]</span><span class="id"> `\</span><span class="id"> b</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -setUitv1//</span><span class="id"> setUDK//</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> [-&gt;];</span><span class="id"> rewrite</span><span class="id"> /=</span><span class="id"> in_itv/=</span><span class="id"> ltxx</span>.<br/>
<span class="id">case:</span><span class="id"> i</span><span class="id"> =&gt;</span><span class="id"> [[[]</span><span class="id"> a|[]]</span><span class="id"> [[]</span><span class="id"> b|[]]]</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> do</span><span class="id"> ?by</span><span class="id"> rewrite</span><span class="id"> set_itv_ge</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> -setU1itv//;</span><span class="id"> exact/measurableU</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> oooE;</span><span class="id"> exact/measurableD</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> set_itv_infty_infty</span>.<br/>
Qed.</div></details>
<span class="id">#[local]</span><span class="vernacular"> Hint</span><span class="id"> Resolve</span><span class="id"> measurable_itv</span><span class="id"> :</span><span class="id"> core</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> measurable_fun_itv_co</span> (<span class="id">x</span><span class="id"> y</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> b0</span><span class="id"> b1</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">measurable_fun</span><span class="id"> [set`</span><span class="id"> Interval</span> (<span class="id">BSide</span><span class="id"> b0</span><span class="id"> x</span>) (<span class="id">BSide</span><span class="id"> b1</span><span class="id"> y</span>)<span class="id">]</span><span class="id"> f</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">measurable_fun</span><span class="id"> `[x,</span><span class="id"> y[</span><span class="id"> f</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">have</span><span class="id"> [xy|yx</span><span class="id"> _]</span><span class="id"> :=</span><span class="id"> ltP</span><span class="id"> x</span><span class="id"> y;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> set_itv_ge</span><span class="id"> -?leNgt</span><span class="id"> ?bnd_simp//;</span><span class="id"> exact:</span><span class="id"> measurable_fun_set0</span>.<br/>
<span class="id">move:</span><span class="id"> b0</span><span class="id"> b1</span><span class="id"> =&gt;</span><span class="id"> [|]</span><span class="id"> [|]</span><span class="id"> //</span><span class="id"> mf</span>.<br/>
<span class="id">-</span><span class="id"> apply:</span><span class="id"> measurable_funS</span><span class="id"> mf</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> subset_itv_co_cc</span>.<br/>
<span class="id">-</span><span class="id"> rewrite</span><span class="id"> -setU1itv//=</span><span class="id"> measurable_funU//;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> measurable_fun_set1</span>.<br/>
<span class="id">-</span><span class="id"> rewrite</span><span class="id"> -setU1itv//=</span><span class="id"> measurable_funU//;</span><span class="id"> split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> measurable_fun_set1</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> measurable_funS</span><span class="id"> mf</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> subset_itv_oo_oc</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> measurable_fun_itv_oc</span> (<span class="id">x</span><span class="id"> y</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> b0</span><span class="id"> b1</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">measurable_fun</span><span class="id"> [set`</span><span class="id"> Interval</span> (<span class="id">BSide</span><span class="id"> b0</span><span class="id"> x</span>) (<span class="id">BSide</span><span class="id"> b1</span><span class="id"> y</span>)<span class="id">]</span><span class="id"> f</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">measurable_fun</span><span class="id"> `]x,</span><span class="id"> y]</span><span class="id"> f</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">have</span><span class="id"> [xy|yx</span><span class="id"> _]</span><span class="id"> :=</span><span class="id"> ltP</span><span class="id"> x</span><span class="id"> y;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> set_itv_ge</span><span class="id"> -?leNgt</span><span class="id"> ?bnd_simp//;</span><span class="id"> exact:</span><span class="id"> measurable_fun_set0</span>.<br/>
<span class="id">move:</span><span class="id"> b0</span><span class="id"> b1</span><span class="id"> =&gt;</span><span class="id"> [|]</span><span class="id"> [|]</span><span class="id"> //</span><span class="id"> mf</span>.<br/>
<span class="id">-</span><span class="id"> rewrite</span><span class="id"> -setUitv1//=</span><span class="id"> measurable_funU//;</span><span class="id"> split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> measurable_funS</span><span class="id"> mf</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> subset_itv_oo_co</span>.<br/>
&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> measurable_fun_set1</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> measurable_funS</span><span class="id"> mf</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> subset_itv_oc_cc</span>.<br/>
<span class="id">-</span><span class="id"> rewrite</span><span class="id"> -setUitv1//=</span><span class="id"> measurable_funU//;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> measurable_fun_set1</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> measurable_fun_itv_cc</span> (<span class="id">x</span><span class="id"> y</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> b0</span><span class="id"> b1</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">measurable_fun</span><span class="id"> [set`</span><span class="id"> Interval</span> (<span class="id">BSide</span><span class="id"> b0</span><span class="id"> x</span>) (<span class="id">BSide</span><span class="id"> b1</span><span class="id"> y</span>)<span class="id">]</span><span class="id"> f</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">measurable_fun</span><span class="id"> `[x,</span><span class="id"> y]</span><span class="id"> f</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> mf</span>.<br/>
<span class="id">have</span><span class="id"> [xy|]</span><span class="id"> :=</span><span class="id"> ltP</span><span class="id"> x</span><span class="id"> y;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> le_eqVlt</span><span class="id"> =&gt;</span><span class="id"> /predU1P[-&gt;|ba]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> set_itv1;</span><span class="id"> exact:</span><span class="id"> measurable_fun_set1</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> set_itv_ge//;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> measurable_fun_set0</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -leNgt</span><span class="id"> bnd_simp</span>.<br/>
<span class="id">rewrite</span><span class="id"> -setUitv1//=;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> bnd_simp</span><span class="id"> ltW</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> measurable_funU//;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> measurable_fun_itv_co</span><span class="id"> mf</span>.<br/>
<span class="id">exact:</span><span class="id"> measurable_fun_set1</span>.<br/>
Qed.</div></details>
<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span> (<span class="id">ereal_isMeasurable</span> (<span class="id">R</span>.<span class="id">-ocitv</span>.<span class="id">-measurable</span>)).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> measurable_image_EFin</span> (<span class="id">A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">measurableR</span><span class="id"> A</span><span class="id"> -&gt;</span><span class="id"> measurable</span> (<span class="id">EFin</span><span class="id"> @`</span><span class="id"> A</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> mA;</span><span class="gallina-kwd"> exists</span><span class="id"> A</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="gallina-kwd"> exists</span><span class="id"> set0;</span><span class="id"> [constructor|rewrite</span><span class="id"> setU0]</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> emeasurable_set1</span> (<span class="id">x</span><span class="id"> :</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id"> :</span><span class="id"> measurable</span><span class="id"> [set</span><span class="id"> x]</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">case:</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> [r|</span><span class="id"> |]</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> -image_set1;</span><span class="id"> apply:</span><span class="id"> measurable_image_EFin;</span><span class="id"> apply:</span><span class="id"> measurable_set1</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> exists</span><span class="id"> set0</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> [exists</span><span class="id"> [set</span><span class="id"> +oo%E];</span><span class="id"> [by</span><span class="id"> constructor|]]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> image_set0</span><span class="id"> set0U</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> exists</span><span class="id"> set0</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> [exists</span><span class="id"> [set</span><span class="id"> -oo%E];</span><span class="id"> [by</span><span class="id"> constructor|]]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> image_set0</span><span class="id"> set0U</span>.<br/>
Qed.</div></details>
<span class="id">#[local]</span><span class="vernacular"> Hint</span><span class="id"> Resolve</span><span class="id"> emeasurable_set1</span><span class="id"> :</span><span class="id"> core</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> __deprecated__itv_cpinfty_pinfty</span><span class="id"> :</span><span class="id"> `[+oo%E,</span><span class="id"> +oo[%classic</span><span class="id"> =</span><span class="id"> [set</span><span class="id"> +oo%E]</span><span class="id"> :&gt;</span><span class="id"> set</span> (<span class="id">\bar</span><span class="id"> R</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> itv_cyy</span>. Qed.</div></details>
<span class="id">#[deprecated</span>(<span class="id">since=</span><span class="id">&quot;mathcomp-analysis 0.6.0&quot;</span><span class="id">,</span><span class="id"> note=</span><span class="id">&quot;renamed `itv_cyy`&quot;</span>)<span class="id">]</span><br/>
<span class="vernacular">Notation</span><span class="id"> itv_cpinfty_pinfty</span><span class="id"> :=</span><span class="id"> __deprecated__itv_cpinfty_pinfty</span> (<span class="id">only</span><span class="id"> parsing</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> __deprecated__itv_opinfty_pinfty</span><span class="id"> :</span><span class="id"> `]+oo%E,</span><span class="id"> +oo[%classic</span><span class="id"> =</span><span class="id"> set0</span><span class="id"> :&gt;</span><span class="id"> set</span> (<span class="id">\bar</span><span class="id"> R</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> itv_oyy</span>. Qed.</div></details>
<span class="id">#[deprecated</span>(<span class="id">since=</span><span class="id">&quot;mathcomp-analysis 0.6.0&quot;</span><span class="id">,</span><span class="id"> note=</span><span class="id">&quot;renamed `itv_oyy`&quot;</span>)<span class="id">]</span><br/>
<span class="vernacular">Notation</span><span class="id"> itv_opinfty_pinfty</span><span class="id"> :=</span><span class="id"> __deprecated__itv_opinfty_pinfty</span> (<span class="id">only</span><span class="id"> parsing</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> __deprecated__itv_cninfty_pinfty</span><span class="id"> :</span><span class="id"> `[-oo%E,</span><span class="id"> +oo[%classic</span><span class="id"> =</span><span class="id"> setT</span><span class="id"> :&gt;</span><span class="id"> set</span> (<span class="id">\bar</span><span class="id"> R</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> itv_cNyy</span>. Qed.</div></details>
<span class="id">#[deprecated</span>(<span class="id">since=</span><span class="id">&quot;mathcomp-analysis 0.6.0&quot;</span><span class="id">,</span><span class="id"> note=</span><span class="id">&quot;renamed `itv_cNyy`&quot;</span>)<span class="id">]</span><br/>
<span class="vernacular">Notation</span><span class="id"> itv_cninfty_pinfty</span><span class="id"> :=</span><span class="id"> __deprecated__itv_cninfty_pinfty</span> (<span class="id">only</span><span class="id"> parsing</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> __deprecated__itv_oninfty_pinfty</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">`]-oo%E,</span><span class="id"> +oo[%classic</span><span class="id"> =</span><span class="id"> ~`</span><span class="id"> [set</span><span class="id"> -oo]%E</span><span class="id"> :&gt;</span><span class="id"> set</span> (<span class="id">\bar</span><span class="id"> R</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> itv_oNyy</span>. Qed.</div></details>
<span class="id">#[deprecated</span>(<span class="id">since=</span><span class="id">&quot;mathcomp-analysis 0.6.0&quot;</span><span class="id">,</span><span class="id"> note=</span><span class="id">&quot;renamed `itv_oNyy`&quot;</span>)<span class="id">]</span><br/>
<span class="vernacular">Notation</span><span class="id"> itv_oninfty_pinfty</span><span class="id"> :=</span><span class="id"> __deprecated__itv_oninfty_pinfty</span> (<span class="id">only</span><span class="id"> parsing</span>).<br/>
<br/>
<span class="vernacular">Let</span><span class="id"> emeasurable_itv_bndy</span><span class="id"> b</span> (<span class="id">y</span><span class="id"> :</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">measurable</span><span class="id"> [set`</span><span class="id"> Interval</span> (<span class="id">BSide</span><span class="id"> b</span><span class="id"> y</span>)<span class="id"> +oo%O]</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move:</span><span class="id"> y</span><span class="id"> =&gt;</span><span class="id"> [y|</span><span class="id"> |]</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> exists</span><span class="id"> [set`</span><span class="id"> Interval</span> (<span class="id">BSide</span><span class="id"> b</span><span class="id"> y</span>)<span class="id"> +oo%O];</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> measurable_itv</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="gallina-kwd"> exists</span><span class="id"> [set</span><span class="id"> +oo%E];</span><span class="id"> [constructor|rewrite</span><span class="id"> -punct_eitv_bndy]</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> case:</span><span class="id"> b;</span><span class="id"> rewrite</span><span class="id"> ?itv_oyy</span><span class="id"> ?itv_cyy</span>.<br/>
<span class="id">-</span><span class="id"> case:</span><span class="id"> b;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> itv_cNyy</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> itv_oNyy;</span><span class="id"> exact/measurableC</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Let</span><span class="id"> emeasurable_itv_Nybnd</span><span class="id"> b</span> (<span class="id">y</span><span class="id"> :</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">measurable</span><span class="id"> [set`</span><span class="id"> Interval</span><span class="id"> -oo%O</span> (<span class="id">BSide</span><span class="id"> b</span><span class="id"> y</span>)<span class="id">]</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> -setCitvr;</span><span class="id"> exact/measurableC/emeasurable_itv_bndy</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> emeasurable_itv</span> (<span class="id">i</span><span class="id"> :</span><span class="id"> interval</span> (<span class="id">\bar</span><span class="id"> R</span>))<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">measurable</span> (<span class="id">[set`</span><span class="id"> i]%classic</span><span class="id"> :</span><span class="id"> set</span><span class="id"> \bar</span><span class="id"> R</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> -[X</span><span class="gallina-kwd"> in</span><span class="id"> measurable</span><span class="id"> X]setCK;</span><span class="id"> apply:</span><span class="id"> measurableC</span>.<br/>
<span class="id">rewrite</span><span class="id"> set_interval</span>.<span class="id">setCitv</span><span class="id"> /=;</span><span class="id"> apply:</span><span class="id"> measurableU</span><span class="id"> =&gt;</span><span class="id"> [|]</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move:</span><span class="id"> i</span><span class="id"> =&gt;</span><span class="id"> [[b1</span><span class="id"> i1|[|]]</span><span class="id"> i2]</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> ?set_interval</span>.<span class="id">set_itvE</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move:</span><span class="id"> i</span><span class="id"> =&gt;</span><span class="id"> [i1</span><span class="id"> [b2</span><span class="id"> i2|[|]]]</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> ?set_interval</span>.<span class="id">set_itvE</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> measurable_image_fine</span> (<span class="id">X</span><span class="id"> :</span><span class="id"> set</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id"> :</span><span class="id"> measurable</span><span class="id"> X</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">measurable</span><span class="id"> [set</span><span class="id"> fine</span><span class="id"> x</span><span class="id"> |</span><span class="id"> x</span><span class="gallina-kwd"> in</span><span class="id"> X</span><span class="id"> `\`</span><span class="id"> [set</span><span class="id"> -oo;</span><span class="id"> +oo]%E]</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">case</span><span class="id"> =&gt;</span><span class="id"> Y</span><span class="id"> mY</span><span class="id"> [X'</span><span class="id"> [</span><span class="id"> |</span><span class="id"> &lt;-{X}</span><span class="id"> |</span><span class="id"> &lt;-{X}</span><span class="id"> |</span><span class="id"> &lt;-{X}</span><span class="id"> ]]</span>.<br/>
<span class="id">-</span><span class="id"> rewrite</span><span class="id"> setU0</span><span class="id"> =&gt;</span><span class="id"> &lt;-{X}</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> [X</span><span class="gallina-kwd"> in</span><span class="id"> measurable</span><span class="id"> X]</span>(_<span class="id"> :</span><span class="id"> _</span><span class="id"> =</span><span class="id"> Y</span>)<span class="id"> //</span><span class="id"> predeqE</span><span class="id"> =&gt;</span><span class="id"> r;</span><span class="id"> split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> [x</span><span class="id"> [[x'</span><span class="id"> Yx'</span><span class="id"> &lt;-{x}/=</span><span class="id"> _</span><span class="id"> &lt;-//]]]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> Yr;</span><span class="gallina-kwd"> exists</span><span class="id"> r%:E;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> [|[]//];</span><span class="gallina-kwd"> exists</span><span class="id"> r</span>.<br/>
<span class="id">-</span><span class="id"> rewrite</span><span class="id"> [X</span><span class="gallina-kwd"> in</span><span class="id"> measurable</span><span class="id"> X]</span>(_<span class="id"> :</span><span class="id"> _</span><span class="id"> =</span><span class="id"> Y</span>)<span class="id"> //</span><span class="id"> predeqE</span><span class="id"> =&gt;</span><span class="id"> r;</span><span class="id"> split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> [x</span><span class="id"> [[[x'</span><span class="id"> Yx'</span><span class="id"> &lt;-</span><span class="id"> _</span><span class="id"> &lt;-//]|]]]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> &lt;-;</span><span class="id"> rewrite</span><span class="id"> not_orP</span><span class="id"> =&gt;</span><span class="id"> -[]/</span>(_<span class="id"> erefl</span>).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> Yr;</span><span class="gallina-kwd"> exists</span><span class="id"> r%:E</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> [|[]//];</span><span class="id"> left;</span><span class="gallina-kwd"> exists</span><span class="id"> r</span>.<br/>
<span class="id">-</span><span class="id"> rewrite</span><span class="id"> [X</span><span class="gallina-kwd"> in</span><span class="id"> measurable</span><span class="id"> X]</span>(_<span class="id"> :</span><span class="id"> _</span><span class="id"> =</span><span class="id"> Y</span>)<span class="id"> //</span><span class="id"> predeqE</span><span class="id"> =&gt;</span><span class="id"> r;</span><span class="id"> split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> [x</span><span class="id"> [[[x'</span><span class="id"> Yx'</span><span class="id"> &lt;-{x}</span><span class="id"> _</span><span class="id"> &lt;-//]|]]]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> -&gt;;</span><span class="id"> rewrite</span><span class="id"> not_orP</span><span class="id"> =&gt;</span><span class="id"> -[_]/</span>(_<span class="id"> erefl</span>).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> Yr;</span><span class="gallina-kwd"> exists</span><span class="id"> r%:E</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> [|[]//];</span><span class="id"> left;</span><span class="gallina-kwd"> exists</span><span class="id"> r</span>.<br/>
<span class="id">-</span><span class="id"> rewrite</span><span class="id"> [X</span><span class="gallina-kwd"> in</span><span class="id"> measurable</span><span class="id"> X]</span>(_<span class="id"> :</span><span class="id"> _</span><span class="id"> =</span><span class="id"> Y</span>)<span class="id"> //</span><span class="id"> predeqE</span><span class="id"> =&gt;</span><span class="id"> r;</span><span class="id"> split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> setDUl</span><span class="id"> setDv</span><span class="id"> setU0</span><span class="id"> =&gt;</span><span class="id"> -[_</span><span class="id"> [[x'</span><span class="id"> Yx'</span><span class="id"> &lt;-]]</span><span class="id"> _</span><span class="id"> &lt;-]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> Yr;</span><span class="gallina-kwd"> exists</span><span class="id"> r%:E</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> [|[]//];</span><span class="id"> left;</span><span class="gallina-kwd"> exists</span><span class="id"> r</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> measurable_ball</span> (<span class="id">x</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> e</span><span class="id"> :</span><span class="id"> measurable</span> (<span class="id">ball</span><span class="id"> x</span><span class="id"> e</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> ball_itv;</span><span class="id"> exact:</span><span class="id"> measurable_itv</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> measurable_closed_ball</span> (<span class="id">x</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> r</span><span class="id"> :</span><span class="id"> measurable</span> (<span class="id">closed_ball</span><span class="id"> x</span><span class="id"> r</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">have</span><span class="id"> [r0|r0]</span><span class="id"> :=</span><span class="id"> leP</span><span class="id"> r</span><span class="id"> 0;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> closed_ball0</span>.<br/>
<span class="id">rewrite</span><span class="id"> closed_ball_itv//</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> salgebra_R_ssets</span>.<br/>
<span class="id">#[global]</span><br/>
<span class="vernacular">Hint</span><span class="id"> Extern</span><span class="id"> 0</span> (<span class="id">measurable</span><span class="id"> [set</span><span class="id"> _]</span>)<span class="id"> =&gt;</span><span class="id"> solve</span><span class="id"> [apply:</span><span class="id"> measurable_set1|</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> emeasurable_set1]</span><span class="id"> :</span><span class="id"> core</span>.<br/>
<span class="id">#[global]</span><br/>
<span class="vernacular">Hint</span><span class="id"> Extern</span><span class="id"> 0</span> (<span class="id">measurable</span><span class="id"> [set`</span><span class="id"> _]</span> )<span class="id"> =&gt;</span><span class="id"> exact:</span><span class="id"> measurable_itv</span><span class="id"> :</span><span class="id"> core</span>.<br/>
<span class="id">#[deprecated</span>(<span class="id">since=</span><span class="id">&quot;mathcomp-analysis 0.6.2&quot;</span><span class="id">,</span><span class="id"> note=</span><span class="id">&quot;use `emeasurable_itv` instead&quot;</span>)<span class="id">]</span><br/>
<span class="vernacular">Notation</span><span class="id"> emeasurable_itv_bnd_pinfty</span><span class="id"> :=</span><span class="id"> emeasurable_itv</span> (<span class="id">only</span><span class="id"> parsing</span>).<br/>
<span class="id">#[deprecated</span>(<span class="id">since=</span><span class="id">&quot;mathcomp-analysis 0.6.2&quot;</span><span class="id">,</span><span class="id"> note=</span><span class="id">&quot;use `emeasurable_itv` instead&quot;</span>)<span class="id">]</span><br/>
<span class="vernacular">Notation</span><span class="id"> emeasurable_itv_ninfty_bnd</span><span class="id"> :=</span><span class="id"> emeasurable_itv</span> (<span class="id">only</span><span class="id"> parsing</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> fine_measurable</span> (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>) (<span class="id">D</span><span class="id"> :</span><span class="id"> set</span> (<span class="id">\bar</span><span class="id"> R</span>))<span class="id"> :</span><span class="id"> measurable</span><span class="id"> D</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">measurable_fun</span><span class="id"> D</span><span class="id"> fine</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> mD</span><span class="id"> _</span><span class="id"> /=</span><span class="id"> B</span><span class="id"> mB;</span><span class="id"> rewrite</span><span class="id"> [X</span><span class="gallina-kwd"> in</span><span class="id"> measurable</span><span class="id"> X]</span>(_<span class="id"> :</span><span class="id"> _</span><span class="id"> `&amp;`</span><span class="id"> _</span><span class="id"> =</span><span class="gallina-kwd"> if</span><span class="id"> 0%R</span><span class="id"> \in</span><span class="id"> B</span><span class="gallina-kwd"> then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">D</span><span class="id"> `&amp;`</span> ((<span class="id">EFin</span><span class="id"> @`</span><span class="id"> B</span>)<span class="id"> `|`</span><span class="id"> [set</span><span class="id"> -oo;</span><span class="id"> +oo]%E</span>)<span class="gallina-kwd"> else</span><span class="id"> D</span><span class="id"> `&amp;`</span><span class="id"> EFin</span><span class="id"> @`</span><span class="id"> B</span>)<span class="id">;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">apply/seteqP;</span><span class="id"> split=&gt;</span><span class="id"> [[r</span><span class="id"> [Dr</span><span class="id"> Br]|[Doo</span><span class="id"> B0]|[Doo</span><span class="id"> B0]]|[r|</span><span class="id"> |]]</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> case:</span><span class="id"> ifPn</span><span class="id"> =&gt;</span><span class="id"> _;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> left;</span><span class="gallina-kwd"> exists</span><span class="id"> r</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> mem_set//;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> right;</span><span class="id"> right</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> mem_set//;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> right;</span><span class="id"> left</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> case:</span><span class="id"> ifPn</span><span class="id"> =&gt;</span><span class="id"> [_</span><span class="id"> [Dr</span><span class="id"> [[s</span><span class="id"> +</span><span class="id"> [sr]]|[]//]]|_</span><span class="id"> [Dr</span><span class="id"> [s</span><span class="id"> +</span><span class="id"> [sr]]]];</span><span class="id"> rewrite</span><span class="id"> sr</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> case:</span><span class="id"> ifPn</span><span class="id"> =&gt;</span><span class="id"> [/[!inE]</span><span class="id"> B0</span><span class="id"> [Doo</span><span class="id"> [[]//|]]</span><span class="id"> [//|_]|B0</span><span class="id"> [Doo//]</span><span class="id"> []]</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> case:</span><span class="id"> ifPn</span><span class="id"> =&gt;</span><span class="id"> [/[!inE]</span><span class="id"> B0</span><span class="id"> [Doo</span><span class="id"> [[]//|]]</span><span class="id"> [//|_]|B0</span><span class="id"> [Doo//]</span><span class="id"> []]</span>.<br/>
<span class="id">case:</span><span class="id"> ifPn</span><span class="id"> =&gt;</span><span class="id"> B0;</span><span class="id"> apply/measurableI</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> last</span><span class="id"> exact:</span><span class="id"> measurable_image_EFin</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> measurableU;</span><span class="id"> [exact:</span><span class="id"> measurable_image_EFin|exact:</span><span class="id"> measurableU]</span>.<br/>
Qed.</div></details>
<span class="id">#[global]</span><span class="vernacular"> Hint</span><span class="id"> Extern</span><span class="id"> 0</span> (<span class="id">measurable_fun</span><span class="id"> _</span><span class="id"> fine</span>)<span class="id"> =&gt;</span><br/>
&nbsp;&nbsp;<span class="id">solve</span><span class="id"> [exact:</span><span class="id"> fine_measurable]</span><span class="id"> :</span><span class="id"> core</span>.<br/>
<span class="id">#[deprecated</span>(<span class="id">since=</span><span class="id">&quot;mathcomp-analysis 1.4.0&quot;</span><span class="id">,</span><span class="id"> note=</span><span class="id">&quot;use `fine_measurable` instead&quot;</span>)<span class="id">]</span><br/>
<span class="vernacular">Notation</span><span class="id"> measurable_fine</span><span class="id"> :=</span><span class="id"> fine_measurable</span> (<span class="id">only</span><span class="id"> parsing</span>).<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> measurable_fun_measurable</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<span class="vernacular">Context</span><span class="id"> d</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> sigmaRingType</span><span class="id"> d</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>).<br/>
<span class="vernacular">Variables</span> (<span class="id">D</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>).<br/>
<span class="vernacular">Hypotheses</span> (<span class="id">mD</span><span class="id"> :</span><span class="id"> measurable</span><span class="id"> D</span>) (<span class="id">mf</span><span class="id"> :</span><span class="id"> measurable_fun</span><span class="id"> D</span><span class="id"> f</span>).<br/>
<span class="vernacular">Implicit</span><span class="id"> Types</span><span class="id"> y</span><span class="id"> :</span><span class="id"> \bar</span><span class="id"> R</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> emeasurable_fun_c_infty</span><span class="id"> y</span><span class="id"> :</span><span class="id"> measurable</span> (<span class="id">D</span><span class="id"> `&amp;`</span><span class="id"> [set</span><span class="id"> x</span><span class="id"> |</span><span class="id"> y</span><span class="id"> &lt;=</span><span class="id"> f</span><span class="id"> x]</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> -preimage_itv_c_infty;</span><span class="id"> exact/mf/emeasurable_itv</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> emeasurable_fun_o_infty</span><span class="id"> y</span><span class="id"> :</span> <span class="id"> measurable</span> (<span class="id">D</span><span class="id"> `&amp;`</span><span class="id"> [set</span><span class="id"> x</span><span class="id"> |</span><span class="id"> y</span><span class="id"> &lt;</span><span class="id"> f</span><span class="id"> x]</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> -preimage_itv_o_infty;</span><span class="id"> exact/mf/emeasurable_itv</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> emeasurable_fun_infty_o</span><span class="id"> y</span><span class="id"> :</span><span class="id"> measurable</span> (<span class="id">D</span><span class="id"> `&amp;`</span><span class="id"> [set</span><span class="id"> x</span><span class="id"> |</span><span class="id"> f</span><span class="id"> x</span><span class="id"> &lt;</span><span class="id"> y]</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> -preimage_itv_infty_o;</span><span class="id"> exact/mf/emeasurable_itv</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> emeasurable_fun_infty_c</span><span class="id"> y</span><span class="id"> :</span><span class="id"> measurable</span> (<span class="id">D</span><span class="id"> `&amp;`</span><span class="id"> [set</span><span class="id"> x</span><span class="id"> |</span><span class="id"> f</span><span class="id"> x</span><span class="id"> &lt;=</span><span class="id"> y]</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> -preimage_itv_infty_c;</span><span class="id"> exact/mf/emeasurable_itv</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> emeasurable_fin_num</span><span class="id"> :</span><span class="id"> measurable</span> (<span class="id">D</span><span class="id"> `&amp;`</span><span class="id"> [set</span><span class="id"> x</span><span class="id"> |</span><span class="id"> f</span><span class="id"> x</span><span class="id"> \is</span><span class="id"> a</span><span class="id"> fin_num]</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> [X</span><span class="gallina-kwd"> in</span><span class="id"> measurable</span><span class="id"> X]</span>(_<span class="id"> :</span><span class="id"> _</span><span class="id"> =</span><br/>
&nbsp;&nbsp;<span class="id">\bigcup_k</span> (<span class="id">D</span><span class="id"> `&amp;`</span> (<span class="id">[set</span> <span class="id"> x</span><span class="id"> |</span><span class="id"> -</span><span class="id"> k%:R%:E</span><span class="id"> &lt;=</span><span class="id"> f</span><span class="id"> x]</span><span class="id"> `&amp;`</span><span class="id"> [set</span><span class="id"> x</span><span class="id"> |</span><span class="id"> f</span><span class="id"> x</span><span class="id"> &lt;=</span><span class="id"> k%:R%:E]</span>))).<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> bigcupT_measurable</span><span class="id"> =&gt;</span><span class="id"> k;</span><span class="id"> rewrite</span><span class="id"> -</span>(<span class="id">setIid</span><span class="id"> D</span>)<span class="id"> setIACA</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> measurableI;</span><span class="id"> [exact:</span><span class="id"> emeasurable_fun_c_infty|</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> emeasurable_fun_infty_c]</span>.<br/>
<span class="id">rewrite</span><span class="id"> predeqE</span><span class="id"> =&gt;</span><span class="id"> t;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> [/=</span><span class="id"> [Dt</span><span class="id"> ft]|]</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> [ft0|ft0]</span><span class="id"> :=</span><span class="id"> leP</span><span class="id"> 0%R</span> (<span class="id">fine</span> (<span class="id">f</span><span class="id"> t</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">exists</span><span class="id"> `|ceil</span> (<span class="id">fine</span> (<span class="id">f</span><span class="id"> t</span>))<span class="id">|%N</span><span class="id"> =&gt;</span><span class="id"> //=;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -{2}</span>(<span class="id">fineK</span><span class="id"> ft</span>)<span class="id">//</span><span class="id"> lee_fin</span> (<span class="id">le_trans</span><span class="id"> _</span><span class="id"> ft0</span>)<span class="id">//</span><span class="id"> lerNl</span><span class="id"> oppr0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> natr_absz</span><span class="id"> ger0_norm;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -ceil_ge0</span> (<span class="id">lt_le_trans</span><span class="id"> _</span><span class="id"> ft0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -</span>(<span class="id">fineK</span><span class="id"> ft</span>)<span class="id"> lee_fin</span><span class="id"> ceil_ge</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">exists</span><span class="id"> `|floor</span> (<span class="id">fine</span> (<span class="id">f</span><span class="id"> t</span>))<span class="id">|%N</span><span class="id"> =&gt;</span><span class="id"> //=;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> natr_absz</span><span class="id"> ltr0_norm</span><span class="id"> -?floor_lt0//</span><span class="id"> EFinN</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -{2}</span>(<span class="id">fineK</span><span class="id"> ft</span>)<span class="id"> lee_fin</span><span class="id"> mulrNz</span><span class="id"> opprK</span><span class="id"> ge_floor//</span><span class="id"> ?num_real</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -</span>(<span class="id">fineK</span><span class="id"> ft</span>)<span class="id">//</span><span class="id"> lee_fin</span> (<span class="id">le_trans</span> (<span class="id">ltW</span><span class="id"> ft0</span>)).<br/>
<span class="id">move=&gt;</span><span class="id"> [n</span><span class="id"> _]</span><span class="id"> [/=</span><span class="id"> Dt</span><span class="id"> [nft</span><span class="id"> fnt]];</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> rewrite</span><span class="id"> fin_numElt</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span> (<span class="id">lt_le_trans</span><span class="id"> _</span><span class="id"> nft</span>)<span class="id"> ?ltNyr//=</span> (<span class="id">le_lt_trans</span><span class="id"> fnt</span>)<span class="id">//</span><span class="id"> ltry</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> emeasurable_neq</span><span class="id"> y</span><span class="id"> :</span><span class="id"> measurable</span> (<span class="id">D</span><span class="id"> `&amp;`</span><span class="id"> [set</span><span class="id"> x</span><span class="id"> |</span><span class="id"> f</span><span class="id"> x</span><span class="id"> !=</span><span class="id"> y]</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span> (_<span class="id"> :</span><span class="id"> [set</span><span class="id"> x</span><span class="id"> |</span><span class="id"> f</span><span class="id"> x</span><span class="id"> !=</span><span class="id"> y]</span><span class="id"> =</span><span class="id"> f</span><span class="id"> @^-1`</span> (<span class="id">setT</span><span class="id"> `\</span><span class="id"> y</span>)).<br/>
&nbsp;&nbsp;<span class="id">exact/mf/measurableD</span>.<br/>
<span class="id">rewrite</span><span class="id"> predeqE</span><span class="id"> =&gt;</span><span class="id"> t;</span><span class="id"> split;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> /preimage</span><span class="id"> /=</span><span class="id"> =&gt;</span><span class="id"> -[_</span><span class="id"> /eqP]</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /=</span><span class="id"> =&gt;</span><span class="id"> ft0;</span><span class="id"> rewrite</span><span class="id"> /preimage</span><span class="id"> /=;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact/eqP</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> measurable_fun_measurable</span>.<br/>
<br/>
<span class="vernacular">Module</span><span class="id"> RGenOInfty</span>.<br/>
<span class="vernacular">Section</span><span class="id"> rgenoinfty</span>.<br/>
<span class="vernacular">Variable</span><span class="id"> R</span><span class="id"> :</span><span class="id"> realType</span>.<br/>
<span class="vernacular">Implicit</span><span class="id"> Types</span><span class="id"> x</span><span class="id"> y</span><span class="id"> z</span><span class="id"> :</span><span class="id"> R</span>.<br/>
<br/>
<span class="vernacular">Definition</span><span class="id"> G</span><span class="id"> :=</span><span class="id"> [set</span><span class="id"> A</span><span class="id"> |</span><span class="gallina-kwd"> exists</span><span class="id"> x,</span><span class="id"> A</span><span class="id"> =</span><span class="id"> `]x,</span><span class="id"> +oo[%classic]</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> measurable_itv_bnd_infty</span><span class="id"> b</span><span class="id"> x</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">G</span>.<span class="id">-sigma</span>.<span class="id">-measurable</span><span class="id"> [set`</span><span class="id"> Interval</span> (<span class="id">BSide</span><span class="id"> b</span><span class="id"> x</span>)<span class="id"> +oo%O]</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">case:</span><span class="id"> b;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> sub_sigma_algebra;</span><span class="id"> eexists;</span><span class="id"> reflexivity</span>.<br/>
<span class="id">rewrite</span><span class="id"> itv_c_inftyEbigcap;</span><span class="id"> apply:</span><span class="id"> bigcapT_measurable</span><span class="id"> =&gt;</span><span class="id"> k</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> sub_sigma_algebra;</span><span class="id"> eexists;</span><span class="id"> reflexivity</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> measurable_itv_bounded</span><span class="id"> a</span><span class="id"> b</span><span class="id"> x</span><span class="id"> :</span><span class="id"> a</span><span class="id"> !=</span><span class="id"> +oo%O</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">G</span>.<span class="id">-sigma</span>.<span class="id">-measurable</span><span class="id"> [set`</span><span class="id"> Interval</span><span class="id"> a</span> (<span class="id">BSide</span><span class="id"> b</span><span class="id"> x</span>)<span class="id">]</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">case:</span><span class="id"> a</span><span class="id"> =&gt;</span><span class="id"> [a</span><span class="id"> r</span><span class="id"> _|[_|//]]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> set_itv_splitD;</span><span class="id"> apply:</span><span class="id"> measurableD</span><span class="id"> =&gt;</span><span class="id"> //;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> measurable_itv_bnd_infty</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -setCitvr;</span><span class="id"> apply:</span><span class="id"> measurableC;</span><span class="id"> apply:</span><span class="id"> measurable_itv_bnd_infty</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> measurableE</span><span class="id"> :</span> (<span class="id">@ocitv</span><span class="id"> R</span>).<span class="id">-sigma</span>.<span class="id">-measurable</span><span class="id"> =</span><span class="id"> G</span>.<span class="id">-sigma</span>.<span class="id">-measurable</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> eqEsubset;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> A</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> smallest_sub;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> smallest_sigma_algebra</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> I</span><span class="id"> [x</span><span class="id"> _</span><span class="id"> &lt;-];</span><span class="id"> exact:</span><span class="id"> measurable_itv_bounded</span>.<br/>
<span class="id">apply:</span><span class="id"> smallest_sub;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> smallest_sigma_algebra</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> A'</span><span class="id"> /=</span><span class="id"> [x</span><span class="id"> -&gt;];</span><span class="id"> exact:</span><span class="id"> measurable_itv</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> rgenoinfty</span>.<br/>
<span class="vernacular">End</span><span class="id"> RGenOInfty</span>.<br/>
<br/>
<span class="vernacular">Module</span><span class="id"> RGenInftyO</span>.<br/>
<span class="vernacular">Section</span><span class="id"> rgeninftyo</span>.<br/>
<span class="vernacular">Variable</span><span class="id"> R</span><span class="id"> :</span><span class="id"> realType</span>.<br/>
<span class="vernacular">Implicit</span><span class="id"> Types</span><span class="id"> x</span><span class="id"> y</span><span class="id"> z</span><span class="id"> :</span><span class="id"> R</span>.<br/>
<br/>
<span class="vernacular">Definition</span><span class="id"> G</span><span class="id"> :=</span><span class="id"> [set</span><span class="id"> A</span><span class="id"> |</span><span class="gallina-kwd"> exists</span><span class="id"> x,</span><span class="id"> A</span><span class="id"> =</span><span class="id"> `]-oo,</span><span class="id"> x[%classic]</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> measurable_itv_bnd_infty</span><span class="id"> b</span><span class="id"> x</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">G</span>.<span class="id">-sigma</span>.<span class="id">-measurable</span><span class="id"> [set`</span><span class="id"> Interval</span><span class="id"> -oo%O</span> (<span class="id">BSide</span><span class="id"> b</span><span class="id"> x</span>)<span class="id">]</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">case:</span><span class="id"> b;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> apply</span><span class="id"> sub_sigma_algebra;</span><span class="id"> eexists;</span><span class="id"> reflexivity</span>.<br/>
<span class="id">rewrite</span><span class="id"> -setCitvr</span><span class="id"> itv_o_inftyEbigcup;</span><span class="id"> apply/measurableC/bigcupT_measurable</span><span class="id"> =&gt;</span><span class="id"> n</span>.<br/>
<span class="id">rewrite</span><span class="id"> -setCitvl;</span><span class="id"> apply:</span><span class="id"> measurableC</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> sub_sigma_algebra;</span><span class="id"> eexists;</span><span class="id"> reflexivity</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> measurable_itv_bounded</span><span class="id"> a</span><span class="id"> b</span><span class="id"> x</span><span class="id"> :</span><span class="id"> a</span><span class="id"> !=</span><span class="id"> -oo%O</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">G</span>.<span class="id">-sigma</span>.<span class="id">-measurable</span><span class="id"> [set`</span><span class="id"> Interval</span> (<span class="id">BSide</span><span class="id"> b</span><span class="id"> x</span>)<span class="id"> a]</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">case:</span><span class="id"> a</span><span class="id"> =&gt;</span><span class="id"> [a</span><span class="id"> r</span><span class="id"> _|[//|_]]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> set_itv_splitD;</span><span class="id"> apply/measurableD</span><span class="id"> =&gt;</span><span class="id"> //;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -setCitvl;</span><span class="id"> apply:</span><span class="id"> measurableC;</span><span class="id"> exact:</span><span class="id"> measurable_itv_bnd_infty</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -setCitvl;</span><span class="id"> apply:</span><span class="id"> measurableC;</span><span class="id"> apply:</span><span class="id"> measurable_itv_bnd_infty</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> measurableE</span><span class="id"> :</span> (<span class="id">@ocitv</span><span class="id"> R</span>).<span class="id">-sigma</span>.<span class="id">-measurable</span><span class="id"> =</span><span class="id"> G</span>.<span class="id">-sigma</span>.<span class="id">-measurable</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> eqEsubset;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> A</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> smallest_sub;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> smallest_sigma_algebra</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> I</span><span class="id"> [x</span><span class="id"> _</span><span class="id"> &lt;-];</span><span class="id"> apply:</span><span class="id"> measurable_itv_bounded</span>.<br/>
<span class="id">apply:</span><span class="id"> smallest_sub;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> smallest_sigma_algebra</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> A'</span><span class="id"> /=</span><span class="id"> [x</span><span class="id"> -&gt;];</span><span class="id"> apply:</span><span class="id"> measurable_itv</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> rgeninftyo</span>.<br/>
<span class="vernacular">End</span><span class="id"> RGenInftyO</span>.<br/>
<br/>
<span class="vernacular">Module</span><span class="id"> RGenCInfty</span>.<br/>
<span class="vernacular">Section</span><span class="id"> rgencinfty</span>.<br/>
<span class="vernacular">Variable</span><span class="id"> R</span><span class="id"> :</span><span class="id"> realType</span>.<br/>
<span class="vernacular">Implicit</span><span class="id"> Types</span><span class="id"> x</span><span class="id"> y</span><span class="id"> z</span><span class="id"> :</span><span class="id"> R</span>.<br/>
<br/>
<span class="vernacular">Definition</span><span class="id"> G</span><span class="id"> :</span><span class="id"> set</span> (<span class="id">set</span><span class="id"> R</span>)<span class="id"> :=</span><span class="id"> [set</span><span class="id"> A</span><span class="id"> |</span><span class="gallina-kwd"> exists</span><span class="id"> x,</span><span class="id"> A</span><span class="id"> =</span><span class="id"> `[x,</span><span class="id"> +oo[%classic]</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> measurable_itv_bnd_infty</span><span class="id"> b</span><span class="id"> x</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">G</span>.<span class="id">-sigma</span>.<span class="id">-measurable</span><span class="id"> [set`</span><span class="id"> Interval</span> (<span class="id">BSide</span><span class="id"> b</span><span class="id"> x</span>)<span class="id"> +oo%O]</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">case:</span><span class="id"> b;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> sub_sigma_algebra;</span><span class="gallina-kwd"> exists</span><span class="id"> x;</span><span class="id"> rewrite</span><span class="id"> set_itv_c_infty</span>.<br/>
<span class="id">rewrite</span><span class="id"> itv_o_inftyEbigcup;</span><span class="id"> apply:</span><span class="id"> bigcupT_measurable</span><span class="id"> =&gt;</span><span class="id"> k</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> sub_sigma_algebra;</span><span class="id"> eexists;</span><span class="id"> reflexivity</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> measurable_itv_bounded</span><span class="id"> a</span><span class="id"> b</span><span class="id"> y</span><span class="id"> :</span><span class="id"> a</span><span class="id"> !=</span><span class="id"> +oo%O</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">G</span>.<span class="id">-sigma</span>.<span class="id">-measurable</span><span class="id"> [set`</span><span class="id"> Interval</span><span class="id"> a</span> (<span class="id">BSide</span><span class="id"> b</span><span class="id"> y</span>)<span class="id">]</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">case:</span><span class="id"> a</span><span class="id"> =&gt;</span><span class="id"> [a</span><span class="id"> r</span><span class="id"> _|[_|//]]</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> set_itv_splitD</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> measurableD;</span><span class="id"> apply:</span><span class="id"> measurable_itv_bnd_infty</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -setCitvr;</span><span class="id"> apply:</span><span class="id"> measurableC;</span><span class="id"> apply:</span><span class="id"> measurable_itv_bnd_infty</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> measurableE</span><span class="id"> :</span> (<span class="id">@ocitv</span><span class="id"> R</span>).<span class="id">-sigma</span>.<span class="id">-measurable</span><span class="id"> =</span><span class="id"> G</span>.<span class="id">-sigma</span>.<span class="id">-measurable</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> eqEsubset;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> A</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> smallest_sub;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> smallest_sigma_algebra</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> I</span><span class="id"> [x</span><span class="id"> _</span><span class="id"> &lt;-];</span><span class="id"> apply:</span><span class="id"> measurable_itv_bounded</span>.<br/>
<span class="id">apply:</span><span class="id"> smallest_sub;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> smallest_sigma_algebra</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> A'</span><span class="id"> /=</span><span class="id"> [x</span><span class="id"> -&gt;];</span><span class="id"> apply:</span><span class="id"> measurable_itv</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> rgencinfty</span>.<br/>
<span class="vernacular">End</span><span class="id"> RGenCInfty</span>.<br/>
<br/>
<span class="vernacular">Module</span><span class="id"> RGenOpens</span>.<br/>
<span class="vernacular">Section</span><span class="id"> rgenopens</span>.<br/>
<span class="vernacular">Variable</span><span class="id"> R</span><span class="id"> :</span><span class="id"> realType</span>.<br/>
<span class="vernacular">Implicit</span><span class="id"> Types</span><span class="id"> x</span><span class="id"> y</span><span class="id"> z</span><span class="id"> :</span><span class="id"> R</span>.<br/>
<br/>
<span class="vernacular">Definition</span><span class="id"> G</span><span class="id"> :=</span><span class="id"> [set</span><span class="id"> A</span><span class="id"> |</span><span class="gallina-kwd"> exists</span><span class="id"> x</span><span class="id"> y,</span><span class="id"> A</span><span class="id"> =</span><span class="id"> `]x,</span><span class="id"> y[%classic]</span>.<br/>
<br/>
<span class="vernacular">Local</span><span class="vernacular"> Lemma</span><span class="id"> measurable_itvoo</span><span class="id"> x</span><span class="id"> y</span><span class="id"> :</span><span class="id"> G</span>.<span class="id">-sigma</span>.<span class="id">-measurable</span><span class="id"> `]x,</span><span class="id"> y[%classic</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> apply</span><span class="id"> sub_sigma_algebra;</span><span class="id"> eexists;</span><span class="id"> eexists;</span><span class="id"> reflexivity</span>. Qed.</div></details>
<br/>
<span class="vernacular">Local</span><span class="vernacular"> Lemma</span><span class="id"> measurable_itv_o_infty</span><span class="id"> x</span><span class="id"> :</span><span class="id"> G</span>.<span class="id">-sigma</span>.<span class="id">-measurable</span><span class="id"> `]x,</span><span class="id"> +oo[%classic</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> itv_bnd_inftyEbigcup;</span><span class="id"> apply:</span><span class="id"> bigcupT_measurable</span><span class="id"> =&gt;</span><span class="id"> i</span>.<br/>
<span class="id">exact:</span><span class="id"> measurable_itvoo</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> measurable_itv_bnd_infty</span><span class="id"> b</span><span class="id"> x</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">G</span>.<span class="id">-sigma</span>.<span class="id">-measurable</span><span class="id"> [set`</span><span class="id"> Interval</span> (<span class="id">BSide</span><span class="id"> b</span><span class="id"> x</span>)<span class="id"> +oo%O]</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">case:</span><span class="id"> b;</span><span class="id"> last</span><span class="id"> exact:</span><span class="id"> measurable_itv_o_infty</span>.<br/>
<span class="id">rewrite</span><span class="id"> itv_c_inftyEbigcap;</span><span class="id"> apply:</span><span class="id"> bigcapT_measurable</span><span class="id"> =&gt;</span><span class="id"> k</span>.<br/>
<span class="id">exact:</span><span class="id"> measurable_itv_o_infty</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> measurable_itv_infty_bnd</span><span class="id"> b</span><span class="id"> x</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">G</span>.<span class="id">-sigma</span>.<span class="id">-measurable</span><span class="id"> [set`</span><span class="id"> Interval</span><span class="id"> -oo%O</span> (<span class="id">BSide</span><span class="id"> b</span><span class="id"> x</span>)<span class="id">]</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -setCitvr;</span><span class="id"> apply:</span><span class="id"> measurableC;</span><span class="id"> exact:</span><span class="id"> measurable_itv_bnd_infty</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> measurable_itv_bounded</span><span class="id"> a</span><span class="id"> x</span><span class="id"> b</span><span class="id"> y</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">G</span>.<span class="id">-sigma</span>.<span class="id">-measurable</span><span class="id"> [set`</span><span class="id"> Interval</span> (<span class="id">BSide</span><span class="id"> a</span><span class="id"> x</span>) (<span class="id">BSide</span><span class="id"> b</span><span class="id"> y</span>)<span class="id">]</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move:</span><span class="id"> a</span><span class="id"> b</span><span class="id"> =&gt;</span><span class="id"> []</span><span class="id"> [];</span><span class="id"> rewrite</span><span class="id"> -[X</span><span class="gallina-kwd"> in</span><span class="id"> measurable</span><span class="id"> X]setCK</span><span class="id"> setCitv;</span><br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> measurableC;</span><span class="id"> apply:</span><span class="id"> measurableU;</span><span class="id"> try</span><span class="id"> solve[</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> measurable_itv_infty_bnd|exact:</span><span class="id"> measurable_itv_bnd_infty]</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> measurableE</span><span class="id"> :</span> (<span class="id">@ocitv</span><span class="id"> R</span>).<span class="id">-sigma</span>.<span class="id">-measurable</span><span class="id"> =</span><span class="id"> G</span>.<span class="id">-sigma</span>.<span class="id">-measurable</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> eqEsubset;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> A</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> smallest_sub;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> smallest_sigma_algebra</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> I</span><span class="id"> [x</span><span class="id"> _</span><span class="id"> &lt;-];</span><span class="id"> apply:</span><span class="id"> measurable_itv_bounded</span>.<br/>
<span class="id">apply:</span><span class="id"> smallest_sub;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> smallest_sigma_algebra</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> A'</span><span class="id"> /=</span><span class="id"> [x</span><span class="id"> [y</span><span class="id"> -&gt;]];</span><span class="id"> apply:</span><span class="id"> measurable_itv</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> rgenopens</span>.<br/>
<span class="vernacular">End</span><span class="id"> RGenOpens</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> erealwithrays</span>.<br/>
<span class="vernacular">Variable</span><span class="id"> R</span><span class="id"> :</span><span class="id"> realType</span>.<br/>
<span class="vernacular">Implicit</span><span class="id"> Types</span> (<span class="id">x</span><span class="id"> y</span><span class="id"> z</span><span class="id"> :</span><span class="id"> \bar</span><span class="id"> R</span>) (<span class="id">r</span><span class="id"> s</span><span class="id"> :</span><span class="id"> R</span>).<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> EFin_itv_bnd_infty</span><span class="id"> b</span><span class="id"> r</span><span class="id"> :</span><span class="id"> EFin</span><span class="id"> @`</span><span class="id"> [set`</span><span class="id"> Interval</span> (<span class="id">BSide</span><span class="id"> b</span><span class="id"> r</span>)<span class="id"> +oo%O]</span><span class="id"> =</span><br/>
&nbsp;&nbsp;<span class="id">[set`</span><span class="id"> Interval</span> (<span class="id">BSide</span><span class="id"> b</span><span class="id"> r%:E</span>)<span class="id"> +oo%O]</span><span class="id"> `\</span><span class="id"> +oo</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> eqEsubset;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> [x</span><span class="id"> [s</span><span class="id"> /itvP</span><span class="id"> rs</span><span class="id"> &lt;-]|x</span><span class="id"> []]</span>.<br/>
&nbsp;&nbsp;<span class="id">split</span><span class="id"> =&gt;</span><span class="id"> //=;</span><span class="id"> rewrite</span><span class="id"> in_itv</span><span class="id"> /=</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> case:</span><span class="id"> b</span><span class="gallina-kwd"> in</span><span class="id"> rs</span><span class="id"> *;</span><span class="id"> rewrite</span><span class="id"> /=</span><span class="id"> ?</span>(<span class="id">lee_fin,</span><span class="id"> lte_fin</span>)<span class="id"> rs</span>.<br/>
<span class="id">move:</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> [s|_</span><span class="id"> /</span>(_<span class="id"> erefl</span>)<span class="id">|]</span><span class="id"> //=;</span><span class="id"> rewrite</span><span class="id"> in_itv</span><span class="id"> /=</span><span class="id"> andbT;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> case:</span><span class="id"> b</span><span class="id"> =&gt;</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> 1?</span>(<span class="id">leNgt,ltNge</span>)<span class="id"> 1?</span>(<span class="id">ltNyr,</span><span class="id"> leNye</span>).<br/>
<span class="gallina-kwd">by</span><span class="id"> case:</span><span class="id"> b</span><span class="id"> =&gt;</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> 1?</span>(<span class="id">lte_fin,lee_fin</span>)<span class="id"> =&gt;</span><span class="id"> rs</span><span class="id"> _;</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">exists</span><span class="id"> s</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> rewrite</span><span class="id"> in_itv</span><span class="id"> /=</span><span class="id"> rs</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> EFin_itv</span><span class="id"> r</span><span class="id"> :</span><span class="id"> [set</span><span class="id"> s</span><span class="id"> |</span><span class="id"> r%:E</span><span class="id"> &lt;</span><span class="id"> s%:E]</span><span class="id"> =</span><span class="id"> `]r,</span><span class="id"> +oo[%classic</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> predeqE</span><span class="id"> =&gt;</span><span class="id"> s;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> [|];</span><span class="id"> rewrite</span><span class="id"> /=</span><span class="id"> lte_fin</span><span class="id"> in_itv/=</span><span class="id"> andbT</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> preimage_EFin_setT</span><span class="id"> :</span><span class="id"> @EFin</span><span class="id"> R</span><span class="id"> @^-1`</span><span class="id"> [set</span><span class="id"> x</span><span class="id"> |</span><span class="id"> x</span><span class="id"> \in</span><span class="id"> `]-oo%E,</span><span class="id"> +oo[]</span><span class="id"> =</span><span class="id"> setT</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> set_itvE</span><span class="id"> predeqE</span><span class="id"> =&gt;</span><span class="id"> r;</span><span class="id"> split=&gt;</span><span class="id"> //</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> /preimage</span><span class="id"> /=</span><span class="id"> ltNyr</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> eitv_bnd_infty</span><span class="id"> b</span><span class="id"> r</span><span class="id"> :</span><span class="id"> `[r%:E,</span><span class="id"> +oo[%classic</span><span class="id"> =</span><br/>
&nbsp;&nbsp;<span class="id">\bigcap_k</span><span class="id"> [set`</span><span class="id"> Interval</span> (<span class="id">BSide</span><span class="id"> b</span> (<span class="id">r</span><span class="id"> -</span><span class="id"> k</span>.<span class="id">+1%:R^-1</span>)<span class="id">%:E</span>)<span class="id"> +oo%O]</span><span class="id"> :&gt;</span><span class="id"> set</span><span class="id"> _</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> predeqE</span><span class="id"> =&gt;</span><span class="id"> x;</span><span class="id"> split=&gt;</span><span class="id"> [|]</span>.<br/>
<span class="id">-</span><span class="id"> move:</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> [s</span><span class="id"> /=|</span><span class="id"> _</span><span class="id"> n</span><span class="id"> _|//]</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="id"> rewrite</span><span class="id"> in_itv</span><span class="id"> /=</span><span class="id"> andbT</span><span class="id"> lee_fin</span><span class="id"> =&gt;</span><span class="id"> rs</span><span class="id"> n</span><span class="id"> _</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> in_itv/=</span><span class="id"> andbT</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">case:</span><span class="id"> b</span><span class="id"> =&gt;</span><span class="id"> /=</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">*</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> lee_fin</span><span class="id"> lerBlDl</span> (<span class="id">le_trans</span><span class="id"> rs</span>)<span class="id">//</span><span class="id"> lerDr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">*</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> lte_fin</span><span class="id"> ltrBlDl</span> (<span class="id">le_lt_trans</span><span class="id"> rs</span>)<span class="id">//</span><span class="id"> ltrDr</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> /=</span><span class="id"> in_itv</span><span class="id"> /=</span><span class="id"> andbT;</span><span class="id"> case:</span><span class="id"> b</span><span class="id"> =&gt;</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> lteey</span>.<br/>
<span class="id">-</span><span class="id"> move:</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> [s|</span><span class="id"> |/</span>(_<span class="id"> 0%N</span><span class="id"> Logic</span>.<span class="id">I</span>)<span class="id">]</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> ?in_itv/=</span><span class="id"> ?leey//;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> case:</span><span class="id"> b</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> h;</span><span class="id"> rewrite</span><span class="id"> lee_fin</span><span class="id"> leNgt</span><span class="id"> andbT;</span><span class="id"> apply/negP</span><span class="id"> =&gt;</span><span class="id"> /ltr_add_invr[k</span><span class="id"> skr]</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> {h}</span><span class="id"> :=</span><span class="id"> h</span><span class="id"> k</span><span class="id"> Logic</span>.<span class="id">I;</span><span class="id"> rewrite</span><span class="id"> /=</span><span class="id"> in_itv</span><span class="id"> /=</span><span class="id"> andbT;</span><span class="id"> case:</span><span class="id"> b</span><span class="id"> =&gt;</span><span class="id"> /=</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> lee_fin</span><span class="id"> lerBlDr</span><span class="id"> leNgt</span><span class="id"> skr</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> lte_fin</span><span class="id"> ltrBlDr</span><span class="id"> ltNge</span> (<span class="id">ltW</span><span class="id"> skr</span>).<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> eitv_infty_bnd</span><span class="id"> b</span><span class="id"> r</span><span class="id"> :</span><span class="id"> `]-oo,</span><span class="id"> r%:E]%classic</span><span class="id"> =</span><br/>
&nbsp;&nbsp;<span class="id">\bigcap_k</span><span class="id"> [set`</span><span class="id"> Interval</span><span class="id"> -oo%O</span> (<span class="id">BSide</span><span class="id"> b</span> (<span class="id">r%:E</span><span class="id"> +</span><span class="id"> k</span>.<span class="id">+1%:R^-1%:E</span>))<span class="id">]</span><span class="id"> :&gt;</span><span class="id"> set</span><span class="id"> _</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> predeqE</span><span class="id"> =&gt;</span><span class="id"> x;</span><span class="id"> split=&gt;</span><span class="id"> [|]</span>.<br/>
<span class="id">-</span><span class="id"> move:</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> [s</span><span class="id"> /=|//|_</span><span class="id"> n</span><span class="id"> _]</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="id"> rewrite</span><span class="id"> in_itv</span><span class="id"> /=</span><span class="id"> lee_fin</span><span class="id"> =&gt;</span><span class="id"> sr</span><span class="id"> n</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> /=</span><span class="id"> in_itv</span><span class="id"> /=</span><span class="id"> -EFinD</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">case:</span><span class="id"> b</span><span class="id"> =&gt;</span><span class="id"> /=</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">*</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> lte_fin</span> (<span class="id">le_lt_trans</span><span class="id"> sr</span>)<span class="id">//</span><span class="id"> ltrDl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">*</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> lee_fin</span> (<span class="id">le_trans</span><span class="id"> sr</span>)<span class="id">//</span><span class="id"> lerDl</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> /=</span><span class="id"> in_itv</span><span class="id"> /=</span><span class="id"> -EFinD;</span><span class="id"> case:</span><span class="id"> b</span><span class="id"> =&gt;</span><span class="id"> //=;</span><span class="id"> rewrite</span><span class="id"> lteNye</span>.<br/>
<span class="id">-</span><span class="id"> move:</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> [s|/</span>(_<span class="id"> 0%N</span><span class="id"> Logic</span>.<span class="id">I</span>)<span class="id">|]/=;</span><span class="id"> rewrite</span><span class="id"> !in_itv/=</span><span class="id"> ?leNye//;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> case:</span><span class="id"> b</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> h;</span><span class="id"> rewrite</span><span class="id"> lee_fin</span><span class="id"> leNgt;</span><span class="id"> apply/negP</span><span class="id"> =&gt;</span><span class="id"> /ltr_add_invr[k</span><span class="id"> rks]</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> {h}</span><span class="id"> :=</span><span class="id"> h</span><span class="id"> k</span><span class="id"> Logic</span>.<span class="id">I;</span><span class="id"> rewrite</span><span class="id"> /=</span><span class="id"> in_itv</span><span class="id"> /=</span><span class="id"> -EFinD;</span><span class="id"> case:</span><span class="id"> b</span><span class="id"> =&gt;</span><span class="id"> /=</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> lte_fin</span><span class="id"> ltNge</span> (<span class="id">ltW</span><span class="id"> rks</span>).<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> lee_fin</span><span class="id"> leNgt</span><span class="id"> rks</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> eset1Ny</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">[set</span><span class="id"> -oo]</span><span class="id"> =</span><span class="id"> \bigcap_k</span><span class="id"> `]-oo,</span> (<span class="id">-k%:R%:E</span>)<span class="id">[%classic</span><span class="id"> :&gt;</span><span class="id"> set</span> (<span class="id">\bar</span><span class="id"> R</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> eqEsubset;</span><span class="id"> split=&gt;</span><span class="id"> [_</span><span class="id"> -&gt;</span><span class="id"> i</span><span class="id"> _</span><span class="id"> |];</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> /=</span><span class="id"> in_itv</span><span class="id"> /=</span><span class="id"> ltNyr</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> [r|/</span>(_<span class="id"> O</span><span class="id"> Logic</span>.<span class="id">I</span>)<span class="id">|]//</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> /</span>(_<span class="id"> `|floor</span><span class="id"> r|%N</span><span class="id"> Logic</span>.<span class="id">I</span>)<span class="id">;</span><span class="id"> rewrite</span><span class="id"> /=</span><span class="id"> in_itv/=</span><span class="id"> ltNge</span>.<br/>
<span class="id">rewrite</span><span class="id"> lee_fin;</span><span class="id"> have</span><span class="id"> [r0|r0]</span><span class="id"> :=</span><span class="id"> leP</span><span class="id"> 0%R</span><span class="id"> r</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span> (<span class="id">le_trans</span><span class="id"> _</span><span class="id"> r0</span>)<span class="id"> //</span><span class="id"> lerNl</span><span class="id"> oppr0</span><span class="id"> ler0n</span>.<br/>
<span class="id">rewrite</span><span class="id"> lerNl</span><span class="id"> -abszN</span><span class="id"> natr_absz</span><span class="id"> gtr0_norm;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> ltrNr</span><span class="id"> oppr0</span><span class="id"> -floor_lt0</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> mulrNz</span><span class="id"> lerNl</span><span class="id"> opprK</span><span class="id"> ge_floor</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> eset1y</span><span class="id"> :</span><span class="id"> [set</span><span class="id"> +oo]</span><span class="id"> =</span><span class="id"> \bigcap_k</span><span class="id"> `]k%:R%:E,</span><span class="id"> +oo[%classic</span><span class="id"> :&gt;</span><span class="id"> set</span> (<span class="id">\bar</span><span class="id"> R</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> eqEsubset;</span><span class="id"> split=&gt;</span><span class="id"> [_</span><span class="id"> -&gt;</span><span class="id"> i</span><span class="id"> _/=|];</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> in_itv</span><span class="id"> /=</span><span class="id"> ltry</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> [r|</span><span class="id"> |/</span>(_<span class="id"> O</span><span class="id"> Logic</span>.<span class="id">I</span>)<span class="id">]</span><span class="id"> //</span><span class="id"> /</span>(_<span class="id"> `|ceil</span><span class="id"> r|%N</span><span class="id"> Logic</span>.<span class="id">I</span>)<span class="id">;</span><span class="id"> rewrite</span><span class="id"> /=</span><span class="id"> in_itv</span><span class="id"> /=</span>.<br/>
<span class="id">rewrite</span><span class="id"> andbT</span><span class="id"> lte_fin</span><span class="id"> ltNge</span>.<br/>
<span class="id">have</span><span class="id"> [r0|r0]</span><span class="id"> :=</span><span class="id"> ltP</span><span class="id"> 0%R</span><span class="id"> r;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span> (<span class="id">le_trans</span><span class="id"> r0</span>).<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> natr_absz</span><span class="id"> gtr0_norm//</span><span class="id"> ?ceil_ge//</span><span class="id"> -ceil_gt0</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> erealwithrays</span>.<br/>
<br/>
<span class="vernacular">Module</span><span class="id"> ErealGenOInfty</span>.<br/>
<span class="vernacular">Section</span><span class="id"> erealgenoinfty</span>.<br/>
<span class="vernacular">Variable</span><span class="id"> R</span><span class="id"> :</span><span class="id"> realType</span>.<br/>
<span class="vernacular">Implicit</span><span class="id"> Types</span> (<span class="id">x</span><span class="id"> y</span><span class="id"> z</span><span class="id"> :</span><span class="id"> \bar</span><span class="id"> R</span>) (<span class="id">r</span><span class="id"> s</span><span class="id"> :</span><span class="id"> R</span>).<br/>
<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<br/>
<span class="vernacular">Definition</span><span class="id"> G</span><span class="id"> :=</span><span class="id"> [set</span><span class="id"> A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> \bar</span><span class="id"> R</span><span class="id"> |</span><span class="gallina-kwd"> exists</span><span class="id"> r,</span><span class="id"> A</span><span class="id"> =</span><span class="id"> `]r%:E,</span><span class="id"> +oo[%classic]</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> measurable_set1Ny</span><span class="id"> :</span><span class="id"> G</span>.<span class="id">-sigma</span>.<span class="id">-measurable</span><span class="id"> [set</span><span class="id"> -oo]</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> eset1Ny;</span><span class="id"> apply:</span><span class="id"> bigcap_measurable</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> i</span><span class="id"> _</span>.<br/>
<span class="id">rewrite</span><span class="id"> -setCitvr;</span><span class="id"> apply:</span><span class="id"> measurableC;</span><span class="id"> rewrite</span> (<span class="id">eitv_bnd_infty</span><span class="id"> false</span>).<br/>
<span class="id">apply:</span><span class="id"> bigcap_measurable</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> j</span><span class="id"> _;</span><span class="id"> apply:</span><span class="id"> sub_sigma_algebra</span>.<br/>
<span class="gallina-kwd">by</span><span class="gallina-kwd"> exists</span> (<span class="id">-</span> (<span class="id">i%:R</span><span class="id"> +</span><span class="id"> j</span>.<span class="id">+1%:R^-1</span>))<span class="id">%R;</span><span class="id"> rewrite</span><span class="id"> opprD</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> measurable_set1y</span><span class="id"> :</span><span class="id"> G</span>.<span class="id">-sigma</span>.<span class="id">-measurable</span><span class="id"> [set</span><span class="id"> +oo]</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> eset1y;</span><span class="id"> apply:</span><span class="id"> bigcapT_measurable</span><span class="id"> =&gt;</span><span class="id"> i</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> sub_sigma_algebra;</span><span class="gallina-kwd"> exists</span><span class="id"> i%:R</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> measurableE</span><span class="id"> :</span><span class="id"> emeasurable</span> (<span class="id">@ocitv</span><span class="id"> R</span>)<span class="id"> =</span><span class="id"> G</span>.<span class="id">-sigma</span>.<span class="id">-measurable</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">apply/seteqP;</span><span class="id"> split;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> smallest_sub</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> emeasurable0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> *;</span><span class="id"> rewrite</span><span class="id"> setTD;</span><span class="id"> exact:</span><span class="id"> emeasurableC</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> *;</span><span class="id"> exact:</span><span class="id"> bigcupT_emeasurable</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> _</span><span class="id"> [r</span><span class="id"> -&gt;];</span><span class="id"> rewrite</span><span class="id"> /emeasurable</span><span class="id"> /=</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">exists</span><span class="id"> `]r,</span><span class="id"> +oo[%classic</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> RGenOInfty</span>.<span class="id">measurableE</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> RGenOInfty</span>.<span class="id">measurable_itv_bnd_infty</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="gallina-kwd"> exists</span><span class="id"> [set</span><span class="id"> +oo];</span><span class="id"> [constructor|rewrite</span><span class="id"> -punct_eitv_bndy]</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> A</span><span class="id"> [B</span><span class="id"> mB</span><span class="id"> [C</span><span class="id"> mC]]</span><span class="id"> &lt;-;</span><span class="id"> apply:</span><span class="id"> measurableU;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">case:</span><span class="id"> mC;</span><span class="id"> [by</span><span class="id"> []|exact:</span><span class="id"> measurable_set1Ny|exact:</span><span class="id"> measurable_set1y|]</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> measurableU;</span><span class="id"> [exact:</span><span class="id"> measurable_set1Ny|exact:</span><span class="id"> measurable_set1y]</span>.<br/>
<span class="id">rewrite</span><span class="id"> RGenOInfty</span>.<span class="id">measurableE</span><span class="gallina-kwd"> in</span><span class="id"> mB</span>.<br/>
<span class="id">have</span><span class="id"> smB</span><span class="id"> :=</span><span class="id"> smallest_sub</span><span class="id"> _</span><span class="id"> _</span><span class="id"> mB</span>.<br/>
<span class="comment">(*&nbsp;BUG:&nbsp;elim/smB&nbsp;:&nbsp;_.&nbsp;fails&nbsp;!!&nbsp;*)</span><br/>
<span class="id">apply:</span> (<span class="id">smB</span> (<span class="id">G</span>.<span class="id">-sigma</span>.<span class="id">-measurable</span><span class="id"> \o</span> (<span class="id">image^~</span><span class="id"> EFin</span>)))<span class="id">;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> _</span><span class="id"> [r</span><span class="id"> -&gt;]/=;</span><span class="id"> rewrite</span><span class="id"> EFin_itv_bnd_infty;</span><span class="id"> apply:</span><span class="id"> measurableD</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> sub_sigma_algebra</span><span class="id"> =&gt;</span><span class="id"> /=;</span><span class="gallina-kwd"> exists</span><span class="id"> r</span>.<br/>
&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> measurable_set1y</span>.<br/>
<span class="id">split=&gt;</span><span class="id"> /=</span><span class="id"> [|D</span><span class="id"> mD|F</span><span class="id"> mF];</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> image_set0</span>.<br/>
<span class="id">-</span><span class="id"> rewrite</span><span class="id"> setTD</span><span class="id"> EFin_setC;</span><span class="id"> apply:</span><span class="id"> measurableD;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> measurableC</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> measurableU;</span><span class="id"> [exact:</span><span class="id"> measurable_set1Ny|</span><span class="id"> exact:</span><span class="id"> measurable_set1y]</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> EFin_bigcup;</span><span class="id"> apply:</span><span class="id"> bigcup_measurable</span><span class="id"> =&gt;</span><span class="id"> i</span><span class="id"> _</span><span class="id"> ;</span><span class="id"> exact:</span><span class="id"> mF</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> erealgenoinfty</span>.<br/>
<span class="vernacular">End</span><span class="id"> ErealGenOInfty</span>.<br/>
<br/>
<span class="vernacular">Module</span><span class="id"> ErealGenCInfty</span>.<br/>
<span class="vernacular">Section</span><span class="id"> erealgencinfty</span>.<br/>
<span class="vernacular">Variable</span><span class="id"> R</span><span class="id"> :</span><span class="id"> realType</span>.<br/>
<span class="vernacular">Implicit</span><span class="id"> Types</span> (<span class="id">x</span><span class="id"> y</span><span class="id"> z</span><span class="id"> :</span><span class="id"> \bar</span><span class="id"> R</span>) (<span class="id">r</span><span class="id"> s</span><span class="id"> :</span><span class="id"> R</span>).<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<br/>
<span class="vernacular">Definition</span><span class="id"> G</span><span class="id"> :=</span><span class="id"> [set</span><span class="id"> A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> \bar</span><span class="id"> R</span><span class="id"> |</span><span class="gallina-kwd"> exists</span><span class="id"> r,</span><span class="id"> A</span><span class="id"> =</span><span class="id"> `[r%:E,</span><span class="id"> +oo[%classic]</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> measurable_set1Ny</span><span class="id"> :</span><span class="id"> G</span>.<span class="id">-sigma</span>.<span class="id">-measurable</span><span class="id"> [set</span><span class="id"> -oo]</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> eset1Ny;</span><span class="id"> apply:</span><span class="id"> bigcapT_measurable=&gt;</span><span class="id"> i;</span><span class="id"> rewrite</span><span class="id"> -setCitvr</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> measurableC;</span><span class="id"> apply:</span><span class="id"> sub_sigma_algebra;</span><span class="gallina-kwd"> exists</span> (<span class="id">-</span><span class="id"> i%:R</span>)<span class="id">%R</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> measurable_set1y</span><span class="id"> :</span><span class="id"> G</span>.<span class="id">-sigma</span>.<span class="id">-measurable</span><span class="id"> [set</span><span class="id"> +oo]</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> eset1y;</span><span class="id"> apply:</span><span class="id"> bigcap_measurable</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> i</span><span class="id"> _</span>.<br/>
<span class="id">rewrite</span><span class="id"> -setCitvl;</span><span class="id"> apply:</span><span class="id"> measurableC;</span><span class="id"> rewrite</span> (<span class="id">eitv_infty_bnd</span><span class="id"> true</span>).<br/>
<span class="id">apply:</span><span class="id"> bigcap_measurable</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> j</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> -setCitvr;</span><span class="id"> apply:</span><span class="id"> measurableC</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> sub_sigma_algebra;</span><span class="gallina-kwd"> exists</span> (<span class="id">i%:R</span><span class="id"> +</span><span class="id"> j</span>.<span class="id">+1%:R^-1</span>)<span class="id">%R</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> measurableE</span><span class="id"> :</span><span class="id"> emeasurable</span> (<span class="id">@ocitv</span><span class="id"> R</span>)<span class="id"> =</span><span class="id"> G</span>.<span class="id">-sigma</span>.<span class="id">-measurable</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">apply/seteqP;</span><span class="id"> split;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> smallest_sub</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> emeasurable0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> *;</span><span class="id"> rewrite</span><span class="id"> setTD;</span><span class="id"> exact:</span><span class="id"> emeasurableC</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> *;</span><span class="id"> exact:</span><span class="id"> bigcupT_emeasurable</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> _</span><span class="id"> [r</span><span class="id"> -&gt;]/=;</span><span class="gallina-kwd"> exists</span><span class="id"> `[r,</span><span class="id"> +oo[%classic</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> RGenOInfty</span>.<span class="id">measurableE</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> RGenOInfty</span>.<span class="id">measurable_itv_bnd_infty</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="gallina-kwd"> exists</span><span class="id"> [set</span><span class="id"> +oo];</span><span class="id"> [constructor|rewrite</span><span class="id"> -punct_eitv_bndy]</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> _</span><span class="id"> [A'</span><span class="id"> mA'</span><span class="id"> [C</span><span class="id"> mC]]</span><span class="id"> &lt;-;</span><span class="id"> apply:</span><span class="id"> measurableU;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">case:</span><span class="id"> mC;</span><span class="id"> [by</span><span class="id"> []|exact:</span><span class="id"> measurable_set1Ny|</span><span class="id"> exact:</span><span class="id"> measurable_set1y|]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> measurableU;</span><span class="id"> [exact:</span><span class="id"> measurable_set1Ny|exact:</span><span class="id"> measurable_set1y]</span>.<br/>
<span class="id">rewrite</span><span class="id"> RGenCInfty</span>.<span class="id">measurableE</span><span class="gallina-kwd"> in</span><span class="id"> mA'</span>.<br/>
<span class="id">have</span><span class="id"> smA'</span><span class="id"> :=</span><span class="id"> smallest_sub</span><span class="id"> _</span><span class="id"> _</span><span class="id"> mA'</span>.<br/>
<span class="comment">(*&nbsp;BUG:&nbsp;elim/smA'&nbsp;:&nbsp;_.&nbsp;fails&nbsp;!!&nbsp;*)</span><br/>
<span class="id">apply:</span> (<span class="id">smA'</span> (<span class="id">G</span>.<span class="id">-sigma</span>.<span class="id">-measurable</span><span class="id"> \o</span> (<span class="id">image^~</span><span class="id"> EFin</span>)))<span class="id">;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> _</span><span class="id"> [r</span><span class="id"> -&gt;]/=;</span><span class="id"> rewrite</span><span class="id"> EFin_itv_bnd_infty;</span><span class="id"> apply:</span><span class="id"> measurableD</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> sub_sigma_algebra</span><span class="id"> =&gt;</span><span class="id"> /=;</span><span class="gallina-kwd"> exists</span><span class="id"> r</span>.<br/>
&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> measurable_set1y</span>.<br/>
<span class="id">split=&gt;</span><span class="id"> /=</span><span class="id"> [|D</span><span class="id"> mD|F</span><span class="id"> mF];</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> image_set0</span>.<br/>
<span class="id">-</span><span class="id"> rewrite</span><span class="id"> setTD</span><span class="id"> EFin_setC;</span><span class="id"> apply:</span><span class="id"> measurableD;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> measurableC</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> measurableU;</span><span class="id"> [exact:</span><span class="id"> measurable_set1Ny|exact:</span><span class="id"> measurable_set1y]</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> EFin_bigcup;</span><span class="id"> apply:</span><span class="id"> bigcup_measurable</span><span class="id"> =&gt;</span><span class="id"> i</span><span class="id"> _;</span><span class="id"> exact:</span><span class="id"> mF</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> erealgencinfty</span>.<br/>
<span class="vernacular">End</span><span class="id"> ErealGenCInfty</span>.<br/>
<br/>
<span class="vernacular">Module</span><span class="id"> ErealGenInftyO</span>.<br/>
<span class="vernacular">Section</span><span class="id"> erealgeninftyo</span>.<br/>
<span class="vernacular">Variable</span><span class="id"> R</span><span class="id"> :</span><span class="id"> realType</span>.<br/>
<br/>
<span class="vernacular">Definition</span><span class="id"> G</span><span class="id"> :=</span><span class="id"> [set</span><span class="id"> A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> \bar</span><span class="id"> R</span><span class="id"> |</span><span class="gallina-kwd"> exists</span><span class="id"> r,</span><span class="id"> A</span><span class="id"> =</span><span class="id"> `]-oo,</span><span class="id"> r%:E[%classic]</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> measurableE</span><span class="id"> :</span><span class="id"> emeasurable</span> (<span class="id">@ocitv</span><span class="id"> R</span>)<span class="id"> =</span><span class="id"> G</span>.<span class="id">-sigma</span>.<span class="id">-measurable</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> ErealGenCInfty</span>.<span class="id">measurableE</span><span class="id"> eqEsubset;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> A</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> smallest_sub;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> smallest_sigma_algebra</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> _</span><span class="id"> [x</span><span class="id"> -&gt;];</span><span class="id"> rewrite</span><span class="id"> -[X</span><span class="gallina-kwd"> in</span><span class="id"> _</span>.<span class="id">-measurable</span><span class="id"> X]setCK;</span><span class="id"> apply:</span><span class="id"> measurableC</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> sub_sigma_algebra;</span><span class="gallina-kwd"> exists</span><span class="id"> x;</span><span class="id"> rewrite</span><span class="id"> setCitvr</span>.<br/>
<span class="id">apply:</span><span class="id"> smallest_sub;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> smallest_sigma_algebra</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> x</span><span class="id"> Gx;</span><span class="id"> rewrite</span><span class="id"> -</span>(<span class="id">setCK</span><span class="id"> x</span>)<span class="id">;</span><span class="id"> apply:</span><span class="id"> measurableC;</span><span class="id"> apply:</span><span class="id"> sub_sigma_algebra</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> case:</span><span class="id"> Gx</span><span class="id"> =&gt;</span><span class="id"> y</span><span class="id"> -&gt;;</span><span class="gallina-kwd"> exists</span><span class="id"> y;</span><span class="id"> rewrite</span><span class="id"> setCitvl</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> erealgeninftyo</span>.<br/>
<span class="vernacular">End</span><span class="id"> ErealGenInftyO</span>.<br/>
<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> is_interval_measurable</span> (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>) (<span class="id">I</span><span class="id"> :</span><span class="id"> set</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">is_interval</span><span class="id"> I</span><span class="id"> -&gt;</span><span class="id"> measurable</span><span class="id"> I</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move/is_intervalP</span><span class="id"> =&gt;</span><span class="id"> -&gt;;</span><span class="id"> exact:</span><span class="id"> measurable_itv</span>. Qed.</div></details>
<br/>
<span class="vernacular">Section</span><span class="id"> coutinuous_measurable</span>.<br/>
<span class="vernacular">Variable</span><span class="id"> R</span><span class="id"> :</span><span class="id"> realType</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> open_measurable</span> (<span class="id">A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> R</span>)<span class="id"> :</span><span class="id"> open</span><span class="id"> A</span><span class="id"> -&gt;</span><span class="id"> measurable</span><span class="id"> A</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;/open_bigcup_rat</span><span class="id"> -&gt;;</span><span class="id"> rewrite</span><span class="id"> bigcup_mkcond;</span><span class="id"> apply:</span><span class="id"> bigcupT_measurable_rat</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> q;</span><span class="id"> case:</span><span class="id"> ifPn</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> qfab;</span><span class="id"> apply:</span><span class="id"> is_interval_measurable</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
<span class="id">exact:</span><span class="id"> is_interval_bigcup_ointsub</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> open_measurable_subspace</span> (<span class="id">D</span><span class="id"> :</span><span class="id"> set</span><span class="id"> R</span>) (<span class="id">U</span><span class="id"> :</span><span class="id"> set</span> (<span class="id">subspace</span><span class="id"> D</span>))<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">measurable</span><span class="id"> D</span><span class="id"> -&gt;</span><span class="id"> open</span><span class="id"> U</span><span class="id"> -&gt;</span><span class="id"> measurable</span> (<span class="id">D</span><span class="id"> `&amp;`</span><span class="id"> U</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> mD</span><span class="id"> /open_subspaceP</span><span class="id"> [V</span><span class="id"> [oV]</span><span class="id"> VD];</span><span class="id"> rewrite</span><span class="id"> setIC</span><span class="id"> -VD</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> measurableI</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> open_measurable</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> closed_measurable</span> (<span class="id">A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> R</span>)<span class="id"> :</span><span class="id"> closed</span><span class="id"> A</span><span class="id"> -&gt;</span><span class="id"> measurable</span><span class="id"> A</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move/closed_openC/open_measurable/measurableC;</span><span class="id"> rewrite</span><span class="id"> setCK</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> compact_measurable</span> (<span class="id">A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> R</span>)<span class="id"> :</span><span class="id"> compact</span><span class="id"> A</span><span class="id"> -&gt;</span><span class="id"> measurable</span><span class="id"> A</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd">by</span><span class="id"> move/compact_closed</span><span class="id"> =&gt;</span><span class="id"> /</span>(_ (<span class="id">@Rhausdorff</span><span class="id"> R</span>))<span class="id">;</span><span class="id"> exact:</span><span class="id"> closed_measurable</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> subspace_continuous_measurable_fun</span> (<span class="id">D</span><span class="id"> :</span><span class="id"> set</span><span class="id"> R</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> subspace</span><span class="id"> D</span><span class="id"> -&gt;</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">measurable</span><span class="id"> D</span><span class="id"> -&gt;</span><span class="id"> continuous</span><span class="id"> f</span><span class="id"> -&gt;</span><span class="id"> measurable_fun</span><span class="id"> D</span><span class="id"> f</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> mD</span><span class="id"> /continuousP</span><span class="id"> cf;</span><span class="id"> apply:</span> (<span class="id">measurability</span> (<span class="id">RGenOpens</span>.<span class="id">measurableE</span><span class="id"> R</span>)).<br/>
<span class="id">move=&gt;</span><span class="id"> _</span><span class="id"> [_</span><span class="id"> [a</span><span class="id"> [b</span><span class="id"> -&gt;]</span><span class="id"> &lt;-]];</span><span class="id"> apply:</span><span class="id"> open_measurable_subspace</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
<span class="id">exact/cf/interval_open</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Corollary</span><span class="id"> open_continuous_measurable_fun</span> (<span class="id">D</span><span class="id"> :</span><span class="id"> set</span><span class="id"> R</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">open</span><span class="id"> D</span><span class="id"> -&gt;</span><span class="id"> {in</span><span class="id"> D,</span><span class="id"> continuous</span><span class="id"> f}</span><span class="id"> -&gt;</span><span class="id"> measurable_fun</span><span class="id"> D</span><span class="id"> f</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> oD;</span><span class="id"> rewrite</span><span class="id"> -</span>(<span class="id">continuous_open_subspace</span><span class="id"> f</span><span class="id"> oD</span>).<br/>
<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> subspace_continuous_measurable_fun;</span><span class="id"> exact:</span><span class="id"> open_measurable</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> continuous_measurable_fun</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">continuous</span><span class="id"> f</span><span class="id"> -&gt;</span><span class="id"> measurable_fun</span><span class="id"> setT</span><span class="id"> f</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> cf;</span><span class="id"> apply:</span><span class="id"> open_continuous_measurable_fun</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> openT</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> coutinuous_measurable</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> lower_semicontinuous_measurable</span><span class="id"> {R</span><span class="id"> :</span><span class="id"> realType}</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">lower_semicontinuous</span><span class="id"> f</span><span class="id"> -&gt;</span><span class="id"> measurable_fun</span><span class="id"> setT</span><span class="id"> f</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> scif;</span><span class="id"> apply:</span> (<span class="id">measurability</span> (<span class="id">ErealGenOInfty</span>.<span class="id">measurableE</span><span class="id"> R</span>)).<br/>
<span class="id">move=&gt;</span><span class="id"> /=</span><span class="id"> _</span><span class="id"> [_</span><span class="id"> [a</span><span class="id"> -&gt;]]</span><span class="id"> &lt;-;</span><span class="id"> apply:</span><span class="id"> measurableI</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> apply:</span><span class="id"> open_measurable</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> preimage_itv_o_infty;</span><span class="id"> move/lower_semicontinuousP</span><span class="id"> :</span><span class="id"> scif;</span><span class="id"> exact</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Section</span><span class="id"> standard_measurable_fun</span>.<br/>
<span class="vernacular">Variable</span><span class="id"> R</span><span class="id"> :</span><span class="id"> realType</span>.<br/>
<span class="vernacular">Implicit</span><span class="id"> Types</span><span class="id"> D</span><span class="id"> :</span><span class="id"> set</span><span class="id"> R</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> oppr_measurable</span><span class="id"> D</span><span class="id"> :</span><span class="id"> measurable_fun</span><span class="id"> D</span><span class="id"> -%R</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">apply:</span><span class="id"> measurable_funTS</span><span class="id"> =&gt;</span><span class="id"> /=;</span><span class="id"> apply:</span><span class="id"> continuous_measurable_fun</span>.<br/>
<span class="id">exact:</span><span class="id"> opp_continuous</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> normr_measurable</span><span class="id"> D</span><span class="id"> :</span><span class="id"> measurable_fun</span><span class="id"> D</span> (<span class="id">@normr</span><span class="id"> _</span><span class="id"> R</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> mD;</span><span class="id"> apply:</span> (<span class="id">measurability</span> (<span class="id">RGenOInfty</span>.<span class="id">measurableE</span><span class="id"> R</span>))<span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> /=</span><span class="id"> _</span><span class="id"> [_</span><span class="id"> [x</span><span class="id"> -&gt;]</span><span class="id"> &lt;-];</span><span class="id"> apply:</span><span class="id"> measurableI</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
<span class="id">have</span><span class="id"> [x0|x0]</span><span class="id"> :=</span><span class="id"> leP</span><span class="id"> 0</span><span class="id"> x</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> [X</span><span class="gallina-kwd"> in</span><span class="id"> measurable</span><span class="id"> X]</span>(_<span class="id"> :</span><span class="id"> _</span><span class="id"> =</span><span class="id"> `]-oo,</span> (<span class="id">-</span><span class="id"> x</span>)<span class="id">[</span><span class="id"> `|`</span><span class="id"> `]x,</span><span class="id"> +oo[</span>)<span class="id">%classic</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> measurableU;</span><span class="id"> apply:</span><span class="id"> measurable_itv</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> predeqE</span><span class="id"> =&gt;</span><span class="id"> r;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> [|[|]];</span><span class="id"> rewrite</span><span class="id"> preimage_itv</span><span class="id"> ?in_itv</span><span class="id"> ?andbT/=</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> have</span><span class="id"> [r0|r0]</span><span class="id"> :=</span><span class="id"> leP</span><span class="id"> 0</span><span class="id"> r;</span><span class="id"> [rewrite</span><span class="id"> ger0_norm|rewrite</span><span class="id"> ltr0_norm]</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> xr;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> 2!in_itv/=</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> right;</span><span class="id"> rewrite</span><span class="id"> xr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> left;</span><span class="id"> rewrite</span><span class="id"> ltrNr</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> move=&gt;</span><span class="id"> rx</span><span class="id"> /=</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> ler0_norm</span><span class="id"> 1?ltrNr//</span> (<span class="id">le_trans</span> (<span class="id">ltW</span><span class="id"> rx</span>))<span class="id">//</span><span class="id"> lerNl</span><span class="id"> oppr0</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> in_itv</span><span class="id"> /=</span><span class="id"> andbT</span><span class="id"> =&gt;</span><span class="id"> xr;</span><span class="id"> rewrite</span> (<span class="id">lt_le_trans</span><span class="id"> _</span> (<span class="id">ler_norm</span><span class="id"> _</span>)).<br/>
<span class="id">rewrite</span><span class="id"> [X</span><span class="gallina-kwd"> in</span><span class="id"> measurable</span><span class="id"> X]</span>(_<span class="id"> :</span><span class="id"> _</span><span class="id"> =</span><span class="id"> setT</span>)<span class="id">//</span><span class="id"> predeqE</span><span class="id"> =&gt;</span><span class="id"> r</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> /=</span><span class="id"> in_itv</span><span class="id"> /=</span><span class="id"> andbT</span> (<span class="id">lt_le_trans</span><span class="id"> x0</span>).<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> mulrl_measurable</span><span class="id"> D</span> (<span class="id">k</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span><span class="id"> measurable_fun</span><span class="id"> D</span> (<span class="id"> *%R</span><span class="id"> k</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">apply:</span><span class="id"> measurable_funTS</span><span class="id"> =&gt;</span><span class="id"> /=</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> continuous_measurable_fun;</span><span class="id"> exact:</span><span class="id"> mulrl_continuous</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> mulrr_measurable</span><span class="id"> D</span> (<span class="id">k</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span><span class="id"> measurable_fun</span><span class="id"> D</span> (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> *</span><span class="id"> k</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">apply:</span><span class="id"> measurable_funTS</span><span class="id"> =&gt;</span><span class="id"> /=</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> continuous_measurable_fun;</span><span class="id"> exact:</span><span class="id"> mulrr_continuous</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> exprn_measurable</span><span class="id"> D</span><span class="id"> n</span><span class="id"> :</span><span class="id"> measurable_fun</span><span class="id"> D</span> (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> ^+</span><span class="id"> n</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">apply</span><span class="id"> measurable_funTS</span><span class="id"> =&gt;</span><span class="id"> /=</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply</span><span class="id"> continuous_measurable_fun;</span><span class="id"> exact:</span><span class="id"> exprn_continuous</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> standard_measurable_fun</span>.<br/>
<span class="id">#[global]</span><span class="vernacular"> Hint</span><span class="id"> Extern</span><span class="id"> 0</span> (<span class="id">measurable_fun</span><span class="id"> _</span><span class="id"> -%R</span>)<span class="id"> =&gt;</span><br/>
&nbsp;&nbsp;<span class="id">solve</span><span class="id"> [exact:</span><span class="id"> oppr_measurable]</span><span class="id"> :</span><span class="id"> core</span>.<br/>
<span class="id">#[global]</span><span class="vernacular"> Hint</span><span class="id"> Extern</span><span class="id"> 0</span> (<span class="id">measurable_fun</span><span class="id"> _</span><span class="id"> normr</span>)<span class="id"> =&gt;</span><br/>
&nbsp;&nbsp;<span class="id">solve</span><span class="id"> [exact:</span><span class="id"> normr_measurable]</span><span class="id"> :</span><span class="id"> core</span>.<br/>
<span class="id">#[global]</span><span class="vernacular"> Hint</span><span class="id"> Extern</span><span class="id"> 0</span> (<span class="id">measurable_fun</span><span class="id"> _</span> (<span class="id"> *%R</span><span class="id"> _</span>))<span class="id"> =&gt;</span><br/>
&nbsp;&nbsp;<span class="id">solve</span><span class="id"> [exact:</span><span class="id"> mulrl_measurable]</span><span class="id"> :</span><span class="id"> core</span>.<br/>
<span class="id">#[global]</span><span class="vernacular"> Hint</span><span class="id"> Extern</span><span class="id"> 0</span> (<span class="id">measurable_fun</span><span class="id"> _</span> (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> ^+</span><span class="id"> _</span>))<span class="id"> =&gt;</span><br/>
&nbsp;&nbsp;<span class="id">solve</span><span class="id"> [exact:</span><span class="id"> exprn_measurable]</span><span class="id"> :</span><span class="id"> core</span>.<br/>
<span class="id">#[deprecated</span>(<span class="id">since=</span><span class="id">&quot;mathcomp-analysis 1.4.0&quot;</span><span class="id">,</span><span class="id"> note=</span><span class="id">&quot;use `exprn_measurable` instead&quot;</span>)<span class="id">]</span><br/>
<span class="vernacular">Notation</span><span class="id"> measurable_exprn</span><span class="id"> :=</span><span class="id"> exprn_measurable</span> (<span class="id">only</span><span class="id"> parsing</span>).<br/>
<span class="id">#[deprecated</span>(<span class="id">since=</span><span class="id">&quot;mathcomp-analysis 1.4.0&quot;</span><span class="id">,</span><span class="id"> note=</span><span class="id">&quot;use `mulrl_measurable` instead&quot;</span>)<span class="id">]</span><br/>
<span class="vernacular">Notation</span><span class="id"> measurable_mulrl</span><span class="id"> :=</span><span class="id"> mulrl_measurable</span> (<span class="id">only</span><span class="id"> parsing</span>).<br/>
<span class="id">#[deprecated</span>(<span class="id">since=</span><span class="id">&quot;mathcomp-analysis 1.4.0&quot;</span><span class="id">,</span><span class="id"> note=</span><span class="id">&quot;use `mulrr_measurable` instead&quot;</span>)<span class="id">]</span><br/>
<span class="vernacular">Notation</span><span class="id"> measurable_mulrr</span><span class="id"> :=</span><span class="id"> mulrr_measurable</span> (<span class="id">only</span><span class="id"> parsing</span>).<br/>
<span class="id">#[deprecated</span>(<span class="id">since=</span><span class="id">&quot;mathcomp-analysis 1.4.0&quot;</span><span class="id">,</span><span class="id"> note=</span><span class="id">&quot;use `oppr_measurable` instead&quot;</span>)<span class="id">]</span><br/>
<span class="vernacular">Notation</span><span class="id"> measurable_oppr</span><span class="id"> :=</span><span class="id"> oppr_measurable</span> (<span class="id">only</span><span class="id"> parsing</span>).<br/>
<span class="id">#[deprecated</span>(<span class="id">since=</span><span class="id">&quot;mathcomp-analysis 1.4.0&quot;</span><span class="id">,</span><span class="id"> note=</span><span class="id">&quot;use `normr_measurable` instead&quot;</span>)<span class="id">]</span><br/>
<span class="vernacular">Notation</span><span class="id"> measurable_normr</span><span class="id"> :=</span><span class="id"> normr_measurable</span> (<span class="id">only</span><span class="id"> parsing</span>).<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> measurable_fun_realType</span>.<br/>
<span class="vernacular">Context</span><span class="id"> d</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>).<br/>
<span class="vernacular">Implicit</span><span class="id"> Types</span> (<span class="id">D</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T</span>) (<span class="id">f</span><span class="id"> g</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> R</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> measurable_funD</span><span class="id"> D</span><span class="id"> f</span><span class="id"> g</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">measurable_fun</span><span class="id"> D</span><span class="id"> f</span><span class="id"> -&gt;</span><span class="id"> measurable_fun</span><span class="id"> D</span><span class="id"> g</span><span class="id"> -&gt;</span><span class="id"> measurable_fun</span><span class="id"> D</span> (<span class="id">f</span><span class="id"> \+</span><span class="id"> g</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> mf</span><span class="id"> mg</span><span class="id"> mD;</span><span class="id"> apply:</span> (<span class="id">measurability</span> (<span class="id">RGenOInfty</span>.<span class="id">measurableE</span><span class="id"> R</span>))<span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> /=</span><span class="id"> _</span><span class="id"> [_</span><span class="id"> [a</span><span class="id"> -&gt;]</span><span class="id"> &lt;-];</span><span class="id"> rewrite</span><span class="id"> preimage_itv_o_infty</span>.<br/>
<span class="id">rewrite</span><span class="id"> [X</span><span class="gallina-kwd"> in</span><span class="id"> measurable</span><span class="id"> X]</span>(_<span class="id"> :</span><span class="id"> _</span><span class="id"> =</span><span class="id"> \bigcup_</span>(<span class="id">q</span><span class="id"> :</span><span class="id"> rat</span>)<br/>
&nbsp;&nbsp;((<span class="id">D</span><span class="id"> `&amp;`</span><span class="id"> [set</span><span class="id"> x</span><span class="id"> |</span><span class="id"> ratr</span><span class="id"> q</span><span class="id"> &lt;</span><span class="id"> f</span><span class="id"> x]</span>)<span class="id"> `&amp;`</span> (<span class="id">D</span><span class="id"> `&amp;`</span><span class="id"> [set</span><span class="id"> x</span><span class="id"> |</span><span class="id"> a</span><span class="id"> -</span><span class="id"> ratr</span><span class="id"> q</span><span class="id"> &lt;</span><span class="id"> g</span><span class="id"> x]</span>))).<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> bigcupT_measurable_rat</span><span class="id"> =&gt;</span><span class="id"> q;</span><span class="id"> apply:</span><span class="id"> measurableI</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> -preimage_itv_o_infty;</span><span class="id"> apply:</span><span class="id"> mf</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> apply:</span><span class="id"> measurable_itv</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> -preimage_itv_o_infty;</span><span class="id"> apply:</span><span class="id"> mg</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> apply:</span><span class="id"> measurable_itv</span>.<br/>
<span class="id">rewrite</span><span class="id"> predeqE</span><span class="id"> =&gt;</span><span class="id"> x;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> [|[r</span><span class="id"> _]</span><span class="id"> []/=</span><span class="id"> [Dx</span><span class="id"> rfx]]</span><span class="id"> /=</span><span class="id"> =&gt;</span><span class="id"> [[Dx]|[_]]</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -ltrBlDr</span><span class="id"> =&gt;</span><span class="id"> /rat_in_itvoo[r];</span><span class="id"> rewrite</span><span class="id"> inE</span><span class="id"> /=</span><span class="id"> =&gt;</span><span class="id"> /itvP</span><span class="id"> h</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">exists</span><span class="id"> r</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> rewrite</span><span class="id"> setIACA</span><span class="id"> setIid;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> /=</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> h</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> ltrBlDr</span><span class="id"> addrC</span><span class="id"> -ltrBlDr</span><span class="id"> h</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> ltrBlDr=&gt;</span><span class="id"> afg;</span><span class="id"> rewrite</span> (<span class="id">lt_le_trans</span><span class="id"> afg</span>)<span class="id">//</span><span class="id"> addrC</span><span class="id"> lerD2r</span><span class="id"> ltW</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> measurable_funB</span><span class="id"> D</span><span class="id"> f</span><span class="id"> g</span><span class="id"> :</span><span class="id"> measurable_fun</span><span class="id"> D</span><span class="id"> f</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">measurable_fun</span><span class="id"> D</span><span class="id"> g</span><span class="id"> -&gt;</span><span class="id"> measurable_fun</span><span class="id"> D</span> (<span class="id">f</span><span class="id"> \-</span><span class="id"> g</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> ?</span><span class="id"> ?;</span><span class="id"> apply:</span><span class="id"> measurable_funD</span><span class="id"> =&gt;//;</span><span class="id"> exact:</span><span class="id"> measurableT_comp</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> measurable_funM</span><span class="id"> D</span><span class="id"> f</span><span class="id"> g</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">measurable_fun</span><span class="id"> D</span><span class="id"> f</span><span class="id"> -&gt;</span><span class="id"> measurable_fun</span><span class="id"> D</span><span class="id"> g</span><span class="id"> -&gt;</span><span class="id"> measurable_fun</span><span class="id"> D</span> (<span class="id">f</span><span class="id"> \*</span><span class="id"> g</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> mf</span><span class="id"> mg;</span><span class="id"> rewrite</span> (_<span class="id"> :</span> (_<span class="id"> \*</span><span class="id"> _</span>)<span class="id"> =</span> (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> 2%:R^-1</span><span class="id"> *</span> (<span class="id">f</span><span class="id"> x</span><span class="id"> +</span><span class="id"> g</span><span class="id"> x</span>)<span class="id"> ^+</span><span class="id"> 2</span>)<br/>
&nbsp;&nbsp;<span class="id">\-</span> (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> 2%:R^-1</span><span class="id"> *</span> (<span class="id">f</span><span class="id"> x</span><span class="id"> ^+</span><span class="id"> 2</span>))<span class="id"> \-</span> (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> 2%:R^-1</span><span class="id"> *</span> (<span class="id">g</span><span class="id"> x</span><span class="id"> ^+</span><span class="id"> 2</span>))).<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> measurable_funB;</span><span class="id"> first</span><span class="id"> apply:</span><span class="id"> measurable_funB</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> apply:</span><span class="id"> measurableT_comp</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> measurableT_comp</span> (<span class="id">exprn_measurable</span><span class="id"> _</span>)<span class="id"> _;</span><span class="id"> exact:</span><span class="id"> measurable_funD</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> apply:</span><span class="id"> measurableT_comp</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> measurableT_comp</span> (<span class="id">exprn_measurable</span><span class="id"> _</span>)<span class="id"> _</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> apply:</span><span class="id"> measurableT_comp</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> measurableT_comp</span> (<span class="id">exprn_measurable</span><span class="id"> _</span>)<span class="id"> _</span>.<br/>
<span class="id">rewrite</span><span class="id"> funeqE</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> -2!mulrBr</span><span class="id"> sqrrD</span> (<span class="id">addrC</span> (<span class="id">f</span><span class="id"> x</span><span class="id"> ^+</span><span class="id"> 2</span>))<span class="id"> -addrA</span>.<br/>
<span class="id">rewrite</span><span class="id"> -</span>(<span class="id">addrA</span> (<span class="id">f</span><span class="id"> x</span><span class="id"> *</span><span class="id"> g</span><span class="id"> x</span><span class="id"> *+</span><span class="id"> 2</span>))<span class="id"> -opprB</span><span class="id"> opprK</span> (<span class="id">addrC</span> (<span class="id">g</span><span class="id"> x</span><span class="id"> ^+</span><span class="id"> 2</span>))<span class="id"> addrK</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -</span>(<span class="id">mulr_natr</span> (<span class="id">f</span><span class="id"> x</span><span class="id"> *</span><span class="id"> g</span><span class="id"> x</span>))<span class="id"> -</span>(<span class="id">mulrC</span><span class="id"> 2</span>)<span class="id"> mulrA</span><span class="id"> mulVr</span><span class="id"> ?mul1r//</span><span class="id"> unitfE</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> measurable_fun_ltr</span><span class="id"> D</span><span class="id"> f</span><span class="id"> g</span><span class="id"> :</span><span class="id"> measurable_fun</span><span class="id"> D</span><span class="id"> f</span><span class="id"> -&gt;</span><span class="id"> measurable_fun</span><span class="id"> D</span><span class="id"> g</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">measurable_fun</span><span class="id"> D</span> (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> f</span><span class="id"> x</span><span class="id"> &lt;</span><span class="id"> g</span><span class="id"> x</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> mf</span><span class="id"> mg</span><span class="id"> mD;</span><span class="id"> apply:</span> (<span class="id">measurable_fun_bool</span><span class="id"> true</span>)<span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
<span class="id">under</span><span class="id"> eq_fun</span><span class="id"> do</span><span class="id"> rewrite</span><span class="id"> -subr_gt0</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> preimage_true</span><span class="id"> -preimage_itv_o_infty;</span><span class="id"> exact:</span><span class="id"> measurable_funB</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> measurable_fun_ler</span><span class="id"> D</span><span class="id"> f</span><span class="id"> g</span><span class="id"> :</span><span class="id"> measurable_fun</span><span class="id"> D</span><span class="id"> f</span><span class="id"> -&gt;</span><span class="id"> measurable_fun</span><span class="id"> D</span><span class="id"> g</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">measurable_fun</span><span class="id"> D</span> (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> f</span><span class="id"> x</span><span class="id"> &lt;=</span><span class="id"> g</span><span class="id"> x</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> mf</span><span class="id"> mg</span><span class="id"> mD;</span><span class="id"> apply:</span> (<span class="id">measurable_fun_bool</span><span class="id"> true</span>)<span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
<span class="id">under</span><span class="id"> eq_fun</span><span class="id"> do</span><span class="id"> rewrite</span><span class="id"> -subr_ge0</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> preimage_true</span><span class="id"> -preimage_itv_c_infty;</span><span class="id"> exact:</span><span class="id"> measurable_funB</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> measurable_fun_eqr</span><span class="id"> D</span><span class="id"> f</span><span class="id"> g</span><span class="id"> :</span><span class="id"> measurable_fun</span><span class="id"> D</span><span class="id"> f</span><span class="id"> -&gt;</span><span class="id"> measurable_fun</span><span class="id"> D</span><span class="id"> g</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">measurable_fun</span><span class="id"> D</span> (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> f</span><span class="id"> x</span><span class="id"> ==</span><span class="id"> g</span><span class="id"> x</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> mf</span><span class="id"> mg</span>.<br/>
<span class="id">rewrite</span> (_<span class="id"> :</span> (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> f</span><span class="id"> x</span><span class="id"> ==</span><span class="id"> g</span><span class="id"> x</span>)<span class="id"> =</span> (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> =&gt;</span> (<span class="id">f</span><span class="id"> x</span><span class="id"> &lt;=</span><span class="id"> g</span><span class="id"> x</span>)<span class="id"> &amp;&amp;</span> (<span class="id">g</span><span class="id"> x</span><span class="id"> &lt;=</span><span class="id"> f</span><span class="id"> x</span>))).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> measurable_and;</span><span class="id"> exact:</span><span class="id"> measurable_fun_ler</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> under</span><span class="id"> eq_fun</span><span class="id"> do</span><span class="id"> rewrite</span><span class="id"> eq_le</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> measurable_maxr</span><span class="id"> D</span><span class="id"> f</span><span class="id"> g</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">measurable_fun</span><span class="id"> D</span><span class="id"> f</span><span class="id"> -&gt;</span><span class="id"> measurable_fun</span><span class="id"> D</span><span class="id"> g</span><span class="id"> -&gt;</span><span class="id"> measurable_fun</span><span class="id"> D</span> (<span class="id">f</span><span class="id"> \max</span><span class="id"> g</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> mf</span><span class="id"> mg</span><span class="id"> mD;</span><span class="id"> move:</span> (<span class="id">mD</span>)<span class="id">;</span><span class="id"> apply:</span><span class="id"> measurable_fun_if</span><span class="id"> =&gt;</span><span class="id"> //;</span><br/>
&nbsp;&nbsp;<span class="id">[exact:</span><span class="id"> measurable_fun_ltr|exact:</span><span class="id"> measurable_funS</span><span class="id"> mg|exact:</span><span class="id"> measurable_funS</span><span class="id"> mf]</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> measurable_minr</span><span class="id"> D</span><span class="id"> f</span><span class="id"> g</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">measurable_fun</span><span class="id"> D</span><span class="id"> f</span><span class="id"> -&gt;</span><span class="id"> measurable_fun</span><span class="id"> D</span><span class="id"> g</span><span class="id"> -&gt;</span><span class="id"> measurable_fun</span><span class="id"> D</span> (<span class="id">f</span><span class="id"> \min</span><span class="id"> g</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> mf</span><span class="id"> mg</span><span class="id"> mD;</span><span class="id"> move:</span> (<span class="id">mD</span>)<span class="id">;</span><span class="id"> apply:</span><span class="id"> measurable_fun_if</span><span class="id"> =&gt;</span><span class="id"> //;</span><br/>
&nbsp;<span class="id">[exact:</span><span class="id"> measurable_fun_ltr|exact:</span><span class="id"> measurable_funS</span><span class="id"> mf|exact:</span><span class="id"> measurable_funS</span><span class="id"> mg]</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> measurable_fun_sups</span><span class="id"> D</span> (<span class="id">h</span><span class="id"> :</span> (<span class="id">T</span><span class="id"> -&gt;</span><span class="id"> R</span>)<span class="id">^nat</span>)<span class="id"> n</span><span class="id"> :</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">forall</span><span class="id"> t,</span><span class="id"> D</span><span class="id"> t</span><span class="id"> -&gt;</span><span class="id"> has_ubound</span> (<span class="id">range</span> (<span class="id">h</span><span class="id"> ^~</span><span class="id"> t</span>)))<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">forall</span><span class="id"> m,</span><span class="id"> measurable_fun</span><span class="id"> D</span> (<span class="id">h</span><span class="id"> m</span>))<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">measurable_fun</span><span class="id"> D</span> (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> sups</span> (<span class="id">h</span><span class="id"> ^~</span><span class="id"> x</span>)<span class="id"> n</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> f_ub</span><span class="id"> mf</span><span class="id"> mD;</span><span class="id"> apply:</span> (<span class="id">measurability</span> (<span class="id">RGenOInfty</span>.<span class="id">measurableE</span><span class="id"> R</span>))<span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> _</span><span class="id"> [_</span><span class="id"> [x</span><span class="id"> -&gt;]</span><span class="id"> &lt;-];</span><span class="id"> rewrite</span><span class="id"> sups_preimage</span><span class="id"> //</span><span class="id"> setI_bigcupr</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> bigcup_measurable</span><span class="id"> =&gt;</span><span class="id"> k</span><span class="id"> /=</span><span class="id"> nk;</span><span class="id"> apply:</span><span class="id"> mf</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> measurable_itv</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> measurable_fun_infs</span><span class="id"> D</span> (<span class="id">h</span><span class="id"> :</span> (<span class="id">T</span><span class="id"> -&gt;</span><span class="id"> R</span>)<span class="id">^nat</span>)<span class="id"> n</span><span class="id"> :</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">forall</span><span class="id"> t,</span><span class="id"> D</span><span class="id"> t</span><span class="id"> -&gt;</span><span class="id"> has_lbound</span> (<span class="id">range</span> (<span class="id">h</span><span class="id"> ^~</span><span class="id"> t</span>)))<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">forall</span><span class="id"> n,</span><span class="id"> measurable_fun</span><span class="id"> D</span> (<span class="id">h</span><span class="id"> n</span>))<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">measurable_fun</span><span class="id"> D</span> (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> infs</span> (<span class="id">h</span><span class="id"> ^~</span><span class="id"> x</span>)<span class="id"> n</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> lb_f</span><span class="id"> mf</span><span class="id"> mD;</span><span class="id"> apply:</span> (<span class="id">measurability</span> (<span class="id">RGenInftyO</span>.<span class="id">measurableE</span><span class="id"> R</span>))<span class="id"> =&gt;//</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> _</span><span class="id"> [_</span><span class="id"> [x</span><span class="id"> -&gt;]</span><span class="id"> &lt;-];</span><span class="id"> rewrite</span><span class="id"> infs_preimage</span><span class="id"> //</span><span class="id"> setI_bigcupr</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> bigcup_measurable</span><span class="id"> =&gt;</span><span class="id"> k</span><span class="id"> /=</span><span class="id"> nk;</span><span class="id"> apply:</span><span class="id"> mf</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> measurable_itv</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> measurable_fun_limn_sup</span><span class="id"> D</span> (<span class="id">h</span><span class="id"> :</span> (<span class="id">T</span><span class="id"> -&gt;</span><span class="id"> R</span>)<span class="id">^nat</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">forall</span><span class="id"> t,</span><span class="id"> D</span><span class="id"> t</span><span class="id"> -&gt;</span><span class="id"> has_ubound</span> (<span class="id">range</span> (<span class="id">h</span><span class="id"> ^~</span><span class="id"> t</span>)))<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">forall</span><span class="id"> t,</span><span class="id"> D</span><span class="id"> t</span><span class="id"> -&gt;</span><span class="id"> has_lbound</span> (<span class="id">range</span> (<span class="id">h</span><span class="id"> ^~</span><span class="id"> t</span>)))<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">forall</span><span class="id"> n,</span><span class="id"> measurable_fun</span><span class="id"> D</span> (<span class="id">h</span><span class="id"> n</span>))<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">measurable_fun</span><span class="id"> D</span> (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> limn_sup</span> (<span class="id">h</span><span class="id"> ^~</span><span class="id"> x</span>)).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> f_ub</span><span class="id"> f_lb</span><span class="id"> mf</span>.<br/>
<span class="id">have</span><span class="id"> :</span><span class="id"> {in</span><span class="id"> D,</span> (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> inf</span><span class="id"> [set</span><span class="id"> sups</span> (<span class="id">h</span><span class="id"> ^~</span><span class="id"> x</span>)<span class="id"> n</span><span class="id"> |</span><span class="id"> n</span><span class="gallina-kwd"> in</span><span class="id"> [set</span><span class="id"> n</span><span class="id"> |</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> n]%N]</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">=1</span> (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> limn_sup</span> (<span class="id">h^~</span><span class="id"> x</span>))<span class="id">}</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> t;</span><span class="id"> rewrite</span><span class="id"> inE</span><span class="id"> =&gt;</span><span class="id"> Dt;</span><span class="id"> apply/esym/cvg_lim</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> [X</span><span class="gallina-kwd"> in</span><span class="id"> _</span><span class="id"> --&gt;</span><span class="id"> X]</span>(_<span class="id"> :</span><span class="id"> _</span><span class="id"> =</span><span class="id"> inf</span> (<span class="id">range</span> (<span class="id">sups</span> (<span class="id">h^~t</span>)))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> cvg_sups_inf;</span><span class="id"> [exact:</span><span class="id"> f_ub|exact:</span><span class="id"> f_lb]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> congr</span> (<span class="id">inf</span><span class="id"> [set</span><span class="id"> _</span><span class="id"> |</span><span class="id"> _</span><span class="gallina-kwd"> in</span><span class="id"> _]</span>)<span class="id">;</span><span class="id"> rewrite</span><span class="id"> predeqE</span>.<br/>
<span class="id">move/eq_measurable_fun;</span><span class="id"> apply;</span><span class="id"> apply:</span><span class="id"> measurable_fun_infs</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> t</span><span class="id"> Dt;</span><span class="id"> have</span><span class="id"> [M</span><span class="id"> hM]</span><span class="id"> :=</span><span class="id"> f_lb</span><span class="id"> _</span><span class="id"> Dt;</span><span class="gallina-kwd"> exists</span><span class="id"> M</span><span class="id"> =&gt;</span><span class="id"> _</span><span class="id"> [m</span><span class="id"> /=</span><span class="id"> nm</span><span class="id"> &lt;-]</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> (<span class="id">@le_trans</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">h</span><span class="id"> m</span><span class="id"> t</span>))<span class="id"> //;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> apply</span><span class="id"> hM</span><span class="id"> =&gt;</span><span class="id"> /=;</span><span class="gallina-kwd"> exists</span><span class="id"> m</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> sup_ubound;</span><span class="id"> [exact/has_ubound_sdrop/f_ub|exists</span><span class="id"> m</span><span class="id"> =&gt;</span><span class="id"> /=]</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> k;</span><span class="id"> exact:</span><span class="id"> measurable_fun_sups</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> measurable_fun_cvg</span><span class="id"> D</span> (<span class="id">h</span><span class="id"> :</span> (<span class="id">T</span><span class="id"> -&gt;</span><span class="id"> R</span>)<span class="id">^nat</span>)<span class="id"> f</span><span class="id"> :</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">forall</span><span class="id"> m,</span><span class="id"> measurable_fun</span><span class="id"> D</span> (<span class="id">h</span><span class="id"> m</span>))<span class="id"> -&gt;</span> (<span class="gallina-kwd">forall</span><span class="id"> x,</span><span class="id"> D</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> h</span><span class="id"> ^~</span><span class="id"> x</span><span class="id"> @</span><span class="id"> \oo</span><span class="id"> --&gt;</span><span class="id"> f</span><span class="id"> x</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">measurable_fun</span><span class="id"> D</span><span class="id"> f</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> mf_</span><span class="id"> f_f;</span><span class="id"> have</span><span class="id"> fE</span><span class="id"> x</span><span class="id"> :</span><span class="id"> D</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> f</span><span class="id"> x</span><span class="id"> =</span><span class="id"> limn_sup</span> (<span class="id">h</span><span class="id"> ^~</span><span class="id"> x</span>).<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> Dx;</span><span class="id"> have</span><span class="id"> /cvg_lim</span> <span class="id"> &lt;-//</span><span class="id"> :=</span><span class="id"> @cvg_sups</span><span class="id"> _</span> (<span class="id">h</span><span class="id"> ^~</span><span class="id"> x</span>) (<span class="id">f</span><span class="id"> x</span>) (<span class="id">f_f</span><span class="id"> _</span><span class="id"> Dx</span>).<br/>
<span class="id">apply:</span> (<span class="id">@eq_measurable_fun</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> D</span> (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> limn_sup</span> (<span class="id">h</span><span class="id"> ^~</span><span class="id"> x</span>))).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> x;</span><span class="id"> rewrite</span><span class="id"> inE</span><span class="id"> =&gt;</span><span class="id"> Dx;</span><span class="id"> rewrite</span><span class="id"> -fE</span>.<br/>
<span class="id">apply:</span> (<span class="id">@measurable_fun_limn_sup</span><span class="id"> _</span><span class="id"> h</span>)<span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> t</span><span class="id"> Dt</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> apply/bounded_fun_has_ubound/cvg_seq_bounded/cvg_ex;</span><span class="id"> eexists;</span><span class="id"> exact:</span><span class="id"> f_f</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> apply/bounded_fun_has_lbound/cvg_seq_bounded/cvg_ex;</span><span class="id"> eexists;</span><span class="id"> exact:</span><span class="id"> f_f</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> measurable_fun_indic</span><span class="id"> D</span> (<span class="id">U</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T</span>)<span class="id"> :</span><span class="id"> measurable</span><span class="id"> U</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">measurable_fun</span><span class="id"> D</span> (<span class="id">\1_U</span><span class="id"> :</span><span class="id"> _</span><span class="id"> -&gt;</span><span class="id"> R</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> mU</span><span class="id"> mD</span><span class="id"> /=</span><span class="id"> Y</span><span class="id"> mY</span>.<br/>
<span class="id">have</span><span class="id"> [Y0|Y0]</span><span class="id"> :=</span><span class="id"> pselect</span> (<span class="id">Y</span><span class="id"> 0%R</span>)<span class="id">;</span><span class="id"> have</span><span class="id"> [Y1|Y1]</span><span class="id"> :=</span><span class="id"> pselect</span> (<span class="id">Y</span><span class="id"> 1%R</span>).<br/>
<span class="id">-</span><span class="id"> rewrite</span><span class="id"> [X</span><span class="gallina-kwd"> in</span><span class="id"> measurable</span><span class="id"> X]</span>(_<span class="id"> :</span><span class="id"> _</span><span class="id"> =</span><span class="id"> D</span>)<span class="id">//</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply/seteqP;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //=</span><span class="id"> r</span><span class="id"> Dr</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> indicE;</span><span class="id"> case:</span> (_<span class="id"> \in</span><span class="id"> _</span>).<br/>
<span class="id">-</span><span class="id"> rewrite</span><span class="id"> [X</span><span class="gallina-kwd"> in</span><span class="id"> measurable</span> (_<span class="id"> `&amp;`</span><span class="id"> X</span>)<span class="id">]</span>(_<span class="id"> :</span><span class="id"> _</span><span class="id"> =</span><span class="id"> ~`</span><span class="id"> U</span>)<span class="id">//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> measurableI</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> measurableC</span>.<br/>
&nbsp;&nbsp;<span class="id">apply/seteqP;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> [//=</span><span class="id"> r</span><span class="id"> /=</span><span class="id"> +</span><span class="id"> Ur|r</span><span class="id"> Ur];</span><span class="id"> rewrite</span><span class="id"> /=</span><span class="id"> indicE</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> mem_set</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> memNset</span>.<br/>
<span class="id">-</span><span class="id"> rewrite</span><span class="id"> [X</span><span class="gallina-kwd"> in</span><span class="id"> measurable</span> (_<span class="id"> `&amp;`</span><span class="id"> X</span>)<span class="id">]</span>(_<span class="id"> :</span><span class="id"> _</span><span class="id"> =</span><span class="id"> U</span>)<span class="id">;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> measurableI</span>.<br/>
&nbsp;&nbsp;<span class="id">apply/seteqP;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> [//=</span><span class="id"> r</span><span class="id"> /=|r</span><span class="id"> Ur];</span><span class="id"> rewrite</span><span class="id"> /=</span><span class="id"> indicE</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> have</span><span class="id"> [//|Ur]</span><span class="id"> :=</span><span class="id"> pselect</span> (<span class="id">U</span><span class="id"> r</span>)<span class="id">;</span><span class="id"> rewrite</span><span class="id"> memNset</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> mem_set</span>.<br/>
<span class="id">-</span><span class="id"> rewrite</span><span class="id"> [X</span><span class="gallina-kwd"> in</span><span class="id"> measurable</span><span class="id"> X]</span>(_<span class="id"> :</span><span class="id"> _</span><span class="id"> =</span><span class="id"> set0</span>)<span class="id">//</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply/seteqP;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> r</span><span class="id"> /=</span><span class="id"> -[_];</span><span class="id"> rewrite</span><span class="id"> indicE;</span><span class="id"> case:</span> (_<span class="id"> \in</span><span class="id"> _</span>).<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> measurable_fun_realType</span>.<br/>
<span class="id">#[deprecated</span>(<span class="id">since=</span><span class="id">&quot;mathcomp-analysis 0.6.6&quot;</span><span class="id">,</span><span class="id"> note=</span><span class="id">&quot;renamed `measurable_fun_limn_sup`&quot;</span>)<span class="id">]</span><br/>
<span class="vernacular">Notation</span><span class="id"> measurable_fun_lim_sup</span><span class="id"> :=</span><span class="id"> measurable_fun_limn_sup</span> (<span class="id">only</span><span class="id"> parsing</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> measurable_ln</span> (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>)<span class="id"> :</span><span class="id"> measurable_fun</span><span class="id"> [set~</span> (<span class="id">0:R</span>)<span class="id">]</span> (<span class="id">@ln</span><span class="id"> R</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span> (_<span class="id"> :</span><span class="id"> [set~</span><span class="id"> 0]</span><span class="id"> =</span><span class="id"> `]-oo,</span><span class="id"> 0[</span><span class="id"> `|`</span><span class="id"> `]0,</span><span class="id"> +oo[</span>)<span class="id">;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -</span>(<span class="id">setCitv</span><span class="id"> `[0,</span><span class="id"> 0]</span>)<span class="id">;</span><span class="id"> apply/seteqP;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> [|]x/=;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> in_itv/=</span><span class="id"> -eq_le</span><span class="id"> eq_sym;</span><span class="id"> [move/eqP/negbTE</span><span class="id"> =&gt;</span><span class="id"> -&gt;|move/negP/eqP]</span>.<br/>
<span class="id">apply/measurable_funU</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> split</span>.<br/>
<span class="id">-</span><span class="id"> apply/measurable_restrictT</span><span class="id"> =&gt;</span><span class="id"> //=</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> (_<span class="id"> :</span><span class="id"> _</span><span class="id"> \_</span><span class="id"> _</span><span class="id"> =</span><span class="id"> cst</span><span class="id"> 0</span>)<span class="id">//;</span><span class="id"> apply/funext</span><span class="id"> =&gt;</span><span class="id"> y;</span><span class="id"> rewrite</span><span class="id"> patchE</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> case:</span><span class="id"> ifPn</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> rewrite</span><span class="id"> inE/=</span><span class="id"> in_itv/=</span><span class="id"> =&gt;</span><span class="id"> y0;</span><span class="id"> rewrite</span><span class="id"> ln0//</span><span class="id"> ltW</span>.<br/>
<span class="id">-</span><span class="id"> have</span><span class="id"> :</span><span class="id"> {in</span><span class="id"> `]0,</span><span class="id"> +oo[%classic,</span><span class="id"> continuous</span> (<span class="id">@ln</span><span class="id"> R</span>)<span class="id">}</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> x;</span><span class="id"> rewrite</span><span class="id"> inE/=</span><span class="id"> in_itv/=</span><span class="id"> andbT</span><span class="id"> =&gt;</span><span class="id"> x0;</span><span class="id"> exact:</span><span class="id"> continuous_ln</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -continuous_open_subspace;</span><span class="id"> last</span><span class="id"> exact:</span><span class="id"> interval_open</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move/subspace_continuous_measurable_fun;</span><span class="id"> apply;</span><span class="id"> exact:</span><span class="id"> measurable_itv</span>.<br/>
Qed.</div></details>
<span class="id">#[global]</span><span class="vernacular"> Hint</span><span class="id"> Extern</span><span class="id"> 0</span> (<span class="id">measurable_fun</span><span class="id"> _</span> (<span class="id">@ln</span><span class="id"> _</span>))<span class="id"> =&gt;</span><br/>
&nbsp;&nbsp;<span class="id">solve</span><span class="id"> [apply:</span><span class="id"> measurable_ln]</span><span class="id"> :</span><span class="id"> core</span>.<br/>
<span class="id">#[deprecated</span>(<span class="id">since=</span><span class="id">&quot;mathcomp-analysis 0.6.3&quot;</span><span class="id">,</span><span class="id"> note=</span><span class="id">&quot;use `measurable_ln` instead&quot;</span>)<span class="id">]</span><br/>
<span class="vernacular">Notation</span><span class="id"> measurable_fun_ln</span><span class="id"> :=</span><span class="id"> measurable_ln</span> (<span class="id">only</span><span class="id"> parsing</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> measurable_expR</span> (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>)<span class="id"> :</span><span class="id"> measurable_fun</span><span class="id"> [set:</span><span class="id"> R]</span><span class="id"> expR</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> continuous_measurable_fun;</span><span class="id"> exact:</span><span class="id"> continuous_expR</span>. Qed.</div></details>
<span class="id">#[global]</span><span class="vernacular"> Hint</span><span class="id"> Extern</span><span class="id"> 0</span> (<span class="id">measurable_fun</span><span class="id"> _</span><span class="id"> expR</span>)<span class="id"> =&gt;</span><br/>
&nbsp;&nbsp;<span class="id">solve</span><span class="id"> [apply:</span><span class="id"> measurable_expR]</span><span class="id"> :</span><span class="id"> core</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> natmul_measurable</span><span class="id"> {R</span><span class="id"> :</span><span class="id"> realType}</span><span class="id"> D</span><span class="id"> n</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">measurable_fun</span><span class="id"> D</span> (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> :</span><span class="id"> R</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> *+</span><span class="id"> n</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">under</span><span class="id"> eq_fun</span><span class="id"> do</span><span class="id"> rewrite</span><span class="id"> -mulr_natr</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> do</span><span class="id"> 2</span><span class="id"> apply:</span><span class="id"> measurable_funM</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> measurable_funX</span><span class="id"> d</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d</span>)<span class="id"> {R</span><span class="id"> :</span><span class="id"> realType}</span><span class="id"> D</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> R</span>)<span class="id"> n</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">measurable_fun</span><span class="id"> D</span><span class="id"> f</span><span class="id"> -&gt;</span><span class="id"> measurable_fun</span><span class="id"> D</span> (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> f</span><span class="id"> x</span><span class="id"> ^+</span><span class="id"> n</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> mf</span>.<br/>
<span class="id">exact:</span> (<span class="id">@measurable_comp</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> setT</span> (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> :</span><span class="id"> R</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> ^+</span><span class="id"> n</span>)<span class="id"> _</span><span class="id"> f</span>).<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> measurable_powR</span> (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>)<span class="id"> p</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">measurable_fun</span><span class="id"> [set:</span><span class="id"> R]</span> (<span class="id">@powR</span><span class="id"> R</span><span class="id"> ^~</span><span class="id"> p</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">apply:</span><span class="id"> measurable_fun_if</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
<span class="id">-</span><span class="id"> apply:</span> (<span class="id">measurable_fun_bool</span><span class="id"> true</span>).<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> (_<span class="id"> :</span><span class="id"> _</span><span class="id"> @^-1`</span><span class="id"> _</span><span class="id"> =</span><span class="id"> [set</span><span class="id"> 0]</span>)<span class="id"> ?setTI//</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply/seteqP;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> [_</span><span class="id"> /eqP</span><span class="id"> -&gt;//|_</span><span class="id"> -&gt;</span><span class="id"> /=];</span><span class="id"> rewrite</span><span class="id"> eqxx</span>.<br/>
<span class="id">-</span><span class="id"> rewrite</span><span class="id"> setTI;</span><span class="id"> apply:</span><span class="id"> measurableT_comp</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> (_<span class="id"> :</span><span class="id"> _</span><span class="id"> @^-1`</span><span class="id"> _</span><span class="id"> =</span><span class="id"> [set~</span><span class="id"> 0]</span>)<span class="id">;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> measurableT_comp</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply/seteqP;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> [x</span><span class="id"> /negP/negP/eqP|x</span><span class="id"> x0]//=;</span><span class="id"> exact/negbTE/eqP</span>.<br/>
Qed.</div></details>
<span class="id">#[global]</span><span class="vernacular"> Hint</span><span class="id"> Extern</span><span class="id"> 0</span> (<span class="id">measurable_fun</span><span class="id"> _</span> (<span class="id">@powR</span><span class="id"> _</span><span class="id"> ^~</span><span class="id"> _</span>))<span class="id"> =&gt;</span><br/>
&nbsp;&nbsp;<span class="id">solve</span><span class="id"> [apply:</span><span class="id"> measurable_powR]</span><span class="id"> :</span><span class="id"> core</span>.<br/>
<span class="id">#[deprecated</span>(<span class="id">since=</span><span class="id">&quot;mathcomp-analysis 0.6.3&quot;</span><span class="id">,</span><span class="id"> note=</span><span class="id">&quot;use `measurable_powR` instead&quot;</span>)<span class="id">]</span><br/>
<span class="vernacular">Notation</span><span class="id"> measurable_fun_power_pos</span><span class="id"> :=</span><span class="id"> measurable_powR</span> (<span class="id">only</span><span class="id"> parsing</span>).<br/>
<span class="id">#[deprecated</span>(<span class="id">since=</span><span class="id">&quot;mathcomp-analysis 0.6.4&quot;</span><span class="id">,</span><span class="id"> note=</span><span class="id">&quot;use `measurable_powR` instead&quot;</span>)<span class="id">]</span><br/>
<span class="vernacular">Notation</span><span class="id"> measurable_power_pos</span><span class="id"> :=</span><span class="id"> measurable_powR</span> (<span class="id">only</span><span class="id"> parsing</span>).<br/>
<span class="id">#[deprecated</span>(<span class="id">since=</span><span class="id">&quot;mathcomp-analysis 0.6.3&quot;</span><span class="id">,</span><span class="id"> note=</span><span class="id">&quot;use `measurable_maxr` instead&quot;</span>)<span class="id">]</span><br/>
<span class="vernacular">Notation</span><span class="id"> measurable_fun_max</span><span class="id"> :=</span><span class="id"> measurable_maxr</span> (<span class="id">only</span><span class="id"> parsing</span>).<br/>
<span class="id">#[deprecated</span>(<span class="id">since=</span><span class="id">&quot;mathcomp-analysis 1.4.0&quot;</span><span class="id">,</span><span class="id"> note=</span><span class="id">&quot;use `measurable_funX` instead&quot;</span>)<span class="id">]</span><br/>
<span class="vernacular">Notation</span><span class="id"> measurable_fun_pow</span><span class="id"> :=</span><span class="id"> measurable_funX</span> (<span class="id">only</span><span class="id"> parsing</span>).<br/>
<br/>
<span class="vernacular">Module</span><span class="id"> NGenCInfty</span>.<br/>
<span class="vernacular">Section</span><span class="id"> ngencinfty</span>.<br/>
<span class="vernacular">Implicit</span><span class="id"> Types</span><span class="id"> x</span><span class="id"> y</span><span class="id"> z</span><span class="id"> :</span><span class="id"> nat</span>.<br/>
<br/>
<span class="vernacular">Definition</span><span class="id"> G</span><span class="id"> :</span><span class="id"> set</span> (<span class="id">set</span><span class="id"> nat</span>)<span class="id"> :=</span><span class="id"> [set</span><span class="id"> A</span><span class="id"> |</span><span class="gallina-kwd"> exists</span><span class="id"> x,</span><span class="id"> A</span><span class="id"> =</span><span class="id"> `[x,</span><span class="id"> +oo[%classic]</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> measurable_itv_bnd_infty</span><span class="id"> b</span><span class="id"> x</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">G</span>.<span class="id">-sigma</span>.<span class="id">-measurable</span><span class="id"> [set`</span><span class="id"> Interval</span> (<span class="id">BSide</span><span class="id"> b</span><span class="id"> x</span>)<span class="id"> +oo%O]</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">case:</span><span class="id"> b;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> sub_sigma_algebra;</span><span class="gallina-kwd"> exists</span><span class="id"> x;</span><span class="id"> rewrite</span><span class="id"> set_itv_c_infty</span>.<br/>
<span class="id">rewrite</span><span class="id"> [X</span><span class="gallina-kwd"> in</span><span class="id"> measurable</span><span class="id"> X]</span>(_<span class="id"> :</span><span class="id"> _</span><span class="id"> =</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">\bigcup_</span>(<span class="id">k</span><span class="gallina-kwd"> in</span><span class="id"> [set</span><span class="id"> k</span><span class="id"> |</span><span class="id"> k</span><span class="id"> &gt;=</span><span class="id"> x]%N</span>)<span class="id"> `[k</span>.<span class="id">+1,</span><span class="id"> +oo[%classic</span>)<span class="id">;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">apply/seteqP;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> [z</span><span class="id"> /=|/=</span><span class="id"> z</span><span class="id"> [t/=</span><span class="id"> xt]]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> in_itv/=</span><span class="id"> andbT</span><span class="id"> =&gt;</span><span class="id"> xz;</span><span class="gallina-kwd"> exists</span><span class="id"> z</span>.<span class="id">-1</span><span class="id"> =&gt;</span><span class="id"> /=</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -ltnS//=;</span><span class="id"> case:</span><span class="id"> z</span><span class="id"> xz</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> case:</span><span class="id"> z</span><span class="id"> xz</span><span class="id"> =&gt;</span><span class="id"> //=</span><span class="id"> z</span><span class="id"> xz;</span><span class="id"> rewrite</span><span class="id"> in_itv/=</span><span class="id"> lexx</span><span class="id"> andbT</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> !in_itv/=</span><span class="id"> !andbT;</span><span class="id"> apply:</span><span class="id"> lt_le_trans;</span><span class="id"> rewrite</span><span class="id"> ltEnat/=</span><span class="id"> ltnS</span>.<br/>
<span class="id">rewrite</span><span class="id"> bigcup_mkcond;</span><span class="id"> apply:</span><span class="id"> bigcupT_measurable</span><span class="id"> =&gt;</span><span class="id"> k</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> case:</span><span class="id"> ifPn</span><span class="id"> =&gt;</span><span class="id"> //=</span><span class="id"> _;</span><span class="id"> apply:</span><span class="id"> sub_sigma_algebra;</span><span class="id"> eexists;</span><span class="id"> reflexivity</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> measurable_itv_bounded</span><span class="id"> a</span><span class="id"> b</span><span class="id"> y</span><span class="id"> :</span><span class="id"> a</span><span class="id"> !=</span><span class="id"> +oo%O</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">G</span>.<span class="id">-sigma</span>.<span class="id">-measurable</span><span class="id"> [set`</span><span class="id"> Interval</span><span class="id"> a</span> (<span class="id">BSide</span><span class="id"> b</span><span class="id"> y</span>)<span class="id">]</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">case:</span><span class="id"> a</span><span class="id"> =&gt;</span><span class="id"> [a</span><span class="id"> r</span><span class="id"> _|[_|//]]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> set_itv_splitD;</span><span class="id"> apply:</span><span class="id"> measurableD;</span><span class="id"> apply:</span><span class="id"> measurable_itv_bnd_infty</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -setCitvr;</span><span class="id"> apply:</span><span class="id"> measurableC;</span><span class="id"> apply:</span><span class="id"> measurable_itv_bnd_infty</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> measurableE</span><span class="id"> :</span><span class="id"> @measurable</span><span class="id"> _</span><span class="id"> nat</span><span class="id"> =</span><span class="id"> G</span>.<span class="id">-sigma</span>.<span class="id">-measurable</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> eqEsubset;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> [A</span><span class="id"> mA|A];</span><span class="id"> last</span><span class="id"> exact:</span><span class="id"> smallest_sub</span>.<br/>
<span class="id">rewrite</span> (_<span class="id"> :</span><span class="id"> A</span><span class="id"> =</span><span class="id"> \bigcup_</span>(<span class="id">i</span><span class="gallina-kwd"> in</span><span class="id"> A</span>)<span class="id"> `[i,</span><span class="id"> i</span>.<span class="id">+1[%classic</span>).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> bigcup_measurable</span><span class="id"> =&gt;</span><span class="id"> k</span><span class="id"> Ak;</span><span class="id"> exact:</span><span class="id"> measurable_itv_bounded</span>.<br/>
<span class="id">apply/seteqP;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> [x</span><span class="id"> Ax|x</span><span class="id"> [k</span><span class="id"> Ak]]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="gallina-kwd"> exists</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> //=;</span><span class="id"> rewrite</span><span class="id"> in_itv/=</span><span class="id"> lexx/=</span><span class="id"> ltEnat</span><span class="id"> /=</span><span class="id"> ltnS</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /=</span><span class="id"> in_itv/=</span><span class="id"> leEnat</span><span class="id"> ltEnat</span><span class="id"> /=</span><span class="id"> ltnS</span><span class="id"> -eqn_leq</span><span class="id"> =&gt;</span><span class="id"> /eqP</span><span class="id"> &lt;-</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> ngencinfty</span>.<br/>
<span class="vernacular">End</span><span class="id"> NGenCInfty</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> measurable_fun_nat</span>.<br/>
<span class="vernacular">Context</span><span class="id"> d</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d</span>).<br/>
<span class="vernacular">Implicit</span><span class="id"> Types</span> (<span class="id">D</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T</span>) (<span class="id">f</span><span class="id"> g</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> nat</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> measurable_fun_addn</span><span class="id"> D</span><span class="id"> f</span><span class="id"> g</span><span class="id"> :</span><span class="id"> measurable_fun</span><span class="id"> D</span><span class="id"> f</span><span class="id"> -&gt;</span><span class="id"> measurable_fun</span><span class="id"> D</span><span class="id"> g</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">measurable_fun</span><span class="id"> D</span> (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> f</span><span class="id"> x</span><span class="id"> +</span><span class="id"> g</span><span class="id"> x</span>)<span class="id">%N</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> mf</span><span class="id"> mg</span><span class="id"> mD;</span><span class="id"> apply:</span> (<span class="id">measurability</span><span class="id"> NGenCInfty</span>.<span class="id">measurableE</span>)<span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> /=</span><span class="id"> _</span><span class="id"> [_</span><span class="id"> [a</span><span class="id"> -&gt;]</span><span class="id"> &lt;-];</span><span class="id"> rewrite</span><span class="id"> preimage_itv_c_infty</span>.<br/>
<span class="id">rewrite</span><span class="id"> [X</span><span class="gallina-kwd"> in</span><span class="id"> measurable</span><span class="id"> X]</span>(_<span class="id"> :</span><span class="id"> _</span><span class="id"> =</span><span class="id"> \bigcup_q</span><br/>
&nbsp;&nbsp;((<span class="id">D</span><span class="id"> `&amp;`</span><span class="id"> [set</span><span class="id"> x</span><span class="id"> |</span><span class="id"> q</span><span class="id"> &lt;=</span><span class="id"> f</span><span class="id"> x]%O</span>)<span class="id"> `&amp;`</span> (<span class="id">D</span><span class="id"> `&amp;`</span><span class="id"> [set</span><span class="id"> x</span><span class="id"> |</span> (<span class="id">a</span><span class="id"> -</span><span class="id"> q</span>)<span class="id">%N</span><span class="id"> &lt;=</span><span class="id"> g</span><span class="id"> x]%O</span>))).<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> bigcupT_measurable</span><span class="id"> =&gt;</span><span class="id"> q;</span><span class="id"> apply:</span><span class="id"> measurableI</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> -preimage_itv_c_infty;</span><span class="id"> exact:</span><span class="id"> mf</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> -preimage_itv_c_infty;</span><span class="id"> exact:</span><span class="id"> mg</span>.<br/>
<span class="id">rewrite</span><span class="id"> predeqE</span><span class="id"> =&gt;</span><span class="id"> x;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> [|[r</span><span class="id"> ?]</span><span class="id"> []/=</span><span class="id"> [Dx</span><span class="id"> rfx]]</span><span class="id"> /=</span><span class="id"> =&gt;</span><span class="id"> [[Dx]|[?]]</span>.<br/>
<span class="id">-</span><span class="id"> move=&gt;</span><span class="id"> afxgx;</span><span class="gallina-kwd"> exists</span> (<span class="id">a</span><span class="id"> -</span><span class="id"> g</span><span class="id"> x</span>)<span class="id">%N</span><span class="id"> =&gt;</span><span class="id"> //=;</span><span class="id"> split;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> leEnat</span><span class="id"> leq_subLR//</span><span class="id"> addnC</span><span class="id"> -leEnat</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> [gxa|gxa]</span><span class="id"> :=</span><span class="id"> leqP</span> (<span class="id">g</span><span class="id"> x</span>)<span class="id"> a;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> subKn</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move/ltnW</span><span class="id"> :</span> (<span class="id">gxa</span>)<span class="id">;</span><span class="id"> rewrite</span><span class="id"> -subn_eq0</span><span class="id"> =&gt;</span><span class="id"> /eqP</span><span class="id"> -&gt;;</span><span class="id"> rewrite</span><span class="id"> subn0</span><span class="id"> ltW</span>.<br/>
<span class="id">-</span><span class="id"> rewrite</span><span class="id"> leEnat</span><span class="id"> leq_subLR</span><span class="id"> =&gt;</span><span class="id"> arg;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span> (<span class="id">leq_trans</span><span class="id"> arg</span>)<span class="id">//</span><span class="id"> leq_add2r</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> measurable_fun_maxn</span><span class="id"> D</span><span class="id"> f</span><span class="id"> g</span><span class="id"> :</span><span class="id"> measurable_fun</span><span class="id"> D</span><span class="id"> f</span><span class="id"> -&gt;</span><span class="id"> measurable_fun</span><span class="id"> D</span><span class="id"> g</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">measurable_fun</span><span class="id"> D</span> (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> maxn</span> (<span class="id">f</span><span class="id"> x</span>) (<span class="id">g</span><span class="id"> x</span>)).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> mf</span><span class="id"> mg</span><span class="id"> mD;</span><span class="id"> apply:</span> (<span class="id">measurability</span><span class="id"> NGenCInfty</span>.<span class="id">measurableE</span>)<span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> /=</span><span class="id"> _</span><span class="id"> [_</span><span class="id"> [a</span><span class="id"> -&gt;]</span><span class="id"> &lt;-];</span><span class="id"> rewrite</span><span class="id"> [X</span><span class="gallina-kwd"> in</span><span class="id"> measurable</span><span class="id"> X]</span>(_<span class="id"> :</span><span class="id"> _</span><span class="id"> =</span><br/>
&nbsp;&nbsp;((<span class="id">D</span><span class="id"> `&amp;`</span><span class="id"> [set</span><span class="id"> x</span><span class="id"> |</span><span class="id"> a</span><span class="id"> &lt;=</span><span class="id"> f</span><span class="id"> x]%O</span>)<span class="id"> `|`</span> (<span class="id">D</span><span class="id"> `&amp;`</span><span class="id"> [set</span><span class="id"> x</span><span class="id"> |</span><span class="id"> a</span><span class="id"> &lt;=</span><span class="id"> g</span><span class="id"> x]%O</span>))).<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> measurableU</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> -preimage_itv_c_infty;</span><span class="id"> exact:</span><span class="id"> mf</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> -preimage_itv_c_infty;</span><span class="id"> exact:</span><span class="id"> mg</span>.<br/>
<span class="id">rewrite</span><span class="id"> predeqE</span><span class="id"> =&gt;</span><span class="id"> x;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> [[Dx</span><span class="id"> /=]|]</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> in_itv/=</span><span class="id"> andbT;</span><span class="id"> have</span><span class="id"> [fg</span><span class="id"> agx|gf</span><span class="id"> afx]</span><span class="id"> :=</span><span class="id"> leqP</span> (<span class="id">f</span><span class="id"> x</span>) (<span class="id">g</span><span class="id"> x</span>)<span class="id">;</span><span class="id"> tauto</span>.<br/>
<span class="id">-</span><span class="id"> move=&gt;</span><span class="id"> [[Dx</span><span class="id"> /=</span><span class="id"> afx]|[Dx</span><span class="id"> /=</span><span class="id"> agx]]</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="id"> rewrite</span><span class="id"> in_itv/=</span><span class="id"> andbT;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span> (<span class="id">le_trans</span><span class="id"> afx</span>)<span class="id">//</span><span class="id"> leEnat</span><span class="id"> leq_maxl</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="id"> rewrite</span><span class="id"> in_itv/=</span><span class="id"> andbT;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span> (<span class="id">le_trans</span><span class="id"> agx</span>)<span class="id">//</span><span class="id"> leEnat</span><span class="id"> leq_maxr</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Let</span><span class="id"> measurable_fun_subn'</span><span class="id"> D</span><span class="id"> f</span><span class="id"> g</span><span class="id"> :</span> (<span class="gallina-kwd">forall</span><span class="id"> t,</span><span class="id"> g</span><span class="id"> t</span><span class="id"> &lt;=</span><span class="id"> f</span><span class="id"> t</span>)<span class="id">%N</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">measurable_fun</span><span class="id"> D</span><span class="id"> f</span><span class="id"> -&gt;</span><span class="id"> measurable_fun</span><span class="id"> D</span><span class="id"> g</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">measurable_fun</span><span class="id"> D</span> (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> f</span><span class="id"> x</span><span class="id"> -</span><span class="id"> g</span><span class="id"> x</span>)<span class="id">%N</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> gf</span><span class="id"> mf</span><span class="id"> mg</span><span class="id"> mD;</span><span class="id"> apply:</span> (<span class="id">measurability</span><span class="id"> NGenCInfty</span>.<span class="id">measurableE</span>)<span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> /=</span><span class="id"> _</span><span class="id"> [_</span><span class="id"> [a</span><span class="id"> -&gt;]</span><span class="id"> &lt;-];</span><span class="id"> rewrite</span><span class="id"> preimage_itv_c_infty</span>.<br/>
<span class="id">rewrite</span><span class="id"> [X</span><span class="gallina-kwd"> in</span><span class="id"> measurable</span><span class="id"> X]</span>(_<span class="id"> :</span><span class="id"> _</span><span class="id"> =</span><span class="id"> \bigcup_q</span><br/>
&nbsp;&nbsp;((<span class="id">D</span><span class="id"> `&amp;`</span><span class="id"> [set</span><span class="id"> x</span><span class="id"> |</span><span class="id"> maxn</span><span class="id"> a</span><span class="id"> q</span><span class="id"> &lt;=</span><span class="id"> f</span><span class="id"> x]%O</span>)<span class="id"> `&amp;`</span><br/>
&nbsp;&nbsp;&nbsp;(<span class="id">D</span><span class="id"> `&amp;`</span><span class="id"> [set</span><span class="id"> x</span><span class="id"> |</span><span class="id"> g</span><span class="id"> x</span><span class="id"> &lt;=</span> (<span class="id">q</span><span class="id"> -</span><span class="id"> a</span>)<span class="id">%N]%O</span>))).<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> bigcupT_measurable</span><span class="id"> =&gt;</span><span class="id"> q;</span><span class="id"> apply:</span><span class="id"> measurableI</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> -preimage_itv_c_infty;</span><span class="id"> exact:</span><span class="id"> mf</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> -preimage_itv_infty_c;</span><span class="id"> exact:</span><span class="id"> mg</span>.<br/>
<span class="id">rewrite</span><span class="id"> predeqE</span><span class="id"> =&gt;</span><span class="id"> x;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> [|[r</span><span class="id"> ?]</span><span class="id"> []/=</span><span class="id"> [Dx</span><span class="id"> rfx]]</span><span class="id"> /=</span><span class="id"> =&gt;</span><span class="id"> [[Dx]|[_]]</span>.<br/>
<span class="id">-</span><span class="id"> move=&gt;</span><span class="id"> afxgx;</span><span class="gallina-kwd"> exists</span> (<span class="id">g</span><span class="id"> x</span><span class="id"> +</span><span class="id"> a</span>)<span class="id">%N</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> split;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //=</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> leEnat;</span><span class="id"> have</span><span class="id"> /maxn_idPr</span><span class="id"> -&gt;</span><span class="id"> :=</span><span class="id"> leq_addl</span> (<span class="id">g</span><span class="id"> x</span>)<span class="id"> a</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -leq_subRL</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> leEnat</span><span class="id"> addnK</span>.<br/>
<span class="id">-</span><span class="id"> rewrite</span><span class="id"> leEnat</span><span class="id"> =&gt;</span><span class="id"> gxra;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> rewrite</span><span class="id"> -</span>(<span class="id">leq_add2r</span> (<span class="id">g</span><span class="id"> x</span>))<span class="id"> subnK//</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> [afx|afx]</span><span class="id"> :=</span><span class="id"> leqP</span><span class="id"> a</span> (<span class="id">f</span><span class="id"> x</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -</span>(<span class="id">@leq_sub2rE</span><span class="id"> a</span>)<span class="id">//</span><span class="id"> addnC</span><span class="id"> addnK</span> (<span class="id">leq_trans</span><span class="id"> gxra</span>)<span class="id">//</span><span class="id"> leq_sub2r//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span> (<span class="id">leq_trans</span><span class="id"> _</span><span class="id"> rfx</span>)<span class="id">//;</span><span class="id"> exact:</span><span class="id"> leq_maxr</span>.<br/>
&nbsp;&nbsp;<span class="id">move:</span><span class="id"> gxra;</span><span class="id"> rewrite</span><span class="id"> -</span>(<span class="id">leq_add2l</span><span class="id"> a</span>)<span class="id"> subnKC//;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> have</span><span class="id"> :=</span><span class="id"> leq_ltn_trans</span><span class="id"> rfx</span><span class="id"> afx;</span><span class="id"> rewrite</span><span class="id"> ltnNge</span><span class="id"> leq_maxl</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> /leq_trans;</span><span class="id"> apply;</span><span class="id"> rewrite</span> (<span class="id">leq_trans</span><span class="id"> _</span><span class="id"> rfx</span>)<span class="id">//;</span><span class="id"> exact:</span><span class="id"> leq_maxr</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> measurable_fun_subn</span><span class="id"> D</span><span class="id"> f</span><span class="id"> g</span><span class="id"> :</span><span class="id"> measurable_fun</span><span class="id"> D</span><span class="id"> f</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">measurable_fun</span><span class="id"> D</span><span class="id"> g</span><span class="id"> -&gt;</span><span class="id"> measurable_fun</span><span class="id"> D</span> (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> f</span><span class="id"> x</span><span class="id"> -</span><span class="id"> g</span><span class="id"> x</span>)<span class="id">%N</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> mf</span><span class="id"> mg</span>.<br/>
<span class="id">rewrite</span><span class="id"> [X</span><span class="gallina-kwd"> in</span><span class="id"> measurable_fun</span><span class="id"> _</span><span class="id"> X]</span>(_<span class="id"> :</span><span class="id"> _</span><span class="id"> =</span><span class="gallina-kwd"> fun</span><span class="id"> x</span><span class="id"> =&gt;</span> (<span class="id">maxn</span> (<span class="id">f</span><span class="id"> x</span>) (<span class="id">g</span><span class="id"> x</span>)<span class="id"> -</span><span class="id"> g</span><span class="id"> x</span>)<span class="id">%N</span>).<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> measurable_fun_subn'</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> last</span><span class="id"> exact:</span><span class="id"> measurable_fun_maxn</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> t;</span><span class="id"> rewrite</span><span class="id"> leq_maxr</span>.<br/>
<span class="id">apply/funext</span><span class="id"> =&gt;</span><span class="id"> x;</span><span class="id"> have</span><span class="id"> [//|gf]</span><span class="id"> :=</span><span class="id"> leqP</span> (<span class="id">g</span><span class="id"> x</span>) (<span class="id">f</span><span class="id"> x</span>).<br/>
<span class="gallina-kwd">by</span><span class="id"> apply/eqP;</span><span class="id"> rewrite</span><span class="id"> subnn</span><span class="id"> subn_eq0//</span><span class="id"> ltnW</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> measurable_fun_ltn</span><span class="id"> D</span><span class="id"> f</span><span class="id"> g</span><span class="id"> :</span><span class="id"> measurable_fun</span><span class="id"> D</span><span class="id"> f</span><span class="id"> -&gt;</span><span class="id"> measurable_fun</span><span class="id"> D</span><span class="id"> g</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">measurable_fun</span><span class="id"> D</span> (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> f</span><span class="id"> x</span><span class="id"> &lt;</span><span class="id"> g</span><span class="id"> x</span>)<span class="id">%N</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> mf</span><span class="id"> mg</span><span class="id"> mD</span><span class="id"> Y</span><span class="id"> mY;</span><span class="id"> have</span><span class="id"> [|</span><span class="id"> |</span><span class="id"> |]</span><span class="id"> :=</span><span class="id"> set_bool</span><span class="id"> Y</span><span class="id"> =&gt;</span><span class="id"> /eqP</span><span class="id"> -&gt;</span>.<br/>
<span class="id">-</span><span class="id"> have</span><span class="id"> -&gt;</span><span class="id"> :</span> (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> f</span><span class="id"> x</span><span class="id"> &lt;</span><span class="id"> g</span><span class="id"> x</span>)<span class="id">%O</span><span class="id"> =</span> (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> 0%N</span><span class="id"> &lt;</span> (<span class="id">g</span><span class="id"> x</span><span class="id"> -</span><span class="id"> f</span><span class="id"> x</span>)<span class="id">%N</span>)<span class="id">%O</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply/funext</span><span class="id"> =&gt;</span><span class="id"> n;</span><span class="id"> apply/idP/idP</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> !ltEnat</span><span class="id"> /ltn/=</span><span class="id"> =&gt;</span><span class="id"> fg;</span><span class="id"> rewrite</span><span class="id"> subn_gt0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> !ltEnat</span><span class="id"> /ltn/=</span><span class="id"> =&gt;</span><span class="id"> fg;</span><span class="id"> rewrite</span><span class="id"> -subn_gt0</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> preimage_true</span><span class="id"> -preimage_itv_o_infty;</span><span class="id"> exact:</span><span class="id"> measurable_fun_subn</span>.<br/>
<span class="id">-</span><span class="id"> under</span><span class="id"> eq_fun</span><span class="id"> do</span><span class="id"> rewrite</span><span class="id"> ltnNge</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> preimage_false</span><span class="id"> set_predC</span><span class="id"> setCK</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> [X</span><span class="gallina-kwd"> in</span><span class="id"> _</span><span class="id"> `&amp;`</span><span class="id"> X]</span>(_<span class="id"> :</span><span class="id"> _</span><span class="id"> =</span><span class="id"> \bigcup_</span>(<span class="id">i</span><span class="gallina-kwd"> in</span><span class="id"> range</span><span class="id"> f</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">[set</span><span class="id"> y</span><span class="id"> |</span><span class="id"> g</span><span class="id"> y</span><span class="id"> &lt;=</span><span class="id"> i]%O</span><span class="id"> `&amp;`</span><span class="id"> [set</span><span class="id"> t</span><span class="id"> |</span><span class="id"> i</span><span class="id"> &lt;=</span><span class="id"> f</span><span class="id"> t]%O</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> setI_bigcupr;</span><span class="id"> apply:</span><span class="id"> bigcup_measurable</span><span class="id"> =&gt;</span><span class="id"> k</span><span class="id"> fk</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> setIIr;</span><span class="id"> apply:</span><span class="id"> measurableI</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> -preimage_itv_infty_c;</span><span class="id"> exact:</span><span class="id"> mg</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> -preimage_itv_c_infty;</span><span class="id"> exact:</span><span class="id"> mf</span>.<br/>
&nbsp;&nbsp;<span class="id">apply/funext</span><span class="id"> =&gt;</span><span class="id"> n/=</span>.<br/>
&nbsp;&nbsp;<span class="id">suff</span><span class="id"> :</span> (<span class="id">g</span><span class="id"> n</span><span class="id"> &lt;=</span><span class="id"> f</span><span class="id"> n</span>)<span class="id">%N</span><span class="id"> &lt;-&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">\bigcup_</span>(<span class="id">i</span><span class="gallina-kwd"> in</span><span class="id"> range</span><span class="id"> f</span>) (<span class="id">[set</span><span class="id"> y</span><span class="id"> |</span><span class="id"> g</span><span class="id"> y</span><span class="id"> &lt;=</span><span class="id"> i]%O</span><span class="id"> `&amp;`</span><span class="id"> [set</span><span class="id"> t</span><span class="id"> |</span><span class="id"> i</span><span class="id"> &lt;=</span><span class="id"> f</span><span class="id"> t]%O</span>))<span class="id"> n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move/propext</span>.<br/>
&nbsp;&nbsp;<span class="id">split=&gt;</span><span class="id"> [gfn|[k</span><span class="id"> [t</span><span class="id"> _</span><span class="id"> &lt;-</span><span class="id"> []]]</span><span class="id"> /=]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="gallina-kwd"> exists</span> (<span class="id">f</span><span class="id"> n</span>)<span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> /=</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> /leq_trans;</span><span class="id"> apply</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> preimage_set0</span><span class="id"> setI0</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> preimage_setT</span><span class="id"> setIT</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> measurable_fun_leq</span><span class="id"> D</span><span class="id"> f</span><span class="id"> g</span><span class="id"> :</span><span class="id"> measurable_fun</span><span class="id"> D</span><span class="id"> f</span><span class="id"> -&gt;</span><span class="id"> measurable_fun</span><span class="id"> D</span><span class="id"> g</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">measurable_fun</span><span class="id"> D</span> (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> f</span><span class="id"> x</span><span class="id"> &lt;=</span><span class="id"> g</span><span class="id"> x</span>)<span class="id">%N</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> mf</span><span class="id"> mg</span><span class="id"> mD</span><span class="id"> Y</span><span class="id"> mY;</span><span class="id"> have</span><span class="id"> [|</span><span class="id"> |</span><span class="id"> |]</span><span class="id"> :=</span><span class="id"> set_bool</span><span class="id"> Y</span><span class="id"> =&gt;</span><span class="id"> /eqP</span><span class="id"> -&gt;</span>.<br/>
<span class="id">-</span><span class="id"> rewrite</span><span class="id"> preimage_true</span><span class="id"> [X</span><span class="gallina-kwd"> in</span><span class="id"> _</span><span class="id"> `&amp;`</span><span class="id"> X]</span>(_<span class="id"> :</span><span class="id"> _</span> <span class="id"> =</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">\bigcup_</span>(<span class="id">i</span><span class="gallina-kwd"> in</span><span class="id"> range</span><span class="id"> g</span>) (<span class="id">[set</span><span class="id"> y</span><span class="id"> |</span><span class="id"> f</span><span class="id"> y</span><span class="id"> &lt;=</span><span class="id"> i]%O</span><span class="id"> `&amp;`</span><span class="id"> [set</span><span class="id"> t</span><span class="id"> |</span><span class="id"> i</span><span class="id"> &lt;=</span><span class="id"> g</span><span class="id"> t]%O</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> setI_bigcupr;</span><span class="id"> apply:</span><span class="id"> bigcup_measurable</span><span class="id"> =&gt;</span><span class="id"> k</span><span class="id"> fk</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> setIIr;</span><span class="id"> apply:</span><span class="id"> measurableI</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> -preimage_itv_infty_c;</span><span class="id"> exact:</span><span class="id"> mf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> -preimage_itv_c_infty;</span><span class="id"> exact:</span><span class="id"> mg</span>.<br/>
&nbsp;&nbsp;<span class="id">apply/funext</span><span class="id"> =&gt;</span><span class="id"> n/=</span>.<br/>
&nbsp;&nbsp;<span class="id">suff</span><span class="id"> :</span> (<span class="id">f</span><span class="id"> n</span><span class="id"> &lt;=</span><span class="id"> g</span><span class="id"> n</span>)<span class="id">%N</span><span class="id"> &lt;-&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">\bigcup_</span>(<span class="id">i</span><span class="gallina-kwd"> in</span><span class="id"> range</span><span class="id"> g</span>) (<span class="id">[set</span><span class="id"> y</span><span class="id"> |</span><span class="id"> f</span><span class="id"> y</span><span class="id"> &lt;=</span><span class="id"> i]%O</span><span class="id"> `&amp;`</span><span class="id"> [set</span><span class="id"> t</span><span class="id"> |</span><span class="id"> i</span><span class="id"> &lt;=</span><span class="id"> g</span><span class="id"> t]%O</span>))<span class="id"> n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move/propext</span>.<br/>
&nbsp;&nbsp;<span class="id">split=&gt;</span><span class="id"> [gfn|[k</span><span class="id"> [t</span><span class="id"> _</span><span class="id"> &lt;-</span><span class="id"> []]]</span><span class="id"> /=]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="gallina-kwd"> exists</span> (<span class="id">g</span><span class="id"> n</span>)<span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> /=</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> /leq_trans;</span><span class="id"> apply</span>.<br/>
<span class="id">-</span><span class="id"> under</span><span class="id"> eq_fun</span><span class="id"> do</span><span class="id"> rewrite</span><span class="id"> leqNgt</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> preimage_false</span><span class="id"> set_predC</span><span class="id"> setCK;</span><span class="id"> exact:</span><span class="id"> measurable_fun_ltn</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> preimage_set0</span><span class="id"> setI0</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> preimage_setT</span><span class="id"> setIT</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> measurable_fun_eqn</span><span class="id"> D</span><span class="id"> f</span><span class="id"> g</span><span class="id"> :</span><span class="id"> measurable_fun</span><span class="id"> D</span><span class="id"> f</span><span class="id"> -&gt;</span><span class="id"> measurable_fun</span><span class="id"> D</span><span class="id"> g</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">measurable_fun</span><span class="id"> D</span> (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> f</span><span class="id"> x</span><span class="id"> ==</span><span class="id"> g</span><span class="id"> x</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> mf</span><span class="id"> mg</span>.<br/>
<span class="id">rewrite</span> (_<span class="id"> :</span> (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> f</span><span class="id"> x</span><span class="id"> ==</span><span class="id"> g</span><span class="id"> x</span>)<span class="id"> =</span> (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> =&gt;</span> (<span class="id">f</span><span class="id"> x</span><span class="id"> &lt;=</span><span class="id"> g</span><span class="id"> x</span>)<span class="id"> &amp;&amp;</span> (<span class="id">g</span><span class="id"> x</span><span class="id"> &lt;=</span><span class="id"> f</span><span class="id"> x</span>))<span class="id">%N</span>).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> measurable_and;</span><span class="id"> exact:</span><span class="id"> measurable_fun_leq</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> under</span><span class="id"> eq_fun</span><span class="id"> do</span><span class="id"> rewrite</span><span class="id"> eq_le</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> measurable_fun_nat</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> standard_emeasurable_fun</span>.<br/>
<span class="vernacular">Variable</span><span class="id"> R</span><span class="id"> :</span><span class="id"> realType</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> EFin_measurable</span> (<span class="id">D</span><span class="id"> :</span><span class="id"> set</span><span class="id"> R</span>)<span class="id"> :</span><span class="id"> measurable_fun</span><span class="id"> D</span><span class="id"> EFin</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> mD;</span><span class="id"> apply:</span> (<span class="id">measurability</span> (<span class="id">ErealGenOInfty</span>.<span class="id">measurableE</span><span class="id"> R</span>))<span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> /=</span><span class="id"> _</span><span class="id"> [_</span><span class="id"> [x</span><span class="id"> -&gt;]]</span><span class="id"> &lt;-;</span><span class="id"> apply:</span><span class="id"> measurableI</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> preimage_itv_o_infty</span><span class="id"> EFin_itv;</span><span class="id"> exact:</span><span class="id"> measurable_itv</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> abse_measurable</span> (<span class="id">D</span><span class="id"> :</span><span class="id"> set</span> (<span class="id">\bar</span><span class="id"> R</span>))<span class="id"> :</span><span class="id"> measurable_fun</span><span class="id"> D</span><span class="id"> abse</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> mD;</span><span class="id"> apply:</span> (<span class="id">measurability</span> (<span class="id">ErealGenOInfty</span>.<span class="id">measurableE</span><span class="id"> R</span>))<span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> /=</span><span class="id"> _</span><span class="id"> [_</span><span class="id"> [x</span><span class="id"> -&gt;]</span><span class="id"> &lt;-]</span>.<br/>
<span class="id">rewrite</span><span class="id"> [X</span><span class="gallina-kwd"> in</span><span class="id"> _</span><span class="id"> @^-1`</span><span class="id"> X]</span>(<span class="id">punct_eitv_bndy</span><span class="id"> _</span><span class="id"> x</span>)<span class="id"> preimage_setU</span><span class="id"> setIUr</span>.<br/>
<span class="id">apply:</span><span class="id"> measurableU;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> preimage_abse_pinfty;</span><span class="id"> apply:</span><span class="id"> measurableI</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> measurableU</span>.<br/>
<span class="id">apply:</span><span class="id"> measurableI</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="gallina-kwd"> exists</span> (<span class="id">normr</span><span class="id"> @^-1`</span><span class="id"> `]x,</span><span class="id"> +oo[%classic</span>).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -[X</span><span class="gallina-kwd"> in</span><span class="id"> measurable</span><span class="id"> X]setTI;</span><span class="id"> exact:</span><span class="id"> normr_measurable</span>.<br/>
<span class="gallina-kwd">exists</span><span class="id"> set0;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> constructor</span>.<br/>
<span class="id">rewrite</span><span class="id"> setU0</span><span class="id"> predeqE</span><span class="id"> =&gt;</span><span class="id"> -[y|</span><span class="id"> |];</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> /=</span><span class="id"> =&gt;</span><span class="id"> -[r];</span><br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> ?/=</span><span class="id"> /=</span><span class="id"> ?in_itv</span><span class="id"> /=</span><span class="id"> ?andbT</span><span class="id"> =&gt;</span><span class="id"> xr//</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> [ry];</span><span class="gallina-kwd"> exists</span><span class="id"> `|y|</span><span class="id"> =&gt;</span><span class="id"> //=;</span><span class="id"> rewrite</span><span class="id"> in_itv/=</span><span class="id"> andbT</span><span class="id"> -ry</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> [ry];</span><span class="gallina-kwd"> exists</span><span class="id"> y</span><span class="id"> =&gt;</span><span class="id"> //=;</span><span class="id"> rewrite</span><span class="id"> /=</span><span class="id"> in_itv/=</span><span class="id"> andbT</span><span class="id"> -ry</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> oppe_measurable</span> (<span class="id">D</span><span class="id"> :</span><span class="id"> set</span> (<span class="id">\bar</span><span class="id"> R</span>))<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">measurable_fun</span><span class="id"> D</span> (<span class="id">-%E</span><span class="id"> :</span><span class="id"> \bar</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> mD;</span><span class="id"> apply:</span> (<span class="id">measurability</span> (<span class="id">ErealGenCInfty</span>.<span class="id">measurableE</span><span class="id"> R</span>))<span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> _</span><span class="id"> [_</span><span class="id"> [x</span><span class="id"> -&gt;]</span><span class="id"> &lt;-];</span><span class="id"> rewrite</span> (_<span class="id"> :</span><span class="id"> _</span><span class="id"> @^-1`</span><span class="id"> _</span><span class="id"> =</span><span class="id"> `]-oo,</span> (<span class="id">-</span><span class="id"> x</span>)<span class="id">%:E]%classic</span>).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> measurableI</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> emeasurable_itv</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> predeqE</span><span class="id"> =&gt;</span><span class="id"> y;</span><span class="id"> rewrite</span><span class="id"> preimage_itv</span><span class="id"> !in_itv/=</span><span class="id"> andbT</span><span class="id"> in_itv</span><span class="id"> leeNr</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> standard_emeasurable_fun</span>.<br/>
<span class="id">#[global]</span><span class="vernacular"> Hint</span><span class="id"> Extern</span><span class="id"> 0</span> (<span class="id">measurable_fun</span><span class="id"> _</span><span class="id"> abse</span>)<span class="id"> =&gt;</span><br/>
&nbsp;&nbsp;<span class="id">solve</span><span class="id"> [exact:</span><span class="id"> abse_measurable]</span><span class="id"> :</span><span class="id"> core</span>.<br/>
<span class="id">#[global]</span><span class="vernacular"> Hint</span><span class="id"> Extern</span><span class="id"> 0</span> (<span class="id">measurable_fun</span><span class="id"> _</span><span class="id"> EFin</span>)<span class="id"> =&gt;</span><br/>
&nbsp;&nbsp;<span class="id">solve</span><span class="id"> [exact:</span><span class="id"> EFin_measurable]</span><span class="id"> :</span><span class="id"> core</span>.<br/>
<span class="id">#[global]</span><span class="vernacular"> Hint</span><span class="id"> Extern</span><span class="id"> 0</span> (<span class="id">measurable_fun</span><span class="id"> _</span><span class="id"> -%E</span>)<span class="id"> =&gt;</span><br/>
&nbsp;&nbsp;<span class="id">solve</span><span class="id"> [exact:</span><span class="id"> oppe_measurable]</span><span class="id"> :</span><span class="id"> core</span>.<br/>
<span class="id">#[deprecated</span>(<span class="id">since=</span><span class="id">&quot;mathcomp-analysis 1.4.0&quot;</span><span class="id">,</span><span class="id"> note=</span><span class="id">&quot;use `oppe_measurable` instead&quot;</span>)<span class="id">]</span><br/>
<span class="vernacular">Notation</span><span class="id"> measurable_oppe</span><span class="id"> :=</span><span class="id"> oppe_measurable</span> (<span class="id">only</span><span class="id"> parsing</span>).<br/>
<span class="id">#[deprecated</span>(<span class="id">since=</span><span class="id">&quot;mathcomp-analysis 1.4.0&quot;</span><span class="id">,</span><span class="id"> note=</span><span class="id">&quot;use `abse_measurable` instead&quot;</span>)<span class="id">]</span><br/>
<span class="vernacular">Notation</span><span class="id"> measurable_abse</span><span class="id"> :=</span><span class="id"> abse_measurable</span> (<span class="id">only</span><span class="id"> parsing</span>).<br/>
<span class="id">#[deprecated</span>(<span class="id">since=</span><span class="id">&quot;mathcomp-analysis 1.4.0&quot;</span><span class="id">,</span><span class="id"> note=</span><span class="id">&quot;use `EFin_measurable` instead&quot;</span>)<span class="id">]</span><br/>
<span class="vernacular">Notation</span><span class="id"> measurable_EFin</span><span class="id"> :=</span><span class="id"> EFin_measurable</span> (<span class="id">only</span><span class="id"> parsing</span>).<br/>
<span class="id">#[deprecated</span>(<span class="id">since=</span><span class="id">&quot;mathcomp-analysis 1.4.0&quot;</span><span class="id">,</span><span class="id"> note=</span><span class="id">&quot;use `natmul_measurable` instead&quot;</span>)<span class="id">]</span><br/>
<span class="vernacular">Notation</span><span class="id"> measurable_natmul</span><span class="id"> :=</span><span class="id"> natmul_measurable</span> (<span class="id">only</span><span class="id"> parsing</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> measurable_EFinP</span><span class="id"> d</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>) (<span class="id">D</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">g</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">measurable_fun</span><span class="id"> D</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> g</span>)<span class="id"> &lt;-&gt;</span><span class="id"> measurable_fun</span><span class="id"> D</span><span class="id"> g</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">split=&gt;</span><span class="id"> [mf</span><span class="id"> mD</span><span class="id"> A</span><span class="id"> mA|];</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> mg;</span><span class="id"> exact:</span><span class="id"> measurableT_comp</span>.<br/>
<span class="id">rewrite</span><span class="id"> [X</span><span class="gallina-kwd"> in</span><span class="id"> measurable</span><span class="id"> X]</span>(_<span class="id"> :</span><span class="id"> _</span><span class="id"> =</span><span class="id"> D</span><span class="id"> `&amp;`</span> (<span class="id">EFin</span><span class="id"> \o</span><span class="id"> g</span>)<span class="id"> @^-1`</span> (<span class="id">EFin</span><span class="id"> @`</span><span class="id"> A</span>)).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> mf</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="gallina-kwd"> exists</span><span class="id"> A</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="gallina-kwd"> exists</span><span class="id"> set0;</span><span class="id"> [constructor|rewrite</span><span class="id"> setU0]</span>.<br/>
<span class="id">congr</span> (_<span class="id"> `&amp;`</span><span class="id"> _</span>)<span class="id">;rewrite</span><span class="id"> eqEsubset;</span><span class="id"> split=&gt;</span><span class="id"> [|?</span><span class="id"> []/=</span><span class="id"> _</span><span class="id"> /[swap]</span><span class="id"> -[-&gt;//]]</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> ?</span><span class="id"> ?;</span><span class="id"> exact:</span><span class="id"> preimage_image</span>.<br/>
Qed.</div></details>
<span class="id">#[deprecated</span>(<span class="id">since=</span><span class="id">&quot;mathcomp-analysis 1.6.0&quot;</span><span class="id">,</span><span class="id"> note=</span><span class="id">&quot;use `measurable_EFinP` instead&quot;</span>)<span class="id">]</span><br/>
<span class="vernacular">Notation</span><span class="id"> EFin_measurable_fun</span><span class="id"> :=</span><span class="id"> measurable_EFinP</span> (<span class="id">only</span><span class="id"> parsing</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> measurable_fun_dirac</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">d</span><span class="id"> {T</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d}</span><span class="id"> {R</span><span class="id"> :</span><span class="id"> realType}</span><span class="id"> D</span> (<span class="id">U</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">measurable</span><span class="id"> U</span><span class="id"> -&gt;</span><span class="id"> measurable_fun</span><span class="id"> D</span> (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> \d_x</span><span class="id"> U</span><span class="id"> :</span><span class="id"> \bar</span><span class="id"> R</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> /measurable_fun_indic/measurable_EFinP</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> measurable_er_map</span><span class="id"> d</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">measurable_fun</span><span class="id"> setT</span><span class="id"> f</span><span class="id"> -&gt;</span><span class="id"> measurable_fun</span><span class="id"> [set:</span><span class="id"> \bar</span><span class="id"> R]</span> (<span class="id">er_map</span><span class="id"> f</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> mf;rewrite</span> (_<span class="id"> :</span><span class="id"> er_map</span><span class="id"> _</span><span class="id"> =</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="gallina-kwd"> if</span><span class="id"> x</span><span class="id"> \is</span><span class="id"> a</span><span class="id"> fin_num</span><span class="gallina-kwd"> then</span> (<span class="id">f</span> (<span class="id">fine</span><span class="id"> x</span>))<span class="id">%:E</span><span class="gallina-kwd"> else</span><span class="id"> x</span>)<span class="id">;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> funext=&gt;</span><span class="id"> -[]</span>.<br/>
<span class="id">apply:</span><span class="id"> measurable_fun_ifT</span><span class="id"> =&gt;</span><span class="id"> //=</span>.<br/>
<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span> (<span class="id">measurable_fun_bool</span><span class="id"> true</span>)<span class="id">;</span><span class="id"> exact/emeasurable_fin_num</span>.<br/>
<span class="id">+</span><span class="id"> exact/measurable_EFinP/measurableT_comp</span>.<br/>
Qed.</div></details>
<span class="id">#[deprecated</span>(<span class="id">since=</span><span class="id">&quot;mathcomp-analysis 0.6.3&quot;</span><span class="id">,</span><span class="id"> note=</span><span class="id">&quot;renamed `measurable_er_map`&quot;</span>)<span class="id">]</span><br/>
<span class="vernacular">Notation</span><span class="id"> measurable_fun_er_map</span><span class="id"> :=</span><span class="id"> measurable_er_map</span> (<span class="id">only</span><span class="id"> parsing</span>).<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> emeasurable_fun</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<span class="vernacular">Context</span><span class="id"> d</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d</span>) (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>).<br/>
<span class="vernacular">Implicit</span><span class="id"> Types</span> (<span class="id">D</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> measurable_fun_einfs</span><span class="id"> D</span> (<span class="id">f</span><span class="id"> :</span> (<span class="id">T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id">^nat</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">forall</span><span class="id"> n,</span><span class="id"> measurable_fun</span><span class="id"> D</span> (<span class="id">f</span><span class="id"> n</span>))<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">forall</span><span class="id"> n,</span><span class="id"> measurable_fun</span><span class="id"> D</span> (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> einfs</span> (<span class="id">f</span><span class="id"> ^~</span><span class="id"> x</span>)<span class="id"> n</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> mf</span><span class="id"> n</span><span class="id"> mD</span>.<br/>
<span class="id">apply:</span> (<span class="id">measurability</span> (<span class="id">ErealGenCInfty</span>.<span class="id">measurableE</span><span class="id"> R</span>))<span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> _</span><span class="id"> [_</span><span class="id"> [x</span><span class="id"> -&gt;]</span><span class="id"> &lt;-];</span><span class="id"> rewrite</span><span class="id"> einfs_preimage</span><span class="id"> -bigcapIr;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="gallina-kwd"> exists</span><span class="id"> n</span><span class="id"> =&gt;/=</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> bigcap_measurableType</span><span class="id"> =&gt;</span><span class="id"> ?</span><span class="id"> ?;</span><span class="id"> exact/mf/emeasurable_itv</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> measurable_fun_esups</span><span class="id"> D</span> (<span class="id">f</span><span class="id"> :</span> (<span class="id">T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id">^nat</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">forall</span><span class="id"> n,</span><span class="id"> measurable_fun</span><span class="id"> D</span> (<span class="id">f</span><span class="id"> n</span>))<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">forall</span><span class="id"> n,</span><span class="id"> measurable_fun</span><span class="id"> D</span> (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> esups</span> (<span class="id">f</span><span class="id"> ^~</span><span class="id"> x</span>)<span class="id"> n</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> mf</span><span class="id"> n</span><span class="id"> mD;</span><span class="id"> apply:</span> (<span class="id">measurability</span> (<span class="id">ErealGenOInfty</span>.<span class="id">measurableE</span><span class="id"> R</span>))<span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> _</span><span class="id"> [_</span><span class="id"> [x</span><span class="id"> -&gt;]</span><span class="id"> &lt;-];rewrite</span><span class="id"> esups_preimage</span><span class="id"> setI_bigcupr</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> bigcup_measurable</span><span class="id"> =&gt;</span><span class="id"> ?</span><span class="id"> ?;</span><span class="id"> exact/mf/emeasurable_itv</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> measurable_maxe</span><span class="id"> D</span> (<span class="id">f</span><span class="id"> g</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">measurable_fun</span><span class="id"> D</span><span class="id"> f</span><span class="id"> -&gt;</span><span class="id"> measurable_fun</span><span class="id"> D</span><span class="id"> g</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">measurable_fun</span><span class="id"> D</span> (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> maxe</span> (<span class="id">f</span><span class="id"> x</span>) (<span class="id">g</span><span class="id"> x</span>)).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> mf</span><span class="id"> mg</span><span class="id"> mD;</span><span class="id"> apply:</span> (<span class="id">measurability</span> (<span class="id">ErealGenCInfty</span>.<span class="id">measurableE</span><span class="id"> R</span>))<span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> _</span><span class="id"> [_</span><span class="id"> [x</span><span class="id"> -&gt;]</span><span class="id"> &lt;-];</span><span class="id"> rewrite</span><span class="id"> [X</span><span class="gallina-kwd"> in</span><span class="id"> measurable</span><span class="id"> X]</span>(_<span class="id"> :</span><span class="id"> _</span><span class="id"> =</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">D</span><span class="id"> `&amp;`</span><span class="id"> f</span><span class="id"> @^-1`</span><span class="id"> `[x%:E,</span><span class="id"> +oo[</span>)<span class="id"> `|`</span> (<span class="id">D</span><span class="id"> `&amp;`</span><span class="id"> g</span><span class="id"> @^-1`</span><span class="id"> `[x%:E,</span><span class="id"> +oo[</span>))<span class="id">;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> predeqE</span><span class="id"> =&gt;</span><span class="id"> t</span><span class="id"> /=;</span><span class="id"> split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> !/=</span><span class="id"> /=</span><span class="id"> !in_itv</span><span class="id"> /=</span><span class="id"> !andbT</span><span class="id"> le_max</span><span class="id"> =&gt;</span><span class="id"> -[Dx</span><span class="id"> /orP[|]];</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">tauto</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> [|];</span><span class="id"> rewrite</span><span class="id"> !/=</span><span class="id"> /=</span><span class="id"> !in_itv/=</span><span class="id"> !andbT</span><span class="id"> le_max;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> [Dx</span><span class="id"> -&gt;]//;</span><span class="id"> rewrite</span><span class="id"> orbT</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> measurableU;</span><span class="id"> [exact/mf/emeasurable_itv|</span><span class="id"> exact/mg/emeasurable_itv]</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> measurable_funepos</span><span class="id"> D</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">measurable_fun</span><span class="id"> D</span><span class="id"> f</span><span class="id"> -&gt;</span><span class="id"> measurable_fun</span><span class="id"> D</span><span class="id"> f^\+</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> mf;</span><span class="id"> exact:</span><span class="id"> measurable_maxe</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> measurable_funeneg</span><span class="id"> D</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">measurable_fun</span><span class="id"> D</span><span class="id"> f</span><span class="id"> -&gt;</span><span class="id"> measurable_fun</span><span class="id"> D</span><span class="id"> f^\-</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> mf;</span><span class="id"> apply:</span><span class="id"> measurable_maxe</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> measurableT_comp</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> measurable_mine</span><span class="id"> D</span> (<span class="id">f</span><span class="id"> g</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">measurable_fun</span><span class="id"> D</span><span class="id"> f</span><span class="id"> -&gt;</span><span class="id"> measurable_fun</span><span class="id"> D</span><span class="id"> g</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">measurable_fun</span><span class="id"> D</span> (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> mine</span> (<span class="id">f</span><span class="id"> x</span>) (<span class="id">g</span><span class="id"> x</span>)).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> mf</span><span class="id"> mg;</span><span class="id"> rewrite</span> (_<span class="id"> :</span> (<span class="gallina-kwd">fun</span><span class="id"> _</span><span class="id"> =&gt;</span><span class="id"> _</span>)<span class="id"> =</span> (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> -</span><span class="id"> maxe</span> (<span class="id">-</span><span class="id"> f</span><span class="id"> x</span>) (<span class="id">-</span><span class="id"> g</span><span class="id"> x</span>))).<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> measurableT_comp</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> measurable_maxe;</span><span class="id"> exact:</span><span class="id"> measurableT_comp</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> funeqE</span><span class="id"> =&gt;</span><span class="id"> x;</span><span class="id"> rewrite</span><span class="id"> oppe_max</span><span class="id"> !oppeK</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> measurable_fun_limn_esup</span><span class="id"> D</span> (<span class="id">f</span><span class="id"> :</span> (<span class="id">T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id">^nat</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">forall</span><span class="id"> n,</span><span class="id"> measurable_fun</span><span class="id"> D</span> (<span class="id">f</span><span class="id"> n</span>))<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">measurable_fun</span><span class="id"> D</span> (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> limn_esup</span> (<span class="id">f</span><span class="id"> ^~</span><span class="id"> x</span>)).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> mf</span><span class="id"> mD;</span><span class="id"> rewrite</span> (_<span class="id"> :</span>  (<span class="gallina-kwd">fun</span><span class="id"> _</span><span class="id"> =&gt;</span><span class="id"> _</span>)<span class="id"> =</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> ereal_inf</span><span class="id"> [set</span><span class="id"> esups</span> (<span class="id">f^~</span><span class="id"> x</span>)<span class="id"> n</span><span class="id"> |</span><span class="id"> n</span><span class="gallina-kwd"> in</span><span class="id"> [set</span><span class="id"> n</span><span class="id"> |</span><span class="id"> n</span><span class="id"> &gt;=</span><span class="id"> 0]%N]</span>)).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> measurable_fun_einfs</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> k;</span><span class="id"> exact:</span><span class="id"> measurable_fun_esups</span>.<br/>
<span class="id">rewrite</span><span class="id"> funeqE</span><span class="id"> =&gt;</span><span class="id"> t;</span><span class="id"> rewrite</span><span class="id"> limn_esup_lim;</span><span class="id"> apply/cvg_lim</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
<span class="id">rewrite</span><span class="id"> [X</span><span class="gallina-kwd"> in</span><span class="id"> _</span><span class="id"> --&gt;</span><span class="id"> X]</span>(_<span class="id"> :</span><span class="id"> _</span><span class="id"> =</span><span class="id"> ereal_inf</span> (<span class="id">range</span> (<span class="id">esups</span> (<span class="id">f^~t</span>)))).<br/>
&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> cvg_esups_inf</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> congr</span> (<span class="id">ereal_inf</span><span class="id"> [set</span><span class="id"> _</span><span class="id"> |</span><span class="id"> _</span><span class="gallina-kwd"> in</span><span class="id"> _]</span>)<span class="id">;</span><span class="id"> rewrite</span><span class="id"> predeqE</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> emeasurable_fun_cvg</span><span class="id"> D</span> (<span class="id">f_</span><span class="id"> :</span> (<span class="id">T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id">^nat</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">forall</span><span class="id"> m,</span><span class="id"> measurable_fun</span><span class="id"> D</span> (<span class="id">f_</span><span class="id"> m</span>))<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">forall</span><span class="id"> x,</span><span class="id"> D</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> f_</span><span class="id"> ^~</span><span class="id"> x</span><span class="id"> @</span><span class="id"> \oo</span><span class="id"> --&gt;</span><span class="id"> f</span><span class="id"> x</span>)<span class="id"> -&gt;</span><span class="id"> measurable_fun</span><span class="id"> D</span><span class="id"> f</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> mf_</span><span class="id"> f_f;</span><span class="id"> have</span><span class="id"> fE</span><span class="id"> x</span><span class="id"> :</span><span class="id"> D</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> f</span><span class="id"> x</span><span class="id"> =</span><span class="id"> limn_esup</span> (<span class="id">f_^~</span><span class="id"> x</span>).<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> limn_esup_lim</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> Dx;</span><span class="id"> have</span><span class="id"> /cvg_lim</span> <span class="id"> &lt;-//</span><span class="id"> :=</span><span class="id"> @cvg_esups</span><span class="id"> _</span> (<span class="id">f_^~x</span>) (<span class="id">f</span><span class="id"> x</span>) (<span class="id">f_f</span><span class="id"> x</span><span class="id"> Dx</span>).<br/>
<span class="id">apply:</span> (<span class="id">eq_measurable_fun</span> (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> limn_esup</span> (<span class="id">f_</span><span class="id"> ^~</span><span class="id"> x</span>)))<span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> x;</span><span class="id"> rewrite</span><span class="id"> inE</span><span class="id"> =&gt;</span><span class="id"> Dx;</span><span class="id"> rewrite</span><span class="id"> fE</span>.<br/>
<span class="id">exact:</span><span class="id"> measurable_fun_limn_esup</span>.<br/>
Qed.</div></details>
<span class="vernacular">End</span><span class="id"> emeasurable_fun</span>.<br/>
<span class="vernacular">Arguments</span><span class="id"> emeasurable_fun_cvg</span><span class="id"> {d</span><span class="id"> T</span><span class="id"> R</span><span class="id"> D}</span><span class="id"> f_</span>.<br/>
<br/>
<span class="id">#[deprecated</span>(<span class="id">since=</span><span class="id">&quot;mathcomp-analysis 0.6.3&quot;</span><span class="id">,</span><span class="id"> note=</span><span class="id">&quot;use `measurableT_comp` instead&quot;</span>)<span class="id">]</span><br/>
<span class="vernacular">Notation</span><span class="id"> emeasurable_funN</span><span class="id"> :=</span><span class="id"> measurableT_comp</span> (<span class="id">only</span><span class="id"> parsing</span>).<br/>
<span class="id">#[deprecated</span>(<span class="id">since=</span><span class="id">&quot;mathcomp-analysis 0.6.3&quot;</span><span class="id">,</span><span class="id"> note=</span><span class="id">&quot;use `measurable_maxe` instead&quot;</span>)<span class="id">]</span><br/>
<span class="vernacular">Notation</span><span class="id"> emeasurable_fun_max</span><span class="id"> :=</span><span class="id"> measurable_maxe</span> (<span class="id">only</span><span class="id"> parsing</span>).<br/>
<span class="id">#[deprecated</span>(<span class="id">since=</span><span class="id">&quot;mathcomp-analysis 0.6.3&quot;</span><span class="id">,</span><span class="id"> note=</span><span class="id">&quot;use `measurable_mine` instead&quot;</span>)<span class="id">]</span><br/>
<span class="vernacular">Notation</span><span class="id"> emeasurable_fun_min</span><span class="id"> :=</span><span class="id"> measurable_mine</span> (<span class="id">only</span><span class="id"> parsing</span>).<br/>
<span class="id">#[deprecated</span>(<span class="id">since=</span><span class="id">&quot;mathcomp-analysis 0.6.3&quot;</span><span class="id">,</span><span class="id"> note=</span><span class="id">&quot;use `measurable_funepos` instead&quot;</span>)<span class="id">]</span><br/>
<span class="vernacular">Notation</span><span class="id"> emeasurable_fun_funepos</span><span class="id"> :=</span><span class="id"> measurable_funepos</span> (<span class="id">only</span><span class="id"> parsing</span>).<br/>
<span class="id">#[deprecated</span>(<span class="id">since=</span><span class="id">&quot;mathcomp-analysis 0.6.3&quot;</span><span class="id">,</span><span class="id"> note=</span><span class="id">&quot;use `measurable_funeneg` instead&quot;</span>)<span class="id">]</span><br/>
<span class="vernacular">Notation</span><span class="id"> emeasurable_fun_funeneg</span><span class="id"> :=</span><span class="id"> measurable_funeneg</span> (<span class="id">only</span><span class="id"> parsing</span>).<br/>
<span class="id">#[deprecated</span>(<span class="id">since=</span><span class="id">&quot;mathcomp-analysis 0.6.6&quot;</span><span class="id">,</span><span class="id"> note=</span><span class="id">&quot;renamed `measurable_fun_limn_esup`&quot;</span>)<span class="id">]</span><br/>
<span class="vernacular">Notation</span><span class="id"> measurable_fun_lim_esup</span><span class="id"> :=</span><span class="id"> measurable_fun_limn_esup</span> (<span class="id">only</span><span class="id"> parsing</span>).<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> open_itv_cover</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {R</span><span class="id"> :</span><span class="id"> realType}</span>.<br/>
<span class="vernacular">Implicit</span><span class="id"> Types</span> (<span class="id">A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> R</span>).<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<br/>
<span class="vernacular">Let</span><span class="id"> l</span><span class="id"> :=</span> (<span class="id">@wlength</span><span class="id"> R</span><span class="id"> idfun</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> outer_measure_open_itv_cover</span><span class="id"> A</span><span class="id"> :</span> (<span class="id">l^*</span><span class="id"> A</span>)<span class="id">%mu</span><span class="id"> =</span><br/>
&nbsp;&nbsp;<span class="id">ereal_inf</span><span class="id"> [set</span><span class="id"> \sum_</span>(<span class="id">k</span><span class="id"> &lt;oo</span>)<span class="id"> l</span> (<span class="id">F</span><span class="id"> k</span>)<span class="id"> |</span><span class="id"> F</span><span class="gallina-kwd"> in</span><span class="id"> open_itv_cover</span><span class="id"> A]</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">apply/eqP;</span><span class="id"> rewrite</span><span class="id"> eq_le;</span><span class="id"> apply/andP;</span><span class="id"> split</span>.<br/>
<span class="id">-</span><span class="id"> apply:</span><span class="id"> le_ereal_inf</span><span class="id"> =&gt;</span><span class="id"> _</span><span class="id"> /=</span><span class="id"> [F</span><span class="id"> [Fitv</span><span class="id"> AF</span><span class="id"> &lt;-]]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">exists</span> (<span class="gallina-kwd">fun</span><span class="id"> i</span><span class="id"> =&gt;</span><span class="id"> `]</span>(<span class="id">sval</span> (<span class="id">cid</span> (<span class="id">Fitv</span><span class="id"> i</span>))).<span class="id">1,</span> (<span class="id">sval</span> (<span class="id">cid</span> (<span class="id">Fitv</span><span class="id"> i</span>))).<span class="id">2]%classic</span>).<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="id"> split=&gt;</span><span class="id"> [i|]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">*</span><span class="id"> have</span><span class="id"> [?|?]</span><span class="id"> :=</span><span class="id"> ltP</span> (<span class="id">sval</span> (<span class="id">cid</span> (<span class="id">Fitv</span><span class="id"> i</span>))).<span class="id">1</span> (<span class="id">sval</span> (<span class="id">cid</span> (<span class="id">Fitv</span><span class="id"> i</span>))).<span class="id">2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> apply/ocitvP;</span><span class="id"> right;</span><span class="gallina-kwd"> exists</span> (<span class="id">sval</span> (<span class="id">cid</span> (<span class="id">Fitv</span><span class="id"> i</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> apply/ocitvP;</span><span class="id"> left;</span><span class="id"> rewrite</span><span class="id"> set_itv_ge//</span><span class="id"> -leNgt</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">*</span><span class="id"> apply:</span> (<span class="id">subset_trans</span><span class="id"> AF</span>)<span class="id"> =&gt;</span><span class="id"> r</span><span class="id"> /=</span><span class="id"> [n</span><span class="id"> _</span><span class="id"> Fnr];</span><span class="gallina-kwd"> exists</span><span class="id"> n</span><span class="id"> =&gt;</span><span class="id"> //=</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">have</span><span class="id"> :=</span><span class="id"> Fitv</span><span class="id"> n;</span><span class="id"> move:</span><span class="id"> Fnr;</span><span class="id"> case:</span><span class="id"> cid</span><span class="id"> =&gt;</span><span class="id"> -[x</span><span class="id"> y]/=</span><span class="id"> -&gt;/=</span><span class="id"> +</span><span class="id"> _</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> subset_itv_oo_oc</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="id"> apply:</span><span class="id"> eq_eseriesr</span><span class="id"> =&gt;</span><span class="id"> k</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> /l</span><span class="id"> wlength_itv/=</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">case:</span> (<span class="id">Fitv</span><span class="id"> k</span>)<span class="id"> =&gt;</span><span class="id"> /=</span><span class="id"> -[a</span><span class="id"> b]/=</span><span class="id"> Fkab</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> case:</span><span class="id"> cid</span><span class="id"> =&gt;</span><span class="id"> /=</span><span class="id"> -[x1</span><span class="id"> x2]</span><span class="id"> -&gt;;</span><span class="id"> rewrite</span><span class="id"> wlength_itv</span>.<br/>
<span class="id">-</span><span class="id"> have</span><span class="id"> [/lb_ereal_inf_adherent</span><span class="id"> lA|]</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">boolP</span> ((<span class="id">l^*</span><span class="id"> A</span>)<span class="id">%mu</span><span class="id"> \is</span><span class="id"> a</span><span class="id"> fin_num</span>)<span class="id">;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> ge0_fin_numE</span><span class="id"> ?outer_measure_ge0//</span><span class="id"> -leNgt</span><span class="id"> leye_eq</span><span class="id"> =&gt;</span><span class="id"> /eqP</span><span class="id"> -&gt;</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> leey</span>.<br/>
&nbsp;&nbsp;<span class="id">apply/lee_addgt0Pr</span><span class="id"> =&gt;</span><span class="id"> /=</span><span class="id"> e</span><span class="id"> e0</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> :</span> (<span class="id">0</span><span class="id"> &lt;</span><span class="id"> e</span><span class="id"> /</span><span class="id"> 2</span>)<span class="id">%R</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> divr_gt0</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> /lA[_</span><span class="id"> [/=</span><span class="id"> F</span><span class="id"> [mF</span><span class="id"> AF]]</span><span class="id"> &lt;-];</span><span class="id"> rewrite</span><span class="id"> -/</span>((<span class="id">l^*</span><span class="id"> A</span>)<span class="id">%mu</span>)<span class="id"> =&gt;</span><span class="id"> lFe</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> Fcover</span><span class="id"> n</span><span class="id"> :</span><span class="gallina-kwd"> exists2</span><span class="id"> B,</span><span class="id"> F</span><span class="id"> n</span><span class="id"> `&lt;=`</span><span class="id"> B</span><span class="id"> &amp;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">is_open_itv</span><span class="id"> B</span><span class="id"> /\</span><span class="id"> l</span><span class="id"> B</span><span class="id"> &lt;=</span><span class="id"> l</span> (<span class="id">F</span><span class="id"> n</span>)<span class="id"> +</span> (<span class="id">e</span><span class="id"> /</span><span class="id"> 2</span><span class="id"> ^+</span><span class="id"> n</span>.<span class="id">+2</span>)<span class="id">%:E</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">have</span><span class="id"> [[a</span><span class="id"> b]</span><span class="id"> _</span><span class="id"> /=</span><span class="id"> abFn]</span><span class="id"> :=</span><span class="id"> mF</span><span class="id"> n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">exists</span><span class="id"> `]a,</span><span class="id"> b</span><span class="id"> +</span><span class="id"> e</span><span class="id"> /</span><span class="id"> 2^+n</span>.<span class="id">+2[%classic</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -abFn</span><span class="id"> =&gt;</span><span class="id"> x/=</span><span class="id"> /[!in_itv]</span><span class="id"> /andP[-&gt;/=]</span><span class="id"> /le_lt_trans;</span><span class="id"> apply</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> ltrDl</span><span class="id"> divr_gt0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="gallina-kwd"> exists</span> (<span class="id">a,</span><span class="id"> b</span><span class="id"> +</span><span class="id"> e</span><span class="id"> /</span><span class="id"> 2^+n</span>.<span class="id">+2</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">have</span><span class="id"> [ab|ba]</span><span class="id"> :=</span><span class="id"> ltP</span><span class="id"> a</span><span class="id"> b</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> /l</span><span class="id"> -abFn</span><span class="id"> !wlength_itv//=</span><span class="id"> !lte_fin</span><span class="id"> ifT</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> ab</span><span class="id"> -!EFinD</span><span class="id"> lee_fin</span><span class="id"> addrAC</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> ltr_wpDr//</span><span class="id"> divr_ge0//</span><span class="id"> ltW</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -abFn</span><span class="id"> [in</span><span class="id"> leRHS]set_itv_ge</span><span class="id"> ?bnd_simp</span><span class="id"> -?leNgt//</span><span class="id"> /l</span><span class="id"> wlength0</span><span class="id"> add0r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> wlength_itv//=;</span><span class="id"> case:</span><span class="id"> ifPn</span><span class="id"> =&gt;</span><span class="id"> [abe|_];</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> lee_fin</span><span class="id"> divr_ge0//</span><span class="id"> ltW</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -EFinD</span><span class="id"> addrAC</span><span class="id"> lee_fin</span><span class="id"> -[leRHS]add0r</span><span class="id"> lerD2r</span><span class="id"> subr_le0</span>.<br/>
&nbsp;&nbsp;<span class="id">pose</span><span class="id"> G</span><span class="id"> :=</span><span class="gallina-kwd"> fun</span><span class="id"> n</span><span class="id"> =&gt;</span><span class="id"> sval</span> (<span class="id">cid2</span> (<span class="id">Fcover</span><span class="id"> n</span>)).<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> FG</span><span class="id"> n</span><span class="id"> :</span><span class="id"> F</span><span class="id"> n</span><span class="id"> `&lt;=`</span><span class="id"> G</span><span class="id"> n</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> /G;</span><span class="id"> case:</span><span class="id"> cid2</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> Gitv</span><span class="id"> n</span><span class="id"> :</span><span class="id"> is_open_itv</span> (<span class="id">G</span><span class="id"> n</span>)<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> /G;</span><span class="id"> case:</span><span class="id"> cid2</span><span class="id"> =&gt;</span><span class="id"> ?</span><span class="id"> ?</span><span class="id"> []</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> lGFe</span><span class="id"> n</span><span class="id"> :</span><span class="id"> l</span> (<span class="id">G</span><span class="id"> n</span>)<span class="id"> &lt;=</span><span class="id"> l</span> (<span class="id">F</span><span class="id"> n</span>)<span class="id"> +</span> (<span class="id">e</span><span class="id"> /</span><span class="id"> 2</span><span class="id"> ^+</span><span class="id"> n</span>.<span class="id">+2</span>)<span class="id">%:E</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /G;</span><span class="id"> case:</span><span class="id"> cid2</span><span class="id"> =&gt;</span><span class="id"> ?</span><span class="id"> ?</span><span class="id"> []</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> AG</span><span class="id"> :</span><span class="id"> A</span><span class="id"> `&lt;=`</span><span class="id"> \bigcup_k</span><span class="id"> G</span><span class="id"> k</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span> (<span class="id">subset_trans</span><span class="id"> AF</span>)<span class="id"> =&gt;</span><span class="id"> [/=</span><span class="id"> r</span><span class="id"> [n</span><span class="id"> _</span><span class="id"> /FG</span><span class="id"> Gnr]];</span><span class="gallina-kwd"> exists</span><span class="id"> n</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span> (<span class="id">@le_trans</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">\sum_</span>(<span class="id">0</span><span class="id"> &lt;=</span><span class="id"> k</span><span class="id"> &lt;oo</span>) (<span class="id">l</span> (<span class="id">F</span><span class="id"> k</span>)<span class="id"> +</span> (<span class="id">e</span><span class="id"> /</span><span class="id"> 2</span><span class="id"> ^+</span><span class="id"> k</span>.<span class="id">+2</span>)<span class="id">%:E</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span> (<span class="id">@le_trans</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">\sum_</span>(<span class="id">0</span><span class="id"> &lt;=</span><span class="id"> k</span><span class="id"> &lt;oo</span>)<span class="id"> l</span> (<span class="id">G</span><span class="id"> k</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> ereal_inf_lbound</span><span class="id"> =&gt;</span><span class="id"> /=;</span><span class="gallina-kwd"> exists</span><span class="id"> G</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> lee_nneseries</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> nneseriesD//;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> i</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> lee_fin//</span><span class="id"> divr_ge0//</span><span class="id"> ltW</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> [in</span><span class="id"> leRHS]</span>(<span class="id">splitr</span><span class="id"> e</span>)<span class="id"> EFinD</span><span class="id"> addeA</span><span class="id"> leeD//;</span><span class="id"> first</span><span class="id"> exact/ltW</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> :=</span><span class="id"> @cvg_geometric_eseries_half</span><span class="id"> R</span><span class="id"> e</span><span class="id"> 1;</span><span class="id"> rewrite</span><span class="id"> expr1</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> [X</span><span class="gallina-kwd"> in</span><span class="id"> eseries</span><span class="id"> X]</span>(_<span class="id"> :</span><span class="id"> _</span><span class="id"> =</span> (<span class="gallina-kwd">fun</span><span class="id"> k</span><span class="id"> =&gt;</span> (<span class="id">e</span><span class="id"> /</span> (<span class="id">2</span><span class="id"> ^+</span> (<span class="id">k</span>.<span class="id">+2</span>))<span class="id">%:R</span>)<span class="id">%:E</span>))<span class="id">;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply/funext</span><span class="id"> =&gt;</span><span class="id"> n;</span><span class="id"> rewrite</span><span class="id"> addn2</span><span class="id"> natrX</span>.<br/>
&nbsp;&nbsp;<span class="id">move/cvg_lim</span><span class="id"> =&gt;</span><span class="id"> &lt;-//;</span><span class="id"> apply:</span><span class="id"> lee_nneseries</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> n</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> lee_fin</span><span class="id"> divr_ge0//</span><span class="id"> ltW</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> n</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> lee_fin</span><span class="id"> -natrX</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> open_itv_cover</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> egorov</span>.<br/>
<span class="vernacular">Context</span><span class="id"> d</span><span class="id"> {R</span><span class="id"> :</span><span class="id"> realType}</span><span class="id"> {T</span><span class="id"> :</span><span class="id"> measurableType</span><span class="id"> d}</span>.<br/>
<span class="vernacular">Context</span> (<span class="id">mu</span><span class="id"> :</span><span class="id"> {measure</span><span class="id"> set</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R}</span>).<br/>
<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> pointwise_almost_uniform</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">f</span><span class="id"> :</span> (<span class="id">T</span><span class="id"> -&gt;</span><span class="id"> R</span>)<span class="id">^nat</span>) (<span class="id">g</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> R</span>) (<span class="id">A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T</span>) (<span class="id">eps</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">forall</span><span class="id"> n,</span><span class="id"> measurable_fun</span><span class="id"> A</span> (<span class="id">f</span><span class="id"> n</span>))<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">measurable</span><span class="id"> A</span><span class="id"> -&gt;</span><span class="id"> mu</span><span class="id"> A</span><span class="id"> &lt;</span><span class="id"> +oo</span><span class="id"> -&gt;</span> (<span class="gallina-kwd">forall</span><span class="id"> x,</span><span class="id"> A</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> f</span><span class="id"> ^~</span><span class="id"> x</span><span class="id"> @</span><span class="id"> \oo</span><span class="id"> --&gt;</span><span class="id"> g</span><span class="id"> x</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;(<span class="id">0</span><span class="id"> &lt;</span><span class="id"> eps</span>)<span class="id">%R</span><span class="id"> -&gt;</span><span class="gallina-kwd"> exists</span><span class="id"> B,</span><span class="id"> [/\</span><span class="id"> measurable</span><span class="id"> B,</span><span class="id"> mu</span><span class="id"> B</span><span class="id"> &lt;</span><span class="id"> eps%:E</span><span class="id"> &amp;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">{uniform</span><span class="id"> A</span><span class="id"> `\`</span><span class="id"> B,</span><span class="id"> f</span><span class="id"> @</span><span class="id"> \oo</span><span class="id"> --&gt;</span><span class="id"> g}]</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> mf</span><span class="id"> mA</span><span class="id"> finA</span><span class="id"> fptwsg</span><span class="id"> epspos;</span><span class="id"> pose</span><span class="id"> h</span><span class="id"> q</span> (<span class="id">z</span><span class="id"> :</span><span class="id"> T</span>)<span class="id"> :</span><span class="id"> R</span><span class="id"> :=</span><span class="id"> `|f</span><span class="id"> q</span><span class="id"> z</span><span class="id"> -</span><span class="id"> g</span><span class="id"> z|%R</span>.<br/>
<span class="id">have</span><span class="id"> mfunh</span><span class="id"> q</span><span class="id"> :</span><span class="id"> measurable_fun</span><span class="id"> A</span> (<span class="id">h</span><span class="id"> q</span>).<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> measurableT_comp</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> apply:</span><span class="id"> measurable_funB</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> measurable_fun_cvg</span>.<br/>
<span class="id">pose</span><span class="id"> E</span><span class="id"> k</span><span class="id"> n</span><span class="id"> :=</span><span class="id"> \bigcup_</span>(<span class="id">i</span><span class="id"> &gt;=</span><span class="id"> n</span>) (<span class="id">A</span><span class="id"> `&amp;`</span><span class="id"> [set</span><span class="id"> x</span><span class="id"> |</span><span class="id"> h</span><span class="id"> i</span><span class="id"> x</span><span class="id"> &gt;=</span><span class="id"> k</span>.<span class="id">+1%:R^-1]%R</span>).<br/>
<span class="id">have</span><span class="id"> Einc</span><span class="id"> k</span><span class="id"> :</span><span class="id"> nonincreasing_seq</span> (<span class="id">E</span><span class="id"> k</span>).<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> n</span><span class="id"> m</span><span class="id"> nm;</span><span class="id"> apply/asboolP</span><span class="id"> =&gt;</span><span class="id"> z</span><span class="id"> [i]</span><span class="id"> /=</span><span class="id"> /</span>(<span class="id">leq_trans</span><span class="id"> _</span>)<span class="id"> mi</span><span class="id"> [?</span><span class="id"> ?]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="gallina-kwd"> exists</span><span class="id"> i</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> mi</span>.<br/>
<span class="id">have</span><span class="id"> mE</span><span class="id"> k</span><span class="id"> n</span><span class="id"> :</span><span class="id"> measurable</span> (<span class="id">E</span><span class="id"> k</span><span class="id"> n</span>).<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> bigcup_measurable</span><span class="id"> =&gt;</span><span class="id"> q</span><span class="id"> /=</span><span class="id"> ?</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> -&gt;</span><span class="id"> :</span><span class="id"> [set</span><span class="id"> x</span><span class="id"> |</span><span class="id"> h</span><span class="id"> q</span><span class="id"> x</span><span class="id"> &gt;=</span><span class="id"> k</span>.<span class="id">+1%:R^-1]%R</span><span class="id"> =</span><span class="id"> h</span><span class="id"> q</span><span class="id"> @^-1`</span><span class="id"> `[k</span>.<span class="id">+1%:R^-1,</span><span class="id"> +oo[</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> eqEsubset;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> z;</span><span class="id"> rewrite</span><span class="id"> /=</span><span class="id"> in_itv</span><span class="id"> /=</span><span class="id"> andbT</span>.<br/>
&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> mfunh</span>.<br/>
<span class="id">have</span><span class="id"> nEcvg</span><span class="id"> x</span><span class="id"> k</span><span class="id"> :</span><span class="gallina-kwd"> exists</span><span class="id"> n,</span><span class="id"> A</span><span class="id"> x</span><span class="id"> -&gt;</span> (<span class="id">~`</span><span class="id"> E</span><span class="id"> k</span><span class="id"> n</span>)<span class="id"> x</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> [Ax|?]</span><span class="id"> :=</span><span class="id"> pselect</span> (<span class="id">A</span><span class="id"> x</span>)<span class="id">;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="gallina-kwd"> exists</span><span class="id"> point</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> []</span><span class="id"> :=</span><span class="id"> fptwsg</span><span class="id"> _</span><span class="id"> Ax</span> (<span class="id">interior</span> (<span class="id">ball</span> (<span class="id">g</span><span class="id"> x</span>)<span class="id"> k</span>.<span class="id">+1%:R^-1</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> open_nbhs_nbhs;</span><span class="id"> split;</span><span class="id"> [exact:</span><span class="id"> open_interior|exact:</span><span class="id"> nbhsx_ballx]</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> N</span><span class="id"> _</span><span class="id"> Nk;</span><span class="gallina-kwd"> exists</span><span class="id"> N</span>.<span class="id">+1</span><span class="id"> =&gt;</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> /E</span><span class="id"> setC_bigcup</span><span class="id"> =&gt;</span><span class="id"> i</span><span class="id"> /=</span><span class="id"> /ltnW</span><span class="id"> Ni</span>.<br/>
&nbsp;&nbsp;<span class="id">apply/not_andP;</span><span class="id"> right;</span><span class="id"> apply/negP;</span><span class="id"> rewrite</span><span class="id"> /h</span><span class="id"> -real_ltNge</span><span class="id"> //</span><span class="id"> distrC</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> case:</span> (<span class="id">Nk</span><span class="id"> _</span><span class="id"> Ni</span>)<span class="id"> =&gt;</span><span class="id"> _/posnumP[?];</span><span class="id"> apply;</span><span class="id"> exact:</span><span class="id"> ball_norm_center</span>.<br/>
<span class="id">have</span><span class="id"> Ek0</span><span class="id"> k</span><span class="id"> :</span><span class="id"> \bigcap_n</span> (<span class="id">E</span><span class="id"> k</span><span class="id"> n</span>)<span class="id"> =</span><span class="id"> set0</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> eqEsubset;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> z</span><span class="id"> /=;</span><span class="id"> suff</span><span class="id"> :</span> (<span class="id">~`</span><span class="id"> \bigcap_n</span><span class="id"> E</span><span class="id"> k</span><span class="id"> n</span>)<span class="id"> z</span><span class="gallina-kwd"> by</span><span class="id"> []</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> setC_bigcap;</span><span class="id"> have</span><span class="id"> [Az</span><span class="id"> |</span><span class="id"> nAz]</span><span class="id"> :=</span><span class="id"> pselect</span> (<span class="id">A</span><span class="id"> z</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> have</span><span class="id"> [N</span><span class="id"> /</span>(_<span class="id"> Az</span>)<span class="id"> ?]</span><span class="id"> :=</span><span class="id"> nEcvg</span><span class="id"> z</span><span class="id"> k;</span><span class="gallina-kwd"> exists</span><span class="id"> N</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="gallina-kwd"> exists</span><span class="id"> 0%N</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> rewrite</span><span class="id"> setC_bigcup</span><span class="id"> =&gt;</span><span class="id"> n</span><span class="id"> _</span><span class="id"> []</span>.<br/>
<span class="id">have</span><span class="id"> badn'</span><span class="id"> k</span><span class="id"> :</span><span class="gallina-kwd"> exists</span><span class="id"> n,</span><span class="id"> mu</span> (<span class="id">E</span><span class="id"> k</span><span class="id"> n</span>)<span class="id"> &lt;</span> ((<span class="id">eps</span><span class="id"> /</span><span class="id"> 2</span>)<span class="id"> /</span> (<span class="id">2</span><span class="id"> ^</span><span class="id"> k</span>.<span class="id">+1</span>)<span class="id">%:R</span>)<span class="id">%:E</span>.<br/>
&nbsp;&nbsp;<span class="id">pose</span><span class="id"> ek</span><span class="id"> :</span><span class="id"> R</span><span class="id"> :=</span><span class="id"> eps</span><span class="id"> /</span><span class="id"> 2</span><span class="id"> /</span> (<span class="id">2</span><span class="id"> ^</span><span class="id"> k</span>.<span class="id">+1</span>)<span class="id">%:R</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> :</span><span class="id"> mu</span><span class="id"> \o</span><span class="id"> E</span><span class="id"> k</span><span class="id"> @</span><span class="id"> \oo</span><span class="id"> --&gt;</span><span class="id"> mu</span><span class="id"> set0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -</span>(<span class="id">Ek0</span><span class="id"> k</span>)<span class="id">;</span><span class="id"> apply:</span><span class="id"> nonincreasing_cvg_mu</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span> (<span class="id">le_lt_trans</span><span class="id"> _</span><span class="id"> finA</span>)<span class="id">//</span><span class="id"> le_measure//</span><span class="id"> ?inE//</span><span class="id"> =&gt;</span><span class="id"> ?</span><span class="id"> [?</span><span class="id"> _</span><span class="id"> []]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="id"> exact:</span><span class="id"> bigcap_measurable</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> measure0;</span><span class="id"> case/fine_cvg/</span>(_ (<span class="id">interior</span> (<span class="id">ball</span><span class="id"> 0%R</span><span class="id"> ek</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply/open_nbhs_nbhs/</span>(<span class="id">open_nbhs_ball</span><span class="id"> _</span> (<span class="id">@PosNum</span><span class="id"> _</span><span class="id"> ek</span><span class="id"> _</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> !divr_gt0</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> N</span><span class="id"> _</span><span class="id"> /</span>(_<span class="id"> N</span> (<span class="id">leqnn</span><span class="id"> _</span>))<span class="id">/interior_subset</span><span class="id"> muEN;</span><span class="gallina-kwd"> exists</span><span class="id"> N;</span><span class="id"> move:</span><span class="id"> muEN</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> /ball</span><span class="id"> /=</span><span class="id"> distrC</span><span class="id"> subr0</span><span class="id"> ger0_norm</span><span class="id"> //</span><span class="id"> -[x</span><span class="gallina-kwd"> in</span><span class="id"> x</span><span class="id"> &lt;</span><span class="id"> _]fineK</span><span class="id"> ?ge0_fin_numE//</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span> (<span class="id">le_lt_trans</span><span class="id"> _</span><span class="id"> finA</span>)<span class="id">//</span><span class="id"> le_measure//</span><span class="id"> ?inE//</span><span class="id"> =&gt;</span><span class="id"> ?</span><span class="id"> [?</span><span class="id"> _</span><span class="id"> []]</span>.<br/>
<span class="id">pose</span><span class="id"> badn</span><span class="id"> k</span><span class="id"> :=</span><span class="id"> projT1</span> (<span class="id">cid</span> (<span class="id">badn'</span><span class="id"> k</span>))<span class="id">;</span><span class="gallina-kwd"> exists</span> (<span class="id">\bigcup_k</span><span class="id"> E</span><span class="id"> k</span> (<span class="id">badn</span><span class="id"> k</span>))<span class="id">;</span><span class="id"> split</span>.<br/>
<span class="id">-</span><span class="id"> exact:</span><span class="id"> bigcup_measurable</span>.<br/>
<span class="id">-</span><span class="id"> apply:</span> (<span class="id">@le_lt_trans</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">eps</span><span class="id"> /</span><span class="id"> 2</span>)<span class="id">%:E</span>)<span class="id">;</span><span class="id"> first</span><span class="id"> last</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> lte_fin</span><span class="id"> ltr_pdivrMr</span><span class="id"> //</span><span class="id"> ltr_pMr</span><span class="id"> //</span><span class="id"> Rint_ltr_addr1</span><span class="id"> //</span><span class="id"> Rint1</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> le_trans</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span> (<span class="id">measure_sigma_subadditive</span><span class="id"> _</span> (<span class="gallina-kwd">fun</span><span class="id"> k</span><span class="id"> =&gt;</span><span class="id"> mE</span><span class="id"> k</span> (<span class="id">badn</span><span class="id"> k</span>))<span class="id"> _</span><span class="id"> _</span>)<span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> bigcup_measurable</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> le_trans;</span><span class="id"> first</span><span class="id"> last</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span> (<span class="id">epsilon_trick0</span><span class="id"> xpredT</span>)<span class="id">;</span><span class="id"> rewrite</span><span class="id"> divr_ge0//</span><span class="id"> ltW</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> lee_nneseries</span><span class="id"> //</span><span class="id"> =&gt;</span><span class="id"> n</span><span class="id"> _;</span><span class="id"> exact/ltW/</span>(<span class="id">projT2</span> (<span class="id">cid</span> (<span class="id">badn'</span><span class="id"> _</span>))).<br/>
<span class="id">apply/uniform_restrict_cvg</span><span class="id"> =&gt;</span><span class="id"> /=</span><span class="id"> U</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> !uniform_nbhsT</span>.<br/>
<span class="id">case/nbhs_ex</span><span class="id"> =&gt;</span><span class="id"> del</span><span class="id"> /=</span><span class="id"> ballU;</span><span class="id"> apply:</span><span class="id"> filterS;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> ?;</span><span class="id"> exact:</span><span class="id"> ballU</span>.<br/>
<span class="id">have</span><span class="id"> [N</span><span class="id"> _</span><span class="id"> /</span>(_<span class="id"> N</span>)<span class="id">/</span>(_ (<span class="id">leqnn</span><span class="id"> _</span>))<span class="id"> Ndel]</span><span class="id"> :=</span><span class="id"> near_infty_natSinv_lt</span><span class="id"> del</span>.<br/>
<span class="gallina-kwd">exists</span> (<span class="id">badn</span><span class="id"> N</span>)<span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> r</span><span class="id"> badNr</span><span class="id"> x</span>.<br/>
<span class="id">rewrite</span><span class="id"> /patch;</span><span class="id"> case:</span><span class="id"> ifPn</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> /set_mem</span><span class="id"> xAB;</span><span class="id"> apply:</span> (<span class="id">lt_trans</span><span class="id"> _</span><span class="id"> Ndel</span>).<br/>
<span class="id">move:</span><span class="id"> xAB;</span><span class="id"> rewrite</span><span class="id"> setDE</span><span class="id"> =&gt;</span><span class="id"> -[Ax];</span><span class="id"> rewrite</span><span class="id"> setC_bigcup</span><span class="id"> =&gt;</span><span class="id"> /</span>(_<span class="id"> N</span><span class="id"> I</span>).<br/>
<span class="id">rewrite</span><span class="id"> /E</span><span class="id"> setC_bigcup</span><span class="id"> =&gt;</span><span class="id"> /</span>(_<span class="id"> r</span>)<span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> /h</span><span class="id"> =&gt;</span><span class="id"> /</span>(_<span class="id"> badNr</span>)<span class="id"> /not_andP[]//</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> move/negP;</span><span class="id"> rewrite</span><span class="id"> ltNge</span><span class="id"> //</span><span class="id"> distrC</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> ae_pointwise_almost_uniform</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">f</span><span class="id"> :</span> (<span class="id">T</span><span class="id"> -&gt;</span><span class="id"> R</span>)<span class="id">^nat</span>) (<span class="id">g</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> R</span>) (<span class="id">A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> T</span>) (<span class="id">eps</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">forall</span><span class="id"> n,</span><span class="id"> measurable_fun</span><span class="id"> A</span> (<span class="id">f</span><span class="id"> n</span>))<span class="id"> -&gt;</span><span class="id"> measurable_fun</span><span class="id"> A</span><span class="id"> g</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">measurable</span><span class="id"> A</span><span class="id"> -&gt;</span><span class="id"> mu</span><span class="id"> A</span><span class="id"> &lt;</span><span class="id"> +oo</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">{ae</span><span class="id"> mu,</span> (<span class="gallina-kwd">forall</span><span class="id"> x,</span><span class="id"> A</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> f</span><span class="id"> ^~</span><span class="id"> x</span><span class="id"> @</span><span class="id"> \oo</span><span class="id"> --&gt;</span><span class="id"> g</span><span class="id"> x</span>)<span class="id">}</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;(<span class="id">0</span><span class="id"> &lt;</span><span class="id"> eps</span>)<span class="id">%R</span><span class="id"> -&gt;</span><span class="gallina-kwd"> exists</span><span class="id"> B,</span><span class="id"> [/\</span><span class="id"> measurable</span><span class="id"> B,</span><span class="id"> mu</span><span class="id"> B</span><span class="id"> &lt;</span><span class="id"> eps%:E</span><span class="id"> &amp;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">{uniform</span><span class="id"> A</span><span class="id"> `\`</span><span class="id"> B,</span><span class="id"> f</span><span class="id"> @</span><span class="id"> \oo</span><span class="id"> --&gt;</span><span class="id"> g}]</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> mf</span><span class="id"> mg</span><span class="id"> mA</span><span class="id"> Afin</span><span class="id"> [C</span><span class="id"> [mC</span><span class="id"> C0</span><span class="id"> nC]</span><span class="id"> epspos]</span>.<br/>
<span class="id">have</span><span class="id"> [B</span><span class="id"> [mB</span><span class="id"> Beps</span><span class="id"> Bunif]]</span><span class="id"> :</span><span class="gallina-kwd"> exists</span><span class="id"> B,</span><span class="id"> [/\</span><span class="id"> d</span>.<span class="id">-measurable</span><span class="id"> B,</span><span class="id"> mu</span><span class="id"> B</span><span class="id"> &lt;</span><span class="id"> eps%:E</span><span class="id"> &amp;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">{uniform</span> (<span class="id">A</span><span class="id"> `\`</span><span class="id"> C</span>)<span class="id"> `\`</span><span class="id"> B,</span> <span class="id"> f</span><span class="id"> @\oo</span><span class="id"> --&gt;</span><span class="id"> g}]</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> pointwise_almost_uniform</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> n;</span><span class="id"> apply</span><span class="id"> :</span> (<span class="id">measurable_funS</span><span class="id"> mA</span><span class="id"> _</span> (<span class="id">mf</span><span class="id"> n</span>))<span class="id"> =&gt;</span><span class="id"> ?</span><span class="id"> []</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> measurableI</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> measurableC</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span> (<span class="id">le_lt_trans</span><span class="id"> _</span><span class="id"> Afin</span>)<span class="id">//</span><span class="id"> le_measure//</span><span class="id"> inE//;</span><span class="id"> exact:</span><span class="id"> measurableD</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> x;</span><span class="id"> rewrite</span><span class="id"> setDE;</span><span class="id"> case</span><span class="id"> =&gt;</span><span class="id"> Ax</span><span class="id"> /</span>(<span class="id">subsetC</span><span class="id"> nC</span>)<span class="id">;</span><span class="id"> rewrite</span><span class="id"> setCK;</span><span class="id"> exact</span>.<br/>
<span class="gallina-kwd">exists</span> (<span class="id">B</span><span class="id"> `|`</span><span class="id"> C</span>)<span class="id">;</span><span class="id"> split</span>.<br/>
<span class="id">-</span><span class="id"> exact:</span><span class="id"> measurableU</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span> (<span class="id">le_lt_trans</span><span class="id"> _</span><span class="id"> Beps</span>)<span class="id">;</span><span class="id"> rewrite</span><span class="id"> measureU0</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> setUC</span><span class="id"> -setDDl</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> egorov</span>.<br/>
<br/>
<span class="vernacular">Module</span><span class="id"> LebesgueMeasure</span>.<br/>
<span class="vernacular">Section</span><span class="id"> hlength</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {R</span><span class="id"> :</span><span class="id"> realType}</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<span class="vernacular">Implicit</span><span class="id"> Types</span><span class="id"> i</span><span class="id"> j</span><span class="id"> :</span><span class="id"> interval</span><span class="id"> R</span>.<br/>
<br/>
<span class="vernacular">Definition</span><span class="id"> hlength</span> (<span class="id">A</span><span class="id"> :</span><span class="id"> set</span> (<span class="id">ocitv_type</span><span class="id"> R</span>))<span class="id"> :</span><span class="id"> \bar</span><span class="id"> R</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">let</span><span class="id"> i</span><span class="id"> :=</span><span class="id"> Rhull</span><span class="id"> A</span><span class="gallina-kwd"> in</span> (<span class="id">i</span>.<span class="id">2</span><span class="id"> :</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id"> -</span><span class="id"> i</span>.<span class="id">1</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> hlength0</span><span class="id"> :</span><span class="id"> hlength</span> (<span class="id">set0</span><span class="id"> :</span><span class="id"> set</span><span class="id"> R</span>)<span class="id"> =</span><span class="id"> 0</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> /hlength</span><span class="id"> Rhull0</span><span class="id"> /=</span><span class="id"> subee</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> hlength_singleton</span> (<span class="id">r</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span><span class="id"> hlength</span><span class="id"> `[r,</span><span class="id"> r]</span><span class="id"> =</span><span class="id"> 0</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> /hlength</span><span class="id"> /=</span><span class="id"> asboolT//</span><span class="id"> sup_itvcc//=</span><span class="id"> asboolT//</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> asboolT</span><span class="id"> inf_itvcc//=</span><span class="id"> ?subee//</span><span class="id"> inE</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> hlength_setT</span><span class="id"> :</span><span class="id"> hlength</span><span class="id"> setT</span><span class="id"> =</span><span class="id"> +oo%E</span><span class="id"> :&gt;</span><span class="id"> \bar</span><span class="id"> R</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> /hlength</span><span class="id"> RhullT</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> hlength_itv</span><span class="id"> i</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">hlength</span><span class="id"> [set`</span><span class="id"> i]</span><span class="id"> =</span><span class="gallina-kwd"> if</span><span class="id"> i</span>.<span class="id">2</span><span class="id"> &gt;</span><span class="id"> i</span>.<span class="id">1</span><span class="gallina-kwd"> then</span> (<span class="id">i</span>.<span class="id">2</span><span class="id"> :</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id"> -</span><span class="id"> i</span>.<span class="id">1</span><span class="gallina-kwd"> else</span><span class="id"> 0</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">case:</span><span class="id"> ltP</span><span class="id"> =&gt;</span><span class="id"> [/lt_ereal_bnd/neitvP</span><span class="id"> i12|];</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> /hlength</span><span class="id"> set_itvK</span>.<br/>
<span class="id">rewrite</span><span class="id"> le_eqVlt</span><span class="id"> =&gt;</span><span class="id"> /orP[|/lt_ereal_bnd</span><span class="id"> i12];</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> (_<span class="id"> :</span><span class="id"> [set`</span><span class="id"> i]</span><span class="id"> =</span><span class="id"> set0</span>)<span class="id"> ?hlength0//</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply/eqP/negPn;</span><span class="id"> rewrite</span><span class="id"> -/</span>(<span class="id">neitv</span><span class="id"> _</span>)<span class="id"> neitvE</span><span class="id"> -leNgt</span> (<span class="id">ltW</span><span class="id"> i12</span>).<br/>
<span class="id">case:</span><span class="id"> i</span><span class="id"> =&gt;</span><span class="id"> -[ba</span><span class="id"> a|[|]]</span><span class="id"> [bb</span><span class="id"> b|[|]]</span><span class="id"> //=</span>.<br/>
<span class="id">-</span><span class="id"> rewrite</span><span class="id"> /=</span><span class="id"> =&gt;</span><span class="id"> /eqP[-&gt;{b}];</span><span class="id"> move:</span><span class="id"> ba</span><span class="id"> bb</span><span class="id"> =&gt;</span><span class="id"> -[]</span><span class="id"> [];</span><span class="id"> try</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> set_itvE</span><span class="id"> hlength0</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> hlength_singleton</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> set_itvE</span><span class="id"> hlength0</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> set_itvE</span><span class="id"> hlength0</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> hlength_finite_fin_num</span><span class="id"> i</span><span class="id"> :</span><span class="id"> neitv</span><span class="id"> i</span><span class="id"> -&gt;</span><span class="id"> hlength</span><span class="id"> [set`</span><span class="id"> i]</span><span class="id"> &lt;</span><span class="id"> +oo</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;((<span class="id">i</span>.<span class="id">1</span><span class="id"> :</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id"> \is</span><span class="id"> a</span><span class="id"> fin_num</span>)<span class="id"> /\</span> ((<span class="id">i</span>.<span class="id">2</span><span class="id"> :</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id"> \is</span><span class="id"> a</span><span class="id"> fin_num</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move:</span><span class="id"> i</span><span class="id"> =&gt;</span><span class="id"> [[ba</span><span class="id"> a|[]]</span><span class="id"> [bb</span><span class="id"> b|[]]]</span><span class="id"> /neitvP</span><span class="id"> //=;</span><span class="id"> do</span><span class="id"> ?by</span><span class="id"> rewrite</span><span class="id"> ?set_itvE</span><span class="id"> ?eqxx</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> hlength_itv</span><span class="id"> /=</span><span class="id"> ltry</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> hlength_itv</span><span class="id"> /=</span><span class="id"> ltNyr</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> hlength_itv</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> finite_hlength_itv</span><span class="id"> i</span><span class="id"> :</span><span class="id"> neitv</span><span class="id"> i</span><span class="id"> -&gt;</span><span class="id"> hlength</span><span class="id"> [set`</span><span class="id"> i]</span><span class="id"> &lt;</span><span class="id"> +oo</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">hlength</span><span class="id"> [set`</span><span class="id"> i]</span><span class="id"> =</span> (<span class="id">fine</span><span class="id"> i</span>.<span class="id">2</span>)<span class="id">%:E</span><span class="id"> -</span> (<span class="id">fine</span><span class="id"> i</span>.<span class="id">1</span>)<span class="id">%:E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> i0</span><span class="id"> ioo;</span><span class="id"> have</span><span class="id"> [ri1</span><span class="id"> ri2]</span><span class="id"> :=</span><span class="id"> hlength_finite_fin_num</span><span class="id"> i0</span><span class="id"> ioo</span>.<br/>
<span class="id">rewrite</span><span class="id"> !fineK//</span><span class="id"> hlength_itv;</span><span class="id"> case:</span><span class="id"> ifPn</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
<span class="id">rewrite</span><span class="id"> -leNgt</span><span class="id"> le_eqVlt</span><span class="id"> =&gt;</span><span class="id"> /predU1P[-&gt;|];</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> subee</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> move/lt_ereal_bnd/ltW;</span><span class="id"> rewrite</span><span class="id"> leNgt;</span><span class="id"> move:</span><span class="id"> i0</span><span class="id"> =&gt;</span><span class="id"> /neitvP</span><span class="id"> =&gt;</span><span class="id"> -&gt;</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> hlength_infty_bnd</span><span class="id"> b</span><span class="id"> r</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">hlength</span><span class="id"> [set`</span><span class="id"> Interval</span><span class="id"> -oo%O</span> (<span class="id">BSide</span><span class="id"> b</span><span class="id"> r</span>)<span class="id">]</span><span class="id"> =</span><span class="id"> +oo</span><span class="id"> :&gt;</span><span class="id"> \bar</span><span class="id"> R</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> hlength_itv</span><span class="id"> /=</span><span class="id"> ltNyr</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> hlength_bnd_infty</span><span class="id"> b</span><span class="id"> r</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">hlength</span><span class="id"> [set`</span><span class="id"> Interval</span> (<span class="id">BSide</span><span class="id"> b</span><span class="id"> r</span>)<span class="id"> +oo%O]</span><span class="id"> =</span><span class="id"> +oo</span><span class="id"> :&gt;</span><span class="id"> \bar</span><span class="id"> R</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> hlength_itv</span><span class="id"> /=</span><span class="id"> ltry</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> infinite_hlength_itv</span><span class="id"> i</span><span class="id"> :</span><span class="id"> hlength</span><span class="id"> [set`</span><span class="id"> i]</span><span class="id"> =</span><span class="id"> +oo</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">exists</span><span class="id"> s</span><span class="id"> r,</span><span class="id"> i</span><span class="id"> =</span><span class="id"> Interval</span><span class="id"> -oo%O</span> (<span class="id">BSide</span><span class="id"> s</span><span class="id"> r</span>)<span class="id"> \/</span><span class="id"> i</span><span class="id"> =</span><span class="id"> Interval</span> (<span class="id">BSide</span><span class="id"> s</span><span class="id"> r</span>)<span class="id"> +oo%O</span>)<br/>
&nbsp;&nbsp;<span class="id">\/</span><span class="id"> i</span><span class="id"> =</span><span class="id"> `]-oo,</span><span class="id"> +oo[</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> hlength_itv;</span><span class="id"> case:</span><span class="id"> i</span><span class="id"> =&gt;</span><span class="id"> -[ba</span><span class="id"> a|[]]</span><span class="id"> [bb</span><span class="id"> b|[]]</span><span class="id"> //=</span><span class="id"> =&gt;</span><span class="id"> [|_|_|]</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> case:</span><span class="id"> ifPn</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> left;</span><span class="gallina-kwd"> exists</span><span class="id"> ba,</span><span class="id"> a;</span><span class="id"> right</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> left;</span><span class="gallina-kwd"> exists</span><span class="id"> bb,</span><span class="id"> b;</span><span class="id"> left</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> right</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> hlength_itv_ge0</span><span class="id"> i</span><span class="id"> :</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> hlength</span><span class="id"> [set`</span><span class="id"> i]</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> hlength_itv;</span><span class="id"> case:</span><span class="id"> ifPn</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> case:</span> (<span class="id">i</span>.<span class="id">1</span><span class="id"> :</span><span class="id"> \bar</span><span class="id"> _</span>)<span class="id"> =&gt;</span><span class="id"> [r|</span><span class="id"> |]</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> suber_ge0//;</span><span class="id"> exact:</span><span class="id"> ltW</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> ltNge</span><span class="id"> leey</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> i2gtNy;</span><span class="id"> rewrite</span><span class="id"> addey//;</span><span class="id"> case:</span> (<span class="id">i</span>.<span class="id">2</span><span class="id"> :</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id"> i2gtNy</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> hlength_Rhull</span> (<span class="id">A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> R</span>)<span class="id"> :</span><span class="id"> hlength</span><span class="id"> [set`</span><span class="id"> Rhull</span><span class="id"> A]</span><span class="id"> =</span><span class="id"> hlength</span><span class="id"> A</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> /hlength</span><span class="id"> Rhull_involutive</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> le_hlength_itv</span><span class="id"> i</span><span class="id"> j</span><span class="id"> :</span><span class="id"> {subset</span><span class="id"> i</span><span class="id"> &lt;=</span><span class="id"> j}</span><span class="id"> -&gt;</span><span class="id"> hlength</span><span class="id"> [set`</span><span class="id"> i]</span><span class="id"> &lt;=</span><span class="id"> hlength</span><span class="id"> [set`</span><span class="id"> j]</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">set</span><span class="id"> I</span><span class="id"> :=</span><span class="id"> [set`</span><span class="id"> i];</span><span class="id"> set</span><span class="id"> J</span><span class="id"> :=</span><span class="id"> [set`</span><span class="id"> j]</span>.<br/>
<span class="id">have</span><span class="id"> [-&gt;|/set0P</span><span class="id"> I0]</span><span class="id"> :=</span><span class="id"> eqVneq</span><span class="id"> I</span><span class="id"> set0;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> hlength0</span><span class="id"> hlength_itv_ge0</span>.<br/>
<span class="id">have</span><span class="id"> [J0|/set0P</span><span class="id"> J0]</span><span class="id"> :=</span><span class="id"> eqVneq</span><span class="id"> J</span><span class="id"> set0</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move/subset_itvP;</span><span class="id"> rewrite</span><span class="id"> -/J</span><span class="id"> J0</span><span class="id"> subset0</span><span class="id"> -/I</span><span class="id"> =&gt;</span><span class="id"> -&gt;</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> /subset_itvP</span><span class="id"> ij;</span><span class="id"> apply:</span><span class="id"> leeB</span><span class="id"> =&gt;</span><span class="id"> /=</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> [ui|ui]</span><span class="id"> :=</span><span class="id"> asboolP</span> (<span class="id">has_ubound</span><span class="id"> I</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">have</span><span class="id"> [uj</span><span class="id"> /=|uj]</span><span class="id"> :=</span><span class="id"> asboolP</span> (<span class="id">has_ubound</span><span class="id"> J</span>)<span class="id">;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> leey</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> lee_fin</span><span class="id"> le_sup</span><span class="id"> //</span><span class="id"> =&gt;</span><span class="id"> r</span><span class="id"> Ir;</span><span class="gallina-kwd"> exists</span><span class="id"> r;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> apply:</span><span class="id"> ij</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> [uj</span><span class="id"> /=|//]</span><span class="id"> :=</span><span class="id"> asboolP</span> (<span class="id">has_ubound</span><span class="id"> J</span>).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move:</span><span class="id"> ui;</span><span class="id"> have</span><span class="id"> :=</span><span class="id"> subset_has_ubound</span><span class="id"> ij</span><span class="id"> uj</span>.<br/>
<span class="id">have</span><span class="id"> [lj</span><span class="id"> /=|lj]</span><span class="id"> :=</span><span class="id"> asboolP</span> (<span class="id">has_lbound</span><span class="id"> J</span>)<span class="id">;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> leNye</span>.<br/>
<span class="id">have</span><span class="id"> [li</span><span class="id"> /=|li]</span><span class="id"> :=</span><span class="id"> asboolP</span> (<span class="id">has_lbound</span><span class="id"> I</span>)<span class="id">;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move:</span><span class="id"> li;</span><span class="id"> have</span><span class="id"> :=</span><span class="id"> subset_has_lbound</span><span class="id"> ij</span><span class="id"> lj</span>.<br/>
<span class="id">rewrite</span><span class="id"> lee_fin</span><span class="id"> lerNl</span><span class="id"> opprK</span><span class="id"> le_sup//</span><span class="id"> ?has_inf_supN//;</span><span class="id"> last</span><span class="id"> exact/nonemptyN</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> r</span><span class="id"> [r'</span><span class="id"> Ir'</span><span class="id"> &lt;-{r}];</span><span class="gallina-kwd"> exists</span> (<span class="id">-</span><span class="id"> r'</span>)<span class="id">%R</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="gallina-kwd"> exists</span><span class="id"> r'</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> apply:</span><span class="id"> ij</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> le_hlength</span><span class="id"> :</span><span class="id"> {homo</span><span class="id"> hlength</span><span class="id"> :</span><span class="id"> A</span><span class="id"> B</span><span class="id"> /</span> (<span class="id">A</span><span class="id"> `&lt;=`</span><span class="id"> B</span>)<span class="id"> &gt;-&gt;</span><span class="id"> A</span><span class="id"> &lt;=</span><span class="id"> B}</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> a</span><span class="id"> b</span><span class="id"> /le_Rhull</span><span class="id"> /le_hlength_itv</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span> (<span class="id">hlength_Rhull</span><span class="id"> a</span>) (<span class="id">hlength_Rhull</span><span class="id"> b</span>).<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> hlength_ge0</span><span class="id"> I</span><span class="id"> :</span> (<span class="id">0</span><span class="id"> &lt;=</span><span class="id"> hlength</span><span class="id"> I</span>)<span class="id">%E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> -hlength0</span><span class="id"> le_hlength</span>. Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> hlength</span>.<br/>
<span class="id">#[local]</span><span class="vernacular"> Hint</span><span class="id"> Extern</span><span class="id"> 0</span> (<span class="id">is_true</span> (<span class="id">0%R</span><span class="id"> &lt;=</span><span class="id"> hlength</span><span class="id"> _</span>))<span class="id"> =&gt;</span><br/>
&nbsp;&nbsp;<span class="id">solve[apply:</span><span class="id"> hlength_ge0]</span><span class="id"> :</span><span class="id"> core</span>.<br/>
<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> hlength_extension</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {R</span><span class="id"> :</span><span class="id"> realType}</span>.<br/>
<br/>
<span class="vernacular">Notation</span><span class="id"> hlength</span><span class="id"> :=</span> (<span class="id">@hlength</span><span class="id"> R</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> hlength_semi_additive</span><span class="id"> :</span><span class="id"> measure</span>.<span class="id">semi_additive</span><span class="id"> hlength</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> /=</span><span class="id"> I</span><span class="id"> n</span><span class="id"> /</span>(_<span class="id"> _</span>)<span class="id">/cid2-/all_sig[b]/all_and2[_]/</span>(_<span class="id"> _</span>)<span class="id">/esym-/funext</span><span class="id"> {I}-&gt;</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> Itriv</span><span class="id"> [[/=</span><span class="id"> a1</span><span class="id"> a2]</span><span class="id"> _]</span><span class="id"> /esym</span><span class="id"> /[dup]</span><span class="id"> +</span><span class="id"> -&gt;</span>.<br/>
<span class="id">rewrite</span><span class="id"> hlength_itv</span><span class="id"> ?lte_fin/=</span><span class="id"> -EFinB</span>.<br/>
<span class="id">case:</span><span class="id"> ifPn</span><span class="id"> =&gt;</span><span class="id"> a12;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">pose</span><span class="id"> I</span><span class="id"> i</span><span class="id"> :=</span> <span class="id"> `]</span>(<span class="id">b</span><span class="id"> i</span>).<span class="id">1,</span> (<span class="id">b</span><span class="id"> i</span>).<span class="id">2]%classic</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> set_itv_ge//=</span><span class="id"> -</span>(<span class="id">bigcup_mkord</span><span class="id"> _</span><span class="id"> I</span>)<span class="id"> /I</span><span class="id"> =&gt;</span><span class="id"> /bigcup0P</span><span class="id"> I0</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> under</span><span class="id"> eq_bigr</span><span class="id"> =&gt;</span><span class="id"> i</span><span class="id"> _</span><span class="id"> do</span><span class="id"> rewrite</span><span class="id"> I0//=</span><span class="id"> hlength0;</span><span class="id"> rewrite</span><span class="id"> big1</span>.<br/>
<span class="id">set</span><span class="id"> A</span><span class="id"> :=</span><span class="id"> `]a1,</span><span class="id"> a2]%classic</span>.<br/>
<span class="id">rewrite</span><span class="id"> -bigcup_pred;</span><span class="id"> set</span><span class="id"> P</span><span class="id"> :=</span><span class="id"> xpredT;</span><span class="id"> rewrite</span> (<span class="id">eq_bigl</span><span class="id"> P</span>)<span class="id">//</span>.<br/>
<span class="id">move:</span><span class="id"> P</span><span class="id"> =&gt;</span><span class="id"> P;</span><span class="id"> have</span><span class="id"> [p]</span><span class="id"> :=</span><span class="id"> ubnP</span><span class="id"> #|P|;</span><span class="id"> elim:</span><span class="id"> p</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> p</span><span class="id"> IHp</span><span class="gallina-kwd"> in</span><span class="id"> P</span><span class="id"> a2</span><span class="id"> a12</span><span class="id"> A</span><span class="id"> *</span>.<br/>
<span class="id">rewrite</span><span class="id"> ltnS</span><span class="id"> =&gt;</span><span class="id"> cP</span><span class="id"> /esym</span><span class="id"> AE</span>.<br/>
<span class="id">have</span><span class="id"> :</span><span class="id"> A</span><span class="id"> a2</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> /A</span><span class="id"> /=</span><span class="id"> in_itv/=</span><span class="id"> lexx</span><span class="id"> andbT</span>.<br/>
<span class="id">rewrite</span><span class="id"> AE/=</span><span class="id"> =&gt;</span><span class="id"> -[i</span><span class="id"> /=</span><span class="id"> Pi]</span><span class="id"> a2bi</span>.<br/>
<span class="id">case:</span> (<span class="id">boolP</span> ((<span class="id">b</span><span class="id"> i</span>).<span class="id">1</span><span class="id"> &lt;</span> (<span class="id">b</span><span class="id"> i</span>).<span class="id">2</span>))<span class="id"> =&gt;</span><span class="id"> bi;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> itv_ge</span><span class="gallina-kwd"> in</span><span class="id"> a2bi</span>.<br/>
<span class="id">have</span><span class="id"> {}a2bi</span><span class="id"> :</span><span class="id"> a2</span><span class="id"> =</span> (<span class="id">b</span><span class="id"> i</span>).<span class="id">2</span>.<br/>
&nbsp;&nbsp;<span class="id">apply/eqP;</span><span class="id"> rewrite</span><span class="id"> eq_le</span> (<span class="id">itvP</span><span class="id"> a2bi</span>)<span class="id">/=</span>.<br/>
&nbsp;&nbsp;<span class="id">suff:</span><span class="id"> A</span> (<span class="id">b</span><span class="id"> i</span>).<span class="id">2</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> /itvP-&gt;</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> AE;</span><span class="gallina-kwd"> exists</span><span class="id"> i=&gt;</span><span class="id"> //=;</span><span class="id"> rewrite</span><span class="id"> in_itv/=</span><span class="id"> lexx</span><span class="id"> andbT</span>.<br/>
<span class="id">rewrite</span><span class="id"> {a2}a2bi</span><span class="gallina-kwd"> in</span><span class="id"> a12</span><span class="id"> A</span><span class="id"> AE</span><span class="id"> *</span>.<br/>
<span class="id">rewrite</span> (<span class="id">bigD1</span><span class="id"> i</span>)<span class="id">//=</span><span class="id"> hlength_itv</span><span class="id"> ?lte_fin/=</span><span class="id"> bi</span><span class="id"> !EFinD</span><span class="id"> -addeA</span>.<br/>
<span class="id">congr</span> (_<span class="id"> +</span><span class="id"> _</span>)<span class="id">%E;</span><span class="id"> apply/eqP;</span><span class="id"> rewrite</span><span class="id"> addeC</span><span class="id"> -sube_eq//</span><span class="id"> 1?adde_defC//</span>.<br/>
<span class="id">rewrite</span><span class="id"> ?EFinN</span><span class="id"> oppeK</span><span class="id"> addeC;</span><span class="id"> apply/eqP</span>.<br/>
<span class="id">case:</span> (<span class="id">eqVneq</span><span class="id"> a1</span> (<span class="id">b</span><span class="id"> i</span>).<span class="id">1</span>)<span class="id"> =&gt;</span><span class="id"> a1bi</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> {a1}a1bi</span><span class="gallina-kwd"> in</span><span class="id"> a12</span><span class="id"> A</span><span class="id"> AE</span><span class="id"> {IHp}</span><span class="id"> *;</span><span class="id"> rewrite</span><span class="id"> subee</span><span class="id"> ?big1//</span><span class="id"> =&gt;</span><span class="id"> j</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> /andP[Pj</span><span class="id"> Nji];</span><span class="id"> rewrite</span><span class="id"> hlength_itv</span><span class="id"> ?lte_fin/=;</span><span class="id"> case:</span><span class="id"> ifPn</span><span class="id"> =&gt;</span><span class="id"> bj//</span>.<br/>
&nbsp;&nbsp;<span class="id">exfalso;</span><span class="id"> have</span><span class="id"> /trivIsetP/</span>(_<span class="id"> j</span><span class="id"> i</span><span class="id"> I</span><span class="id"> I</span><span class="id"> Nji</span>)<span class="id"> :=</span><span class="id"> Itriv</span>.<br/>
&nbsp;&nbsp;<span class="id">pose</span><span class="id"> m</span><span class="id"> :=</span> ((<span class="id">b</span><span class="id"> j</span>).<span class="id">1</span><span class="id"> +</span> (<span class="id">b</span><span class="id"> j</span>).<span class="id">2</span>)<span class="id"> /</span><span class="id"> 2%:R</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> mbj</span><span class="id"> :</span><span class="id"> `]</span>(<span class="id">b</span><span class="id"> j</span>).<span class="id">1,</span> (<span class="id">b</span><span class="id"> j</span>).<span class="id">2]%classic</span><span class="id"> m</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /=</span><span class="id"> !in_itv/=</span><span class="id"> ?</span>(<span class="id">midf_lt,</span><span class="id"> midf_le</span>)<span class="id">//=</span><span class="id"> ltW</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -subset0</span><span class="id"> =&gt;</span><span class="id"> /</span>(_<span class="id"> m</span>)<span class="id">;</span><span class="id"> apply;</span><span class="id"> split=&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> suff:</span><span class="id"> A</span><span class="id"> m</span><span class="gallina-kwd"> by</span><span class="id"> [];</span><span class="id"> rewrite</span><span class="id"> AE;</span><span class="gallina-kwd"> exists</span><span class="id"> j</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
<span class="id">have</span><span class="id"> a1b2</span><span class="id"> j</span><span class="id"> :</span><span class="id"> P</span><span class="id"> j</span><span class="id"> -&gt;</span> (<span class="id">b</span><span class="id"> j</span>).<span class="id">1</span><span class="id"> &lt;</span> (<span class="id">b</span><span class="id"> j</span>).<span class="id">2</span><span class="id"> -&gt;</span><span class="id"> a1</span><span class="id"> &lt;=</span> (<span class="id">b</span><span class="id"> j</span>).<span class="id">2</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> Pj</span><span class="id"> bj;</span><span class="id"> suff</span><span class="id"> /itvP-&gt;</span><span class="id"> :</span><span class="id"> A</span> (<span class="id">b</span><span class="id"> j</span>).<span class="id">2</span><span class="gallina-kwd"> by</span><span class="id"> []</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> AE;</span><span class="gallina-kwd"> exists</span><span class="id"> j</span><span class="id"> =&gt;</span><span class="id"> //=;</span><span class="id"> rewrite</span><span class="id"> ?in_itv/=</span><span class="id"> bj//=</span>.<br/>
<span class="id">have</span><span class="id"> a1b</span><span class="id"> j</span><span class="id"> :</span><span class="id"> P</span><span class="id"> j</span><span class="id"> -&gt;</span> (<span class="id">b</span><span class="id"> j</span>).<span class="id">1</span><span class="id"> &lt;</span> (<span class="id">b</span><span class="id"> j</span>).<span class="id">2</span><span class="id"> -&gt;</span><span class="id"> a1</span><span class="id"> &lt;=</span> (<span class="id">b</span><span class="id"> j</span>).<span class="id">1</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> Pj</span><span class="id"> bj;</span><span class="id"> case:</span><span class="id"> ltP=&gt;</span><span class="id"> //</span><span class="id"> bj1a</span>.<br/>
&nbsp;&nbsp;<span class="id">suff</span><span class="id"> :</span><span class="id"> A</span><span class="id"> a1</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> /A/=</span><span class="id"> in_itv/=</span><span class="id"> ltxx</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> AE;</span><span class="gallina-kwd"> exists</span><span class="id"> j;</span><span class="id"> rewrite</span><span class="id"> //=</span><span class="id"> in_itv/=</span><span class="id"> bj1a//=</span><span class="id"> a1b2</span>.<br/>
<span class="id">have</span><span class="id"> bbi2</span><span class="id"> j</span><span class="id"> :</span><span class="id"> P</span><span class="id"> j</span><span class="id"> -&gt;</span> (<span class="id">b</span><span class="id"> j</span>).<span class="id">1</span><span class="id"> &lt;</span> (<span class="id">b</span><span class="id"> j</span>).<span class="id">2</span><span class="id"> -&gt;</span> (<span class="id">b</span><span class="id"> j</span>).<span class="id">2</span><span class="id"> &lt;=</span> (<span class="id">b</span><span class="id"> i</span>).<span class="id">2</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> Pj</span><span class="id"> bj;</span><span class="id"> suff</span><span class="id"> /itvP-&gt;</span><span class="id"> :</span><span class="id"> A</span> (<span class="id">b</span><span class="id"> j</span>).<span class="id">2</span><span class="gallina-kwd"> by</span><span class="id"> []</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> AE;</span><span class="gallina-kwd"> exists</span><span class="id"> j</span><span class="id"> =&gt;</span><span class="id"> //=;</span><span class="id"> rewrite</span><span class="id"> ?in_itv/=</span><span class="id"> bj//=</span>.<br/>
<span class="id">apply/IHp</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> lt_neqAle</span><span class="id"> a1bi/=</span><span class="id"> a1b</span>.<br/>
<span class="id">-</span><span class="id"> rewrite</span> (<span class="id">leq_trans</span><span class="id"> _</span><span class="id"> cP</span>)<span class="id">//</span><span class="id"> -</span>(<span class="id">cardID</span> (<span class="id">pred1</span><span class="id"> i</span>)<span class="id"> P</span>).<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> [X</span><span class="gallina-kwd"> in</span> (_<span class="id"> &lt;</span><span class="id"> X</span><span class="id"> +</span><span class="id"> _</span>)<span class="id">%N]</span>(<span class="id">@eq_card</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">pred1</span><span class="id"> i</span>))<span class="id">;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> j;</span><span class="id"> rewrite</span><span class="id"> !inE</span><span class="id"> andbC;</span><span class="id"> case:</span><span class="id"> eqVneq</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> -&gt;</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> ?card1</span><span class="id"> ?ltnS//</span><span class="id"> subset_leq_card//</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply/fintype</span>.<span class="id">subsetP</span><span class="id"> =&gt;</span><span class="id"> j;</span><span class="id"> rewrite</span><span class="id"> -topredE/=</span><span class="id"> !inE</span><span class="id"> andbC</span>.<br/>
<span class="id">apply/seteqP;</span><span class="id"> split=&gt;</span><span class="id"> /=</span><span class="id"> [x</span><span class="id"> [j/=</span><span class="id"> /andP[Pj</span><span class="id"> Nji]]|x/=</span><span class="id"> xabi]</span>.<br/>
&nbsp;&nbsp;<span class="id">case:</span> (<span class="id">boolP</span> ((<span class="id">b</span><span class="id"> j</span>).<span class="id">1</span><span class="id"> &lt;</span> (<span class="id">b</span><span class="id"> j</span>).<span class="id">2</span>))<span class="id"> =&gt;</span><span class="id"> bj;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> itv_ge</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> subitvP;</span><span class="id"> rewrite</span><span class="id"> subitvE</span><span class="id"> ?bnd_simp</span><span class="id"> a1b//=</span><span class="id"> leNgt</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> /trivIsetP/</span>(_<span class="id"> j</span><span class="id"> i</span><span class="id"> I</span><span class="id"> I</span><span class="id"> Nji</span>)<span class="id"> :=</span><span class="id"> Itriv</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -subset0</span><span class="id"> =&gt;</span><span class="id"> /</span>(_ (<span class="id">b</span><span class="id"> j</span>).<span class="id">2</span>)<span class="id">;</span><span class="id"> apply:</span><span class="id"> contra_notN</span><span class="id"> =&gt;</span><span class="id"> /=</span><span class="id"> bi1j2</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> !in_itv/=</span><span class="id"> bj</span><span class="id"> !lexx</span><span class="id"> bi1j2</span><span class="id"> bbi2</span>.<br/>
<span class="id">have:</span><span class="id"> A</span><span class="id"> x</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> /A/=</span><span class="id"> in_itv/=</span> (<span class="id">itvP</span><span class="id"> xabi</span>)<span class="id">/=</span><span class="id"> ltW//</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span> (<span class="id">le_lt_trans</span><span class="id"> _</span><span class="id"> bi</span>)<span class="id"> ?</span>(<span class="id">itvP</span><span class="id"> xabi</span>).<br/>
<span class="id">rewrite</span><span class="id"> AE</span><span class="id"> =&gt;</span><span class="id"> -[j</span><span class="id"> /=</span><span class="id"> Pj</span><span class="id"> xbj]</span>.<br/>
<span class="gallina-kwd">exists</span><span class="id"> j</span><span class="id"> =&gt;</span><span class="id"> //=</span>.<br/>
<span class="id">apply/andP;</span><span class="id"> split=&gt;</span><span class="id"> //;</span><span class="id"> apply:</span><span class="id"> contraTneq</span><span class="id"> xbj</span><span class="id"> =&gt;</span><span class="id"> -&gt;</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> in_itv/=</span><span class="id"> le_gtF//</span> (<span class="id">itvP</span><span class="id"> xabi</span>).<br/>
Qed.</div></details>
<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> isContent</span>.<span class="id">Build</span><span class="id"> _</span><span class="id"> _</span><span class="id"> R</span><br/>
&nbsp;&nbsp;<span class="id">hlength</span><span class="id"> hlength_ge0</span><span class="id"> hlength_semi_additive</span>.<br/>
<br/>
<span class="vernacular">Hint</span><span class="id"> Extern</span><span class="id"> 0</span> ((_ .<span class="id">-ocitv</span>).<span class="id">-measurable</span><span class="id"> _</span>)<span class="id"> =&gt;</span><span class="id"> solve</span><span class="id"> [apply:</span><span class="id"> is_ocitv]</span><span class="id"> :</span><span class="id"> core</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> hlength_sigma_subadditive</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">measurable_subset_sigma_subadditive</span> (<span class="id">hlength</span><span class="id"> :</span><span class="id"> set</span> (<span class="id">ocitv_type</span><span class="id"> R</span>)<span class="id"> -&gt;</span><span class="id"> _</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> I</span><span class="id"> A</span><span class="id"> /</span>(_<span class="id"> _</span>)<span class="id">/cid2-/all_sig[b]/all_and2[_]/</span>(_<span class="id"> _</span>)<span class="id">/esym</span><span class="id"> AE</span><span class="id"> =&gt;</span><span class="id"> -[a</span><span class="id"> _</span><span class="id"> &lt;-]</span>.<br/>
<span class="id">rewrite</span><span class="id"> /subset_sigma_subadditive</span><span class="id"> hlength_itv</span><span class="id"> ?lte_fin/=</span><span class="id"> -EFinB</span><span class="id"> =&gt;</span><span class="id"> lebig</span>.<br/>
<span class="id">case:</span><span class="id"> ifPn</span><span class="id"> =&gt;</span><span class="id"> a12;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> nneseries_esum//</span><span class="id"> esum_ge0</span>.<br/>
<span class="id">apply/lee_addgt0Pr</span><span class="id"> =&gt;</span><span class="id"> _</span><span class="id"> /posnumP[e]</span>.<br/>
<span class="id">rewrite</span><span class="id"> [e%:num]splitr</span><span class="id"> [in</span><span class="id"> leRHS]EFinD</span><span class="id"> addeA</span><span class="id"> -leeBlDr//</span>.<br/>
<span class="id">apply:</span><span class="id"> le_trans</span> (<span class="id">epsilon_trick</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span>)<span class="id"> =&gt;</span><span class="id"> //=</span>.<br/>
<span class="id">have</span><span class="id"> eVn_gt0</span><span class="id"> n</span><span class="id"> :</span><span class="id"> 0</span><span class="id"> &lt;</span><span class="id"> e%:num</span><span class="id"> /</span><span class="id"> 2</span><span class="id"> /</span> (<span class="id">2</span><span class="id"> ^</span><span class="id"> n</span>.<span class="id">+1</span>)<span class="id">%:R</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> divr_gt0//</span><span class="id"> ltr0n//</span><span class="id"> expn_gt0</span>.<br/>
<span class="id">have</span><span class="id"> eVn_ge0</span><span class="id"> n</span><span class="id"> :=</span><span class="id"> ltW</span> (<span class="id">eVn_gt0</span><span class="id"> n</span>).<br/>
<span class="id">pose</span><span class="id"> Aoo</span><span class="id"> i</span><span class="id"> :</span><span class="id"> set</span> (<span class="id">ocitv_type</span><span class="id"> R</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">`]</span>(<span class="id">b</span><span class="id"> i</span>).<span class="id">1,</span> (<span class="id">b</span><span class="id"> i</span>).<span class="id">2</span><span class="id"> +</span><span class="id"> e%:num</span><span class="id"> /</span><span class="id"> 2</span><span class="id"> /</span> (<span class="id">2</span><span class="id"> ^</span><span class="id"> i</span>.<span class="id">+1</span>)<span class="id">%:R[%classic</span>.<br/>
<span class="id">pose</span><span class="id"> Aoc</span><span class="id"> i</span><span class="id"> :</span><span class="id"> set</span> (<span class="id">ocitv_type</span><span class="id"> R</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">`]</span>(<span class="id">b</span><span class="id"> i</span>).<span class="id">1,</span> (<span class="id">b</span><span class="id"> i</span>).<span class="id">2</span><span class="id"> +</span><span class="id"> e%:num</span><span class="id"> /</span><span class="id"> 2</span><span class="id"> /</span> (<span class="id">2</span><span class="id"> ^</span><span class="id"> i</span>.<span class="id">+1</span>)<span class="id">%:R]%classic</span>.<br/>
<span class="id">have:</span><span class="id"> `[a</span>.<span class="id">1</span><span class="id"> +</span><span class="id"> e%:num</span><span class="id"> /</span><span class="id"> 2,</span><span class="id"> a</span>.<span class="id">2]</span><span class="id"> `&lt;=`</span><span class="id"> \bigcup_i</span><span class="id"> Aoo</span><span class="id"> i</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span> (<span class="id">@subset_trans</span><span class="id"> _</span><span class="id"> `]a</span>.<span class="id">1,</span><span class="id"> a</span>.<span class="id">2]</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> x;</span><span class="id"> rewrite</span><span class="id"> /=</span><span class="id"> !in_itv</span><span class="id"> /=</span><span class="id"> =&gt;</span><span class="id"> /andP[+</span><span class="id"> -&gt;</span><span class="id"> //]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> /lt_le_trans-&gt;</span><span class="id"> //;</span><span class="id"> rewrite</span><span class="id"> ltrDl</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span> (<span class="id">subset_trans</span><span class="id"> lebig</span>)<span class="id">;</span><span class="id"> apply:</span><span class="id"> subset_bigcup</span><span class="id"> =&gt;</span><span class="id"> i</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> AE</span><span class="id"> /Aoo/=</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> x</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> !in_itv</span><span class="id"> /=</span><span class="id"> =&gt;</span><span class="id"> /andP[-&gt;</span><span class="id"> /le_lt_trans-&gt;]//=</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> ltrDl</span>.<br/>
<span class="id">have</span><span class="id"> :=</span><span class="id"> @segment_compact</span><span class="id"> _</span> (<span class="id">a</span>.<span class="id">1</span><span class="id"> +</span><span class="id"> e%:num</span><span class="id"> /</span><span class="id"> 2</span>)<span class="id"> a</span>.<span class="id">2;</span><span class="id"> rewrite</span><span class="id"> compact_cover</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> /[apply]-[i</span><span class="id"> _|X</span><span class="id"> _</span><span class="id"> Xc];</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> interval_open</span>.<br/>
<span class="id">have:</span><span class="id"> `]</span>(<span class="id">a</span>.<span class="id">1</span><span class="id"> +</span><span class="id"> e%:num</span><span class="id"> /</span><span class="id"> 2</span>)<span class="id">,</span><span class="id"> a</span>.<span class="id">2]</span><span class="id"> `&lt;=`</span><span class="id"> \bigcup_</span>(<span class="id">i</span><span class="gallina-kwd"> in</span><span class="id"> [set`</span><span class="id"> X]</span>)<span class="id"> Aoc</span><span class="id"> i</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> x</span><span class="id"> /subset_itv_oc_cc</span><span class="id"> /Xc</span><span class="id"> [i</span><span class="id"> /=</span><span class="id"> Xi]</span><span class="id"> Aooix</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="gallina-kwd"> exists</span><span class="id"> i</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> apply:</span><span class="id"> subset_itv_oo_oc</span><span class="id"> Aooix</span>.<br/>
<span class="id">have</span><span class="id"> /[apply]</span><span class="id"> :=</span><span class="id"> @content_sub_fsum</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><br/>
&nbsp;&nbsp;<span class="id">[the</span><span class="id"> content</span><span class="id"> _</span><span class="id"> _</span><span class="id"> of</span><span class="id"> hlength</span><span class="id"> :</span><span class="id"> set</span> (<span class="id">ocitv_type</span><span class="id"> R</span>)<span class="id"> -&gt;</span><span class="id"> _]</span><span class="id"> _</span><span class="id"> [set`</span><span class="id"> X]</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> /</span>(_<span class="id"> _</span><span class="id"> _</span><span class="id"> _</span>)<span class="id">/Box[]//=;</span><span class="id"> apply:</span><span class="id"> le_le_trans</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> hlength_itv</span><span class="id"> ?lte_fin</span><span class="id"> -?EFinD/=</span><span class="id"> -addrA</span><span class="id"> -opprD</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> case:</span><span class="id"> ltP</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> rewrite</span><span class="id"> lee_fin</span><span class="id"> subr_le0</span>.<br/>
<span class="id">rewrite</span><span class="id"> nneseries_esum//;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> *;</span><span class="id"> rewrite</span><span class="id"> adde_ge0//=</span><span class="id"> ?lee_fin</span>.<br/>
<span class="id">rewrite</span><span class="id"> esum_ge//;</span><span class="gallina-kwd"> exists</span><span class="id"> [set`</span><span class="id"> X]</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> rewrite</span><span class="id"> fsbig_finite//</span><span class="id"> ?set_fsetK//=</span>.<br/>
<span class="id">rewrite</span><span class="id"> fsbig_finite//=</span><span class="id"> set_fsetK//</span>.<br/>
<span class="id">rewrite</span><span class="id"> lee_sum</span><span class="id"> //</span><span class="id"> =&gt;</span><span class="id"> i</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> ?AE//</span><span class="id"> !hlength_itv/=</span><span class="id"> ?lte_fin</span><span class="id"> -?EFinD/=</span>.<br/>
<span class="id">do</span><span class="id"> !case:</span><span class="id"> ifPn</span><span class="id"> =&gt;</span><span class="id"> //=</span><span class="id"> ?;</span><span class="id"> do</span><span class="id"> ?by</span><span class="id"> rewrite</span><span class="id"> ?adde_ge0</span><span class="id"> ?lee_fin//</span><span class="id"> ?subr_ge0//</span><span class="id"> ?ltW</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> addrAC</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> addrAC</span><span class="id"> lee_fin</span><span class="id"> lerD//</span><span class="id"> subr_le0</span><span class="id"> leNgt</span>.<br/>
Qed.</div></details>
<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> Content_SigmaSubAdditive_isMeasure</span>.<span class="id">Build</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><br/>
&nbsp;&nbsp;<span class="id">hlength</span><span class="id"> hlength_sigma_subadditive</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> hlength_sigma_finite</span><span class="id"> :</span><span class="id"> sigma_finite</span><span class="id"> setT</span> (<span class="id">hlength</span><span class="id"> :</span><span class="id"> set</span> (<span class="id">ocitv_type</span><span class="id"> R</span>)<span class="id"> -&gt;</span><span class="id"> _</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd">exists</span> (<span class="gallina-kwd">fun</span><span class="id"> k</span><span class="id"> :</span><span class="id"> nat</span><span class="id"> =&gt;</span><span class="id"> `]</span> (<span class="id">-</span><span class="id"> k%:R</span>)<span class="id">%R,</span><span class="id"> k%:R]%classic</span>)<span class="id">;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> bigcup_itvT</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> k;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> rewrite</span><span class="id"> hlength_itv/=</span><span class="id"> -EFinB;</span><span class="id"> case:</span><span class="id"> ifP;</span><span class="id"> rewrite</span><span class="id"> ltry</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Definition</span><span class="id"> lebesgue_measure</span><span class="id"> :=</span><span class="id"> measure_extension</span><span class="id"> hlength</span>.<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> Measure</span>.<span class="id">on</span><span class="id"> lebesgue_measure</span>.<br/>
<br/>
<span class="vernacular">Let</span><span class="id"> sigmaT_finite_lebesgue_measure</span><span class="id"> :</span><span class="id"> sigma_finite</span><span class="id"> setT</span><span class="id"> lebesgue_measure</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id"> exact/measure_extension_sigma_finite/hlength_sigma_finite</span>. Qed.</div></details>
<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> @isSigmaFinite</span>.<span class="id">Build</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><br/>
&nbsp;&nbsp;<span class="id">lebesgue_measure</span><span class="id"> sigmaT_finite_lebesgue_measure</span>.<br/>
<br/>
<span class="vernacular">End</span><span class="id"> hlength_extension</span>.<br/>
<br/>
<span class="vernacular">End</span><span class="id"> LebesgueMeasure</span>.<br/>
<br/>
<span class="vernacular">Definition</span><span class="id"> lebesgue_measure</span><span class="id"> {R</span><span class="id"> :</span><span class="id"> realType}</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">set</span><span class="id"> [the</span><span class="id"> measurableType</span><span class="id"> _</span>.<span class="id">-sigma</span><span class="id"> of</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">g_sigma_algebraType</span><span class="id"> R</span>.<span class="id">-ocitv</span>.<span class="id">-measurable]</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">[the</span><span class="id"> measure</span><span class="id"> _</span><span class="id"> _</span><span class="id"> of</span><span class="id"> lebesgue_stieltjes_measure</span><span class="id"> idfun]</span>.<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>)<span class="id"> :=</span><span class="id"> Measure</span>.<span class="id">on</span> (<span class="id">@lebesgue_measure</span><span class="id"> R</span>).<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">SigmaFiniteMeasure</span>.<span class="id">on</span> (<span class="id">@lebesgue_measure</span><span class="id"> R</span>).<br/>
<br/>
<span class="vernacular">Definition</span><span class="id"> completed_lebesgue_measure</span><span class="id"> {R</span><span class="id"> :</span><span class="id"> realType}</span><span class="id"> :</span><span class="id"> set</span><span class="id"> _</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">[the</span><span class="id"> measure</span><span class="id"> _</span><span class="id"> _</span><span class="id"> of</span><span class="id"> completed_lebesgue_stieltjes_measure</span><span class="id"> idfun]</span>.<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">Measure</span>.<span class="id">on</span> (<span class="id">@completed_lebesgue_measure</span><span class="id"> R</span>).<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span> (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">SigmaFiniteMeasure</span>.<span class="id">on</span> (<span class="id">@completed_lebesgue_measure</span><span class="id"> R</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> completed_lebesgue_measure_is_complete</span><span class="id"> {R</span><span class="id"> :</span><span class="id"> realType}</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">measure_is_complete</span> (<span class="id">@completed_lebesgue_measure</span><span class="id"> R</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id"> exact:</span><span class="id"> measure_is_complete_caratheodory</span>. Qed.</div></details>
<br/>
<span class="vernacular">Section</span><span class="id"> completed_algebra_caratheodory</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {R</span><span class="id"> :</span><span class="id"> realType}</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<br/>
<span class="vernacular">Notation</span><span class="id"> hlength</span><span class="id"> :=</span> (<span class="id">@wlength</span><span class="id"> R</span><span class="id"> idfun</span>).<br/>
<span class="vernacular">Notation</span><span class="id"> mu</span><span class="id"> :=</span> (<span class="id">@lebesgue_measure</span><span class="id"> R</span>).<br/>
<span class="vernacular">Notation</span><span class="id"> completed_mu</span><span class="id"> :=</span> (<span class="id">@completed_lebesgue_measure</span><span class="id"> R</span>).<br/>
<br/>
<span class="vernacular">Let</span><span class="id"> cara_sub_calgebra</span><span class="id"> :</span><span class="id"> hlength^*%mu</span>.<span class="id">-cara</span>.<span class="id">-measurable</span><span class="id"> `&lt;=`</span><br/>
&nbsp;&nbsp;(<span class="id">completed_algebra_gen</span><span class="id"> mu</span>).<span class="id">-sigma</span>.<span class="id">-measurable</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> E;</span><span class="id"> wlog</span><span class="id"> :</span><span class="id"> E</span><span class="id"> /</span><span class="id"> completed_mu</span><span class="id"> E</span><span class="id"> &lt;</span><span class="id"> +oo</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> /=</span><span class="id"> wlg</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> /sigma_finiteP[/=</span><span class="id"> F</span><span class="id"> [UFI</span><span class="id"> ndF</span><span class="id"> mF]]</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">measure_extension_sigma_finite</span> (<span class="id">@wlength_sigma_finite</span><span class="id"> R</span><span class="id"> idfun</span>).<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> mE</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -</span>(<span class="id">setIT</span><span class="id"> E</span>)<span class="id">/=</span><span class="id"> UFI</span><span class="id"> setI_bigcupr;</span><span class="id"> apply:</span><span class="id"> bigcupT_measurable</span><span class="id"> =&gt;</span><span class="id"> i</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> wlg</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> rewrite</span> (<span class="id">le_lt_trans</span><span class="id"> _</span> (<span class="id">mF</span><span class="id"> i</span>).<span class="id">2</span>)<span class="id">//=</span><span class="id"> le_measure//</span><span class="id"> inE/=</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> measurableI</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> apply:</span><span class="id"> sub_caratheodory;</span><span class="id"> exact:</span> (<span class="id">mF</span><span class="id"> i</span>).<span class="id">1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> sub_caratheodory;</span><span class="id"> exact:</span> (<span class="id">mF</span><span class="id"> i</span>).<span class="id">1</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> measurableI</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> apply:</span><span class="id"> sub_caratheodory;</span><span class="id"> exact:</span> (<span class="id">mF</span><span class="id"> i</span>).<span class="id">1</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> mEoo</span><span class="id"> /=</span><span class="id"> mE</span>.<br/>
<span class="id">have</span><span class="id"> inv0</span><span class="id"> n</span><span class="id"> :</span> (<span class="id">0</span><span class="id"> &lt;</span><span class="id"> n</span>.<span class="id">+1%:R^-1</span><span class="id"> :&gt;</span><span class="id"> R</span>)<span class="id">%R</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> invr_gt0</span>.<br/>
<span class="id">set</span><span class="id"> S</span><span class="id"> :=</span><span class="id"> [set</span><span class="id"> \sum_</span>(<span class="id">0</span><span class="id"> &lt;=</span><span class="id"> k</span><span class="id"> &lt;oo</span>)<span class="id"> hlength</span> (<span class="id">A</span><span class="id"> k</span>)<span class="id"> |</span><span class="id"> A</span><span class="gallina-kwd"> in</span><span class="id"> measurable_cover</span><span class="id"> E]</span>.<br/>
<span class="id">have</span><span class="id"> coverE</span><span class="id"> s</span><span class="id"> :</span> (<span class="id">0</span><span class="id"> &lt;</span><span class="id"> s</span>)<span class="id">%R</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">exists2</span><span class="id"> A,</span><span class="id"> @measurable_cover</span><span class="id"> _</span> (<span class="id">ocitv_type</span><span class="id"> R</span>)<span class="id"> E</span><span class="id"> A</span><span class="id"> &amp;</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id">\sum_</span>(<span class="id">0</span><span class="id"> &lt;=</span><span class="id"> k</span><span class="id"> &lt;oo</span>)<span class="id"> hlength</span> (<span class="id">A</span><span class="id"> k</span>)<span class="id"> &lt;</span><span class="id"> completed_mu</span><span class="id"> E</span><span class="id"> +</span><span class="id"> s%:E</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> s0;</span><span class="id"> have</span><span class="id"> :</span><span class="id"> mu</span><span class="id"> E</span><span class="id"> \is</span><span class="id"> a</span><span class="id"> fin_num</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> ge0_fin_numE</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move/lb_ereal_inf_adherent</span><span class="id"> =&gt;</span><span class="id"> /</span>(_<span class="id"> _</span><span class="id"> s0</span>)<span class="id">[_/=</span><span class="id"> [A</span><span class="id"> EA]</span><span class="id"> &lt;-]</span><span class="id"> ?;</span><span class="gallina-kwd"> exists</span><span class="id"> A</span>.<br/>
<span class="id">pose</span><span class="id"> A</span><span class="id"> n</span><span class="id"> :=</span><span class="id"> projT1</span> (<span class="id">cid2</span> (<span class="id">coverE</span><span class="id"> _</span> (<span class="id">inv0</span><span class="id"> n</span>))).<br/>
<span class="id">have</span><span class="id"> mA</span><span class="id"> k</span><span class="id"> :</span><span class="id"> @measurable_cover</span><span class="id"> _</span> (<span class="id">ocitv_type</span><span class="id"> R</span>)<span class="id"> E</span> (<span class="id">A</span><span class="id"> k</span>).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /A;</span><span class="id"> case:</span><span class="id"> cid2</span>.<br/>
<span class="id">have</span><span class="id"> mA_E</span><span class="id"> n</span><span class="id"> :</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">\sum_</span>(<span class="id">0</span><span class="id"> &lt;=</span><span class="id"> k</span><span class="id"> &lt;oo</span>)<span class="id"> hlength</span> (<span class="id">A</span><span class="id"> n</span><span class="id"> k</span>)<span class="id"> &lt;</span><span class="id"> completed_mu</span><span class="id"> E</span><span class="id"> +</span><span class="id"> n</span>.<span class="id">+1%:R^-1%:E</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /A;</span><span class="id"> case:</span><span class="id"> cid2</span>.<br/>
<span class="id">pose</span><span class="id"> F_</span><span class="id"> n</span><span class="id"> :=</span><span class="id"> \bigcup_m</span> (<span class="id">A</span><span class="id"> n</span><span class="id"> m</span>).<br/>
<span class="id">have</span><span class="id"> EF_n</span><span class="id"> n</span><span class="id"> :</span><span class="id"> E</span><span class="id"> `&lt;=`</span><span class="id"> F_</span><span class="id"> n</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> [/=</span><span class="id"> _]</span><span class="id"> :=</span><span class="id"> mA</span><span class="id"> n</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> /subset_trans;</span><span class="id"> apply;</span><span class="id"> apply:</span><span class="id"> subset_bigcup</span><span class="id"> =&gt;</span><span class="id"> i</span><span class="id"> _</span>.<br/>
<span class="id">have</span><span class="id"> mF_</span><span class="id"> m</span><span class="id"> :</span><span class="id"> mu</span> (<span class="id">F_</span><span class="id"> m</span>)<span class="id"> &lt;</span><span class="id"> completed_mu</span><span class="id"> E</span><span class="id"> +</span><span class="id"> m</span>.<span class="id">+1%:R^-1%:E</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span> (<span class="id">le_lt_trans</span><span class="id"> _</span> (<span class="id">mA_E</span><span class="id"> m</span>)).<br/>
&nbsp;&nbsp;<span class="id">apply:</span> (<span class="id">le_trans</span> (<span class="id">outer_measure_sigma_subadditive</span><span class="id"> hlength^*%mu</span> (<span class="id">A</span><span class="id"> m</span>))).<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> lee_nneseries</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> n</span><span class="id"> _</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -</span>((<span class="id">measurable_mu_extE</span><span class="id"> hlength</span>) (<span class="id">A</span><span class="id"> m</span><span class="id"> n</span>))<span class="id">//;</span><span class="id"> have</span><span class="id"> [/</span>(_<span class="id"> n</span>)<span class="id">]</span><span class="id"> :=</span><span class="id"> mA</span><span class="id"> m</span>.<br/>
<span class="id">pose</span><span class="id"> F</span><span class="id"> :=</span><span class="id"> \bigcap_n</span> (<span class="id">F_</span><span class="id"> n</span>).<br/>
<span class="id">have</span><span class="id"> FM</span><span class="id"> :</span><span class="id"> @measurable</span><span class="id"> _</span> (<span class="id">g_sigma_algebraType</span><span class="id"> R</span>.<span class="id">-ocitv</span>.<span class="id">-measurable</span>)<span class="id"> F</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> bigcapT_measurable</span><span class="id"> =&gt;</span><span class="id"> k;</span><span class="id"> apply:</span><span class="id"> bigcupT_measurable</span><span class="id"> =&gt;</span><span class="id"> i</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> sub_sigma_algebra;</span><span class="id"> have</span><span class="id"> [/</span>(_<span class="id"> i</span>)<span class="id">]</span><span class="id"> :=</span><span class="id"> mA</span><span class="id"> k</span>.<br/>
<span class="id">have</span><span class="id"> EF</span><span class="id"> :</span><span class="id"> E</span><span class="id"> `&lt;=`</span><span class="id"> F</span><span class="gallina-kwd"> by</span><span class="id"> exact:</span><span class="id"> sub_bigcap</span>.<br/>
<span class="id">have</span><span class="id"> muEF</span><span class="id"> :</span><span class="id"> completed_mu</span><span class="id"> E</span><span class="id"> =</span><span class="id"> mu</span><span class="id"> F</span>.<br/>
&nbsp;&nbsp;<span class="id">apply/eqP;</span><span class="id"> rewrite</span><span class="id"> eq_le</span><span class="id"> le_outer_measure//=</span>.<br/>
&nbsp;&nbsp;<span class="id">apply/lee_addgt0Pr</span><span class="id"> =&gt;</span><span class="id"> /=</span><span class="id"> _/posnumP[e];</span><span class="id"> near</span><span class="id"> \oo</span><span class="id"> =&gt;</span><span class="id"> n</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span> (<span class="id">@le_trans</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">mu</span> (<span class="id">F_</span><span class="id"> n</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> le_outer_measure;</span><span class="id"> exact:</span><span class="id"> bigcap_inf</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> (<span class="id">le_trans</span> (<span class="id">ltW</span> (<span class="id">mF_</span><span class="id"> n</span>)))<span class="id">//</span><span class="id"> leeD//</span><span class="id"> lee_fin</span><span class="id"> ltW//</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> near:</span><span class="id"> n;</span><span class="id"> apply:</span><span class="id"> near_infty_natSinv_lt</span>.<br/>
<span class="id">have</span><span class="id"> coverEF</span><span class="id"> s</span><span class="id"> :</span> (<span class="id">0</span><span class="id"> &lt;</span><span class="id"> s</span>)<span class="id">%R</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">exists2</span><span class="id"> A,</span><span class="id"> @measurable_cover</span><span class="id"> _</span> (<span class="id">ocitv_type</span><span class="id"> R</span>) (<span class="id">F</span><span class="id"> `\`</span><span class="id"> E</span>)<span class="id"> A</span><span class="id"> &amp;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">\sum_</span>(<span class="id">0</span><span class="id"> &lt;=</span><span class="id"> k</span><span class="id"> &lt;oo</span>)<span class="id"> hlength</span> (<span class="id">A</span><span class="id"> k</span>)<span class="id"> &lt;</span><span class="id"> completed_mu</span> (<span class="id">F</span><span class="id"> `\`</span><span class="id"> E</span>)<span class="id"> +</span><span class="id"> s%:E</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> s0</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> :</span><span class="id"> mu</span> (<span class="id">F</span><span class="id"> `\`</span><span class="id"> E</span>)<span class="id"> \is</span><span class="id"> a</span><span class="id"> fin_num</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> ge0_fin_numE//</span> (<span class="id">@le_lt_trans</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">mu</span><span class="id"> F</span>))<span class="id">//;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> -muEF</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> le_outer_measure;</span><span class="id"> exact:</span><span class="id"> subDsetl</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move/lb_ereal_inf_adherent</span><span class="id"> =&gt;</span><span class="id"> /</span>(_<span class="id"> _</span><span class="id"> s0</span>)<span class="id">[_/=</span><span class="id"> [B</span><span class="id"> FEB]</span><span class="id"> &lt;-]</span><span class="id"> ?;</span><span class="gallina-kwd"> exists</span><span class="id"> B</span>.<br/>
<span class="id">pose</span><span class="id"> B</span><span class="id"> n</span><span class="id"> :=</span><span class="id"> projT1</span> (<span class="id">cid2</span> (<span class="id">coverEF</span><span class="id"> _</span> (<span class="id">inv0</span><span class="id"> n</span>))).<br/>
<span class="id">have</span><span class="id"> mB</span><span class="id"> k</span><span class="id"> :</span><span class="id"> @measurable_cover</span><span class="id"> _</span> (<span class="id">ocitv_type</span><span class="id"> R</span>) (<span class="id">F</span><span class="id"> `\`</span><span class="id"> E</span>) (<span class="id">B</span><span class="id"> k</span>).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /B;</span><span class="id"> case:</span><span class="id"> cid2</span>.<br/>
<span class="id">have</span><span class="id"> mB_FE</span><span class="id"> n</span><span class="id"> :</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">\sum_</span>(<span class="id">0</span><span class="id"> &lt;=</span><span class="id"> k</span><span class="id"> &lt;oo</span>)<span class="id"> hlength</span> (<span class="id">B</span><span class="id"> n</span><span class="id"> k</span>)<span class="id"> &lt;</span><span class="id"> completed_mu</span> (<span class="id">F</span><span class="id"> `\`</span><span class="id"> E</span>)<span class="id"> +</span><span class="id"> n</span>.<span class="id">+1%:R^-1%:E</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /B;</span><span class="id"> case:</span><span class="id"> cid2</span>.<br/>
<span class="id">pose</span><span class="id"> G_</span><span class="id"> n</span><span class="id"> :=</span><span class="id"> \bigcup_m</span> (<span class="id">B</span><span class="id"> n</span><span class="id"> m</span>).<br/>
<span class="id">have</span><span class="id"> FEG_n</span><span class="id"> n</span><span class="id"> :</span><span class="id"> F</span><span class="id"> `\`</span><span class="id"> E</span><span class="id"> `&lt;=`</span><span class="id"> G_</span><span class="id"> n</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> [/=</span><span class="id"> _]</span><span class="id"> :=</span><span class="id"> mB</span><span class="id"> n</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> /subset_trans;</span><span class="id"> apply;</span><span class="id"> apply:</span><span class="id"> subset_bigcup</span><span class="id"> =&gt;</span><span class="id"> i</span><span class="id"> _</span>.<br/>
<span class="id">have</span><span class="id"> mG_</span><span class="id"> m</span><span class="id"> :</span><span class="id"> mu</span> (<span class="id">G_</span><span class="id"> m</span>)<span class="id"> &lt;</span><span class="id"> completed_mu</span> (<span class="id">F</span><span class="id"> `\`</span><span class="id"> E</span>)<span class="id"> +</span><span class="id"> m</span>.<span class="id">+1%:R^-1%:E</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span> (<span class="id">le_lt_trans</span><span class="id"> _</span> (<span class="id">mB_FE</span><span class="id"> m</span>)).<br/>
&nbsp;&nbsp;<span class="id">apply:</span> (<span class="id">le_trans</span> (<span class="id">outer_measure_sigma_subadditive</span><span class="id"> hlength^*%mu</span> (<span class="id">B</span><span class="id"> m</span>))).<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> lee_nneseries</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> n</span><span class="id"> _</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -</span>((<span class="id">measurable_mu_extE</span><span class="id"> hlength</span>) (<span class="id">B</span><span class="id"> m</span><span class="id"> n</span>))<span class="id">//;</span><span class="id"> have</span><span class="id"> [/</span>(_<span class="id"> n</span>)<span class="id">]</span><span class="id"> :=</span><span class="id"> mB</span><span class="id"> m</span>.<br/>
<span class="id">pose</span><span class="id"> G</span><span class="id"> :=</span><span class="id"> \bigcap_n</span> (<span class="id">G_</span><span class="id"> n</span>).<br/>
<span class="id">have</span><span class="id"> GM</span><span class="id"> :</span><span class="id"> @measurable</span><span class="id"> _</span> (<span class="id">g_sigma_algebraType</span><span class="id"> R</span>.<span class="id">-ocitv</span>.<span class="id">-measurable</span>)<span class="id"> G</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> bigcapT_measurable</span><span class="id"> =&gt;</span><span class="id"> k;</span><span class="id"> apply:</span><span class="id"> bigcupT_measurable</span><span class="id"> =&gt;</span><span class="id"> i</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> sub_sigma_algebra;</span><span class="id"> have</span><span class="id"> [/</span>(_<span class="id"> i</span>)<span class="id">]</span><span class="id"> :=</span><span class="id"> mB</span><span class="id"> k</span>.<br/>
<span class="id">have</span><span class="id"> FEG</span><span class="id"> :</span><span class="id"> F</span><span class="id"> `\`</span><span class="id"> E</span><span class="id"> `&lt;=`</span><span class="id"> G</span><span class="gallina-kwd"> by</span><span class="id"> exact:</span><span class="id"> sub_bigcap</span>.<br/>
<span class="id">have</span><span class="id"> muG</span><span class="id"> :</span><span class="id"> mu</span><span class="id"> G</span><span class="id"> =</span><span class="id"> 0</span>.<br/>
&nbsp;&nbsp;<span class="id">transitivity</span> (<span class="id">completed_mu</span> (<span class="id">F</span><span class="id"> `\`</span><span class="id"> E</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply/eqP;</span><span class="id"> rewrite</span><span class="id"> eq_le;</span><span class="id"> apply/andP;</span><span class="id"> split;</span><span class="id"> last</span><span class="id"> exact:</span><span class="id"> le_outer_measure</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply/lee_addgt0Pr</span><span class="id"> =&gt;</span><span class="id"> _/posnumP[e]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">near</span><span class="id"> \oo</span><span class="id"> =&gt;</span><span class="id"> n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span> (<span class="id">@le_trans</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">mu</span> (<span class="id">G_</span><span class="id"> n</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> le_outer_measure;</span><span class="id"> exact:</span><span class="id"> bigcap_inf</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> (<span class="id">le_trans</span> (<span class="id">ltW</span> (<span class="id">mG_</span><span class="id"> n</span>)))<span class="id">//</span><span class="id"> leeD//</span><span class="id"> lee_fin</span><span class="id"> ltW//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> near:</span><span class="id"> n;</span><span class="id"> apply:</span><span class="id"> near_infty_natSinv_lt</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> measureD//=</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> setIidr//</span><span class="id"> muEF</span><span class="id"> subee//</span><span class="id"> ge0_fin_numE//;</span><span class="id"> move:</span><span class="id"> mEoo;</span><span class="id"> rewrite</span><span class="id"> muEF</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="id"> exact:</span><span class="id"> sub_caratheodory</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> move:</span><span class="id"> mEoo;</span><span class="id"> rewrite</span><span class="id"> muEF</span>.<br/>
<span class="id">apply:</span><span class="id"> sub_sigma_algebra;</span><span class="gallina-kwd"> exists</span> (<span class="id">F</span><span class="id"> `\`</span><span class="id"> G</span>)<span class="id">;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> measurableD</span>.<br/>
<span class="gallina-kwd">exists</span> (<span class="id">E</span><span class="id"> `&amp;`</span><span class="id"> G</span>).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span> (<span class="id">@negligibleS</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> mu</span><span class="id"> G</span><span class="id"> _</span> (<span class="id">@subIsetr</span><span class="id"> _</span><span class="id"> E</span><span class="id"> G</span>))<span class="id">;</span><span class="gallina-kwd"> exists</span><span class="id"> G;</span><span class="id"> split</span>.<br/>
<span class="id">apply/seteqP;</span><span class="id"> split=&gt;</span><span class="id"> [/=</span><span class="id"> x</span><span class="id"> [[Fx</span><span class="id"> Gx]|[]//]|x</span><span class="id"> Ex]</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> -</span>(<span class="id">notK</span> (<span class="id">E</span><span class="id"> x</span>))<span class="id"> =&gt;</span><span class="id"> Ex;</span><span class="id"> apply:</span><span class="id"> Gx;</span><span class="id"> exact:</span><span class="id"> FEG</span>.<br/>
<span class="id">-</span><span class="id"> have</span><span class="id"> [|FGx]</span><span class="id"> :=</span><span class="id"> pselect</span> ((<span class="id">F</span><span class="id"> `\`</span><span class="id"> G</span>)<span class="id"> x</span>)<span class="id">;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> left</span>.<br/>
&nbsp;&nbsp;<span class="id">right;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="id">move/not_andP</span><span class="id"> :</span><span class="id"> FGx</span><span class="id"> =&gt;</span><span class="id"> [|]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> have</span><span class="id"> :=</span><span class="id"> EF</span><span class="id"> _</span><span class="id"> Ex</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> notK</span>.<br/>
<span class="id">Unshelve</span>.<span class="id"> all:</span><span class="gallina-kwd"> by</span><span class="id"> end_near</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> g_sigma_completed_algebra_genE</span><span class="id"> :</span><br/>
&nbsp;&nbsp;(<span class="id">completed_algebra_gen</span><span class="id"> mu</span>).<span class="id">-sigma</span>.<span class="id">-measurable</span><span class="id"> =</span><span class="id"> completed_algebra_gen</span><span class="id"> mu</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">apply/seteqP;</span><span class="id"> split;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> _</span><span class="id"> [/=</span><span class="id"> A</span><span class="id"> /=</span><span class="id"> mA</span><span class="id"> [N</span><span class="id"> neglN]]</span><span class="id"> &lt;-</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> sub_sigma_algebra;</span><span class="gallina-kwd"> exists</span><span class="id"> A</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="gallina-kwd"> exists</span><span class="id"> N</span>.<br/>
<span class="id">apply:</span><span class="id"> smallest_sub</span><span class="id"> =&gt;</span><span class="id"> //=;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> /=</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="gallina-kwd"> exists</span><span class="id"> set0</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="gallina-kwd"> exists</span><span class="id"> set0;</span><span class="id"> [exact:</span><span class="id"> negligible_set0|rewrite</span><span class="id"> setU0]</span>.<br/>
<span class="id">-</span><span class="id"> move=&gt;</span><span class="id"> G</span><span class="id"> [/=</span><span class="id"> A</span><span class="id"> mA</span><span class="id"> [N</span><span class="id"> negN</span><span class="id"> ANG]];</span><span class="id"> case:</span><span class="id"> negN</span><span class="id"> =&gt;</span><span class="id"> /=</span><span class="id"> F</span><span class="id"> [mF</span><span class="id"> F0</span><span class="id"> NF]</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> GANA</span><span class="id"> :</span><span class="id"> ~`</span><span class="id"> G</span><span class="id"> =</span><span class="id"> ~`</span><span class="id"> A</span><span class="id"> `\`</span> (<span class="id">N</span><span class="id"> `&amp;`</span><span class="id"> ~`</span><span class="id"> A</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -ANG</span><span class="id"> setCU</span><span class="id"> setDE</span><span class="id"> setCI</span><span class="id"> setCK</span><span class="id"> setIUr</span><span class="id"> setICl</span><span class="id"> setU0</span>.<br/>
&nbsp;&nbsp;<span class="id">pose</span><span class="id"> AA</span><span class="id"> :=</span><span class="id"> ~`</span><span class="id"> A</span><span class="id"> `\`</span> (<span class="id">F</span><span class="id"> `&amp;`</span><span class="id"> ~`</span><span class="id"> A</span>).<br/>
&nbsp;&nbsp;<span class="id">pose</span><span class="id"> NN</span><span class="id"> :=</span> (<span class="id">F</span><span class="id"> `&amp;`</span><span class="id"> ~`</span><span class="id"> A</span>)<span class="id"> `\`</span> (<span class="id">N</span><span class="id"> `&amp;`</span><span class="id"> ~`</span><span class="id"> A</span>).<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> GAANN</span><span class="id"> :</span><span class="id"> ~`</span><span class="id"> G</span><span class="id"> =</span><span class="id"> AA</span><span class="id"> `|`</span><span class="id"> NN</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> (_<span class="id"> :</span><span class="id"> ~`</span><span class="id"> G</span><span class="id"> =</span><span class="id"> ~`</span><span class="id"> A</span><span class="id"> `\`</span> (<span class="id">N</span><span class="id"> `&amp;`</span><span class="id"> ~`</span><span class="id"> A</span>))<span class="id">//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> setDU;</span><span class="id"> [exact:</span><span class="id"> setSI|exact:</span><span class="id"> subIsetr]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">exists</span><span class="id"> AA</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> measurableI</span><span class="id"> =&gt;</span><span class="id"> //=;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> measurableC</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> measurableC;</span><span class="id"> apply:</span><span class="id"> measurableI</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> measurableC</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="gallina-kwd"> exists</span><span class="id"> NN;</span><span class="id"> [exists</span><span class="id"> F;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> x</span><span class="id"> []</span><span class="id"> []|rewrite</span><span class="id"> setDE</span><span class="id"> setTI]</span>.<br/>
<span class="id">-</span><span class="id"> move=&gt;</span><span class="id"> F</span><span class="id"> mF/=</span>.<br/>
&nbsp;&nbsp;<span class="id">pose</span><span class="id"> A</span><span class="id"> n</span><span class="id"> :=</span><span class="id"> projT1</span> (<span class="id">cid2</span> (<span class="id">mF</span><span class="id"> n</span>)).<br/>
&nbsp;&nbsp;<span class="id">pose</span><span class="id"> N</span><span class="id"> n</span><span class="id"> :=</span><span class="id"> projT1</span> (<span class="id">cid2</span> (<span class="id">projT2</span> (<span class="id">cid2</span> (<span class="id">mF</span><span class="id"> n</span>))).<span class="id">2</span>).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">exists</span> (<span class="id">\bigcup_k</span><span class="id"> A</span><span class="id"> k</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> bigcupT_measurable</span><span class="id"> =&gt;</span><span class="id"> i;</span><span class="id"> rewrite</span><span class="id"> /A;</span><span class="id"> case:</span><span class="id"> cid2</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">exists</span> (<span class="id">\bigcup_k</span><span class="id"> N</span><span class="id"> k</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> negligible_bigcup</span><span class="id"> =&gt;</span><span class="id"> /=</span><span class="id"> k</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /N;</span><span class="id"> case:</span> (<span class="id">cid2</span> (<span class="id">mF</span><span class="id"> k</span>))<span class="id"> =&gt;</span><span class="id"> //=</span><span class="id"> *;</span><span class="id"> case:</span><span class="id"> cid2</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -bigcupU;</span><span class="id"> apply:</span><span class="id"> eq_bigcup</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> i</span><span class="id"> _</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /A</span><span class="id"> /N;</span><span class="id"> case:</span> (<span class="id">cid2</span> (<span class="id">mF</span><span class="id"> i</span>))<span class="id"> =&gt;</span><span class="id"> //=</span><span class="id"> *;</span><span class="id"> case:</span><span class="id"> cid2</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> negligible_sub_caratheodory</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">completed_mu</span>.<span class="id">-negligible</span><span class="id"> `&lt;=`</span><span class="id"> hlength^*%mu</span>.<span class="id">-cara</span>.<span class="id">-measurable</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> N</span><span class="id"> /=</span><span class="id"> [/=</span><span class="id"> A]</span><span class="id"> [mA</span><span class="id"> A0</span><span class="id"> NA]</span>.<br/>
<span class="id">apply:</span><span class="id"> le_caratheodory_measurable</span><span class="id"> =&gt;</span><span class="id"> /=</span><span class="id"> X</span>.<br/>
<span class="id">apply:</span> (<span class="id">@le_trans</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">hlength^*%mu</span><span class="id"> N</span><span class="id"> +</span><span class="id"> hlength^*%mu</span> (<span class="id">X</span><span class="id"> `&amp;`</span><span class="id"> ~`</span><span class="id"> N</span>))).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> leeD2r//</span><span class="id"> le_outer_measure//;</span><span class="id"> exact:</span><span class="id"> subIsetr</span>.<br/>
<span class="id">have</span><span class="id"> -&gt;</span><span class="id"> :</span><span class="id"> hlength^*%mu</span><span class="id"> N</span><span class="id"> =</span><span class="id"> 0</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply/eqP;</span><span class="id"> rewrite</span><span class="id"> eq_le</span><span class="id"> outer_measure_ge0//=</span><span class="id"> andbT</span><span class="id"> -A0</span><span class="id"> le_outer_measure</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> add0e//</span><span class="id"> le_outer_measure//;</span><span class="id"> exact:</span><span class="id"> subIsetl</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Let</span><span class="id"> calgebra_sub_cara</span><span class="id"> :</span> (<span class="id">completed_algebra_gen</span><span class="id"> mu</span>).<span class="id">-sigma</span>.<span class="id">-measurable</span><span class="id"> `&lt;=`</span><br/>
&nbsp;&nbsp;<span class="id">hlength^*%mu</span>.<span class="id">-cara</span>.<span class="id">-measurable</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> g_sigma_completed_algebra_genE</span><span class="id"> =&gt;</span><span class="id"> A</span><span class="id"> -[/=</span><span class="id"> X</span><span class="id"> mX]</span><span class="id"> [N</span><span class="id"> negN]</span><span class="id"> &lt;-{A}</span>.<br/>
<span class="id">apply:</span><span class="id"> measurableU</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> sub_caratheodory</span>.<br/>
<span class="id">apply:</span><span class="id"> negligible_sub_caratheodory;</span><span class="id"> case:</span><span class="id"> negN</span><span class="id"> =&gt;</span><span class="id"> /=</span><span class="id"> B</span><span class="id"> [mB</span><span class="id"> B0</span><span class="id"> NB]</span>.<br/>
<span class="gallina-kwd">by</span><span class="gallina-kwd"> exists</span><span class="id"> B;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //=;</span><span class="id"> exact:</span><span class="id"> sub_caratheodory</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> completed_caratheodory_measurable</span><span class="id"> :</span><br/>
&nbsp;&nbsp;(<span class="id">completed_algebra_gen</span><span class="id"> mu</span>).<span class="id">-sigma</span>.<span class="id">-measurable</span><span class="id"> =</span><br/>
&nbsp;&nbsp;<span class="id">hlength^*%mu</span>.<span class="id">-cara</span>.<span class="id">-measurable</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd">by</span><span class="id"> apply/seteqP;</span><span class="id"> split;</span><span class="id"> [exact:</span><span class="id"> calgebra_sub_cara</span><span class="id"> |</span><span class="id"> exact:</span><span class="id"> cara_sub_calgebra]</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> completed_algebra_caratheodory</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> elebesgue_measure</span>.<br/>
<span class="vernacular">Variable</span><span class="id"> R</span><span class="id"> :</span><span class="id"> realType</span>.<br/>
<br/>
<span class="vernacular">Definition</span><span class="id"> elebesgue_measure</span><span class="id"> :</span><span class="id"> set</span><span class="id"> \bar</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> \bar</span><span class="id"> R</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">fun</span><span class="id"> S</span><span class="id"> =&gt;</span><span class="id"> lebesgue_measure</span> (<span class="id">fine</span><span class="id"> @`</span> (<span class="id">S</span><span class="id"> `\`</span><span class="id"> [set</span><span class="id"> -oo;</span><span class="id"> +oo]%E</span>)).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> elebesgue_measure0</span><span class="id"> :</span><span class="id"> elebesgue_measure</span><span class="id"> set0</span><span class="id"> =</span><span class="id"> 0%E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> /elebesgue_measure</span><span class="id"> set0D</span><span class="id"> image_set0</span><span class="id"> measure0</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> elebesgue_measure_ge0</span><span class="id"> X</span><span class="id"> :</span> (<span class="id">0</span><span class="id"> &lt;=</span><span class="id"> elebesgue_measure</span><span class="id"> X</span>)<span class="id">%E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id"> exact/measure_ge0</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> semi_sigma_additive_elebesgue_measure</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">semi_sigma_additive</span><span class="id"> elebesgue_measure</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> /=</span><span class="id"> F</span><span class="id"> mF</span><span class="id"> tF</span><span class="id"> mUF;</span><span class="id"> rewrite</span><span class="id"> /elebesgue_measure</span>.<br/>
<span class="id">rewrite</span><span class="id"> [X</span><span class="gallina-kwd"> in</span><span class="id"> lebesgue_measure</span><span class="id"> X]</span>(_<span class="id"> :</span><span class="id"> _</span><span class="id"> =</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">\bigcup_n</span> (<span class="id">fine</span><span class="id"> @`</span> (<span class="id">F</span><span class="id"> n</span><span class="id"> `\`</span><span class="id"> [set</span><span class="id"> -oo;</span><span class="id"> +oo]%E</span>)))<span class="id">;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> predeqE</span><span class="id"> =&gt;</span><span class="id"> r;</span><span class="id"> split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> [x</span><span class="id"> [[n</span><span class="id"> _</span><span class="id"> Fnx</span><span class="id"> xoo</span><span class="id"> &lt;-]]];</span><span class="gallina-kwd"> exists</span><span class="id"> n</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="gallina-kwd"> exists</span><span class="id"> x</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> [n</span><span class="id"> _</span><span class="id"> [x</span><span class="id"> [Fnx</span><span class="id"> xoo</span><span class="id"> &lt;-{r}]]];</span><span class="gallina-kwd"> exists</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="gallina-kwd"> exists</span><span class="id"> n</span>.<br/>
<span class="id">apply:</span> (<span class="id">@measure_semi_sigma_additive</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">@lebesgue_measure</span><span class="id"> R</span>)<br/>
&nbsp;&nbsp;(<span class="gallina-kwd">fun</span><span class="id"> n</span><span class="id"> =&gt;</span><span class="id"> fine</span><span class="id"> @`</span> (<span class="id">F</span><span class="id"> n</span><span class="id"> `\`</span><span class="id"> [set</span><span class="id"> -oo;</span><span class="id"> +oo]%E</span>))).<br/>
<span class="id">-</span><span class="id"> move=&gt;</span><span class="id"> n;</span><span class="id"> have</span><span class="id"> :=</span><span class="id"> mF</span><span class="id"> n</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> [X</span><span class="id"> mX</span><span class="id"> [X'</span><span class="id"> mX']]</span><span class="id"> XX'Fn</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> measurable_image_fine</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -XX'Fn</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> measurableU;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> measurable_image_EFin</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> case:</span><span class="id"> mX'</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> measurableU</span>.<br/>
<span class="id">-</span><span class="id"> move=&gt;</span><span class="id"> i</span><span class="id"> j</span><span class="id"> _</span><span class="id"> _</span><span class="id"> [x</span><span class="id"> [[a</span><span class="id"> [Fia</span><span class="id"> aoo</span><span class="id"> ax]</span><span class="id"> [b</span><span class="id"> [Fjb</span><span class="id"> boo]</span><span class="id"> bx]]]]</span>.<br/>
&nbsp;&nbsp;<span class="id">move:</span><span class="id"> tF</span><span class="id"> =&gt;</span><span class="id"> /</span>(_<span class="id"> i</span><span class="id"> j</span><span class="id"> Logic</span>.<span class="id">I</span><span class="id"> Logic</span>.<span class="id">I</span>)<span class="id">;</span><span class="id"> apply</span>.<br/>
&nbsp;&nbsp;<span class="id">suff</span><span class="id"> ab</span><span class="id"> :</span><span class="id"> a</span><span class="id"> =</span><span class="id"> b</span><span class="gallina-kwd"> by</span><span class="gallina-kwd"> exists</span><span class="id"> a;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> rewrite</span><span class="id"> ab</span>.<br/>
&nbsp;&nbsp;<span class="id">move:</span><span class="id"> a</span><span class="id"> b</span><span class="id"> {Fia</span><span class="id"> Fjb}</span><span class="id"> aoo</span><span class="id"> boo</span><span class="id"> ax</span><span class="id"> bx</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> [a|</span><span class="id"> |]</span><span class="id"> [b|</span><span class="id"> |]</span><span class="id"> /=</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> _</span><span class="id"> _</span><span class="id"> -&gt;</span><span class="id"> -&gt;</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> not_orP</span><span class="id"> =&gt;</span><span class="id"> -[_]/</span>(_<span class="id"> erefl</span>).<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> not_orP</span><span class="id"> =&gt;</span><span class="id"> -[]/</span>(_<span class="id"> erefl</span>).<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> not_orP</span><span class="id"> =&gt;</span><span class="id"> -[_]/</span>(_<span class="id"> erefl</span>).<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> not_orP</span><span class="id"> =&gt;</span><span class="id"> -[_]/</span>(_<span class="id"> erefl</span>).<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> not_orP</span><span class="id"> =&gt;</span><span class="id"> -[_]/</span>(_<span class="id"> erefl</span>).<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> not_orP</span><span class="id"> =&gt;</span><span class="id"> -[]/</span>(_<span class="id"> erefl</span>).<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> not_orP</span><span class="id"> =&gt;</span><span class="id"> -[]/</span>(_<span class="id"> erefl</span>).<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> not_orP</span><span class="id"> =&gt;</span><span class="id"> -[]/</span>(_<span class="id"> erefl</span>).<br/>
<span class="id">-</span><span class="id"> move:</span><span class="id"> mUF</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> {1}/measurable</span><span class="id"> /emeasurable</span><span class="id"> /=</span><span class="id"> =&gt;</span><span class="id"> -[X</span><span class="id"> mX</span><span class="id"> [Y</span><span class="id"> []]]</span><span class="id"> {Y}</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> rewrite</span><span class="id"> setU0</span><span class="id"> =&gt;</span><span class="id"> h</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> [X</span><span class="gallina-kwd"> in</span><span class="id"> measurable</span><span class="id"> X]</span>(_<span class="id"> :</span><span class="id"> _</span><span class="id"> =</span><span class="id"> X</span>)<span class="id"> //</span><span class="id"> predeqE</span><span class="id"> =&gt;</span><span class="id"> r;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> [|Xr]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> -[n</span><span class="id"> _</span><span class="id"> [x</span><span class="id"> [Fnx</span><span class="id"> xoo</span><span class="id"> &lt;-{r}]]]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">have</span><span class="id"> :</span> (<span class="id">\bigcup_n</span><span class="id"> F</span><span class="id"> n</span>)<span class="id"> x</span><span class="gallina-kwd"> by</span><span class="gallina-kwd"> exists</span><span class="id"> n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -h</span><span class="id"> =&gt;</span><span class="id"> -[x'</span><span class="id"> Xx'</span><span class="id"> &lt;-]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">have</span><span class="id"> [n</span><span class="id"> _</span><span class="id"> Fnr]</span><span class="id"> :</span> (<span class="id">\bigcup_n</span><span class="id"> F</span><span class="id"> n</span>)<span class="id"> r%:E</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> -h;</span><span class="gallina-kwd"> exists</span><span class="id"> r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="gallina-kwd"> exists</span><span class="id"> n</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="gallina-kwd"> exists</span><span class="id"> r%:E</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> case</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> move=&gt;</span><span class="id"> h</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> [X</span><span class="gallina-kwd"> in</span><span class="id"> measurable</span><span class="id"> X]</span>(_<span class="id"> :</span><span class="id"> _</span><span class="id"> =</span><span class="id"> X</span>)<span class="id"> //</span><span class="id"> predeqE</span><span class="id"> =&gt;</span><span class="id"> r;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> [|Xr]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> -[n</span><span class="id"> _</span><span class="id"> [x</span><span class="id"> [Fnx</span><span class="id"> xoo</span><span class="id"> &lt;-]]]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">have</span><span class="id"> :</span> (<span class="id">\bigcup_n</span><span class="id"> F</span><span class="id"> n</span>)<span class="id"> x</span><span class="gallina-kwd"> by</span><span class="gallina-kwd"> exists</span><span class="id"> n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -h</span><span class="id"> =&gt;</span><span class="id"> -[[x'</span><span class="id"> Xx'</span><span class="id"> &lt;-//]|xoo'];</span><span class="id"> move/not_orP</span><span class="id"> :</span><span class="id"> xoo</span><span class="id"> =&gt;</span><span class="id"> -[]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">have</span><span class="id"> [n</span><span class="id"> _</span><span class="id"> Fnr]</span><span class="id"> :</span> (<span class="id">\bigcup_n</span><span class="id"> F</span><span class="id"> n</span>)<span class="id"> r%:E</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> -h;</span><span class="id"> left;</span><span class="gallina-kwd"> exists</span><span class="id"> r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="gallina-kwd"> exists</span><span class="id"> n</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="gallina-kwd"> exists</span><span class="id"> r%:E</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> case</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span> <span class="comment">(*&nbsp;NB:&nbsp;almost&nbsp;the&nbsp;same&nbsp;as&nbsp;the&nbsp;previous&nbsp;one,&nbsp;factorize?*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> h</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> [X</span><span class="gallina-kwd"> in</span><span class="id"> measurable</span><span class="id"> X]</span>(_<span class="id"> :</span><span class="id"> _</span><span class="id"> =</span><span class="id"> X</span>)<span class="id"> //</span><span class="id"> predeqE</span><span class="id"> =&gt;</span><span class="id"> r;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> [|Xr]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> -[n</span><span class="id"> _</span><span class="id"> [x</span><span class="id"> [Fnx</span><span class="id"> xoo</span><span class="id"> &lt;-]]]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">have</span><span class="id"> :</span> (<span class="id">\bigcup_n</span><span class="id"> F</span><span class="id"> n</span>)<span class="id"> x</span><span class="gallina-kwd"> by</span><span class="gallina-kwd"> exists</span><span class="id"> n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -h</span><span class="id"> =&gt;</span><span class="id"> -[[x'</span><span class="id"> Xx'</span><span class="id"> &lt;-//]|xoo'];</span><span class="id"> move/not_orP</span><span class="id"> :</span><span class="id"> xoo</span><span class="id"> =&gt;</span><span class="id"> -[]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">have</span><span class="id"> [n</span><span class="id"> _</span><span class="id"> Fnr]</span><span class="id"> :</span> (<span class="id">\bigcup_n</span><span class="id"> F</span><span class="id"> n</span>)<span class="id"> r%:E</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> -h;</span><span class="id"> left;</span><span class="gallina-kwd"> exists</span><span class="id"> r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="gallina-kwd"> exists</span><span class="id"> n</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="gallina-kwd"> exists</span><span class="id"> r%:E</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> case</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> move=&gt;</span><span class="id"> h</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> [X</span><span class="gallina-kwd"> in</span><span class="id"> measurable</span><span class="id"> X]</span>(_<span class="id"> :</span><span class="id"> _</span><span class="id"> =</span><span class="id"> X</span>)<span class="id"> //</span><span class="id"> predeqE</span><span class="id"> =&gt;</span><span class="id"> r;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> [|Xr]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> -[n</span><span class="id"> _</span><span class="id"> [x</span><span class="id"> [Fnx</span><span class="id"> xoo</span><span class="id"> &lt;-]]]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">have</span><span class="id"> :</span> (<span class="id">\bigcup_n</span><span class="id"> F</span><span class="id"> n</span>)<span class="id"> x</span><span class="gallina-kwd"> by</span><span class="gallina-kwd"> exists</span><span class="id"> n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -h</span><span class="id"> =&gt;</span><span class="id"> -[[x'</span><span class="id"> Xx'</span><span class="id"> &lt;-//]|]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">have</span><span class="id"> [n</span><span class="id"> _</span><span class="id"> Fnr]</span><span class="id"> :</span> (<span class="id">\bigcup_n</span><span class="id"> F</span><span class="id"> n</span>)<span class="id"> r%:E</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> -h;</span><span class="id"> left;</span><span class="gallina-kwd"> exists</span><span class="id"> r</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="gallina-kwd"> exists</span><span class="id"> n</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="gallina-kwd"> exists</span><span class="id"> r%:E</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> case</span>.<br/>
Qed.</div></details>
<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> isMeasure</span>.<span class="id">Build</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> elebesgue_measure</span><br/>
&nbsp;&nbsp;<span class="id">elebesgue_measure0</span><span class="id"> elebesgue_measure_ge0</span><br/>
&nbsp;&nbsp;<span class="id">semi_sigma_additive_elebesgue_measure</span>.<br/>
<br/>
<span class="vernacular">End</span><span class="id"> elebesgue_measure</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> lebesgue_measure_itv</span>.<br/>
<span class="vernacular">Variable</span><span class="id"> R</span><span class="id"> :</span><span class="id"> realType</span>.<br/>
<br/>
<span class="vernacular">Let</span><span class="id"> lebesgue_measure_itvoc</span> (<span class="id">a</span><span class="id"> b</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;(<span class="id">lebesgue_measure</span> (<span class="id">`]a,</span><span class="id"> b]</span><span class="id"> :</span><span class="id"> set</span><span class="id"> R</span>)<span class="id"> =</span><br/>
&nbsp;&nbsp;<span class="id">wlength</span><span class="id"> [the</span><span class="id"> cumulative</span><span class="id"> _</span><span class="id"> of</span><span class="id"> idfun]</span><span class="id"> `]a,</span><span class="id"> b]</span>)<span class="id">%classic</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> /lebesgue_measure/=</span><span class="id"> /lebesgue_stieltjes_measure/=</span><span class="id"> /measure_extension/=</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> measurable_mu_extE//;</span><span class="id"> exact:</span><span class="id"> is_ocitv</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Let</span><span class="id"> lebesgue_measure_itvoo_subr1</span> (<span class="id">a</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">lebesgue_measure</span> (<span class="id">`]a</span><span class="id"> -</span><span class="id"> 1,</span><span class="id"> a[%classic</span><span class="id"> :</span><span class="id"> set</span><span class="id"> R</span>)<span class="id"> =</span><span class="id"> 1%E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> itv_bnd_open_bigcup//;</span><span class="id"> transitivity</span> (<span class="id">limn</span> (<span class="id">lebesgue_measure</span><span class="id"> \o</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="gallina-kwd">fun</span><span class="id"> k</span><span class="id"> =&gt;</span><span class="id"> `]a</span><span class="id"> -</span><span class="id"> 1,</span><span class="id"> a</span><span class="id"> -</span><span class="id"> k</span>.<span class="id">+1%:R^-1]%classic</span><span class="id"> :</span><span class="id"> set</span><span class="id"> R</span>))).<br/>
&nbsp;&nbsp;<span class="id">apply/esym/cvg_lim</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> apply:</span><span class="id"> nondecreasing_cvg_mu</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> ?;</span><span class="id"> exact:</span><span class="id"> measurable_itv</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> bigcup_measurable</span><span class="id"> =&gt;</span><span class="id"> k</span><span class="id"> _;</span><span class="id"> exact:</span><span class="id"> measurable_itv</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> move=&gt;</span><span class="id"> n</span><span class="id"> m</span><span class="id"> nm;</span><span class="id"> apply/subsetPset</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> !in_itv/=</span><span class="id"> =&gt;</span><span class="id"> /andP[-&gt;/=]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move/le_trans;</span><span class="id"> apply;</span><span class="id"> rewrite</span><span class="id"> lerB//</span><span class="id"> ler_pV2</span><span class="id"> ?ler_nat//;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> inE</span><span class="id"> ltr0n</span><span class="id"> andbT</span><span class="id"> unitfE</span>.<br/>
<span class="id">rewrite</span> (_<span class="id"> :</span><span class="id"> _</span><span class="id"> \o</span><span class="id"> _</span><span class="id"> =</span> (<span class="gallina-kwd">fun</span><span class="id"> n</span><span class="id"> =&gt;</span> (<span class="id">1</span><span class="id"> -</span><span class="id"> n</span>.<span class="id">+1%:R^-1</span>)<span class="id">%:E</span>))<span class="id">;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">apply/funext</span><span class="id"> =&gt;</span><span class="id"> n</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> lebesgue_measure_itvoc</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> [-&gt;|n0]</span><span class="id"> :=</span><span class="id"> eqVneq</span><span class="id"> n</span><span class="id"> 0%N</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> invr1</span><span class="id"> subrr</span><span class="id"> set_itvoc0</span><span class="id"> wlength0</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> wlength_itv/=</span><span class="id"> lte_fin</span><span class="id"> ifT;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> ler_ltB//</span><span class="id"> invr_lt1</span><span class="id"> ?unitfE//</span><span class="id"> ltr1n</span><span class="id"> ltnS</span><span class="id"> lt0n</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> !</span>(<span class="id">EFinB,EFinN</span>)<span class="id"> fin_num_oppeB//</span><span class="id"> addeAC</span><span class="id"> addeA</span><span class="id"> subee//</span><span class="id"> add0e</span>.<br/>
<span class="id">apply/cvg_lim</span><span class="id"> =&gt;</span><span class="id"> //=;</span><span class="id"> apply/fine_cvgP;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> /=;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> nearW</span>.<br/>
<span class="id">apply/</span>(<span class="id">@cvgrPdist_lt</span><span class="id"> _</span><span class="id"> [the</span><span class="id"> pseudoMetricNormedZmodType</span><span class="id"> R</span><span class="id"> of</span><span class="id"> R^o]</span>)<span class="id"> =&gt;</span><span class="id"> _/posnumP[e]</span>.<br/>
<span class="id">near=&gt;</span><span class="id"> n;</span><span class="id"> rewrite</span><span class="id"> opprB</span><span class="id"> addrCA</span><span class="id"> subrr</span><span class="id"> addr0</span><span class="id"> ger0_norm//</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> near:</span><span class="id"> n;</span><span class="id"> exact:</span><span class="id"> near_infty_natSinv_lt</span>.<br/>
<span class="id">Unshelve</span>.<span class="id"> all:</span><span class="gallina-kwd"> by</span><span class="id"> end_near</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> lebesgue_measure_set1</span> (<span class="id">a</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span><span class="id"> lebesgue_measure</span><span class="id"> [set</span><span class="id"> a]</span><span class="id"> =</span><span class="id"> 0%E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">suff</span><span class="id"> :</span> (<span class="id">lebesgue_measure</span> (<span class="id">`]a</span><span class="id"> -</span><span class="id"> 1,</span><span class="id"> a]%classic%R</span><span class="id"> :</span><span class="id"> set</span><span class="id"> R</span>)<span class="id"> =</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lebesgue_measure</span> (<span class="id">`]a</span><span class="id"> -</span><span class="id"> 1,</span><span class="id"> a[%classic%R</span><span class="id"> :</span><span class="id"> set</span><span class="id"> R</span>)<span class="id"> +</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">lebesgue_measure</span><span class="id"> [set</span><span class="id"> a]</span>)<span class="id">%E</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> lebesgue_measure_itvoo_subr1</span><span class="id"> lebesgue_measure_itvoc</span><span class="id"> =&gt;</span><span class="id"> /eqP</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> wlength_itv</span><span class="id"> lte_fin</span><span class="id"> ltrBlDr</span><span class="id"> ltrDl</span><span class="id"> ltr01</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> [in</span><span class="id"> X</span><span class="gallina-kwd"> in</span><span class="id"> X</span><span class="id"> ==</span><span class="id"> _]/=</span><span class="id"> EFinN</span><span class="id"> EFinB</span><span class="id"> fin_num_oppeB//</span><span class="id"> addeA</span><span class="id"> subee//</span><span class="id"> add0e</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> addeC</span><span class="id"> -sube_eq</span><span class="id"> ?fin_num_adde_defl//</span><span class="id"> subee//</span><span class="id"> =&gt;</span><span class="id"> /eqP</span>.<br/>
<span class="id">rewrite</span><span class="id"> -setUitv1//</span><span class="id"> ?bnd_simp;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> ltrBlDr</span><span class="id"> ltrDl</span>.<br/>
<span class="id">rewrite</span><span class="id"> measureU</span><span class="id"> //;</span><span class="id"> apply/seteqP;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> x</span><span class="id"> []/=</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> in_itv/=</span><span class="id"> =&gt;</span><span class="id"> +</span><span class="id"> xa;</span><span class="id"> rewrite</span><span class="id"> xa</span><span class="id"> ltxx</span><span class="id"> andbF</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Let</span><span class="id"> lebesgue_measure_itvoo</span> (<span class="id">a</span><span class="id"> b</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;(<span class="id">lebesgue_measure</span> (<span class="id">`]a,</span><span class="id"> b[</span><span class="id"> :</span><span class="id"> set</span><span class="id"> R</span>)<span class="id"> =</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id">wlength</span><span class="id"> [the</span><span class="id"> cumulative</span><span class="id"> _</span><span class="id"> of</span><span class="id"> idfun]</span><span class="id"> `]a,</span><span class="id"> b[</span>)<span class="id">%classic</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">have</span><span class="id"> [ab|ba]</span><span class="id"> :=</span><span class="id"> ltP</span><span class="id"> a</span><span class="id"> b;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> set_itv_ge</span><span class="id"> ?measure0//</span><span class="id"> -leNgt</span>.<br/>
<span class="id">have</span><span class="id"> :=</span><span class="id"> lebesgue_measure_itvoc</span><span class="id"> a</span><span class="id"> b</span>.<br/>
<span class="id">rewrite</span><span class="id"> 2!wlength_itv</span><span class="id"> =&gt;</span><span class="id"> &lt;-;</span><span class="id"> rewrite</span><span class="id"> -setUitv1//</span><span class="id"> measureU//</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> have</span><span class="id"> /=</span><span class="id"> -&gt;</span><span class="id"> :=</span><span class="id"> lebesgue_measure_set1</span><span class="id"> b;</span><span class="id"> rewrite</span><span class="id"> adde0</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> apply/seteqP;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> x</span><span class="id"> [/=</span><span class="id"> +</span><span class="id"> xb];</span><span class="id"> rewrite</span><span class="id"> in_itv/=</span><span class="id"> xb</span><span class="id"> ltxx</span><span class="id"> andbF</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Let</span><span class="id"> lebesgue_measure_itvcc</span> (<span class="id">a</span><span class="id"> b</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;(<span class="id">lebesgue_measure</span> (<span class="id">`[a,</span><span class="id"> b]</span><span class="id"> :</span><span class="id"> set</span><span class="id"> R</span>)<span class="id"> =</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id">wlength</span><span class="id"> [the</span><span class="id"> cumulative</span><span class="id"> _</span><span class="id"> of</span><span class="id"> idfun]</span><span class="id"> `[a,</span><span class="id"> b]</span>)<span class="id">%classic</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">have</span><span class="id"> [ab|ba]</span><span class="id"> :=</span><span class="id"> leP</span><span class="id"> a</span><span class="id"> b;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> set_itv_ge</span><span class="id"> ?measure0//</span><span class="id"> -leNgt</span>.<br/>
<span class="id">have</span><span class="id"> :=</span><span class="id"> lebesgue_measure_itvoc</span><span class="id"> a</span><span class="id"> b</span>.<br/>
<span class="id">rewrite</span><span class="id"> 2!wlength_itv</span><span class="id"> =&gt;</span><span class="id"> &lt;-;</span><span class="id"> rewrite</span><span class="id"> -setU1itv//</span><span class="id"> measureU//</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> have</span><span class="id"> /=</span><span class="id"> -&gt;</span><span class="id"> :=</span><span class="id"> lebesgue_measure_set1</span><span class="id"> a;</span><span class="id"> rewrite</span><span class="id"> add0e</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> apply/seteqP;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> x</span><span class="id"> [/=</span><span class="id"> -&gt;];</span><span class="id"> rewrite</span><span class="id"> in_itv/=</span><span class="id"> ltxx</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Let</span><span class="id"> lebesgue_measure_itvco</span> (<span class="id">a</span><span class="id"> b</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;(<span class="id">lebesgue_measure</span> (<span class="id">`[a,</span><span class="id"> b[</span><span class="id"> :</span><span class="id"> set</span><span class="id"> R</span>)<span class="id"> =</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id">wlength</span><span class="id"> [the</span><span class="id"> cumulative</span><span class="id"> _</span><span class="id"> of</span><span class="id"> idfun]</span><span class="id"> `[a,</span><span class="id"> b[</span>)<span class="id">%classic</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">have</span><span class="id"> [ab|ba]</span><span class="id"> :=</span><span class="id"> ltP</span><span class="id"> a</span><span class="id"> b;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> set_itv_ge</span><span class="id"> ?measure0//</span><span class="id"> -leNgt</span>.<br/>
<span class="id">have</span><span class="id"> :=</span><span class="id"> lebesgue_measure_itvoo</span><span class="id"> a</span><span class="id"> b</span>.<br/>
<span class="id">rewrite</span><span class="id"> 2!wlength_itv</span><span class="id"> =&gt;</span><span class="id"> &lt;-;</span><span class="id"> rewrite</span><span class="id"> -setU1itv//</span><span class="id"> measureU//</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> have</span><span class="id"> /=</span><span class="id"> -&gt;</span><span class="id"> :=</span><span class="id"> lebesgue_measure_set1</span><span class="id"> a;</span><span class="id"> rewrite</span><span class="id"> add0e</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> apply/seteqP;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> x</span><span class="id"> [/=</span><span class="id"> -&gt;];</span><span class="id"> rewrite</span><span class="id"> in_itv/=</span><span class="id"> ltxx</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Let</span><span class="id"> lebesgue_measure_itv_bnd</span> (<span class="id">x</span><span class="id"> y</span><span class="id"> :</span><span class="id"> bool</span>) (<span class="id">a</span><span class="id"> b</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">lebesgue_measure</span> (<span class="id">[set`</span><span class="id"> Interval</span> (<span class="id">BSide</span><span class="id"> x</span><span class="id"> a</span>) (<span class="id">BSide</span><span class="id"> y</span><span class="id"> b</span>)<span class="id">]</span><span class="id"> :</span><span class="id"> set</span><span class="id"> R</span>)<span class="id"> =</span><br/>
&nbsp;&nbsp;<span class="id">wlength</span><span class="id"> [the</span><span class="id"> cumulative</span><span class="id"> _</span><span class="id"> of</span><span class="id"> idfun]</span><span class="id"> [set`</span><span class="id"> Interval</span> (<span class="id">BSide</span><span class="id"> x</span><span class="id"> a</span>) (<span class="id">BSide</span><span class="id"> y</span><span class="id"> b</span>)<span class="id">]</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd">by</span><span class="id"> move:</span><span class="id"> x</span><span class="id"> y</span><span class="id"> =&gt;</span><span class="id"> [|]</span><span class="id"> [|];</span><span class="id"> [exact:</span><span class="id"> lebesgue_measure_itvco</span><span class="id"> |</span><br/>
&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> lebesgue_measure_itvcc</span><span class="id"> |</span><span class="id"> exact:</span><span class="id"> lebesgue_measure_itvoo</span><span class="id"> |</span><br/>
&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> lebesgue_measure_itvoc]</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Let</span><span class="id"> limnatR</span><span class="id"> :</span><span class="id"> lim</span> (((<span class="id">k%:R</span>)<span class="id">%:E</span><span class="id"> :</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id"> @[k</span><span class="id"> --&gt;</span><span class="id"> \oo]</span>)<span class="id"> =</span><span class="id"> +oo%E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> apply/cvg_lim</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> apply/cvgenyP</span>. Qed.</div></details>
<br/>
<span class="vernacular">Let</span><span class="id"> lebesgue_measure_itv_bnd_infty</span><span class="id"> x</span> (<span class="id">a</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">lebesgue_measure</span> (<span class="id">[set`</span><span class="id"> Interval</span> (<span class="id">BSide</span><span class="id"> x</span><span class="id"> a</span>)<span class="id"> +oo%O]</span><span class="id"> :</span><span class="id"> set</span><span class="id"> R</span>)<span class="id"> =</span><span class="id"> +oo%E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> itv_bnd_infty_bigcup;</span><span class="id"> transitivity</span> (<span class="id">limn</span> (<span class="id">lebesgue_measure</span><span class="id"> \o</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="gallina-kwd">fun</span><span class="id"> k</span><span class="id"> =&gt;</span><span class="id"> [set`</span><span class="id"> Interval</span> (<span class="id">BSide</span><span class="id"> x</span><span class="id"> a</span>) (<span class="id">BRight</span> (<span class="id">a</span><span class="id"> +</span><span class="id"> k%:R</span>))<span class="id">]</span><span class="id"> :</span><span class="id"> set</span><span class="id"> R</span>))).<br/>
&nbsp;&nbsp;<span class="id">apply/esym/cvg_lim</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> apply:</span><span class="id"> nondecreasing_cvg_mu</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> k;</span><span class="id"> exact:</span><span class="id"> measurable_itv</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> bigcup_measurable</span><span class="id"> =&gt;</span><span class="id"> k</span><span class="id"> _;</span><span class="id"> exact:</span><span class="id"> measurable_itv</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="id"> move=&gt;</span><span class="id"> m</span><span class="id"> n</span><span class="id"> mn;</span><span class="id"> apply/subsetPset</span><span class="id"> =&gt;</span><span class="id"> r/=;</span><span class="id"> rewrite</span><span class="id"> !in_itv/=</span><span class="id"> =&gt;</span><span class="id"> /andP[-&gt;/=]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> /le_trans;</span><span class="id"> apply;</span><span class="id"> rewrite</span><span class="id"> lerD//</span><span class="id"> ler_nat</span>.<br/>
<span class="id">rewrite</span> (_<span class="id"> :</span><span class="id"> _</span><span class="id"> \o</span><span class="id"> _</span><span class="id"> =</span> (<span class="gallina-kwd">fun</span><span class="id"> k</span><span class="id"> =&gt;</span><span class="id"> k%:R%:E</span>))<span class="id">//</span>.<br/>
<span class="id">apply/funext</span><span class="id"> =&gt;</span><span class="id"> n</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> lebesgue_measure_itv_bnd</span><span class="id"> wlength_itv/=</span>.<br/>
<span class="id">rewrite</span><span class="id"> lte_fin;</span> <span class="id"> have</span><span class="id"> [-&gt;|n0]</span><span class="id"> :=</span><span class="id"> eqVneq</span><span class="id"> n</span><span class="id"> 0%N;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> addr0</span><span class="id"> ltxx</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> ltrDl</span><span class="id"> ltr0n</span><span class="id"> lt0n</span><span class="id"> n0</span><span class="id"> EFinD</span><span class="id"> addeAC</span><span class="id"> EFinN</span><span class="id"> subee</span><span class="id"> ?add0e</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Let</span><span class="id"> lebesgue_measure_itv_infty_bnd</span><span class="id"> y</span> (<span class="id">b</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">lebesgue_measure</span> (<span class="id">[set`</span><span class="id"> Interval</span><span class="id"> -oo%O</span> (<span class="id">BSide</span><span class="id"> y</span><span class="id"> b</span>)<span class="id">]</span><span class="id"> :</span><span class="id"> set</span><span class="id"> R</span>)<span class="id"> =</span><span class="id"> +oo%E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> itv_infty_bnd_bigcup;</span><span class="id"> transitivity</span> (<span class="id">limn</span> (<span class="id">lebesgue_measure</span><span class="id"> \o</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="gallina-kwd">fun</span><span class="id"> k</span><span class="id"> =&gt;</span><span class="id"> [set`</span><span class="id"> Interval</span> (<span class="id">BLeft</span> (<span class="id">b</span><span class="id"> -</span><span class="id"> k%:R</span>)) (<span class="id">BSide</span><span class="id"> y</span><span class="id"> b</span>)<span class="id">]</span><span class="id"> :</span><span class="id"> set</span><span class="id"> R</span>))).<br/>
&nbsp;&nbsp;<span class="id">apply/esym/cvg_lim</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> apply:</span><span class="id"> nondecreasing_cvg_mu</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> k;</span><span class="id"> exact:</span><span class="id"> measurable_itv</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> bigcup_measurable</span><span class="id"> =&gt;</span><span class="id"> k</span><span class="id"> _;</span><span class="id"> exact:</span><span class="id"> measurable_itv</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="id"> move=&gt;</span><span class="id"> m</span><span class="id"> n</span><span class="id"> mn;</span><span class="id"> apply/subsetPset</span><span class="id"> =&gt;</span><span class="id"> r/=;</span><span class="id"> rewrite</span><span class="id"> !in_itv/=</span><span class="id"> =&gt;</span><span class="id"> /andP[+</span><span class="id"> -&gt;]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> andbT;</span><span class="id"> apply:</span><span class="id"> le_trans;</span><span class="id"> rewrite</span><span class="id"> lerB//</span><span class="id"> ler_nat</span>.<br/>
<span class="id">rewrite</span> (_<span class="id"> :</span><span class="id"> _</span><span class="id"> \o</span><span class="id"> _</span><span class="id"> =</span> (<span class="gallina-kwd">fun</span><span class="id"> k</span><span class="id"> :</span><span class="id"> nat</span><span class="id"> =&gt;</span><span class="id"> k%:R%:E</span>))<span class="id">//</span>.<br/>
<span class="id">apply/funext</span><span class="id"> =&gt;</span><span class="id"> n</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> lebesgue_measure_itv_bnd</span><span class="id"> wlength_itv/=</span><span class="id"> lte_fin</span>.<br/>
<span class="id">have</span><span class="id"> [-&gt;|n0]</span><span class="id"> :=</span><span class="id"> eqVneq</span><span class="id"> n</span><span class="id"> 0%N;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> subr0</span><span class="id"> ltxx</span>.<br/>
<span class="id">rewrite</span><span class="id"> ltrBlDr</span><span class="id"> ltrDl</span><span class="id"> ltr0n</span><span class="id"> lt0n</span><span class="id"> n0</span><span class="id"> EFinN</span><span class="id"> EFinB</span><span class="id"> fin_num_oppeB//</span><span class="id"> addeA</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> subee//</span><span class="id"> add0e</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Let</span><span class="id"> lebesgue_measure_itv_infty_infty</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">lebesgue_measure</span> (<span class="id">[set`</span><span class="id"> Interval</span><span class="id"> -oo%O</span><span class="id"> +oo%O]</span><span class="id"> :</span><span class="id"> set</span><span class="id"> R</span>)<span class="id"> =</span><span class="id"> +oo%E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> set_itv_infty_infty</span><span class="id"> -</span>(<span class="id">setUv</span> (<span class="id">`]-oo,</span><span class="id"> 0[</span>))<span class="id"> setCitv</span>.<br/>
<span class="id">rewrite</span><span class="id"> [X</span><span class="gallina-kwd"> in</span><span class="id"> _</span><span class="id"> `|`</span> (<span class="id">X</span><span class="id"> `|`</span><span class="id"> _</span>)<span class="id"> ]set_itvE</span><span class="id"> set0U</span><span class="id"> measureU//;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">apply/seteqP;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //=</span><span class="id"> x</span><span class="id"> []</span><span class="id"> /=</span><span class="id"> /[swap]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> !in_itv/=</span><span class="id"> andbT</span><span class="id"> ltNge</span><span class="id"> =&gt;</span><span class="id"> -&gt;//</span>.<br/>
<span class="id">rewrite</span><span class="id"> [X</span><span class="gallina-kwd"> in</span> (<span class="id">X</span><span class="id"> +</span><span class="id"> _</span>)<span class="id">%E]lebesgue_measure_itv_infty_bnd</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> [X</span><span class="gallina-kwd"> in</span> (_<span class="id"> +</span><span class="id"> X</span>)<span class="id">%E]lebesgue_measure_itv_bnd_infty</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> lebesgue_measure_itv</span> (<span class="id">i</span><span class="id"> :</span><span class="id"> interval</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">lebesgue_measure</span> (<span class="id">[set`</span><span class="id"> i]</span><span class="id"> :</span><span class="id"> set</span><span class="id"> R</span>)<span class="id"> =</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">if</span><span class="id"> i</span>.<span class="id">1</span><span class="id"> &lt;</span><span class="id"> i</span>.<span class="id">2</span><span class="gallina-kwd"> then</span> (<span class="id">i</span>.<span class="id">2</span><span class="id"> :</span><span class="id"> \bar</span><span class="id"> R</span>)<span class="id"> -</span><span class="id"> i</span>.<span class="id">1</span><span class="gallina-kwd"> else</span><span class="id"> 0</span>)<span class="id">%E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move:</span><span class="id"> i</span><span class="id"> =&gt;</span><span class="id"> [[x</span><span class="id"> a|[|]]]</span><span class="id"> [y</span><span class="id"> b|[|]]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> lebesgue_measure_itv_bnd</span><span class="id"> wlength_itv</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> set_itvE</span><span class="id"> ?measure0</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> lebesgue_measure_itv_bnd_infty/=</span><span class="id"> ltry</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> lebesgue_measure_itv_infty_bnd/=</span><span class="id"> ltNyr</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> set_itvE</span><span class="id"> ?measure0</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> lebesgue_measure_itv_infty_infty</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> set_itvE</span><span class="id"> ?measure0</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> set_itvE</span><span class="id"> ?measure0</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> set_itvE</span><span class="id"> ?measure0</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> lebesgue_measure_ball</span> (<span class="id">x</span><span class="id"> r</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span> (<span class="id">0</span><span class="id"> &lt;=</span><span class="id"> r</span>)<span class="id">%R</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">lebesgue_measure</span> (<span class="id">ball</span><span class="id"> x</span><span class="id"> r</span>)<span class="id"> =</span> (<span class="id">r</span><span class="id"> *+</span><span class="id"> 2</span>)<span class="id">%:E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> le_eqVlt</span><span class="id"> =&gt;</span><span class="id"> /predU1P[</span><span class="id"> &lt;-|r0]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span> (<span class="id">ball0</span><span class="id"> _</span><span class="id"> _</span>).<span class="id">2//</span><span class="id"> measure0</span><span class="id"> mul0rn</span>.<br/>
<span class="id">rewrite</span><span class="id"> ball_itv</span><span class="id"> lebesgue_measure_itv/=</span><span class="id"> lte_fin</span><span class="id"> ltrBlDr</span><span class="id"> -addrA</span><span class="id"> ltrDl</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> addr_gt0</span><span class="id"> //</span><span class="id"> -EFinD</span><span class="id"> addrAC</span><span class="id"> opprD</span><span class="id"> opprK</span><span class="id"> addrA</span><span class="id"> subrr</span><span class="id"> add0r</span><span class="id"> -mulr2n</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> lebesgue_measure_closed_ball</span> (<span class="id">x</span><span class="id"> r</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> r</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">lebesgue_measure</span> (<span class="id">closed_ball</span><span class="id"> x</span><span class="id"> r</span>)<span class="id"> =</span> (<span class="id">r</span><span class="id"> *+</span><span class="id"> 2</span>)<span class="id">%:E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> le_eqVlt</span><span class="id"> =&gt;</span><span class="id"> /predU1P[&lt;-|r0];</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> mul0rn</span><span class="id"> closed_ball0//</span><span class="id"> measure0</span>.<br/>
<span class="id">rewrite</span><span class="id"> closed_ball_itv//</span><span class="id"> lebesgue_measure_itv/=</span><span class="id"> lte_fin</span><span class="id"> -ltrBlDl</span><span class="id"> addrAC</span>.<br/>
<span class="id">rewrite</span><span class="id"> subrr</span><span class="id"> add0r</span><span class="id"> gtrN//</span><span class="id"> ?mulr_gt0//</span><span class="id"> -EFinD;</span><span class="id"> congr</span> (<span class="id">_%:E</span>).<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> opprB</span><span class="id"> addrAC</span><span class="id"> addrCA</span><span class="id"> subrr</span><span class="id"> addr0</span><span class="id"> -mulr2n</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> lebesgue_measure_itv</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> lebesgue_measure_rat</span> (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">lebesgue_measure</span> (<span class="id">range</span><span class="id"> ratr</span><span class="id"> :</span><span class="id"> set</span><span class="id"> R</span>)<span class="id"> =</span><span class="id"> 0%E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">have</span><span class="id"> /pcard_eqP/bijPex[f</span><span class="id"> bijf]</span><span class="id"> :=</span><span class="id"> card_rat;</span><span class="id"> set</span><span class="id"> f1</span><span class="id"> :=</span><span class="id"> 'pinv_</span>(<span class="id">fun=&gt;</span><span class="id"> 0</span>)<span class="id"> setT</span><span class="id"> f</span>.<br/>
<span class="id">rewrite</span> (_<span class="id"> :</span><span class="id"> range</span><span class="id"> _</span><span class="id"> =</span><span class="id"> \bigcup_n</span><span class="id"> [set</span><span class="id"> ratr</span> (<span class="id">f1</span><span class="id"> n</span>)<span class="id">]</span>)<span class="id">;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">apply/seteqP;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> [_</span><span class="id"> [q</span><span class="id"> _</span><span class="id"> &lt;-]|_</span><span class="id"> [n</span><span class="id"> _</span><span class="id"> /=</span><span class="id"> -&gt;]];</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="gallina-kwd"> exists</span> (<span class="id">f1</span><span class="id"> n</span>).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">exists</span> (<span class="id">f</span><span class="id"> q</span>)<span class="id"> =&gt;</span><span class="id"> //=;</span><span class="id"> rewrite</span><span class="id"> /f1</span><span class="id"> pinvKV//</span><span class="id"> ?in_setE//</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> y</span><span class="id"> _</span><span class="id"> _</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> bij_inj;</span><span class="id"> rewrite</span><span class="id"> -setTT_bijective</span>.<br/>
<span class="id">rewrite</span><span class="id"> measure_bigcup//;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">apply/trivIsetP</span><span class="id"> =&gt;</span><span class="id"> i</span><span class="id"> j</span><span class="id"> _</span><span class="id"> _</span><span class="id"> ij;</span><span class="id"> apply/seteqP;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //=</span><span class="id"> _</span><span class="id"> [/=</span><span class="id"> -&gt;]</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> /fmorph_inj</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> /set_bij_inj</span><span class="id"> /[apply]</span><span class="id"> :=</span><span class="id"> bijpinv_bij</span> (<span class="id">fun=&gt;</span><span class="id"> 0</span>)<span class="id"> bijf</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> in_setE</span><span class="id"> =&gt;</span><span class="id"> /</span>(_<span class="id"> Logic</span>.<span class="id">I</span><span class="id"> Logic</span>.<span class="id">I</span>)<span class="id">;</span><span class="id"> exact/eqP</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> eseries0//</span><span class="id"> =&gt;</span><span class="id"> n</span><span class="id"> _</span><span class="id"> _;</span><span class="id"> exact:</span><span class="id"> lebesgue_measure_set1</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Section</span><span class="id"> negligible_outer_measure</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {R</span><span class="id"> :</span><span class="id"> realType}</span>.<br/>
<span class="vernacular">Implicit</span><span class="id"> Types</span> (<span class="id">A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> R</span>).<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<br/>
<span class="vernacular">Let</span><span class="id"> l</span><span class="id"> :=</span> (<span class="id">@wlength</span><span class="id"> R</span><span class="id"> idfun</span>).<br/>
<span class="vernacular">Let</span><span class="id"> mu</span><span class="id"> :=</span> (<span class="id">@lebesgue_measure</span><span class="id"> R</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> outer_measure_open_le</span><span class="id"> A</span> (<span class="id">e</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span> (<span class="id">0</span><span class="id"> &lt;</span><span class="id"> e</span>)<span class="id">%R</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">exists</span><span class="id"> U,</span><span class="id"> [/\</span><span class="id"> open</span><span class="id"> U,</span><span class="id"> A</span><span class="id"> `&lt;=`</span><span class="id"> U</span><span class="id"> &amp;</span><span class="id"> mu</span><span class="id"> U</span><span class="id"> &lt;=</span> (<span class="id">l^*</span><span class="id"> A</span>)<span class="id">%mu</span><span class="id"> +</span><span class="id"> e%:E]</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">have</span><span class="id"> [|Aoo</span><span class="id"> e0]</span><span class="id"> :=</span><span class="id"> leP</span><span class="id"> +oo</span> (<span class="id">l^*</span><span class="id"> A</span>)<span class="id">%mu</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> leye_eq</span><span class="id"> =&gt;</span><span class="id"> /eqP</span><span class="id"> Aoo</span><span class="id"> e0</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="gallina-kwd"> exists</span><span class="id"> [set:</span><span class="id"> R];</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> [exact:</span><span class="id"> openT|rewrite</span><span class="id"> Aoo</span><span class="id"> leey]</span>.<br/>
<span class="id">have</span><span class="id"> [F</span><span class="id"> AF</span><span class="id"> Fe]</span><span class="id"> :</span><span class="gallina-kwd"> exists2</span><span class="id"> I_,</span><span class="id"> open_itv_cover</span><span class="id"> A</span><span class="id"> I_</span><span class="id"> &amp;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">\sum_</span>(<span class="id">0</span><span class="id"> &lt;=</span><span class="id"> k</span><span class="id"> &lt;oo</span>)<span class="id"> l</span> (<span class="id">I_</span><span class="id"> k</span>)<span class="id"> &lt;=</span> (<span class="id">l^*</span><span class="id"> A</span>)<span class="id">%mu</span><span class="id"> +</span><span class="id"> e%:E</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> :</span> (<span class="id">l^*</span><span class="id"> A</span>)<span class="id">%mu\is</span><span class="id"> a</span><span class="id"> fin_num</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> ge0_fin_numE//</span><span class="id"> outer_measure_ge0</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> outer_measure_open_itv_cover</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> /lb_ereal_inf_adherent-/</span>(_<span class="id"> _</span><span class="id"> e0</span>)<span class="id">[_/=</span><span class="id"> [F]]</span><span class="id"> AF</span><span class="id"> &lt;-</span><span class="id"> Fe</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="gallina-kwd"> exists</span><span class="id"> F</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact/ltW</span>.<br/>
<span class="gallina-kwd">exists</span> (<span class="id">\bigcup_i</span><span class="id"> F</span><span class="id"> i</span>)<span class="id">;</span><span class="id"> split</span>.<br/>
<span class="id">-</span><span class="id"> apply:</span><span class="id"> bigcup_open</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> i</span><span class="id"> _</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> case:</span><span class="id"> AF</span><span class="id"> =&gt;</span><span class="id"> /</span>(_<span class="id"> i</span>)<span class="id">[ab</span><span class="id"> -&gt;</span><span class="id"> _];</span><span class="id"> exact:</span><span class="id"> interval_open</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> case:</span><span class="id"> AF</span>.<br/>
<span class="id">-</span><span class="id"> rewrite</span> (<span class="id">le_trans</span><span class="id"> _</span><span class="id"> Fe</span>)<span class="id">//</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span> (<span class="id">le_trans</span> (<span class="id">outer_measure_sigma_subadditive</span><span class="id"> mu</span><span class="id"> F</span>)).<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> lee_nneseries</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> i</span><span class="id"> _</span>.<br/>
&nbsp;&nbsp;<span class="id">case:</span><span class="id"> AF</span><span class="id"> =&gt;</span><span class="id"> /</span>(_<span class="id"> i</span>)<span class="id">[[a</span><span class="id"> b]</span><span class="id"> -&gt;</span><span class="id"> _]/=</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /l</span><span class="id"> wlength_itv/=</span><span class="id"> -</span>(<span class="id">@lebesgue_measure_itv</span><span class="id"> R</span><span class="id"> `]a,</span><span class="id"> b[</span>).<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> outer_measure_open</span><span class="id"> A</span><span class="id"> :</span> (<span class="id">l^*</span><span class="id"> A</span>)<span class="id">%mu</span><span class="id"> =</span><br/>
&nbsp;&nbsp;<span class="id">ereal_inf</span><span class="id"> [set</span> (<span class="id">l^*</span><span class="id"> U</span>)<span class="id">%mu</span><span class="id"> |</span><span class="id"> U</span><span class="gallina-kwd"> in</span><span class="id"> [set</span><span class="id"> U</span><span class="id"> |</span><span class="id"> open</span><span class="id"> U</span><span class="id"> /\</span><span class="id"> A</span><span class="id"> `&lt;=`</span><span class="id"> U]]</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">apply/eqP;</span><span class="id"> rewrite</span><span class="id"> eq_le;</span><span class="id"> apply/andP;</span><span class="id"> split</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> lb_ereal_inf</span><span class="id"> =&gt;</span><span class="id"> /=</span><span class="id"> _</span><span class="id"> /=</span><span class="id"> [U</span><span class="id"> [oU</span><span class="id"> AU]</span><span class="id"> &lt;-];</span><span class="id"> exact:</span><span class="id"> le_outer_measure</span>.<br/>
<span class="id">apply/lee_addgt0Pr</span><span class="id"> =&gt;</span><span class="id"> /=</span><span class="id"> e</span><span class="id"> e0;</span><span class="id"> apply:</span><span class="id"> ereal_inf_le</span>.<br/>
<span class="id">have</span><span class="id"> [U</span><span class="id"> [oU</span><span class="id"> AU</span><span class="id"> UAe]]</span><span class="id"> :=</span><span class="id"> @outer_measure_open_le</span><span class="id"> A</span><span class="id"> _</span><span class="id"> e0</span>.<br/>
<span class="gallina-kwd">by</span><span class="gallina-kwd"> exists</span> (<span class="id">mu</span><span class="id"> U</span>)<span class="id"> =&gt;</span><span class="id"> //=;</span><span class="gallina-kwd"> exists</span><span class="id"> U</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> outer_measure_Gdelta</span><span class="id"> A</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">exists</span><span class="id"> G</span><span class="id"> :</span> (<span class="id">set</span><span class="id"> R</span>)<span class="id">^nat,</span><span class="id"> [/\</span> (<span class="gallina-kwd">forall</span><span class="id"> i,</span><span class="id"> open</span> (<span class="id">G</span><span class="id"> i</span>))<span class="id">,</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">A</span><span class="id"> `&lt;=`</span><span class="id"> \bigcap_i</span><span class="id"> G</span><span class="id"> i</span><span class="id"> &amp;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">mu</span> (<span class="id">\bigcap_i</span><span class="id"> G</span><span class="id"> i</span>)<span class="id"> =</span> (<span class="id">l^*</span><span class="id"> A</span>)<span class="id">%mu]</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">have</span><span class="id"> inv0</span><span class="id"> k</span><span class="id"> :</span> (<span class="id">0</span><span class="id"> &lt;</span><span class="id"> k</span>.<span class="id">+1%:R^-1</span><span class="id"> :&gt;</span><span class="id"> R</span>)<span class="id">%R</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> invr_gt0</span>.<br/>
<span class="id">pose</span><span class="id"> F</span><span class="id"> k</span><span class="id"> :=</span><span class="id"> projT1</span> (<span class="id">cid</span> (<span class="id">outer_measure_open_le</span><span class="id"> A</span> (<span class="id">inv0</span><span class="id"> k</span>))).<br/>
<span class="id">have</span><span class="id"> oF</span><span class="id"> k</span><span class="id"> :</span><span class="id"> open</span> (<span class="id">F</span><span class="id"> k</span>)<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> /F;</span><span class="id"> case:</span><span class="id"> cid</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> /=</span><span class="id"> []</span>.<br/>
<span class="id">have</span><span class="id"> AF</span><span class="id"> k</span><span class="id"> :</span><span class="id"> A</span><span class="id"> `&lt;=`</span><span class="id"> F</span><span class="id"> k</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> /F;</span><span class="id"> case:</span><span class="id"> cid</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> /=</span><span class="id"> []</span>.<br/>
<span class="id">have</span><span class="id"> mF</span><span class="id"> k</span><span class="id"> :</span><span class="id"> mu</span> (<span class="id">F</span><span class="id"> k</span>)<span class="id"> &lt;=</span> (<span class="id">l^*</span><span class="id"> A</span>)<span class="id">%mu</span><span class="id"> +</span><span class="id"> k</span>.<span class="id">+1%:R^-1%:E</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /F;</span><span class="id"> case:</span><span class="id"> cid</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> /=</span><span class="id"> []</span>.<br/>
<span class="id">pose</span><span class="id"> G</span><span class="id"> :=</span><span class="id"> \bigcap_k</span> (<span class="id">F</span><span class="id"> k</span>).<br/>
<span class="gallina-kwd">exists</span><span class="id"> F;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> sub_bigcap</span>.<br/>
<span class="id">apply/eqP;</span><span class="id"> rewrite</span><span class="id"> eq_le;</span><span class="id"> apply/andP;</span><span class="id"> split</span>.<br/>
&nbsp;&nbsp;<span class="id">apply/lee_addgt0Pr</span><span class="id"> =&gt;</span><span class="id"> /=</span><span class="id"> _/posnumP[e]</span>.<br/>
&nbsp;&nbsp;<span class="id">near</span><span class="id"> \oo</span><span class="id"> =&gt;</span><span class="id"> k</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span> (<span class="id">@le_trans</span><span class="id"> _</span><span class="id"> _</span> ((<span class="id">l^*</span><span class="id"> A</span>)<span class="id">%mu</span><span class="id"> +</span><span class="id"> k</span>.<span class="id">+1%:R^-1%:E</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span> (<span class="id">le_trans</span><span class="id"> _</span> (<span class="id">mF</span><span class="id"> k</span>))<span class="id">//</span><span class="id"> le_outer_measure//;</span><span class="id"> exact:</span><span class="id"> bigcap_inf</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> leeD2l//</span><span class="id"> lee_fin;</span><span class="id"> apply:</span><span class="id"> ltW</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> near:</span><span class="id"> k;</span><span class="id"> exact:</span><span class="id"> near_infty_natSinv_lt</span>.<br/>
<span class="id">rewrite</span><span class="id"> [leRHS]</span>(_<span class="id"> :</span><span class="id"> _</span><span class="id"> =</span><span class="id"> l^*</span> (<span class="id">\bigcap_i</span><span class="id"> F</span><span class="id"> i</span>))<span class="id">%mu//</span><span class="id"> le_outer_measure//</span>.<br/>
<span class="id">exact:</span><span class="id"> sub_bigcap</span>.<br/>
<span class="id">Unshelve</span>.<span class="id"> all:</span><span class="gallina-kwd"> by</span><span class="id"> end_near</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> negligible_outer_measure</span> (<span class="id">N</span><span class="id"> :</span><span class="id"> set</span><span class="id"> R</span>)<span class="id"> :</span><span class="id"> mu</span>.<span class="id">-negligible</span><span class="id"> N</span><span class="id"> &lt;-&gt;</span> (<span class="id">l^*</span><span class="id"> N</span>)<span class="id">%mu</span><span class="id"> =</span><span class="id"> 0</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">split=&gt;</span><span class="id"> [[/=</span><span class="id"> A</span><span class="id"> [mA</span><span class="id"> mA0</span><span class="id"> NA]]|N0]</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> apply/eqP;</span><span class="id"> rewrite</span><span class="id"> eq_le</span><span class="id"> outer_measure_ge0</span><span class="id"> andbT</span><span class="id"> -mA0</span><span class="id"> le_outer_measure</span>.<br/>
<span class="id">-</span><span class="id"> have</span><span class="id"> :=</span><span class="id"> @outer_measure_Gdelta</span><span class="id"> N;</span><span class="id"> rewrite</span><span class="id"> N0</span><span class="id"> =&gt;</span><span class="id"> -[F</span><span class="id"> [oF</span><span class="id"> NF</span><span class="id"> mF0]]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">exists</span> (<span class="id">\bigcap_i</span><span class="id"> F</span><span class="id"> i</span>)<span class="id">;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //=</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> bigcapT_measurable</span><span class="id"> =&gt;</span><span class="id"> i;</span><span class="id"> exact:</span><span class="id"> open_measurable</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> negligible_outer_measure</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> lebesgue_regularity</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {R</span><span class="id"> :</span><span class="id"> realType}</span>.<br/>
<span class="vernacular">Let</span><span class="id"> mu</span><span class="id"> :=</span><span class="id"> [the</span><span class="id"> measure</span><span class="id"> _</span><span class="id"> _</span><span class="id"> of</span><span class="id"> @lebesgue_measure</span><span class="id"> R]</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> lebesgue_regularity_outer</span> (<span class="id">D</span><span class="id"> :</span><span class="id"> set</span><span class="id"> R</span>) (<span class="id">eps</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">measurable</span><span class="id"> D</span><span class="id"> -&gt;</span><span class="id"> mu</span><span class="id"> D</span><span class="id"> &lt;</span><span class="id"> +oo</span><span class="id"> -&gt;</span> (<span class="id">0</span><span class="id"> &lt;</span><span class="id"> eps</span>)<span class="id">%R</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">exists</span><span class="id"> U</span><span class="id"> :</span><span class="id"> set</span><span class="id"> R,</span><span class="id"> [/\</span><span class="id"> open</span><span class="id"> U</span><span class="id"> ,</span><span class="id"> D</span><span class="id"> `&lt;=`</span><span class="id"> U</span><span class="id"> &amp;</span><span class="id"> mu</span> (<span class="id">U</span><span class="id"> `\`</span><span class="id"> D</span>)<span class="id"> &lt;</span><span class="id"> eps%:E]</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> mD</span><span class="id"> muDoo</span><span class="id"> epspos</span>.<br/>
<span class="id">have</span><span class="id"> /ereal_inf_lt[z</span><span class="id"> [/=</span><span class="id"> M'</span><span class="id"> covDM</span><span class="id"> sMz</span><span class="id"> zDe]]</span><span class="id"> :</span><span class="id"> mu</span><span class="id"> D</span><span class="id"> &lt;</span><span class="id"> mu</span><span class="id"> D</span><span class="id"> +</span> (<span class="id">eps</span><span class="id"> /</span><span class="id"> 2</span>)<span class="id">%:E</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> lte_spaddre</span><span class="id"> ?lte_fin</span><span class="id"> ?divr_gt0//</span><span class="id"> ge0_fin_numE</span>.<br/>
<span class="id">pose</span><span class="id"> e2</span><span class="id"> n</span><span class="id"> :=</span> (<span class="id">eps</span><span class="id"> /</span><span class="id"> 2</span>)<span class="id"> /</span> (<span class="id">2</span><span class="id"> ^</span><span class="id"> n</span>.<span class="id">+1</span>)<span class="id">%:R</span>.<br/>
<span class="id">have</span><span class="id"> e2pos</span><span class="id"> n</span><span class="id"> :</span> (<span class="id">0</span><span class="id"> &lt;</span><span class="id"> e2</span><span class="id"> n</span>)<span class="id">%R</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> ?divr_gt0</span>.<br/>
<span class="id">pose</span><span class="id"> M</span><span class="id"> n</span><span class="id"> :=</span><span class="gallina-kwd"> if</span><span class="id"> pselect</span> (<span class="id">M'</span><span class="id"> n</span><span class="id"> =</span><span class="id"> set0</span>)<span class="gallina-kwd"> then</span><span class="id"> set0</span><span class="gallina-kwd"> else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">`]</span><span class="id"> inf</span> (<span class="id">M'</span><span class="id"> n</span>)<span class="id">,</span><span class="id"> sup</span> (<span class="id">M'</span><span class="id"> n</span>)<span class="id"> +</span><span class="id"> e2</span><span class="id"> n</span><span class="id"> [%classic</span>)<span class="id">%R</span>.<br/>
<span class="id">have</span><span class="id"> muM</span><span class="id"> n</span><span class="id"> :</span><span class="id"> mu</span> (<span class="id">M</span><span class="id"> n</span>)<span class="id"> &lt;=</span><span class="id"> mu</span> (<span class="id">M'</span><span class="id"> n</span>)<span class="id"> +</span> (<span class="id">e2</span><span class="id"> n</span>)<span class="id">%:E</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> /M;</span><span class="id"> case:</span><span class="id"> pselect</span><span class="id"> =&gt;</span><span class="id"> /=</span><span class="id"> [-&gt;|]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> measure0</span><span class="id"> add0e</span><span class="id"> lee_fin</span><span class="id"> ltW</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> /ocitvP[-&gt;</span><span class="id"> //|</span><span class="id"> [[a</span><span class="id"> b</span><span class="id"> /=</span><span class="id"> alb</span><span class="id"> -&gt;</span><span class="id"> ab0]]]</span><span class="id"> :</span><span class="id"> ocitv</span> (<span class="id">M'</span><span class="id"> n</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> case:</span><span class="id"> covDM</span> <span class="id"> =&gt;</span><span class="id"> /</span>(_<span class="id"> n</span>).<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> inf_itv//</span><span class="id"> sup_itv//</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> -&gt;</span><span class="id"> :</span> (<span class="id">`]a,</span> (<span class="id">b</span><span class="id"> +</span><span class="id"> e2</span><span class="id"> n</span>)<span class="id">%R[</span><span class="id"> =</span><span class="id"> `]a,</span><span class="id"> b]</span><span class="id"> `|`</span><span class="id"> `]b,</span> (<span class="id">b</span><span class="id"> +</span><span class="id"> e2</span><span class="id"> n</span>)<span class="id">%R[</span> )<span class="id">%classic</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> funext=&gt;</span><span class="id"> r</span><span class="id"> /=;</span><span class="id"> rewrite</span> (<span class="id">@itv_splitU</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">BRight</span><span class="id"> b</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> propeqE;</span><span class="id"> split=&gt;</span><span class="id"> /orP</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> !bnd_simp</span> (<span class="id">ltW</span><span class="id"> alb</span>)<span class="id">/=</span><span class="id"> ltr_pwDr</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> measureU/=</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> rewrite</span><span class="id"> !lebesgue_measure_itv/=</span><span class="id"> !lte_fin</span><span class="id"> alb</span><span class="id"> ltr_pwDr//=</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -</span>(<span class="id">EFinD</span> (<span class="id">b</span><span class="id"> +</span><span class="id"> e2</span><span class="id"> n</span>)) (<span class="id">addrC</span><span class="id"> b</span>)<span class="id"> addrK</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> sub_sigma_algebra;</span><span class="id"> exact:</span><span class="id"> is_ocitv</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> open_measurable;</span><span class="id"> exact:</span><span class="id"> interval_open</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> rewrite</span><span class="id"> eqEsubset;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> r</span><span class="id"> []/andP</span><span class="id"> [_</span><span class="id"> +]</span><span class="id"> /andP[+</span><span class="id"> _]</span><span class="id"> /=</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> !bnd_simp</span><span class="id"> =&gt;</span><span class="id"> /le_lt_trans</span><span class="id"> /[apply];</span><span class="id"> rewrite</span><span class="id"> ltxx</span>.<br/>
<span class="id">pose</span><span class="id"> U</span><span class="id"> :=</span><span class="id"> \bigcup_n</span><span class="id"> M</span><span class="id"> n</span>.<br/>
<span class="gallina-kwd">exists</span><span class="id"> U;</span><span class="id"> have</span><span class="id"> DU</span><span class="id"> :</span><span class="id"> D</span><span class="id"> `&lt;=`</span><span class="id"> U</span>.<br/>
&nbsp;&nbsp;<span class="id">case:</span> (<span class="id">covDM</span>)<span class="id"> =&gt;</span><span class="id"> _</span><span class="id"> /subset_trans;</span><span class="id"> apply;</span><span class="id"> apply:</span><span class="id"> subset_bigcup</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> /M</span><span class="id"> =&gt;</span><span class="id"> n</span><span class="id"> _</span><span class="id"> x;</span><span class="id"> case:</span><span class="id"> pselect</span><span class="id"> =&gt;</span><span class="id"> [/=</span><span class="id"> -&gt;</span><span class="id"> //|]</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> /ocitvP</span><span class="id"> [-&gt;</span><span class="id"> //|</span><span class="id"> [[/=</span><span class="id"> a</span><span class="id"> b</span><span class="id"> alb</span><span class="id"> -&gt;</span><span class="id"> mn]]]</span><span class="id"> :</span><span class="id"> ocitv</span> (<span class="id">M'</span><span class="id"> n</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> case:</span><span class="id"> covDM</span><span class="id"> =&gt;</span><span class="id"> /</span>(_<span class="id"> n</span>).<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> /=</span><span class="id"> !in_itv/=</span><span class="id"> =&gt;</span><span class="id"> /andP[ax</span><span class="id"> xb];</span><span class="id"> rewrite</span><span class="id"> ?inf_itv</span><span class="id"> ?sup_itv//</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> ax/=</span> (<span class="id">le_lt_trans</span><span class="id"> xb</span>)<span class="id">//</span><span class="id"> ltr_pwDr</span>.<br/>
<span class="id">have</span><span class="id"> mM</span><span class="id"> n</span><span class="id"> :</span><span class="id"> measurable</span> (<span class="id">M</span><span class="id"> n</span>).<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> /M;</span><span class="id"> case:</span><span class="id"> pselect;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> /=</span><span class="id"> _;</span><span class="id"> exact:</span><span class="id"> measurable0</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> /=</span><span class="id"> _;</span><span class="id"> apply:</span><span class="id"> open_measurable;</span><span class="id"> apply:</span><span class="id"> interval_open</span>.<br/>
<span class="id">have</span><span class="id"> muU</span><span class="id"> :</span><span class="id"> mu</span><span class="id"> U</span><span class="id"> &lt;</span><span class="id"> mu</span><span class="id"> D</span><span class="id"> +</span><span class="id"> eps%:E</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span> (<span class="id">@le_lt_trans</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">\sum_</span>(<span class="id">n</span><span class="id"> &lt;oo</span>)<span class="id"> mu</span> (<span class="id">M</span><span class="id"> n</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> outer_measure_sigma_subadditive</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span> (<span class="id">@le_lt_trans</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">\sum_</span>(<span class="id">n</span><span class="id"> &lt;oo</span>) (<span class="id">mu</span> (<span class="id">M'</span><span class="id"> n</span>)<span class="id"> +</span> (<span class="id">e2</span><span class="id"> n</span>)<span class="id">%:E</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> lee_nneseries</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> le_lt_trans</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> epsilon_trick</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> rewrite</span><span class="id"> divr_ge0//</span><span class="id"> ltW</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> {2}[eps]splitr</span><span class="id"> EFinD</span><span class="id"> addeA</span><span class="id"> lte_leD//</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> (<span class="id">le_lt_trans</span><span class="id"> _</span><span class="id"> zDe</span>)<span class="id">//</span><span class="id"> -sMz</span><span class="id"> lee_nneseries//</span><span class="id"> =&gt;</span><span class="id"> i</span><span class="id"> _</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> /=</span><span class="id"> -wlength_Rhull</span><span class="id"> wlength_itv</span><span class="id"> !er_map_idfun</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -lebesgue_measure_itv</span><span class="id"> le_measure//=</span><span class="id"> ?inE</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> case:</span><span class="id"> covDM</span><span class="id"> =&gt;</span><span class="id"> /</span>(_<span class="id"> i</span>)<span class="id"> +</span><span class="id"> _;</span><span class="id"> exact:</span><span class="id"> sub_sigma_algebra</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> exact:</span><span class="id"> measurable_itv</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> exact:</span><span class="id"> sub_Rhull</span>.<br/>
<span class="id">split</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> bigcup_open</span><span class="id"> =&gt;</span><span class="id"> n</span><span class="id"> _</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /M;</span><span class="id"> case:</span><span class="id"> pselect</span><span class="id"> =&gt;</span><span class="id"> /=</span><span class="id"> _;</span><span class="id"> [exact:</span><span class="id"> open0|exact:</span><span class="id"> interval_open]</span>.<br/>
<span class="id">rewrite</span><span class="id"> measureD//=</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> setIidr//</span><span class="id"> lte_subel_addl//</span><span class="id"> ge0_fin_numE//</span> (<span class="id">lt_le_trans</span><span class="id"> muU</span>)<span class="id">//</span><span class="id"> leey</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> bigcup_measurable</span><span class="id"> =&gt;</span><span class="id"> k</span><span class="id"> _;</span><span class="id"> exact:</span><span class="id"> mM</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span> (<span class="id">lt_le_trans</span><span class="id"> muU</span>)<span class="id">//</span><span class="id"> leey</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> lebesgue_nearly_bounded</span> (<span class="id">D</span><span class="id"> :</span><span class="id"> set</span><span class="id"> R</span>) (<span class="id">eps</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">measurable</span><span class="id"> D</span><span class="id"> -&gt;</span><span class="id"> mu</span><span class="id"> D</span><span class="id"> &lt;</span><span class="id"> +oo</span><span class="id"> -&gt;</span> (<span class="id">0</span><span class="id"> &lt;</span><span class="id"> eps</span>)<span class="id">%R</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">exists</span><span class="id"> ab</span><span class="id"> :</span><span class="id"> R</span><span class="id"> *</span><span class="id"> R,</span><span class="id"> mu</span> (<span class="id">D</span><span class="id"> `\`</span><span class="id"> [set`</span><span class="id"> `[ab</span>.<span class="id">1,ab</span>.<span class="id">2]]</span>)<span class="id"> &lt;</span><span class="id"> eps%:E</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> mD</span><span class="id"> Dfin</span><span class="id"> epspos;</span><span class="id"> pose</span><span class="id"> Dn</span><span class="id"> n</span><span class="id"> :=</span><span class="id"> D</span><span class="id"> `&amp;`</span><span class="id"> [set`</span><span class="id"> `[-</span>(<span class="id">n%:R</span>)<span class="id">,</span><span class="id"> n%:R]]%R</span>.<br/>
<span class="id">have</span><span class="id"> mDn</span><span class="id"> n</span><span class="id"> :</span><span class="id"> measurable</span> (<span class="id">Dn</span><span class="id"> n</span>)<span class="gallina-kwd"> by</span><span class="id"> exact:</span><span class="id"> measurableI</span>.<br/>
<span class="id">have</span><span class="id"> :</span><span class="id"> mu</span><span class="id"> \o</span><span class="id"> Dn</span><span class="id"> @</span><span class="id"> \oo</span><span class="id"> --&gt;</span><span class="id"> mu</span> (<span class="id">\bigcup_n</span><span class="id"> Dn</span><span class="id"> n</span>).<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> nondecreasing_cvg_mu</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> bigcup_measurable</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> ?</span><span class="id"> _;</span><span class="id"> exact:</span><span class="id"> mDn</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> move=&gt;</span><span class="id"> n</span><span class="id"> m</span><span class="id"> nm;</span><span class="id"> apply/subsetPset;</span><span class="id"> apply:</span><span class="id"> setIS</span><span class="id"> =&gt;</span><span class="id"> z</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> !in_itv/=</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> /andP[nz</span><span class="id"> zn];</span><span class="id"> rewrite</span> (<span class="id">le_trans</span><span class="id"> _</span><span class="id"> nz</span>)<span class="id">/=</span><span class="id"> ?</span>(<span class="id">le_trans</span><span class="id"> zn</span>)<span class="id"> ?ler_nat//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> lerNl</span><span class="id"> opprK</span><span class="id"> ler_nat</span>.<br/>
<span class="id">rewrite</span><span class="id"> -setI_bigcupr;</span><span class="id"> rewrite</span><span class="id"> bigcup_itvT</span><span class="id"> setIT</span>.<br/>
<span class="id">have</span><span class="id"> finDn</span><span class="id"> n</span><span class="id"> :</span><span class="id"> mu</span> (<span class="id">Dn</span><span class="id"> n</span>)<span class="id"> \is</span><span class="id"> a</span><span class="id"> fin_num</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> ge0_fin_numE//</span> (<span class="id">le_lt_trans</span><span class="id"> _</span><span class="id"> Dfin</span>)<span class="id">//</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> le_measure//</span><span class="id"> ?inE//=;</span><span class="id"> [exact:</span><span class="id"> mDn|exact:</span><span class="id"> subIsetl]</span>.<br/>
<span class="id">have</span><span class="id"> finD</span><span class="id"> :</span><span class="id"> mu</span><span class="id"> D</span><span class="id"> \is</span><span class="id"> a</span><span class="id"> fin_num</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> fin_num_abs</span><span class="id"> gee0_abs</span>.<br/>
<span class="id">rewrite</span><span class="id"> -[mu</span><span class="id"> D]fineK//</span><span class="id"> =&gt;</span><span class="id"> /fine_cvg/</span>(_ (<span class="id">interior</span> (<span class="id">ball</span> (<span class="id">fine</span> (<span class="id">mu</span><span class="id"> D</span>))<span class="id"> eps</span>)))<span class="id">[]</span>.<br/>
&nbsp;&nbsp;<span class="id">exact/nbhs_interior/nbhsx_ballx</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> n</span><span class="id"> _</span><span class="id"> /</span>(_<span class="id"> _</span> (<span class="id">leqnn</span><span class="id"> n</span>))<span class="id">/interior_subset</span><span class="id"> muDN</span>.<br/>
<span class="gallina-kwd">exists</span> (<span class="id">-n%:R,</span><span class="id"> n%:R</span>)<span class="id">%R;</span><span class="id"> rewrite</span><span class="id"> measureD//=</span>.<br/>
<span class="id">move:</span><span class="id"> muDN;</span><span class="id"> rewrite</span><span class="id"> /ball/=</span><span class="id"> /ereal_ball/=</span><span class="id"> -fineB//=;</span><span class="id"> last</span><span class="id"> exact:</span><span class="id"> finDn</span>.<br/>
<span class="id">rewrite</span><span class="id"> -lte_fin;</span><span class="id"> apply:</span><span class="id"> le_lt_trans</span>.<br/>
<span class="id">have</span><span class="id"> finDDn</span><span class="id"> :</span><span class="id"> mu</span><span class="id"> D</span><span class="id"> -</span><span class="id"> mu</span> (<span class="id">Dn</span><span class="id"> n</span>)<span class="id"> \is</span><span class="id"> a</span><span class="id"> fin_num</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> ?fin_numB</span><span class="id"> ?finD</span><span class="id"> /=</span><span class="id"> ?</span>(<span class="id">finDn</span><span class="id"> n</span>).<br/>
<span class="id">rewrite</span><span class="id"> -fine_abse</span><span class="id"> //</span><span class="id"> gee0_abs</span><span class="id"> ?sube_ge0</span><span class="id"> ?finD</span><span class="id"> ?</span>(<span class="id">finDn</span><span class="id"> _</span>)<span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -[_</span><span class="id"> -</span><span class="id"> _]fineK</span><span class="id"> //</span><span class="id"> lte_fin</span><span class="id"> fine</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> le_measure//</span><span class="id"> ?inE//;</span><span class="id"> [exact:</span><span class="id"> measurableI</span><span class="id"> |exact:</span><span class="id"> subIsetl]</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> lebesgue_regularity_inner</span> (<span class="id">D</span><span class="id"> :</span><span class="id"> set</span><span class="id"> R</span>) (<span class="id">eps</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">measurable</span><span class="id"> D</span><span class="id"> -&gt;</span><span class="id"> mu</span><span class="id"> D</span><span class="id"> &lt;</span><span class="id"> +oo</span><span class="id"> -&gt;</span> (<span class="id">0</span><span class="id"> &lt;</span><span class="id"> eps</span>)<span class="id">%R</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">exists</span><span class="id"> V</span><span class="id"> :</span><span class="id"> set</span><span class="id"> R,</span><span class="id"> [/\</span><span class="id"> compact</span><span class="id"> V</span><span class="id"> ,</span><span class="id"> V</span><span class="id"> `&lt;=`</span><span class="id"> D</span><span class="id"> &amp;</span><span class="id"> mu</span> (<span class="id">D</span><span class="id"> `\`</span><span class="id"> V</span>)<span class="id"> &lt;</span><span class="id"> eps%:E]</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> mD</span><span class="id"> finD</span><span class="id"> epspos</span>.<br/>
<span class="id">wlog</span><span class="id"> :</span><span class="id"> eps</span><span class="id"> epspos</span><span class="id"> D</span><span class="id"> mD</span><span class="id"> finD</span><span class="id"> /</span><span class="gallina-kwd"> exists</span><span class="id"> ab</span><span class="id"> :</span><span class="id"> R</span><span class="id"> *</span><span class="id"> R,</span><span class="id"> D</span><span class="id"> `&lt;=`</span><span class="id"> `[ab</span>.<span class="id">1,</span><span class="id"> ab</span>.<span class="id">2]%classic</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> WL;</span><span class="id"> have</span><span class="id"> []</span><span class="id"> :=</span><span class="id"> @lebesgue_nearly_bounded</span><span class="id"> _</span> (<span class="id">eps</span><span class="id"> /</span><span class="id"> 2</span>)<span class="id">%R</span><span class="id"> mD</span><span class="id"> finD</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> divr_gt0</span>.<br/>
&nbsp;&nbsp;<span class="id">case=&gt;</span><span class="id"> a</span><span class="id"> b</span><span class="id"> /=</span><span class="id"> muDabe;</span><span class="id"> have</span><span class="id"> []</span><span class="id"> :=</span><span class="id"> WL</span> (<span class="id">eps</span><span class="id"> /</span><span class="id"> 2</span>)<span class="id"> _</span> (<span class="id">D</span><span class="id"> `&amp;`</span><span class="id"> `[a,b]</span>).<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> divr_gt0</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> exact:</span><span class="id"> measurableI</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span> (<span class="id">le_lt_trans</span><span class="id"> _</span><span class="id"> finD</span>)<span class="id">//</span><span class="id"> le_measure//</span><span class="id"> inE//;</span><span class="id"> exact:</span><span class="id"> measurableI</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="gallina-kwd"> exists</span> (<span class="id">a,</span><span class="id"> b</span>).<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> V</span><span class="id"> [/=</span><span class="id"> cptV</span><span class="id"> VDab</span><span class="id"> Dabeps2];</span><span class="gallina-kwd"> exists</span> (<span class="id">V</span><span class="id"> `&amp;`</span><span class="id"> `[a,</span><span class="id"> b]</span>)<span class="id">;</span><span class="id"> split</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> apply:</span> (<span class="id">subclosed_compact</span><span class="id"> _</span><span class="id"> cptV</span>)<span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> apply:</span><span class="id"> closedI</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> compact_closed</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> Rhausdorff</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> interval_closed</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> ?</span><span class="id"> [/VDab</span><span class="id"> []]</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> setDIr</span> (<span class="id">setU_id2r</span> ((<span class="id">D</span><span class="id"> `&amp;`</span><span class="id"> `[a,</span><span class="id"> b]</span>)<span class="id"> `\`</span><span class="id"> V</span>))<span class="id">;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> z</span><span class="id"> ;</span><span class="id"> rewrite</span><span class="id"> setDE</span><span class="id"> setCI</span><span class="id"> setCK</span><span class="id"> =&gt;</span><span class="id"> -[?|?];</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply/propext;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> [[]|[[]]]</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> mV</span><span class="id"> :</span><span class="id"> measurable</span><span class="id"> V</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> closed_measurable;</span><span class="id"> apply:</span><span class="id"> compact_closed</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> Rhausdorff</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> [eps]splitr</span><span class="id"> EFinD</span> (<span class="id">measureU</span><span class="id"> mu</span>)<span class="id"> //</span><span class="id"> ?lteD</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> measurableD</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> measurableI</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="id"> exact:</span><span class="id"> measurableD</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> eqEsubset;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> z</span><span class="id"> //</span><span class="id"> [[[_</span><span class="id"> +</span><span class="id"> _]</span><span class="id"> [_]]]</span>.<br/>
<span class="id">case=&gt;</span><span class="id"> -[a</span><span class="id"> b]</span><span class="id"> /=</span><span class="id"> Dab;</span><span class="id"> pose</span><span class="id"> D'</span><span class="id"> :=</span><span class="id"> `[a,b]</span><span class="id"> `\`</span><span class="id"> D</span>.<br/>
<span class="id">have</span><span class="id"> mD'</span><span class="id"> :</span><span class="id"> measurable</span><span class="id"> D'</span><span class="gallina-kwd"> by</span><span class="id"> exact:</span><span class="id"> measurableD</span>.<br/>
<span class="id">have</span><span class="id"> []</span><span class="id"> :=</span><span class="id"> lebesgue_regularity_outer</span><span class="id"> mD'</span><span class="id"> _</span><span class="id"> epspos</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> (<span class="id">@le_lt_trans</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">mu</span><span class="id"> `[a,b]%classic</span>))<span class="id">//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> le_measure</span><span class="id"> ?inE//;</span><span class="id"> exact:</span><span class="id"> subIsetl</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /=</span><span class="id"> lebesgue_measure_itv/=</span><span class="id"> -EFinD</span><span class="id"> -</span>(<span class="id">fun_if</span><span class="id"> EFin</span>)<span class="id"> ltry</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> U</span><span class="id"> [oU</span><span class="id"> /subsetC</span><span class="id"> +</span><span class="id"> mDeps];</span><span class="id"> rewrite</span><span class="id"> setCI</span><span class="id"> setCK</span><span class="id"> =&gt;</span><span class="id"> nCD'</span>.<br/>
<span class="gallina-kwd">exists</span> (<span class="id">`[a,</span><span class="id"> b]</span><span class="id"> `&amp;`</span><span class="id"> ~`</span><span class="id"> U</span>)<span class="id">;</span><span class="id"> split</span>.<br/>
<span class="id">-</span><span class="id"> apply:</span> (<span class="id">subclosed_compact</span><span class="id"> _</span> (<span class="id">@segment_compact</span><span class="id"> _</span><span class="id"> a</span><span class="id"> b</span>))<span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> closedI;</span><span class="id"> [exact:</span><span class="id"> interval_closed</span><span class="id"> |</span><span class="id"> exact:</span><span class="id"> open_closedC]</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> z</span><span class="id"> [abz]</span><span class="id"> /nCD'[]</span>.<br/>
<span class="id">-</span><span class="id"> rewrite</span><span class="id"> setDE</span><span class="id"> setCI</span><span class="id"> setIUr</span><span class="id"> setCK</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> [_</span><span class="id"> `&amp;`</span><span class="id"> ~`</span><span class="id"> _</span><span class="id"> ]</span>(<span class="id">iffRL</span> (<span class="id">disjoints_subset</span><span class="id"> _</span><span class="id"> _</span>))<span class="id"> ?setCK</span><span class="id"> //</span><span class="id"> set0U</span>.<br/>
&nbsp;&nbsp;<span class="id">move:</span><span class="id"> mDeps;</span><span class="id"> rewrite</span><span class="id"> /D'</span><span class="id"> ?setDE</span><span class="id"> setCI</span><span class="id"> setIUr</span><span class="id"> setCK</span><span class="id"> [U</span><span class="id"> `&amp;`</span><span class="id"> D]setIC</span>.<br/>
&nbsp;&nbsp;<span class="id">move</span><span class="id"> =&gt;</span><span class="id"> /</span>(<span class="id">le_lt_trans</span><span class="id"> _</span>)<span class="id">;</span><span class="id"> apply;</span><span class="id"> apply:</span><span class="id"> le_measure;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> move</span><span class="id"> =&gt;</span><span class="id"> ?;</span><span class="id"> right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> inE;</span><span class="id"> apply:</span><span class="id"> measurableI</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> open_measurable</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> inE;</span><span class="id"> apply:</span><span class="id"> measurableU</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> measurableI;</span><span class="id"> [exact:</span><span class="id"> open_measurable|exact:</span><span class="id"> measurableC]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> measurableI</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> open_measurable</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Let</span><span class="id"> lebesgue_regularity_innerE_bounded</span> (<span class="id">A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> R</span>)<span class="id"> :</span><span class="id"> measurable</span><span class="id"> A</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">mu</span><span class="id"> A</span><span class="id"> &lt;</span><span class="id"> +oo</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">mu</span><span class="id"> A</span><span class="id"> =</span><span class="id"> ereal_sup</span><span class="id"> [set</span><span class="id"> mu</span><span class="id"> K</span><span class="id"> |</span><span class="id"> K</span><span class="gallina-kwd"> in</span><span class="id"> [set</span><span class="id"> K</span><span class="id"> |</span><span class="id"> compact</span><span class="id"> K</span><span class="id"> /\</span><span class="id"> K</span><span class="id"> `&lt;=`</span><span class="id"> A]]</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> mA</span><span class="id"> muA;</span><span class="id"> apply/eqP;</span><span class="id"> rewrite</span><span class="id"> eq_le;</span><span class="id"> apply/andP;</span><span class="id"> split;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> ub_ereal_sup</span><span class="id"> =&gt;</span><span class="id"> /=</span><span class="id"> x</span><span class="id"> [B</span><span class="id"> /=</span><span class="id"> [cB</span><span class="id"> BA</span><span class="id"> &lt;-{x}]];</span><span class="id"> exact:</span><span class="id"> le_outer_measure</span>.<br/>
<span class="id">apply/lee_addgt0Pr</span><span class="id"> =&gt;</span><span class="id"> e</span><span class="id"> e0</span>.<br/>
<span class="id">have</span><span class="id"> [B</span><span class="id"> [cB</span><span class="id"> BA</span><span class="id"> /=</span><span class="id"> ABe]]</span><span class="id"> :=</span><span class="id"> lebesgue_regularity_inner</span><span class="id"> mA</span><span class="id"> muA</span><span class="id"> e0</span>.<br/>
<span class="id">rewrite</span><span class="id"> -{1}</span>(<span class="id">setDKU</span><span class="id"> BA</span>) (<span class="id">@le_trans</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">mu</span><span class="id"> B</span><span class="id"> +</span><span class="id"> mu</span> (<span class="id">A</span><span class="id"> `\`</span><span class="id"> B</span>)))<span class="id">//</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> setUC</span><span class="id"> outer_measureU2</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> leeD//;</span><span class="id"> [apply:</span><span class="id"> ereal_sup_ubound</span><span class="id"> =&gt;</span><span class="id"> /=;</span><span class="gallina-kwd"> exists</span><span class="id"> B|exact/ltW]</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> lebesgue_regularity_inner_sup</span> (<span class="id">D</span><span class="id"> :</span><span class="id"> set</span><span class="id"> R</span>)<span class="id"> :</span><span class="id"> measurable</span><span class="id"> D</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">mu</span><span class="id"> D</span><span class="id"> =</span><span class="id"> ereal_sup</span><span class="id"> [set</span><span class="id"> mu</span><span class="id"> K</span><span class="id"> |</span><span class="id"> K</span><span class="gallina-kwd"> in</span><span class="id"> [set</span><span class="id"> K</span><span class="id"> |</span><span class="id"> compact</span><span class="id"> K</span><span class="id"> /\</span><span class="id"> K</span><span class="id"> `&lt;=`</span><span class="id"> D]]</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> mD;</span><span class="id"> have</span><span class="id"> [?|]</span><span class="id"> :=</span><span class="id"> ltP</span> (<span class="id">mu</span><span class="id"> D</span>)<span class="id"> +oo</span>.<br/>
&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> lebesgue_regularity_innerE_bounded</span>.<br/>
<span class="id">have</span><span class="id"> /sigma_finiteP</span><span class="id"> [F</span><span class="id"> [RFU</span><span class="id"> Fsub</span><span class="id"> ffin]]</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">sigma_finiteT</span> (<span class="id">lebesgue_stieltjes_measure</span> (<span class="id">@idfun</span><span class="id"> R</span>)).<br/>
<span class="id">rewrite</span><span class="id"> leye_eq</span><span class="id"> =&gt;</span><span class="id"> /eqP</span><span class="id"> /[dup]</span><span class="id"> +</span><span class="id"> -&gt;</span>.<br/>
<span class="id">have</span><span class="id"> {1}-&gt;</span><span class="id"> :</span><span class="id"> D</span><span class="id"> =</span><span class="id"> \bigcup_n</span> (<span class="id">F</span><span class="id"> n</span><span class="id"> `&amp;`</span><span class="id"> D</span>)<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> -setI_bigcupl</span><span class="id"> -RFU</span><span class="id"> setTI</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> FDp;</span><span class="id"> apply/esym/eq_infty</span><span class="id"> =&gt;</span><span class="id"> M</span>.<br/>
<span class="id">have</span><span class="id"> :</span> (<span class="gallina-kwd">fun</span><span class="id"> n</span><span class="id"> =&gt;</span><span class="id"> mu</span> (<span class="id">F</span><span class="id"> n</span><span class="id"> `&amp;`</span><span class="id"> D</span>))<span class="id"> @</span><span class="id"> \oo</span><span class="id"> --&gt;</span><span class="id"> +oo</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -FDp;</span><span class="id"> apply:</span><span class="id"> nondecreasing_cvg_mu</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> i;</span><span class="id"> apply:</span><span class="id"> measurableI</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span> (<span class="id">ffin</span><span class="id"> i</span>).<span class="id">1</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> bigcup_measurable</span><span class="id"> =&gt;</span><span class="id"> i</span><span class="id"> _;</span><span class="id"> exact:</span> (<span class="id">measurableI</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">ffin</span><span class="id"> i</span>).<span class="id">1</span>).<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> n</span><span class="id"> m</span><span class="id"> nm;</span><span class="id"> apply/subsetPset;</span><span class="id"> apply:</span><span class="id"> setSI;</span><span class="id"> exact/subsetPset/Fsub</span>.<br/>
<span class="id">move/cvgey_ge</span><span class="id"> =&gt;</span><span class="id"> /</span>(_ (<span class="id">M</span><span class="id"> +</span><span class="id"> 1</span>)<span class="id">%R</span>)<span class="id"> [N</span><span class="id"> _</span><span class="id"> /</span>(_<span class="id"> _</span> (<span class="id">lexx</span><span class="id"> N</span>))<span class="id">]</span>.<br/>
<span class="id">have</span><span class="id"> [mFN</span><span class="id"> FNoo]</span><span class="id"> :=</span><span class="id"> ffin</span><span class="id"> N</span>.<br/>
<span class="id">have</span><span class="id"> []</span><span class="id"> :=</span><span class="id"> @lebesgue_regularity_inner</span> (<span class="id">F</span><span class="id"> N</span><span class="id"> `&amp;`</span><span class="id"> D</span>)<span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> ltr01</span>.<br/>
<span class="id">-</span><span class="id"> exact:</span><span class="id"> measurableI</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span> (<span class="id">le_lt_trans</span><span class="id"> _</span> (<span class="id">ffin</span><span class="id"> N</span>).<span class="id">2</span>)<span class="id">//=</span><span class="id"> measureIl</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> V</span><span class="id"> [/[dup]</span><span class="id"> /compact_measurable</span><span class="id"> mV</span><span class="id"> cptV</span><span class="id"> VFND]</span><span class="id"> FDV1</span><span class="id"> M1FD</span>.<br/>
<span class="id">rewrite</span> (<span class="id">@le_trans</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">mu</span><span class="id"> V</span>))<span class="id">//;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> ereal_sup_ubound;</span><span class="gallina-kwd"> exists</span><span class="id"> V</span><span class="id"> =&gt;</span><span class="id"> //=;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="id">exact:</span> (<span class="id">subset_trans</span><span class="id"> VFND</span> (<span class="id">@subIsetr</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span>)).<br/>
<span class="id">rewrite</span><span class="id"> -</span>(<span class="id">@leeD2rE</span><span class="id"> _</span><span class="id"> 1</span>)<span class="id">//</span><span class="id"> -EFinD</span> (<span class="id">le_trans</span><span class="id"> M1FD</span>)<span class="id">//</span>.<br/>
<span class="id">rewrite</span><span class="id"> /mu</span> (<span class="id">@measureDI</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">F</span><span class="id"> N</span><span class="id"> `&amp;`</span><span class="id"> D</span>)<span class="id"> _</span><span class="id"> _</span><span class="id"> mV</span>)<span class="id">/=;</span><span class="id"> last</span><span class="id"> exact:</span><span class="id"> measurableI</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> addeC</span><span class="id"> leeD//;</span><span class="id"> [rewrite</span><span class="id"> measureIr//;</span><span class="id"> exact:</span><span class="id"> measurableI|exact/ltW]</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> lebesgue_regularity</span>.<br/>
<br/>
<span class="vernacular">Definition</span><span class="id"> vitali_cover</span><span class="id"> {R</span><span class="id"> :</span><span class="id"> realType}</span> (<span class="id">E</span><span class="id"> :</span><span class="id"> set</span><span class="id"> R</span>)<span class="id"> I</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">B</span><span class="id"> :</span><span class="id"> I</span><span class="id"> -&gt;</span><span class="id"> set</span><span class="id"> R</span>) (<span class="id">D</span><span class="id"> :</span><span class="id"> set</span><span class="id"> I</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">forall</span><span class="id"> i,</span><span class="id"> is_ball</span> (<span class="id">B</span><span class="id"> i</span>))<span class="id"> /\</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">forall</span><span class="id"> x,</span><span class="id"> E</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="gallina-kwd"> forall</span><span class="id"> e</span><span class="id"> :</span><span class="id"> R,</span><span class="id"> 0</span><span class="id"> &lt;</span><span class="id"> e</span><span class="id"> -&gt;</span><span class="gallina-kwd"> exists</span><span class="id"> i,</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">[/\</span><span class="id"> D</span><span class="id"> i,</span><span class="id"> B</span><span class="id"> i</span><span class="id"> x</span><span class="id"> &amp;</span> (<span class="id">radius</span> (<span class="id">B</span><span class="id"> i</span>))<span class="id">%:num</span><span class="id"> &lt;</span><span class="id"> e]</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> vitali_theorem</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {R</span><span class="id"> :</span><span class="id"> realType}</span> (<span class="id">A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> R</span>) (<span class="id">B</span><span class="id"> :</span><span class="id"> nat</span><span class="id"> -&gt;</span><span class="id"> set</span><span class="id"> R</span>).<br/>
<span class="vernacular">Hypothesis</span><span class="id"> B0</span><span class="id"> :</span><span class="gallina-kwd"> forall</span><span class="id"> i,</span> (<span class="id">0</span><span class="id"> &lt;</span> (<span class="id">radius</span> (<span class="id">B</span><span class="id"> i</span>))<span class="id">%:num</span>)<span class="id">%R</span>.<br/>
<span class="vernacular">Notation</span><span class="id"> mu</span><span class="id"> :=</span> (<span class="id">@lebesgue_measure</span><span class="id"> R</span>).<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> vitali_theorem</span> (<span class="id">V</span><span class="id"> :</span><span class="id"> set</span><span class="id"> nat</span>)<span class="id"> :</span><span class="id"> vitali_cover</span><span class="id"> A</span><span class="id"> B</span><span class="id"> V</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">exists</span><span class="id"> D,</span><span class="id"> [/\</span><span class="id"> countable</span><span class="id"> D,</span><span class="id"> D</span><span class="id"> `&lt;=`</span><span class="id"> V,</span><span class="id"> trivIset</span><span class="id"> D</span> (<span class="id">closure</span><span class="id"> \o</span><span class="id"> B</span>)<span class="id"> &amp;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">mu</span> (<span class="id">A</span><span class="id"> `\`</span><span class="id"> \bigcup_</span>(<span class="id">k</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> closure</span> (<span class="id">B</span><span class="id"> k</span>))<span class="id"> =</span><span class="id"> 0]</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> ABV</span>.<br/>
<span class="id">wlog</span><span class="id"> VB1</span><span class="id"> :</span><span class="id"> V</span><span class="id"> ABV</span><span class="id"> /</span><span class="gallina-kwd"> forall</span><span class="id"> i,</span><span class="id"> V</span><span class="id"> i</span><span class="id"> -&gt;</span> ((<span class="id">radius</span> (<span class="id">B</span><span class="id"> i</span>))<span class="id">%:num</span><span class="id"> &lt;=</span><span class="id"> 1</span>)<span class="id">%R</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> wlg</span>.<br/>
&nbsp;&nbsp;<span class="id">pose</span><span class="id"> V'</span><span class="id"> :=</span><span class="id"> V</span><span class="id"> `\`</span><span class="id"> [set</span><span class="id"> i</span><span class="id"> |</span> (<span class="id">radius</span> (<span class="id">B</span><span class="id"> i</span>))<span class="id">%:num</span><span class="id"> &gt;</span><span class="id"> 1]%R</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> :</span><span class="id"> vitali_cover</span><span class="id"> A</span><span class="id"> B</span><span class="id"> V'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">split;</span><span class="id"> [exact:</span><span class="id"> ABV</span>.<span class="id">1|move=&gt;</span><span class="id"> x</span><span class="id"> Ax</span><span class="id"> e</span><span class="id"> e0]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">have</span><span class="id"> :</span> (<span class="id">0</span><span class="id"> &lt;</span><span class="id"> minr</span><span class="id"> e</span><span class="id"> 1</span>)<span class="id">%R</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> lt_min//</span><span class="id"> e0/=</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> /</span>(<span class="id">ABV</span>.<span class="id">2</span><span class="id"> x</span><span class="id"> Ax</span>)<span class="id">[i</span><span class="id"> [Vi</span><span class="id"> ix</span><span class="id"> ie]]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">exists</span><span class="id"> i;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //=;</span><span class="id"> rewrite</span><span class="id"> ltNge;</span><span class="id"> apply/negP/negPn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span> (<span class="id">le_trans</span> (<span class="id">ltW</span><span class="id"> ie</span>))<span class="id">//</span><span class="id"> ge_min</span><span class="id"> lexx</span><span class="id"> orbT</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span> (<span class="id">lt_le_trans</span><span class="id"> ie</span>)<span class="id">//</span><span class="id"> ge_min</span><span class="id"> lexx</span>.<br/>
&nbsp;&nbsp;<span class="id">move/wlg</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> V'B1</span><span class="id"> i</span><span class="id"> :</span><span class="id"> V'</span><span class="id"> i</span><span class="id"> -&gt;</span> ((<span class="id">radius</span> (<span class="id">B</span><span class="id"> i</span>))<span class="id">%:num</span><span class="id"> &lt;=</span><span class="id"> 1</span>)<span class="id">%R</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> [Vi</span><span class="id"> /=];</span><span class="id"> rewrite</span><span class="id"> ltNge</span><span class="id"> =&gt;</span><span class="id"> /negP/negPn</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> /</span>(_<span class="id"> V'B1</span>)<span class="id">[D</span><span class="id"> [cD</span><span class="id"> DV'</span><span class="id"> tD</span><span class="id"> h]]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="gallina-kwd"> exists</span><span class="id"> D;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> apply:</span> (<span class="id">subset_trans</span><span class="id"> DV'</span>)<span class="id"> =&gt;</span><span class="id"> ?</span><span class="id"> []</span>.<br/>
<span class="id">have</span><span class="id"> [D</span><span class="id"> [cD</span><span class="id"> DV</span><span class="id"> tDB</span><span class="id"> Dintersect]]</span><span class="id"> :=</span><span class="id"> vitali_lemma_infinite</span><span class="id"> ABV</span>.<span class="id">1</span><span class="id"> B0</span><span class="id"> VB1</span>.<br/>
<span class="gallina-kwd">exists</span><span class="id"> D;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
<span class="id">pose</span><span class="id"> Z</span><span class="id"> r</span><span class="id"> :=</span> (<span class="id">A</span><span class="id"> `\`</span><span class="id"> \bigcup_</span>(<span class="id">k</span><span class="gallina-kwd"> in</span><span class="id"> D</span>)<span class="id"> closure</span> (<span class="id">B</span><span class="id"> k</span>))<span class="id"> `&amp;`</span><span class="id"> ball</span> (<span class="id">0%R:R</span>)<span class="id"> r</span>.<br/>
<span class="id">suff:</span><span class="gallina-kwd"> forall</span><span class="id"> r</span><span class="id"> :</span><span class="id"> {posnum</span><span class="id"> R},</span><span class="id"> mu</span> (<span class="id">Z</span><span class="id"> r%:num</span>)<span class="id"> =</span><span class="id"> 0</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> Zr;</span><span class="id"> have</span><span class="id"> {}Zr</span><span class="id"> n</span><span class="id"> :</span><span class="id"> mu</span> (<span class="id">Z</span><span class="id"> n%:R</span>)<span class="id"> =</span><span class="id"> 0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">move:</span><span class="id"> n</span><span class="id"> =&gt;</span><span class="id"> [|n];</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> /Z</span> (<span class="id">ball0</span><span class="id"> _</span><span class="id"> _</span>).<span class="id">2//</span><span class="id"> setI0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span> (<span class="id">Zr</span> (<span class="id">PosNum</span> (<span class="id">ltr0Sn</span><span class="id"> _</span><span class="id"> n</span>))).<br/>
&nbsp;&nbsp;<span class="id">set</span><span class="id"> F</span><span class="id"> :=</span><span class="gallina-kwd"> fun</span><span class="id"> n</span><span class="id"> =&gt;</span><span class="id"> Z</span><span class="id"> n%:R</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> :</span><span class="id"> mu</span> (<span class="id">\bigcup_n</span><span class="id"> F</span><span class="id"> n</span>)<span class="id"> &lt;=</span><span class="id"> \sum_</span>(<span class="id">i</span><span class="id"> &lt;oo</span>)<span class="id"> mu</span> (<span class="id">F</span><span class="id"> i</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> outer_measure_sigma_subadditive</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> eseries0;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> n</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> /F</span><span class="id"> Zr</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /F</span><span class="id"> -setI_bigcupr</span><span class="id"> bigcup_ballT</span><span class="id"> setIT</span><span class="id"> measure_le0</span><span class="id"> =&gt;</span><span class="id"> /eqP</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> r</span>.<br/>
<span class="id">pose</span><span class="id"> E</span><span class="id"> :=</span><span class="id"> [set</span><span class="id"> i</span><span class="id"> |</span><span class="id"> D</span><span class="id"> i</span><span class="id"> /\</span><span class="id"> closure</span> (<span class="id">B</span><span class="id"> i</span>)<span class="id"> `&amp;`</span><span class="id"> ball</span> (<span class="id">0%R:R</span>)<span class="id"> r%:num</span><span class="id"> !=set0]</span>.<br/>
<span class="id">pose</span><span class="id"> F</span><span class="id"> :=</span><span class="id"> vitali_collection_partition</span><span class="id"> B</span><span class="id"> E</span><span class="id"> 1</span>.<br/>
<span class="id">have</span><span class="id"> E_partition</span><span class="id"> :</span><span class="id"> E</span><span class="id"> =</span><span class="id"> \bigcup_n</span> (<span class="id">F</span><span class="id"> n</span>).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -cover_vitali_collection_partition//</span><span class="id"> =&gt;</span><span class="id"> i</span><span class="id"> []</span><span class="id"> /DV</span><span class="id"> /VB1</span>.<br/>
<span class="id">have</span><span class="id"> EBr2</span><span class="id"> n</span><span class="id"> :</span><span class="id"> E</span><span class="id"> n</span><span class="id"> -&gt;</span><span class="id"> closure</span> (<span class="id">B</span><span class="id"> n</span>)<span class="id"> `&lt;=`</span> (<span class="id">ball</span> (<span class="id">0:R</span>) (<span class="id">r%:num</span><span class="id"> +</span><span class="id"> 2</span>))<span class="id">%R</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> [Dn]</span><span class="id"> [x]</span><span class="id"> =&gt;</span><span class="id"> -[Bnx</span><span class="id"> rx]</span><span class="id"> y</span><span class="id"> /=</span><span class="id"> Bny</span>.<br/>
&nbsp;&nbsp;<span class="id">move:</span><span class="id"> rx;</span><span class="id"> rewrite</span><span class="id"> /ball</span><span class="id"> /=</span><span class="id"> !sub0r</span><span class="id"> !normrN</span><span class="id"> =&gt;</span><span class="id"> rx</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -</span>(<span class="id">subrK</span><span class="id"> x</span><span class="id"> y</span>) (<span class="id">le_lt_trans</span> (<span class="id">ler_normD</span><span class="id"> _</span><span class="id"> _</span>))<span class="id">//</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> addrC</span><span class="id"> ltr_leD//</span><span class="id"> -</span>(<span class="id">subrK</span> (<span class="id">cpoint</span> (<span class="id">B</span><span class="id"> n</span>))<span class="id"> y</span>)<span class="id"> -</span>(<span class="id">addrA</span> (<span class="id">y</span><span class="id"> -</span><span class="id"> _</span>)<span class="id">%R</span>).<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> (<span class="id">le_trans</span> (<span class="id">ler_normD</span><span class="id"> _</span><span class="id"> _</span>))<span class="id">//</span> (_<span class="id"> :</span><span class="id"> 2</span><span class="id"> =</span><span class="id"> 1</span><span class="id"> +</span><span class="id"> 1</span>)<span class="id">%R//</span><span class="id"> lerD//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> distrC;</span><span class="id"> have</span><span class="id"> :=</span><span class="id"> is_ball_closureP</span> (<span class="id">ABV</span>.<span class="id">1</span><span class="id"> n</span>)<span class="id"> Bny</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> /le_trans;</span><span class="id"> apply;</span><span class="id"> rewrite</span><span class="id"> VB1//;</span><span class="id"> exact:</span><span class="id"> DV</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> :=</span><span class="id"> is_ball_closureP</span> (<span class="id">ABV</span>.<span class="id">1</span><span class="id"> n</span>)<span class="id"> Bnx</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> /le_trans;</span><span class="id"> apply;</span><span class="id"> rewrite</span><span class="id"> VB1//;</span><span class="id"> exact:</span><span class="id"> DV</span>.<br/>
<span class="id">have</span><span class="id"> measurable_closure</span> (<span class="id">C</span><span class="id"> :</span><span class="id"> set</span><span class="id"> R</span>)<span class="id"> :</span><span class="id"> is_ball</span><span class="id"> C</span><span class="id"> -&gt;</span><span class="id"> measurable</span> (<span class="id">closure</span><span class="id"> C</span>).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> ballC;</span><span class="id"> rewrite</span><span class="id"> is_ball_closure//;</span><span class="id"> exact:</span><span class="id"> measurable_closed_ball</span>.<br/>
<span class="id">move:</span><span class="id"> ABV</span><span class="id"> =&gt;</span><span class="id"> [is_ballB</span><span class="id"> ABV]</span>.<br/>
<span class="id">have</span><span class="id"> {}EBr2</span><span class="id"> :</span><span class="id"> \esum_</span>(<span class="id">i</span><span class="gallina-kwd"> in</span><span class="id"> E</span>)<span class="id"> mu</span> (<span class="id">closure</span> (<span class="id">B</span><span class="id"> i</span>))<span class="id"> &lt;=</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">mu</span> (<span class="id">ball</span> (<span class="id">0:R</span>) (<span class="id">r%:num</span><span class="id"> +</span><span class="id"> 2</span>))<span class="id">%R</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -</span>(<span class="id">set_mem_set</span><span class="id"> E</span>)<span class="id"> -nneseries_esum//</span><span class="id"> -measure_bigcup//;</span><span class="id"> last</span><span class="id"> 2</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> *;</span><span class="id"> exact:</span><span class="id"> measurable_closure</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> sub_trivIset</span><span class="id"> tDB</span><span class="id"> =&gt;</span><span class="id"> ?</span><span class="id"> []</span>.<br/>
&nbsp;&nbsp;<span class="id">apply/le_measure;</span><span class="id"> rewrite</span><span class="id"> ?inE;</span><span class="id"> [|exact:</span><span class="id"> measurable_ball|exact:</span><span class="id"> bigcup_sub]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> bigcup_measurable</span><span class="id"> =&gt;</span><span class="id"> *;</span><span class="id"> exact:</span><span class="id"> measurable_closure</span>.<br/>
<span class="id">have</span><span class="id"> finite_set_F</span><span class="id"> i</span><span class="id"> :</span><span class="id"> finite_set</span> (<span class="id">F</span><span class="id"> i</span>).<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> contrapT</span>.<br/>
&nbsp;&nbsp;<span class="id">pose</span><span class="id"> M</span><span class="id"> :=</span><span class="id"> `|ceil</span> ((<span class="id">r%:num</span><span class="id"> +</span><span class="id"> 2</span>)<span class="id"> *+</span><span class="id"> 2</span><span class="id"> /</span> (<span class="id">1</span><span class="id"> /</span> (<span class="id">2</span><span class="id"> ^</span><span class="id"> i</span>.<span class="id">+1</span>)<span class="id">%:R</span>))<span class="id">|</span>.<span class="id">+1</span>.<br/>
&nbsp;&nbsp;<span class="id">move/</span>(<span class="id">infinite_set_fset</span><span class="id"> M</span>)<span class="id"> =&gt;</span><span class="id"> [/=</span><span class="id"> C]</span><span class="id"> CsubFi</span><span class="id"> McardC</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> MC</span><span class="id"> :</span> (<span class="id">M%:R</span><span class="id"> *</span> (<span class="id">1</span><span class="id"> /</span> (<span class="id">2</span><span class="id"> ^</span><span class="id"> i</span>.<span class="id">+1</span>)<span class="id">%:R</span>))<span class="id">%:E</span><span class="id"> &lt;=</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">mu</span> (<span class="id">\bigcup_</span>(<span class="id">j</span><span class="gallina-kwd"> in</span><span class="id"> [set`</span><span class="id"> C]</span>)<span class="id"> closure</span> (<span class="id">B</span><span class="id"> j</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> (<span class="id">measure_bigcup</span><span class="id"> _</span><span class="id"> [set`</span><span class="id"> C]</span>)<span class="id">//;</span><span class="id"> last</span><span class="id"> 2</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> ?</span><span class="id"> _;</span><span class="id"> exact:</span><span class="id"> measurable_closure</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> sub_trivIset</span><span class="id"> tDB;</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span> (<span class="id">subset_trans</span><span class="id"> CsubFi</span>)<span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> [[]]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> /=</span><span class="id"> nneseries_esum//=</span><span class="id"> set_mem_set//</span><span class="id"> esum_fset//</span><span class="id"> fsbig_finite//=</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> set_fsetK</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span> (<span class="id">@le_trans</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">\sum_</span>(<span class="id">i0</span><span class="id"> &lt;-</span><span class="id"> C</span>) (<span class="id">1</span><span class="id"> /</span> (<span class="id">2</span><span class="id"> ^</span><span class="id"> i</span>.<span class="id">+1</span>)<span class="id">%:R</span>)<span class="id">%:E</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">under</span><span class="id"> eq_bigr</span><span class="id"> do</span><span class="id"> rewrite</span><span class="id"> -</span>(<span class="id">mul1r</span> (_<span class="id"> /</span><span class="id"> _</span>))<span class="id"> EFinM</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -ge0_sume_distrl//</span><span class="id"> EFinM</span><span class="id"> lee_wpmul2r//</span><span class="id"> sumEFin</span><span class="id"> lee_fin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -</span>(<span class="id">natr_sum</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">cst</span><span class="id"> 1%N</span>))<span class="id"> ler_nat</span><span class="id"> -card_fset_sum1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> big_seq</span><span class="id"> [in</span><span class="id"> leRHS]big_seq;</span><span class="id"> apply:</span><span class="id"> lee_sum</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> j</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> /CsubFi[_</span><span class="id"> /andP[+</span><span class="id"> _]]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -lte_fin</span><span class="id"> =&gt;</span><span class="id"> /ltW/le_trans;</span><span class="id"> apply</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> (<span class="id">is_ball_closure</span> (<span class="id">is_ballB</span><span class="id"> _</span>))<span class="id">//</span><span class="id"> lebesgue_measure_closed_ball//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> lee_fin</span><span class="id"> mulr2n</span><span class="id"> lerDr</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> CFi</span><span class="id"> :</span><span class="id"> mu</span> (<span class="id">\bigcup_</span>(<span class="id">j</span><span class="gallina-kwd"> in</span><span class="id"> [set`</span><span class="id"> C]</span>)<span class="id"> closure</span> (<span class="id">B</span><span class="id"> j</span>))<span class="id"> &lt;=</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">mu</span> (<span class="id">\bigcup_</span>(<span class="id">j</span><span class="gallina-kwd"> in</span><span class="id"> F</span><span class="id"> i</span>)<span class="id"> closure</span> (<span class="id">B</span><span class="id"> j</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> le_measure</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> rewrite</span><span class="id"> ?inE</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="id"> rewrite</span><span class="id"> bigcup_fset;</span><span class="id"> apply:</span><span class="id"> bigsetU_measurable</span><span class="id"> =&gt;</span><span class="id"> *</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> measurable_closure</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> bigcup_measurable</span><span class="id"> =&gt;</span><span class="id"> *;</span><span class="id"> exact:</span><span class="id"> measurable_closure</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="id"> apply:</span><span class="id"> bigcup_sub</span><span class="id"> =&gt;</span><span class="id"> j</span><span class="id"> Cj</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exact/</span>(<span class="id">@bigcup_sup</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">closure</span><span class="id"> \o</span><span class="id"> B</span>))<span class="id">/CsubFi</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> Fir2</span><span class="id"> :</span><span class="id"> mu</span> (<span class="id">\bigcup_</span>(<span class="id">j</span><span class="gallina-kwd"> in</span><span class="id"> F</span><span class="id"> i</span>)<span class="id"> closure</span> (<span class="id">B</span><span class="id"> j</span>))<span class="id"> &lt;=</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">mu</span> (<span class="id">ball</span> (<span class="id">0:R</span>) (<span class="id">r%:num</span><span class="id"> +</span><span class="id"> 2</span>))<span class="id">%R</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> (<span class="id">le_trans</span><span class="id"> _</span><span class="id"> EBr2</span>)<span class="id">//</span><span class="id"> -</span>(<span class="id">set_mem_set</span><span class="id"> E</span>)<span class="id"> -nneseries_esum</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> E_partition</span><span class="id"> -measure_bigcup//=;</span><span class="id"> last</span><span class="id"> 2</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> ?</span><span class="id"> _;</span><span class="id"> exact:</span><span class="id"> measurable_closure</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> trivIset_bigcup</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> n;</span><span class="id"> apply:</span><span class="id"> sub_trivIset</span><span class="id"> tDB</span><span class="id"> =&gt;</span><span class="id"> ?</span><span class="id"> [[]]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> n</span><span class="id"> m</span><span class="id"> i0</span><span class="id"> j</span><span class="id"> nm</span><span class="id"> [[Di0</span><span class="id"> _]</span><span class="id"> _]</span><span class="id"> [[Dj</span><span class="id"> _]</span><span class="id"> _];</span><span class="id"> exact:</span><span class="id"> tDB</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> le_measure;</span><span class="id"> rewrite</span><span class="id"> ?inE</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> bigcup_measurable</span><span class="id"> =&gt;</span><span class="id"> *;</span><span class="id"> exact:</span><span class="id"> measurable_closure</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> bigcup_measurable</span><span class="id"> =&gt;</span><span class="id"> *;</span><span class="id"> exact:</span><span class="id"> measurable_closure</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> /=</span><span class="id"> x</span><span class="id"> [n</span><span class="id"> Fni</span><span class="id"> Bnx];</span><span class="gallina-kwd"> exists</span><span class="id"> n</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="gallina-kwd"> exists</span><span class="id"> i</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> {CFi</span><span class="id"> Fir2}</span><span class="id"> :=</span><span class="id"> le_trans</span><span class="id"> MC</span> (<span class="id">le_trans</span><span class="id"> CFi</span><span class="id"> Fir2</span>).<br/>
&nbsp;&nbsp;<span class="id">apply/negP;</span><span class="id"> rewrite</span><span class="id"> -ltNge</span><span class="id"> lebesgue_measure_ball//</span><span class="id"> lte_fin</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -</span>(<span class="id">@natr1</span><span class="id"> _</span><span class="id"> `|</span><span class="id"> _</span><span class="id"> |%N</span>)<span class="id"> natr_absz</span><span class="id"> ger0_norm;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -ceil_ge0//</span> (<span class="id">lt_le_trans</span> (<span class="id">ltrN10</span><span class="id"> _</span>)).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -ltr_pdivrMr//</span><span class="id"> -ltrBlDr</span> (<span class="id">lt_le_trans</span><span class="id"> _</span> (<span class="id">ceil_ge</span><span class="id"> _</span>))<span class="id">//</span><span class="id"> ltrBlDr</span><span class="id"> ltrDl</span>.<br/>
<span class="id">have</span><span class="id"> mur2_fin_num_</span><span class="id"> :</span><span class="id"> mu</span> (<span class="id">ball</span> (<span class="id">0:R</span>) (<span class="id">r%:num</span><span class="id"> +</span><span class="id"> 2</span>))<span class="id">%R</span><span class="id"> &lt;</span><span class="id"> +oo</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> lebesgue_measure_ball//</span><span class="id"> ltry</span>.<br/>
<span class="id">have</span><span class="id"> FE</span><span class="id"> :</span><span class="id"> \sum_</span>(<span class="id">n</span><span class="id"> &lt;oo</span>)<span class="id"> \esum_</span>(<span class="id">i</span><span class="gallina-kwd"> in</span><span class="id"> F</span><span class="id"> n</span>)<span class="id"> mu</span> (<span class="id">closure</span> (<span class="id">B</span><span class="id"> i</span>))<span class="id"> =</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">mu</span> (<span class="id">\bigcup_</span>(<span class="id">i</span><span class="gallina-kwd"> in</span><span class="id"> E</span>)<span class="id"> closure</span> (<span class="id">B</span><span class="id"> i</span>)).<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> E_partition</span><span class="id"> bigcup_bigcup;</span><span class="id"> apply/esym</span>.<br/>
&nbsp;&nbsp;<span class="id">transitivity</span> (<span class="id">\sum_</span>(<span class="id">n</span><span class="id"> &lt;oo</span>)<span class="id"> mu</span> (<span class="id">\bigcup_</span>(<span class="id">i</span><span class="gallina-kwd"> in</span><span class="id"> F</span><span class="id"> n</span>)<span class="id"> closure</span> (<span class="id">B</span><span class="id"> i</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> measure_semi_bigcup</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> i;</span><span class="id"> apply:</span><span class="id"> bigcup_measurable</span><span class="id"> =&gt;</span><span class="id"> *;</span><span class="id"> exact:</span><span class="id"> measurable_closure</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="id"> apply:</span><span class="id"> trivIsetT_bigcup</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply/trivIsetP</span><span class="id"> =&gt;</span><span class="id"> i</span><span class="id"> j</span><span class="id"> _</span><span class="id"> _</span><span class="id"> ij</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> disjoint_vitali_collection_partition</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> k</span><span class="id"> -[]</span><span class="id"> /DV</span><span class="id"> /VB1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -E_partition;</span><span class="id"> apply:</span><span class="id"> sub_trivIset</span><span class="id"> tDB</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> []</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="id"> rewrite</span><span class="id"> -bigcup_bigcup;</span><span class="id"> apply:</span><span class="id"> bigcup_measurable</span><span class="id"> =&gt;</span><span class="id"> k</span><span class="id"> _</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> measurable_closure</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span> (<span class="id">@eq_eseriesr</span><span class="id"> _</span> (<span class="gallina-kwd">fun</span><span class="id"> n</span><span class="id"> =&gt;</span><span class="id"> mu</span> (<span class="id">\bigcup_</span>(<span class="id">i</span><span class="gallina-kwd"> in</span><span class="id"> F</span><span class="id"> n</span>)<span class="id"> closure</span> (<span class="id">B</span><span class="id"> i</span>)))).<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> i</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> bigcup_mkcond</span><span class="id"> measure_semi_bigcup//;</span><span class="id"> last</span><span class="id"> 3</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> j;</span><span class="id"> case:</span><span class="id"> ifPn</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> _;</span><span class="id"> exact:</span><span class="id"> measurable_closure</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply/</span>(<span class="id">trivIset_mkcond</span><span class="id"> _</span><span class="id"> _</span>).<span class="id">1;</span><span class="id"> apply:</span><span class="id"> sub_trivIset</span><span class="id"> tDB</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> [[]]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -bigcup_mkcond;</span><span class="id"> apply:</span><span class="id"> bigcup_measurable</span><span class="id"> =&gt;</span><span class="id"> k</span><span class="id"> _</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> measurable_closure</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> esum_mkcond//=</span><span class="id"> nneseries_esum//</span><span class="id"> -fun_true//=</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> under</span><span class="id"> eq_esum</span><span class="id"> do</span><span class="id"> rewrite</span> (<span class="id">fun_if</span><span class="id"> mu</span>) (<span class="id">measure0</span><span class="id"> [the</span><span class="id"> measure</span><span class="id"> _</span><span class="id"> _</span><span class="id"> of</span><span class="id"> mu]</span>).<br/>
<span class="id">apply/eqP;</span><span class="id"> rewrite</span><span class="id"> -measure_le0</span>.<br/>
<span class="id">apply/lee_addgt0Pr</span><span class="id"> =&gt;</span><span class="id"> _</span><span class="id"> /posnumP[e];</span><span class="id"> rewrite</span><span class="id"> add0e</span>.<br/>
<span class="id">have</span><span class="id"> [N</span><span class="id"> F5e]</span><span class="id"> :</span><span class="gallina-kwd"> exists</span><span class="id"> N,</span><span class="id"> \sum_</span>(<span class="id">N</span><span class="id"> &lt;=</span><span class="id"> n</span><span class="id"> &lt;oo</span>)<span class="id"> \esum_</span>(<span class="id">i</span><span class="gallina-kwd"> in</span><span class="id"> F</span><span class="id"> n</span>)<span class="id"> mu</span> (<span class="id">closure</span> (<span class="id">B</span><span class="id"> i</span>))<span class="id"> &lt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">5%:R^-1%:E</span><span class="id"> *</span><span class="id"> e%:num%:E</span>.<br/>
&nbsp;&nbsp;<span class="id">pose</span><span class="id"> f</span><span class="id"> n</span><span class="id"> :=</span><span class="id"> \bigcup_</span>(<span class="id">i</span><span class="gallina-kwd"> in</span><span class="id"> F</span><span class="id"> n</span>)<span class="id"> closure</span> (<span class="id">B</span><span class="id"> i</span>).<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> foo</span><span class="id"> :</span><span class="id"> \sum_</span>(<span class="id">k</span><span class="id"> &lt;oo</span>) (<span class="id">mu</span><span class="id"> \o</span><span class="id"> f</span>)<span class="id"> k</span><span class="id"> &lt;</span><span class="id"> +oo</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> /f</span><span class="id"> /=</span><span class="id"> [ltLHS]</span>(_<span class="id"> :</span><span class="id"> _</span><span class="id"> =</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">\sum_</span>(<span class="id">n</span><span class="id"> &lt;oo</span>)<span class="id"> \esum_</span>(<span class="id">i</span><span class="gallina-kwd"> in</span><span class="id"> F</span><span class="id"> n</span>)<span class="id"> mu</span> (<span class="id">closure</span> (<span class="id">B</span><span class="id"> i</span>)))<span class="id">;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span> (<span class="id">@eq_eseriesr</span><span class="id"> _</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="gallina-kwd">fun</span><span class="id"> k</span><span class="id"> =&gt;</span><span class="id"> mu</span> (<span class="id">\bigcup_</span>(<span class="id">i</span><span class="gallina-kwd"> in</span><span class="id"> F</span><span class="id"> k</span>)<span class="id"> closure</span> (<span class="id">B</span><span class="id"> i</span>))))<span class="id"> =&gt;</span><span class="id"> i</span><span class="id"> _</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> measure_bigcup//=</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> nneseries_esum//</span><span class="id"> set_mem_set</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> j</span><span class="id"> D'ij;</span><span class="id"> exact:</span><span class="id"> measurable_closure</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> sub_trivIset</span><span class="id"> tDB</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> x</span><span class="id"> [[]]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> FE</span> (<span class="id">@le_lt_trans</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">mu</span> (<span class="id">ball</span> (<span class="id">0</span><span class="id"> :</span><span class="id"> R</span>) (<span class="id">r%:num</span><span class="id"> +</span><span class="id"> 2</span>))<span class="id">%R</span>))<span class="id">//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> (<span class="id">le_trans</span><span class="id"> _</span><span class="id"> EBr2</span>)<span class="id">//</span><span class="id"> measure_bigcup//=</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> nneseries_esum//</span><span class="id"> set_mem_set</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> i</span><span class="id"> _;</span><span class="id"> exact:</span><span class="id"> measurable_closure</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> sub_trivIset</span><span class="id"> tDB</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> x</span><span class="id"> []</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> :</span><span class="id"> \sum_</span>(<span class="id">N</span><span class="id"> &lt;=</span><span class="id"> k</span><span class="id"> &lt;oo</span>) (<span class="id">mu</span><span class="id"> \o</span><span class="id"> f</span>)<span class="id"> k</span><span class="id"> @[N</span><span class="id"> --&gt;</span><span class="id"> \oo]</span><span class="id"> --&gt;</span><span class="id"> 0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> nneseries_tail_cvg</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> /f</span><span class="id"> /=</span><span class="id"> =&gt;</span><span class="id"> /fine_fcvg</span><span class="id"> /=</span><span class="id"> /cvgrPdist_lt</span><span class="id"> /=</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> :</span> (<span class="id">0</span><span class="id"> &lt;</span><span class="id"> 5%:R^-1</span><span class="id"> *</span><span class="id"> e%:num</span>)<span class="id">%R</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> mulr_gt0//</span><span class="id"> invr_gt0//</span><span class="id"> ltr0n</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> /[swap]</span><span class="id"> /[apply]</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> near_map</span><span class="id"> =&gt;</span><span class="id"> -[N</span><span class="id"> _]/</span>(_<span class="id"> _</span> (<span class="id">leqnn</span><span class="id"> N</span>))<span class="id"> h;</span><span class="gallina-kwd"> exists</span><span class="id"> N;</span><span class="id"> move:</span><span class="id"> h</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> sub0r</span><span class="id"> normrN</span><span class="id"> ger0_norm//;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> fine_ge0//</span><span class="id"> nneseries_ge0</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -lte_fin;</span><span class="id"> apply:</span><span class="id"> le_lt_trans</span>.<br/>
&nbsp;&nbsp;<span class="id">set</span><span class="id"> X</span><span class="id"> :</span><span class="id"> \bar</span><span class="id"> R</span><span class="id"> :=</span> (<span class="id">X</span><span class="gallina-kwd"> in</span><span class="id"> fine</span><span class="id"> X</span>).<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> Xoo</span><span class="id"> :</span><span class="id"> X</span><span class="id"> &lt;</span><span class="id"> +oo</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> le_lt_trans</span><span class="id"> foo</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span> (<span class="id">nneseries_split</span><span class="id"> _</span><span class="id"> N</span>)<span class="id">//</span><span class="id"> leeDr//;</span><span class="id"> exact:</span><span class="id"> sume_ge0</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> fineK</span><span class="id"> ?ge0_fin_numE//;</span><span class="id"> last</span><span class="id"> exact:</span><span class="id"> nneseries_ge0</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> lee_nneseries</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> i</span><span class="id"> _;</span><span class="id"> exact:</span><span class="id"> esum_ge0</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> n</span><span class="id"> Nn;</span><span class="id"> rewrite</span><span class="id"> measure_bigcup//=</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> nneseries_esum//</span><span class="id"> set_mem_set</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> i</span><span class="id"> _;</span><span class="id"> exact:</span><span class="id"> measurable_closure</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> sub_trivIset</span><span class="id"> tDB</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> [[]]</span>.<br/>
<span class="id">pose</span><span class="id"> K</span><span class="id"> :=</span><span class="id"> \bigcup_</span>(<span class="id">i</span><span class="gallina-kwd"> in</span><span class="id"> `I_N</span>)<span class="id"> \bigcup_</span>(<span class="id">j</span><span class="gallina-kwd"> in</span><span class="id"> F</span><span class="id"> i</span>)<span class="id"> closure</span> (<span class="id">B</span><span class="id"> j</span>).<br/>
<span class="id">have</span><span class="id"> closedK</span><span class="id"> :</span><span class="id"> closed</span><span class="id"> K</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> closed_bigcup</span><span class="id"> =&gt;</span><span class="id"> //=</span><span class="id"> i</span><span class="id"> iN;</span><span class="id"> apply:</span><span class="id"> closed_bigcup</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> j</span><span class="id"> Fij;</span><span class="id"> exact:</span><span class="id"> closed_closure</span>.<br/>
<span class="id">have</span><span class="id"> ZNF5</span><span class="id"> :</span><span class="id"> Z</span><span class="id"> r%:num</span><span class="id"> `&lt;=`</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">\bigcup_</span>(<span class="id">i</span><span class="gallina-kwd"> in</span><span class="id"> ~`</span><span class="id"> `I_N</span>)<span class="id"> \bigcup_</span>(<span class="id">j</span><span class="gallina-kwd"> in</span><span class="id"> F</span><span class="id"> i</span>)<span class="id"> closure</span> (<span class="id">5%:R</span><span class="id"> *`</span><span class="id"> B</span><span class="id"> j</span>).<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> z</span><span class="id"> Zz</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> Kz</span><span class="id"> :</span><span class="id"> ~</span><span class="id"> K</span><span class="id"> z</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> /K</span><span class="id"> =&gt;</span><span class="id"> -[n</span><span class="id"> /=</span><span class="id"> nN</span><span class="id"> [m]</span><span class="id"> [[Dm</span><span class="id"> _]</span><span class="id"> _]</span><span class="id"> Bmz]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> case:</span><span class="id"> Zz</span><span class="id"> =&gt;</span><span class="id"> -[_</span><span class="id"> +</span><span class="id"> _];</span><span class="id"> apply;</span><span class="gallina-kwd"> exists</span><span class="id"> m</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> [i</span><span class="id"> [Vi</span><span class="id"> Biz</span><span class="id"> Bir</span><span class="id"> BiK0]]</span><span class="id"> :</span><span class="gallina-kwd"> exists</span><span class="id"> i,</span><span class="id"> [/\</span><span class="id"> V</span><span class="id"> i,</span> (<span class="id">closure</span> (<span class="id">B</span><span class="id"> i</span>))<span class="id"> z,</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">closure</span> (<span class="id">B</span><span class="id"> i</span>)<span class="id"> `&lt;=`</span><span class="id"> ball</span> (<span class="id">0%R:R</span>)<span class="id"> r%:num</span><span class="id"> &amp;</span><span class="id"> closure</span> (<span class="id">B</span><span class="id"> i</span>)<span class="id"> `&amp;`</span><span class="id"> K</span><span class="id"> =</span><span class="id"> set0]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">case:</span><span class="id"> Zz</span><span class="id"> =&gt;</span><span class="id"> -[Az</span><span class="id"> notDBz];</span><span class="id"> rewrite</span><span class="id"> /ball/=</span><span class="id"> sub0r</span><span class="id"> normrN</span><span class="id"> =&gt;</span><span class="id"> rz</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">have</span><span class="id"> [d</span><span class="id"> dzr</span><span class="id"> zdK0]</span><span class="id"> :</span><span class="gallina-kwd"> exists2</span><span class="id"> d</span><span class="id"> :</span><span class="id"> {posnum</span><span class="id"> R},</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">d%:num</span><span class="id"> &lt;</span><span class="id"> r%:num</span><span class="id"> -</span><span class="id"> `|z|</span>)<span class="id">%R</span><span class="id"> &amp;</span><span class="id"> closed_ball</span><span class="id"> z</span><span class="id"> d%:num</span><span class="id"> `&amp;`</span><span class="id"> K</span><span class="id"> =</span><span class="id"> set0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">have</span><span class="id"> [d/=</span><span class="id"> d0</span><span class="id"> dzK]</span><span class="id"> :=</span><span class="id"> closed_disjoint_closed_ball</span><span class="id"> closedK</span><span class="id"> Kz</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">have</span><span class="id"> rz0</span><span class="id"> :</span> (<span class="id">0</span><span class="id"> &lt;</span><span class="id"> minr</span> ((<span class="id">r%:num</span><span class="id"> -</span><span class="id"> `|z|</span>)<span class="id"> /</span><span class="id"> 2</span>) (<span class="id">d</span><span class="id"> /</span><span class="id"> 2</span>))<span class="id">%R</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> lt_min</span> (<span class="id">divr_gt0</span><span class="id"> d0</span>)<span class="id">//=</span><span class="id"> andbT</span><span class="id"> divr_gt0//</span><span class="id"> subr_gt0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">exists</span> (<span class="id">PosNum</span><span class="id"> rz0</span>)<span class="id"> =&gt;</span><span class="id"> /=</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> gt_min</span><span class="id"> ltr_pdivrMr//</span><span class="id"> ltr_pMr</span><span class="id"> ?subr_gt0//</span><span class="id"> ltr1n</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> dzK</span><span class="id"> =&gt;</span><span class="id"> //=</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> sub0r</span><span class="id"> normrN</span><span class="id"> gtr0_norm//</span><span class="id"> gt_min</span> (<span class="id">ltr_pdivrMr</span><span class="id"> d</span><span class="id"> d</span>)<span class="id">//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> ltr_pMr//</span><span class="id"> ltr1n</span><span class="id"> orbT</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">have</span><span class="id"> N0_gt0</span><span class="id"> :</span> (<span class="id">0</span><span class="id"> &lt;</span><span class="id"> d%:num</span><span class="id"> /</span><span class="id"> 2</span>)<span class="id">%R</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> divr_gt0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">have</span><span class="id"> [i</span><span class="id"> [Vi</span><span class="id"> Biz</span><span class="id"> BiN0]]</span><span class="id"> :=</span><span class="id"> ABV</span><span class="id"> _</span><span class="id"> Az</span><span class="id"> _</span><span class="id"> N0_gt0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">exists</span><span class="id"> i;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> subset_closure</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> y</span><span class="id"> Biy;</span><span class="id"> rewrite</span><span class="id"> /ball/=</span><span class="id"> sub0r</span><span class="id"> normrN</span><span class="id"> -</span>(<span class="id">@subrK</span><span class="id"> _</span> (<span class="id">cpoint</span> (<span class="id">B</span><span class="id"> i</span>))<span class="id"> y</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> (<span class="id">le_lt_trans</span> (<span class="id">ler_normD</span><span class="id"> _</span><span class="id"> _</span>))<span class="id">//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> (<span class="id">@le_lt_trans</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">d%:num</span><span class="id"> /</span><span class="id"> 2</span><span class="id"> +</span><span class="id"> `|cpoint</span> (<span class="id">B</span><span class="id"> i</span>)<span class="id">|</span>)<span class="id">%R</span>)<span class="id">//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> lerD2r//</span><span class="id"> distrC</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span> (<span class="id">le_trans</span> (<span class="id">is_ball_closureP</span> (<span class="id">is_ballB</span><span class="id"> i</span>)<span class="id"> Biy</span>))<span class="id">//</span><span class="id"> ltW</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -</span>(<span class="id">@subrK</span><span class="id"> _</span><span class="id"> z</span> (<span class="id">cpoint</span> (<span class="id">B</span><span class="id"> i</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> (<span class="id">@le_lt_trans</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">d%:num</span><span class="id"> /</span><span class="id"> 2</span><span class="id"> +</span><span class="id"> `|cpoint</span> (<span class="id">B</span><span class="id"> i</span>)<span class="id"> -</span><span class="id"> z|</span><span class="id"> +</span><span class="id"> `|z|</span>)<span class="id">%R</span>)<span class="id">//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -[leRHS]addrA</span><span class="id"> lerD2l//;</span><span class="id"> exact:</span><span class="id"> ler_normD</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> (<span class="id">@le_lt_trans</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">d%:num</span><span class="id"> +</span><span class="id"> `|z|</span>)<span class="id">%R</span>)<span class="id">//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> [in</span><span class="id"> leRHS]</span>(<span class="id">splitr</span><span class="id"> d%:num</span>)<span class="id"> -!addrA</span><span class="id"> lerD2l//</span><span class="id"> lerD2r//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span> (<span class="id">le_trans</span> (<span class="id">ltW</span> (<span class="id">is_ballP</span> (<span class="id">is_ballB</span><span class="id"> i</span>)<span class="id"> Biz</span>)))<span class="id">//</span><span class="id"> ltW</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move:</span><span class="id"> dzr;</span><span class="id"> rewrite</span><span class="id"> -ltrBrDr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> subsetI_eq0</span><span class="id"> zdK0</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> y</span><span class="id"> Biy</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> closed_ballE//=</span><span class="id"> /closed_ball_/=</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -</span>(<span class="id">@subrK</span><span class="id"> _</span> (<span class="id">cpoint</span> (<span class="id">B</span><span class="id"> i</span>))<span class="id"> z</span>)<span class="id"> -</span>(<span class="id">addrA</span> (<span class="id">z</span><span class="id"> -</span><span class="id"> _</span>)<span class="id">%R</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> (<span class="id">le_trans</span> (<span class="id">ler_normD</span><span class="id"> _</span><span class="id"> _</span>))<span class="id">//</span><span class="id"> [in</span><span class="id"> leRHS]</span>(<span class="id">splitr</span><span class="id"> d%:num</span>)<span class="id"> lerD//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> distrC</span> (<span class="id">le_trans</span> (<span class="id">ltW</span> (<span class="id">is_ballP</span> (<span class="id">is_ballB</span><span class="id"> i</span>)<span class="id"> Biz</span>)))<span class="id">//</span><span class="id"> ltW</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span> (<span class="id">le_trans</span> (<span class="id">is_ball_closureP</span> (<span class="id">is_ballB</span><span class="id"> i</span>)<span class="id"> Biy</span>))<span class="id">//</span><span class="id"> ltW</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> [j</span><span class="id"> [Ej</span><span class="id"> Bij0</span><span class="id"> Bij5]]</span><span class="id"> :</span><span class="gallina-kwd"> exists</span><span class="id"> j,</span><span class="id"> [/\</span><span class="id"> E</span><span class="id"> j,</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">closure</span> (<span class="id">B</span><span class="id"> i</span>)<span class="id"> `&amp;`</span><span class="id"> closure</span> (<span class="id">B</span><span class="id"> j</span>)<span class="id"> !=set0</span><span class="id"> &amp;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">closure</span> (<span class="id">B</span><span class="id"> i</span>)<span class="id"> `&lt;=`</span><span class="id"> closure</span> (<span class="id">5%:R</span><span class="id"> *`</span><span class="id"> B</span><span class="id"> j</span>)<span class="id">]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">have</span><span class="id"> [j</span><span class="id"> [Dj</span><span class="id"> Bij0</span><span class="id"> Bij2</span><span class="id"> Bij5]]</span><span class="id"> :=</span><span class="id"> Dintersect</span><span class="id"> _</span><span class="id"> Vi</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">exists</span><span class="id"> j;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move:</span><span class="id"> Bij0;</span><span class="id"> rewrite</span><span class="id"> setIC;</span><span class="id"> exact:</span><span class="id"> subsetI_neq0</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> BjK</span><span class="id"> :</span><span class="id"> ~</span> (<span class="id">closure</span> (<span class="id">B</span><span class="id"> j</span>)<span class="id"> `&lt;=`</span><span class="id"> K</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> BjK;</span><span class="id"> move/eqP</span><span class="id"> :</span><span class="id"> BiK0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply/negP/set0P;</span><span class="id"> move:</span><span class="id"> Bij0;</span><span class="id"> exact:</span><span class="id"> subsetI_neq0</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> [k</span><span class="id"> NK</span><span class="id"> Fkj]</span><span class="id"> :</span> (<span class="id">\bigcup_</span>(<span class="id">i</span><span class="gallina-kwd"> in</span><span class="id"> ~`</span><span class="id"> `I_N</span>)<span class="id"> F</span><span class="id"> i</span>)<span class="id"> j</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">move:</span><span class="id"> Ej;</span><span class="id"> rewrite</span><span class="id"> E_partition</span><span class="id"> =&gt;</span><span class="id"> -[k</span><span class="id"> _</span><span class="id"> Fkj]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="gallina-kwd"> exists</span><span class="id"> k</span><span class="id"> =&gt;</span><span class="id"> //=</span><span class="id"> kN;</span><span class="id"> apply:</span><span class="id"> BjK</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> Bjx;</span><span class="gallina-kwd"> exists</span><span class="id"> k</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="gallina-kwd"> exists</span><span class="id"> j</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="gallina-kwd"> exists</span><span class="id"> k</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="gallina-kwd"> exists</span><span class="id"> j</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> Bij5</span>.<br/>
<span class="id">have</span><span class="id"> {}ZNF5</span><span class="id"> :</span><span class="id"> mu</span> (<span class="id">Z</span><span class="id"> r%:num</span>)<span class="id"> &lt;=</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">\sum_</span>(<span class="id">N</span><span class="id"> &lt;=</span><span class="id"> m</span><span class="id"> &lt;oo</span>)<span class="id"> \esum_</span>(<span class="id">i</span><span class="gallina-kwd"> in</span><span class="id"> F</span><span class="id"> m</span>)<span class="id"> mu</span> (<span class="id">closure</span> (<span class="id">5%:R</span><span class="id"> *`</span><span class="id"> B</span><span class="id"> i</span>)).<br/>
&nbsp;&nbsp;<span class="id">apply:</span> (<span class="id">@le_trans</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">mu</span> (<span class="id">\bigcup_</span>(<span class="id">i</span><span class="gallina-kwd"> in</span><span class="id"> ~`</span><span class="id"> `I_N</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">\bigcup_</span>(<span class="id">j</span><span class="gallina-kwd"> in</span><span class="id"> F</span><span class="id"> i</span>)<span class="id"> closure</span> (<span class="id">5%:R</span><span class="id"> *`</span><span class="id"> B</span><span class="id"> j</span>)))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> le_outer_measure</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span> (<span class="id">@le_trans</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">\sum_</span>(<span class="id">N</span><span class="id"> &lt;=</span><span class="id"> i</span><span class="id"> &lt;oo</span>)<span class="id"> mu</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">\bigcup_</span>(<span class="id">j</span><span class="gallina-kwd"> in</span><span class="id"> F</span><span class="id"> i</span>)<span class="id"> closure</span> (<span class="id">5%:R</span><span class="id"> *`</span><span class="id"> B</span><span class="id"> j</span>)))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> measure_sigma_subadditive_tail</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> n;</span><span class="id"> apply:</span><span class="id"> bigcup_measurable</span><span class="id"> =&gt;</span><span class="id"> k</span><span class="id"> _</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> measurable_closure;</span><span class="id"> exact:</span><span class="id"> is_scale_ball</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> bigcup_measurable</span><span class="id"> =&gt;</span><span class="id"> k</span><span class="id"> _;</span><span class="id"> apply:</span><span class="id"> bigcup_measurable</span><span class="id"> =&gt;</span><span class="id"> k'</span><span class="id"> _</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> measurable_closure;</span><span class="id"> exact:</span><span class="id"> is_scale_ball</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> lee_nneseries</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> n</span><span class="id"> _</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -[in</span><span class="id"> leRHS]</span>(<span class="id">set_mem_set</span> (<span class="id">F</span><span class="id"> n</span>))<span class="id"> -nneseries_esum//</span><span class="id"> bigcup_mkcond</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> eseries_mkcond</span><span class="id"> [leRHS]</span>(_<span class="id"> :</span><span class="id"> _</span><span class="id"> =</span><span class="id"> \sum_</span>(<span class="id">i</span><span class="id"> &lt;oo</span>)<span class="id"> mu</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="gallina-kwd">if</span><span class="id"> i</span><span class="id"> \in</span><span class="id"> F</span><span class="id"> n</span><span class="gallina-kwd"> then</span><span class="id"> closure</span> (<span class="id">5%:R</span><span class="id"> *`</span><span class="id"> B</span><span class="id"> i</span>)<span class="gallina-kwd"> else</span><span class="id"> set0</span>))<span class="id">;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">congr</span> (<span class="id">limn</span><span class="id"> _</span>)<span class="id">;</span><span class="id"> apply/funext</span><span class="id"> =&gt;</span><span class="id"> x</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> under</span><span class="id"> [RHS]eq_bigr</span><span class="id"> do</span><span class="id"> rewrite</span> (<span class="id">fun_if</span><span class="id"> mu</span>)<span class="id"> measure0</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> measure_sigma_subadditive</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="id"> move=&gt;</span><span class="id"> m;</span><span class="id"> case:</span><span class="id"> ifPn</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> _</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> measurable_closure;</span><span class="id"> exact:</span><span class="id"> is_scale_ball</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="id"> apply:</span><span class="id"> bigcup_measurable</span><span class="id"> =&gt;</span><span class="id"> k</span><span class="id"> _;</span><span class="id"> case:</span><span class="id"> ifPn</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> _</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> measurable_closure;</span><span class="id"> exact:</span><span class="id"> is_scale_ball</span>.<br/>
<span class="id">apply/</span>(<span class="id">le_trans</span><span class="id"> ZNF5</span>).<br/>
<span class="id">move/ltW:</span><span class="id"> F5e;</span><span class="id"> rewrite</span><span class="id"> [in</span><span class="id"> X</span><span class="gallina-kwd"> in</span><span class="id"> X</span><span class="id"> -&gt;</span><span class="id"> _]</span>(<span class="id">@lee_pdivlMl</span><span class="id"> R</span><span class="id"> 5%:R</span>)<span class="id"> ?ltr0n//</span>.<br/>
<span class="id">rewrite</span><span class="id"> -nneseriesZl//;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> *;</span><span class="id"> exact:</span><span class="id"> esum_ge0</span>.<br/>
<span class="id">apply:</span><span class="id"> le_trans;</span><span class="id"> apply:</span><span class="id"> lee_nneseries</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> *;</span><span class="id"> exact:</span><span class="id"> esum_ge0</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> n</span><span class="id"> _</span>.<br/>
<span class="id">rewrite</span><span class="id"> -</span>(<span class="id">set_mem_set</span> (<span class="id">F</span><span class="id"> n</span>))<span class="id"> -nneseries_esum//</span><span class="id"> -nneseries_esum//</span><span class="id"> -nneseriesZl//</span>.<br/>
<span class="id">apply:</span><span class="id"> lee_nneseries</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> m</span><span class="id"> mFn</span>.<br/>
<span class="id">rewrite</span> (<span class="id">ballE</span> (<span class="id">is_ballB</span><span class="id"> m</span>))<span class="id">//</span><span class="id"> closure_ball</span><span class="id"> lebesgue_measure_closed_ball//</span>.<br/>
<span class="id">rewrite</span><span class="id"> scale_ballE//</span><span class="id"> closure_ball</span><span class="id"> lebesgue_measure_closed_ball//</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -EFinM</span><span class="id"> mulrnAr</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> vitali_theorem</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> vitali_theorem_corollary</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {R</span><span class="id"> :</span><span class="id"> realType}</span> (<span class="id">A</span><span class="id"> :</span><span class="id"> set</span><span class="id"> R</span>) (<span class="id">B</span><span class="id"> :</span><span class="id"> nat</span><span class="id"> -&gt;</span><span class="id"> set</span><span class="id"> R</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> vitali_coverS</span> (<span class="id">F</span><span class="id"> :</span><span class="id"> set</span><span class="id"> nat</span>) (<span class="id">O</span><span class="id"> :</span><span class="id"> set</span><span class="id"> R</span>)<span class="id"> :</span><span class="id"> open</span><span class="id"> O</span><span class="id"> -&gt;</span><span class="id"> A</span><span class="id"> `&lt;=`</span><span class="id"> O</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">vitali_cover</span><span class="id"> A</span><span class="id"> B</span><span class="id"> F</span><span class="id"> -&gt;</span><span class="id"> vitali_cover</span><span class="id"> A</span><span class="id"> B</span> (<span class="id">F</span><span class="id"> `&amp;`</span><span class="id"> [set</span><span class="id"> k</span><span class="id"> |</span><span class="id"> B</span><span class="id"> k</span><span class="id"> `&lt;=`</span><span class="id"> O]</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> oO</span><span class="id"> AO</span><span class="id"> [Bball</span><span class="id"> ABF];</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> x</span><span class="id"> Ax</span><span class="id"> r</span><span class="id"> r0</span>.<br/>
<span class="id">have</span><span class="id"> [d</span><span class="id"> xdO]</span><span class="id"> :</span><span class="gallina-kwd"> exists</span><span class="id"> d</span><span class="id"> :</span><span class="id"> {posnum</span><span class="id"> R},</span><span class="id"> ball</span><span class="id"> x</span><span class="id"> d%:num</span><span class="id"> `&lt;=`</span><span class="id"> O</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> [/=</span><span class="id"> d</span><span class="id"> d0</span><span class="id"> dxO]</span><span class="id"> :=</span><span class="id"> open_subball</span><span class="id"> oO</span> (<span class="id">AO</span><span class="id"> _</span><span class="id"> Ax</span>).<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> d20</span><span class="id"> :</span> (<span class="id">0</span><span class="id"> &lt;</span><span class="id"> d</span><span class="id"> /</span><span class="id"> 2</span>)<span class="id">%R</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> divr_gt0</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">exists</span> (<span class="id">PosNum</span><span class="id"> d20</span>)<span class="id"> =&gt;</span><span class="id"> z</span><span class="id"> xdz</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span> (<span class="id">dxO</span> (<span class="id">PosNum</span><span class="id"> d20</span>)<span class="id">%:num</span>)<span class="id"> =&gt;</span><span class="id"> //=</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> sub0r</span><span class="id"> normrN</span><span class="id"> gtr0_norm//</span><span class="id"> gtr_pMr//</span><span class="id"> invf_lt1//</span><span class="id"> ltr1n</span>.<br/>
<span class="id">pose</span><span class="id"> rd2</span><span class="id"> :</span><span class="id"> R</span><span class="id"> :=</span><span class="id"> minr</span><span class="id"> r</span> (<span class="id">d%:num</span><span class="id"> /</span><span class="id"> 2</span>)<span class="id">%R</span>.<br/>
<span class="id">have</span><span class="id"> rd2_gt0</span><span class="id"> :</span> (<span class="id">0</span><span class="id"> &lt;</span><span class="id"> rd2</span>)<span class="id">%R</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> lt_min</span><span class="id"> r0//=</span><span class="id"> divr_gt0</span>.<br/>
<span class="id">have</span><span class="id"> [k</span><span class="id"> [Vk</span><span class="id"> Bkr</span><span class="id"> Bkd]]</span><span class="id"> :=</span><span class="id"> ABF</span><span class="id"> _</span><span class="id"> Ax</span><span class="id"> _</span><span class="id"> rd2_gt0</span>.<br/>
<span class="gallina-kwd">exists</span><span class="id"> k</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span> (<span class="id">lt_le_trans</span><span class="id"> Bkd</span>)<span class="id">//</span><span class="id"> ge_min//</span><span class="id"> lexx</span>.<br/>
<span class="id">split</span><span class="id"> =&gt;</span><span class="id"> //=</span>.<br/>
<span class="id">apply:</span><span class="id"> subset_trans</span><span class="id"> xdO</span><span class="id"> =&gt;</span><span class="id"> /=</span><span class="id"> z</span><span class="id"> Bkz</span>.<br/>
<span class="id">rewrite</span><span class="id"> /ball/=</span><span class="id"> -</span>(<span class="id">addrKA</span> (<span class="id">-</span><span class="id"> cpoint</span> (<span class="id">B</span><span class="id"> k</span>))).<br/>
<span class="id">rewrite</span> (<span class="id">le_lt_trans</span> (<span class="id">ler_normB</span><span class="id"> _</span><span class="id"> _</span>))<span class="id">//=</span><span class="id"> -</span>(<span class="id">addrC</span><span class="id"> z</span>).<br/>
<span class="id">rewrite</span> (<span class="id">splitr</span><span class="id"> d%:num</span>)<span class="id"> ltrD//</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> distrC</span> (<span class="id">lt_le_trans</span> (<span class="id">is_ballP</span><span class="id"> _</span><span class="id"> _</span>))<span class="id">//</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span> (<span class="id">le_trans</span> (<span class="id">ltW</span><span class="id"> Bkd</span>))<span class="id">//</span><span class="id"> ge_min</span><span class="id"> lexx</span><span class="id"> orbT</span>.<br/>
<span class="id">rewrite</span><span class="id"> distrC</span> (<span class="id">lt_le_trans</span> (<span class="id">is_ballP</span><span class="id"> _</span><span class="id"> _</span>))<span class="id">//</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span> (<span class="id">le_trans</span> (<span class="id">ltW</span><span class="id"> Bkd</span>))<span class="id">//</span><span class="id"> ge_min</span><span class="id"> lexx</span><span class="id"> orbT</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Let</span><span class="id"> vitali_cover_mclosure</span> (<span class="id">F</span><span class="id"> :</span><span class="id"> set</span><span class="id"> nat</span>)<span class="id"> k</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">vitali_cover</span><span class="id"> A</span><span class="id"> B</span><span class="id"> F</span><span class="id"> -&gt;</span> (<span class="id">R</span>.<span class="id">-ocitv</span>.<span class="id">-measurable</span>).<span class="id">-sigma</span>.<span class="id">-measurable</span> (<span class="id">closure</span> (<span class="id">B</span><span class="id"> k</span>)).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">case</span><span class="id"> =&gt;</span><span class="id"> +</span><span class="id"> _</span><span class="id"> =&gt;</span><span class="id"> /</span>(_<span class="id"> k</span>)<span class="id">/ballE</span><span class="id"> -&gt;</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> closure_ball;</span><span class="id"> exact:</span><span class="id"> measurable_closed_ball</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Let</span><span class="id"> vitali_cover_measurable</span> (<span class="id">F</span><span class="id"> :</span><span class="id"> set</span><span class="id"> nat</span>)<span class="id"> k</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">vitali_cover</span><span class="id"> A</span><span class="id"> B</span><span class="id"> F</span><span class="id"> -&gt;</span> (<span class="id">R</span>.<span class="id">-ocitv</span>.<span class="id">-measurable</span>).<span class="id">-sigma</span>.<span class="id">-measurable</span> (<span class="id">B</span><span class="id"> k</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> case</span><span class="id"> =&gt;</span><span class="id"> +</span><span class="id"> _</span><span class="id"> =&gt;</span><span class="id"> /</span>(_<span class="id"> k</span>)<span class="id">/ballE</span><span class="id"> -&gt;;</span><span class="id"> exact:</span><span class="id"> measurable_ball</span>. Qed.</div></details>
<br/>
<span class="vernacular">Let</span><span class="id"> vitali_cover_ballE</span> (<span class="id">F</span><span class="id"> :</span><span class="id"> set</span><span class="id"> nat</span>)<span class="id"> n</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">vitali_cover</span><span class="id"> A</span><span class="id"> B</span><span class="id"> F</span><span class="id"> -&gt;</span><span class="id"> B</span><span class="id"> n</span><span class="id"> =</span><span class="id"> ball</span> (<span class="id">cpoint</span> (<span class="id">B</span><span class="id"> n</span>)) (<span class="id">radius</span> (<span class="id">B</span><span class="id"> n</span>))<span class="id">%:num</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> case</span><span class="id"> =&gt;</span><span class="id"> +</span><span class="id"> _</span><span class="id"> =&gt;</span><span class="id"> /</span>(_<span class="id"> n</span>)<span class="id">/ballE</span>. Qed.</div></details>
<br/>
<span class="vernacular">Hypothesis</span><span class="id"> B0</span><span class="id"> :</span><span class="gallina-kwd"> forall</span><span class="id"> i,</span> (<span class="id">0</span><span class="id"> &lt;</span> (<span class="id">radius</span> (<span class="id">B</span><span class="id"> i</span>))<span class="id">%:num</span>)<span class="id">%R</span>.<br/>
<span class="vernacular">Notation</span><span class="id"> mu</span><span class="id"> :=</span> (<span class="id">@lebesgue_measure</span><span class="id"> R</span>).<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ereal_scope</span>.<br/>
<br/>
<span class="vernacular">Let</span><span class="id"> bigB</span> (<span class="id">G</span><span class="id"> :</span><span class="id"> set</span><span class="id"> nat</span>)<span class="id"> c</span><span class="id"> :=</span><span class="id"> G</span><span class="id"> `&amp;`</span><span class="id"> [set</span><span class="id"> k</span><span class="id"> |</span> (<span class="id">radius</span> (<span class="id">B</span><span class="id"> k</span>))<span class="id">%:num</span><span class="id"> &gt;=</span><span class="id"> c]%R</span>.<br/>
<br/>
<span class="vernacular">Let</span><span class="id"> bigBS</span> (<span class="id">G</span><span class="id"> :</span><span class="id"> set</span><span class="id"> nat</span>)<span class="id"> r</span><span class="id"> :</span><span class="id"> bigB</span><span class="id"> G</span><span class="id"> r</span><span class="id"> `&lt;=`</span><span class="id"> G</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> i</span><span class="id"> []</span>. Qed.</div></details>
<br/>
<span class="vernacular">Let</span><span class="id"> bigB0</span> (<span class="id">G</span><span class="id"> :</span><span class="id"> set</span><span class="id"> nat</span>)<span class="id"> :</span><span class="id"> bigB</span><span class="id"> G</span><span class="id"> 0%R</span><span class="id"> =</span><span class="id"> G</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> apply/seteqP;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> [//|x</span><span class="id"> Gx];</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //=</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> vitali_theorem_corollary</span> (<span class="id">F</span><span class="id"> :</span><span class="id"> set</span><span class="id"> nat</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">mu</span><span class="id"> A</span><span class="id"> &lt;</span><span class="id"> +oo%E</span><span class="id"> -&gt;</span><span class="id"> vitali_cover</span><span class="id"> A</span><span class="id"> B</span><span class="id"> F</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">forall</span><span class="id"> e,</span> (<span class="id">e</span><span class="id"> &gt;</span><span class="id"> 0</span>)<span class="id">%R</span><span class="id"> -&gt;</span><span class="gallina-kwd"> exists</span><span class="id"> G'</span><span class="id"> :</span><span class="id"> {fset</span><span class="id"> nat},</span><span class="id"> [/\</span><span class="id"> [set`</span><span class="id"> G']</span><span class="id"> `&lt;=`</span><span class="id"> F,</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">trivIset</span><span class="id"> [set`</span><span class="id"> G']</span> (<span class="id">closure</span><span class="id"> \o</span><span class="id"> B</span>)<span class="id"> &amp;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;((<span class="id">wlength</span><span class="id"> idfun</span>)<span class="id">^*</span> (<span class="id">A</span><span class="id"> `\`</span><span class="id"> \big[setU/set0]_</span>(<span class="id">k</span><span class="id"> &lt;-</span><span class="id"> G'</span>)<span class="id"> closure</span> (<span class="id">B</span><span class="id"> k</span>)))<span class="id">%mu</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">&lt;</span><span class="id"> e%:E]</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> muAfin</span><span class="id"> ABF</span><span class="id"> e</span><span class="id"> e0</span>.<br/>
<span class="id">have</span><span class="id"> [O</span><span class="id"> [oO</span><span class="id"> AO</span><span class="id"> OAoo]]</span><span class="id"> :</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">exists</span><span class="id"> O</span><span class="id"> :</span><span class="id"> set</span><span class="id"> R,</span><span class="id"> [/\</span><span class="id"> open</span><span class="id"> O,</span><span class="id"> A</span><span class="id"> `&lt;=`</span><span class="id"> O</span><span class="id"> &amp;</span><span class="id"> mu</span><span class="id"> O</span><span class="id"> &lt;</span><span class="id"> mu</span><span class="id"> A</span><span class="id"> +</span><span class="id"> 1</span><span class="id"> &lt;</span><span class="id"> +oo]</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> /</span>(<span class="id">outer_measure_open_le</span><span class="id"> A</span>)<span class="id"> :</span> (<span class="id">0</span><span class="id"> &lt;</span><span class="id"> 1</span><span class="id"> /</span><span class="id"> 2</span><span class="id"> :&gt;</span><span class="id"> R</span>)<span class="id">%R</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> divr_gt0</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> [O</span><span class="id"> [oA</span><span class="id"> AO</span><span class="id"> OAe]];</span><span class="gallina-kwd"> exists</span><span class="id"> O;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> lte_add_pinfty</span><span class="id"> ?ltry//</span><span class="id"> andbT</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> (<span class="id">le_lt_trans</span><span class="id"> OAe</span>)<span class="id">//</span><span class="id"> lteD2lE</span><span class="id"> ?ge0_fin_numE</span><span class="id"> ?outer_measure_ge0//</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> lte_fin</span><span class="id"> ltr_pdivrMr//</span><span class="id"> mul1r</span><span class="id"> ltr1n</span>.<br/>
<span class="id">pose</span><span class="id"> F'</span><span class="id"> :=</span><span class="id"> F</span><span class="id"> `&amp;`</span><span class="id"> [set</span><span class="id"> k</span><span class="id"> |</span><span class="id"> B</span><span class="id"> k</span><span class="id"> `&lt;=`</span><span class="id"> O]</span>.<br/>
<span class="id">have</span><span class="id"> ABF'</span><span class="id"> :</span><span class="id"> vitali_cover</span><span class="id"> A</span><span class="id"> B</span><span class="id"> F'</span><span class="gallina-kwd"> by</span><span class="id"> exact:</span><span class="id"> vitali_coverS</span>.<br/>
<span class="id">have</span><span class="id"> [G</span><span class="id"> [cG</span><span class="id"> GV'</span><span class="id"> tB</span><span class="id"> mAG0]]</span><span class="id"> :=</span><span class="id"> vitali_theorem</span><span class="id"> B0</span><span class="id"> ABF'</span>.<br/>
<span class="id">have</span><span class="id"> muGSfin</span><span class="id"> C</span><span class="id"> :</span><span class="id"> C</span><span class="id"> `&lt;=`</span><span class="id"> G</span><span class="id"> -&gt;</span><span class="id"> mu</span> (<span class="id">\bigcup_</span>(<span class="id">k</span><span class="gallina-kwd"> in</span><span class="id"> C</span>)<span class="id"> closure</span> (<span class="id">B</span><span class="id"> k</span>))<span class="id"> \is</span><span class="id"> a</span><span class="id"> fin_num</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> CG;</span><span class="id"> rewrite</span><span class="id"> ge0_fin_numE//</span> (<span class="id">@le_lt_trans</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">mu</span><span class="id"> O</span>))<span class="id">//;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move:</span><span class="id"> OAoo</span><span class="id"> =&gt;</span><span class="id"> /andP[OA];</span><span class="id"> exact:</span><span class="id"> lt_trans</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> (<span class="id">@le_trans</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">mu</span> (<span class="id">\bigcup_</span>(<span class="id">k</span><span class="gallina-kwd"> in</span><span class="id"> G</span>)<span class="id"> B</span><span class="id"> k</span>)))<span class="id">//;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> le_outer_measure//;</span><span class="id"> apply:</span><span class="id"> bigcup_sub</span><span class="id"> =&gt;</span><span class="id"> i</span><span class="id"> /GV'[]</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> bigcup_mkcond</span><span class="id"> [in</span><span class="id"> leRHS]bigcup_mkcond</span><span class="id"> measure_bigcup//=;</span><span class="id"> last</span><span class="id"> 2</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> i</span><span class="id"> _;</span><span class="id"> case:</span><span class="id"> ifPn</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> iG;</span><span class="id"> exact:</span><span class="id"> vitali_cover_mclosure</span><span class="id"> ABF</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply/</span>(<span class="id">trivIset_mkcond</span><span class="id"> _</span><span class="id"> _</span>).<span class="id">1;</span><span class="id"> apply:</span><span class="id"> sub_trivIset</span><span class="id"> tB</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> measure_bigcup//=;</span><span class="id"> last</span><span class="id"> 2</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> i</span><span class="id"> _;</span><span class="id"> case:</span><span class="id"> ifPn</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> _;</span><span class="id"> exact:</span><span class="id"> vitali_cover_measurable</span><span class="id"> ABF</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply/</span>(<span class="id">trivIset_mkcond</span><span class="id"> _</span><span class="id"> _</span>).<span class="id">1/trivIsetP</span><span class="id"> =&gt;</span><span class="id"> /=</span><span class="id"> i</span><span class="id"> j</span> <span class="id"> Gi</span><span class="id"> Gj</span><span class="id"> ij</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">move/trivIsetP</span><span class="id"> :</span><span class="id"> tB</span><span class="id"> =&gt;</span><span class="id"> /</span>(_<span class="id"> _</span><span class="id"> _</span><span class="id"> Gi</span><span class="id"> Gj</span><span class="id"> ij</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> subsetI_eq0;</span><span class="id"> exact:</span><span class="id"> subset_closure</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> lee_nneseries</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> n</span><span class="id"> _</span>.<br/>
&nbsp;&nbsp;<span class="id">case:</span><span class="id"> ifPn</span><span class="id"> =&gt;</span><span class="id"> [/set_mem</span><span class="id"> nC|];</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> measure0</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> (<span class="id">vitali_cover_ballE</span><span class="id"> _</span><span class="id"> ABF</span>)<span class="id"> ifT;</span><span class="id"> last</span><span class="id"> exact/mem_set/CG</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> closure_ball</span><span class="id"> lebesgue_measure_closed_ball//</span><span class="id"> lebesgue_measure_ball</span>.<br/>
<span class="id">have</span><span class="id"> muGfin</span><span class="id"> :</span><span class="id"> mu</span> (<span class="id">\bigcup_</span>(<span class="id">k</span><span class="gallina-kwd"> in</span><span class="id"> G</span>)<span class="id"> closure</span> (<span class="id">B</span><span class="id"> k</span>))<span class="id"> \is</span><span class="id"> a</span><span class="id"> fin_num</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -</span>(<span class="id">bigB0</span><span class="id"> G</span>)<span class="id"> muGSfin</span>.<br/>
<span class="id">have</span><span class="id"> [c</span><span class="id"> Hc]</span><span class="id"> :</span><span class="gallina-kwd"> exists</span><span class="id"> c</span><span class="id"> :</span><span class="id"> {posnum</span><span class="id"> R},</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">mu</span> (<span class="id">\bigcup_</span>(<span class="id">k</span><span class="gallina-kwd"> in</span><span class="id"> bigB</span><span class="id"> G</span><span class="id"> c%:num</span>)<span class="id"> closure</span> (<span class="id">B</span><span class="id"> k</span>))<span class="id"> &gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">mu</span> (<span class="id">\bigcup_</span>(<span class="id">k</span><span class="gallina-kwd"> in</span><span class="id"> G</span>)<span class="id"> closure</span> (<span class="id">B</span><span class="id"> k</span>))<span class="id"> -</span><span class="id"> e%:E</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> :</span><span class="id"> \sum_</span>(<span class="id">N</span><span class="id"> &lt;=</span><span class="id"> k</span><span class="id"> &lt;oo</span><span class="id"> |</span><span class="id"> k</span><span class="id"> \in</span><span class="id"> G</span>)<span class="id"> mu</span> (<span class="id">closure</span> (<span class="id">B</span><span class="id"> k</span>))<span class="id"> @[N</span><span class="id"> --&gt;</span><span class="id"> \oo]</span><span class="id"> --&gt;</span><span class="id"> 0%E</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">have</span><span class="id"> :</span><span class="id"> \sum_</span>(<span class="id">0</span><span class="id"> &lt;=</span><span class="id"> i</span><span class="id"> &lt;oo</span><span class="id"> |</span><span class="id"> i</span><span class="id"> \in</span><span class="id"> G</span>)<span class="id"> mu</span> (<span class="id">closure</span> (<span class="id">B</span><span class="id"> i</span>))<span class="id"> &lt;</span><span class="id"> +oo</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -measure_bigcup</span><span class="id"> -?ge0_fin_numE//=</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> i</span><span class="id"> _;</span><span class="id"> exact:</span><span class="id"> vitali_cover_mclosure</span><span class="id"> ABF</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move/</span>(<span class="id">@nneseries_tail_cvg</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">mem</span><span class="id"> G</span>))<span class="id">;</span><span class="id"> exact</span>.<br/>
&nbsp;&nbsp;<span class="id">move/fine_cvgP</span><span class="id"> =&gt;</span><span class="id"> [_]</span><span class="id"> /cvgrPdist_lt</span><span class="id"> /</span>(_<span class="id"> _</span><span class="id"> e0</span>)<span class="id">[n</span><span class="id"> _</span><span class="id"> /=]</span><span class="id"> nGe</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> [c</span><span class="id"> nc]</span><span class="id"> :</span><span class="gallina-kwd"> exists</span><span class="id"> c</span><span class="id"> :</span><span class="id"> {posnum</span><span class="id"> R},</span><span class="gallina-kwd"> forall</span><span class="id"> k,</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">c%:num</span><span class="id"> &gt;</span> (<span class="id">radius</span> (<span class="id">B</span><span class="id"> k</span>))<span class="id">%:num</span>)<span class="id">%R</span><span class="id"> -&gt;</span> (<span class="id">k</span><span class="id"> &gt;=</span><span class="id"> n</span>)<span class="id">%N</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">pose</span><span class="id"> x</span><span class="id"> :=</span> (<span class="id">\big[minr/</span>(<span class="id">radius</span> (<span class="id">B</span><span class="id"> 0</span>))<span class="id">%:num]_</span>(<span class="id">i</span><span class="id"> &lt;</span><span class="id"> n</span>.<span class="id">+1</span>) (<span class="id">radius</span> (<span class="id">B</span><span class="id"> i</span>))<span class="id">%:num</span>)<span class="id">%R</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">have</span><span class="id"> x_gt0</span><span class="id"> :</span> (<span class="id">0</span><span class="id"> &lt;</span><span class="id"> x</span>)<span class="id">%R</span><span class="gallina-kwd"> by</span><span class="id"> exact:</span><span class="id"> lt_bigmin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">exists</span> (<span class="id">PosNum</span><span class="id"> x_gt0</span>)<span class="id"> =&gt;</span><span class="id"> k</span><span class="id"> /=;</span><span class="id"> apply:</span><span class="id"> contraPleq</span><span class="id"> =&gt;</span><span class="id"> kn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply/negP;</span><span class="id"> rewrite</span><span class="id"> -leNgt;</span><span class="id"> apply/bigmin_leP</span><span class="id"> =&gt;</span><span class="id"> /=;</span><span class="id"> right</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="gallina-kwd"> exists</span> (<span class="id">widen_ord</span> (<span class="id">@leqnSn</span><span class="id"> _</span>) (<span class="id">Ordinal</span><span class="id"> kn</span>)).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">exists</span><span class="id"> c</span>.<br/>
&nbsp;&nbsp;<span class="id">suff:</span> <span class="id"> mu</span> (<span class="id">\bigcup_</span>(<span class="id">k</span><span class="gallina-kwd"> in</span><span class="id"> G</span><span class="id"> `\`</span><span class="id"> bigB</span><span class="id"> G</span><span class="id"> c%:num</span>)<span class="id"> closure</span> (<span class="id">B</span><span class="id"> k</span>))<span class="id"> &lt;</span><span class="id"> e%:E</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> EFinN</span><span class="id"> lteBlDl//</span><span class="id"> -lteBlDr//;</span><span class="id"> last</span><span class="id"> exact:</span><span class="id"> muGSfin</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> le_lt_trans</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">pose</span><span class="id"> setDbigB</span><span class="id"> :=</span> (<span class="id">\bigcup_</span>(<span class="id">k</span><span class="gallina-kwd"> in</span><span class="id"> G</span>)<span class="id"> closure</span> (<span class="id">B</span><span class="id"> k</span>))<span class="id"> `\`</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">\bigcup_</span>(<span class="id">k</span><span class="gallina-kwd"> in</span><span class="id"> bigB</span><span class="id"> G</span><span class="id"> c%:num</span>)<span class="id"> closure</span> (<span class="id">B</span><span class="id"> k</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">have</span><span class="id"> ?</span><span class="id"> :</span><span class="id"> setDbigB</span><span class="id"> `&lt;=`</span><span class="id"> \bigcup_</span>(<span class="id">k</span><span class="gallina-kwd"> in</span><span class="id"> G</span><span class="id"> `\`</span><span class="id"> bigB</span><span class="id"> G</span><span class="id"> c%:num</span>)<span class="id"> closure</span> (<span class="id">B</span><span class="id"> k</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> /=</span><span class="id"> x</span><span class="id"> [[k</span><span class="id"> Gk</span><span class="id"> Bkx]]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -[X</span><span class="gallina-kwd"> in</span><span class="id"> X</span><span class="id"> -&gt;</span><span class="id"> _]/</span>((<span class="id">~`</span><span class="id"> _</span>)<span class="id"> x</span>)<span class="id"> setC_bigcup</span><span class="id"> =&gt;</span><span class="id"> abs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="gallina-kwd"> exists</span><span class="id"> k</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> split=&gt;</span><span class="id"> //</span><span class="id"> /abs</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span> (<span class="id">@le_trans</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">mu</span><span class="id"> setDbigB</span>))<span class="id">;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> le_measure</span><span class="id"> ?inE//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> measurableD;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> bigcup_measurable</span><span class="id"> =&gt;</span><span class="id"> k</span><span class="id"> _;</span><span class="id"> exact:</span><span class="id"> vitali_cover_mclosure</span><span class="id"> ABF</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> bigcup_measurable</span><span class="id"> =&gt;</span><span class="id"> k</span><span class="id"> _;</span><span class="id"> exact:</span><span class="id"> vitali_cover_mclosure</span><span class="id"> ABF</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> measureD//=;</span><span class="id"> last</span><span class="id"> 3</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> bigcup_measurable</span><span class="id"> =&gt;</span><span class="id"> k</span><span class="id"> _;</span><span class="id"> exact:</span><span class="id"> vitali_cover_mclosure</span><span class="id"> ABF</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> bigcup_measurable</span><span class="id"> =&gt;</span><span class="id"> k</span><span class="id"> _;</span><span class="id"> exact:</span><span class="id"> vitali_cover_mclosure</span><span class="id"> ABF</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -ge0_fin_numE</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> leeB//</span><span class="id"> le_measure</span><span class="id"> ?inE//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> measurableI;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> bigcup_measurable</span><span class="id"> =&gt;</span><span class="id"> k</span><span class="id"> _;</span><span class="id"> exact:</span><span class="id"> vitali_cover_mclosure</span><span class="id"> ABF</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> bigcup_measurable</span><span class="id"> =&gt;</span><span class="id"> k</span><span class="id"> _;</span><span class="id"> exact:</span><span class="id"> vitali_cover_mclosure</span><span class="id"> ABF</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span> (<span class="id">@le_lt_trans</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">normr</span> (<span class="id">0</span><span class="id"> -</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">fine</span> (<span class="id">\sum_</span>(<span class="id">n</span><span class="id"> &lt;=</span><span class="id"> k</span><span class="id"> &lt;oo</span><span class="id"> |</span><span class="id"> k</span><span class="id"> \in</span><span class="id"> G</span>)<span class="id"> mu</span> (<span class="id">closure</span> (<span class="id">B</span><span class="id"> k</span>)))))<span class="id">%:E</span>)<span class="id">;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> lte_fin;</span><span class="id"> apply:</span><span class="id"> nGe</span><span class="id"> =&gt;</span><span class="id"> /=</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> sub0r</span><span class="id"> normrN</span><span class="id"> ger0_norm/=;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> fine_ge0//</span><span class="id"> nneseries_ge0</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> fineK//;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">move:</span><span class="id"> muGfin;</span><span class="id"> rewrite</span><span class="id"> measure_bigcup//=;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> i</span><span class="id"> _;</span><span class="id"> exact:</span><span class="id"> vitali_cover_mclosure</span><span class="id"> ABF</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span><span class="id"> 2</span> (<span class="id">rewrite</span><span class="id"> ge0_fin_numE//;</span><span class="id"> last</span><span class="id"> exact:</span><span class="id"> nneseries_ge0</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> le_lt_trans</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> [leRHS]</span>(<span class="id">nneseries_split_cond</span><span class="id"> 0%N</span><span class="id"> n</span>)<span class="id">//</span><span class="id"> add0n</span><span class="id"> leeDr//</span><span class="id"> sume_ge0</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> measure_bigcup//=;</span><span class="id"> last</span><span class="id"> 2</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> i</span><span class="id"> _;</span><span class="id"> exact:</span><span class="id"> vitali_cover_mclosure</span><span class="id"> ABF</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> sub_trivIset</span><span class="id"> tB;</span><span class="id"> exact:</span><span class="id"> subDsetl</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> [in</span><span class="id"> leRHS]eseries_cond</span>.<br/>
&nbsp;&nbsp;<span class="id">suff:</span><span class="gallina-kwd"> forall</span><span class="id"> i,</span><span class="id"> i</span><span class="id"> \in</span><span class="id"> G</span><span class="id"> `\`</span><span class="id"> bigB</span><span class="id"> G</span><span class="id"> c%:num</span><span class="id"> -&gt;</span> (<span class="id">n</span><span class="id"> &lt;=</span><span class="id"> i</span>)<span class="id">%N</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> GG'n;</span><span class="id"> apply:</span><span class="id"> subset_lee_nneseries</span><span class="id"> =&gt;</span><span class="id"> //=</span><span class="id"> m</span><span class="id"> mGG'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> GG'n//</span><span class="id"> andbT;</span><span class="id"> case/set_mem:</span><span class="id"> mGG'</span><span class="id"> =&gt;</span><span class="id"> /mem_set</span><span class="id"> -&gt;</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> i</span><span class="id"> iGG';</span><span class="id"> rewrite</span><span class="id"> nc//</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move/set_mem:</span><span class="id"> iGG'</span><span class="id"> =&gt;</span><span class="id"> [Gi]</span><span class="id"> /not_andP[//|/negP];</span><span class="id"> rewrite</span><span class="id"> -ltNge</span>.<br/>
<span class="id">have</span><span class="id"> {}Hc</span><span class="id"> :</span><span class="id"> mu</span> (<span class="id">\bigcup_</span>(<span class="id">k</span><span class="gallina-kwd"> in</span><span class="id"> G</span>)<span class="id"> closure</span> (<span class="id">B</span><span class="id"> k</span>)<span class="id"> `\`</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">\bigcup_</span>(<span class="id">k</span><span class="gallina-kwd"> in</span><span class="id"> bigB</span><span class="id"> G</span><span class="id"> c%:num</span>)<span class="id"> closure</span> (<span class="id">B</span><span class="id"> k</span>))<span class="id"> &lt;</span><span class="id"> e%:E</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> measureD//=;</span><span class="id"> first</span><span class="id"> last</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> -ge0_fin_numE</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> bigcup_measurable</span><span class="id"> =&gt;</span><span class="id"> k</span><span class="id"> _;</span><span class="id"> exact:</span><span class="id"> vitali_cover_mclosure</span><span class="id"> ABF</span>.<br/>
&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> bigcup_measurable</span><span class="id"> =&gt;</span><span class="id"> k</span><span class="id"> _;</span><span class="id"> exact:</span><span class="id"> vitali_cover_mclosure</span><span class="id"> ABF</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> setIidr;</span><span class="id"> last</span><span class="id"> exact:</span><span class="id"> bigcup_subset</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> lteBlDr-?lteBlDl//;</span><span class="id"> exact:</span><span class="id"> muGSfin</span>.<br/>
<span class="id">have</span><span class="id"> bigBG_fin</span> (<span class="id">r</span><span class="id"> :</span><span class="id"> {posnum</span><span class="id"> R}</span>)<span class="id"> :</span><span class="id"> finite_set</span> (<span class="id">bigB</span><span class="id"> G</span><span class="id"> r%:num</span>).<br/>
&nbsp;&nbsp;<span class="id">pose</span><span class="id"> M</span><span class="id"> :=</span><span class="id"> `|ceil</span> (<span class="id">fine</span> (<span class="id">mu</span><span class="id"> O</span>)<span class="id"> /</span><span class="id"> r%:num</span>)<span class="id">|</span>.<span class="id">+1</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> contrapT</span><span class="id"> =&gt;</span><span class="id"> /infinite_set_fset</span><span class="id"> /=</span><span class="id"> /</span>(_<span class="id"> M</span>)<span class="id">[G0</span><span class="id"> G0G'r]</span><span class="id"> MG0</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> :</span><span class="id"> mu</span><span class="id"> O</span><span class="id"> &lt;</span><span class="id"> mu</span> (<span class="id">\bigcup_</span>(<span class="id">k</span><span class="gallina-kwd"> in</span><span class="id"> bigB</span><span class="id"> G</span><span class="id"> r%:num</span>)<span class="id"> closure</span> (<span class="id">B</span><span class="id"> k</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span> (<span class="id">@lt_le_trans</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">mu</span> (<span class="id">\bigcup_</span>(<span class="id">k</span><span class="gallina-kwd"> in</span><span class="id"> [set`</span><span class="id"> G0]</span>)<span class="id"> closure</span> (<span class="id">B</span><span class="id"> k</span>)))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> bigcup_fset</span><span class="id"> measure_fbigsetU//=;</span><span class="id"> last</span><span class="id"> 2</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> k</span><span class="id"> _;</span><span class="id"> exact:</span><span class="id"> vitali_cover_mclosure</span><span class="id"> ABF</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> sub_trivIset</span><span class="id"> tB</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> /G0G'r[]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span> (<span class="id">@lt_le_trans</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">\sum_</span>(<span class="id">i</span><span class="id"> &lt;-</span><span class="id"> G0</span>)<span class="id"> r%:num%:E</span>)<span class="id">%R</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> sumEFin</span><span class="id"> big_const_seq</span><span class="id"> iter_addr</span><span class="id"> addr0</span><span class="id"> -mulr_natr</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span> (<span class="id">@lt_le_trans</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">r%:num</span><span class="id"> *</span><span class="id"> M%:R</span>)<span class="id">%:E</span>)<span class="id">;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> lee_fin</span><span class="id"> ler_wpM2l//</span><span class="id"> ler_nat</span><span class="id"> count_predT</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> EFinM</span><span class="id"> -lte_pdivrMl//</span><span class="id"> muleC</span><span class="id"> -</span>(<span class="id">@fineK</span><span class="id"> _</span> (<span class="id">mu</span><span class="id"> O</span>))<span class="id">;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> ge0_fin_numE//;</span><span class="id"> case/andP:</span><span class="id"> OAoo</span><span class="id"> =&gt;</span><span class="id"> ?;</span><span class="id"> exact:</span><span class="id"> lt_trans</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -EFinM</span><span class="id"> /M</span><span class="id"> lte_fin</span> (<span class="id">le_lt_trans</span> (<span class="id">ceil_ge</span><span class="id"> _</span>))<span class="id">//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -natr1</span><span class="id"> natr_absz</span><span class="id"> ger0_norm</span><span class="id"> ?ltrDl//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -ceil_ge0//</span> (<span class="id">@lt_le_trans</span><span class="id"> _</span><span class="id"> _</span><span class="id"> 0%R</span>)<span class="id">//</span><span class="id"> divr_ge0//</span><span class="id"> fine_ge0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> big_seq</span><span class="id"> [in</span><span class="id"> leRHS]big_seq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> lee_sum</span><span class="id"> =&gt;</span><span class="id"> //=</span><span class="id"> i</span><span class="id"> /G0G'r</span><span class="id"> [iG</span><span class="id"> rBi]</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -[leRHS]fineK//;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> (<span class="id">vitali_cover_ballE</span><span class="id"> _</span><span class="id"> ABF</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> closure_ball</span><span class="id"> lebesgue_measure_closed_ball</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> (<span class="id">vitali_cover_ballE</span><span class="id"> _</span><span class="id"> ABF</span>)<span class="id"> closure_ball</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> lebesgue_measure_closed_ball//</span><span class="id"> fineK//</span><span class="id"> lee_fin</span><span class="id"> mulr2n</span><span class="id"> ler_wpDl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> le_measure?</span><span class="id"> inE//;</span><span class="id"> last</span><span class="id"> exact:</span><span class="id"> bigcup_subset</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> bigcup_measurable</span><span class="id"> =&gt;</span><span class="id"> k</span><span class="id"> _;</span><span class="id"> exact:</span><span class="id"> vitali_cover_mclosure</span><span class="id"> ABF</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> bigcup_measurable</span><span class="id"> =&gt;</span><span class="id"> k</span><span class="id"> _;</span><span class="id"> exact:</span><span class="id"> vitali_cover_mclosure</span><span class="id"> ABF</span>.<br/>
&nbsp;&nbsp;<span class="id">apply/negP;</span><span class="id"> rewrite</span><span class="id"> -leNgt</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span> (<span class="id">@le_trans</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">mu</span> (<span class="id">\bigcup_</span>(<span class="id">k</span><span class="gallina-kwd"> in</span><span class="id"> bigB</span><span class="id"> G</span><span class="id"> r%:num</span>)<span class="id"> B</span><span class="id"> k</span>))).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> measure_bigcup//;</span><span class="id"> last</span><span class="id"> 2</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> k</span><span class="id"> _;</span><span class="id"> exact:</span><span class="id"> vitali_cover_mclosure</span><span class="id"> ABF</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> sub_trivIset</span><span class="id"> tB</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> /=</span><span class="id"> measure_bigcup//;</span><span class="id"> last</span><span class="id"> 2</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> k</span><span class="id"> _;</span><span class="id"> exact:</span><span class="id"> vitali_cover_measurable</span><span class="id"> ABF</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply/trivIsetP</span><span class="id"> =&gt;</span><span class="id"> /=</span><span class="id"> i</span><span class="id"> j</span><span class="id"> [Gi</span><span class="id"> ri]</span><span class="id"> [Gj</span><span class="id"> rj]</span><span class="id"> ij</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">move/trivIsetP</span><span class="id"> :</span><span class="id"> tB</span><span class="id"> =&gt;</span><span class="id"> /</span>(_<span class="id"> _</span><span class="id"> _</span><span class="id"> Gi</span><span class="id"> Gj</span><span class="id"> ij</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> subsetI_eq0</span><span class="id"> =&gt;</span><span class="id"> //=;</span><span class="id"> exact:</span><span class="id"> subset_closure</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> /=</span><span class="id"> lee_nneseries//</span><span class="id"> =&gt;</span><span class="id"> n</span><span class="id"> _</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span> (<span class="id">vitali_cover_ballE</span><span class="id"> _</span><span class="id"> ABF</span>)<span class="id">//</span><span class="id"> closure_ball</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> lebesgue_measure_closed_ball//</span><span class="id"> lebesgue_measure_ball</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> le_measure?</span><span class="id"> inE//</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> bigcup_measurable</span><span class="id"> =&gt;</span><span class="id"> k</span><span class="id"> _;</span><span class="id"> exact:</span><span class="id"> vitali_cover_measurable</span><span class="id"> ABF</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="id"> exact:</span><span class="id"> open_measurable</span>.<br/>
&nbsp;&nbsp;<span class="id">+</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> bigcup_sub</span><span class="id"> =&gt;</span><span class="id"> i</span><span class="id"> [/GV'[?</span><span class="id"> ?]</span><span class="id"> cBi]</span>.<br/>
<span class="gallina-kwd">exists</span> (<span class="id">fset_set</span> (<span class="id">bigB</span><span class="id"> G</span><span class="id"> c%:num</span>))<span class="id">;</span><span class="id"> split</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> /=</span><span class="id"> k;</span><span class="id"> rewrite</span><span class="id"> in_fset_set//</span><span class="id"> inE</span><span class="id"> /bigB</span><span class="id"> /=</span><span class="id"> =&gt;</span><span class="id"> -[]</span><span class="id"> /GV'[]</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> sub_trivIset</span><span class="id"> tB</span><span class="id"> =&gt;</span><span class="id"> k/=;</span><span class="id"> rewrite</span><span class="id"> in_fset_set//</span><span class="id"> inE</span><span class="id"> /bigB</span><span class="id"> /=</span><span class="id"> =&gt;</span><span class="id"> -[]</span>.<br/>
<span class="id">-</span><span class="id"> pose</span><span class="id"> UG</span><span class="id"> :</span><span class="id"> set</span><span class="id"> R</span><span class="id"> :=</span><span class="id"> \bigcup_</span>(<span class="id">k</span><span class="gallina-kwd"> in</span><span class="id"> G</span>)<span class="id"> closure</span> (<span class="id">B</span><span class="id"> k</span>).<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> bigsetU_fset_set//</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span> (<span class="id">@le_lt_trans</span><span class="id"> _</span><span class="id"> _</span> ((<span class="id">wlength</span><span class="id"> idfun</span>)<span class="id">^*%mu</span> (<span class="id">A</span><span class="id"> `\`UG</span>)<span class="id"> +</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">mu</span> (<span class="id">UG</span><span class="id"> `\`</span><span class="id"> \bigcup_</span>(<span class="id">k</span><span class="gallina-kwd"> in</span><span class="id"> bigB</span><span class="id"> G</span><span class="id"> c%:num</span>)<span class="id"> closure</span> (<span class="id">B</span><span class="id"> k</span>))))<span class="id">;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -[</span>(<span class="id">wlength</span><span class="id"> idfun</span>)<span class="id">^*%mu]/mu</span><span class="id"> mAG0</span><span class="id"> add0e</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span> (<span class="id">@le_trans</span><span class="id"> _</span><span class="id"> _</span> ((<span class="id">wlength</span><span class="id"> idfun</span>)<span class="id">^*%mu</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">A</span><span class="id"> `&amp;`</span> (<span class="id">UG</span><span class="id"> `\`</span><span class="id"> \bigcup_</span>(<span class="id">k</span><span class="gallina-kwd"> in</span><span class="id"> bigB</span><span class="id"> G</span><span class="id"> c%:num</span>)<span class="id"> closure</span> (<span class="id">B</span><span class="id"> k</span>)))<span class="id"> +</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">wlength</span><span class="id"> idfun</span>)<span class="id">^*%mu</span> (<span class="id">A</span><span class="id"> `\`</span><span class="id"> UG</span>)))<span class="id">;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> addeC</span><span class="id"> leeD2l//</span><span class="id"> le_outer_measure</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span> (<span class="id">le_trans</span><span class="id"> _</span> (<span class="id">outer_measureU2</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span>))<span class="id"> =&gt;</span><span class="id"> //=;</span><span class="id"> apply:</span><span class="id"> le_outer_measure</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> !</span>(<span class="id">setDE</span><span class="id"> A</span>)<span class="id"> -setIUr;</span><span class="id"> apply:</span><span class="id"> setIS</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> setDE</span><span class="id"> setUIl</span><span class="id"> setUv</span><span class="id"> setTI</span><span class="id"> -setCI;</span><span class="id"> exact:</span><span class="id"> subsetC</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> vitali_theorem_corollary</span>.<br/>

      <div class="footer"><hr/>Generated by <a href="https://github.com/yoshihiro503/coq2html/">a fork of coq2html</a></div>
    </div>
  </div>
    </main>
</body>
</html>
