
<!DOCTYPE html>
<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Module mathcomp.analysis.derive</title>
<meta name="description" content="Documentation of Coq module mathcomp.analysis.derive" />
<link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.css">
<script src="https://cdn.jsdelivr.net/npm/markdown-it/dist/markdown-it.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/markdown-it-texmath/texmath.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/darkmode-js@1.5.7/lib/darkmode-js.min.js"></script>
<link href="coq2html.css" rel="stylesheet" type="text/css" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script type="text/javascript" src="coq2html.js"> </script>
</head>

<body onload="init()">

  <main>
    <div class="sidebar">
      <h2>Files</h2>
      
    </div>

  <div class="coq">

    <div class="content">
      <p><a href="./index.html">Top</a></p>
      <h1 class="title">Module mathcomp.analysis.derive</h1>
<span class="vernacular">From</span><span class="id"> HB</span><span class="vernacular"> Require</span><span class="vernacular"> Import</span><span class="id"> structures</span>.<br/>
<span class="vernacular">From</span><span class="id"> mathcomp</span><span class="vernacular"> Require</span><span class="vernacular"> Import</span><span class="id"> all_ssreflect</span><span class="id"> ssralg</span><span class="id"> ssrnum</span><span class="id"> matrix</span><span class="id"> interval</span>.<br/>
<span class="vernacular">From</span><span class="id"> mathcomp</span><span class="vernacular"> Require</span><span class="vernacular"> Import</span><span class="id"> mathcomp_extra</span><span class="id"> boolp</span><span class="id"> classical_sets</span><span class="id"> functions</span>.<br/>
<span class="vernacular">From</span><span class="id"> mathcomp</span><span class="vernacular"> Require</span><span class="vernacular"> Import</span><span class="id"> reals</span><span class="id"> signed</span><span class="id"> topology</span><span class="id"> prodnormedzmodule</span><span class="id"> tvs</span>.<br/>
<span class="vernacular">From</span><span class="id"> mathcomp</span><span class="vernacular"> Require</span><span class="vernacular"> Import</span><span class="id"> normedtype</span><span class="id"> landau</span><span class="id"> forms</span>.<br/>
<br/>
<div class="ssrdoc md">
# Differentiation

This file provides a theory of differentiation. It includes the standard
rules of differentiation (differential of a sum, of a product, of
exponentiation, of the inverse, etc.) as well as standard theorems (the
Extreme Value Theorem, Rolle's theorem, the Mean Value Theorem).

Parsable notations (in all of the following, f is not supposed to be
differentiable):
```
              'd f x == the differential of a function f at a point x
  differentiable f x == the function f is differentiable at a point x
              'J f x == the Jacobian of f at a point x
              'D_v f == the directional derivative of f along v
     derivable f a v == the function f is derivable at a with direction v
                        The type of f is V -&gt; W with V W : normedModType R
                        and R : numFieldType
              f^`()  == the derivative of f of domain R
              f^`(n) == the nth derivative of f of domain R
```

Naming convention in this file:
- lemmas of the form `... -&gt; derivable f x v` are named `derivable*`
  (e.g., `derivableV`, `derivableM`)
  or `*derivable` (e.g., `diff_derivable`)
- lemmas of the form `D_v f x = ...` are named `derive*`
  (e.g., `deriveVP, `deriveM`)
- lemmas of the form `f^`() x = ...` are named `derive1*`
  (e.g., `derive1_cst`, `derive1_comp`)
- lemmas of the form `... -&gt; is_derive x v f df` are named `is_derive*`
  (e.g., `is_derive_cst`)

</div>
<br/>
<span class="gallina-kwd">Set</span><span class="vernacular"> Implicit</span><span class="vernacular"> Arguments</span>.<br/>
<span class="vernacular">Unset</span><span class="vernacular"> Strict</span><span class="vernacular"> Implicit</span>.<br/>
<span class="vernacular">Unset</span><span class="vernacular"> Printing</span><span class="vernacular"> Implicit</span><span class="vernacular"> Defensive</span>.<br/>
<span class="vernacular">Import</span><span class="id"> Order</span>.<span class="id">TTheory</span><span class="id"> GRing</span>.<span class="id">Theory</span><span class="id"> Num</span>.<span class="id">Theory</span>.<br/>
<span class="vernacular">Import</span><span class="id"> numFieldNormedType</span>.<span class="vernacular">Exports</span>.<br/>
<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ring_scope</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> classical_set_scope</span>.<br/>
<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;''d' f x&quot;</span> (<span class="gallina-kwd">at</span><span class="id"> level</span><span class="id"> 0,</span><span class="id"> f</span><span class="gallina-kwd"> at</span><span class="id"> level</span><span class="id"> 0,</span><span class="id"> x</span><span class="gallina-kwd"> at</span><span class="id"> level</span><span class="id"> 0,</span><br/>
&nbsp;&nbsp;<span class="id">format</span> <span class="id">&quot;''d'  f  x&quot;</span>).<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;'is_diff' F&quot;</span> (<span class="gallina-kwd">at</span><span class="id"> level</span><span class="id"> 0,</span><span class="id"> F</span><span class="gallina-kwd"> at</span><span class="id"> level</span><span class="id"> 0,</span><br/>
&nbsp;&nbsp;<span class="id">format</span> <span class="id">&quot;'is_diff'  F&quot;</span>).<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;''J' f p&quot;</span> (<span class="gallina-kwd">at</span><span class="id"> level</span><span class="id"> 10,</span><span class="id"> p,</span><span class="id"> f</span><span class="gallina-kwd"> at</span><span class="id"> next</span><span class="id"> level,</span><br/>
&nbsp;&nbsp;<span class="id">format</span> <span class="id">&quot;''J'  f  p&quot;</span>).<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;''D_' v f&quot;</span> (<span class="gallina-kwd">at</span><span class="id"> level</span><span class="id"> 10,</span><span class="id"> v,</span><span class="id"> f</span><span class="gallina-kwd"> at</span><span class="id"> next</span><span class="id"> level,</span><br/>
&nbsp;&nbsp;<span class="id">format</span> <span class="id">&quot;''D_' v  f&quot;</span>).<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;''D_' v f c&quot;</span> (<span class="gallina-kwd">at</span><span class="id"> level</span><span class="id"> 10,</span><span class="id"> v,</span><span class="id"> f</span><span class="gallina-kwd"> at</span><span class="id"> next</span><span class="id"> level,</span><br/>
&nbsp;&nbsp;<span class="id">format</span> <span class="id">&quot;''D_' v  f  c&quot;</span>). <br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;f ^` ()&quot;</span> (<span class="gallina-kwd">at</span><span class="id"> level</span><span class="id"> 8,</span><span class="id"> format</span> <span class="id">&quot;f ^` ()&quot;</span>).<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;f ^` ( n )&quot;</span> (<span class="gallina-kwd">at</span><span class="id"> level</span><span class="id"> 8,</span><span class="id"> format</span> <span class="id">&quot;f ^` ( n )&quot;</span>).<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> Differential</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {K</span><span class="id"> :</span><span class="id"> numDomainType}</span><span class="id"> {V</span><span class="id"> W</span><span class="id"> :</span><span class="id"> normedModType</span><span class="id"> K}</span>.<br/>
<br/>
<span class="vernacular">Definition</span><span class="id"> diff</span> (<span class="id">F</span><span class="id"> :</span><span class="id"> filter_on</span><span class="id"> V</span>) (_<span class="id"> :</span><span class="id"> phantom</span> (<span class="id">set</span> (<span class="id">set</span><span class="id"> V</span>))<span class="id"> F</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> V</span><span class="id"> -&gt;</span><span class="id"> W</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;(<span class="id">get</span> (<span class="gallina-kwd">fun</span> (<span class="id">df</span><span class="id"> :</span><span class="id"> {linear</span><span class="id"> V</span><span class="id"> -&gt;</span><span class="id"> W}</span>)<span class="id"> =&gt;</span><span class="id"> continuous</span><span class="id"> df</span><span class="id"> /\</span><span class="gallina-kwd"> forall</span><span class="id"> x,</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">f</span><span class="id"> x</span><span class="id"> =</span><span class="id"> f</span> (<span class="id">lim</span><span class="id"> F</span>)<span class="id"> +</span><span class="id"> df</span> (<span class="id">x</span><span class="id"> -</span><span class="id"> lim</span><span class="id"> F</span>)<span class="id"> +o_</span>(<span class="id">x</span><span class="id"> \near</span><span class="id"> F</span>) (<span class="id">x</span><span class="id"> -</span><span class="id"> lim</span><span class="id"> F</span>))).<br/>
<br/>
<span class="vernacular">Local</span><span class="vernacular"> Notation</span> <span class="id">&quot;''d' f x&quot;</span><span class="id"> :=</span> (<span class="id">@diff</span><span class="id"> _</span> (<span class="id">Phantom</span><span class="id"> _</span> (<span class="id">nbhs</span><span class="id"> x</span>))<span class="id"> f</span>).<br/>
<br/>
<span class="vernacular">Fact</span><span class="id"> diff_key</span><span class="id"> :</span><span class="gallina-kwd"> forall</span><span class="id"> T,</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> unit</span><br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> constructor</span>. Qed.</div></details>
<span class="vernacular">CoInductive</span><span class="id"> differentiable_def</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> V</span><span class="id"> -&gt;</span><span class="id"> W</span>) (<span class="id">x</span><span class="id"> :</span><span class="id"> filter_on</span><span class="id"> V</span>)<br/>
&nbsp;&nbsp;(<span class="id">phF</span><span class="id"> :</span><span class="id"> phantom</span> (<span class="id">set</span> (<span class="id">set</span><span class="id"> V</span>))<span class="id"> x</span>)<span class="id"> :</span><span class="gallina-kwd"> Prop</span><span class="id"> :=</span><span class="id"> DifferentiableDef</span><span class="id"> of</span><br/>
&nbsp;&nbsp;(<span class="id">continuous</span> (<span class="id">'d</span><span class="id"> f</span><span class="id"> x</span>)<span class="id"> /\</span><br/>
&nbsp;&nbsp;<span class="id">f</span><span class="id"> =</span><span class="id"> cst</span> (<span class="id">f</span> (<span class="id">lim</span><span class="id"> x</span>))<span class="id"> +</span><span class="id"> 'd</span><span class="id"> f</span><span class="id"> x</span><span class="id"> \o</span><span class="id"> center</span> (<span class="id">lim</span><span class="id"> x</span>)<span class="id"> +o_x</span> (<span class="id">center</span> (<span class="id">lim</span><span class="id"> x</span>))).<br/>
<br/>
<span class="vernacular">Local</span><span class="vernacular"> Notation</span><span class="id"> differentiable</span><span class="id"> f</span><span class="id"> F</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;(<span class="id">@differentiable_def</span><span class="id"> f</span><span class="id"> _</span> (<span class="id">Phantom</span><span class="id"> _</span> (<span class="id">nbhs</span><span class="id"> F</span>))).<br/>
<br/>
<span class="vernacular">Class</span><span class="id"> is_diff_def</span> (<span class="id">x</span><span class="id"> :</span><span class="id"> filter_on</span><span class="id"> V</span>) (<span class="id">Fph</span><span class="id"> :</span><span class="id"> phantom</span> (<span class="id">set</span> (<span class="id">set</span><span class="id"> V</span>))<span class="id"> x</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> V</span><span class="id"> -&gt;</span><span class="id"> W</span>)<br/>
&nbsp;&nbsp;(<span class="id">df</span><span class="id"> :</span><span class="id"> V</span><span class="id"> -&gt;</span><span class="id"> W</span>)<span class="id"> :=</span><span class="id"> DiffDef</span><span class="id"> {</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">ex_diff</span><span class="id"> :</span><span class="id"> differentiable</span><span class="id"> f</span><span class="id"> x</span><span class="id"> ;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">diff_val</span><span class="id"> :</span><span class="id"> 'd</span><span class="id"> f</span><span class="id"> x</span><span class="id"> =</span><span class="id"> df</span><span class="id"> :&gt;</span> (<span class="id">V</span><span class="id"> -&gt;</span><span class="id"> W</span>)<br/>
&nbsp;&nbsp;<span class="id">}</span>.<br/>
<span class="vernacular">Hint</span><span class="id"> Mode</span><span class="id"> is_diff_def</span><span class="id"> -</span><span class="id"> -</span><span class="id"> !</span><span class="id"> -</span><span class="id"> :</span><span class="id"> typeclass_instances</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> diffP</span> (<span class="id">F</span><span class="id"> :</span><span class="id"> filter_on</span><span class="id"> V</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> V</span><span class="id"> -&gt;</span><span class="id"> W</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">differentiable</span><span class="id"> f</span><span class="id"> F</span><span class="id"> &lt;-&gt;</span><br/>
&nbsp;&nbsp;<span class="id">continuous</span> (<span class="id">'d</span><span class="id"> f</span><span class="id"> F</span>)<span class="id"> /\</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">forall</span><span class="id"> x,</span><span class="id"> f</span><span class="id"> x</span><span class="id"> =</span><span class="id"> f</span> (<span class="id">lim</span><span class="id"> F</span>)<span class="id"> +</span><span class="id"> 'd</span><span class="id"> f</span><span class="id"> F</span> (<span class="id">x</span><span class="id"> -</span><span class="id"> lim</span><span class="id"> F</span>)<span class="id"> +o_</span>(<span class="id">x</span><span class="id"> \near</span><span class="id"> F</span>) (<span class="id">x</span><span class="id"> -</span><span class="id"> lim</span><span class="id"> F</span>)).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> split=&gt;</span><span class="id"> [[]</span><span class="id"> |];</span><span class="id"> last</span><span class="id"> constructor;</span><span class="id"> rewrite</span><span class="id"> funeqE</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> diff_continuous</span> (<span class="id">x</span><span class="id"> :</span><span class="id"> filter_on</span><span class="id"> V</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> V</span><span class="id"> -&gt;</span><span class="id"> W</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">differentiable</span><span class="id"> f</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> continuous</span> (<span class="id">'d</span><span class="id"> f</span><span class="id"> x</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> /diffP</span><span class="id"> []</span>. Qed.</div></details>
<span class="vernacular">Hint</span><span class="id"> Extern</span><span class="id"> 0</span> (<span class="id">continuous</span><span class="id"> _</span>)<span class="id"> =&gt;</span><span class="id"> exact:</span><span class="id"> diff_continuous</span><span class="id"> :</span><span class="id"> core</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> diffE</span> (<span class="id">F</span><span class="id"> :</span><span class="id"> filter_on</span><span class="id"> V</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> V</span><span class="id"> -&gt;</span><span class="id"> W</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">differentiable</span><span class="id"> f</span><span class="id"> F</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">forall</span><span class="id"> x,</span><span class="id"> f</span><span class="id"> x</span><span class="id"> =</span><span class="id"> f</span> (<span class="id">lim</span><span class="id"> F</span>)<span class="id"> +</span><span class="id"> 'd</span><span class="id"> f</span><span class="id"> F</span> (<span class="id">x</span><span class="id"> -</span><span class="id"> lim</span><span class="id"> F</span>)<span class="id"> +o_</span>(<span class="id">x</span><span class="id"> \near</span><span class="id"> F</span>) (<span class="id">x</span><span class="id"> -</span><span class="id"> lim</span><span class="id"> F</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> /diffP</span><span class="id"> []</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> littleo_center0</span> (<span class="id">x</span><span class="id"> :</span><span class="id"> V</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> V</span><span class="id"> -&gt;</span><span class="id"> W</span>) (<span class="id">e</span><span class="id"> :</span><span class="id"> V</span><span class="id"> -&gt;</span><span class="id"> V</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">[o_x</span><span class="id"> e</span><span class="id"> of</span><span class="id"> f]</span><span class="id"> =</span><span class="id"> [o_</span><span class="id"> 0</span> (<span class="id">e</span><span class="id"> \o</span><span class="id"> shift</span><span class="id"> x</span>)<span class="id"> of</span><span class="id"> f</span><span class="id"> \o</span><span class="id"> shift</span><span class="id"> x]</span><span class="id"> \o</span><span class="id"> center</span><span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> /the_littleo</span><span class="id"> /insubd</span><span class="id"> /=;</span><span class="id"> have</span><span class="id"> [g</span><span class="id"> /=</span><span class="id"> _</span><span class="id"> &lt;-{f}|/asboolP</span><span class="id"> Nfe]</span><span class="id"> /=</span><span class="id"> :=</span><span class="id"> insubP</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> insubT</span><span class="id"> //=</span><span class="id"> ?comp_shiftK</span><span class="id"> //;</span><span class="id"> apply/asboolP</span><span class="id"> =&gt;</span><span class="id"> _/posnumP[eps]</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> [\forall</span><span class="id"> x</span><span class="id"> \near</span><span class="id"> _,</span><span class="id"> _</span><span class="id"> &lt;=</span><span class="id"> _]</span>(<span class="id">near_shift</span><span class="id"> x</span>)<span class="id"> sub0r;</span><span class="id"> near=&gt;</span><span class="id"> y</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /=</span><span class="id"> subrK;</span><span class="id"> near:</span><span class="id"> y;</span><span class="id"> have</span><span class="id"> /eqoP</span><span class="id"> :=</span><span class="id"> littleo_eqo</span><span class="id"> g;</span><span class="id"> apply</span>.<br/>
<span class="id">rewrite</span><span class="id"> insubF</span><span class="id"> //;</span><span class="id"> apply/asboolP</span><span class="id"> =&gt;</span><span class="id"> fe;</span><span class="id"> apply:</span><span class="id"> Nfe</span><span class="id"> =&gt;</span><span class="id"> _/posnumP[eps]</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> [\forall</span><span class="id"> x</span><span class="id"> \near</span><span class="id"> _,</span><span class="id"> _</span><span class="id"> &lt;=</span><span class="id"> _]</span>(<span class="id">near_shift</span><span class="id"> 0</span>)<span class="id"> subr0;</span><span class="id"> apply:</span><span class="id"> fe</span>.<br/>
<span class="id">Unshelve</span>.<span class="id"> all:</span><span class="gallina-kwd"> by</span><span class="id"> end_near</span>. Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> Differential</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> Differential_numFieldType</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {K</span><span class="id"> :</span><span class="id"> numFieldType</span> <span class="id">}</span><span class="id"> {V</span><span class="id"> W</span><span class="id"> :</span><span class="id"> normedModType</span><span class="id"> K}</span>.<br/>
<br/>
<span class="vernacular">Local</span><span class="vernacular"> Notation</span><span class="id"> differentiable</span><span class="id"> f</span><span class="id"> F</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;(<span class="id">@differentiable_def</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> f</span><span class="id"> _</span> (<span class="id">Phantom</span><span class="id"> _</span> (<span class="id">nbhs</span><span class="id"> F</span>))).<br/>
<span class="vernacular">Local</span><span class="vernacular"> Notation</span> <span class="id">&quot;''d' f x&quot;</span><span class="id"> :=</span> (<span class="id">@diff</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">Phantom</span><span class="id"> _</span> (<span class="id">nbhs</span><span class="id"> x</span>))<span class="id"> f</span>).<br/>
<span class="vernacular">Hint</span><span class="id"> Extern</span><span class="id"> 0</span> (<span class="id">continuous</span><span class="id"> _</span>)<span class="id"> =&gt;</span><span class="id"> exact:</span><span class="id"> diff_continuous</span><span class="id"> :</span><span class="id"> core</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> diff_locallyxP</span> (<span class="id">x</span><span class="id"> :</span><span class="id"> V</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> V</span><span class="id"> -&gt;</span><span class="id"> W</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">differentiable</span><span class="id"> f</span><span class="id"> x</span><span class="id"> &lt;-&gt;</span><span class="id"> continuous</span> (<span class="id">'d</span><span class="id"> f</span><span class="id"> x</span>)<span class="id"> /\</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">forall</span><span class="id"> h,</span><span class="id"> f</span> (<span class="id">h</span><span class="id"> +</span><span class="id"> x</span>)<span class="id"> =</span><span class="id"> f</span><span class="id"> x</span><span class="id"> +</span><span class="id"> 'd</span><span class="id"> f</span><span class="id"> x</span><span class="id"> h</span><span class="id"> +o_</span>(<span class="id">h</span><span class="id"> \near</span><span class="id"> 0</span>)<span class="id"> h</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">split=&gt;</span><span class="id"> [dxf|[dfc</span><span class="id"> dxf]]</span>.<br/>
&nbsp;&nbsp;<span class="id">split</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> apply:</span><span class="id"> eqaddoEx</span><span class="id"> =&gt;</span><span class="id"> h;</span><span class="id"> have</span><span class="id"> /diffE</span><span class="id"> -&gt;</span><span class="id"> :=</span><span class="id"> dxf</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> lim_id</span><span class="id"> //</span><span class="id"> addrK;</span><span class="id"> congr</span> (_<span class="id"> +</span><span class="id"> _</span>)<span class="id">;</span><span class="id"> rewrite</span><span class="id"> littleo_center0</span><span class="id"> /=</span><span class="id"> addrK</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> congr</span> (<span class="id">'o</span>)<span class="id">;</span><span class="id"> rewrite</span><span class="id"> funeqE</span><span class="id"> =&gt;</span><span class="id"> k</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> addrK</span>.<br/>
<span class="id">apply/diffP;</span><span class="id"> split=&gt;</span><span class="id"> //;</span><span class="id"> apply:</span><span class="id"> eqaddoEx;</span><span class="id"> move=&gt;</span><span class="id"> y</span>.<br/>
<span class="id">rewrite</span><span class="id"> lim_id</span><span class="id"> //</span><span class="id"> -[in</span><span class="id"> LHS]</span>(<span class="id">subrK</span><span class="id"> x</span><span class="id"> y</span>)<span class="id"> dxf;</span><span class="id"> congr</span> (_<span class="id"> +</span><span class="id"> _</span>).<br/>
<span class="id">rewrite</span><span class="id"> -</span>(<span class="id">comp_centerK</span><span class="id"> x</span><span class="id"> id</span>)<span class="id"> -[X</span><span class="gallina-kwd"> in</span><span class="id"> the_littleo</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> X]</span>(<span class="id">comp_centerK</span><span class="id"> x</span>).<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -[_</span> (<span class="id">y</span><span class="id"> -</span><span class="id"> x</span>)<span class="id">]/</span>((_<span class="id"> \o</span> (<span class="id">center</span><span class="id"> x</span>))<span class="id"> y</span>)<span class="id"> -littleo_center0</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> diff_locallyx</span> (<span class="id">x</span><span class="id"> :</span><span class="id"> V</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> V</span><span class="id"> -&gt;</span><span class="id"> W</span>)<span class="id"> :</span><span class="id"> differentiable</span><span class="id"> f</span><span class="id"> x</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">forall</span><span class="id"> h,</span><span class="id"> f</span> (<span class="id">h</span><span class="id"> +</span><span class="id"> x</span>)<span class="id"> =</span><span class="id"> f</span><span class="id"> x</span><span class="id"> +</span><span class="id"> 'd</span><span class="id"> f</span><span class="id"> x</span><span class="id"> h</span><span class="id"> +o_</span>(<span class="id">h</span><span class="id"> \near</span><span class="id"> 0</span>)<span class="id"> h</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> /diff_locallyxP</span><span class="id"> []</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> diff_locallyxC</span> (<span class="id">x</span><span class="id"> :</span><span class="id"> V</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> V</span><span class="id"> -&gt;</span><span class="id"> W</span>)<span class="id"> :</span><span class="id"> differentiable</span><span class="id"> f</span><span class="id"> x</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">forall</span><span class="id"> h,</span><span class="id"> f</span> (<span class="id">x</span><span class="id"> +</span><span class="id"> h</span>)<span class="id"> =</span><span class="id"> f</span><span class="id"> x</span><span class="id"> +</span><span class="id"> 'd</span><span class="id"> f</span><span class="id"> x</span><span class="id"> h</span><span class="id"> +o_</span>(<span class="id">h</span><span class="id"> \near</span><span class="id"> 0</span>)<span class="id"> h</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> ?;</span><span class="id"> apply/eqaddoEx</span><span class="id"> =&gt;</span><span class="id"> h;</span><span class="id"> rewrite</span><span class="id"> [x</span><span class="id"> +</span><span class="id"> h]addrC</span><span class="id"> diff_locallyx</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> diff_locallyP</span> (<span class="id">x</span><span class="id"> :</span><span class="id"> V</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> V</span><span class="id"> -&gt;</span><span class="id"> W</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">differentiable</span><span class="id"> f</span><span class="id"> x</span><span class="id"> &lt;-&gt;</span><br/>
&nbsp;&nbsp;<span class="id">continuous</span> (<span class="id">'d</span><span class="id"> f</span><span class="id"> x</span>)<span class="id"> /\</span> (<span class="id">f</span><span class="id"> \o</span><span class="id"> shift</span><span class="id"> x</span><span class="id"> =</span><span class="id"> cst</span> (<span class="id">f</span><span class="id"> x</span>)<span class="id"> +</span><span class="id"> 'd</span><span class="id"> f</span><span class="id"> x</span><span class="id"> +o_</span><span class="id"> 0</span><span class="id"> id</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> iff_trans</span> (<span class="id">diff_locallyxP</span><span class="id"> _</span><span class="id"> _</span>)<span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> funeqE</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> diff_locally</span> (<span class="id">x</span><span class="id"> :</span><span class="id"> V</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> V</span><span class="id"> -&gt;</span><span class="id"> W</span>)<span class="id"> :</span><span class="id"> differentiable</span><span class="id"> f</span><span class="id"> x</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;(<span class="id">f</span><span class="id"> \o</span><span class="id"> shift</span><span class="id"> x</span><span class="id"> =</span><span class="id"> cst</span> (<span class="id">f</span><span class="id"> x</span>)<span class="id"> +</span><span class="id"> 'd</span><span class="id"> f</span><span class="id"> x</span><span class="id"> +o_</span><span class="id"> 0</span><span class="id"> id</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> /diff_locallyP</span><span class="id"> []</span>. Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> Differential_numFieldType</span>.<br/>
<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;''d' f F&quot;</span><span class="id"> :=</span> (<span class="id">@diff</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">Phantom</span><span class="id"> _</span> (<span class="id">nbhs</span><span class="id"> F</span>))<span class="id"> f</span>).<br/>
<span class="vernacular">Notation</span><span class="id"> differentiable</span><span class="id"> f</span><span class="id"> F</span><span class="id"> :=</span> (<span class="id">@differentiable_def</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> f</span><span class="id"> _</span> (<span class="id">Phantom</span><span class="id"> _</span> (<span class="id">nbhs</span><span class="id"> F</span>))).<br/>
<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;'is_diff' F&quot;</span><span class="id"> :=</span> (<span class="id">is_diff_def</span> (<span class="id">Phantom</span><span class="id"> _</span> (<span class="id">nbhs</span><span class="id"> F</span>))).<br/>
<span class="id">#[global]</span><span class="vernacular"> Hint</span><span class="id"> Extern</span><span class="id"> 0</span> (<span class="id">differentiable</span><span class="id"> _</span><span class="id"> _</span>)<span class="id"> =&gt;</span><span class="id"> solve[apply:</span><span class="id"> ex_diff]</span><span class="id"> :</span><span class="id"> core</span>.<br/>
<span class="id">#[global]</span><span class="vernacular"> Hint</span><span class="id"> Extern</span><span class="id"> 0</span> (<span class="id">{for</span><span class="id"> _,</span><span class="id"> continuous</span><span class="id"> _}</span>)<span class="id"> =&gt;</span><span class="id"> exact:</span><span class="id"> diff_continuous</span><span class="id"> :</span><span class="id"> core</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> differentiableP</span> (<span class="id">R</span><span class="id"> :</span><span class="id"> numDomainType</span>) (<span class="id">V</span><span class="id"> W</span><span class="id"> :</span><span class="id"> normedModType</span><span class="id"> R</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> V</span><span class="id"> -&gt;</span><span class="id"> W</span>)<span class="id"> x</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">differentiable</span><span class="id"> f</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> is_diff</span><span class="id"> x</span><span class="id"> f</span> (<span class="id">'d</span><span class="id"> f</span><span class="id"> x</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> ?;</span><span class="id"> apply:</span><span class="id"> DiffDef</span>. Qed.</div></details>
<br/>
<span class="vernacular">Section</span><span class="id"> jacobian</span>.<br/>
<br/>
<span class="vernacular">Definition</span><span class="id"> jacobian</span><span class="id"> n</span><span class="id"> m</span> (<span class="id">R</span><span class="id"> :</span><span class="id"> numFieldType</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> 'rV[R]_n</span>.<span class="id">+1</span><span class="id"> -&gt;</span><span class="id"> 'rV[R]_m</span>.<span class="id">+1</span>)<span class="id"> p</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">lin1_mx</span> (<span class="id">'d</span><span class="id"> f</span><span class="id"> p</span>).<br/>
<br/>
<span class="vernacular">End</span><span class="id"> jacobian</span>.<br/>
<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;''J' f p&quot;</span><span class="id"> :=</span> (<span class="id">jacobian</span><span class="id"> f</span><span class="id"> p</span>).<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> DifferentialR</span>.<br/>
<br/>
<span class="vernacular">Context</span><span class="id"> {R</span><span class="id"> :</span><span class="id"> numFieldType}</span><span class="id"> {V</span><span class="id"> W</span><span class="id"> :</span><span class="id"> normedModType</span><span class="id"> R}</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> differentiable_continuous</span> (<span class="id">x</span><span class="id"> :</span><span class="id"> V</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> V</span><span class="id"> -&gt;</span><span class="id"> W</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">differentiable</span><span class="id"> f</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> {for</span><span class="id"> x,</span><span class="id"> continuous</span><span class="id"> f}</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> /diff_locallyP</span><span class="id"> [dfc];</span><span class="id"> rewrite</span><span class="id"> -addrA</span>.<br/>
<span class="id">rewrite</span> (<span class="id">littleo_bigO_eqo</span> (<span class="id">cst</span> (<span class="id">1</span><span class="id"> :</span><span class="id"> R</span>)))<span class="id">;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply/eqOP;</span><span class="id"> near=&gt;</span><span class="id"> k;</span><span class="id"> rewrite</span><span class="id"> /cst</span><span class="id"> [`|1|]normr1</span><span class="id"> mulr1;</span><span class="id"> near</span><span class="id"> do</span><span class="gallina-kwd"> by</span><span class="id"> []</span>.<br/>
<span class="id">rewrite</span><span class="id"> addfo;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> /eqolim;</span><span class="id"> rewrite</span><span class="id"> cvg_comp_shift</span><span class="id"> add0r</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply/eqolim0P;</span><span class="id"> apply:</span> (<span class="id">cvg_trans</span> (<span class="id">dfc</span><span class="id"> 0</span>))<span class="id">;</span><span class="id"> rewrite</span><span class="id"> linear0</span>.<br/>
<span class="id">Unshelve</span>.<span class="id"> all:</span><span class="gallina-kwd"> by</span><span class="id"> end_near</span>. Qed.</div></details>
<br/>
<span class="vernacular">Section</span><span class="id"> littleo_lemmas</span>.<br/>
<span class="vernacular">Variables</span> (<span class="id">X</span><span class="id"> Y</span><span class="id"> Z</span><span class="id"> :</span><span class="id"> normedModType</span><span class="id"> R</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> normm_littleo</span><span class="id"> x</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> X</span><span class="id"> -&gt;</span><span class="id"> Y</span>)<span class="id"> :</span><span class="id"> `|</span><span class="id"> [o_</span>(<span class="id">x</span><span class="id"> \near</span><span class="id"> x</span>) (<span class="id">1</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> of</span><span class="id"> f</span><span class="id"> x]|</span><span class="id"> =</span><span class="id"> 0</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> /cst</span><span class="id"> /=;</span><span class="id"> have</span><span class="id"> [e</span><span class="id"> /</span>(_ (<span class="id">`|e</span><span class="id"> x|/2</span>)<span class="id"> _</span>)<span class="id">/nbhs_singleton</span><span class="id"> /=]</span><span class="id"> :=</span><span class="id"> littleo</span>.<br/>
<span class="id">rewrite</span><span class="id"> pmulr_lgt0</span><span class="id"> //</span><span class="id"> [`|1|]normr1</span><span class="id"> mulr1</span><span class="id"> [leLHS]splitr</span><span class="id"> gerDr</span><span class="id"> pmulr_lle0</span><span class="id"> //</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> /implyP;</span><span class="id"> case</span><span class="id"> :</span><span class="id"> real_ltgtP;</span><span class="id"> rewrite</span><span class="id"> ?realE</span><span class="id"> ?normrE</span><span class="id"> //=</span><span class="id"> lexx</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> littleo_lim0</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> X</span><span class="id"> -&gt;</span><span class="id"> Y</span>) (<span class="id">h</span><span class="id"> :</span><span class="id"> _</span><span class="id"> -&gt;</span><span class="id"> Z</span>) (<span class="id">x</span><span class="id"> :</span><span class="id"> X</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">f</span><span class="id"> @</span><span class="id"> x</span><span class="id"> --&gt;</span><span class="id"> 0</span><span class="id"> -&gt;</span><span class="id"> [o_x</span><span class="id"> f</span><span class="id"> of</span><span class="id"> h]</span><span class="id"> x</span><span class="id"> =</span><span class="id"> 0</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move/eqolim0P</span><span class="id"> =&gt;</span><span class="id"> -&gt;;</span><span class="id"> have</span><span class="id"> [k</span><span class="id"> /</span>(_<span class="id"> _</span><span class="id"> [gt0</span><span class="id"> of</span><span class="id"> 1</span><span class="id"> :</span><span class="id"> R]</span>)<span class="id">/=]</span><span class="id"> :=</span><span class="id"> littleo</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> /nbhs_singleton;</span><span class="id"> rewrite</span><span class="id"> mul1r</span><span class="id"> normm_littleo</span><span class="id"> normr_le0</span><span class="id"> =&gt;</span><span class="id"> /eqP</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> littleo_lemmas</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> diff_locally_converse_tentative</span>.<br/>
<span class="vernacular">Lemma</span><span class="id"> diff_locally_converse_part1</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> R</span>) (<span class="id">a</span><span class="id"> b</span><span class="id"> x</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">f</span><span class="id"> \o</span><span class="id"> shift</span><span class="id"> x</span><span class="id"> =</span><span class="id"> cst</span><span class="id"> a</span><span class="id"> +</span><span class="id"> b</span><span class="id"> *:</span><span class="id"> idfun</span><span class="id"> +o_</span><span class="id"> 0</span><span class="id"> id</span><span class="id"> -&gt;</span><span class="id"> f</span><span class="id"> x</span><span class="id"> =</span><span class="id"> a</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> funeqE</span><span class="id"> =&gt;</span><span class="id"> /</span>(_<span class="id"> 0</span>)<span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> add0r</span><span class="id"> =&gt;</span><span class="id"> -&gt;</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -[LHS]/</span>(_<span class="id"> 0</span><span class="id"> +</span><span class="id"> _</span><span class="id"> 0</span><span class="id"> +</span><span class="id"> _</span><span class="id"> 0</span>)<span class="id"> /cst</span><span class="id"> [X</span><span class="gallina-kwd"> in</span><span class="id"> a</span><span class="id"> +</span><span class="id"> X]scaler0</span><span class="id"> littleo_lim0</span><span class="id"> ?addr0</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> diff_locally_converse_tentative</span>.<br/>
<br/>
<span class="vernacular">Definition</span><span class="id"> derive</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> V</span><span class="id"> -&gt;</span><span class="id"> W</span>)<span class="id"> a</span><span class="id"> v</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">lim</span> ((<span class="gallina-kwd">fun</span><span class="id"> h</span><span class="id"> =&gt;</span><span class="id"> h^-1</span><span class="id"> *:</span> ((<span class="id">f</span><span class="id"> \o</span><span class="id"> shift</span><span class="id"> a</span>) (<span class="id">h</span><span class="id"> *:</span><span class="id"> v</span>)<span class="id"> -</span><span class="id"> f</span><span class="id"> a</span>))<span class="id"> @</span><span class="id"> 0^'</span>).<br/>
<br/>
<span class="vernacular">Local</span><span class="vernacular"> Notation</span> <span class="id">&quot;''D_' v f&quot;</span><span class="id"> :=</span> (<span class="id">derive</span><span class="id"> f</span><span class="id"> ^~</span><span class="id"> v</span>).<br/>
<span class="vernacular">Local</span><span class="vernacular"> Notation</span> <span class="id">&quot;''D_' v f c&quot;</span><span class="id"> :=</span> (<span class="id">derive</span><span class="id"> f</span><span class="id"> c</span><span class="id"> v</span>). <br/>
<br/>
<span class="vernacular">Definition</span><span class="id"> derivable</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> V</span><span class="id"> -&gt;</span><span class="id"> W</span>)<span class="id"> a</span><span class="id"> v</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">cvg</span> ((<span class="gallina-kwd">fun</span><span class="id"> h</span><span class="id"> =&gt;</span><span class="id"> h^-1</span><span class="id"> *:</span> ((<span class="id">f</span><span class="id"> \o</span><span class="id"> shift</span><span class="id"> a</span>) (<span class="id">h</span><span class="id"> *:</span><span class="id"> v</span>)<span class="id"> -</span><span class="id"> f</span><span class="id"> a</span>))<span class="id"> @</span><span class="id"> 0^'</span>).<br/>
<br/>
<span class="vernacular">Class</span><span class="id"> is_derive</span> (<span class="id">a</span><span class="id"> v</span><span class="id"> :</span><span class="id"> V</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> V</span><span class="id"> -&gt;</span><span class="id"> W</span>) (<span class="id">df</span><span class="id"> :</span><span class="id"> W</span>)<span class="id"> :=</span><span class="id"> DeriveDef</span><span class="id"> {</span><br/>
&nbsp;&nbsp;<span class="id">ex_derive</span><span class="id"> :</span><span class="id"> derivable</span><span class="id"> f</span><span class="id"> a</span><span class="id"> v;</span><br/>
&nbsp;&nbsp;<span class="id">derive_val</span><span class="id"> :</span><span class="id"> 'D_v</span><span class="id"> f</span><span class="id"> a</span><span class="id"> =</span><span class="id"> df</span><br/>
<span class="id">}</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> derivable_nbhs</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> V</span><span class="id"> -&gt;</span><span class="id"> W</span>)<span class="id"> a</span><span class="id"> v</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">derivable</span><span class="id"> f</span><span class="id"> a</span><span class="id"> v</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">fun</span><span class="id"> h</span><span class="id"> =&gt;</span> (<span class="id">f</span><span class="id"> \o</span><span class="id"> shift</span><span class="id"> a</span>) (<span class="id">h</span><span class="id"> *:</span><span class="id"> v</span>))<span class="id"> =</span> (<span class="id">cst</span> (<span class="id">f</span><span class="id"> a</span>))<span class="id"> +</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="gallina-kwd">fun</span><span class="id"> h</span><span class="id"> =&gt;</span><span class="id"> h</span><span class="id"> *:</span> (<span class="id">'D_v</span><span class="id"> f</span><span class="id"> a</span>))<span class="id"> +o_</span> (<span class="id">nbhs</span><span class="id"> 0</span>)<span class="id"> id</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> df;</span><span class="id"> apply/eqaddoP</span><span class="id"> =&gt;</span><span class="id"> _/posnumP[e]</span>.<br/>
<span class="id">rewrite</span><span class="id"> -nbhs_nearE</span><span class="id"> nbhs_simpl</span><span class="id"> /=</span><span class="id"> dnbhsE;</span><span class="id"> split;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> /at_point</span><span class="id"> opprD</span><span class="id"> -![</span>(_<span class="id"> +</span><span class="id"> _</span><span class="id"> :</span><span class="id"> _</span><span class="id"> -&gt;</span><span class="id"> _</span>)<span class="id"> _]/</span>(_<span class="id"> +</span><span class="id"> _</span>)<span class="id"> scale0r</span><span class="id"> add0r</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> addrCA</span><span class="id"> addKr</span><span class="id"> normrN</span><span class="id"> scale0r</span><span class="id"> !normr0</span><span class="id"> mulr0</span>.<br/>
<span class="id">have</span><span class="id"> /eqolimP</span><span class="id"> :=</span><span class="id"> df</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> /eqaddoP</span><span class="id"> /</span>(_<span class="id"> e%:num</span>)<span class="id"> /</span>(_<span class="id"> [gt0</span><span class="id"> of</span><span class="id"> e%:num]</span>).<br/>
<span class="id">apply:</span><span class="id"> filter_app;</span><span class="id"> rewrite</span><span class="id"> /=</span><span class="id"> !near_simpl</span><span class="id"> near_withinE;</span><span class="id"> near=&gt;</span><span class="id"> h</span><span class="id"> =&gt;</span><span class="id"> hN0</span>.<br/>
<span class="id">rewrite</span><span class="id"> /=</span><span class="id"> opprD</span><span class="id"> -![</span>(_<span class="id"> +</span><span class="id"> _</span><span class="id"> :</span><span class="id"> _</span><span class="id"> -&gt;</span><span class="id"> _</span>)<span class="id"> _]/</span>(_<span class="id"> +</span><span class="id"> _</span>)<span class="id"> -![</span>(<span class="id">-</span><span class="id"> _</span><span class="id"> :</span><span class="id"> _</span><span class="id"> -&gt;</span><span class="id"> _</span>)<span class="id"> _]/</span>(<span class="id">-</span><span class="id"> _</span>).<br/>
<span class="id">rewrite</span><span class="id"> /cst</span><span class="id"> /=</span><span class="id"> [`|1|]normr1</span><span class="id"> mulr1</span><span class="id"> =&gt;</span><span class="id"> dfv</span>.<br/>
<span class="id">rewrite</span><span class="id"> addrA</span><span class="id"> -[X</span><span class="gallina-kwd"> in</span><span class="id"> X</span><span class="id"> +</span><span class="id"> _]scale1r</span><span class="id"> -</span>(<span class="id">@mulVf</span><span class="id"> _</span><span class="id"> h</span>)<span class="id"> //</span>.<br/>
<span class="id">rewrite</span><span class="id"> mulrC</span><span class="id"> -scalerA</span><span class="id"> -scalerBr</span><span class="id"> normrZ</span>.<br/>
<span class="id">rewrite</span><span class="id"> -ler_pdivlMl;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> normr_gt0</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> mulrCA</span><span class="id"> mulVf</span><span class="id"> ?mulr1;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> normr_eq0</span>.<br/>
<span class="id">Unshelve</span>.<span class="id"> all:</span><span class="gallina-kwd"> by</span><span class="id"> end_near</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> derivable_nbhsP</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> V</span><span class="id"> -&gt;</span><span class="id"> W</span>)<span class="id"> a</span><span class="id"> v</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">derivable</span><span class="id"> f</span><span class="id"> a</span><span class="id"> v</span><span class="id"> &lt;-&gt;</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">fun</span><span class="id"> h</span><span class="id"> =&gt;</span> (<span class="id">f</span><span class="id"> \o</span><span class="id"> shift</span><span class="id"> a</span>) (<span class="id">h</span><span class="id"> *:</span><span class="id"> v</span>))<span class="id"> =</span> (<span class="id">cst</span> (<span class="id">f</span><span class="id"> a</span>))<span class="id"> +</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="gallina-kwd">fun</span><span class="id"> h</span><span class="id"> =&gt;</span><span class="id"> h</span><span class="id"> *:</span> (<span class="id">'D_v</span><span class="id"> f</span><span class="id"> a</span>))<span class="id"> +o_</span> (<span class="id">nbhs</span><span class="id"> 0</span>)<span class="id"> id</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">split;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> derivable_nbhs</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> df;</span><span class="id"> apply/cvg_ex;</span><span class="gallina-kwd"> exists</span> (<span class="id">'D_v</span><span class="id"> f</span><span class="id"> a</span>).<br/>
<span class="id">apply/</span>(<span class="id">@eqolimP</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">dnbhs_filter_on</span><span class="id"> _</span>))<span class="id">/eqaddoP</span><span class="id"> =&gt;</span><span class="id"> _/posnumP[e]</span>.<br/>
<span class="id">have</span><span class="id"> /eqaddoP</span><span class="id"> /</span>(_<span class="id"> e%:num</span>)<span class="id"> /</span>(_<span class="id"> [gt0</span><span class="id"> of</span><span class="id"> e%:num]</span>)<span class="id"> :=</span><span class="id"> df</span>.<br/>
<span class="id">rewrite</span><span class="id"> /=</span><span class="id"> !</span>(<span class="id">near_simpl,</span><span class="id"> near_withinE</span>)<span class="id">;</span><span class="id"> apply:</span><span class="id"> filter_app;</span><span class="id"> near=&gt;</span><span class="id"> h</span>.<br/>
<span class="id">rewrite</span><span class="id"> /=</span><span class="id"> opprD</span><span class="id"> -![</span>(_<span class="id"> +</span><span class="id"> _</span><span class="id"> :</span><span class="id"> _</span><span class="id"> -&gt;</span><span class="id"> _</span>)<span class="id"> _]/</span>(_<span class="id"> +</span><span class="id"> _</span>)<span class="id"> -![</span>(<span class="id">-</span><span class="id"> _</span><span class="id"> :</span><span class="id"> _</span><span class="id"> -&gt;</span><span class="id"> _</span>)<span class="id"> _]/</span>(<span class="id">-</span><span class="id"> _</span>).<br/>
<span class="id">rewrite</span><span class="id"> /cst</span><span class="id"> /=</span><span class="id"> [`|1|]normr1</span><span class="id"> mulr1</span><span class="id"> addrA</span><span class="id"> =&gt;</span><span class="id"> dfv</span><span class="id"> hN0</span>.<br/>
<span class="id">rewrite</span><span class="id"> -[X</span><span class="gallina-kwd"> in</span><span class="id"> _</span><span class="id"> -</span><span class="id"> X]scale1r</span><span class="id"> -</span>(<span class="id">@mulVf</span><span class="id"> _</span><span class="id"> h</span>)<span class="id"> //</span>.<br/>
<span class="id">rewrite</span><span class="id"> -scalerA</span><span class="id"> -scalerBr</span><span class="id"> normrZ</span><span class="id"> normfV</span><span class="id"> ler_pdivrMl</span><span class="id"> ?normr_gt0</span><span class="id"> //</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> mulrC</span>.<br/>
<span class="id">Unshelve</span>.<span class="id"> all:</span><span class="gallina-kwd"> by</span><span class="id"> end_near</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> derivable_nbhsx</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> V</span><span class="id"> -&gt;</span><span class="id"> W</span>)<span class="id"> a</span><span class="id"> v</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">derivable</span><span class="id"> f</span><span class="id"> a</span><span class="id"> v</span><span class="id"> -&gt;</span><span class="gallina-kwd"> forall</span><span class="id"> h,</span><span class="id"> f</span> (<span class="id">a</span><span class="id"> +</span><span class="id"> h</span><span class="id"> *:</span><span class="id"> v</span>)<span class="id"> =</span><span class="id"> f</span><span class="id"> a</span><span class="id"> +</span><span class="id"> h</span><span class="id"> *:</span><span class="id"> 'D_v</span><span class="id"> f</span><span class="id"> a</span><br/>
&nbsp;&nbsp;<span class="id">+o_</span>(<span class="id">h</span><span class="id"> \near</span> (<span class="id">nbhs</span><span class="id"> 0</span>))<span class="id"> h</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> /derivable_nbhs;</span><span class="id"> rewrite</span><span class="id"> funeqE</span><span class="id"> =&gt;</span><span class="id"> df</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> eqaddoEx</span><span class="id"> =&gt;</span><span class="id"> h;</span><span class="id"> have</span><span class="id"> /=</span><span class="id"> :=</span> (<span class="id">df</span><span class="id"> h</span>)<span class="id">;</span><span class="id"> rewrite</span><span class="id"> addrC</span><span class="id"> =&gt;</span><span class="id"> -&gt;</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> derivable_nbhsxP</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> V</span><span class="id"> -&gt;</span><span class="id"> W</span>)<span class="id"> a</span><span class="id"> v</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">derivable</span><span class="id"> f</span><span class="id"> a</span><span class="id"> v</span><span class="id"> &lt;-&gt;</span><span class="gallina-kwd"> forall</span><span class="id"> h,</span><span class="id"> f</span> (<span class="id">a</span><span class="id"> +</span><span class="id"> h</span><span class="id"> *:</span><span class="id"> v</span>)<span class="id"> =</span><span class="id"> f</span><span class="id"> a</span><span class="id"> +</span><span class="id"> h</span><span class="id"> *:</span><span class="id"> 'D_v</span><span class="id"> f</span><span class="id"> a</span><br/>
&nbsp;&nbsp;<span class="id">+o_</span>(<span class="id">h</span><span class="id"> \near</span><span class="id"> nbhs</span><span class="id"> 0</span>)<span class="id"> h</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">split;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> derivable_nbhsx</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> df;</span><span class="id"> apply/derivable_nbhsP;</span><span class="id"> apply/eqaddoE;</span><span class="id"> rewrite</span><span class="id"> funeqE</span><span class="id"> =&gt;</span><span class="id"> h</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /=</span><span class="id"> addrC</span><span class="id"> df</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> DifferentialR</span>.<br/>
<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;''D_' v f&quot;</span><span class="id"> :=</span> (<span class="id">derive</span><span class="id"> f</span><span class="id"> ^~</span><span class="id"> v</span>).<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;''D_' v f c&quot;</span><span class="id"> :=</span> (<span class="id">derive</span><span class="id"> f</span><span class="id"> c</span><span class="id"> v</span>). <br/>
<span class="id">#[global]</span><span class="vernacular"> Hint</span><span class="id"> Extern</span><span class="id"> 0</span> (<span class="id">derivable</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span>)<span class="id"> =&gt;</span><span class="id"> solve[apply:</span><span class="id"> ex_derive]</span><span class="id"> :</span><span class="id"> core</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> DifferentialR_numFieldType</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {R</span><span class="id"> :</span><span class="id"> numFieldType}</span><span class="id"> {V</span><span class="id"> W</span><span class="id"> :</span><span class="id"> normedModType</span><span class="id"> R}</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> deriveE</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> V</span><span class="id"> -&gt;</span><span class="id"> W</span>) (<span class="id">a</span><span class="id"> v</span><span class="id"> :</span><span class="id"> V</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">differentiable</span><span class="id"> f</span><span class="id"> a</span><span class="id"> -&gt;</span><span class="id"> 'D_v</span><span class="id"> f</span><span class="id"> a</span><span class="id"> =</span><span class="id"> 'd</span><span class="id"> f</span><span class="id"> a</span><span class="id"> v</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> /derive</span><span class="id"> =&gt;</span><span class="id"> /diff_locally</span><span class="id"> -&gt;</span><span class="id"> /=;</span><span class="id"> set</span><span class="id"> k</span><span class="id"> :=</span><span class="id"> 'o</span><span class="id"> _</span>.<br/>
<span class="id">evar</span> (<span class="id">g</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> W</span>)<span class="id">;</span><span class="id"> rewrite</span><span class="id"> [X</span><span class="gallina-kwd"> in</span><span class="id"> X</span><span class="id"> @</span><span class="id"> _]</span>(_<span class="id"> :</span><span class="id"> _</span><span class="id"> =</span><span class="id"> g</span>)<span class="id"> /=;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> funeqE=&gt;</span><span class="id"> h;</span><span class="id"> rewrite</span><span class="id"> !scalerDr</span><span class="id"> scalerN</span><span class="id"> /cst</span><span class="id"> /=</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> addrC</span><span class="id"> !addrA</span><span class="id"> addNr</span><span class="id"> add0r</span><span class="id"> linearZ</span><span class="id"> /=</span><span class="id"> scalerA</span><span class="id"> /g</span>.<br/>
<span class="id">apply:</span><span class="id"> cvg_lim</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
<span class="id">pose</span><span class="id"> g1</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> W</span><span class="id"> :=</span><span class="gallina-kwd"> fun</span><span class="id"> h</span><span class="id"> =&gt;</span> (<span class="id">h^-1</span><span class="id"> *</span><span class="id"> h</span>)<span class="id"> *:</span><span class="id"> 'd</span><span class="id"> f</span><span class="id"> a</span><span class="id"> v</span>.<br/>
<span class="id">pose</span><span class="id"> g2</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> W</span><span class="id"> :=</span><span class="gallina-kwd"> fun</span><span class="id"> h</span><span class="id"> :</span><span class="id"> R</span><span class="id"> =&gt;</span><span class="id"> h^-1</span><span class="id"> *:</span><span class="id"> k</span> (<span class="id">h</span><span class="id"> *:</span><span class="id"> v</span> ).<br/>
<span class="id">rewrite</span> (_<span class="id"> :</span><span class="id"> g</span><span class="id"> =</span><span class="id"> g1</span><span class="id"> +</span><span class="id"> g2</span>)<span class="id"> ?funeqE</span><span class="id"> //</span><span class="id"> -</span>(<span class="id">addr0</span> (_<span class="id"> _</span><span class="id"> v</span>))<span class="id">;</span><span class="id"> apply:</span><span class="id"> cvgD</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -</span>(<span class="id">scale1r</span> (_<span class="id"> _</span><span class="id"> v</span>))<span class="id">;</span><span class="id"> apply:</span><span class="id"> cvgZl</span><span class="id"> =&gt;</span><span class="id"> /=</span><span class="id"> X</span><span class="id"> [e</span><span class="id"> e0]</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> /ball_</span><span class="id"> /=</span><span class="id"> =&gt;</span><span class="id"> eX</span>.<br/>
&nbsp;&nbsp;<span class="id">apply/nbhs_ballP</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="gallina-kwd"> exists</span><span class="id"> e</span><span class="id"> =&gt;</span><span class="id"> //=</span><span class="id"> x</span><span class="id"> _</span><span class="id"> x0;</span><span class="id"> apply</span><span class="id"> eX;</span><span class="id"> rewrite</span><span class="id"> mulVr</span><span class="id"> //</span><span class="id"> ?unitfE</span><span class="id"> //=</span><span class="id"> subrr</span><span class="id"> normr0</span>.<br/>
<span class="id">rewrite</span><span class="id"> /g2</span>.<br/>
<span class="id">have</span><span class="id"> [-&gt;|v0]</span><span class="id"> :=</span><span class="id"> eqVneq</span><span class="id"> v</span><span class="id"> 0</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> (_<span class="id"> :</span> (<span class="gallina-kwd">fun</span><span class="id"> _</span><span class="id"> =&gt;</span><span class="id"> _</span>)<span class="id"> =</span><span class="id"> cst</span><span class="id"> 0</span>)<span class="id">;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> cvg_cst</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> funeqE</span><span class="id"> =&gt;</span><span class="id"> ?;</span><span class="id"> rewrite</span><span class="id"> scaler0</span><span class="id"> /k</span><span class="id"> littleo_lim0</span><span class="id"> //</span><span class="id"> scaler0</span>.<br/>
<span class="id">apply/cvgrPdist_lt</span><span class="id"> =&gt;</span><span class="id"> e</span><span class="id"> e0</span>.<br/>
<span class="id">rewrite</span><span class="id"> nearE</span><span class="id"> /=;</span><span class="id"> apply/nbhs_ballP</span>.<br/>
<span class="id">have</span><span class="id"> /</span>(<span class="id">littleoP</span><span class="id"> [littleo</span><span class="id"> of</span><span class="id"> k]</span>)<span class="id"> /nbhs_ballP[i</span><span class="id"> i0</span><span class="id"> Hi]</span><span class="id"> :</span><span class="id"> 0</span><span class="id"> &lt;</span><span class="id"> e</span><span class="id"> /</span> (<span class="id">2</span><span class="id"> *</span><span class="id"> `|v|</span>).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> divr_gt0</span><span class="id"> //</span><span class="id"> pmulr_rgt0</span><span class="id"> //</span><span class="id"> normr_gt0</span>.<br/>
<span class="gallina-kwd">exists</span> (<span class="id">i</span><span class="id"> /</span><span class="id"> `|v|</span>)<span class="id">;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> /=</span><span class="id"> divr_gt0</span><span class="id"> //</span><span class="id"> normr_gt0</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> /=</span><span class="id"> j;</span><span class="id"> rewrite</span><span class="id"> /ball</span><span class="id"> /=</span><span class="id"> /ball_</span><span class="id"> add0r</span><span class="id"> normrN</span>.<br/>
<span class="id">rewrite</span><span class="id"> ltr_pdivlMr</span><span class="id"> ?normr_gt0</span><span class="id"> //</span><span class="id"> =&gt;</span><span class="id"> jvi</span><span class="id"> j0</span>.<br/>
<span class="id">rewrite</span><span class="id"> add0r</span><span class="id"> normrN</span><span class="id"> normrZ</span><span class="id"> -ltr_pdivlMl</span><span class="id"> ?normr_gt0</span><span class="id"> ?invr_neq0</span><span class="id"> //</span>.<br/>
<span class="id">have</span><span class="id"> /Hi/le_lt_trans</span><span class="id"> -&gt;</span><span class="id"> //</span><span class="id"> :</span><span class="id"> ball</span><span class="id"> 0</span><span class="id"> i</span> (<span class="id">j</span><span class="id"> *:</span><span class="id"> v</span>).<br/>
&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -ball_normE/=</span><span class="id"> add0r</span><span class="id"> normrN</span> (<span class="id">le_lt_trans</span><span class="id"> _</span><span class="id"> jvi</span>)<span class="id"> //</span><span class="id"> normrZ</span>.<br/>
<span class="id">rewrite</span><span class="id"> -</span>(<span class="id">mulrC</span><span class="id"> e</span>)<span class="id"> -mulrA</span><span class="id"> -ltr_pdivlMl</span><span class="id"> //</span><span class="id"> mulrA</span><span class="id"> mulVr</span><span class="id"> ?unitfE</span><span class="id"> ?gt_eqF</span><span class="id"> //</span>.<br/>
<span class="id">rewrite</span><span class="id"> normrV</span><span class="id"> ?unitfE</span><span class="id"> //</span><span class="id"> div1r</span><span class="id"> invrK</span><span class="id"> ltr_pdivrMl;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> pmulr_rgt0</span><span class="id"> //</span><span class="id"> normr_gt0</span>.<br/>
<span class="id">rewrite</span><span class="id"> normrZ</span><span class="id"> mulrC</span><span class="id"> -mulrA</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> ltr_pMl</span><span class="id"> ?ltr1n</span><span class="id"> //</span><span class="id"> pmulr_rgt0</span><span class="id"> ?normm_gt0</span><span class="id"> //</span><span class="id"> normr_gt0</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> DifferentialR_numFieldType</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> DifferentialR2</span>.<br/>
<span class="vernacular">Variable</span><span class="id"> R</span><span class="id"> :</span><span class="id"> numFieldType</span>.<br/>
<span class="vernacular">Implicit</span><span class="gallina-kwd"> Type</span> (<span class="id">V</span><span class="id"> :</span><span class="id"> normedModType</span><span class="id"> R</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> derivemxE</span><span class="id"> m</span><span class="id"> n</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> 'rV[R]_m</span>.<span class="id">+1</span><span class="id"> -&gt;</span><span class="id"> 'rV[R]_n</span>.<span class="id">+1</span>) (<span class="id">a</span><span class="id"> v</span><span class="id"> :</span><span class="id"> 'rV[R]_m</span>.<span class="id">+1</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">differentiable</span><span class="id"> f</span><span class="id"> a</span><span class="id"> -&gt;</span><span class="id"> 'D_</span><span class="id"> v</span><span class="id"> f</span><span class="id"> a</span><span class="id"> =</span><span class="id"> v</span><span class="id"> *m</span><span class="id"> jacobian</span><span class="id"> f</span><span class="id"> a</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> /deriveE-&gt;;</span><span class="id"> rewrite</span><span class="id"> /jacobian</span><span class="id"> mul_rV_lin1</span>. Qed.</div></details>
<br/>
<span class="vernacular">Definition</span><span class="id"> derive1</span><span class="id"> V</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> V</span>) (<span class="id">a</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id">lim</span> ((<span class="gallina-kwd">fun</span><span class="id"> h</span><span class="id"> =&gt;</span><span class="id"> h^-1</span><span class="id"> *:</span> (<span class="id">f</span> (<span class="id">h</span><span class="id"> +</span><span class="id"> a</span>)<span class="id"> -</span><span class="id"> f</span><span class="id"> a</span>))<span class="id"> @</span><span class="id"> 0^'</span>).<br/>
<br/>
<span class="vernacular">Local</span><span class="vernacular"> Notation</span> <span class="id">&quot;f ^` ()&quot;</span><span class="id"> :=</span> (<span class="id">derive1</span><span class="id"> f</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> derive1E</span><span class="id"> V</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> V</span>)<span class="id"> a</span><span class="id"> :</span><span class="id"> f^`</span>()<span class="id"> a</span><span class="id"> =</span><span class="id"> 'D_1</span><span class="id"> f</span><span class="id"> a</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> /derive1</span><span class="id"> /derive;</span><span class="id"> set</span><span class="id"> d</span><span class="id"> :=</span> (<span class="gallina-kwd">fun</span><span class="id"> _</span><span class="id"> :</span><span class="id"> R</span><span class="id"> =&gt;</span><span class="id"> _</span>)<span class="id">;</span><span class="id"> set</span><span class="id"> d'</span><span class="id"> :=</span> (<span class="gallina-kwd">fun</span><span class="id"> _</span><span class="id"> :</span><span class="id"> R</span><span class="id"> =&gt;</span><span class="id"> _</span>).<br/>
<span class="gallina-kwd">by</span><span class="id"> suff</span><span class="id"> -&gt;</span><span class="id"> :</span><span class="id"> d</span><span class="id"> =</span><span class="id"> d'</span><span class="gallina-kwd"> by</span><span class="id"> [];</span><span class="id"> rewrite</span><span class="id"> funeqE=&gt;</span><span class="id"> h;</span><span class="id"> rewrite</span><span class="id"> /d</span><span class="id"> /d'</span><span class="id"> /=</span><span class="id"> [h%:A]</span>(<span class="id">mulr1</span>).<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> derive1E'</span><span class="id"> V</span><span class="id"> f</span><span class="id"> a</span><span class="id"> :</span><span class="id"> differentiable</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> V</span>)<span class="id"> a</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">f^`</span>()<span class="id"> a</span><span class="id"> =</span><span class="id"> 'd</span><span class="id"> f</span><span class="id"> a</span><span class="id"> 1</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> ?;</span><span class="id"> rewrite</span><span class="id"> derive1E</span><span class="id"> deriveE</span>. Qed.</div></details>
<br/>
<span class="vernacular">Definition</span><span class="id"> derive1n</span><span class="id"> V</span><span class="id"> n</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> V</span>)<span class="id"> :=</span><span class="id"> iter</span><span class="id"> n</span> (<span class="id">@derive1</span><span class="id"> V</span>)<span class="id"> f</span>.<br/>
<br/>
<span class="vernacular">Local</span><span class="vernacular"> Notation</span> <span class="id">&quot;f ^` ( n )&quot;</span><span class="id"> :=</span> (<span class="id">derive1n</span><span class="id"> n</span><span class="id"> f</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> derive1n0</span><span class="id"> V</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> V</span>)<span class="id"> :</span><span class="id"> f^`</span>(<span class="id">0</span>)<span class="id"> =</span><span class="id"> f</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> []</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> derive1n1</span><span class="id"> V</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> V</span>)<span class="id"> :</span><span class="id"> f^`</span>(<span class="id">1</span>)<span class="id"> =</span><span class="id"> f^`</span>().<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> []</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> derive1nS</span><span class="id"> V</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> V</span>)<span class="id"> n</span><span class="id"> :</span><span class="id"> f^`</span>(<span class="id">n</span>.<span class="id">+1</span>)<span class="id"> =</span><span class="id"> f^`</span>(<span class="id">n</span>)<span class="id">^`</span>().<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> []</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> derive1Sn</span><span class="id"> V</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> V</span>)<span class="id"> n</span><span class="id"> :</span><span class="id"> f^`</span>(<span class="id">n</span>.<span class="id">+1</span>)<span class="id"> =</span><span class="id"> f^`</span>()<span class="id">^`</span>(<span class="id">n</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id"> exact:</span><span class="id"> iterSr</span>. Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> DifferentialR2</span>.<br/>
<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;f ^` ()&quot;</span><span class="id"> :=</span> (<span class="id">derive1</span><span class="id"> f</span>).<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;f ^` ( n )&quot;</span><span class="id"> :=</span> (<span class="id">derive1n</span><span class="id"> n</span><span class="id"> f</span>).<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> DifferentialR3</span>.<br/>
<span class="vernacular">Variable</span><span class="id"> R</span><span class="id"> :</span><span class="id"> numFieldType</span>.<br/>
<br/>
<span class="vernacular">Fact</span><span class="id"> dcst</span> (<span class="id">V</span><span class="id"> W</span><span class="id"> :</span><span class="id"> normedModType</span><span class="id"> R</span>) (<span class="id">a</span><span class="id"> :</span><span class="id"> W</span>) (<span class="id">x</span><span class="id"> :</span><span class="id"> V</span>)<span class="id"> :</span><span class="id"> continuous</span> (<span class="id">0</span><span class="id"> :</span><span class="id"> V</span><span class="id"> -&gt;</span><span class="id"> W</span>)<span class="id"> /\</span><br/>
&nbsp;&nbsp;<span class="id">cst</span><span class="id"> a</span><span class="id"> \o</span><span class="id"> shift</span><span class="id"> x</span><span class="id"> =</span><span class="id"> cst</span> (<span class="id">cst</span><span class="id"> a</span><span class="id"> x</span>)<span class="id"> +</span><span class="id"> \0</span><span class="id"> +o_</span><span class="id"> 0</span><span class="id"> id</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">split;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> cst_continuous</span>.<br/>
<span class="id">apply/eqaddoE;</span><span class="id"> rewrite</span><span class="id"> addr0</span><span class="id"> funeqE</span><span class="id"> =&gt;</span><span class="id"> ?</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> -[LHS]addr0;</span><span class="id"> congr</span> (_<span class="id"> +</span><span class="id"> _</span>).<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> littleoE;</span><span class="id"> last</span><span class="id"> exact:</span><span class="id"> littleo0_subproof</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Variables</span> (<span class="id">V</span><span class="id"> W</span><span class="id"> :</span><span class="id"> normedModType</span><span class="id"> R</span>).<br/>
<br/>
<span class="vernacular">Fact</span><span class="id"> dadd</span> (<span class="id">f</span><span class="id"> g</span><span class="id"> :</span><span class="id"> V</span><span class="id"> -&gt;</span><span class="id"> W</span>)<span class="id"> x</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">differentiable</span><span class="id"> f</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> differentiable</span><span class="id"> g</span><span class="id"> x</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">continuous</span> (<span class="id">'d</span><span class="id"> f</span><span class="id"> x</span><span class="id"> \+</span><span class="id"> 'd</span><span class="id"> g</span><span class="id"> x</span>)<span class="id"> /\</span><br/>
&nbsp;&nbsp;(<span class="id">f</span><span class="id"> +</span><span class="id"> g</span>)<span class="id"> \o</span><span class="id"> shift</span><span class="id"> x</span><span class="id"> =</span><span class="id"> cst</span> ((<span class="id">f</span><span class="id"> +</span><span class="id"> g</span>)<span class="id"> x</span>)<span class="id"> +</span> (<span class="id">'d</span><span class="id"> f</span><span class="id"> x</span><span class="id"> \+</span><span class="id"> 'd</span><span class="id"> g</span><span class="id"> x</span>)<span class="id"> +o_</span><span class="id"> 0</span><span class="id"> id</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> df</span><span class="id"> dg;</span><span class="id"> split</span><span class="id"> =&gt;</span><span class="id"> [?|];</span><span class="id"> do</span><span class="id"> ?exact:</span><span class="id"> continuousD</span>.<br/>
<span class="id">apply/</span>(<span class="id">@eqaddoE</span><span class="id"> R</span>)<span class="id">;</span><span class="id"> rewrite</span><span class="id"> funeqE</span><span class="id"> =&gt;</span><span class="id"> y</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> -[</span>(<span class="id">f</span><span class="id"> +</span><span class="id"> g</span>)<span class="id"> _]/</span>(_<span class="id"> +</span><span class="id"> _</span>).<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> ![_</span> (_<span class="id"> +</span><span class="id"> x</span>)<span class="id">]diff_locallyx//</span><span class="id"> addrACA</span><span class="id"> addox</span><span class="id"> addrACA</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Fact</span><span class="id"> dopp</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> V</span><span class="id"> -&gt;</span><span class="id"> W</span>)<span class="id"> x</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">differentiable</span><span class="id"> f</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> continuous</span> (<span class="id">-</span> (<span class="id">'d</span><span class="id"> f</span><span class="id"> x</span><span class="id"> :</span><span class="id"> V</span><span class="id"> -&gt;</span><span class="id"> W</span>))<span class="id"> /\</span><br/>
&nbsp;&nbsp;(<span class="id">-</span><span class="id"> f</span>)<span class="id"> \o</span><span class="id"> shift</span><span class="id"> x</span><span class="id"> =</span><span class="id"> cst</span> (<span class="id">-</span><span class="id"> f</span><span class="id"> x</span>)<span class="id"> \-</span><span class="id"> 'd</span><span class="id"> f</span><span class="id"> x</span><span class="id"> +o_</span><span class="id"> 0</span><span class="id"> id</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> df;</span><span class="id"> split;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> ?;</span><span class="id"> apply:</span><span class="id"> continuousN</span>.<br/>
<span class="id">apply/eqaddoE;</span><span class="id"> rewrite</span><span class="id"> funeqE</span><span class="id"> =&gt;</span><span class="id"> y</span><span class="id"> /=</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -[</span>(<span class="id">-</span><span class="id"> f</span>)<span class="id"> _]/</span>(<span class="id">-</span> (_<span class="id"> _</span>))<span class="id"> diff_locallyx//</span><span class="id"> !opprD</span><span class="id"> oppox</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> is_diff_eq</span> (<span class="id">V'</span><span class="id"> W'</span><span class="id"> :</span><span class="id"> normedModType</span><span class="id"> R</span>) (<span class="id">f</span><span class="id"> f'</span><span class="id"> g</span><span class="id"> :</span><span class="id"> V'</span><span class="id"> -&gt;</span><span class="id"> W'</span>) (<span class="id">x</span><span class="id"> :</span><span class="id"> V'</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">is_diff</span><span class="id"> x</span><span class="id"> f</span><span class="id"> f'</span><span class="id"> -&gt;</span><span class="id"> f'</span><span class="id"> =</span><span class="id"> g</span><span class="id"> -&gt;</span><span class="id"> is_diff</span><span class="id"> x</span><span class="id"> f</span><span class="id"> g</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> ?</span><span class="id"> &lt;-</span>. Qed.</div></details>
<br/>
<span class="vernacular">Fact</span><span class="id"> dscale</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> V</span><span class="id"> -&gt;</span><span class="id"> W</span>)<span class="id"> k</span><span class="id"> x</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">differentiable</span><span class="id"> f</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> continuous</span> (<span class="id">k</span><span class="id"> \*:</span><span class="id"> 'd</span><span class="id"> f</span><span class="id"> x</span>)<span class="id"> /\</span><br/>
&nbsp;&nbsp;(<span class="id">k</span><span class="id"> *:</span><span class="id"> f</span>)<span class="id"> \o</span><span class="id"> shift</span><span class="id"> x</span><span class="id"> =</span><span class="id"> cst</span> ((<span class="id">k</span><span class="id"> *:</span><span class="id"> f</span>)<span class="id"> x</span>)<span class="id"> +</span><span class="id"> k</span><span class="id"> \*:</span><span class="id"> 'd</span><span class="id"> f</span><span class="id"> x</span><span class="id"> +o_</span><span class="id"> 0</span><span class="id"> id</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> df;</span><span class="id"> split;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> ?;</span><span class="id"> apply:</span><span class="id"> continuousZr</span>.<br/>
<span class="id">apply/eqaddoE;</span><span class="id"> rewrite</span><span class="id"> funeqE</span><span class="id"> =&gt;</span><span class="id"> y</span><span class="id"> /=</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -[</span>(<span class="id">k</span><span class="id"> *:</span><span class="id"> f</span>)<span class="id"> _]/</span>(_<span class="id"> *:</span><span class="id"> _</span>)<span class="id"> diff_locallyx</span><span class="id"> //</span><span class="id"> !scalerDr</span><span class="id"> scaleox</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Fact</span><span class="id"> dscalel</span> (<span class="id">k</span><span class="id"> :</span><span class="id"> V</span><span class="id"> -&gt;</span><span class="id"> R</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> W</span>)<span class="id"> x</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">differentiable</span><span class="id"> k</span><span class="id"> x</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">continuous</span> (<span class="gallina-kwd">fun</span><span class="id"> z</span><span class="id"> :</span><span class="id"> V</span><span class="id"> =&gt;</span><span class="id"> 'd</span><span class="id"> k</span><span class="id"> x</span><span class="id"> z</span><span class="id"> *:</span><span class="id"> f</span>)<span class="id"> /\</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">fun</span><span class="id"> z</span><span class="id"> =&gt;</span><span class="id"> k</span><span class="id"> z</span><span class="id"> *:</span><span class="id"> f</span>)<span class="id"> \o</span><span class="id"> shift</span><span class="id"> x</span><span class="id"> =</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">cst</span> (<span class="id">k</span><span class="id"> x</span><span class="id"> *:</span><span class="id"> f</span>)<span class="id"> +</span> (<span class="gallina-kwd">fun</span><span class="id"> z</span><span class="id"> =&gt;</span><span class="id"> 'd</span><span class="id"> k</span><span class="id"> x</span><span class="id"> z</span><span class="id"> *:</span><span class="id"> f</span>)<span class="id"> +o_</span><span class="id"> 0</span><span class="id"> id</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> df;</span><span class="id"> split</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> ?;</span><span class="id"> exact/continuousZl/diff_continuous</span>.<br/>
<span class="id">apply/eqaddoE;</span><span class="id"> rewrite</span><span class="id"> funeqE</span><span class="id"> =&gt;</span><span class="id"> y</span><span class="id"> /=</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> diff_locallyx</span><span class="id"> //=</span><span class="id"> !scalerDl</span><span class="id"> scaleolx</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Fact</span><span class="id"> dlin</span> (<span class="id">V'</span><span class="id"> W'</span><span class="id"> :</span><span class="id"> normedModType</span><span class="id"> R</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> {linear</span><span class="id"> V'</span><span class="id"> -&gt;</span><span class="id"> W'}</span>)<span class="id"> x</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">continuous</span><span class="id"> f</span><span class="id"> -&gt;</span><span class="id"> f</span><span class="id"> \o</span><span class="id"> shift</span><span class="id"> x</span><span class="id"> =</span><span class="id"> cst</span> (<span class="id">f</span><span class="id"> x</span>)<span class="id"> +</span><span class="id"> f</span><span class="id"> +o_</span><span class="id"> 0</span><span class="id"> id</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> df;</span><span class="id"> apply:</span><span class="id"> eqaddoE;</span><span class="id"> rewrite</span><span class="id"> funeqE</span><span class="id"> =&gt;</span><span class="id"> y</span><span class="id"> /=</span>.<br/>
<span class="id">rewrite</span><span class="id"> linearD</span><span class="id"> addrC</span><span class="id"> -[LHS]addr0;</span><span class="id"> congr</span> (_<span class="id"> +</span><span class="id"> _</span>).<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> littleoE;</span><span class="id"> last</span><span class="id"> exact:</span><span class="id"> littleo0_subproof</span>. <span class="comment">(*fixme*)</span><br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> compoO_eqo</span> (<span class="id">U</span><span class="id"> V'</span><span class="id"> W'</span><span class="id"> :</span><span class="id"> normedModType</span><span class="id"> R</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> U</span><span class="id"> -&gt;</span><span class="id"> V'</span>)<br/>
&nbsp;&nbsp;(<span class="id">g</span><span class="id"> :</span><span class="id"> V'</span><span class="id"> -&gt;</span><span class="id"> W'</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">[o_</span><span class="id"> 0</span><span class="id"> id</span><span class="id"> of</span><span class="id"> g]</span><span class="id"> \o</span><span class="id"> [O_</span><span class="id"> 0</span><span class="id"> id</span><span class="id"> of</span><span class="id"> f]</span><span class="id"> =o_</span><span class="id"> 0</span><span class="id"> id</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">apply/eqoP</span><span class="id"> =&gt;</span><span class="id"> _</span><span class="id"> /posnumP[e]</span>.<br/>
<span class="id">have</span><span class="id"> /bigO_exP</span><span class="id"> [_</span><span class="id"> /posnumP[k]]</span><span class="id"> :=</span><span class="id"> bigOP</span><span class="id"> [bigO</span><span class="id"> of</span><span class="id"> [O_</span><span class="id"> 0</span><span class="id"> id</span><span class="id"> of</span><span class="id"> f]]</span>.<br/>
<span class="id">have</span><span class="id"> :=</span><span class="id"> littleoP</span><span class="id"> [littleo</span><span class="id"> of</span><span class="id"> [o_</span><span class="id"> 0</span><span class="id"> id</span><span class="id"> of</span><span class="id"> g]]</span>.<br/>
<span class="id">move=&gt;</span> <span class="id"> /</span>(_ (<span class="id">e%:num</span><span class="id"> /</span><span class="id"> k%:num</span>))<span class="id"> /</span>(_<span class="id"> _</span>)<span class="id"> /nbhs_ballP</span><span class="id"> [//|_</span><span class="id"> /posnumP[d]</span><span class="id"> hd]</span>.<br/>
<span class="id">apply:</span><span class="id"> filter_app;</span><span class="id"> near=&gt;</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> leOxkx;</span><span class="id"> apply:</span><span class="id"> le_trans</span> (<span class="id">hd</span><span class="id"> _</span><span class="id"> _</span>)<span class="id"> _;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -ler_pdivlMl</span><span class="id"> //;</span><span class="id"> apply:</span><span class="id"> le_trans</span><span class="id"> leOxkx</span><span class="id"> _</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> invf_div</span><span class="id"> mulrA</span><span class="id"> -[_</span><span class="id"> /</span><span class="id"> _</span><span class="id"> *</span><span class="id"> _]mulrA</span><span class="id"> mulVf</span><span class="id"> //</span><span class="id"> mulr1</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -ball_normE</span><span class="id"> /=</span><span class="id"> distrC</span><span class="id"> subr0</span> (<span class="id">le_lt_trans</span><span class="id"> leOxkx</span>)<span class="id"> //</span><span class="id"> -ltr_pdivlMl</span>.<br/>
<span class="id">Unshelve</span>.<span class="id"> all:</span><span class="gallina-kwd"> by</span><span class="id"> end_near</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> compoO_eqox</span> (<span class="id">U</span><span class="id"> V'</span><span class="id"> W'</span><span class="id"> :</span><span class="id"> normedModType</span><span class="id"> R</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> U</span><span class="id"> -&gt;</span><span class="id"> V'</span>)<br/>
&nbsp;&nbsp;(<span class="id">g</span><span class="id"> :</span><span class="id"> V'</span><span class="id"> -&gt;</span><span class="id"> W'</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">forall</span><span class="id"> x</span><span class="id"> :</span><span class="id"> U,</span><span class="id"> [o_</span><span class="id"> 0</span><span class="id"> id</span><span class="id"> of</span><span class="id"> g]</span> (<span class="id">[O_</span><span class="id"> 0</span><span class="id"> id</span><span class="id"> of</span><span class="id"> f]</span><span class="id"> x</span>)<span class="id"> =o_</span>(<span class="id">x</span><span class="id"> \near</span><span class="id"> 0</span>)<span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> x;</span><span class="id"> rewrite</span><span class="id"> -[LHS]/</span>((_<span class="id"> \o</span><span class="id"> _</span>)<span class="id"> x</span>)<span class="id"> compoO_eqo</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> compOo_eqo</span>  (<span class="id">U</span><span class="id"> V'</span><span class="id"> W'</span><span class="id"> :</span><span class="id"> normedModType</span><span class="id"> R</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> U</span><span class="id"> -&gt;</span><span class="id"> V'</span>) (<span class="id">g</span><span class="id"> :</span><span class="id"> V'</span><span class="id"> -&gt;</span><span class="id"> W'</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">[O_</span><span class="id"> 0</span><span class="id"> id</span><span class="id"> of</span><span class="id"> g]</span><span class="id"> \o</span><span class="id"> [o_</span><span class="id"> 0</span><span class="id"> id</span><span class="id"> of</span><span class="id"> f]</span><span class="id"> =o_</span><span class="id"> 0</span><span class="id"> id</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">apply/eqoP</span><span class="id"> =&gt;</span><span class="id"> _</span><span class="id"> /posnumP[e]</span>.<br/>
<span class="id">have</span><span class="id"> /bigO_exP</span><span class="id"> [_</span><span class="id"> /posnumP[k]]</span><span class="id"> :=</span><span class="id"> bigOP</span><span class="id"> [bigO</span><span class="id"> of</span><span class="id"> [O_</span><span class="id"> 0</span><span class="id"> id</span><span class="id"> of</span><span class="id"> g]]</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> /nbhs_ballP</span><span class="id"> [_</span><span class="id"> /posnumP[d]</span><span class="id"> hd]</span>.<br/>
<span class="id">have</span><span class="id"> ekgt0</span><span class="id"> :</span><span class="id"> e%:num</span><span class="id"> /</span><span class="id"> k%:num</span><span class="id"> &gt;</span><span class="id"> 0</span><span class="gallina-kwd"> by</span><span class="id"> []</span>.<br/>
<span class="id">have</span><span class="id"> /</span>(_<span class="id"> _</span><span class="id"> ekgt0</span>)<span class="id"> :=</span><span class="id"> littleoP</span><span class="id"> [littleo</span><span class="id"> of</span><span class="id"> [o_</span><span class="id"> 0</span><span class="id"> id</span><span class="id"> of</span><span class="id"> f]]</span>.<br/>
<span class="id">apply:</span><span class="id"> filter_app;</span><span class="id"> near=&gt;</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> leoxekx;</span><span class="id"> apply:</span><span class="id"> le_trans</span> (<span class="id">hd</span><span class="id"> _</span><span class="id"> _</span>)<span class="id"> _;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -ler_pdivlMl</span><span class="id"> //</span><span class="id"> mulrA</span><span class="id"> [_^-1</span><span class="id"> *</span><span class="id"> _]mulrC</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -ball_normE</span><span class="id"> /=</span><span class="id"> distrC</span><span class="id"> subr0</span> (<span class="id">le_lt_trans</span><span class="id"> leoxekx</span>)<span class="id">//</span><span class="id"> -ltr_pdivlMl</span><span class="id"> //</span>.<br/>
<span class="id">Unshelve</span>.<span class="id"> all:</span><span class="gallina-kwd"> by</span><span class="id"> end_near</span>. Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> DifferentialR3</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> DifferentialR3_numFieldType</span>.<br/>
<span class="vernacular">Variable</span><span class="id"> R</span><span class="id"> :</span><span class="id"> numFieldType</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> littleo_linear0</span> (<span class="id">V</span><span class="id"> W</span><span class="id"> :</span><span class="id"> normedModType</span><span class="id"> R</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> {linear</span><span class="id"> V</span><span class="id"> -&gt;</span><span class="id"> W}</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;(<span class="id">f</span><span class="id"> :</span><span class="id"> V</span><span class="id"> -&gt;</span><span class="id"> W</span>)<span class="id"> =o_</span><span class="id"> 0</span><span class="id"> id</span><span class="id"> -&gt;</span><span class="id"> f</span><span class="id"> =</span><span class="id"> cst</span><span class="id"> 0</span><span class="id"> :&gt;</span> (<span class="id">V</span><span class="id"> -&gt;</span><span class="id"> W</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move/eqoP</span><span class="id"> =&gt;</span><span class="id"> oid</span>.<br/>
<span class="id">rewrite</span><span class="id"> funeqE</span><span class="id"> =&gt;</span><span class="id"> x;</span><span class="id"> apply/eqP;</span><span class="id"> have</span><span class="id"> [|xn0]</span><span class="id"> :=</span><span class="id"> real_le0P</span> (<span class="id">normr_real</span><span class="id"> x</span>).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> normr_le0</span><span class="id"> =&gt;</span><span class="id"> /eqP</span><span class="id"> -&gt;;</span><span class="id"> rewrite</span><span class="id"> linear0</span>.<br/>
<span class="id">rewrite</span><span class="id"> -normr_le0</span><span class="id"> -</span>(<span class="id">mul0r</span><span class="id"> `|x|</span>)<span class="id"> -ler_pdivrMr</span><span class="id"> //</span>.<br/>
<span class="id">apply/ler_gtP</span><span class="id"> =&gt;</span><span class="id"> _</span><span class="id"> /posnumP[e];</span><span class="id"> rewrite</span><span class="id"> ler_pdivrMr</span><span class="id"> //</span>.<br/>
<span class="id">have</span><span class="id"> /oid</span><span class="id"> /nbhs_ballP</span><span class="id"> [_</span><span class="id"> /posnumP[d]</span><span class="id"> dfe]</span><span class="id"> :=</span><span class="id"> !!</span><span class="id"> gt0</span><span class="id"> e</span>.<br/>
<span class="id">set</span><span class="id"> k</span><span class="id"> :=</span> ((<span class="id">d%:num</span><span class="id"> /</span><span class="id"> 2</span>)<span class="id"> /</span> (<span class="id">PosNum</span><span class="id"> xn0</span>)<span class="id">%:num</span>)<span class="id">^-1</span>.<br/>
<span class="id">rewrite</span><span class="id"> -{1}</span>(<span class="id">@scalerKV</span><span class="id"> _</span><span class="id"> _</span><span class="id"> k</span><span class="id"> _</span><span class="id"> x</span>)<span class="id"> /k</span><span class="id"> //</span><span class="id"> linearZZ</span><span class="id"> normrZ</span>.<br/>
<span class="id">rewrite</span><span class="id"> -ler_pdivlMl;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> gtr0_norm</span>.<br/>
<span class="id">rewrite</span><span class="id"> mulrCA</span> (<span class="id">@le_trans</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">e%:num</span><span class="id"> *</span><span class="id"> `|k^-1</span><span class="id"> *:</span><span class="id"> x|</span>))<span class="id"> //;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> ler_pM</span><span class="id"> //</span><span class="id"> normrZ</span><span class="id"> normfV</span>.<br/>
<span class="id">apply:</span><span class="id"> dfe;</span><span class="id"> rewrite</span><span class="id"> -ball_normE</span><span class="id"> /=</span><span class="id"> sub0r</span><span class="id"> normrN</span><span class="id"> normrZ</span>.<br/>
<span class="id">rewrite</span><span class="id"> invrK</span><span class="id"> -ltr_pdivlMr</span><span class="id"> //</span><span class="id"> ger0_norm</span><span class="id"> //</span><span class="id"> ltr_pdivrMr</span><span class="id"> //</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -mulrA</span><span class="id"> mulVf</span><span class="id"> ?lt0r_neq0</span><span class="id"> //</span><span class="id"> mulr1</span><span class="id"> [ltRHS]splitr</span><span class="id"> ltrDl</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> diff_unique</span> (<span class="id">V</span><span class="id"> W</span><span class="id"> :</span><span class="id"> normedModType</span><span class="id"> R</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> V</span><span class="id"> -&gt;</span><span class="id"> W</span>)<br/>
&nbsp;&nbsp;(<span class="id">df</span><span class="id"> :</span><span class="id"> {linear</span><span class="id"> V</span><span class="id"> -&gt;</span><span class="id"> W}</span>)<span class="id"> x</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">continuous</span><span class="id"> df</span><span class="id"> -&gt;</span><span class="id"> f</span><span class="id"> \o</span><span class="id"> shift</span><span class="id"> x</span><span class="id"> =</span><span class="id"> cst</span> (<span class="id">f</span><span class="id"> x</span>)<span class="id"> +</span><span class="id"> df</span><span class="id"> +o_</span><span class="id"> 0</span><span class="id"> id</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">'d</span><span class="id"> f</span><span class="id"> x</span><span class="id"> =</span><span class="id"> df</span><span class="id"> :&gt;</span> (<span class="id">V</span><span class="id"> -&gt;</span><span class="id"> W</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> dfc</span><span class="id"> dxf;</span><span class="id"> apply/subr0_eq;</span><span class="id"> rewrite</span><span class="id"> -[LHS]/</span>(_<span class="id"> \-</span><span class="id"> _</span>).<br/>
<span class="id">apply/littleo_linear0/eqoP/eq_some_oP</span><span class="id"> =&gt;</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> funeqE</span><span class="id"> =&gt;</span><span class="id"> y</span><span class="id"> /=</span>.<br/>
<span class="id">have</span><span class="id"> hdf</span><span class="id"> h</span><span class="id"> :</span> (<span class="id">f</span><span class="id"> \o</span><span class="id"> shift</span><span class="id"> x</span><span class="id"> =</span><span class="id"> cst</span> (<span class="id">f</span><span class="id"> x</span>)<span class="id"> +</span><span class="id"> h</span><span class="id"> +o_</span><span class="id"> 0</span><span class="id"> id</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">h</span><span class="id"> =</span><span class="id"> f</span><span class="id"> \o</span><span class="id"> shift</span><span class="id"> x</span><span class="id"> -</span><span class="id"> cst</span> (<span class="id">f</span><span class="id"> x</span>)<span class="id"> +o_</span><span class="id"> 0</span><span class="id"> id</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> hdf;</span><span class="id"> apply:</span><span class="id"> eqaddoE</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> hdf</span><span class="id"> addrAC</span><span class="id"> -!addrA</span><span class="id"> addrC</span><span class="id"> !addrA</span><span class="id"> subrK</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -[LHS]addr0</span><span class="id"> -addrA;</span><span class="id"> congr</span> (_<span class="id"> +</span><span class="id"> _</span>).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply/eqP;</span><span class="id"> rewrite</span><span class="id"> eq_sym</span><span class="id"> addrC</span><span class="id"> addr_eq0</span><span class="id"> oppo</span>.<br/>
<span class="id">rewrite</span> (<span class="id">hdf</span><span class="id"> _</span><span class="id"> dxf</span>).<br/>
<span class="id">suff</span><span class="id"> /diff_locally</span><span class="id"> /hdf</span><span class="id"> -&gt;</span><span class="id"> :</span><span class="id"> differentiable</span><span class="id"> f</span><span class="id"> x</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> opprD</span><span class="id"> addrCA</span><span class="id"> -</span>(<span class="id">addrA</span> (_<span class="id"> -</span><span class="id"> _</span>))<span class="id"> addKr</span><span class="id"> oppox</span><span class="id"> addox</span>.<br/>
<span class="id">apply/diffP</span><span class="id"> =&gt;</span><span class="id"> /=</span>.<br/>
<span class="id">apply:</span> (<span class="id">@getPex</span><span class="id"> _</span> (<span class="gallina-kwd">fun</span> (<span class="id">df</span><span class="id"> :</span><span class="id"> {linear</span><span class="id"> V</span><span class="id"> -&gt;</span><span class="id"> W}</span>)<span class="id"> =&gt;</span><span class="id"> continuous</span><span class="id"> df</span><span class="id"> /\</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">forall</span><span class="id"> y,</span><span class="id"> f</span><span class="id"> y</span><span class="id"> =</span><span class="id"> f</span> (<span class="id">lim</span> (<span class="id">nbhs</span><span class="id"> x</span>))<span class="id"> +</span><span class="id"> df</span> (<span class="id">y</span><span class="id"> -</span><span class="id"> lim</span> (<span class="id">nbhs</span><span class="id"> x</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">+o_</span>(<span class="id">y</span><span class="id"> \near</span><span class="id"> x</span>) (<span class="id">y</span><span class="id"> -</span><span class="id"> lim</span> (<span class="id">nbhs</span><span class="id"> x</span>)))).<br/>
<span class="gallina-kwd">exists</span><span class="id"> df;</span><span class="id"> split=&gt;</span><span class="id"> //;</span><span class="id"> apply:</span><span class="id"> eqaddoEx</span><span class="id"> =&gt;</span><span class="id"> z</span>.<br/>
<span class="id">rewrite</span> (<span class="id">hdf</span><span class="id"> _</span><span class="id"> dxf</span>)<span class="id"> !addrA</span><span class="id"> lim_id</span><span class="id"> //</span><span class="id"> /</span>(_<span class="id"> \o</span><span class="id"> _</span>)<span class="id"> /=</span><span class="id"> subrK</span><span class="id"> [f</span><span class="id"> _</span><span class="id"> +</span><span class="id"> _]addrC</span><span class="id"> addrK</span>.<br/>
<span class="id">rewrite</span><span class="id"> -addrA</span><span class="id"> -[LHS]addr0;</span><span class="id"> congr</span> (_<span class="id"> +</span><span class="id"> _</span>).<br/>
<span class="id">apply/eqP;</span><span class="id"> rewrite</span><span class="id"> eq_sym</span><span class="id"> addrC</span><span class="id"> addr_eq0</span><span class="id"> oppox;</span><span class="id"> apply/eqP</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> littleo_center0</span> (<span class="id">comp_centerK</span><span class="id"> x</span><span class="id"> id</span>)<span class="id"> -[-</span><span class="id"> _</span><span class="gallina-kwd"> in</span><span class="id"> RHS]</span>(<span class="id">comp_centerK</span><span class="id"> x</span>).<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> diff_cst</span> (<span class="id">V</span><span class="id"> W</span><span class="id"> :</span><span class="id"> normedModType</span><span class="id"> R</span>)<span class="id"> a</span><span class="id"> x</span><span class="id"> :</span> (<span class="id">'d</span> (<span class="id">cst</span><span class="id"> a</span>)<span class="id"> x</span><span class="id"> :</span><span class="id"> V</span><span class="id"> -&gt;</span><span class="id"> W</span>)<span class="id"> =</span><span class="id"> 0</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> apply/diff_unique;</span><span class="id"> have</span><span class="id"> []</span><span class="id"> :=</span><span class="id"> dcst</span><span class="id"> a</span><span class="id"> x</span>. Qed.</div></details>
<br/>
<span class="vernacular">Variables</span> (<span class="id">V</span><span class="id"> W</span><span class="id"> :</span><span class="id"> normedModType</span><span class="id"> R</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> differentiable_cst</span> (<span class="id">W'</span><span class="id"> :</span><span class="id"> normedModType</span><span class="id"> R</span>) (<span class="id">a</span><span class="id"> :</span><span class="id"> W'</span>) (<span class="id">x</span><span class="id"> :</span><span class="id"> V</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">differentiable</span> (<span class="id">cst</span><span class="id"> a</span>)<span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> apply/diff_locallyP;</span><span class="id"> rewrite</span><span class="id"> diff_cst;</span><span class="id"> have</span><span class="id"> :=</span><span class="id"> dcst</span><span class="id"> a</span><span class="id"> x</span>. Qed.</div></details>
<br/>
<span class="id">Global</span><span class="vernacular"> Instance</span><span class="id"> is_diff_cst</span> (<span class="id">a</span><span class="id"> :</span><span class="id"> W</span>) (<span class="id">x</span><span class="id"> :</span><span class="id"> V</span>)<span class="id"> :</span><span class="id"> is_diff</span><span class="id"> x</span> (<span class="id">cst</span><span class="id"> a</span>)<span class="id"> 0</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id"> exact:</span><span class="id"> DiffDef</span> (<span class="id">differentiable_cst</span><span class="id"> _</span><span class="id"> _</span>) (<span class="id">diff_cst</span><span class="id"> _</span><span class="id"> _</span>). Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> diffD</span> (<span class="id">f</span><span class="id"> g</span><span class="id"> :</span><span class="id"> V</span><span class="id"> -&gt;</span><span class="id"> W</span>)<span class="id"> x</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">differentiable</span><span class="id"> f</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> differentiable</span><span class="id"> g</span><span class="id"> x</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">'d</span> (<span class="id">f</span><span class="id"> +</span><span class="id"> g</span>)<span class="id"> x</span><span class="id"> =</span><span class="id"> 'd</span><span class="id"> f</span><span class="id"> x</span><span class="id"> \+</span><span class="id"> 'd</span><span class="id"> g</span><span class="id"> x</span><span class="id"> :&gt;</span> (<span class="id">V</span><span class="id"> -&gt;</span><span class="id"> W</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> df</span><span class="id"> dg;</span><span class="id"> apply/diff_unique;</span><span class="id"> have</span><span class="id"> []</span><span class="id"> :=</span><span class="id"> dadd</span><span class="id"> df</span><span class="id"> dg</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> differentiableD</span> (<span class="id">f</span><span class="id"> g</span><span class="id"> :</span><span class="id"> V</span><span class="id"> -&gt;</span><span class="id"> W</span>)<span class="id"> x</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">differentiable</span><span class="id"> f</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> differentiable</span><span class="id"> g</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> differentiable</span> (<span class="id">f</span><span class="id"> +</span><span class="id"> g</span>)<span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> df</span><span class="id"> dg;</span><span class="id"> apply/diff_locallyP;</span><span class="id"> rewrite</span><span class="id"> diffD</span><span class="id"> //;</span><span class="id"> have</span><span class="id"> :=</span><span class="id"> dadd</span><span class="id"> df</span><span class="id"> dg</span>.<br/>
Qed.</div></details>
<br/>
<span class="id">Global</span><span class="vernacular"> Instance</span><span class="id"> is_diffD</span> (<span class="id">f</span><span class="id"> g</span><span class="id"> df</span><span class="id"> dg</span><span class="id"> :</span><span class="id"> V</span><span class="id"> -&gt;</span><span class="id"> W</span>)<span class="id"> x</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">is_diff</span><span class="id"> x</span><span class="id"> f</span><span class="id"> df</span><span class="id"> -&gt;</span><span class="id"> is_diff</span><span class="id"> x</span><span class="id"> g</span><span class="id"> dg</span><span class="id"> -&gt;</span><span class="id"> is_diff</span><span class="id"> x</span> (<span class="id">f</span><span class="id"> +</span><span class="id"> g</span>) (<span class="id">df</span><span class="id"> +</span><span class="id"> dg</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> dfx</span><span class="id"> dgx;</span><span class="id"> apply:</span><span class="id"> DiffDef;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> differentiableD</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> diffD</span><span class="id"> //</span><span class="id"> !diff_val</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> differentiable_sum</span><span class="id"> n</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> 'I_n</span><span class="id"> -&gt;</span><span class="id"> V</span><span class="id"> -&gt;</span><span class="id"> W</span>) (<span class="id">x</span><span class="id"> :</span><span class="id"> V</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">forall</span><span class="id"> i,</span><span class="id"> differentiable</span> (<span class="id">f</span><span class="id"> i</span>)<span class="id"> x</span>)<span class="id"> -&gt;</span><span class="id"> differentiable</span> (<span class="id">\sum_</span>(<span class="id">i</span><span class="id"> &lt;</span><span class="id"> n</span>)<span class="id"> f</span><span class="id"> i</span>)<span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd">by</span><span class="id"> elim/big_ind</span><span class="id"> :</span><span class="id"> _</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> ?</span><span class="id"> ?</span><span class="id"> g</span><span class="id"> h</span><span class="id"> ?;</span><span class="id"> apply:</span><span class="id"> differentiableD;</span><span class="id"> [exact:g|exact:h]</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> diffN</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> V</span><span class="id"> -&gt;</span><span class="id"> W</span>)<span class="id"> x</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">differentiable</span><span class="id"> f</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> 'd</span> (<span class="id">-</span><span class="id"> f</span>)<span class="id"> x</span><span class="id"> =</span><span class="id"> -</span> (<span class="id">'d</span><span class="id"> f</span><span class="id"> x</span><span class="id"> :</span><span class="id"> V</span><span class="id"> -&gt;</span><span class="id"> W</span>)<span class="id"> :&gt;</span> (<span class="id">V</span><span class="id"> -&gt;</span><span class="id"> W</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> df;</span><span class="id"> rewrite</span><span class="id"> -[RHS]/</span>(<span class="id">@GRing</span>.<span class="id">opp</span><span class="id"> _</span><span class="id"> \o</span><span class="id"> _</span>)<span class="id">;</span><span class="id"> apply/diff_unique;</span><br/>
<span class="gallina-kwd">by</span><span class="id"> have</span><span class="id"> []</span><span class="id"> :=</span><span class="id"> dopp</span><span class="id"> df</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> differentiableN</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> V</span><span class="id"> -&gt;</span><span class="id"> W</span>)<span class="id"> x</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">differentiable</span><span class="id"> f</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> differentiable</span> (<span class="id">-</span><span class="id"> f</span>)<span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> df;</span><span class="id"> apply/diff_locallyP;</span><span class="id"> rewrite</span><span class="id"> diffN</span><span class="id"> //;</span><span class="id"> have</span><span class="id"> :=</span><span class="id"> dopp</span><span class="id"> df</span>.<br/>
Qed.</div></details>
<br/>
<span class="id">Global</span><span class="vernacular"> Instance</span><span class="id"> is_diffN</span> (<span class="id">f</span><span class="id"> df</span><span class="id"> :</span><span class="id"> V</span><span class="id"> -&gt;</span><span class="id"> W</span>)<span class="id"> x</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">is_diff</span><span class="id"> x</span><span class="id"> f</span><span class="id"> df</span><span class="id"> -&gt;</span><span class="id"> is_diff</span><span class="id"> x</span> (<span class="id">-</span><span class="id"> f</span>) (<span class="id">-</span><span class="id"> df</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> dfx;</span><span class="id"> apply:</span><span class="id"> DiffDef;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> differentiableN</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> diffN</span><span class="id"> //</span><span class="id"> diff_val</span>.<br/>
Qed.</div></details>
<br/>
<span class="id">Global</span><span class="vernacular"> Instance</span><span class="id"> is_diffB</span> (<span class="id">f</span><span class="id"> g</span><span class="id"> df</span><span class="id"> dg</span><span class="id"> :</span><span class="id"> V</span><span class="id"> -&gt;</span><span class="id"> W</span>)<span class="id"> x</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">is_diff</span><span class="id"> x</span><span class="id"> f</span><span class="id"> df</span><span class="id"> -&gt;</span><span class="id"> is_diff</span><span class="id"> x</span><span class="id"> g</span><span class="id"> dg</span><span class="id"> -&gt;</span><span class="id"> is_diff</span><span class="id"> x</span> (<span class="id">f</span><span class="id"> -</span><span class="id"> g</span>) (<span class="id">df</span><span class="id"> -</span><span class="id"> dg</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> dfx</span><span class="id"> dgx;</span><span class="id"> apply:</span><span class="id"> is_diff_eq</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> diffB</span> (<span class="id">f</span><span class="id"> g</span><span class="id"> :</span><span class="id"> V</span><span class="id"> -&gt;</span><span class="id"> W</span>)<span class="id"> x</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">differentiable</span><span class="id"> f</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> differentiable</span><span class="id"> g</span><span class="id"> x</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">'d</span> (<span class="id">f</span><span class="id"> -</span><span class="id"> g</span>)<span class="id"> x</span><span class="id"> =</span><span class="id"> 'd</span><span class="id"> f</span><span class="id"> x</span><span class="id"> \-</span><span class="id"> 'd</span><span class="id"> g</span><span class="id"> x</span><span class="id"> :&gt;</span> (<span class="id">V</span><span class="id"> -&gt;</span><span class="id"> W</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> /differentiableP</span><span class="id"> df</span><span class="id"> /differentiableP</span><span class="id"> dg;</span><span class="id"> rewrite</span><span class="id"> diff_val</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> differentiableB</span> (<span class="id">f</span><span class="id"> g</span><span class="id"> :</span><span class="id"> V</span><span class="id"> -&gt;</span><span class="id"> W</span>)<span class="id"> x</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">differentiable</span><span class="id"> f</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> differentiable</span><span class="id"> g</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> differentiable</span> (<span class="id">f</span><span class="id"> \-</span><span class="id"> g</span>)<span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> /differentiableP</span><span class="id"> df</span><span class="id"> /differentiableP</span><span class="id"> dg</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> diffZ</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> V</span><span class="id"> -&gt;</span><span class="id"> W</span>)<span class="id"> k</span><span class="id"> x</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">differentiable</span><span class="id"> f</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> 'd</span> (<span class="id">k</span><span class="id"> *:</span><span class="id"> f</span>)<span class="id"> x</span><span class="id"> =</span><span class="id"> k</span><span class="id"> \*:</span><span class="id"> 'd</span><span class="id"> f</span><span class="id"> x</span><span class="id"> :&gt;</span> (<span class="id">V</span><span class="id"> -&gt;</span><span class="id"> W</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> df;</span><span class="id"> apply/diff_unique;</span><span class="id"> have</span><span class="id"> []</span><span class="id"> :=</span><span class="id"> dscale</span><span class="id"> k</span><span class="id"> df</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> differentiableZ</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> V</span><span class="id"> -&gt;</span><span class="id"> W</span>)<span class="id"> k</span><span class="id"> x</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">differentiable</span><span class="id"> f</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> differentiable</span> (<span class="id">k</span><span class="id"> *:</span><span class="id"> f</span>)<span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> df;</span><span class="id"> apply/diff_locallyP;</span><span class="id"> rewrite</span><span class="id"> diffZ</span><span class="id"> //;</span><span class="id"> have</span><span class="id"> :=</span><span class="id"> dscale</span><span class="id"> k</span><span class="id"> df</span>.<br/>
Qed.</div></details>
<br/>
<span class="id">Global</span><span class="vernacular"> Instance</span><span class="id"> is_diffZ</span> (<span class="id">f</span><span class="id"> df</span><span class="id"> :</span><span class="id"> V</span><span class="id"> -&gt;</span><span class="id"> W</span>)<span class="id"> k</span><span class="id"> x</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">is_diff</span><span class="id"> x</span><span class="id"> f</span><span class="id"> df</span><span class="id"> -&gt;</span><span class="id"> is_diff</span><span class="id"> x</span> (<span class="id">k</span><span class="id"> *:</span><span class="id"> f</span>) (<span class="id">k</span><span class="id"> *:</span><span class="id"> df</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> dfx;</span><span class="id"> apply:</span><span class="id"> DiffDef;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> differentiableZ</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> diffZ</span><span class="id"> //</span><span class="id"> diff_val</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> diffZl</span> (<span class="id">k</span><span class="id"> :</span><span class="id"> V</span><span class="id"> -&gt;</span><span class="id"> R</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> W</span>)<span class="id"> x</span><span class="id"> :</span><span class="id"> differentiable</span><span class="id"> k</span><span class="id"> x</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">'d</span> (<span class="gallina-kwd">fun</span><span class="id"> z</span><span class="id"> =&gt;</span><span class="id"> k</span><span class="id"> z</span><span class="id"> *:</span><span class="id"> f</span>)<span class="id"> x</span><span class="id"> =</span> (<span class="gallina-kwd">fun</span><span class="id"> z</span><span class="id"> =&gt;</span><span class="id"> 'd</span><span class="id"> k</span><span class="id"> x</span><span class="id"> z</span><span class="id"> *:</span><span class="id"> f</span>)<span class="id"> :&gt;</span> (_<span class="id"> -&gt;</span><span class="id"> _</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> df;</span><span class="id"> set</span><span class="id"> g</span><span class="id"> :=</span><span class="id"> RHS;</span><span class="id"> have</span><span class="id"> glin</span><span class="id"> :</span><span class="id"> linear</span><span class="id"> g</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> a</span><span class="id"> u</span><span class="id"> v;</span><span class="id"> rewrite</span><span class="id"> /g</span><span class="id"> linearP</span><span class="id"> /=</span><span class="id"> scalerDl</span><span class="id"> -scalerA</span>.<br/>
<span class="id">pose</span><span class="id"> glM</span><span class="id"> :=</span><span class="id"> GRing</span>.<span class="id">isLinear</span>.<span class="id">Build</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> glin</span>.<br/>
<span class="id">pose</span><span class="id"> gL</span><span class="id"> :</span><span class="id"> {linear</span><span class="id"> _</span><span class="id"> -&gt;</span><span class="id"> _}</span><span class="id"> :=</span><span class="id"> HB</span>.<span class="id">pack</span><span class="id"> g</span><span class="id"> glM</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply:</span>(<span class="id">@diff_unique</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> gL</span>)<span class="id">;</span><span class="id"> have</span><span class="id"> []</span><span class="id"> :=</span><span class="id"> dscalel</span><span class="id"> f</span><span class="id"> df</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> differentiableZl</span> (<span class="id">k</span><span class="id"> :</span><span class="id"> V</span><span class="id"> -&gt;</span><span class="id"> R</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> W</span>)<span class="id"> x</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">differentiable</span><span class="id"> k</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> differentiable</span> (<span class="gallina-kwd">fun</span><span class="id"> z</span><span class="id"> =&gt;</span><span class="id"> k</span><span class="id"> z</span><span class="id"> *:</span><span class="id"> f</span>)<span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> df;</span><span class="id"> apply/diff_locallyP;</span><span class="id"> rewrite</span><span class="id"> diffZl</span><span class="id"> //;</span><span class="id"> have</span><span class="id"> []</span><span class="id"> :=</span><span class="id"> dscalel</span><span class="id"> f</span><span class="id"> df</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> diff_lin</span> (<span class="id">V'</span><span class="id"> W'</span><span class="id"> :</span><span class="id"> normedModType</span><span class="id"> R</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> {linear</span><span class="id"> V'</span><span class="id"> -&gt;</span><span class="id"> W'}</span>)<span class="id"> x</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">continuous</span><span class="id"> f</span><span class="id"> -&gt;</span><span class="id"> 'd</span><span class="id"> f</span><span class="id"> x</span><span class="id"> =</span><span class="id"> f</span><span class="id"> :&gt;</span> (<span class="id">V'</span><span class="id"> -&gt;</span><span class="id"> W'</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> fcont;</span><span class="id"> apply/diff_unique</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> apply:</span><span class="id"> dlin</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> linear_differentiable</span> (<span class="id">V'</span><span class="id"> W'</span><span class="id"> :</span><span class="id"> normedModType</span><span class="id"> R</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> {linear</span><span class="id"> V'</span><span class="id"> -&gt;</span><span class="id"> W'}</span>)<br/>
&nbsp;&nbsp;<span class="id">x</span><span class="id"> :</span><span class="id"> continuous</span><span class="id"> f</span><span class="id"> -&gt;</span><span class="id"> differentiable</span><span class="id"> f</span><span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> fcont;</span><span class="id"> apply/diff_locallyP;</span><span class="id"> rewrite</span><span class="id"> diff_lin</span><span class="id"> //;</span><span class="id"> have</span><span class="id"> :=</span><span class="id"> dlin</span><span class="id"> x</span><span class="id"> fcont</span>.<br/>
Qed.</div></details>
<br/>
<span class="id">Global</span><span class="vernacular"> Instance</span><span class="id"> is_diff_id</span> (<span class="id">x</span><span class="id"> :</span><span class="id"> V</span>)<span class="id"> :</span><span class="id"> is_diff</span><span class="id"> x</span><span class="id"> id</span><span class="id"> id</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">apply:</span><span class="id"> DiffDef</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span> (<span class="id">@linear_differentiable</span><span class="id"> _</span><span class="id"> _</span><span class="id"> idfun</span>)<span class="id"> =&gt;</span><span class="id"> ?</span><span class="id"> //</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span> (<span class="id">@diff_lin</span><span class="id"> _</span><span class="id"> _</span><span class="id"> idfun</span>)<span class="id"> //</span><span class="id"> =&gt;</span><span class="id"> ?</span><span class="id"> //</span>.<br/>
Qed.</div></details>
<br/>
<span class="id">Global</span><span class="vernacular"> Instance</span><span class="id"> is_diff_scaler</span> (<span class="id">k</span><span class="id"> :</span><span class="id"> R</span>) (<span class="id">x</span><span class="id"> :</span><span class="id"> V</span>)<span class="id"> :</span><span class="id"> is_diff</span><span class="id"> x</span> (<span class="id"> *:%R</span><span class="id"> k</span>) (<span class="id"> *:%R</span><span class="id"> k</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">apply:</span><span class="id"> DiffDef;</span><span class="id"> first</span><span class="id"> exact/linear_differentiable/scaler_continuous</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> diff_lin</span><span class="id"> //;</span><span class="id"> apply:</span><span class="id"> scaler_continuous</span>.<br/>
Qed.</div></details>
<br/>
<span class="id">Global</span><span class="vernacular"> Instance</span><span class="id"> is_diff_scalel</span> (<span class="id">k</span><span class="id"> :</span><span class="id"> R</span>) (<span class="id">x</span><span class="id"> :</span><span class="id"> V</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">is_diff</span><span class="id"> k</span> (<span class="id"> *:%R</span><span class="id"> ^~</span><span class="id"> x</span>) (<span class="id"> *:%R</span><span class="id"> ^~</span><span class="id"> x</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">have</span><span class="id"> sx_lin</span><span class="id"> :</span><span class="id"> linear</span> (<span class="id"> *:%R</span><span class="id"> ^~</span><span class="id"> x</span><span class="id"> :</span><span class="id"> [the</span><span class="id"> lmodType</span><span class="id"> R</span><span class="id"> of</span><span class="id"> R</span><span class="id"> :</span><span class="id"> Type]</span><span class="id"> -&gt;</span><span class="id"> _</span>).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> u</span><span class="id"> y</span><span class="id"> z;</span><span class="id"> rewrite</span><span class="id"> scalerDl</span><span class="id"> scalerA</span>.<br/>
<span class="id">pose</span><span class="id"> sxlM</span><span class="id"> :=</span><span class="id"> GRing</span>.<span class="id">isLinear</span>.<span class="id">Build</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> sx_lin</span>.<br/>
<span class="id">pose</span><span class="id"> sxL</span><span class="id"> :</span><span class="id"> {linear</span><span class="id"> _</span><span class="id"> -&gt;</span><span class="id"> _}</span><span class="id"> :=</span><span class="id"> HB</span>.<span class="id">pack</span> (<span class="id"> *:%R</span><span class="id"> ^~</span><span class="id"> x</span>)<span class="id"> sxlM</span>.<br/>
<span class="id">have</span><span class="id"> -&gt;</span><span class="id"> :</span><span class="id"> *:%R</span><span class="id"> ^~</span><span class="id"> x</span><span class="id"> =</span><span class="id"> sxL</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> funeqE</span>.<br/>
<span class="id">apply:</span><span class="id"> DiffDef;</span><span class="id"> first</span><span class="id"> exact/linear_differentiable/scalel_continuous</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> diff_lin</span><span class="id"> //;</span><span class="id"> apply:</span><span class="id"> scalel_continuous</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> differentiable_coord</span><span class="id"> m</span><span class="id"> n</span> (<span class="id">M</span><span class="id"> :</span><span class="id"> 'M[R]_</span>(<span class="id">m</span>.<span class="id">+1,</span><span class="id"> n</span>.<span class="id">+1</span>))<span class="id"> i</span><span class="id"> j</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">differentiable</span> (<span class="gallina-kwd">fun</span><span class="id"> N</span><span class="id"> :</span><span class="id"> 'M[R]_</span>(<span class="id">m</span>.<span class="id">+1,</span><span class="id"> n</span>.<span class="id">+1</span>)<span class="id"> =&gt;</span><span class="id"> N</span><span class="id"> i</span><span class="id"> j</span><span class="id"> :</span><span class="id"> R</span> )<span class="id"> M</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">have</span><span class="id"> @f</span><span class="id"> :</span><span class="id"> {linear</span><span class="id"> 'M[R]_</span>(<span class="id">m</span>.<span class="id">+1,</span><span class="id"> n</span>.<span class="id">+1</span>)<span class="id"> -&gt;</span><span class="id"> R}</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="gallina-kwd"> exists</span> (<span class="gallina-kwd">fun</span><span class="id"> N</span><span class="id"> :</span><span class="id"> 'M[R]_</span>(<span class="id">_,</span><span class="id"> _</span>)<span class="id"> =&gt;</span><span class="id"> N</span><span class="id"> i</span><span class="id"> j</span>)<span class="id">;</span><span class="id"> do</span><span class="id"> 2![eexists];</span><span class="id"> do</span><span class="id"> ?[constructor];</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> ?mxE//</span><span class="id"> =&gt;</span><span class="id"> ?</span><span class="id"> *;</span><span class="id"> rewrite</span><span class="id"> ?mxE//;</span><span class="id"> move=&gt;</span><span class="id"> ?;</span><span class="id"> rewrite</span><span class="id"> !mxE</span>.<br/>
<span class="id">rewrite</span> (_<span class="id"> :</span> (<span class="gallina-kwd">fun</span><span class="id"> _</span><span class="id"> =&gt;</span><span class="id"> _</span>)<span class="id"> =</span><span class="id"> f</span>)<span class="id"> //;</span><span class="id"> exact/linear_differentiable/coord_continuous</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> linear_lipschitz</span> (<span class="id">V'</span><span class="id"> W'</span><span class="id"> :</span><span class="id"> normedModType</span><span class="id"> R</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> {linear</span><span class="id"> V'</span><span class="id"> -&gt;</span><span class="id"> W'}</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">continuous</span><span class="id"> f</span><span class="id"> -&gt;</span><span class="gallina-kwd"> exists2</span><span class="id"> k,</span><span class="id"> k</span><span class="id"> &gt;</span><span class="id"> 0</span><span class="id"> &amp;</span><span class="gallina-kwd"> forall</span><span class="id"> x,</span><span class="id"> `|f</span><span class="id"> x|</span><span class="id"> &lt;=</span><span class="id"> k</span><span class="id"> *</span><span class="id"> `|x|</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> /</span>(_<span class="id"> 0</span>)<span class="id">;</span><span class="id"> rewrite</span><span class="id"> /continuous_at</span><span class="id"> linear0</span><span class="id"> =&gt;</span><span class="id"> /</span>(_<span class="id"> _</span> (<span class="id">nbhsx_ballx</span><span class="id"> _</span><span class="id"> _</span><span class="id"> ltr01</span>)).<br/>
<span class="id">move=&gt;</span><span class="id"> /nbhs_ballP</span><span class="id"> [_</span><span class="id"> /posnumP[e]</span><span class="id"> he];</span><span class="gallina-kwd"> exists</span> (<span class="id">2</span><span class="id"> /</span><span class="id"> e%:num</span>)<span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> x</span>.<br/>
<span class="id">have</span><span class="id"> [|xn0]</span><span class="id"> :=</span><span class="id"> real_le0P</span> (<span class="id">normr_real</span><span class="id"> x</span>).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> normr_le0</span><span class="id"> =&gt;</span><span class="id"> /eqP-&gt;;</span><span class="id"> rewrite</span><span class="id"> linear0</span><span class="id"> !normr0</span><span class="id"> mulr0</span>.<br/>
<span class="id">set</span><span class="id"> k</span><span class="id"> :=</span><span class="id"> 2</span><span class="id"> /</span><span class="id"> e%:num</span><span class="id"> *</span> (<span class="id">PosNum</span><span class="id"> xn0</span>)<span class="id">%:num</span>.<br/>
<span class="id">have</span><span class="id"> kn0</span><span class="id"> :</span><span class="id"> k</span><span class="id"> !=</span><span class="id"> 0</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> /k</span>.<br/>
<span class="id">have</span><span class="id"> abskgt0</span><span class="id"> :</span><span class="id"> `|k|</span><span class="id"> &gt;</span><span class="id"> 0</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> normr_gt0</span>.<br/>
<span class="id">rewrite</span><span class="id"> -[x</span><span class="gallina-kwd"> in</span><span class="id"> leLHS]</span>(<span class="id">scalerKV</span><span class="id"> kn0</span>)<span class="id"> linearZZ</span><span class="id"> normrZ</span><span class="id"> -ler_pdivlMl</span><span class="id"> //</span>.<br/>
<span class="id">suff</span><span class="id"> /he</span><span class="id"> :</span><span class="id"> ball</span><span class="id"> 0</span><span class="id"> e%:num</span> (<span class="id">k^-1</span><span class="id"> *:</span><span class="id"> x</span>).<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -ball_normE</span><span class="id"> /=</span><span class="id"> distrC</span><span class="id"> subr0</span><span class="id"> =&gt;</span><span class="id"> /ltW</span><span class="id"> /le_trans;</span><span class="id"> apply</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> ger0_norm</span><span class="id"> /k</span><span class="id"> //</span><span class="id"> mulVf</span>.<br/>
<span class="id">rewrite</span><span class="id"> -ball_normE</span><span class="id"> /=</span><span class="id"> distrC</span><span class="id"> subr0</span><span class="id"> normrZ</span>.<br/>
<span class="id">rewrite</span><span class="id"> normfV</span><span class="id"> ger0_norm</span><span class="id"> /k</span><span class="id"> //</span><span class="id"> invrM</span><span class="id"> ?unitfE</span><span class="id"> //</span><span class="id"> mulrAC</span><span class="id"> mulVf</span><span class="id"> //</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> invf_div</span><span class="id"> mul1r</span><span class="id"> [ltRHS]splitr;</span><span class="id"> apply:</span><span class="id"> ltr_pwDr</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> linear_eqO</span> (<span class="id">V'</span><span class="id"> W'</span><span class="id"> :</span><span class="id"> normedModType</span><span class="id"> R</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> {linear</span><span class="id"> V'</span><span class="id"> -&gt;</span><span class="id"> W'}</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">continuous</span><span class="id"> f</span><span class="id"> -&gt;</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> V'</span><span class="id"> -&gt;</span><span class="id"> W'</span>)<span class="id"> =O_</span><span class="id"> 0</span><span class="id"> id</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> /linear_lipschitz</span><span class="id"> [k</span><span class="id"> kgt0</span><span class="id"> flip];</span><span class="id"> apply/eqO_exP;</span><span class="gallina-kwd"> exists</span><span class="id"> k</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
<span class="id">exact:</span><span class="id"> filterE</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> diff_eqO</span> (<span class="id">V'</span><span class="id"> W'</span><span class="id"> :</span><span class="id"> normedModType</span><span class="id"> R</span>) (<span class="id">x</span><span class="id"> :</span><span class="id"> filter_on</span><span class="id"> V'</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> V'</span><span class="id"> -&gt;</span><span class="id"> W'</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">differentiable</span><span class="id"> f</span><span class="id"> x</span><span class="id"> -&gt;</span> (<span class="id">'d</span><span class="id"> f</span><span class="id"> x</span><span class="id"> :</span><span class="id"> V'</span><span class="id"> -&gt;</span><span class="id"> W'</span>)<span class="id"> =O_</span><span class="id"> 0</span><span class="id"> id</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> /diff_continuous</span><span class="id"> /linear_eqO;</span><span class="id"> apply</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> compOo_eqox</span> (<span class="id">U</span><span class="id"> V'</span><span class="id"> W'</span><span class="id"> :</span><span class="id"> normedModType</span><span class="id"> R</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> U</span><span class="id"> -&gt;</span><span class="id"> V'</span>) (<span class="id">g</span><span class="id"> :</span><span class="id"> V'</span><span class="id"> -&gt;</span><span class="id"> W'</span>)<span class="id"> x</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">[O_</span><span class="id"> 0</span><span class="id"> id</span><span class="id"> of</span><span class="id"> g]</span> (<span class="id">[o_</span><span class="id"> 0</span><span class="id"> id</span><span class="id"> of</span><span class="id"> f]</span><span class="id"> x</span>)<span class="id"> =o_</span>(<span class="id">x</span><span class="id"> \near</span><span class="id"> 0</span>)<span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> -[LHS]/</span>((_<span class="id"> \o</span><span class="id"> _</span>)<span class="id"> x</span>)<span class="id"> compOo_eqo</span>. Qed.</div></details>
<br/>
<span class="vernacular">Fact</span><span class="id"> dcomp</span> (<span class="id">U</span><span class="id"> V'</span><span class="id"> W'</span><span class="id"> :</span><span class="id"> normedModType</span><span class="id"> R</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> U</span><span class="id"> -&gt;</span><span class="id"> V'</span>) (<span class="id">g</span><span class="id"> :</span><span class="id"> V'</span><span class="id"> -&gt;</span><span class="id"> W'</span>)<span class="id"> x</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">differentiable</span><span class="id"> f</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> differentiable</span><span class="id"> g</span> (<span class="id">f</span><span class="id"> x</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">continuous</span> (<span class="id">'d</span><span class="id"> g</span> (<span class="id">f</span><span class="id"> x</span>)<span class="id"> \o</span><span class="id"> 'd</span><span class="id"> f</span><span class="id"> x</span>)<span class="id"> /\</span><span class="gallina-kwd"> forall</span><span class="id"> y,</span><br/>
&nbsp;&nbsp;<span class="id">g</span> (<span class="id">f</span> (<span class="id">y</span><span class="id"> +</span><span class="id"> x</span>))<span class="id"> =</span><span class="id"> g</span> (<span class="id">f</span><span class="id"> x</span>)<span class="id"> +</span> (<span class="id">'d</span><span class="id"> g</span> (<span class="id">f</span><span class="id"> x</span>)<span class="id"> \o</span><span class="id"> 'd</span><span class="id"> f</span><span class="id"> x</span>)<span class="id"> y</span><span class="id"> +o_</span>(<span class="id">y</span><span class="id"> \near</span><span class="id"> 0</span>)<span class="id"> y</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> df</span><span class="id"> dg;</span><span class="id"> split;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> ?;</span><span class="id"> apply:</span><span class="id"> continuous_comp</span>.<br/>
<span class="id">apply:</span><span class="id"> eqaddoEx</span><span class="id"> =&gt;</span><span class="id"> y;</span><span class="id"> rewrite</span><span class="id"> diff_locallyx//</span><span class="id"> -addrA</span><span class="id"> diff_locallyxC//</span><span class="id"> linearD</span>.<br/>
<span class="id">rewrite</span><span class="id"> addrA</span><span class="id"> -[LHS]addrA;</span><span class="id"> congr</span> (_<span class="id"> +</span><span class="id"> _</span><span class="id"> +</span><span class="id"> _</span>).<br/>
<span class="id">rewrite</span><span class="id"> diff_eqO</span><span class="id"> //</span><span class="id"> ['d</span><span class="id"> f</span><span class="id"> x</span><span class="id"> :</span><span class="id"> _</span><span class="id"> -&gt;</span><span class="id"> _]diff_eqO</span><span class="id"> //</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> {2}eqoO</span><span class="id"> addOx</span><span class="id"> compOo_eqox</span><span class="id"> compoO_eqox</span><span class="id"> addox</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> diff_comp</span> (<span class="id">U</span><span class="id"> V'</span><span class="id"> W'</span><span class="id"> :</span><span class="id"> normedModType</span><span class="id"> R</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> U</span><span class="id"> -&gt;</span><span class="id"> V'</span>) (<span class="id">g</span><span class="id"> :</span><span class="id"> V'</span><span class="id"> -&gt;</span><span class="id"> W'</span>)<span class="id"> x</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">differentiable</span><span class="id"> f</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> differentiable</span><span class="id"> g</span> (<span class="id">f</span><span class="id"> x</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">'d</span> (<span class="id">g</span><span class="id"> \o</span><span class="id"> f</span>)<span class="id"> x</span><span class="id"> =</span><span class="id"> 'd</span><span class="id"> g</span> (<span class="id">f</span><span class="id"> x</span>)<span class="id"> \o</span><span class="id"> 'd</span><span class="id"> f</span><span class="id"> x</span><span class="id"> :&gt;</span> (<span class="id">U</span><span class="id"> -&gt;</span><span class="id"> W'</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> df</span><span class="id"> dg;</span><span class="id"> apply/diff_unique;</span><span class="id"> have</span><span class="id"> [?</span><span class="id"> /funext]</span><span class="id"> :=</span><span class="id"> dcomp</span><span class="id"> df</span><span class="id"> dg</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> differentiable_comp</span> (<span class="id">U</span><span class="id"> V'</span><span class="id"> W'</span><span class="id"> :</span><span class="id"> normedModType</span><span class="id"> R</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> U</span><span class="id"> -&gt;</span><span class="id"> V'</span>)<br/>
&nbsp;&nbsp;(<span class="id">g</span><span class="id"> :</span><span class="id"> V'</span><span class="id"> -&gt;</span><span class="id"> W'</span>)<span class="id"> x</span><span class="id"> :</span><span class="id"> differentiable</span><span class="id"> f</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> differentiable</span><span class="id"> g</span> (<span class="id">f</span><span class="id"> x</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">differentiable</span> (<span class="id">g</span><span class="id"> \o</span><span class="id"> f</span>)<span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> df</span><span class="id"> dg;</span><span class="id"> apply/diff_locallyP;</span><span class="id"> rewrite</span><span class="id"> diff_comp</span><span class="id"> //;</span><br/>
<span class="gallina-kwd">by</span><span class="id"> have</span><span class="id"> [?</span><span class="id"> /funext]:=</span><span class="id"> dcomp</span><span class="id"> df</span><span class="id"> dg</span>.<br/>
Qed.</div></details>
<br/>
<span class="id">Global</span><span class="vernacular"> Instance</span><span class="id"> is_diff_comp</span> (<span class="id">U</span><span class="id"> V'</span><span class="id"> W'</span><span class="id"> :</span><span class="id"> normedModType</span><span class="id"> R</span>) (<span class="id">f</span><span class="id"> df</span><span class="id"> :</span><span class="id"> U</span><span class="id"> -&gt;</span><span class="id"> V'</span>)<br/>
&nbsp;&nbsp;(<span class="id">g</span><span class="id"> dg</span><span class="id"> :</span><span class="id"> V'</span><span class="id"> -&gt;</span><span class="id"> W'</span>)<span class="id"> x</span><span class="id"> :</span><span class="id"> is_diff</span><span class="id"> x</span><span class="id"> f</span><span class="id"> df</span><span class="id"> -&gt;</span><span class="id"> is_diff</span> (<span class="id">f</span><span class="id"> x</span>)<span class="id"> g</span><span class="id"> dg</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">is_diff</span><span class="id"> x</span> (<span class="id">g</span><span class="id"> \o</span><span class="id"> f</span>) (<span class="id">dg</span><span class="id"> \o</span><span class="id"> df</span>)<span class="id"> |</span><span class="id"> 99</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> dfx</span><span class="id"> dgfx;</span><span class="id"> apply:</span><span class="id"> DiffDef;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> differentiable_comp</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> diff_comp</span><span class="id"> //</span><span class="id"> !diff_val</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> bilinear_schwarz</span> (<span class="id">U</span><span class="id"> V'</span><span class="id"> W'</span><span class="id"> :</span><span class="id"> normedModType</span><span class="id"> R</span>)<br/>
&nbsp;&nbsp;(<span class="id">f</span><span class="id"> :</span><span class="id"> {bilinear</span><span class="id"> U</span><span class="id"> -&gt;</span><span class="id"> V'</span><span class="id"> -&gt;</span><span class="id"> W'}</span>)<span class="id"> :</span><span class="id"> continuous</span> (<span class="gallina-kwd">fun</span><span class="id"> p</span><span class="id"> =&gt;</span><span class="id"> f</span><span class="id"> p</span>.<span class="id">1</span><span class="id"> p</span>.<span class="id">2</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">exists2</span><span class="id"> k,</span><span class="id"> k</span><span class="id"> &gt;</span><span class="id"> 0</span><span class="id"> &amp;</span><span class="gallina-kwd"> forall</span><span class="id"> u</span><span class="id"> v,</span><span class="id"> `|f</span><span class="id"> u</span><span class="id"> v|</span><span class="id"> &lt;=</span><span class="id"> k</span><span class="id"> *</span><span class="id"> `|u|</span><span class="id"> *</span><span class="id"> `|v|</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> /</span>(_<span class="id"> 0</span>)<span class="id">;</span><span class="id"> rewrite</span><span class="id"> /continuous_at</span><span class="id"> linear0r</span><span class="id"> =&gt;</span><span class="id"> /</span>(_<span class="id"> _</span> (<span class="id">nbhsx_ballx</span><span class="id"> _</span><span class="id"> _</span><span class="id"> ltr01</span>)).<br/>
<span class="id">move=&gt;</span><span class="id"> /nbhs_ballP</span><span class="id"> [_</span><span class="id"> /posnumP[e]</span><span class="id"> he];</span><span class="gallina-kwd"> exists</span> ((<span class="id">2</span><span class="id"> /</span><span class="id"> e%:num</span>)<span class="id"> ^+2</span>)<span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> u</span><span class="id"> v</span>.<br/>
<span class="id">have</span><span class="id"> [|un0]</span><span class="id"> :=</span><span class="id"> real_le0P</span> (<span class="id">normr_real</span><span class="id"> u</span>).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> normr_le0</span><span class="id"> =&gt;</span><span class="id"> /eqP-&gt;;</span><span class="id"> rewrite</span><span class="id"> linear0l</span><span class="id"> !normr0</span><span class="id"> mulr0</span><span class="id"> mul0r</span>.<br/>
<span class="id">have</span><span class="id"> [|vn0]</span><span class="id"> :=</span><span class="id"> real_le0P</span> (<span class="id">normr_real</span><span class="id"> v</span>).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> normr_le0</span><span class="id"> =&gt;</span><span class="id"> /eqP-&gt;;</span><span class="id"> rewrite</span><span class="id"> linear0r</span><span class="id"> !normr0</span><span class="id"> mulr0</span>.<br/>
<span class="id">rewrite</span><span class="id"> -[`|u|]/</span>((<span class="id">PosNum</span><span class="id"> un0</span>)<span class="id">%:num</span>)<span class="id"> -[`|v|]/</span>((<span class="id">PosNum</span><span class="id"> vn0</span>)<span class="id">%:num</span>).<br/>
<span class="id">set</span><span class="id"> ku</span><span class="id"> :=</span><span class="id"> 2</span><span class="id"> /</span><span class="id"> e%:num</span><span class="id"> *</span> (<span class="id">PosNum</span><span class="id"> un0</span>)<span class="id">%:num</span>.<br/>
<span class="id">set</span><span class="id"> kv</span><span class="id"> :=</span><span class="id"> 2</span><span class="id"> /</span><span class="id"> e%:num</span><span class="id"> *</span> (<span class="id">PosNum</span><span class="id"> vn0</span>)<span class="id">%:num</span>.<br/>
<span class="id">rewrite</span><span class="id"> -[X</span><span class="gallina-kwd"> in</span><span class="id"> f</span><span class="id"> X]</span>(<span class="id">@scalerKV</span><span class="id"> _</span><span class="id"> _</span><span class="id"> ku</span>)<span class="id"> /ku</span><span class="id"> //</span><span class="id"> linearZl_LR</span><span class="id"> normrZ</span>.<br/>
<span class="id">rewrite</span><span class="id"> gtr0_norm</span><span class="id"> //</span><span class="id"> -ler_pdivlMl</span><span class="id"> //</span>.<br/>
<span class="id">rewrite</span><span class="id"> -[X</span><span class="gallina-kwd"> in</span><span class="id"> f</span><span class="id"> _</span><span class="id"> X]</span>(<span class="id">@scalerKV</span><span class="id"> _</span><span class="id"> _</span><span class="id"> kv</span>)<span class="id"> /kv</span><span class="id"> //</span><span class="id"> linearZr_LR</span><span class="id"> normrZ</span>.<br/>
<span class="id">rewrite</span><span class="id"> gtr0_norm</span><span class="id"> //</span><span class="id"> -ler_pdivlMl</span><span class="id"> //</span>.<br/>
<span class="id">suff</span><span class="id"> /he</span><span class="id"> :</span><span class="id"> ball</span><span class="id"> 0</span><span class="id"> e%:num</span> (<span class="id">ku^-1</span><span class="id"> *:</span><span class="id"> u,</span><span class="id"> kv^-1</span><span class="id"> *:</span><span class="id"> v</span>).<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -ball_normE</span><span class="id"> /=</span><span class="id"> distrC</span><span class="id"> subr0</span><span class="id"> =&gt;</span><span class="id"> /ltW</span><span class="id"> /le_trans;</span><span class="id"> apply</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> ler_pdivlMl</span><span class="id"> 1?pmulr_lgt0//</span><span class="id"> mulr1</span><span class="id"> ler_pdivlMl</span><span class="id"> 1?pmulr_lgt0//</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> mulrA</span><span class="id"> [ku</span><span class="id"> *</span><span class="id"> _]mulrAC</span><span class="id"> expr2</span>.<br/>
<span class="id">rewrite</span><span class="id"> -ball_normE</span><span class="id"> /=</span><span class="id"> distrC</span><span class="id"> subr0</span>.<br/>
<span class="id">have</span><span class="id"> -&gt;</span><span class="id"> :</span> (<span class="id">ku^-1</span><span class="id"> *:</span><span class="id"> u,</span><span class="id"> kv^-1</span><span class="id"> *:</span><span class="id"> v</span>)<span class="id"> =</span><br/>
&nbsp;&nbsp;(<span class="id">e%:num</span><span class="id"> /</span><span class="id"> 2</span>)<span class="id"> *:</span> ((<span class="id">PosNum</span><span class="id"> un0</span>)<span class="id">%:num</span><span class="id"> ^-1</span><span class="id"> *:</span><span class="id"> u,</span> (<span class="id">PosNum</span><span class="id"> vn0</span>)<span class="id">%:num</span><span class="id"> ^-1</span><span class="id"> *:</span><span class="id"> v</span>).<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> invrM</span><span class="id"> ?unitfE</span><span class="id"> //</span><span class="id"> [kv</span><span class="id"> ^-1]invrM</span><span class="id"> ?unitfE</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> mulrC</span><span class="id"> -[_</span><span class="id"> *:</span><span class="id"> u]scalerA</span><span class="id"> [X</span><span class="gallina-kwd"> in</span><span class="id"> X</span><span class="id"> *:</span><span class="id"> v]mulrC</span><span class="id"> -[_</span><span class="id"> *:</span><span class="id"> v]scalerA</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> invf_div</span>.<br/>
<span class="id">rewrite</span><span class="id"> normrZ</span><span class="id"> ger0_norm</span><span class="id"> //</span><span class="id"> -mulrA</span><span class="id"> gtr_pMr</span><span class="id"> //</span><span class="id"> ltr_pdivrMl</span><span class="id"> //</span><span class="id"> mulr1</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> prod_normE/=</span><span class="id"> !normrZ</span><span class="id"> !normfV</span><span class="id"> !normr_id</span><span class="id"> !mulVf</span><span class="id"> ?gt_eqF//</span><span class="id"> maxxx</span><span class="id"> ltr1n</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> bilinear_eqo</span> (<span class="id">U</span><span class="id"> V'</span><span class="id"> W'</span><span class="id"> :</span><span class="id"> normedModType</span><span class="id"> R</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> {bilinear</span><span class="id"> U</span><span class="id"> -&gt;</span><span class="id"> V'</span><span class="id"> -&gt;</span><span class="id"> W'}</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">continuous</span> (<span class="gallina-kwd">fun</span><span class="id"> p</span><span class="id"> =&gt;</span><span class="id"> f</span><span class="id"> p</span>.<span class="id">1</span><span class="id"> p</span>.<span class="id">2</span>)<span class="id"> -&gt;</span> (<span class="gallina-kwd">fun</span><span class="id"> p</span><span class="id"> =&gt;</span><span class="id"> f</span><span class="id"> p</span>.<span class="id">1</span><span class="id"> p</span>.<span class="id">2</span>)<span class="id"> =o_</span> (<span class="id">0</span><span class="id"> :</span><span class="id"> U</span><span class="id"> *</span><span class="id"> V'</span>)<span class="id"> id</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> fc;</span><span class="id"> have</span><span class="id"> [_</span><span class="id"> /posnumP[k]</span><span class="id"> fschwarz]</span><span class="id"> :=</span><span class="id"> bilinear_schwarz</span><span class="id"> fc</span>.<br/>
<span class="id">apply/eqoP=&gt;</span><span class="id"> _</span><span class="id"> /posnumP[e];</span><span class="id"> near=&gt;</span><span class="id"> x;</span><span class="id"> rewrite</span> (<span class="id">le_trans</span> (<span class="id">fschwarz</span><span class="id"> _</span><span class="id"> _</span>))<span class="id">//</span>.<br/>
<span class="id">rewrite</span><span class="id"> ler_pM</span><span class="id"> ?pmulr_rge0</span><span class="id"> //;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> num_le_max</span><span class="id"> /=</span><span class="id"> lexx</span><span class="id"> orbT</span>.<br/>
<span class="id">rewrite</span><span class="id"> -ler_pdivlMl</span><span class="id"> //</span>.<br/>
<span class="id">suff</span><span class="id"> :</span><span class="id"> `|x|</span><span class="id"> &lt;=</span><span class="id"> k%:num</span><span class="id"> ^-1</span><span class="id"> *</span><span class="id"> e%:num</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> le_trans;</span><span class="id"> rewrite</span><span class="id"> num_le_max</span><span class="id"> /=</span><span class="id"> lexx</span>.<br/>
<span class="id">near:</span><span class="id"> x;</span><span class="id"> rewrite</span><span class="id"> !near_simpl;</span><span class="id"> apply/nbhs_le_nbhs_norm</span>.<br/>
<span class="gallina-kwd">by</span><span class="gallina-kwd"> exists</span> (<span class="id">k%:num</span><span class="id"> ^-1</span><span class="id"> *</span><span class="id"> e%:num</span>)<span class="id"> =&gt;</span><span class="id"> //=</span><span class="id"> ?</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> /=</span><span class="id"> distrC</span><span class="id"> subr0</span><span class="id"> =&gt;</span><span class="id"> /ltW</span>.<br/>
<span class="id">Unshelve</span>.<span class="id"> all:</span><span class="gallina-kwd"> by</span><span class="id"> end_near</span>. Qed.</div></details>
<br/>
<span class="vernacular">Fact</span><span class="id"> dbilin</span> (<span class="id">U</span><span class="id"> V'</span><span class="id"> W'</span><span class="id"> :</span><span class="id"> normedModType</span><span class="id"> R</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> {bilinear</span><span class="id"> U</span><span class="id"> -&gt;</span><span class="id"> V'</span><span class="id"> -&gt;</span><span class="id"> W'}</span>)<span class="id"> p</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">continuous</span> (<span class="gallina-kwd">fun</span><span class="id"> p</span><span class="id"> =&gt;</span><span class="id"> f</span><span class="id"> p</span>.<span class="id">1</span><span class="id"> p</span>.<span class="id">2</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">continuous</span> (<span class="gallina-kwd">fun</span><span class="id"> q</span><span class="id"> =&gt;</span> (<span class="id">f</span><span class="id"> p</span>.<span class="id">1</span><span class="id"> q</span>.<span class="id">2</span><span class="id"> +</span><span class="id"> f</span><span class="id"> q</span>.<span class="id">1</span><span class="id"> p</span>.<span class="id">2</span>))<span class="id"> /\</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">fun</span><span class="id"> q</span><span class="id"> =&gt;</span><span class="id"> f</span><span class="id"> q</span>.<span class="id">1</span><span class="id"> q</span>.<span class="id">2</span>)<span class="id"> \o</span><span class="id"> shift</span><span class="id"> p</span><span class="id"> =</span><span class="id"> cst</span> (<span class="id">f</span><span class="id"> p</span>.<span class="id">1</span><span class="id"> p</span>.<span class="id">2</span>)<span class="id"> +</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="gallina-kwd">fun</span><span class="id"> q</span><span class="id"> =&gt;</span><span class="id"> f</span><span class="id"> p</span>.<span class="id">1</span><span class="id"> q</span>.<span class="id">2</span><span class="id"> +</span><span class="id"> f</span><span class="id"> q</span>.<span class="id">1</span><span class="id"> p</span>.<span class="id">2</span>)<span class="id"> +o_</span> (<span class="id">0</span><span class="id"> :</span><span class="id"> U</span><span class="id"> *</span><span class="id"> V'</span>)<span class="id"> id</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> fc;</span><span class="id"> split=&gt;</span><span class="id"> [q|]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span> (<span class="id">@continuousD</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span> (<span class="gallina-kwd">fun</span><span class="id"> q</span><span class="id"> =&gt;</span><span class="id"> f</span><span class="id"> p</span>.<span class="id">1</span><span class="id"> q</span>.<span class="id">2</span>) (<span class="gallina-kwd">fun</span><span class="id"> q</span><span class="id"> =&gt;</span><span class="id"> f</span><span class="id"> q</span>.<span class="id">1</span><span class="id"> p</span>.<span class="id">2</span>))<span class="id">;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> A</span><span class="id"> /</span>(<span class="id">fc</span> (_.<span class="id">1,</span><span class="id"> _</span>.<span class="id">2</span>))<span class="id"> /=</span><span class="id"> /nbhs_ballP</span><span class="id"> [_</span><span class="id"> /posnumP[e]</span><span class="id"> fpqe_A];</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply/nbhs_ballP;</span><span class="gallina-kwd"> exists</span><span class="id"> e%:num</span><span class="id"> =&gt;</span><span class="id"> //=</span><span class="id"> r</span><span class="id"> [?</span><span class="id"> ?];</span><span class="id"> exact:</span> (<span class="id">fpqe_A</span> (_.<span class="id">1,</span><span class="id"> _</span>.<span class="id">2</span>)).<br/>
<span class="id">apply/eqaddoE;</span><span class="id"> rewrite</span><span class="id"> funeqE</span><span class="id"> =&gt;</span><span class="id"> q</span><span class="id"> /=</span>.<br/>
<span class="id">rewrite</span><span class="id"> linearDl</span><span class="id"> !linearDr</span><span class="id"> addrA</span><span class="id"> addrC</span>.<br/>
<span class="id">rewrite</span><span class="id"> -[f</span><span class="id"> q</span>.<span class="id">1</span><span class="id"> _</span><span class="id"> +</span><span class="id"> _</span><span class="id"> +</span><span class="id"> _]addrA</span><span class="id"> [f</span><span class="id"> q</span>.<span class="id">1</span><span class="id"> _</span><span class="id"> +</span><span class="id"> _]addrC</span><span class="id"> addrA</span><span class="id"> [f</span><span class="id"> q</span>.<span class="id">1</span><span class="id"> _</span><span class="id"> +</span><span class="id"> _]addrC</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> congr</span> (_<span class="id"> +</span><span class="id"> _</span>)<span class="id">;</span><span class="id"> rewrite</span><span class="id"> -[LHS]/</span>((<span class="gallina-kwd">fun</span><span class="id"> p</span><span class="id"> =&gt;</span><span class="id"> f</span><span class="id"> p</span>.<span class="id">1</span><span class="id"> p</span>.<span class="id">2</span>)<span class="id"> q</span>)<span class="id"> bilinear_eqo</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> diff_bilin</span> (<span class="id">U</span><span class="id"> V'</span><span class="id"> W'</span><span class="id"> :</span><span class="id"> normedModType</span><span class="id"> R</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> {bilinear</span><span class="id"> U</span><span class="id"> -&gt;</span><span class="id"> V'</span><span class="id"> -&gt;</span><span class="id"> W'}</span>)<span class="id"> p</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">continuous</span> (<span class="gallina-kwd">fun</span><span class="id"> p</span><span class="id"> =&gt;</span><span class="id"> f</span><span class="id"> p</span>.<span class="id">1</span><span class="id"> p</span>.<span class="id">2</span>)<span class="id"> -&gt;</span><span class="id"> 'd</span> (<span class="gallina-kwd">fun</span><span class="id"> q</span><span class="id"> =&gt;</span><span class="id"> f</span><span class="id"> q</span>.<span class="id">1</span><span class="id"> q</span>.<span class="id">2</span>)<span class="id"> p</span><span class="id"> =</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">fun</span><span class="id"> q</span><span class="id"> =&gt;</span><span class="id"> f</span><span class="id"> p</span>.<span class="id">1</span><span class="id"> q</span>.<span class="id">2</span><span class="id"> +</span><span class="id"> f</span><span class="id"> q</span>.<span class="id">1</span><span class="id"> p</span>.<span class="id">2</span>)<span class="id"> :&gt;</span> (<span class="id">U</span><span class="id"> *</span><span class="id"> V'</span><span class="id"> -&gt;</span><span class="id"> W'</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">pose</span><span class="id"> d</span><span class="id"> q</span><span class="id"> :=</span><span class="id"> f</span><span class="id"> p</span>.<span class="id">1</span><span class="id"> q</span>.<span class="id">2</span><span class="id"> +</span><span class="id"> f</span><span class="id"> q</span>.<span class="id">1</span><span class="id"> p</span>.<span class="id">2</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> fc;</span><span class="id"> have</span><span class="id"> lind</span><span class="id"> :</span><span class="id"> linear</span><span class="id"> d</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> ?</span><span class="id"> ?</span><span class="id"> ?;</span><span class="id"> rewrite</span><span class="id"> /d</span><span class="id"> linearPr</span><span class="id"> linearPl</span><span class="id"> scalerDr</span><span class="id"> addrACA</span>.<br/>
<span class="id">pose</span><span class="id"> dlM</span><span class="id"> :=</span><span class="id"> GRing</span>.<span class="id">isLinear</span>.<span class="id">Build</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> lind</span>.<br/>
<span class="id">pose</span><span class="id"> dL</span><span class="id"> :</span><span class="id"> {linear</span><span class="id"> _</span><span class="id"> -&gt;</span><span class="id"> _}</span><span class="id"> :=</span><span class="id"> HB</span>.<span class="id">pack</span><span class="id"> d</span><span class="id"> dlM</span>.<br/>
<span class="id">rewrite</span><span class="id"> -/d</span><span class="id"> -[d]/</span>(<span class="id">dL</span><span class="id"> :</span><span class="id"> _</span><span class="id"> -&gt;</span><span class="id"> _</span>).<br/>
<span class="gallina-kwd">by</span><span class="id"> apply/diff_unique;</span><span class="id"> have</span><span class="id"> []</span><span class="id"> :=</span><span class="id"> dbilin</span><span class="id"> p</span><span class="id"> fc</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> differentiable_bilin</span> (<span class="id">U</span><span class="id"> V'</span><span class="id"> W'</span><span class="id"> :</span><span class="id"> normedModType</span><span class="id"> R</span>)<br/>
&nbsp;&nbsp;(<span class="id">f</span><span class="id"> :</span><span class="id"> {bilinear</span><span class="id"> U</span><span class="id"> -&gt;</span><span class="id"> V'</span><span class="id"> -&gt;</span><span class="id"> W'}</span>)<span class="id"> p</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">continuous</span> (<span class="gallina-kwd">fun</span><span class="id"> p</span><span class="id"> =&gt;</span><span class="id"> f</span><span class="id"> p</span>.<span class="id">1</span><span class="id"> p</span>.<span class="id">2</span>)<span class="id"> -&gt;</span><span class="id"> differentiable</span> (<span class="gallina-kwd">fun</span><span class="id"> p</span><span class="id"> =&gt;</span><span class="id"> f</span><span class="id"> p</span>.<span class="id">1</span><span class="id"> p</span>.<span class="id">2</span>)<span class="id"> p</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> fc;</span><span class="id"> apply/diff_locallyP;</span><span class="id"> rewrite</span><span class="id"> diff_bilin</span><span class="id"> //;</span><span class="id"> apply:</span><span class="id"> dbilin</span><span class="id"> p</span><span class="id"> fc</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> mulr_is_bilinear</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">bilinear_for</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">GRing</span>.<span class="id">Scale</span>.<span class="id">Law</span>.<span class="id">clone</span><span class="id"> _</span><span class="id"> _</span><span class="id"> *:%R</span><span class="id"> _</span>) (<span class="id">GRing</span>.<span class="id">Scale</span>.<span class="id">Law</span>.<span class="id">clone</span><span class="id"> _</span><span class="id"> _</span><span class="id"> *:%R</span><span class="id"> _</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">@GRing</span>.<span class="id">mul</span><span class="id"> R</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">split=&gt;</span><span class="id"> [u'|u]</span><span class="id"> a</span><span class="id"> x</span><span class="id"> y</span><span class="id"> /=</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> mulrDl</span><span class="id"> scalerAl</span>.<br/>
<span class="id">-</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> mulrDr</span><span class="id"> scalerAr</span>.<br/>
Qed.</div></details>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> bilinear_isBilinear</span>.<span class="id">Build</span><span class="id"> R</span><span class="id"> R</span><span class="id"> R</span><span class="id"> R</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">@GRing</span>.<span class="id">mul</span><span class="id"> R</span>)<br/>
&nbsp;&nbsp;<span class="id">mulr_is_bilinear</span>.<br/>
<br/>
<span class="id">Global</span><span class="vernacular"> Instance</span><span class="id"> is_diff_mulr</span> (<span class="id">p</span><span class="id"> :</span><span class="id"> R</span><span class="id"> *</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">is_diff</span><span class="id"> p</span> (<span class="gallina-kwd">fun</span><span class="id"> q</span><span class="id"> =&gt;</span><span class="id"> q</span>.<span class="id">1</span><span class="id"> *</span><span class="id"> q</span>.<span class="id">2</span>) (<span class="gallina-kwd">fun</span><span class="id"> q</span><span class="id"> =&gt;</span><span class="id"> p</span>.<span class="id">1</span><span class="id"> *</span><span class="id"> q</span>.<span class="id">2</span><span class="id"> +</span><span class="id"> q</span>.<span class="id">1</span><span class="id"> *</span><span class="id"> p</span>.<span class="id">2</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">apply:</span><span class="id"> DiffDef;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> diff_bilin</span><span class="id"> //</span><span class="id"> =&gt;</span><span class="id"> ?;</span><span class="id"> apply:</span><span class="id"> mul_continuous</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> differentiable_bilin</span><span class="id"> =&gt;?;</span><span class="id"> apply:</span><span class="id"> mul_continuous</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> eqo_pair</span> (<span class="id">U</span><span class="id"> V'</span><span class="id"> W'</span><span class="id"> :</span><span class="id"> normedModType</span><span class="id"> R</span>) (<span class="id">F</span><span class="id"> :</span><span class="id"> filter_on</span><span class="id"> U</span>)<br/>
&nbsp;&nbsp;(<span class="id">f</span><span class="id"> :</span><span class="id"> U</span><span class="id"> -&gt;</span><span class="id"> V'</span>) (<span class="id">g</span><span class="id"> :</span><span class="id"> U</span><span class="id"> -&gt;</span><span class="id"> W'</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">fun</span><span class="id"> t</span><span class="id"> =&gt;</span> (<span class="id">[o_F</span><span class="id"> id</span><span class="id"> of</span><span class="id"> f]</span><span class="id"> t,</span><span class="id"> [o_F</span><span class="id"> id</span><span class="id"> of</span><span class="id"> g]</span><span class="id"> t</span>))<span class="id"> =o_F</span><span class="id"> id</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">apply/eqoP</span><span class="id"> =&gt;</span><span class="id"> _/posnumP[e];</span><span class="id"> near=&gt;</span><span class="id"> x;</span><span class="id"> rewrite</span><span class="id"> num_ge_max</span><span class="id"> /=</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply/andP;</span><span class="id"> split;</span><span class="id"> near:</span><span class="id"> x;</span><span class="id"> apply:</span><span class="id"> littleoP</span>.<br/>
<span class="id">Unshelve</span>.<span class="id"> all:</span><span class="gallina-kwd"> by</span><span class="id"> end_near</span>. Qed.</div></details>
<br/>
<span class="vernacular">Fact</span><span class="id"> dpair</span> (<span class="id">U</span><span class="id"> V'</span><span class="id"> W'</span><span class="id"> :</span><span class="id"> normedModType</span><span class="id"> R</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> U</span><span class="id"> -&gt;</span><span class="id"> V'</span>) (<span class="id">g</span><span class="id"> :</span><span class="id"> U</span><span class="id"> -&gt;</span><span class="id"> W'</span>)<span class="id"> x</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">differentiable</span><span class="id"> f</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> differentiable</span><span class="id"> g</span><span class="id"> x</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">continuous</span> (<span class="gallina-kwd">fun</span><span class="id"> y</span><span class="id"> =&gt;</span> (<span class="id">'d</span><span class="id"> f</span><span class="id"> x</span><span class="id"> y,</span><span class="id"> 'd</span><span class="id"> g</span><span class="id"> x</span><span class="id"> y</span>))<span class="id"> /\</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">fun</span><span class="id"> y</span><span class="id"> =&gt;</span> (<span class="id">f</span><span class="id"> y,</span><span class="id"> g</span><span class="id"> y</span>))<span class="id"> \o</span><span class="id"> shift</span><span class="id"> x</span><span class="id"> =</span><span class="id"> cst</span> (<span class="id">f</span><span class="id"> x,</span><span class="id"> g</span><span class="id"> x</span>)<span class="id"> +</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">fun</span><span class="id"> y</span><span class="id"> =&gt;</span> (<span class="id">'d</span><span class="id"> f</span><span class="id"> x</span><span class="id"> y,</span><span class="id"> 'd</span><span class="id"> g</span><span class="id"> x</span><span class="id"> y</span>))<span class="id"> +o_</span><span class="id"> 0</span><span class="id"> id</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> df</span><span class="id"> dg;</span><span class="id"> split=&gt;</span><span class="id"> [?|];</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> cvg_pair;</span><span class="id"> apply:</span><span class="id"> diff_continuous</span>.<br/>
<span class="id">apply/eqaddoE;</span><span class="id"> rewrite</span><span class="id"> funeqE</span><span class="id"> =&gt;</span><span class="id"> y</span><span class="id"> /=</span>.<br/>
<span class="id">rewrite</span><span class="id"> ![_</span> (_<span class="id"> +</span><span class="id"> x</span>)<span class="id">]diff_locallyx//</span>.<br/>
<span class="comment">(*&nbsp;fixme&nbsp;*)</span><br/>
<span class="id">have</span><span class="id"> -&gt;</span><span class="id"> :</span><span class="gallina-kwd"> forall</span><span class="id"> h</span><span class="id"> e,</span> (<span class="id">f</span><span class="id"> x</span><span class="id"> +</span><span class="id"> 'd</span><span class="id"> f</span><span class="id"> x</span><span class="id"> y</span><span class="id"> +</span><span class="id"> [o_</span><span class="id"> 0</span><span class="id"> id</span><span class="id"> of</span><span class="id"> h]</span><span class="id"> y,</span><br/>
&nbsp;&nbsp;<span class="id">g</span><span class="id"> x</span><span class="id"> +</span><span class="id"> 'd</span><span class="id"> g</span><span class="id"> x</span><span class="id"> y</span><span class="id"> +</span><span class="id"> [o_</span><span class="id"> 0</span><span class="id"> id</span><span class="id"> of</span><span class="id"> e]</span><span class="id"> y</span>)<span class="id"> =</span><br/>
&nbsp;&nbsp;(<span class="id">f</span><span class="id"> x,</span><span class="id"> g</span><span class="id"> x</span>)<span class="id"> +</span> (<span class="id">'d</span><span class="id"> f</span><span class="id"> x</span><span class="id"> y,</span><span class="id"> 'd</span><span class="id"> g</span><span class="id"> x</span><span class="id"> y</span>)<span class="id"> +</span><br/>
&nbsp;&nbsp;(<span class="id">[o_</span><span class="id"> 0</span><span class="id"> id</span><span class="id"> of</span><span class="id"> h]</span><span class="id"> y,</span><span class="id"> [o_</span><span class="id"> 0id</span><span class="id"> of</span><span class="id"> e]</span><span class="id"> y</span>)<span class="gallina-kwd"> by</span><span class="id"> []</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> congr</span> (_<span class="id"> +</span><span class="id"> _</span>)<span class="id">;</span><span class="id"> rewrite</span><span class="id"> -[LHS]/</span>((<span class="gallina-kwd">fun</span><span class="id"> y</span><span class="id"> =&gt;</span> (_<span class="id"> y,</span><span class="id"> _</span><span class="id"> y</span>))<span class="id"> y</span>)<span class="id"> eqo_pair</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> diff_pair</span> (<span class="id">U</span><span class="id"> V'</span><span class="id"> W'</span><span class="id"> :</span><span class="id"> normedModType</span><span class="id"> R</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> U</span><span class="id"> -&gt;</span><span class="id"> V'</span>) (<span class="id">g</span><span class="id"> :</span><span class="id"> U</span><span class="id"> -&gt;</span><span class="id"> W'</span>)<span class="id"> x</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">differentiable</span><span class="id"> f</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> differentiable</span><span class="id"> g</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> 'd</span> (<span class="gallina-kwd">fun</span><span class="id"> y</span><span class="id"> =&gt;</span> (<span class="id">f</span><span class="id"> y,</span><span class="id"> g</span><span class="id"> y</span>))<span class="id"> x</span><span class="id"> =</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">fun</span><span class="id"> y</span><span class="id"> =&gt;</span> (<span class="id">'d</span><span class="id"> f</span><span class="id"> x</span><span class="id"> y,</span><span class="id"> 'd</span><span class="id"> g</span><span class="id"> x</span><span class="id"> y</span>))<span class="id"> :&gt;</span> (<span class="id">U</span><span class="id"> -&gt;</span><span class="id"> V'</span><span class="id"> *</span><span class="id"> W'</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> df</span><span class="id"> dg</span>.<br/>
<span class="id">pose</span><span class="id"> d</span><span class="id"> y</span><span class="id"> :=</span> (<span class="id">'d</span><span class="id"> f</span><span class="id"> x</span><span class="id"> y,</span><span class="id"> 'd</span><span class="id"> g</span><span class="id"> x</span><span class="id"> y</span>).<br/>
<span class="id">have</span><span class="id"> lin_pair</span><span class="id"> :</span><span class="id"> linear</span><span class="id"> d</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> ???;</span><span class="id"> rewrite</span><span class="id"> /d</span><span class="id"> !linearPZ</span>.<br/>
<span class="id">pose</span><span class="id"> pairlM</span><span class="id"> :=</span><span class="id"> GRing</span>.<span class="id">isLinear</span>.<span class="id">Build</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> lin_pair</span>.<br/>
<span class="id">pose</span><span class="id"> pairL</span><span class="id"> :</span><span class="id"> {linear</span><span class="id"> _</span><span class="id"> -&gt;</span><span class="id"> _}</span><span class="id"> :=</span><span class="id"> HB</span>.<span class="id">pack</span><span class="id"> d</span><span class="id"> pairlM</span>.<br/>
<span class="id">rewrite</span><span class="id"> -/d</span><span class="id"> -[d]/</span>(<span class="id">pairL</span><span class="id"> :</span><span class="id"> _</span><span class="id"> -&gt;</span><span class="id"> _</span>).<br/>
<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> diff_unique;</span><span class="id"> have</span><span class="id"> []</span><span class="id"> :=</span><span class="id"> dpair</span><span class="id"> df</span><span class="id"> dg</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> differentiable_pair</span> (<span class="id">U</span><span class="id"> V'</span><span class="id"> W'</span><span class="id"> :</span><span class="id"> normedModType</span><span class="id"> R</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> U</span><span class="id"> -&gt;</span><span class="id"> V'</span>)<br/>
&nbsp;&nbsp;(<span class="id">g</span><span class="id"> :</span><span class="id"> U</span><span class="id"> -&gt;</span><span class="id"> W'</span>)<span class="id"> x</span><span class="id"> :</span><span class="id"> differentiable</span><span class="id"> f</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> differentiable</span><span class="id"> g</span><span class="id"> x</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">differentiable</span> (<span class="gallina-kwd">fun</span><span class="id"> y</span><span class="id"> =&gt;</span> (<span class="id">f</span><span class="id"> y,</span><span class="id"> g</span><span class="id"> y</span>))<span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> df</span><span class="id"> dg;</span><span class="id"> apply/diff_locallyP;</span><span class="id"> rewrite</span><span class="id"> diff_pair</span><span class="id"> //;</span><span class="id"> apply:</span><span class="id"> dpair</span>.<br/>
Qed.</div></details>
<br/>
<span class="id">Global</span><span class="vernacular"> Instance</span><span class="id"> is_diff_pair</span> (<span class="id">U</span><span class="id"> V'</span><span class="id"> W'</span><span class="id"> :</span><span class="id"> normedModType</span><span class="id"> R</span>) (<span class="id">f</span><span class="id"> df</span><span class="id"> :</span><span class="id"> U</span><span class="id"> -&gt;</span><span class="id"> V'</span>)<br/>
&nbsp;&nbsp;(<span class="id">g</span><span class="id"> dg</span><span class="id"> :</span><span class="id"> U</span><span class="id"> -&gt;</span><span class="id"> W'</span>)<span class="id"> x</span><span class="id"> :</span><span class="id"> is_diff</span><span class="id"> x</span><span class="id"> f</span><span class="id"> df</span><span class="id"> -&gt;</span><span class="id"> is_diff</span><span class="id"> x</span><span class="id"> g</span><span class="id"> dg</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id">is_diff</span><span class="id"> x</span> (<span class="gallina-kwd">fun</span><span class="id"> y</span><span class="id"> =&gt;</span> (<span class="id">f</span><span class="id"> y,</span><span class="id"> g</span><span class="id"> y</span>)) (<span class="gallina-kwd">fun</span><span class="id"> y</span><span class="id"> =&gt;</span> (<span class="id">df</span><span class="id"> y,</span><span class="id"> dg</span><span class="id"> y</span>)).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> dfx</span><span class="id"> dgx;</span><span class="id"> apply:</span><span class="id"> DiffDef;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> differentiable_pair</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> diff_pair</span><span class="id"> //</span><span class="id"> !diff_val</span>.<br/>
Qed.</div></details>
<br/>
<span class="id">Global</span><span class="vernacular"> Instance</span><span class="id"> is_diffM</span> (<span class="id">f</span><span class="id"> g</span><span class="id"> df</span><span class="id"> dg</span><span class="id"> :</span><span class="id"> V</span><span class="id"> -&gt;</span><span class="id"> R</span>)<span class="id"> x</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">is_diff</span><span class="id"> x</span><span class="id"> f</span><span class="id"> df</span><span class="id"> -&gt;</span><span class="id"> is_diff</span><span class="id"> x</span><span class="id"> g</span><span class="id"> dg</span><span class="id"> -&gt;</span><span class="id"> is_diff</span><span class="id"> x</span> (<span class="id">f</span><span class="id"> *</span><span class="id"> g</span>) (<span class="id">f</span><span class="id"> x</span><span class="id"> *:</span><span class="id"> dg</span><span class="id"> +</span><span class="id"> g</span><span class="id"> x</span><span class="id"> *:</span><span class="id"> df</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> dfx</span><span class="id"> dgx</span>.<br/>
<span class="id">have</span><span class="id"> -&gt;</span><span class="id"> :</span><span class="id"> f</span><span class="id"> *</span><span class="id"> g</span><span class="id"> =</span> (<span class="gallina-kwd">fun</span><span class="id"> p</span><span class="id"> =&gt;</span><span class="id"> p</span>.<span class="id">1</span><span class="id"> *</span><span class="id"> p</span>.<span class="id">2</span>)<span class="id"> \o</span> (<span class="gallina-kwd">fun</span><span class="id"> y</span><span class="id"> =&gt;</span> (<span class="id">f</span><span class="id"> y,</span><span class="id"> g</span><span class="id"> y</span>))<span class="gallina-kwd"> by</span><span class="id"> []</span>.<br/>
<span class="id">apply:</span><span class="id"> is_diff_eq</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> funeqE</span><span class="id"> =&gt;</span><span class="id"> ?;</span><span class="id"> rewrite</span><span class="id"> /=</span><span class="id"> [_</span><span class="id"> *</span><span class="id"> g</span><span class="id"> _]mulrC</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> diffM</span> (<span class="id">f</span><span class="id"> g</span><span class="id"> :</span><span class="id"> V</span><span class="id"> -&gt;</span><span class="id"> R</span>)<span class="id"> x</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">differentiable</span><span class="id"> f</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> differentiable</span><span class="id"> g</span><span class="id"> x</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">'d</span> (<span class="id">f</span><span class="id"> *</span><span class="id"> g</span>)<span class="id"> x</span><span class="id"> =</span><span class="id"> f</span><span class="id"> x</span><span class="id"> \*:</span><span class="id"> 'd</span><span class="id"> g</span><span class="id"> x</span><span class="id"> +</span><span class="id"> g</span><span class="id"> x</span><span class="id"> \*:</span><span class="id"> 'd</span><span class="id"> f</span><span class="id"> x</span><span class="id"> :&gt;</span> (<span class="id">V</span><span class="id"> -&gt;</span><span class="id"> R</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> /differentiableP</span><span class="id"> df</span><span class="id"> /differentiableP</span><span class="id"> dg;</span><span class="id"> rewrite</span><span class="id"> diff_val</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> differentiableM</span> (<span class="id">f</span><span class="id"> g</span><span class="id"> :</span><span class="id"> V</span><span class="id"> -&gt;</span><span class="id"> R</span>)<span class="id"> x</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">differentiable</span><span class="id"> f</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> differentiable</span><span class="id"> g</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> differentiable</span> (<span class="id">f</span><span class="id"> *</span><span class="id"> g</span>)<span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> /differentiableP</span><span class="id"> df</span><span class="id"> /differentiableP</span><span class="id"> dg</span>. Qed.</div></details>
<br/>
<span class="vernacular">Fact</span><span class="id"> dinv</span> (<span class="id">x</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">x</span><span class="id"> !=</span><span class="id"> 0</span><span class="id"> -&gt;</span><span class="id"> continuous</span> (<span class="gallina-kwd">fun</span><span class="id"> h</span><span class="id"> :</span><span class="id"> R</span><span class="id"> =&gt;</span><span class="id"> -</span><span class="id"> x</span><span class="id"> ^-</span><span class="id"> 2</span><span class="id"> *:</span><span class="id"> h</span>)<span class="id"> /\</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> x^-1</span>)<span class="id">%R</span><span class="id"> \o</span><span class="id"> shift</span><span class="id"> x</span><span class="id"> =</span><span class="id"> cst</span> (<span class="id">x^-1</span>)<span class="id">%R</span><span class="id"> +</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">fun</span><span class="id"> h</span><span class="id"> :</span><span class="id"> R</span><span class="id"> =&gt;</span><span class="id"> -</span><span class="id"> x</span><span class="id"> ^-</span><span class="id"> 2</span><span class="id"> *:</span><span class="id"> h</span>)<span class="id"> +o_</span><span class="id"> 0</span><span class="id"> id</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> xn0;</span><span class="id"> suff:</span><span class="id"> continuous</span> (<span class="gallina-kwd">fun</span><span class="id"> h</span><span class="id"> :</span><span class="id"> R</span><span class="id"> =&gt;</span><span class="id"> -</span> (<span class="id">1</span><span class="id"> /</span><span class="id"> x</span>)<span class="id"> ^+</span><span class="id"> 2</span><span class="id"> *:</span><span class="id"> h</span>)<span class="id"> /\</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> 1</span><span class="id"> /</span><span class="id"> x</span> )<span class="id"> \o</span><span class="id"> shift</span><span class="id"> x</span><span class="id"> =</span><span class="id"> cst</span> (<span class="id">1</span><span class="id"> /</span><span class="id"> x</span>)<span class="id"> +</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">fun</span><span class="id"> h</span><span class="id"> :</span><span class="id"> R</span><span class="id"> =&gt;</span><span class="id"> -</span> (<span class="id">1</span><span class="id"> /</span><span class="id"> x</span>)<span class="id"> ^+</span><span class="id"> 2</span><span class="id"> *:</span><span class="id"> h</span>)<span class="id"> +o_</span><span class="id"> 0</span><span class="id"> id</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> !mul1r</span><span class="id"> !GRing</span>.<span class="id">exprVn</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span> (_<span class="id"> :</span> (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> x^-1</span>)<span class="id"> =</span>  (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> 1</span><span class="id"> /</span><span class="id"> x</span> ))<span class="id">//</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> funeqE</span><span class="id"> =&gt;</span><span class="id"> y;</span><span class="id"> rewrite</span><span class="id"> mul1r</span>.<br/>
<span class="id">split;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> ?;</span><span class="id"> apply:</span><span class="id"> continuousZr</span>.<br/>
<span class="id">apply/eqaddoP</span><span class="id"> =&gt;</span><span class="id"> _</span><span class="id"> /posnumP[e];</span><span class="id"> near=&gt;</span><span class="id"> h</span>.<br/>
<span class="id">rewrite</span><span class="id"> -[</span>(_<span class="id"> +</span><span class="id"> _</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> R</span>)<span class="id"> h]/</span>(_<span class="id"> +</span><span class="id"> _</span>)<span class="id"> -[</span>(<span class="id">-</span><span class="id"> _</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> R</span>)<span class="id"> h]/</span>(<span class="id">-</span><span class="id"> _</span>)<span class="id"> /=</span>.<br/>
<span class="id">rewrite</span><span class="id"> opprD</span><span class="id"> scaleNr</span><span class="id"> opprK</span><span class="id"> /cst</span><span class="id"> /=</span>.<br/>
<span class="id">rewrite</span><span class="id"> -[-</span><span class="id"> _]mulr1</span><span class="id"> -[X</span><span class="gallina-kwd"> in</span><span class="id"> -</span><span class="id"> _</span><span class="id"> *</span><span class="id"> X]</span>(<span class="id">mulfVK</span><span class="id"> xn0</span>)<span class="id"> mulrA</span><span class="id"> mulNr</span><span class="id"> -expr2</span><span class="id"> mulNr</span>.<br/>
<span class="id">rewrite</span><span class="id"> [-</span><span class="id"> _</span><span class="id"> +</span><span class="id"> _]addrC</span><span class="id"> -mulrBr</span>.<br/>
<span class="id">rewrite</span><span class="id"> -[X</span><span class="gallina-kwd"> in</span><span class="id"> X</span><span class="id"> +</span><span class="id"> _]mulr1</span><span class="id"> -[X</span><span class="gallina-kwd"> in</span><span class="id"> 1</span><span class="id"> /</span><span class="id"> _</span><span class="id"> *</span><span class="id"> X]</span>(<span class="id">@mulfVK</span><span class="id"> _</span> (<span class="id">x</span><span class="id"> ^+</span><span class="id"> 2</span>))<span class="id">;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> sqrf_eq0</span>.<br/>
<span class="id">rewrite</span><span class="id"> mulrA</span><span class="id"> mulf_div</span><span class="id"> mulr1</span>.<br/>
<span class="id">have</span><span class="id"> hDx_neq0</span><span class="id"> :</span><span class="id"> h</span><span class="id"> +</span><span class="id"> x</span><span class="id"> !=</span><span class="id"> 0</span>.<br/>
&nbsp;&nbsp;<span class="id">near:</span><span class="id"> h;</span><span class="id"> rewrite</span><span class="id"> !nbhs_simpl;</span><span class="id"> apply/nbhs_normP</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">exists</span><span class="id"> `|x|;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> /=</span><span class="id"> normr_gt0</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> h</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> /=</span><span class="id"> distrC</span><span class="id"> subr0</span><span class="id"> -subr_gt0</span><span class="id"> =&gt;</span><span class="id"> lthx</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -</span>(<span class="id">normr_gt0</span> (<span class="id">h</span><span class="id"> +</span><span class="id"> x</span>))<span class="id"> addrC</span><span class="id"> -[h]opprK</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> lt_le_trans</span> (<span class="id">ler_dist_dist</span><span class="id"> _</span><span class="id"> _</span>).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> ger0_norm</span><span class="id"> normrN</span><span class="id"> //;</span><span class="id"> apply:</span><span class="id"> ltW</span>.<br/>
<span class="id">rewrite</span><span class="id"> addrC</span><span class="id"> -[X</span><span class="gallina-kwd"> in</span><span class="id"> X</span><span class="id"> *</span><span class="id"> _]mulr1</span><span class="id"> -{2}[1]</span>(<span class="id">@mulfVK</span><span class="id"> _</span> (<span class="id">h</span><span class="id"> +</span><span class="id"> x</span>))<span class="id"> //</span>.<br/>
<span class="id">rewrite</span><span class="id"> mulrA</span><span class="id"> expr_div_n</span><span class="id"> expr1n</span><span class="id"> mulf_div</span><span class="id"> mulr1</span><span class="id"> [_</span><span class="id"> ^+</span><span class="id"> 2</span><span class="id"> *</span><span class="id"> _]mulrC</span><span class="id"> -mulrA</span>.<br/>
<span class="id">rewrite</span><span class="id"> -mulrDr</span><span class="id"> mulrBr</span><span class="id"> [1</span><span class="id"> /</span><span class="id"> _</span><span class="id"> *</span><span class="id"> _]mulrC</span><span class="id"> normrM</span>.<br/>
<span class="id">rewrite</span><span class="id"> mulrDl</span><span class="id"> mulrDl</span><span class="id"> opprD</span><span class="id"> addrACA</span><span class="id"> addrA</span><span class="id"> [x</span><span class="id"> *</span><span class="id"> _]mulrC</span><span class="id"> expr2</span><span class="id"> 2!subrK</span>.<br/>
<span class="id">rewrite</span><span class="id"> div1r</span><span class="id"> normfV</span><span class="id"> [X</span><span class="gallina-kwd"> in</span><span class="id"> _</span><span class="id"> /</span><span class="id"> X]normrM</span><span class="id"> invfM</span><span class="id"> [X</span><span class="gallina-kwd"> in</span><span class="id"> _</span><span class="id"> *</span><span class="id"> X]mulrC</span>.<br/>
<span class="id">rewrite</span><span class="id"> mulrA</span><span class="id"> mulrAC</span><span class="id"> ler_pdivrMr</span><span class="id"> ?normr_gt0</span><span class="id"> ?mulf_neq0</span><span class="id"> //</span>.<br/>
<span class="id">rewrite</span><span class="id"> mulrAC</span><span class="id"> ler_pdivrMr</span><span class="id"> ?normr_gt0</span><span class="id"> //</span>.<br/>
<span class="id">have</span><span class="id"> :</span><span class="id"> `|h</span><span class="id"> *</span><span class="id"> h|</span><span class="id"> &lt;=</span><span class="id"> `|x</span><span class="id"> /</span><span class="id"> 2|</span><span class="id"> *</span> (<span class="id">e%:num</span><span class="id"> *</span><span class="id"> `|x</span><span class="id"> *</span><span class="id"> x|</span><span class="id"> *</span><span class="id"> `|h|</span>).<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> !mulrA;</span><span class="id"> near:</span><span class="id"> h;</span><span class="gallina-kwd"> exists</span> (<span class="id">`|x</span><span class="id"> /</span><span class="id"> 2|</span><span class="id"> *</span><span class="id"> e%:num</span><span class="id"> *</span><span class="id"> `|x</span><span class="id"> *</span><span class="id"> x|</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /=</span><span class="id"> !pmulr_rgt0</span><span class="id"> //</span><span class="id"> normr_gt0</span><span class="id"> mulf_neq0</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> h</span><span class="id"> /ltW;</span><span class="id"> rewrite</span><span class="id"> distrC</span><span class="id"> subr0</span><span class="id"> [`|h</span><span class="id"> *</span><span class="id"> _|]normrM</span><span class="id"> =&gt;</span><span class="id"> /ler_pM;</span><span class="id"> apply</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> /le_trans</span><span class="id"> -&gt;</span><span class="id"> //;</span><span class="id"> rewrite</span><span class="id"> [leLHS]mulrC</span><span class="id"> ler_pM</span><span class="id"> ?mulr_ge0</span><span class="id"> //</span>.<br/>
<span class="id">near:</span><span class="id"> h;</span><span class="gallina-kwd"> exists</span> (<span class="id">`|x|</span><span class="id"> /</span><span class="id"> 2</span>)<span class="id">;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> /=</span><span class="id"> divr_gt0</span><span class="id"> ?normr_gt0</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> h;</span><span class="id"> rewrite</span><span class="id"> /=</span><span class="id"> distrC</span><span class="id"> subr0</span><span class="id"> =&gt;</span><span class="id"> lthhx;</span><span class="id"> rewrite</span><span class="id"> addrC</span><span class="id"> -[h]opprK</span>.<br/>
<span class="id">apply:</span><span class="id"> le_trans</span> (<span class="id">@ler_dist_dist</span> <span class="id"> _</span><span class="id"> R</span> <span class="id"> _</span><span class="id"> _</span>).<br/>
<span class="id">rewrite</span><span class="id"> normrN</span><span class="id"> [leRHS]ger0_norm;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> subr_ge0;</span><span class="id"> apply:</span><span class="id"> ltW;</span><span class="id"> apply:</span><span class="id"> lt_le_trans</span><span class="id"> lthhx</span><span class="id"> _</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> ler_pdivrMr</span><span class="id"> //</span><span class="id"> -{1}</span>(<span class="id">mulr1</span><span class="id"> `|x|</span>)<span class="id"> ler_pM</span><span class="id"> //</span><span class="id"> ler1n</span>.<br/>
<span class="id">rewrite</span><span class="id"> lerBrDr</span><span class="id"> -lerBrDl</span> (<span class="id">splitr</span><span class="id"> `|x|</span>).<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> normrM</span><span class="id"> normfV</span> (<span class="id">@ger0_norm</span><span class="id"> _</span><span class="id"> 2</span>)<span class="id"> //</span><span class="id"> addrK;</span><span class="id"> apply/ltW</span>.<br/>
<span class="id">Unshelve</span>.<span class="id"> all:</span><span class="gallina-kwd"> by</span><span class="id"> end_near</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> diff_Rinv</span> (<span class="id">x</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span><span class="id"> x</span><span class="id"> !=</span><span class="id"> 0</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">'d</span><span class="id"> GRing</span>.<span class="id">inv</span><span class="id"> x</span><span class="id"> =</span> (<span class="gallina-kwd">fun</span><span class="id"> h</span><span class="id"> :</span><span class="id"> R</span><span class="id"> =&gt;</span><span class="id"> -</span><span class="id"> x</span><span class="id"> ^-</span><span class="id"> 2</span><span class="id"> *:</span><span class="id"> h</span>)<span class="id"> :&gt;</span> (<span class="id">R</span><span class="id"> -&gt;</span><span class="id"> R</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> xn0;</span><span class="id"> have</span><span class="id"> -&gt;</span><span class="id"> :</span> (<span class="gallina-kwd">fun</span><span class="id"> h</span><span class="id"> :</span><span class="id"> R</span><span class="id"> =&gt;</span><span class="id"> -</span><span class="id"> x</span><span class="id"> ^-</span><span class="id"> 2</span><span class="id"> *:</span><span class="id"> h</span>)<span class="id"> =</span> (<span class="id"> *:%R</span> (<span class="id">-</span><span class="id"> x</span><span class="id"> ^-</span><span class="id"> 2</span>))<span class="gallina-kwd"> by</span><span class="id"> []</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> diff_unique;</span><span class="id"> have</span><span class="id"> []</span><span class="id"> :=</span><span class="id"> dinv</span><span class="id"> xn0</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> differentiable_Rinv</span> (<span class="id">x</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span><span class="id"> x</span><span class="id"> !=</span><span class="id"> 0</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">differentiable</span> (<span class="id">GRing</span>.<span class="id">inv</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> R</span>)<span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> xn0;</span><span class="id"> apply/diff_locallyP;</span><span class="id"> rewrite</span><span class="id"> diff_Rinv</span><span class="id"> //;</span><span class="id"> apply:</span><span class="id"> dinv</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> diffV</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> V</span><span class="id"> -&gt;</span><span class="id"> R</span>)<span class="id"> x</span><span class="id"> :</span><span class="id"> differentiable</span><span class="id"> f</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> f</span><span class="id"> x</span><span class="id"> !=</span><span class="id"> 0</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">'d</span> (<span class="gallina-kwd">fun</span><span class="id"> y</span><span class="id"> =&gt;</span> (<span class="id">f</span><span class="id"> y</span>)<span class="id">^-1</span>)<span class="id"> x</span><span class="id"> =</span><span class="id"> -</span> (<span class="id">f</span><span class="id"> x</span>)<span class="id"> ^-</span><span class="id"> 2</span><span class="id"> \*:</span><span class="id"> 'd</span><span class="id"> f</span><span class="id"> x</span><span class="id"> :&gt;</span> (<span class="id">V</span><span class="id"> -&gt;</span><span class="id"> R</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> df</span><span class="id"> fxn0</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> [LHS]</span>(<span class="id">diff_comp</span><span class="id"> df</span> (<span class="id">differentiable_Rinv</span><span class="id"> fxn0</span>))<span class="id"> diff_Rinv</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> differentiableV</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> V</span><span class="id"> -&gt;</span><span class="id"> R</span>)<span class="id"> x</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">differentiable</span><span class="id"> f</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> f</span><span class="id"> x</span><span class="id"> !=</span><span class="id"> 0</span><span class="id"> -&gt;</span><span class="id"> differentiable</span> (<span class="gallina-kwd">fun</span><span class="id"> y</span><span class="id"> =&gt;</span> (<span class="id">f</span><span class="id"> y</span>)<span class="id">^-1</span>)<span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> df</span><span class="id"> fxn0;</span><span class="id"> apply:</span><span class="id"> differentiable_comp</span><span class="id"> _</span> (<span class="id">differentiable_Rinv</span><span class="id"> fxn0</span>).<br/>
Qed.</div></details>
<br/>
<span class="id">Global</span><span class="vernacular"> Instance</span><span class="id"> is_diffX</span> (<span class="id">f</span><span class="id"> df</span><span class="id"> :</span><span class="id"> V</span><span class="id"> -&gt;</span><span class="id"> R</span>)<span class="id"> n</span><span class="id"> x</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">is_diff</span><span class="id"> x</span><span class="id"> f</span><span class="id"> df</span><span class="id"> -&gt;</span><span class="id"> is_diff</span><span class="id"> x</span> (<span class="id">f</span><span class="id"> ^+</span><span class="id"> n</span>.<span class="id">+1</span>) (<span class="id">n</span>.<span class="id">+1%:R</span><span class="id"> *</span><span class="id"> f</span><span class="id"> x</span><span class="id"> ^+</span><span class="id"> n</span><span class="id"> *:</span><span class="id"> df</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> dfx;</span><span class="id"> elim:</span><span class="id"> n</span><span class="id"> =&gt;</span><span class="id"> [|n</span><span class="id"> ihn];</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> expr1</span><span class="id"> expr0</span><span class="id"> mulr1</span><span class="id"> scale1r</span>.<br/>
<span class="id">rewrite</span><span class="id"> exprS;</span><span class="id"> apply:</span><span class="id"> is_diff_eq</span>.<br/>
<span class="id">rewrite</span><span class="id"> scalerA</span><span class="id"> mulrCA</span><span class="id"> -exprS</span><span class="id"> -scalerDl</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> [in</span><span class="id"> LHS]mulr_natl</span><span class="id"> exprfctE</span><span class="id"> -mulrSr</span><span class="id"> mulr_natl</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> differentiableX</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> V</span><span class="id"> -&gt;</span><span class="id"> R</span>)<span class="id"> n</span><span class="id"> x</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">differentiable</span><span class="id"> f</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> differentiable</span> (<span class="id">f</span><span class="id"> ^+</span><span class="id"> n</span>.<span class="id">+1</span>)<span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> /differentiableP</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> diffX</span> (<span class="id">f</span><span class="id"> :</span><span class="id"> V</span><span class="id"> -&gt;</span><span class="id"> R</span>)<span class="id"> n</span><span class="id"> x</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">differentiable</span><span class="id"> f</span><span class="id"> x</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">'d</span> (<span class="id">f</span><span class="id"> ^+</span><span class="id"> n</span>.<span class="id">+1</span>)<span class="id"> x</span><span class="id"> =</span><span class="id"> n</span>.<span class="id">+1%:R</span><span class="id"> *</span><span class="id"> f</span><span class="id"> x</span><span class="id"> ^+</span><span class="id"> n</span><span class="id"> \*:</span><span class="id"> 'd</span><span class="id"> f</span><span class="id"> x</span><span class="id"> :&gt;</span> (<span class="id">V</span><span class="id"> -&gt;</span><span class="id"> R</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> /differentiableP</span><span class="id"> df;</span><span class="id"> rewrite</span><span class="id"> diff_val</span>. Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> DifferentialR3_numFieldType</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> DeriveRU</span>.<br/>
<span class="vernacular">Variables</span> (<span class="id">R</span><span class="id"> :</span><span class="id"> numFieldType</span>) (<span class="id">U</span><span class="id"> :</span><span class="id"> normedModType</span><span class="id"> R</span>).<br/>
<span class="vernacular">Implicit</span><span class="id"> Types</span><span class="id"> f</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> U</span>.<br/>
<br/>
<span class="vernacular">Let</span><span class="id"> der1</span><span class="id"> f</span><span class="id"> x</span><span class="id"> :</span><span class="id"> derivable</span><span class="id"> f</span><span class="id"> x</span><span class="id"> 1</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">f</span><span class="id"> \o</span><span class="id"> shift</span><span class="id"> x</span><span class="id"> =</span><span class="id"> cst</span> (<span class="id">f</span><span class="id"> x</span>)<span class="id"> +</span> (<span class="id"> *:%R^~</span> (<span class="id">f^`</span>()<span class="id"> x</span>))<span class="id"> +o_</span><span class="id"> 0</span><span class="id"> id</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> df;</span><span class="id"> apply/eqaddoE;</span><span class="id"> have</span><span class="id"> /derivable_nbhsP</span><span class="id"> :=</span><span class="id"> df</span>.<br/>
<span class="id">have</span><span class="id"> -&gt;</span><span class="id"> :</span> (<span class="gallina-kwd">fun</span><span class="id"> h</span><span class="id"> =&gt;</span> (<span class="id">f</span><span class="id"> \o</span><span class="id"> shift</span><span class="id"> x</span>)<span class="id"> h%:A</span>)<span class="id"> =</span><span class="id"> f</span><span class="id"> \o</span><span class="id"> shift</span><span class="id"> x</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> funeqE=&gt;</span><span class="id"> ?;</span><span class="id"> rewrite</span><span class="id"> [_%:A]mulr1</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> derive1E</span><span class="id"> =&gt;-&gt;</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> deriv1E</span><span class="id"> f</span><span class="id"> x</span><span class="id"> :</span><span class="id"> derivable</span><span class="id"> f</span><span class="id"> x</span><span class="id"> 1</span><span class="id"> -&gt;</span><span class="id"> 'd</span><span class="id"> f</span><span class="id"> x</span><span class="id"> =</span> (<span class="id"> *:%R^~</span> (<span class="id">f^`</span>()<span class="id"> x</span>))<span class="id"> :&gt;</span> (<span class="id">R</span><span class="id"> -&gt;</span><span class="id"> U</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">pose</span><span class="id"> d</span> (<span class="id">h</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :=</span><span class="id"> h</span><span class="id"> *:</span><span class="id"> f^`</span>()<span class="id"> x</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> df;</span><span class="id"> have</span><span class="id"> lin_scal</span><span class="id"> :</span><span class="id"> linear</span><span class="id"> d</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> ???;</span><span class="id"> rewrite</span><span class="id"> /d</span><span class="id"> scalerDl</span><span class="id"> scalerA</span>.<br/>
<span class="id">pose</span><span class="id"> scallM</span><span class="id"> :=</span><span class="id"> GRing</span>.<span class="id">isLinear</span>.<span class="id">Build</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> lin_scal</span>.<br/>
<span class="id">pose</span><span class="id"> scalL</span><span class="id"> :</span><span class="id"> {linear</span><span class="id"> _</span><span class="id"> -&gt;</span><span class="id"> _}</span><span class="id"> :=</span><span class="id"> HB</span>.<span class="id">pack</span><span class="id"> d</span><span class="id"> scallM</span>.<br/>
<span class="id">rewrite</span><span class="id"> -/d</span><span class="id"> -[d]/</span>(<span class="id">scalL</span><span class="id"> :</span><span class="id"> _</span><span class="id"> -&gt;</span><span class="id"> _</span>).<br/>
<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> diff_unique;</span><span class="id"> [apply:</span><span class="id"> scalel_continuous|apply:</span><span class="id"> der1]</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> diff1E</span><span class="id"> f</span><span class="id"> x</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">differentiable</span><span class="id"> f</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> 'd</span><span class="id"> f</span><span class="id"> x</span><span class="id"> =</span> (<span class="gallina-kwd">fun</span><span class="id"> h</span><span class="id"> =&gt;</span><span class="id"> h</span><span class="id"> *:</span><span class="id"> f^`</span>()<span class="id"> x</span>)<span class="id"> :&gt;</span> (<span class="id">R</span><span class="id"> -&gt;</span><span class="id"> U</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">pose</span><span class="id"> d</span> (<span class="id">h</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :=</span><span class="id"> h</span><span class="id"> *:</span><span class="id"> 'd</span><span class="id"> f</span><span class="id"> x</span><span class="id"> 1</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> df;</span><span class="id"> have</span><span class="id"> lin_scal</span><span class="id"> :</span><span class="id"> linear</span><span class="id"> d</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> ?</span><span class="id"> ?</span><span class="id"> ?;</span><span class="id"> rewrite</span><span class="id"> /d</span><span class="id"> scalerDl</span><span class="id"> scalerA</span>.<br/>
<span class="id">pose</span><span class="id"> scallM</span><span class="id"> :=</span><span class="id"> GRing</span>.<span class="id">isLinear</span>.<span class="id">Build</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> lin_scal</span>.<br/>
<span class="id">pose</span><span class="id"> scalL</span><span class="id"> :</span><span class="id"> {linear</span><span class="id"> _</span><span class="id"> -&gt;</span><span class="id"> _}</span><span class="id"> :=</span><span class="id"> HB</span>.<span class="id">pack</span><span class="id"> d</span><span class="id"> scallM</span>.<br/>
<span class="id">have</span><span class="id"> -&gt;</span><span class="id"> :</span> (<span class="gallina-kwd">fun</span><span class="id"> h</span><span class="id"> =&gt;</span><span class="id"> h</span><span class="id"> *:</span><span class="id"> f^`</span>()<span class="id"> x</span>)<span class="id"> =</span><span class="id"> scalL</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> derive1E'</span>.<br/>
<span class="id">apply:</span><span class="id"> diff_unique;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> scalel_continuous</span>.<br/>
<span class="id">apply/eqaddoE;</span><span class="id"> have</span><span class="id"> /diff_locally</span><span class="id"> -&gt;</span><span class="id"> :=</span><span class="id"> df;</span><span class="id"> congr</span> (_<span class="id"> +</span><span class="id"> _</span><span class="id"> +</span><span class="id"> _</span>).<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> funeqE</span><span class="id"> =&gt;</span><span class="id"> h</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> -{1}[h]mulr1</span><span class="id"> linearZ</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> derivable1_diffP</span><span class="id"> f</span><span class="id"> x</span><span class="id"> :</span><span class="id"> derivable</span><span class="id"> f</span><span class="id"> x</span><span class="id"> 1</span><span class="id"> &lt;-&gt;</span><span class="id"> differentiable</span><span class="id"> f</span><span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">split=&gt;</span><span class="id"> dfx</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply/diff_locallyP;</span><span class="id"> rewrite</span><span class="id"> deriv1E</span><span class="id"> //;</span><span class="id"> split;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">[apply:</span><span class="id"> scalel_continuous|apply:</span><span class="id"> der1]</span>.<br/>
<span class="id">apply/derivable_nbhsP/eqaddoE</span>.<br/>
<span class="id">have</span><span class="id"> -&gt;</span><span class="id"> :</span> (<span class="gallina-kwd">fun</span><span class="id"> h</span><span class="id"> =&gt;</span> (<span class="id">f</span><span class="id"> \o</span><span class="id"> shift</span><span class="id"> x</span>)<span class="id"> h%:A</span>)<span class="id"> =</span><span class="id"> f</span><span class="id"> \o</span><span class="id"> shift</span><span class="id"> x</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> funeqE=&gt;</span><span class="id"> ?;</span><span class="id"> rewrite</span><span class="id"> [_%:A]mulr1</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> have</span><span class="id"> /diff_locally</span><span class="id"> :=</span><span class="id"> dfx;</span><span class="id"> rewrite</span><span class="id"> diff1E</span><span class="id"> //</span><span class="id"> derive1E</span><span class="id"> =&gt;-&gt;</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> derivable_within_continuous</span><span class="id"> f</span> (<span class="id">i</span><span class="id"> :</span><span class="id"> interval</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">{in</span><span class="id"> i,</span><span class="gallina-kwd"> forall</span><span class="id"> x,</span><span class="id"> derivable</span><span class="id"> f</span><span class="id"> x</span><span class="id"> 1}</span><span class="id"> -&gt;</span><span class="id"> {within</span><span class="id"> [set`</span><span class="id"> i],</span><span class="id"> continuous</span><span class="id"> f}</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> di;</span><span class="id"> apply/continuous_in_subspaceT</span><span class="id"> =&gt;</span><span class="id"> z</span><span class="id"> /[1!inE]</span><span class="id"> zA</span>.<br/>
<span class="id">apply/differentiable_continuous;</span><span class="id"> rewrite</span><span class="id"> -derivable1_diffP</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> di;</span><span class="id"> rewrite</span><span class="id"> inE</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> DeriveRU</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> DeriveVW</span>.<br/>
<span class="vernacular">Variables</span> (<span class="id">R</span><span class="id"> :</span><span class="id"> numFieldType</span>) (<span class="id">V</span><span class="id"> W</span><span class="id"> :</span><span class="id"> normedModType</span><span class="id"> R</span>).<br/>
<span class="vernacular">Implicit</span><span class="id"> Types</span><span class="id"> f</span><span class="id"> :</span><span class="id"> V</span><span class="id"> -&gt;</span><span class="id"> W</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> derivable1P</span><span class="id"> f</span><span class="id"> x</span><span class="id"> v</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">derivable</span><span class="id"> f</span><span class="id"> x</span><span class="id"> v</span><span class="id"> &lt;-&gt;</span><span class="id"> derivable</span> (<span class="gallina-kwd">fun</span><span class="id"> h</span><span class="id"> :</span><span class="id"> R</span><span class="id"> =&gt;</span><span class="id"> f</span> (<span class="id">h</span><span class="id"> *:</span><span class="id"> v</span><span class="id"> +</span><span class="id"> x</span>))<span class="id"> 0</span><span class="id"> 1</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> /derivable;</span><span class="id"> set</span><span class="id"> g1</span><span class="id"> :=</span><span class="gallina-kwd"> fun</span><span class="id"> h</span><span class="id"> =&gt;</span><span class="id"> h^-1</span><span class="id"> *:</span><span class="id"> _;</span><span class="id"> set</span><span class="id"> g2</span><span class="id"> :=</span><span class="gallina-kwd"> fun</span><span class="id"> h</span><span class="id"> =&gt;</span><span class="id"> h^-1</span><span class="id"> *:</span><span class="id"> _</span>.<br/>
<span class="id">suff</span><span class="id"> -&gt;</span><span class="id"> :</span><span class="id"> g1</span><span class="id"> =</span><span class="id"> g2</span><span class="gallina-kwd"> by</span><span class="id"> []</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> funeqE</span><span class="id"> /g1</span><span class="id"> /g2</span><span class="id"> =&gt;</span><span class="id"> h</span><span class="id"> /=;</span><span class="id"> rewrite</span><span class="id"> addr0</span><span class="id"> scale0r</span><span class="id"> add0r</span><span class="id"> [_%:A]mulr1</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> derivableP</span><span class="id"> f</span><span class="id"> x</span><span class="id"> v</span><span class="id"> :</span><span class="id"> derivable</span><span class="id"> f</span><span class="id"> x</span><span class="id"> v</span><span class="id"> -&gt;</span><span class="id"> is_derive</span><span class="id"> x</span><span class="id"> v</span><span class="id"> f</span> (<span class="id">'D_v</span><span class="id"> f</span><span class="id"> x</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> df;</span><span class="id"> apply:</span><span class="id"> DeriveDef</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> diff_derivable</span><span class="id"> f</span><span class="id"> a</span><span class="id"> v</span><span class="id"> :</span><span class="id"> differentiable</span><span class="id"> f</span><span class="id"> a</span><span class="id"> -&gt;</span><span class="id"> derivable</span><span class="id"> f</span><span class="id"> a</span><span class="id"> v</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> dfa;</span><span class="id"> apply/derivable1P/derivable1_diffP</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> differentiable_comp;</span><span class="id"> rewrite</span><span class="id"> ?scale0r</span><span class="id"> ?add0r</span>.<br/>
Qed.</div></details>
<br/>
<span class="id">Global</span><span class="vernacular"> Instance</span><span class="id"> is_derive_cst</span> (<span class="id">a</span><span class="id"> :</span><span class="id"> W</span>) (<span class="id">x</span><span class="id"> v</span><span class="id"> :</span><span class="id"> V</span>)<span class="id"> :</span><span class="id"> is_derive</span><span class="id"> x</span><span class="id"> v</span> (<span class="id">cst</span><span class="id"> a</span>)<span class="id"> 0</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">apply:</span><span class="id"> DeriveDef;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> deriveE</span><span class="id"> //</span><span class="id"> diff_val</span>.<br/>
<span class="id">exact/diff_derivable</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> derivable_cst</span> (<span class="id">w</span><span class="id"> :</span><span class="id"> W</span>) (<span class="id">x</span><span class="id"> v</span><span class="id"> :</span><span class="id"> V</span>)<span class="id"> :</span><span class="id"> derivable</span> (<span class="id">cst</span><span class="id"> w</span>)<span class="id"> x</span><span class="id"> v</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id"> exact/diff_derivable</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> is_derive_eq</span><span class="id"> f</span> (<span class="id">x</span><span class="id"> v</span><span class="id"> :</span><span class="id"> V</span>) (<span class="id">df</span><span class="id"> f'</span><span class="id"> :</span><span class="id"> W</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">is_derive</span><span class="id"> x</span><span class="id"> v</span><span class="id"> f</span><span class="id"> f'</span><span class="id"> -&gt;</span><span class="id"> f'</span><span class="id"> =</span><span class="id"> df</span><span class="id"> -&gt;</span><span class="id"> is_derive</span><span class="id"> x</span><span class="id"> v</span><span class="id"> f</span><span class="id"> df</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> ?</span><span class="id"> &lt;-</span>. Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> DeriveVW</span>.<br/>
<span class="vernacular">Arguments</span><span class="id"> derivable_cst</span><span class="id"> {R</span><span class="id"> V</span><span class="id"> W}</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> Derive_lemmasVW</span>.<br/>
<span class="vernacular">Variables</span> (<span class="id">R</span><span class="id"> :</span><span class="id"> numFieldType</span>) (<span class="id">V</span><span class="id"> W</span><span class="id"> :</span><span class="id"> normedModType</span><span class="id"> R</span>).<br/>
<span class="vernacular">Implicit</span><span class="id"> Types</span><span class="id"> f</span><span class="id"> g</span><span class="id"> :</span><span class="id"> V</span><span class="id"> -&gt;</span><span class="id"> W</span>.<br/>
<br/>
<span class="vernacular">Fact</span><span class="id"> der_add</span><span class="id"> f</span><span class="id"> g</span> (<span class="id">x</span><span class="id"> v</span><span class="id"> :</span><span class="id"> V</span>)<span class="id"> :</span><span class="id"> derivable</span><span class="id"> f</span><span class="id"> x</span><span class="id"> v</span><span class="id"> -&gt;</span><span class="id"> derivable</span><span class="id"> g</span><span class="id"> x</span><span class="id"> v</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">fun</span><span class="id"> h</span><span class="id"> =&gt;</span><span class="id"> h^-1</span><span class="id"> *:</span> (((<span class="id">f</span><span class="id"> +</span><span class="id"> g</span>)<span class="id"> \o</span><span class="id"> shift</span><span class="id"> x</span>) (<span class="id">h</span><span class="id"> *:</span><span class="id"> v</span>)<span class="id"> -</span> (<span class="id">f</span><span class="id"> +</span><span class="id"> g</span>)<span class="id"> x</span>))<span class="id"> @</span><br/>
&nbsp;&nbsp;<span class="id">0^'</span> <span class="id"> --&gt;</span><span class="id"> 'D_v</span><span class="id"> f</span><span class="id"> x</span><span class="id"> +</span><span class="id"> 'D_v</span><span class="id"> g</span><span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> df</span><span class="id"> dg</span>.<br/>
<span class="id">evar</span> (<span class="id">fg</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> W</span>)<span class="id">;</span><span class="id"> rewrite</span><span class="id"> [X</span><span class="gallina-kwd"> in</span><span class="id"> X</span><span class="id"> @</span><span class="id"> _]</span>(_<span class="id"> :</span><span class="id"> _</span><span class="id"> =</span><span class="id"> fg</span>)<span class="id"> /=;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> funeqE</span><span class="id"> =&gt;</span><span class="id"> h</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> !scalerDr</span><span class="id"> scalerN</span><span class="id"> scalerDr</span><span class="id"> opprD</span><span class="id"> addrACA</span><span class="id"> -!scalerBr</span><span class="id"> /fg</span>.<br/>
<span class="id">exact:</span><span class="id"> cvgD</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> deriveD</span><span class="id"> f</span><span class="id"> g</span> (<span class="id">x</span><span class="id"> v</span><span class="id"> :</span><span class="id"> V</span>)<span class="id"> :</span><span class="id"> derivable</span><span class="id"> f</span><span class="id"> x</span><span class="id"> v</span><span class="id"> -&gt;</span><span class="id"> derivable</span><span class="id"> g</span><span class="id"> x</span><span class="id"> v</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">'D_v</span> (<span class="id">f</span><span class="id"> +</span><span class="id"> g</span>)<span class="id"> x</span><span class="id"> =</span><span class="id"> 'D_v</span><span class="id"> f</span><span class="id"> x</span><span class="id"> +</span><span class="id"> 'D_v</span><span class="id"> g</span><span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> df</span><span class="id"> dg;</span><span class="id"> apply:</span><span class="id"> cvg_lim</span> (<span class="id">der_add</span><span class="id"> df</span><span class="id"> dg</span>). Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> derivableD</span><span class="id"> f</span><span class="id"> g</span> (<span class="id">x</span><span class="id"> v</span><span class="id"> :</span><span class="id"> V</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">derivable</span><span class="id"> f</span><span class="id"> x</span><span class="id"> v</span><span class="id"> -&gt;</span><span class="id"> derivable</span><span class="id"> g</span><span class="id"> x</span><span class="id"> v</span><span class="id"> -&gt;</span><span class="id"> derivable</span> (<span class="id">f</span><span class="id"> +</span><span class="id"> g</span>)<span class="id"> x</span><span class="id"> v</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> df</span><span class="id"> dg;</span><span class="id"> apply/cvg_ex;</span><span class="gallina-kwd"> exists</span> (<span class="id">derive</span><span class="id"> f</span><span class="id"> x</span><span class="id"> v</span><span class="id"> +</span><span class="id"> derive</span><span class="id"> g</span><span class="id"> x</span><span class="id"> v</span>).<br/>
<span class="id">exact:</span><span class="id"> der_add</span>.<br/>
Qed.</div></details>
<br/>
<span class="id">Global</span><span class="vernacular"> Instance</span><span class="id"> is_deriveD</span><span class="id"> f</span><span class="id"> g</span> (<span class="id">x</span><span class="id"> v</span><span class="id"> :</span><span class="id"> V</span>) (<span class="id">df</span><span class="id"> dg</span><span class="id"> :</span><span class="id"> W</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">is_derive</span><span class="id"> x</span><span class="id"> v</span><span class="id"> f</span><span class="id"> df</span><span class="id"> -&gt;</span><span class="id"> is_derive</span><span class="id"> x</span><span class="id"> v</span><span class="id"> g</span><span class="id"> dg</span><span class="id"> -&gt;</span><span class="id"> is_derive</span><span class="id"> x</span><span class="id"> v</span> (<span class="id">f</span><span class="id"> +</span><span class="id"> g</span>) (<span class="id">df</span><span class="id"> +</span><span class="id"> dg</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> dfx</span><span class="id"> dgx;</span><span class="id"> apply:</span><span class="id"> DeriveDef;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> derivableD</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> deriveD</span><span class="id"> //</span><span class="id"> !derive_val</span>.<br/>
Qed.</div></details>
<br/>
<span class="id">Global</span><span class="vernacular"> Instance</span><span class="id"> is_derive_sum</span><span class="id"> n</span> (<span class="id">h</span><span class="id"> :</span><span class="id"> 'I_n</span><span class="id"> -&gt;</span><span class="id"> V</span><span class="id"> -&gt;</span><span class="id"> W</span>) (<span class="id">x</span><span class="id"> v</span><span class="id"> :</span><span class="id"> V</span>)<br/>
&nbsp;&nbsp;(<span class="id">dh</span><span class="id"> :</span><span class="id"> 'I_n</span><span class="id"> -&gt;</span><span class="id"> W</span>)<span class="id"> :</span> (<span class="gallina-kwd">forall</span><span class="id"> i,</span><span class="id"> is_derive</span><span class="id"> x</span><span class="id"> v</span> (<span class="id">h</span><span class="id"> i</span>) (<span class="id">dh</span><span class="id"> i</span>))<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">is_derive</span><span class="id"> x</span><span class="id"> v</span> (<span class="id">\sum_</span>(<span class="id">i</span><span class="id"> &lt;</span><span class="id"> n</span>)<span class="id"> h</span><span class="id"> i</span>) (<span class="id">\sum_</span>(<span class="id">i</span><span class="id"> &lt;</span><span class="id"> n</span>)<span class="id"> dh</span><span class="id"> i</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd">by</span><span class="id"> elim/big_ind2</span><span class="id"> :</span><span class="id"> _</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> [|]</span><span class="id"> *;</span><span class="id"> [exact:</span><span class="id"> is_derive_cst|exact:</span><span class="id"> is_deriveD]</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> derivable_sum</span><span class="id"> n</span> (<span class="id">h</span><span class="id"> :</span><span class="id"> 'I_n</span><span class="id"> -&gt;</span><span class="id"> V</span><span class="id"> -&gt;</span><span class="id"> W</span>) (<span class="id">x</span><span class="id"> v</span><span class="id"> :</span><span class="id"> V</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">forall</span><span class="id"> i,</span><span class="id"> derivable</span> (<span class="id">h</span><span class="id"> i</span>)<span class="id"> x</span><span class="id"> v</span>)<span class="id"> -&gt;</span><span class="id"> derivable</span> (<span class="id">\sum_</span>(<span class="id">i</span><span class="id"> &lt;</span><span class="id"> n</span>)<span class="id"> h</span><span class="id"> i</span>)<span class="id"> x</span><span class="id"> v</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> df;</span><span class="id"> suff</span><span class="id"> :</span><span class="gallina-kwd"> forall</span><span class="id"> i,</span><span class="id"> is_derive</span><span class="id"> x</span><span class="id"> v</span> (<span class="id">h</span><span class="id"> i</span>) (<span class="id">'D_v</span> (<span class="id">h</span><span class="id"> i</span>)<span class="id"> x</span>)<span class="gallina-kwd"> by</span><span class="id"> []</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> ?;</span><span class="id"> apply:</span><span class="id"> derivableP</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> derive_sum</span><span class="id"> n</span> (<span class="id">h</span><span class="id"> :</span><span class="id"> 'I_n</span><span class="id"> -&gt;</span><span class="id"> V</span><span class="id"> -&gt;</span><span class="id"> W</span>) (<span class="id">x</span><span class="id"> v</span><span class="id"> :</span><span class="id"> V</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">forall</span><span class="id"> i,</span><span class="id"> derivable</span> (<span class="id">h</span><span class="id"> i</span>)<span class="id"> x</span><span class="id"> v</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">'D_v</span> (<span class="id">\sum_</span>(<span class="id">i</span><span class="id"> &lt;</span><span class="id"> n</span>)<span class="id"> h</span><span class="id"> i</span>)<span class="id"> x</span><span class="id"> =</span><span class="id"> \sum_</span>(<span class="id">i</span><span class="id"> &lt;</span><span class="id"> n</span>)<span class="id"> 'D_v</span> (<span class="id">h</span><span class="id"> i</span>)<span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> df;</span><span class="id"> suff</span><span class="id"> dfx</span><span class="id"> :</span><span class="gallina-kwd"> forall</span><span class="id"> i,</span><span class="id"> is_derive</span><span class="id"> x</span><span class="id"> v</span> (<span class="id">h</span><span class="id"> i</span>) (<span class="id">'D_v</span> (<span class="id">h</span><span class="id"> i</span>)<span class="id"> x</span>).<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> derive_val</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> ?;</span><span class="id"> apply:</span><span class="id"> derivableP</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Fact</span><span class="id"> der_opp</span><span class="id"> f</span> (<span class="id">x</span><span class="id"> v</span><span class="id"> :</span><span class="id"> V</span>)<span class="id"> :</span><span class="id"> derivable</span><span class="id"> f</span><span class="id"> x</span><span class="id"> v</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">fun</span><span class="id"> h</span><span class="id"> =&gt;</span><span class="id"> h^-1</span><span class="id"> *:</span> (((<span class="id">-</span><span class="id"> f</span>)<span class="id"> \o</span><span class="id"> shift</span><span class="id"> x</span>) (<span class="id">h</span><span class="id"> *:</span><span class="id"> v</span>)<span class="id"> -</span> (<span class="id">-</span><span class="id"> f</span>)<span class="id"> x</span>))<span class="id"> @</span><br/>
&nbsp;&nbsp;<span class="id">0^'</span><span class="id"> --&gt;</span><span class="id"> -</span><span class="id"> 'D_v</span><span class="id"> f</span><span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> df;</span><span class="id"> evar</span> (<span class="id">g</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> W</span>)<span class="id">;</span><span class="id"> rewrite</span><span class="id"> [X</span><span class="gallina-kwd"> in</span><span class="id"> X</span><span class="id"> @</span><span class="id"> _]</span>(_<span class="id"> :</span><span class="id"> _</span><span class="id"> =</span><span class="id"> g</span>)<span class="id"> /=;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> funeqE</span><span class="id"> =&gt;</span><span class="id"> h;</span><span class="id"> rewrite</span><span class="id"> !scalerDr</span><span class="id"> !scalerN</span><span class="id"> -opprD</span><span class="id"> -scalerBr</span><span class="id"> /g</span>.<br/>
<span class="id">exact:</span><span class="id"> cvgN</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> deriveN</span><span class="id"> f</span> (<span class="id">x</span><span class="id"> v</span><span class="id"> :</span><span class="id"> V</span>)<span class="id"> :</span><span class="id"> derivable</span><span class="id"> f</span><span class="id"> x</span><span class="id"> v</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">'D_v</span> (<span class="id">-</span><span class="id"> f</span>)<span class="id"> x</span><span class="id"> =</span><span class="id"> -</span><span class="id"> 'D_v</span><span class="id"> f</span><span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> df;</span><span class="id"> apply:</span><span class="id"> cvg_lim</span> (<span class="id">der_opp</span><span class="id"> df</span>). Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> derivableN</span><span class="id"> f</span> (<span class="id">x</span><span class="id"> v</span><span class="id"> :</span><span class="id"> V</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">derivable</span><span class="id"> f</span><span class="id"> x</span><span class="id"> v</span><span class="id"> -&gt;</span><span class="id"> derivable</span> (<span class="id">-</span><span class="id"> f</span>)<span class="id"> x</span><span class="id"> v</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> df;</span><span class="id"> apply/cvg_ex;</span><span class="gallina-kwd"> exists</span> (<span class="id">-</span><span class="id"> 'D_v</span><span class="id"> f</span><span class="id"> x</span>)<span class="id">;</span><span class="id"> apply:</span><span class="id"> der_opp</span>. Qed.</div></details>
<br/>
<span class="id">Global</span><span class="vernacular"> Instance</span><span class="id"> is_deriveN</span><span class="id"> f</span> (<span class="id">x</span><span class="id"> v</span><span class="id"> :</span><span class="id"> V</span>) (<span class="id">df</span><span class="id"> :</span><span class="id"> W</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">is_derive</span><span class="id"> x</span><span class="id"> v</span><span class="id"> f</span><span class="id"> df</span><span class="id"> -&gt;</span><span class="id"> is_derive</span><span class="id"> x</span><span class="id"> v</span> (<span class="id">-</span><span class="id"> f</span>) (<span class="id">-</span><span class="id"> df</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> dfx;</span><span class="id"> apply:</span><span class="id"> DeriveDef;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> derivableN</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> deriveN</span><span class="id"> //</span><span class="id"> derive_val</span>.<br/>
Qed.</div></details>
<br/>
<span class="id">Global</span><span class="vernacular"> Instance</span><span class="id"> is_deriveB</span><span class="id"> f</span><span class="id"> g</span> (<span class="id">x</span><span class="id"> v</span><span class="id"> :</span><span class="id"> V</span>) (<span class="id">df</span><span class="id"> dg</span><span class="id"> :</span><span class="id"> W</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">is_derive</span><span class="id"> x</span><span class="id"> v</span><span class="id"> f</span><span class="id"> df</span><span class="id"> -&gt;</span><span class="id"> is_derive</span><span class="id"> x</span><span class="id"> v</span><span class="id"> g</span><span class="id"> dg</span><span class="id"> -&gt;</span><span class="id"> is_derive</span><span class="id"> x</span><span class="id"> v</span> (<span class="id">f</span><span class="id"> -</span><span class="id"> g</span>) (<span class="id">df</span><span class="id"> -</span><span class="id"> dg</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> ??;</span><span class="id"> apply:</span><span class="id"> is_derive_eq</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> deriveB</span><span class="id"> f</span><span class="id"> g</span> (<span class="id">x</span><span class="id"> v</span><span class="id"> :</span><span class="id"> V</span>)<span class="id"> :</span><span class="id"> derivable</span><span class="id"> f</span><span class="id"> x</span><span class="id"> v</span><span class="id"> -&gt;</span><span class="id"> derivable</span><span class="id"> g</span><span class="id"> x</span><span class="id"> v</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">'D_v</span> (<span class="id">f</span><span class="id"> -</span><span class="id"> g</span>)<span class="id"> x</span><span class="id"> =</span><span class="id"> 'D_v</span><span class="id"> f</span><span class="id"> x</span><span class="id"> -</span><span class="id"> 'D_v</span><span class="id"> g</span><span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> /derivableP</span><span class="id"> df</span><span class="id"> /derivableP</span><span class="id"> dg;</span><span class="id"> rewrite</span><span class="id"> derive_val</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> derivableB</span><span class="id"> f</span><span class="id"> g</span> (<span class="id">x</span><span class="id"> v</span><span class="id"> :</span><span class="id"> V</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">derivable</span><span class="id"> f</span><span class="id"> x</span><span class="id"> v</span><span class="id"> -&gt;</span><span class="id"> derivable</span><span class="id"> g</span><span class="id"> x</span><span class="id"> v</span><span class="id"> -&gt;</span><span class="id"> derivable</span> (<span class="id">f</span><span class="id"> -</span><span class="id"> g</span>)<span class="id"> x</span><span class="id"> v</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> /derivableP</span><span class="id"> df</span><span class="id"> /derivableP</span><span class="id"> dg</span>. Qed.</div></details>
<br/>
<span class="vernacular">Fact</span><span class="id"> der_scal</span><span class="id"> f</span> (<span class="id">k</span><span class="id"> :</span><span class="id"> R</span>) (<span class="id">x</span><span class="id"> v</span><span class="id"> :</span><span class="id"> V</span>)<span class="id"> :</span><span class="id"> derivable</span><span class="id"> f</span><span class="id"> x</span><span class="id"> v</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">fun</span><span class="id"> h</span><span class="id"> =&gt;</span><span class="id"> h^-1</span><span class="id"> *:</span> ((<span class="id">k</span><span class="id"> \*:</span><span class="id"> f</span><span class="id"> \o</span><span class="id"> shift</span><span class="id"> x</span>) (<span class="id">h</span><span class="id"> *:</span><span class="id"> v</span>)<span class="id"> -</span> (<span class="id">k</span><span class="id"> \*:</span><span class="id"> f</span>)<span class="id"> x</span>))<span class="id"> @</span><br/>
&nbsp;&nbsp;<span class="id">0^'</span><span class="id"> --&gt;</span><span class="id"> k</span><span class="id"> *:</span><span class="id"> 'D_v</span><span class="id"> f</span><span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> df;</span><span class="id"> evar</span> (<span class="id">h</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> W</span>)<span class="id">;</span><span class="id"> rewrite</span><span class="id"> [X</span><span class="gallina-kwd"> in</span><span class="id"> X</span><span class="id"> @</span><span class="id"> _]</span>(_<span class="id"> :</span><span class="id"> _</span><span class="id"> =</span><span class="id"> h</span>)<span class="id"> /=;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> funeqE</span><span class="id"> =&gt;</span><span class="id"> r</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> scalerBr</span><span class="id"> !scalerA</span><span class="id"> mulrC</span><span class="id"> -!scalerA</span><span class="id"> -!scalerBr</span><span class="id"> /h</span>.<br/>
<span class="id">exact:</span><span class="id"> cvgZr</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> deriveZ</span><span class="id"> f</span> (<span class="id">k</span><span class="id"> :</span><span class="id"> R</span>) (<span class="id">x</span><span class="id"> v</span><span class="id"> :</span><span class="id"> V</span>)<span class="id"> :</span><span class="id"> derivable</span><span class="id"> f</span><span class="id"> x</span><span class="id"> v</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">'D_v</span> (<span class="id">k</span><span class="id"> \*:</span><span class="id"> f</span>)<span class="id"> x</span><span class="id"> =</span><span class="id"> k</span><span class="id"> *:</span><span class="id"> 'D_v</span><span class="id"> f</span><span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> df;</span><span class="id"> apply:</span><span class="id"> cvg_lim</span> (<span class="id">der_scal</span><span class="id"> df</span>). Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> derivableZ</span><span class="id"> f</span> (<span class="id">k</span><span class="id"> :</span><span class="id"> R</span>) (<span class="id">x</span><span class="id"> v</span><span class="id"> :</span><span class="id"> V</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">derivable</span><span class="id"> f</span><span class="id"> x</span><span class="id"> v</span><span class="id"> -&gt;</span><span class="id"> derivable</span> (<span class="id">k</span><span class="id"> \*:</span><span class="id"> f</span>)<span class="id"> x</span><span class="id"> v</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> df;</span><span class="id"> apply/cvg_ex;</span><span class="gallina-kwd"> exists</span> (<span class="id">k</span><span class="id"> *:</span><span class="id"> 'D_v</span><span class="id"> f</span><span class="id"> x</span>)<span class="id">;</span><span class="id"> apply:</span><span class="id"> der_scal</span>.<br/>
Qed.</div></details>
<br/>
<span class="id">Global</span><span class="vernacular"> Instance</span><span class="id"> is_deriveZ</span><span class="id"> f</span> (<span class="id">k</span><span class="id"> :</span><span class="id"> R</span>) (<span class="id">x</span><span class="id"> v</span><span class="id"> :</span><span class="id"> V</span>) (<span class="id">df</span><span class="id"> :</span><span class="id"> W</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">is_derive</span><span class="id"> x</span><span class="id"> v</span><span class="id"> f</span><span class="id"> df</span><span class="id"> -&gt;</span><span class="id"> is_derive</span><span class="id"> x</span><span class="id"> v</span> (<span class="id">k</span><span class="id"> \*:</span><span class="id"> f</span>) (<span class="id">k</span><span class="id"> *:</span><span class="id"> df</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> dfx;</span><span class="id"> apply:</span><span class="id"> DeriveDef;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> derivableZ</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> deriveZ</span><span class="id"> //</span><span class="id"> derive_val</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> derive_cst</span> (<span class="id">k</span><span class="id"> :</span><span class="id"> R</span>) (<span class="id">x</span><span class="id"> v</span><span class="id"> :</span><span class="id"> V</span>)<span class="id"> :</span><span class="id"> 'D_v</span> (<span class="id">cst</span><span class="id"> k</span>)<span class="id"> x</span><span class="id"> =</span><span class="id"> 0</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> derive_val</span>. Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> Derive_lemmasVW</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> derive_id</span>.<br/>
<span class="vernacular">Variables</span> (<span class="id">R</span><span class="id"> :</span><span class="id"> numFieldType</span>) (<span class="id">V</span><span class="id"> :</span><span class="id"> normedModType</span><span class="id"> R</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> derivable_id</span> (<span class="id">x</span><span class="id"> v</span><span class="id"> :</span><span class="id"> V</span>)<span class="id"> :</span><span class="id"> derivable</span><span class="id"> id</span><span class="id"> x</span><span class="id"> v</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id"> exact/diff_derivable</span>. Qed.</div></details>
<br/>
<span class="id">Global</span><span class="vernacular"> Instance</span><span class="id"> is_derive_id</span> (<span class="id">x</span><span class="id"> v</span><span class="id"> :</span><span class="id"> V</span>)<span class="id"> :</span><span class="id"> is_derive</span><span class="id"> x</span><span class="id"> v</span><span class="id"> id</span><span class="id"> v</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">apply:</span> (<span class="id">DeriveDef</span> (<span class="id">@derivable_id</span><span class="id"> _</span><span class="id"> _</span>)).<br/>
<span class="id">rewrite</span><span class="id"> deriveE//</span> (<span class="id">@diff_lin</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> idfun</span>)<span class="id">//=</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> /continuous_at</span>.<br/>
Qed.</div></details>
<br/>
<span class="id">Global</span><span class="vernacular"> Instance</span><span class="id"> is_deriveNid</span> (<span class="id">x</span><span class="id"> v</span><span class="id"> :</span><span class="id"> V</span>)<span class="id"> :</span><span class="id"> is_derive</span><span class="id"> x</span><span class="id"> v</span><span class="id"> -%R</span> (<span class="id">-</span><span class="id"> v</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id"> exact:</span><span class="id"> is_deriveN</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> derive_id</span> (<span class="id">x</span><span class="id"> v</span><span class="id"> :</span><span class="id"> V</span>)<span class="id"> :</span><span class="id"> 'D_v</span><span class="id"> id</span><span class="id"> x</span><span class="id"> =</span><span class="id"> v</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> have</span><span class="id"> /derivableP</span><span class="id"> :=</span><span class="id"> @derivable_id</span><span class="id"> x</span><span class="id"> v;</span><span class="id"> rewrite</span><span class="id"> derive_val</span>. Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> derive_id</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> Derive_lemmasVR</span>.<br/>
<span class="vernacular">Variables</span> (<span class="id">R</span><span class="id"> :</span><span class="id"> numFieldType</span>) (<span class="id">V</span><span class="id"> :</span><span class="id"> normedModType</span><span class="id"> R</span>).<br/>
<span class="vernacular">Implicit</span><span class="id"> Types</span><span class="id"> f</span><span class="id"> g</span><span class="id"> :</span><span class="id"> V</span><span class="id"> -&gt;</span><span class="id"> R</span>.<br/>
<br/>
<span class="vernacular">Fact</span><span class="id"> der_mult</span><span class="id"> f</span><span class="id"> g</span> (<span class="id">x</span><span class="id"> v</span><span class="id"> :</span><span class="id"> V</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">derivable</span><span class="id"> f</span><span class="id"> x</span><span class="id"> v</span><span class="id"> -&gt;</span><span class="id"> derivable</span><span class="id"> g</span><span class="id"> x</span><span class="id"> v</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">fun</span><span class="id"> h</span><span class="id"> =&gt;</span><span class="id"> h^-1</span><span class="id"> *:</span> (((<span class="id">f</span><span class="id"> *</span><span class="id"> g</span>)<span class="id"> \o</span><span class="id"> shift</span><span class="id"> x</span>) (<span class="id">h</span><span class="id"> *:</span><span class="id"> v</span>)<span class="id"> -</span> (<span class="id">f</span><span class="id"> *</span><span class="id"> g</span>)<span class="id"> x</span>))<span class="id"> @</span><br/>
&nbsp;&nbsp;<span class="id">0^'</span><span class="id"> --&gt;</span><span class="id"> f</span><span class="id"> x</span><span class="id"> *:</span><span class="id"> 'D_v</span><span class="id"> g</span><span class="id"> x</span><span class="id"> +</span><span class="id"> g</span><span class="id"> x</span><span class="id"> *:</span><span class="id"> 'D_v</span><span class="id"> f</span><span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> df</span><span class="id"> dg</span>.<br/>
<span class="id">evar</span> (<span class="id">fg</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> R</span>)<span class="id">;</span><span class="id"> rewrite</span><span class="id"> [X</span><span class="gallina-kwd"> in</span><span class="id"> X</span><span class="id"> @</span><span class="id"> _]</span>(_<span class="id"> :</span><span class="id"> _</span><span class="id"> =</span><span class="id"> fg</span>)<span class="id"> /=;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> funeqE</span><span class="id"> =&gt;</span><span class="id"> h</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> -&gt;</span><span class="id"> :</span> (<span class="id">f</span><span class="id"> *</span><span class="id"> g</span>) (<span class="id">h</span><span class="id"> *:</span><span class="id"> v</span><span class="id"> +</span><span class="id"> x</span>)<span class="id"> -</span> (<span class="id">f</span><span class="id"> *</span><span class="id"> g</span>)<span class="id"> x</span><span class="id"> =</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">f</span> (<span class="id">h</span><span class="id"> *:</span><span class="id"> v</span><span class="id"> +</span><span class="id"> x</span>)<span class="id"> *:</span> (<span class="id">g</span> (<span class="id">h</span><span class="id"> *:</span><span class="id"> v</span><span class="id"> +</span><span class="id"> x</span>)<span class="id"> -</span><span class="id"> g</span><span class="id"> x</span>)<span class="id"> +</span><span class="id"> g</span><span class="id"> x</span><span class="id"> *:</span> (<span class="id">f</span> (<span class="id">h</span><span class="id"> *:</span><span class="id"> v</span><span class="id"> +</span><span class="id"> x</span>)<span class="id"> -</span><span class="id"> f</span><span class="id"> x</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> !scalerBr</span><span class="id"> -addrA</span><span class="id"> ![g</span><span class="id"> x</span><span class="id"> *:</span><span class="id"> _]mulrC</span><span class="id"> addKr</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> scalerDr</span><span class="id"> scalerA</span><span class="id"> mulrC</span><span class="id"> -scalerA</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> [_</span><span class="id"> *:</span> (<span class="id">g</span><span class="id"> x</span><span class="id"> *:</span><span class="id"> _</span>)<span class="id">]scalerA</span><span class="id"> mulrC</span><span class="id"> -scalerA</span><span class="id"> /fg</span>.<br/>
<span class="id">apply:</span><span class="id"> cvgD;</span><span class="id"> last</span><span class="id"> exact:</span><span class="id"> cvgZr</span><span class="id"> df</span>.<br/>
<span class="id">apply:</span><span class="id"> cvg_comp2</span> (<span class="id">@mul_continuous</span><span class="id"> _</span> (<span class="id">_,</span><span class="id"> _</span>))<span class="id"> =&gt;</span><span class="id"> /=;</span><span class="id"> last</span><span class="id"> exact:</span><span class="id"> dg</span>.<br/>
<span class="id">suff</span><span class="id"> :</span><span class="id"> {for</span><span class="id"> 0,</span><span class="id"> continuous</span> (<span class="gallina-kwd">fun</span><span class="id"> h</span><span class="id"> :</span><span class="id"> R</span><span class="id"> =&gt;</span><span class="id"> f</span>(<span class="id">h</span><span class="id"> *:</span><span class="id"> v</span><span class="id"> +</span><span class="id"> x</span>))<span class="id">}</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> /continuous_withinNx;</span><span class="id"> rewrite</span><span class="id"> scale0r</span><span class="id"> add0r</span>.<br/>
<span class="id">exact/differentiable_continuous/derivable1_diffP/</span>(<span class="id">derivable1P</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span>).<span class="id">1</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> deriveM</span><span class="id"> f</span><span class="id"> g</span> (<span class="id">x</span><span class="id"> v</span><span class="id"> :</span><span class="id"> V</span>)<span class="id"> :</span><span class="id"> derivable</span><span class="id"> f</span><span class="id"> x</span><span class="id"> v</span><span class="id"> -&gt;</span><span class="id"> derivable</span><span class="id"> g</span><span class="id"> x</span><span class="id"> v</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">'D_v</span> (<span class="id">f</span><span class="id"> *</span><span class="id"> g</span>)<span class="id"> x</span><span class="id"> =</span><span class="id"> f</span><span class="id"> x</span><span class="id"> *:</span><span class="id"> 'D_v</span><span class="id"> g</span><span class="id"> x</span><span class="id"> +</span><span class="id"> g</span><span class="id"> x</span><span class="id"> *:</span><span class="id"> 'D_v</span><span class="id"> f</span><span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> df</span><span class="id"> dg;</span><span class="id"> apply:</span><span class="id"> cvg_lim</span> (<span class="id">der_mult</span><span class="id"> df</span><span class="id"> dg</span>). Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> derivableM</span><span class="id"> f</span><span class="id"> g</span> (<span class="id">x</span><span class="id"> v</span><span class="id"> :</span><span class="id"> V</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">derivable</span><span class="id"> f</span><span class="id"> x</span><span class="id"> v</span><span class="id"> -&gt;</span><span class="id"> derivable</span><span class="id"> g</span><span class="id"> x</span><span class="id"> v</span><span class="id"> -&gt;</span><span class="id"> derivable</span> (<span class="id">f</span><span class="id"> *</span><span class="id"> g</span>)<span class="id"> x</span><span class="id"> v</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> df</span><span class="id"> dg;</span><span class="id"> apply/cvg_ex;</span><span class="gallina-kwd"> exists</span> (<span class="id">f</span><span class="id"> x</span><span class="id"> *:</span><span class="id"> 'D_v</span><span class="id"> g</span><span class="id"> x</span><span class="id"> +</span><span class="id"> g</span><span class="id"> x</span><span class="id"> *:</span><span class="id"> 'D_v</span><span class="id"> f</span><span class="id"> x</span>).<br/>
<span class="id">exact:</span><span class="id"> der_mult</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> deriveMr</span><span class="id"> f</span> (<span class="id">r</span><span class="id"> :</span><span class="id"> R</span>) (<span class="id">x</span><span class="id"> v</span><span class="id"> :</span><span class="id"> V</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">derivable</span><span class="id"> f</span><span class="id"> x</span><span class="id"> v</span><span class="id"> -&gt;</span><span class="id"> 'D_v</span> (<span class="id">r</span><span class="id"> \o*</span><span class="id"> f</span>)<span class="id"> x</span><span class="id"> =</span> (<span class="id">r</span><span class="id"> *</span><span class="id"> 'D_v</span><span class="id"> f</span><span class="id"> x</span>)<span class="id">%R</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move/deriveM</span><span class="id"> =&gt;</span><span class="id"> /</span>(_<span class="id"> _</span> (<span class="id">derivable_cst</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span>))<span class="id"> -&gt;</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> derive_cst</span><span class="id"> scaler0</span><span class="id"> add0r</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> deriveMl</span><span class="id"> f</span> (<span class="id">r</span><span class="id"> :</span><span class="id"> R</span>) (<span class="id">x</span><span class="id"> v</span><span class="id"> :</span><span class="id"> V</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">derivable</span><span class="id"> f</span><span class="id"> x</span><span class="id"> v</span><span class="id"> -&gt;</span><span class="id"> 'D_v</span> (<span class="id">r</span><span class="id"> \*o</span><span class="id"> f</span>)<span class="id"> x</span><span class="id"> =</span> (<span class="id">r</span><span class="id"> *</span><span class="id"> 'D_v</span><span class="id"> f</span><span class="id"> x</span>)<span class="id">%R</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> fxv;</span><span class="id"> rewrite</span><span class="id"> -deriveMr//</span><span class="id"> mul_funC</span>. Qed.</div></details>
<br/>
<span class="id">Global</span><span class="vernacular"> Instance</span><span class="id"> is_deriveM</span><span class="id"> f</span><span class="id"> g</span> (<span class="id">x</span><span class="id"> v</span><span class="id"> :</span><span class="id"> V</span>) (<span class="id">df</span><span class="id"> dg</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">is_derive</span><span class="id"> x</span><span class="id"> v</span><span class="id"> f</span><span class="id"> df</span><span class="id"> -&gt;</span><span class="id"> is_derive</span><span class="id"> x</span><span class="id"> v</span><span class="id"> g</span><span class="id"> dg</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">is_derive</span><span class="id"> x</span><span class="id"> v</span> (<span class="id">f</span><span class="id"> *</span><span class="id"> g</span>) (<span class="id">f</span><span class="id"> x</span><span class="id"> *:</span><span class="id"> dg</span><span class="id"> +</span><span class="id"> g</span><span class="id"> x</span><span class="id"> *:</span><span class="id"> df</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> dfx</span><span class="id"> dgx;</span><span class="id"> apply:</span><span class="id"> DeriveDef;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> derivableM</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> deriveM</span><span class="id"> //</span><span class="id"> !derive_val</span>.<br/>
Qed.</div></details>
<br/>
<span class="id">Global</span><span class="vernacular"> Instance</span><span class="id"> is_deriveX</span><span class="id"> f</span><span class="id"> n</span> (<span class="id">x</span><span class="id"> v</span><span class="id"> :</span><span class="id"> V</span>) (<span class="id">df</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">is_derive</span><span class="id"> x</span><span class="id"> v</span><span class="id"> f</span><span class="id"> df</span><span class="id"> -&gt;</span><span class="id"> is_derive</span><span class="id"> x</span><span class="id"> v</span> (<span class="id">f</span><span class="id"> ^+</span><span class="id"> n</span>.<span class="id">+1</span>) ((<span class="id">n</span>.<span class="id">+1%:R</span><span class="id"> *</span><span class="id"> f</span><span class="id"> x</span><span class="id"> ^+n</span>)<span class="id"> *:</span><span class="id"> df</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> dfx;</span><span class="id"> elim:</span><span class="id"> n</span><span class="id"> =&gt;</span><span class="id"> [|n</span><span class="id"> ihn];</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> expr1</span><span class="id"> expr0</span><span class="id"> mulr1</span><span class="id"> scale1r</span>.<br/>
<span class="id">rewrite</span><span class="id"> exprS;</span><span class="id"> apply:</span><span class="id"> is_derive_eq</span>.<br/>
<span class="id">rewrite</span><span class="id"> scalerA</span><span class="id"> -scalerDl</span><span class="id"> mulrCA</span><span class="id"> -[f</span><span class="id"> x</span><span class="id"> *</span><span class="id"> _]exprS</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> [in</span><span class="id"> LHS]mulr_natl</span><span class="id"> exprfctE</span><span class="id"> -mulrSr</span><span class="id"> mulr_natl</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> derivableX</span><span class="id"> f</span><span class="id"> n</span> (<span class="id">x</span><span class="id"> v</span><span class="id"> :</span><span class="id"> V</span>)<span class="id"> :</span><span class="id"> derivable</span><span class="id"> f</span><span class="id"> x</span><span class="id"> v</span><span class="id"> -&gt;</span><span class="id"> derivable</span> (<span class="id">f</span><span class="id"> ^+</span><span class="id"> n</span>)<span class="id"> x</span><span class="id"> v</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> case:</span><span class="id"> n</span><span class="id"> =&gt;</span><span class="id"> [_|n</span><span class="id"> /derivableP];</span><span class="id"> [rewrite</span><span class="id"> expr0|]</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> deriveX</span><span class="id"> f</span><span class="id"> n</span> (<span class="id">x</span><span class="id"> v</span><span class="id"> :</span><span class="id"> V</span>)<span class="id"> :</span><span class="id"> derivable</span><span class="id"> f</span><span class="id"> x</span><span class="id"> v</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">'D_v</span> (<span class="id">f</span><span class="id"> ^+</span><span class="id"> n</span>.<span class="id">+1</span>)<span class="id"> x</span><span class="id"> =</span> (<span class="id">n</span>.<span class="id">+1%:R</span><span class="id"> *</span><span class="id"> f</span><span class="id"> x</span><span class="id"> ^+</span><span class="id"> n</span>)<span class="id"> *:</span><span class="id"> 'D_v</span><span class="id"> f</span><span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> /derivableP</span><span class="id"> df;</span><span class="id"> rewrite</span><span class="id"> derive_val</span>. Qed.</div></details>
<br/>
<span class="vernacular">Fact</span><span class="id"> der_inv</span><span class="id"> f</span> (<span class="id">x</span><span class="id"> v</span><span class="id"> :</span><span class="id"> V</span>)<span class="id"> :</span><span class="id"> f</span><span class="id"> x</span><span class="id"> !=</span><span class="id"> 0</span><span class="id"> -&gt;</span><span class="id"> derivable</span><span class="id"> f</span><span class="id"> x</span><span class="id"> v</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">fun</span><span class="id"> h</span><span class="id"> =&gt;</span><span class="id"> h^-1</span><span class="id"> *:</span> (((<span class="gallina-kwd">fun</span><span class="id"> y</span><span class="id"> =&gt;</span> (<span class="id">f</span><span class="id"> y</span>)<span class="id">^-1</span>)<span class="id"> \o</span><span class="id"> shift</span><span class="id"> x</span>) (<span class="id">h</span><span class="id"> *:</span><span class="id"> v</span>)<span class="id"> -</span> (<span class="id">f</span><span class="id"> x</span>)<span class="id">^-1</span>))<span class="id"> @</span><br/>
&nbsp;&nbsp;<span class="id">0^'</span><span class="id"> --&gt;</span><span class="id"> -</span> (<span class="id">f</span><span class="id"> x</span>)<span class="id"> ^-2</span><span class="id"> *:</span><span class="id"> 'D_v</span><span class="id"> f</span><span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> fxn0</span><span class="id"> df</span>.<br/>
<span class="id">have</span><span class="id"> /derivable1P/derivable1_diffP/differentiable_continuous</span><span class="id"> :=</span><span class="id"> df</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> /continuous_withinNx;</span><span class="id"> rewrite</span><span class="id"> scale0r</span><span class="id"> add0r</span><span class="id"> =&gt;</span><span class="id"> fc</span>.<br/>
<span class="id">have</span><span class="id"> fn0</span><span class="id"> :</span><span class="id"> 0^'</span><span class="id"> [set</span><span class="id"> h</span><span class="id"> |</span><span class="id"> f</span> (<span class="id">h</span><span class="id"> *:</span><span class="id"> v</span><span class="id"> +</span><span class="id"> x</span>)<span class="id"> !=</span><span class="id"> 0]</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span> (<span class="id">fc</span><span class="id"> [set</span><span class="id"> x</span><span class="id"> |</span><span class="id"> x</span><span class="id"> !=</span><span class="id"> 0]</span>)<span class="id">;</span><span class="gallina-kwd"> exists</span><span class="id"> `|f</span><span class="id"> x|;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> /=</span><span class="id"> normr_gt0</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> y;</span><span class="id"> rewrite</span><span class="id"> /=</span><span class="id"> =&gt;</span><span class="id"> yltfx</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply/eqP</span><span class="id"> =&gt;</span><span class="id"> y0;</span><span class="id"> move:</span><span class="id"> yltfx;</span><span class="id"> rewrite</span><span class="id"> y0</span><span class="id"> subr0</span><span class="id"> ltxx</span>.<br/>
<span class="id">have</span><span class="id"> :</span> (<span class="gallina-kwd">fun</span><span class="id"> h</span><span class="id"> =&gt;</span><span class="id"> -</span> ((<span class="id">f</span><span class="id"> x</span>)<span class="id">^-1</span><span class="id"> *</span> (<span class="id">f</span> (<span class="id">h</span><span class="id"> *:</span><span class="id"> v</span><span class="id"> +</span><span class="id"> x</span>))<span class="id">^-1</span>)<span class="id"> *:</span><br/>
&nbsp;&nbsp;(<span class="id">h^-1</span><span class="id"> *:</span> (<span class="id">f</span> (<span class="id">h</span><span class="id"> *:</span><span class="id"> v</span><span class="id"> +</span><span class="id"> x</span>)<span class="id"> -</span><span class="id"> f</span><span class="id"> x</span>)))<span class="id"> @</span><span class="id"> 0^'</span><span class="id"> --&gt;</span><br/>
&nbsp;&nbsp;<span class="id">-</span> (<span class="id">f</span><span class="id"> x</span>)<span class="id"> ^-</span><span class="id"> 2</span><span class="id"> *:</span><span class="id"> 'D_v</span><span class="id"> f</span><span class="id"> x</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> cvgM</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> apply:</span><span class="id"> cvgN;</span><span class="id"> rewrite</span><span class="id"> expr2</span><span class="id"> invfM;</span><span class="id"> apply:</span><span class="id"> cvgM;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">[exact:</span><span class="id"> cvg_cst|</span> <span class="id"> exact:</span><span class="id"> cvgV]</span>.<br/>
<span class="id">apply:</span><span class="id"> cvg_trans</span><span class="id"> =&gt;</span><span class="id"> A</span><span class="id"> [_/posnumP[e]</span><span class="id"> /=</span><span class="id"> Ae]</span>.<br/>
<span class="id">move:</span><span class="id"> fn0;</span><span class="id"> apply:</span><span class="id"> filter_app;</span><span class="id"> near=&gt;</span><span class="id"> h</span><span class="id"> =&gt;</span><span class="id"> /=</span><span class="id"> fhvxn0</span>.<br/>
<span class="id">have</span><span class="id"> he</span><span class="id"> :</span><span class="id"> ball</span><span class="id"> 0</span><span class="id"> e%:num</span> (<span class="id">h</span><span class="id"> :</span><span class="id"> R</span>)<span class="gallina-kwd"> by</span><span class="id"> near:</span><span class="id"> h;</span><span class="gallina-kwd"> exists</span><span class="id"> e%:num</span><span class="id"> =&gt;</span><span class="id"> /=</span>.<br/>
<span class="id">have</span><span class="id"> hn0</span><span class="id"> :</span><span class="id"> h</span><span class="id"> !=</span><span class="id"> 0</span><span class="gallina-kwd"> by</span><span class="id"> near:</span><span class="id"> h;</span><span class="gallina-kwd"> exists</span><span class="id"> e%:num</span><span class="id"> =&gt;</span><span class="id"> /=</span>.<br/>
<span class="id">suff</span><span class="id"> &lt;-</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">-</span> ((<span class="id">f</span><span class="id"> x</span>)<span class="id">^-1</span><span class="id"> *</span> (<span class="id">f</span> (<span class="id">h</span><span class="id"> *:</span><span class="id"> v</span><span class="id"> +</span><span class="id"> x</span>))<span class="id">^-1</span>)<span class="id"> *:</span> (<span class="id">h^-1</span><span class="id"> *:</span> (<span class="id">f</span> (<span class="id">h</span><span class="id"> *:</span><span class="id"> v</span><span class="id"> +</span><span class="id"> x</span>)<span class="id"> -</span><span class="id"> f</span><span class="id"> x</span>))<span class="id"> =</span><br/>
&nbsp;&nbsp;<span class="id">h^-1</span><span class="id"> *:</span> ((<span class="id">f</span> (<span class="id">h</span><span class="id"> *:</span><span class="id"> v</span><span class="id"> +</span><span class="id"> x</span>))<span class="id">^-1</span><span class="id"> -</span> (<span class="id">f</span><span class="id"> x</span>)<span class="id">^-1</span>)<span class="gallina-kwd"> by</span><span class="id"> exact:</span><span class="id"> Ae</span>.<br/>
<span class="id">rewrite</span><span class="id"> scalerA</span><span class="id"> mulrC</span><span class="id"> -scalerA;</span><span class="id"> congr</span> (_<span class="id"> *:</span><span class="id"> _</span>).<br/>
<span class="id">apply/eqP;</span><span class="id"> rewrite</span><span class="id"> scaleNr</span><span class="id"> eqr_oppLR</span><span class="id"> opprB</span><span class="id"> scalerBr</span>.<br/>
<span class="id">rewrite</span><span class="id"> -scalerA</span><span class="id"> [_</span><span class="id"> *:</span><span class="id"> f</span><span class="id"> _]mulVf</span><span class="id"> //</span><span class="id"> [_%:A]mulr1</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> mulrC</span><span class="id"> -scalerA</span><span class="id"> [_</span><span class="id"> *:</span><span class="id"> f</span><span class="id"> _]mulVf</span><span class="id"> //</span><span class="id"> [_%:A]mulr1</span>.<br/>
<span class="id">Unshelve</span>.<span class="id"> all:</span><span class="gallina-kwd"> by</span><span class="id"> end_near</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> deriveV</span><span class="id"> f</span><span class="id"> x</span><span class="id"> v</span><span class="id"> :</span><span class="id"> f</span><span class="id"> x</span><span class="id"> !=</span><span class="id"> 0</span><span class="id"> -&gt;</span><span class="id"> derivable</span><span class="id"> f</span><span class="id"> x</span><span class="id"> v</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">'D_v</span> (<span class="gallina-kwd">fun</span><span class="id"> y</span><span class="id"> =&gt;</span> (<span class="id">f</span><span class="id"> y</span>)<span class="id">^-1</span>)<span class="id"> x</span><span class="id"> =</span><span class="id"> -</span> (<span class="id">f</span><span class="id"> x</span>)<span class="id"> ^-</span><span class="id"> 2</span><span class="id"> *:</span><span class="id"> 'D_v</span><span class="id"> f</span><span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> fxn0</span><span class="id"> df;</span><span class="id"> apply:</span><span class="id"> cvg_lim</span> (<span class="id">der_inv</span><span class="id"> fxn0</span><span class="id"> df</span>). Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> derivableV</span><span class="id"> f</span> (<span class="id">x</span><span class="id"> v</span><span class="id"> :</span><span class="id"> V</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">f</span><span class="id"> x</span><span class="id"> !=</span><span class="id"> 0</span><span class="id"> -&gt;</span><span class="id"> derivable</span><span class="id"> f</span><span class="id"> x</span><span class="id"> v</span><span class="id"> -&gt;</span><span class="id"> derivable</span> (<span class="gallina-kwd">fun</span><span class="id"> y</span><span class="id"> =&gt;</span> (<span class="id">f</span><span class="id"> y</span>)<span class="id">^-1</span>)<span class="id"> x</span><span class="id"> v</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> df</span><span class="id"> dg;</span><span class="id"> apply/cvg_ex;</span><span class="gallina-kwd"> exists</span> (<span class="id">-</span> (<span class="id">f</span><span class="id"> x</span>)<span class="id"> ^-</span><span class="id"> 2</span><span class="id"> *:</span><span class="id"> 'D_v</span><span class="id"> f</span><span class="id"> x</span>).<br/>
<span class="id">exact:</span><span class="id"> der_inv</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> Derive_lemmasVR</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> derive1_cst</span><span class="id"> {R</span><span class="id"> :</span><span class="id"> numFieldType}</span> (<span class="id">k</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> t</span><span class="id"> :</span> (<span class="id">cst</span><span class="id"> k</span>)<span class="id">^`</span>()<span class="id"> t</span><span class="id"> =</span><span class="id"> 0</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> derive1E</span><span class="id"> derive_cst</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> exprn_derivable</span><span class="id"> {R</span><span class="id"> :</span><span class="id"> numFieldType}</span><span class="id"> n</span> (<span class="id">x</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> v</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">derivable</span> (<span class="id">@GRing</span>.<span class="id">exp</span><span class="id"> R</span><span class="id"> ^~</span><span class="id"> n</span>)<span class="id"> x</span><span class="id"> v</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">elim:</span><span class="id"> n</span><span class="id"> =&gt;</span><span class="id"> [/=|n</span><span class="id"> ih];</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span> (_<span class="id"> :</span><span class="id"> _</span><span class="id"> ^~</span><span class="id"> _</span><span class="id"> =</span><span class="id"> 1</span>).<br/>
<span class="id">rewrite</span> (_<span class="id"> :</span><span class="id"> _</span><span class="id"> ^~</span><span class="id"> _</span><span class="id"> =</span> (<span class="gallina-kwd">fun</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> *</span><span class="id"> x</span><span class="id"> ^+</span><span class="id"> n</span>))<span class="id">;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply/funext</span><span class="id"> =&gt;</span><span class="id"> y;</span><span class="id"> rewrite</span><span class="id"> exprS</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> derivableM;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> derivable_id</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> exp_derive</span><span class="id"> {R</span><span class="id"> :</span><span class="id"> numFieldType}</span><span class="id"> n</span><span class="id"> x</span><span class="id"> v</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">'D_v</span> (<span class="id">@GRing</span>.<span class="id">exp</span><span class="id"> R</span><span class="id"> ^~</span><span class="id"> n</span>.<span class="id">+1</span>)<span class="id"> x</span><span class="id"> =</span><span class="id"> n</span>.<span class="id">+1%:R</span><span class="id"> *:</span><span class="id"> x</span><span class="id"> ^+</span><span class="id"> n</span><span class="id"> *:</span><span class="id"> v</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">have</span><span class="id"> /=</span><span class="id"> :=</span><span class="id"> @deriveX</span><span class="id"> R</span><span class="id"> R</span><span class="id"> id</span><span class="id"> n</span><span class="id"> x</span><span class="id"> v</span> (<span class="id">@derivable_id</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span>).<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> fctE</span><span class="id"> =&gt;</span><span class="id"> -&gt;;</span><span class="id"> rewrite</span><span class="id"> derive_id</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> exp_derive1</span><span class="id"> {R</span><span class="id"> :</span><span class="id"> numFieldType}</span><span class="id"> n</span><span class="id"> x</span><span class="id"> :</span><br/>
&nbsp;&nbsp;(<span class="id">@GRing</span>.<span class="id">exp</span><span class="id"> R</span><span class="id"> ^~</span><span class="id"> n</span>.<span class="id">+1</span>)<span class="id">^`</span>()<span class="id"> x</span><span class="id"> =</span><span class="id"> n</span>.<span class="id">+1%:R</span><span class="id"> *:</span><span class="id"> x</span><span class="id"> ^+</span><span class="id"> n</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> derive1E</span><span class="id"> exp_derive</span><span class="id"> [LHS]mulr1</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> EVT_max</span> (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> R</span>) (<span class="id">a</span><span class="id"> b</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span> <br/>
&nbsp;&nbsp;<span class="id">a</span><span class="id"> &lt;=</span><span class="id"> b</span><span class="id"> -&gt;</span><span class="id"> {within</span><span class="id"> `[a,</span><span class="id"> b],</span><span class="id"> continuous</span><span class="id"> f}</span><span class="id"> -&gt;</span><span class="gallina-kwd"> exists2</span><span class="id"> c,</span><span class="id"> c</span><span class="id"> \in</span><span class="id"> `[a,</span><span class="id"> b]%R</span><span class="id"> &amp;</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">forall</span><span class="id"> t,</span><span class="id"> t</span><span class="id"> \in</span><span class="id"> `[a,</span><span class="id"> b]%R</span><span class="id"> -&gt;</span><span class="id"> f</span><span class="id"> t</span><span class="id"> &lt;=</span><span class="id"> f</span><span class="id"> c</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> leab</span><span class="id"> fcont;</span><span class="id"> set</span><span class="id"> imf</span><span class="id"> :=</span><span class="id"> f</span><span class="id"> @`</span><span class="id"> `[a,</span><span class="id"> b]</span>.<br/>
<span class="id">have</span><span class="id"> imf_sup</span><span class="id"> :</span><span class="id"> has_sup</span><span class="id"> imf</span>.<br/>
&nbsp;&nbsp;<span class="id">split;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="gallina-kwd"> exists</span> (<span class="id">f</span><span class="id"> a</span>)<span class="id">;</span><span class="id"> apply/imageP;</span><span class="id"> rewrite</span><span class="id"> /=</span><span class="id"> in_itv</span><span class="id"> /=</span><span class="id"> lexx</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> [M</span><span class="id"> [Mreal</span><span class="id"> imfltM]]</span><span class="id"> :</span><span class="id"> bounded_set</span> (<span class="id">f</span><span class="id"> @`</span><span class="id"> `[a,</span><span class="id"> b]</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply/compact_bounded/continuous_compact</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> segment_compact</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">exists</span> (<span class="id">M</span><span class="id"> +</span><span class="id"> 1</span>)<span class="id"> =&gt;</span><span class="id"> y</span><span class="id"> /imfltM</span><span class="id"> yleM</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span> (<span class="id">le_trans</span><span class="id"> _</span> (<span class="id">yleM</span><span class="id"> _</span><span class="id"> _</span>))<span class="id"> ?ler_norm</span><span class="id"> ?ltrDl</span>.<br/>
<span class="id">have</span><span class="id"> [|imf_ltsup]</span><span class="id"> :=</span><span class="id"> pselect</span> (<span class="gallina-kwd">exists2</span><span class="id"> c,</span><span class="id"> c</span><span class="id"> \in</span><span class="id"> `[a,</span><span class="id"> b]%R</span><span class="id"> &amp;</span><span class="id"> f</span><span class="id"> c</span><span class="id"> =</span><span class="id"> sup</span><span class="id"> imf</span>).<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> [c</span><span class="id"> cab</span><span class="id"> fceqsup];</span><span class="gallina-kwd"> exists</span><span class="id"> c</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> t</span><span class="id"> tab;</span><span class="id"> rewrite</span><span class="id"> fceqsup</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply/sup_upper_bound</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact/imageP</span>.<br/>
<span class="id">have</span><span class="id"> {}imf_ltsup</span><span class="id"> t</span><span class="id"> :</span><span class="id"> t</span><span class="id"> \in</span><span class="id"> `[a,</span><span class="id"> b]%R</span><span class="id"> -&gt;</span><span class="id"> f</span><span class="id"> t</span><span class="id"> &lt;</span><span class="id"> sup</span><span class="id"> imf</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> tab;</span><span class="id"> case:</span> (<span class="id">ltrP</span> (<span class="id">f</span><span class="id"> t</span>) (<span class="id">sup</span><span class="id"> imf</span>))<span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> supleft</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> falseE;</span><span class="id"> apply:</span><span class="id"> imf_ltsup;</span><span class="gallina-kwd"> exists</span><span class="id"> t</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> apply/eqP</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> eq_le</span><span class="id"> supleft</span><span class="id"> andbT</span><span class="id"> sup_upper_bound//;</span><span class="id"> exact/imageP</span>.<br/>
<span class="id">pose</span><span class="id"> g</span><span class="id"> t</span><span class="id"> :</span><span class="id"> R</span><span class="id"> :=</span> (<span class="id">sup</span><span class="id"> imf</span><span class="id"> -</span><span class="id"> f</span><span class="id"> t</span>)<span class="id">^-1</span>.<br/>
<span class="id">have</span><span class="id"> invf_continuous</span><span class="id"> :</span><span class="id"> {within</span><span class="id"> `[a,</span><span class="id"> b],</span><span class="id"> continuous</span><span class="id"> g}</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> continuous_subspace_in</span><span class="id"> =&gt;</span><span class="id"> t</span><span class="id"> tab;</span><span class="id"> apply:</span><span class="id"> cvgV</span><span class="id"> =&gt;</span><span class="id"> //=</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> subr_eq0</span><span class="id"> gt_eqF</span><span class="id"> //</span><span class="id"> imf_ltsup</span><span class="id"> //;</span><span class="id"> rewrite</span><span class="id"> inE</span><span class="gallina-kwd"> in</span><span class="id"> tab</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> cvgD;</span><span class="id"> [exact:</span><span class="id"> cst_continuous</span><span class="id"> |</span><span class="id"> apply:</span><span class="id"> cvgN;</span><span class="id"> exact:</span> (<span class="id">fcont</span><span class="id"> t</span>)<span class="id">]</span>.<br/>
<span class="id">have</span><span class="id"> /ex_strict_bound_gt0</span><span class="id"> [k</span><span class="id"> k_gt0</span><span class="id"> /=</span><span class="id"> imVfltk]</span><span class="id"> :</span><span class="id"> bounded_set</span> (<span class="id">g</span><span class="id"> @`</span><span class="id"> `[a,</span><span class="id"> b]</span>).<br/>
&nbsp;&nbsp;<span class="id">apply/compact_bounded/continuous_compact;</span><span class="id"> last</span><span class="id"> exact:</span><span class="id"> segment_compact</span>.<br/>
&nbsp;&nbsp;<span class="id">exact:</span><span class="id"> invf_continuous</span>.<br/>
<span class="id">have</span><span class="id"> [_</span><span class="id"> [t</span><span class="id"> tab</span><span class="id"> &lt;-]]</span><span class="id"> :</span><span class="gallina-kwd"> exists2</span><span class="id"> y,</span><span class="id"> imf</span><span class="id"> y</span><span class="id"> &amp;</span><span class="id"> sup</span><span class="id"> imf</span><span class="id"> -</span><span class="id"> k^-1</span><span class="id"> &lt;</span><span class="id"> y</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> sup_adherent</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> rewrite</span><span class="id"> invr_gt0</span>.<br/>
<span class="id">rewrite</span><span class="id"> ltrBlDr</span><span class="id"> -ltrBlDl</span>.<br/>
<span class="id">suff</span><span class="id"> :</span><span class="id"> sup</span><span class="id"> imf</span><span class="id"> -</span><span class="id"> f</span><span class="id"> t</span><span class="id"> &gt;</span><span class="id"> k^-1</span><span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> /ltW;</span><span class="id"> rewrite</span><span class="id"> leNgt</span><span class="id"> =&gt;</span><span class="id"> /negbTE</span><span class="id"> -&gt;</span>.<br/>
<span class="id">rewrite</span><span class="id"> -[ltRHS]invrK</span><span class="id"> ltf_pV2//</span><span class="id"> ?qualifE/=</span><span class="id"> ?invr_gt0</span><span class="id"> ?subr_gt0</span><span class="id"> ?imf_ltsup//</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span> (<span class="id">le_lt_trans</span> (<span class="id">ler_norm</span><span class="id"> _</span>)<span class="id"> _</span>)<span class="id"> ?imVfltk//;</span><span class="id"> exact:</span><span class="id"> imageP</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> EVT_min</span> (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> R</span>) (<span class="id">a</span><span class="id"> b</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">a</span><span class="id"> &lt;=</span><span class="id"> b</span><span class="id"> -&gt;</span><span class="id"> {within</span><span class="id"> `[a,</span><span class="id"> b],</span><span class="id"> continuous</span><span class="id"> f}</span><span class="id"> -&gt;</span><span class="gallina-kwd"> exists2</span><span class="id"> c,</span><span class="id"> c</span><span class="id"> \in</span><span class="id"> `[a,</span><span class="id"> b]%R</span><span class="id"> &amp;</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">forall</span><span class="id"> t,</span><span class="id"> t</span><span class="id"> \in</span><span class="id"> `[a,</span><span class="id"> b]%R</span><span class="id"> -&gt;</span><span class="id"> f</span><span class="id"> c</span><span class="id"> &lt;=</span><span class="id"> f</span><span class="id"> t</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> leab</span><span class="id"> fcont</span>.<br/>
<span class="id">have</span><span class="id"> /</span>(<span class="id">EVT_max</span><span class="id"> leab</span>)<span class="id"> [c</span><span class="id"> clr</span><span class="id"> fcmax]</span><span class="id"> :</span><span class="id"> {within</span><span class="id"> `[a,</span><span class="id"> b],</span><span class="id"> continuous</span> (<span class="id">-</span><span class="id"> f</span>)<span class="id">}</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> ?;</span><span class="id"> apply:</span><span class="id"> continuousN</span><span class="id"> =&gt;</span><span class="id"> ?;</span><span class="id"> exact:</span><span class="id"> fcont</span>.<br/>
<span class="gallina-kwd">by</span><span class="gallina-kwd"> exists</span><span class="id"> c</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> ?</span><span class="id"> /fcmax;</span><span class="id"> rewrite</span><span class="id"> lerN2</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> cvg_at_rightE</span> (<span class="id">R</span><span class="id"> :</span><span class="id"> numFieldType</span>) (<span class="id">V</span><span class="id"> :</span><span class="id"> normedModType</span><span class="id"> R</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> V</span>)<span class="id"> x</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">cvg</span> (<span class="id">f</span><span class="id"> @</span><span class="id"> x^'</span>)<span class="id"> -&gt;</span><span class="id"> lim</span> (<span class="id">f</span><span class="id"> @</span><span class="id"> x^'</span>)<span class="id"> =</span><span class="id"> lim</span> (<span class="id">f</span><span class="id"> @</span><span class="id"> at_right</span><span class="id"> x</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> cvfx;</span><span class="id"> apply/Logic</span>.<span class="id">eq_sym</span>.<br/>
<span class="id">apply:</span> (<span class="id">@cvg_lim</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">at_right</span><span class="id"> _</span>))<span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> A</span><span class="id"> /cvfx</span><span class="id"> /nbhs_ballP</span><span class="id"> [_</span><span class="id"> /posnumP[e]</span><span class="id"> xe_A]</span>.<br/>
<span class="gallina-kwd">by</span><span class="gallina-kwd"> exists</span><span class="id"> e%:num</span><span class="id"> =&gt;</span><span class="id"> //=</span><span class="id"> y</span><span class="id"> xe_y;</span><span class="id"> rewrite</span><span class="id"> lt_def</span><span class="id"> =&gt;</span><span class="id"> /andP</span><span class="id"> [xney</span><span class="id"> _];</span><span class="id"> apply:</span><span class="id"> xe_A</span>.<br/>
Qed.</div></details>
<span class="vernacular">Arguments</span><span class="id"> cvg_at_rightE</span><span class="id"> {R</span><span class="id"> V}</span><span class="id"> f</span><span class="id"> x</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> cvg_at_leftE</span> (<span class="id">R</span><span class="id"> :</span><span class="id"> numFieldType</span>) (<span class="id">V</span><span class="id"> :</span><span class="id"> normedModType</span><span class="id"> R</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> V</span>)<span class="id"> x</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">cvg</span> (<span class="id">f</span><span class="id"> @</span><span class="id"> x^'</span>)<span class="id"> -&gt;</span><span class="id"> lim</span> (<span class="id">f</span><span class="id"> @</span><span class="id"> x^'</span>)<span class="id"> =</span><span class="id"> lim</span> (<span class="id">f</span><span class="id"> @</span><span class="id"> at_left</span><span class="id"> x</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> cvfx;</span><span class="id"> apply/Logic</span>.<span class="id">eq_sym</span>.<br/>
<span class="id">apply:</span> (<span class="id">@cvg_lim</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">at_left</span><span class="id"> _</span>))<span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> A</span><span class="id"> /cvfx</span><span class="id"> /nbhs_ballP</span><span class="id"> [_</span><span class="id"> /posnumP[e]</span><span class="id"> xe_A]</span>.<br/>
<span class="gallina-kwd">exists</span><span class="id"> e%:num</span><span class="id"> =&gt;</span><span class="id"> //=</span><span class="id"> y</span><span class="id"> xe_y;</span><span class="id"> rewrite</span><span class="id"> lt_def</span><span class="id"> =&gt;</span><span class="id"> /andP</span><span class="id"> [xney</span><span class="id"> _]</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> xe_A</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> rewrite</span><span class="id"> eq_sym</span>.<br/>
Qed.</div></details>
<span class="vernacular">Arguments</span><span class="id"> cvg_at_leftE</span><span class="id"> {R</span><span class="id"> V}</span><span class="id"> f</span><span class="id"> x</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> __deprecated__le0r_cvg_map</span> (<span class="id">R</span><span class="id"> :</span><span class="id"> realFieldType</span>) (<span class="id">T</span><span class="id"> :</span><span class="id"> topologicalType</span>)<br/>
&nbsp;&nbsp;(<span class="id">F</span><span class="id"> :</span><span class="id"> set_system</span><span class="id"> T</span>) (<span class="id">FF</span><span class="id"> :</span><span class="id"> ProperFilter</span><span class="id"> F</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;(<span class="id">\forall</span><span class="id"> x</span><span class="id"> \near</span><span class="id"> F,</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> f</span><span class="id"> x</span>)<span class="id"> -&gt;</span><span class="id"> cvg</span> (<span class="id">f</span><span class="id"> @</span><span class="id"> F</span>)<span class="id"> -&gt;</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> lim</span> (<span class="id">f</span><span class="id"> @</span><span class="id"> F</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> ?</span><span class="id"> ?;</span><span class="id"> rewrite</span><span class="id"> limr_ge</span>. Qed.</div></details>
<span class="id">#[deprecated</span>(<span class="id">since=</span><span class="id">&quot;mathcomp-analysis 0.6.0&quot;</span><span class="id">,</span><br/>
&nbsp;&nbsp;<span class="id">note=</span><span class="id">&quot;generalized by `limr_ge`&quot;</span>)<span class="id">]</span><br/>
<span class="vernacular">Notation</span><span class="id"> le0r_cvg_map</span><span class="id"> :=</span><span class="id"> __deprecated__le0r_cvg_map</span> (<span class="id">only</span><span class="id"> parsing</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> __deprecated__ler0_cvg_map</span> (<span class="id">R</span><span class="id"> :</span><span class="id"> realFieldType</span>) (<span class="id">T</span><span class="id"> :</span><span class="id"> topologicalType</span>)<br/>
&nbsp;&nbsp;(<span class="id">F</span><span class="id"> :</span><span class="id"> set_system</span><span class="id"> T</span>) (<span class="id">FF</span><span class="id"> :</span><span class="id"> ProperFilter</span><span class="id"> F</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;(<span class="id">\forall</span><span class="id"> x</span><span class="id"> \near</span><span class="id"> F,</span><span class="id"> f</span><span class="id"> x</span><span class="id"> &lt;=</span><span class="id"> 0</span>)<span class="id"> -&gt;</span><span class="id"> cvg</span> (<span class="id">f</span><span class="id"> @</span><span class="id"> F</span>)<span class="id"> -&gt;</span><span class="id"> lim</span> (<span class="id">f</span><span class="id"> @</span><span class="id"> F</span>)<span class="id"> &lt;=</span><span class="id"> 0</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> ?</span><span class="id"> ?;</span><span class="id"> rewrite</span><span class="id"> limr_le</span>. Qed.</div></details>
<span class="id">#[deprecated</span>(<span class="id">since=</span><span class="id">&quot;mathcomp-analysis 0.6.0&quot;</span><span class="id">,</span><br/>
&nbsp;&nbsp;<span class="id">note=</span><span class="id">&quot;generalized by `limr_le`&quot;</span>)<span class="id">]</span><br/>
<span class="vernacular">Notation</span><span class="id"> ler0_cvg_map</span><span class="id"> :=</span><span class="id"> __deprecated__ler0_cvg_map</span> (<span class="id">only</span><span class="id"> parsing</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> __deprecated__ler_cvg_map</span> (<span class="id">R</span><span class="id"> :</span><span class="id"> realFieldType</span>) (<span class="id">T</span><span class="id"> :</span><span class="id"> topologicalType</span>)<br/>
&nbsp;&nbsp;(<span class="id">F</span><span class="id"> :</span><span class="id"> set_system</span><span class="id"> T</span>) (<span class="id">FF</span><span class="id"> :</span><span class="id"> ProperFilter</span><span class="id"> F</span>) (<span class="id">f</span><span class="id"> g</span><span class="id"> :</span><span class="id"> T</span><span class="id"> -&gt;</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;(<span class="id">\forall</span><span class="id"> x</span><span class="id"> \near</span><span class="id"> F,</span><span class="id"> f</span><span class="id"> x</span><span class="id"> &lt;=</span><span class="id"> g</span><span class="id"> x</span>)<span class="id"> -&gt;</span><span class="id"> cvg</span> (<span class="id">f</span><span class="id"> @</span><span class="id"> F</span>)<span class="id"> -&gt;</span><span class="id"> cvg</span> (<span class="id">g</span><span class="id"> @</span><span class="id"> F</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">lim</span> (<span class="id">f</span><span class="id"> @</span><span class="id"> F</span>)<span class="id"> &lt;=</span><span class="id"> lim</span> (<span class="id">g</span><span class="id"> @</span><span class="id"> F</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> ?</span><span class="id"> ?</span><span class="id"> ?;</span><span class="id"> rewrite</span><span class="id"> ler_lim</span>. Qed.</div></details>
<span class="id">#[deprecated</span>(<span class="id">since=</span><span class="id">&quot;mathcomp-analysis 0.6.0&quot;</span><span class="id">,</span><br/>
&nbsp;&nbsp;<span class="id">note=</span><span class="id">&quot;subsumed by `ler_lim`&quot;</span>)<span class="id">]</span><br/>
<span class="vernacular">Notation</span><span class="id"> ler_cvg_map</span><span class="id"> :=</span><span class="id"> __deprecated__ler_cvg_map</span> (<span class="id">only</span><span class="id"> parsing</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> derive1_at_max</span> (<span class="id">R</span><span class="id"> :</span><span class="id"> realFieldType</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> R</span>) (<span class="id">a</span><span class="id"> b</span><span class="id"> c</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">a</span><span class="id"> &lt;=</span><span class="id"> b</span><span class="id"> -&gt;</span> (<span class="gallina-kwd">forall</span><span class="id"> t,</span><span class="id"> t</span><span class="id"> \in</span><span class="id"> `]a,</span><span class="id"> b[%R</span><span class="id"> -&gt;</span><span class="id"> derivable</span><span class="id"> f</span><span class="id"> t</span><span class="id"> 1</span>)<span class="id"> -&gt;</span><span class="id"> c</span><span class="id"> \in</span><span class="id"> `]a,</span><span class="id"> b[%R</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">forall</span><span class="id"> t,</span><span class="id"> t</span><span class="id"> \in</span><span class="id"> `]a,</span><span class="id"> b[%R</span><span class="id"> -&gt;</span><span class="id"> f</span><span class="id"> t</span><span class="id"> &lt;=</span><span class="id"> f</span><span class="id"> c</span>)<span class="id"> -&gt;</span><span class="id"> is_derive</span><span class="id"> c</span><span class="id"> 1</span><span class="id"> f</span><span class="id"> 0</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> leab</span><span class="id"> fdrvbl</span><span class="id"> cab</span><span class="id"> cmax;</span><span class="id"> apply:</span><span class="id"> DeriveDef;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> fdrvbl</span>.<br/>
<span class="id">apply/eqP;</span><span class="id"> rewrite</span><span class="id"> eq_le;</span><span class="id"> apply/andP;</span><span class="id"> split</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> ['D_1</span><span class="id"> f</span><span class="id"> c]cvg_at_rightE;</span><span class="id"> last</span><span class="id"> exact:</span><span class="id"> fdrvbl</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> limr_le</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">have</span><span class="id"> /fdrvbl</span><span class="id"> dfc</span><span class="id"> :=</span><span class="id"> cab</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> -</span>(<span class="id">cvg_at_rightE</span> (<span class="gallina-kwd">fun</span><span class="id"> h</span><span class="id"> :</span><span class="id"> R</span><span class="id"> =&gt;</span><span class="id"> h^-1</span><span class="id"> *:</span> ((<span class="id">f</span><span class="id"> \o</span><span class="id"> shift</span><span class="id"> c</span>)<span class="id"> _</span><span class="id"> -</span><span class="id"> f</span><span class="id"> c</span>)))<span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> cvg_trans</span><span class="id"> dfc;</span><span class="id"> apply:</span><span class="id"> cvg_app</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> A</span><span class="id"> [e</span><span class="id"> egt0</span><span class="id"> Ae];</span><span class="gallina-kwd"> exists</span><span class="id"> e</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> x</span><span class="id"> xe</span><span class="id"> xgt0;</span><span class="id"> apply:</span><span class="id"> Ae</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">exact/lt0r_neq0</span>.<br/>
&nbsp;&nbsp;<span class="id">near=&gt;</span><span class="id"> h;</span><span class="id"> apply:</span><span class="id"> mulr_ge0_le0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> invr_ge0;</span><span class="id"> apply:</span><span class="id"> ltW;</span><span class="id"> near:</span><span class="id"> h;</span><span class="gallina-kwd"> exists</span><span class="id"> 1</span><span class="id"> =&gt;</span><span class="id"> /=</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> subr_le0</span><span class="id"> [_%:A]mulr1;</span><span class="id"> apply:</span><span class="id"> cmax;</span><span class="id"> near:</span><span class="id"> h</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">exists</span> (<span class="id">b</span><span class="id"> -</span><span class="id"> c</span>)<span class="id">;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> /=</span><span class="id"> subr_gt0</span> (<span class="id">itvP</span><span class="id"> cab</span>).<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> h;</span><span class="id"> rewrite</span><span class="id"> /=</span><span class="id"> distrC</span><span class="id"> subr0</span><span class="id"> /=</span><span class="id"> in_itv</span><span class="id"> /=</span><span class="id"> -ltrBrDr</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> /</span>(<span class="id">le_lt_trans</span> (<span class="id">ler_norm</span><span class="id"> _</span>))<span class="id"> -&gt;</span><span class="id"> /ltr_pDl</span><span class="id"> -&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span> (<span class="id">itvP</span><span class="id"> cab</span>).<br/>
<span class="id">rewrite</span><span class="id"> ['D_1</span><span class="id"> f</span><span class="id"> c]cvg_at_leftE;</span><span class="id"> last</span><span class="id"> exact:</span><span class="id"> fdrvbl</span>.<br/>
<span class="id">apply:</span><span class="id"> limr_ge</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> /fdrvbl</span><span class="id"> dfc</span><span class="id"> :=</span><span class="id"> cab;</span><span class="id"> rewrite</span><span class="id"> -</span>(<span class="id">cvg_at_leftE</span> (<span class="gallina-kwd">fun</span><span class="id"> h</span><span class="id"> =&gt;</span><span class="id"> h^-1</span><span class="id"> *:</span> ((<span class="id">f</span><span class="id"> \o</span><span class="id"> shift</span><span class="id"> c</span>)<span class="id"> _</span><span class="id"> -</span><span class="id"> f</span><span class="id"> c</span>)))<span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> cvg_trans</span><span class="id"> dfc;</span><span class="id"> apply:</span><span class="id"> cvg_app</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> A</span><span class="id"> [e</span><span class="id"> egt0</span><span class="id"> Ae];</span><span class="gallina-kwd"> exists</span><span class="id"> e</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> x</span><span class="id"> xe</span><span class="id"> xgt0;</span><span class="id"> apply:</span><span class="id"> Ae</span><span class="id"> =&gt;</span><span class="id"> //</span>.<br/>
&nbsp;&nbsp;<span class="id">exact/ltr0_neq0</span>.<br/>
<span class="id">near=&gt;</span><span class="id"> h;</span><span class="id"> apply:</span><span class="id"> mulr_le0</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> invr_le0;</span><span class="id"> apply:</span><span class="id"> ltW;</span><span class="id"> near:</span><span class="id"> h;</span><span class="gallina-kwd"> exists</span><span class="id"> 1</span><span class="id"> =&gt;</span><span class="id"> /=</span>.<br/>
<span class="id">rewrite</span><span class="id"> subr_le0</span><span class="id"> [_%:A]mulr1;</span><span class="id"> apply:</span><span class="id"> cmax;</span><span class="id"> near:</span><span class="id"> h</span>.<br/>
<span class="gallina-kwd">exists</span> (<span class="id">c</span><span class="id"> -</span><span class="id"> a</span>)<span class="id">;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> /=</span><span class="id"> subr_gt0</span> (<span class="id">itvP</span><span class="id"> cab</span>).<br/>
<span class="id">move=&gt;</span><span class="id"> h;</span><span class="id"> rewrite</span><span class="id"> /=</span><span class="id"> distrC</span><span class="id"> subr0</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> /ltr_normlP</span><span class="id"> [];</span><span class="id"> rewrite</span><span class="id"> ltrBrDl</span><span class="id"> ltrBlDl</span><span class="id"> in_itv</span><span class="id"> /=</span><span class="id"> =&gt;</span><span class="id"> -&gt;</span><span class="id"> _</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> /ltr_nDl</span><span class="id"> -&gt;</span><span class="id"> //;</span><span class="id"> rewrite</span> (<span class="id">itvP</span><span class="id"> cab</span>).<br/>
<span class="id">Unshelve</span>.<span class="id"> all:</span><span class="gallina-kwd"> by</span><span class="id"> end_near</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> derive1_at_min</span> (<span class="id">R</span><span class="id"> :</span><span class="id"> realFieldType</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> R</span>) (<span class="id">a</span><span class="id"> b</span><span class="id"> c</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">a</span><span class="id"> &lt;=</span><span class="id"> b</span><span class="id"> -&gt;</span> (<span class="gallina-kwd">forall</span><span class="id"> t,</span><span class="id"> t</span><span class="id"> \in</span><span class="id"> `]a,</span><span class="id"> b[%R</span><span class="id"> -&gt;</span><span class="id"> derivable</span><span class="id"> f</span><span class="id"> t</span><span class="id"> 1</span>)<span class="id"> -&gt;</span><span class="id"> c</span><span class="id"> \in</span><span class="id"> `]a,</span><span class="id"> b[%R</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">forall</span><span class="id"> t,</span><span class="id"> t</span><span class="id"> \in</span><span class="id"> `]a,</span><span class="id"> b[%R</span><span class="id"> -&gt;</span><span class="id"> f</span><span class="id"> c</span><span class="id"> &lt;=</span><span class="id"> f</span><span class="id"> t</span>)<span class="id"> -&gt;</span><span class="id"> is_derive</span><span class="id"> c</span><span class="id"> 1</span><span class="id"> f</span><span class="id"> 0</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> leab</span><span class="id"> fdrvbl</span><span class="id"> cab</span><span class="id"> cmin;</span><span class="id"> apply:</span><span class="id"> DeriveDef;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> fdrvbl</span>.<br/>
<span class="id">apply/eqP;</span><span class="id"> rewrite</span><span class="id"> -oppr_eq0;</span><span class="id"> apply/eqP</span>.<br/>
<span class="id">rewrite</span><span class="id"> -deriveN;</span><span class="id"> last</span><span class="id"> exact:</span><span class="id"> fdrvbl</span>.<br/>
<span class="id">suff</span><span class="id"> df</span><span class="id"> :</span><span class="id"> is_derive</span><span class="id"> c</span><span class="id"> 1</span> (<span class="id">-</span><span class="id"> f</span>)<span class="id"> 0</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> derive_val</span>.<br/>
<span class="id">apply:</span><span class="id"> derive1_at_max</span><span class="id"> leab</span><span class="id"> _</span> (<span class="id">cab</span>)<span class="id"> _</span><span class="id"> =&gt;</span><span class="id"> t</span><span class="id"> tab;</span><span class="id"> first</span><span class="id"> exact/derivableN/fdrvbl</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> lerN2;</span><span class="id"> apply:</span><span class="id"> cmin</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> Rolle</span> (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> R</span>) (<span class="id">a</span><span class="id"> b</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">a</span><span class="id"> &lt;</span><span class="id"> b</span><span class="id"> -&gt;</span> (<span class="gallina-kwd">forall</span><span class="id"> x,</span><span class="id"> x</span><span class="id"> \in</span><span class="id"> `]a,</span><span class="id"> b[%R</span><span class="id"> -&gt;</span><span class="id"> derivable</span><span class="id"> f</span><span class="id"> x</span><span class="id"> 1</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">{within</span><span class="id"> `[a,</span><span class="id"> b],</span><span class="id"> continuous</span><span class="id"> f}</span><span class="id"> -&gt;</span><span class="id"> f</span><span class="id"> a</span><span class="id"> =</span><span class="id"> f</span><span class="id"> b</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">exists2</span><span class="id"> c,</span><span class="id"> c</span><span class="id"> \in</span><span class="id"> `]a,</span><span class="id"> b[%R</span><span class="id"> &amp;</span><span class="id"> is_derive</span><span class="id"> c</span><span class="id"> 1</span><span class="id"> f</span><span class="id"> 0</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> ltab</span><span class="id"> fdrvbl</span><span class="id"> fcont</span><span class="id"> faefb</span>.<br/>
<span class="id">have</span><span class="id"> [cmax</span><span class="id"> cmaxab</span><span class="id"> fcmax]</span><span class="id"> :=</span><span class="id"> EVT_max</span> (<span class="id">ltW</span><span class="id"> ltab</span>)<span class="id"> fcont</span>.<br/>
<span class="id">have</span><span class="id"> [cmaxeaVb|]</span><span class="id"> :=</span><span class="id"> boolP</span> (<span class="id">cmax</span><span class="id"> \in</span><span class="id"> [set</span><span class="id"> a;</span><span class="id"> b]</span>)<span class="id">;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> notin_setE</span><span class="id"> =&gt;</span><span class="id"> /not_orP[/eqP</span><span class="id"> cnea</span><span class="id"> /eqP</span><span class="id"> cneb]</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> {}cmaxab</span><span class="id"> :</span><span class="id"> cmax</span><span class="id"> \in</span><span class="id"> `]a,</span><span class="id"> b[%R</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> in_itv</span><span class="id"> /=</span><span class="id"> !lt_def</span><span class="id"> !</span>(<span class="id">itvP</span><span class="id"> cmaxab</span>)<span class="id"> cnea</span><span class="id"> eq_sym</span><span class="id"> cneb</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">exists</span><span class="id"> cmax</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> apply:</span><span class="id"> derive1_at_max</span> (<span class="id">ltW</span><span class="id"> ltab</span>)<span class="id"> fdrvbl</span><span class="id"> cmaxab</span><span class="id"> _</span><span class="id"> =&gt;</span><span class="id"> t</span><span class="id"> tab</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> fcmax;</span><span class="id"> rewrite</span><span class="id"> in_itv</span><span class="id"> /=</span><span class="id"> !ltW</span><span class="id"> //</span> (<span class="id">itvP</span><span class="id"> tab</span>).<br/>
<span class="id">have</span><span class="id"> [cmin</span><span class="id"> cminab</span><span class="id"> fcmin]</span><span class="id"> :=</span><span class="id"> EVT_min</span> (<span class="id">ltW</span><span class="id"> ltab</span>)<span class="id"> fcont</span>.<br/>
<span class="id">have</span><span class="id"> [cmineaVb|]</span><span class="id"> :=</span><span class="id"> boolP</span> (<span class="id">cmin</span><span class="id"> \in</span><span class="id"> [set</span><span class="id"> a;</span><span class="id"> b]</span>)<span class="id">;</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> notin_setE</span><span class="id"> =&gt;</span><span class="id"> /not_orP[/eqP</span><span class="id"> cnea</span><span class="id"> /eqP</span><span class="id"> cneb]</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> {}cminab</span><span class="id"> :</span><span class="id"> cmin</span><span class="id"> \in</span><span class="id"> `]a,</span><span class="id"> b[%R</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> in_itv</span><span class="id"> /=</span><span class="id"> !lt_def</span><span class="id"> !</span>(<span class="id">itvP</span><span class="id"> cminab</span>)<span class="id"> cnea</span><span class="id"> eq_sym</span><span class="id"> cneb</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">exists</span><span class="id"> cmin</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> apply:</span><span class="id"> derive1_at_min</span> (<span class="id">ltW</span><span class="id"> ltab</span>)<span class="id"> fdrvbl</span><span class="id"> cminab</span><span class="id"> _</span><span class="id"> =&gt;</span><span class="id"> t</span><span class="id"> tab</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> fcmin;</span><span class="id"> rewrite</span><span class="id"> in_itv</span><span class="id"> /=</span><span class="id"> !ltW</span><span class="id"> //</span> (<span class="id">itvP</span><span class="id"> tab</span>).<br/>
<span class="id">have</span><span class="id"> midab</span><span class="id"> :</span> (<span class="id">a</span><span class="id"> +</span><span class="id"> b</span>)<span class="id"> /</span><span class="id"> 2</span><span class="id"> \in</span><span class="id"> `]a,</span><span class="id"> b[%R</span><span class="gallina-kwd"> by</span><span class="id"> apply:</span><span class="id"> mid_in_itvoo</span>.<br/>
<span class="gallina-kwd">exists</span> ((<span class="id">a</span><span class="id"> +</span><span class="id"> b</span>)<span class="id"> /</span><span class="id"> 2</span>)<span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> apply:</span><span class="id"> derive1_at_max</span> (<span class="id">ltW</span><span class="id"> ltab</span>)<span class="id"> fdrvbl</span> (<span class="id">midab</span>)<span class="id"> _</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> t</span><span class="id"> tab</span>.<br/>
<span class="id">suff</span><span class="id"> fcst</span><span class="id"> s</span><span class="id"> :</span><span class="id"> s</span><span class="id"> \in</span><span class="id"> `]a,</span><span class="id"> b[%R</span><span class="id"> -&gt;</span><span class="id"> f</span><span class="id"> s</span><span class="id"> =</span><span class="id"> f</span><span class="id"> cmax</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> !fcst</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> sab</span>.<br/>
<span class="id">apply/eqP;</span><span class="id"> rewrite</span><span class="id"> eq_le</span><span class="id"> fcmax;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> in_itv</span><span class="id"> /=</span><span class="id"> !ltW</span><span class="id"> ?</span>(<span class="id">itvP</span><span class="id"> sab</span>).<br/>
<span class="id">suff</span><span class="id"> -&gt;</span><span class="id"> :</span><span class="id"> f</span><span class="id"> cmax</span><span class="id"> =</span><span class="id"> f</span><span class="id"> cmin</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> fcmin</span><span class="id"> //</span><span class="id"> in_itv</span><span class="id"> /=</span><span class="id"> !ltW</span><span class="id"> ?</span>(<span class="id">itvP</span><span class="id"> sab</span>).<br/>
<span class="gallina-kwd">by</span><span class="id"> move:</span><span class="id"> cmaxeaVb</span><span class="id"> cmineaVb;</span><span class="id"> rewrite</span><span class="id"> 2!inE</span><span class="id"> =&gt;</span><span class="id"> -[|]</span><span class="id"> -&gt;</span><span class="id"> [|]</span><span class="id"> -&gt;</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> MVT</span> (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>) (<span class="id">f</span><span class="id"> df</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> R</span>) (<span class="id">a</span><span class="id"> b</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">a</span><span class="id"> &lt;</span><span class="id"> b</span><span class="id"> -&gt;</span> (<span class="gallina-kwd">forall</span><span class="id"> x,</span><span class="id"> x</span><span class="id"> \in</span><span class="id"> `]a,</span><span class="id"> b[%R</span><span class="id"> -&gt;</span><span class="id"> is_derive</span><span class="id"> x</span><span class="id"> 1</span><span class="id"> f</span> (<span class="id">df</span><span class="id"> x</span>))<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">{within</span><span class="id"> `[a,</span><span class="id"> b],</span><span class="id"> continuous</span><span class="id"> f}</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">exists2</span><span class="id"> c,</span><span class="id"> c</span><span class="id"> \in</span><span class="id"> `]a,</span><span class="id"> b[%R</span><span class="id"> &amp;</span><span class="id"> f</span><span class="id"> b</span><span class="id"> -</span><span class="id"> f</span><span class="id"> a</span><span class="id"> =</span><span class="id"> df</span><span class="id"> c</span><span class="id"> *</span> (<span class="id">b</span><span class="id"> -</span><span class="id"> a</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> altb</span><span class="id"> fdrvbl</span><span class="id"> fcont</span>.<br/>
<span class="id">set</span><span class="id"> g</span><span class="id"> :=</span><span class="id"> f</span><span class="id"> +</span> (<span class="id">-</span> (<span class="id"> *:%R^~</span> ((<span class="id">f</span><span class="id"> b</span><span class="id"> -</span><span class="id"> f</span><span class="id"> a</span>)<span class="id"> /</span> (<span class="id">b</span><span class="id"> -</span><span class="id"> a</span>))<span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> R</span>)).<br/>
<span class="id">have</span><span class="id"> gdrvbl</span><span class="id"> x</span><span class="id"> :</span><span class="id"> x</span><span class="id"> \in</span><span class="id"> `]a,</span><span class="id"> b[%R</span><span class="id"> -&gt;</span><span class="id"> derivable</span><span class="id"> g</span><span class="id"> x</span><span class="id"> 1</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> /fdrvbl</span><span class="id"> dfx;</span><span class="id"> apply/derivableB/derivable1_diffP</span>.<br/>
<span class="id">have</span><span class="id"> gcont</span><span class="id"> :</span><span class="id"> {within</span><span class="id"> `[a,</span><span class="id"> b],</span><span class="id"> continuous</span><span class="id"> g}</span>.<br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> x;</span><span class="id"> apply:</span><span class="id"> continuousD</span><span class="id"> _</span><span class="id"> ;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> fcont</span>.<br/>
&nbsp;&nbsp;<span class="id">exact/continuousN/continuous_subspaceT/scalel_continuous</span>.<br/>
<span class="id">have</span><span class="id"> gaegb</span><span class="id"> :</span><span class="id"> g</span><span class="id"> a</span><span class="id"> =</span><span class="id"> g</span><span class="id"> b</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> /g</span><span class="id"> -![</span>(_<span class="id"> -</span><span class="id"> _</span><span class="id"> :</span><span class="id"> _</span><span class="id"> -&gt;</span><span class="id"> _</span>)<span class="id"> _]/</span>(_<span class="id"> -</span><span class="id"> _</span>).<br/>
&nbsp;&nbsp;<span class="id">apply/eqP;</span><span class="id"> rewrite</span><span class="id"> -subr_eq</span><span class="id"> /=</span><span class="id"> opprK</span><span class="id"> addrAC</span><span class="id"> -addrA</span><span class="id"> -scalerBl</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> [_</span><span class="id"> *:</span><span class="id"> _]mulrC</span><span class="id"> divfK;</span><span class="id"> first</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> addrC</span><span class="id"> subrK</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> lt0r_neq0;</span><span class="id"> rewrite</span><span class="id"> subr_gt0</span>.<br/>
<span class="id">have</span><span class="id"> [c</span><span class="id"> cab</span><span class="id"> dgc0]</span><span class="id"> :=</span><span class="id"> Rolle</span><span class="id"> altb</span><span class="id"> gdrvbl</span><span class="id"> gcont</span><span class="id"> gaegb</span>.<br/>
<span class="gallina-kwd">exists</span><span class="id"> c;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> cab</span>.<br/>
<span class="id">have</span><span class="id"> /fdrvbl</span><span class="id"> dfc</span><span class="id"> :=</span><span class="id"> cab;</span><span class="id"> move/@derive_val:</span><span class="id"> dgc0;</span><span class="id"> rewrite</span><span class="id"> deriveB</span><span class="id"> //</span>.<br/>
<span class="id">move/eqP;</span><span class="id"> rewrite</span><span class="id"> [X</span><span class="gallina-kwd"> in</span><span class="id"> _</span><span class="id"> -</span><span class="id"> X]deriveE</span><span class="id"> //</span><span class="id"> derive_val</span><span class="id"> diff_val</span><span class="id"> scale1r</span><span class="id"> subr_eq0</span>.<br/>
<span class="id">move/eqP-&gt;;</span><span class="id"> rewrite</span><span class="id"> -mulrA</span><span class="id"> mulVf</span><span class="id"> ?mulr1</span><span class="id"> //;</span><span class="id"> apply:</span><span class="id"> lt0r_neq0</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> subr_gt0</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> MVT_segment</span> (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>) (<span class="id">f</span><span class="id"> df</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> R</span>) (<span class="id">a</span><span class="id"> b</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">a</span><span class="id"> &lt;=</span><span class="id"> b</span><span class="id"> -&gt;</span> (<span class="gallina-kwd">forall</span><span class="id"> x,</span><span class="id"> x</span><span class="id"> \in</span><span class="id"> `]a,</span><span class="id"> b[%R</span><span class="id"> -&gt;</span><span class="id"> is_derive</span><span class="id"> x</span><span class="id"> 1</span><span class="id"> f</span> (<span class="id">df</span><span class="id"> x</span>))<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">{within</span><span class="id"> `[a,</span><span class="id"> b],</span><span class="id"> continuous</span><span class="id"> f}</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">exists2</span><span class="id"> c,</span><span class="id"> c</span><span class="id"> \in</span><span class="id"> `[a,</span><span class="id"> b]%R</span><span class="id"> &amp;</span><span class="id"> f</span><span class="id"> b</span><span class="id"> -</span><span class="id"> f</span><span class="id"> a</span><span class="id"> =</span><span class="id"> df</span><span class="id"> c</span><span class="id"> *</span> (<span class="id">b</span><span class="id"> -</span><span class="id"> a</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> leab</span><span class="id"> fdrvbl</span><span class="id"> fcont;</span><span class="id"> case:</span><span class="id"> ltgtP</span><span class="id"> leab</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> [altb|aeb];</span><span class="id"> last</span><span class="id"> first</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="gallina-kwd"> exists</span><span class="id"> a;</span><span class="id"> [rewrite</span><span class="id"> inE/=</span><span class="id"> aeb</span><span class="id"> lexx|rewrite</span><span class="id"> aeb</span><span class="id"> !subrr</span><span class="id"> mulr0]</span>.<br/>
<span class="id">have</span><span class="id"> [c</span><span class="id"> cab</span><span class="id"> D]</span><span class="id"> :=</span><span class="id"> MVT</span><span class="id"> altb</span><span class="id"> fdrvbl</span><span class="id"> fcont</span>.<br/>
<span class="gallina-kwd">by</span><span class="gallina-kwd"> exists</span><span class="id"> c</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> rewrite</span><span class="id"> in_itv</span><span class="id"> /=</span><span class="id"> ltW</span> (<span class="id">itvP</span><span class="id"> cab</span>).<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> ler0_derive1_nincr</span> (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> R</span>) (<span class="id">a</span><span class="id"> b</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">forall</span><span class="id"> x,</span><span class="id"> x</span><span class="id"> \in</span><span class="id"> `]a,</span><span class="id"> b[%R</span><span class="id"> -&gt;</span><span class="id"> derivable</span><span class="id"> f</span><span class="id"> x</span><span class="id"> 1</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">forall</span><span class="id"> x,</span><span class="id"> x</span><span class="id"> \in</span><span class="id"> `]a,</span><span class="id"> b[%R</span><span class="id"> -&gt;</span><span class="id"> f^`</span>()<span class="id"> x</span><span class="id"> &lt;=</span><span class="id"> 0</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">{within</span><span class="id"> `[a,b],</span><span class="id"> continuous</span><span class="id"> f}</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">forall</span><span class="id"> x</span><span class="id"> y,</span><span class="id"> a</span><span class="id"> &lt;=</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> x</span><span class="id"> &lt;=</span><span class="id"> y</span><span class="id"> -&gt;</span><span class="id"> y</span><span class="id"> &lt;=</span><span class="id"> b</span><span class="id"> -&gt;</span><span class="id"> f</span><span class="id"> y</span><span class="id"> &lt;=</span><span class="id"> f</span><span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> fdrvbl</span><span class="id"> dfle0</span><span class="id"> ctsf</span><span class="id"> x</span><span class="id"> y</span><span class="id"> leax</span><span class="id"> lexy</span><span class="id"> leyb;</span><span class="id"> rewrite</span><span class="id"> -subr_ge0</span>.<br/>
<span class="id">case:</span><span class="id"> ltgtP</span><span class="id"> lexy</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> [xlty|-&gt;];</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> subrr</span>.<br/>
<span class="id">have</span><span class="id"> itvW</span><span class="id"> :</span><span class="id"> {subset</span><span class="id"> `[x,</span><span class="id"> y]%R</span><span class="id"> &lt;=</span><span class="id"> `[a,</span><span class="id"> b]%R}</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply/subitvP;</span><span class="id"> rewrite</span><span class="id"> /&lt;=%O</span><span class="id"> /=</span><span class="id"> /&lt;=%O</span><span class="id"> /=</span><span class="id"> leyb</span><span class="id"> leax</span>.<br/>
<span class="id">have</span><span class="id"> itvWlt</span><span class="id"> :</span><span class="id"> {subset</span><span class="id"> `]x,</span><span class="id"> y[%R</span><span class="id"> &lt;=</span><span class="id"> `]a,</span><span class="id"> b[%R}</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply</span><span class="id"> subitvP;</span><span class="id"> rewrite</span><span class="id"> /&lt;=%O</span><span class="id"> /=</span><span class="id"> /&lt;=%O</span><span class="id"> /=</span><span class="id"> leyb</span><span class="id"> leax</span>.<br/>
<span class="id">have</span><span class="id"> fdrv</span><span class="id"> z</span><span class="id"> :</span><span class="id"> z</span><span class="id"> \in</span><span class="id"> `]x,</span><span class="id"> y[%R</span><span class="id"> -&gt;</span><span class="id"> is_derive</span><span class="id"> z</span><span class="id"> 1</span><span class="id"> f</span> (<span class="id">f^`</span>()<span class="id">z</span>).<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> in_itv/=</span><span class="id"> =&gt;</span><span class="id"> /andP[xz</span><span class="id"> zy];</span><span class="id"> apply:</span><span class="id"> DeriveDef;</span><span class="id"> last</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> derive1E</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> fdrvbl;</span><span class="id"> rewrite</span><span class="id"> in_itv/=</span> (<span class="id">le_lt_trans</span><span class="id"> _</span><span class="id"> xz</span>)<span class="id">//</span> (<span class="id">lt_le_trans</span><span class="id"> zy</span>).<br/>
<span class="id">have</span><span class="id"> []</span><span class="id"> :=</span><span class="id"> @MVT</span><span class="id"> _</span><span class="id"> f</span> (<span class="id">f^`</span>())<span class="id"> x</span><span class="id"> y</span><span class="id"> xlty</span><span class="id"> fdrv</span>.<br/>
&nbsp;&nbsp;<span class="id">apply:</span> (<span class="id">@continuous_subspaceW</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> `[a,b]</span>)<span class="id">;</span><span class="id"> first</span><span class="id"> exact:</span><span class="id"> itvW</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> continuous_subspace_in</span>.<br/>
<span class="id">move=&gt;</span><span class="id"> t</span><span class="id"> /itvWlt</span><span class="id"> dft</span><span class="id"> dftxy</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> -oppr_le0</span><span class="id"> opprB</span><span class="id"> dftxy</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> mulr_le0_ge0</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> [exact:</span><span class="id"> dfle0|by</span><span class="id"> rewrite</span><span class="id"> subr_ge0</span><span class="id"> ltW]</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> le0r_derive1_ndecr</span> (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> R</span>) (<span class="id">a</span><span class="id"> b</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">forall</span><span class="id"> x,</span><span class="id"> x</span><span class="id"> \in</span><span class="id"> `]a,</span><span class="id"> b[%R</span><span class="id"> -&gt;</span><span class="id"> derivable</span><span class="id"> f</span><span class="id"> x</span><span class="id"> 1</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">forall</span><span class="id"> x,</span><span class="id"> x</span><span class="id"> \in</span><span class="id"> `]a,</span><span class="id"> b[%R</span><span class="id"> -&gt;</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> f^`</span>()<span class="id"> x</span>)<span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">{within</span><span class="id"> `[a,b],</span><span class="id"> continuous</span><span class="id"> f}</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">forall</span><span class="id"> x</span><span class="id"> y,</span><span class="id"> a</span><span class="id"> &lt;=</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> x</span><span class="id"> &lt;=</span><span class="id"> y</span><span class="id"> -&gt;</span><span class="id"> y</span><span class="id"> &lt;=</span><span class="id"> b</span><span class="id"> -&gt;</span><span class="id"> f</span><span class="id"> x</span><span class="id"> &lt;=</span><span class="id"> f</span><span class="id"> y</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> fdrvbl</span><span class="id"> dfge0</span><span class="id"> fcont</span><span class="id"> x</span><span class="id"> y;</span><span class="id"> rewrite</span><span class="id"> -[f</span><span class="id"> _</span><span class="id"> &lt;=</span><span class="id"> _]lerN2</span>.<br/>
<span class="id">apply</span> (<span class="id">@ler0_derive1_nincr</span><span class="id"> _</span> (<span class="id">-</span><span class="id"> f</span>))<span class="id"> =&gt;</span><span class="id"> t</span><span class="id"> tab;</span><span class="id"> first</span><span class="id"> exact/derivableN/fdrvbl</span>.<br/>
&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> derive1E</span><span class="id"> deriveN;</span><span class="id"> last</span><span class="id"> exact:</span><span class="id"> fdrvbl</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> oppr_le0</span><span class="id"> -derive1E;</span><span class="id"> apply:</span><span class="id"> dfge0</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> apply:</span><span class="id"> continuousN;</span><span class="id"> exact:</span><span class="id"> fcont</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> derive1_comp</span> (<span class="id">R</span><span class="id"> :</span><span class="id"> realFieldType</span>) (<span class="id">f</span><span class="id"> g</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> R</span>)<span class="id"> x</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">derivable</span><span class="id"> f</span><span class="id"> x</span><span class="id"> 1</span><span class="id"> -&gt;</span><span class="id"> derivable</span><span class="id"> g</span> (<span class="id">f</span><span class="id"> x</span>)<span class="id"> 1</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;(<span class="id">g</span><span class="id"> \o</span><span class="id"> f</span>)<span class="id">^`</span>()<span class="id"> x</span><span class="id"> =</span><span class="id"> g^`</span>() (<span class="id">f</span><span class="id"> x</span>)<span class="id"> *</span><span class="id"> f^`</span>()<span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> /derivable1_diffP</span><span class="id"> df</span><span class="id"> /derivable1_diffP</span><span class="id"> dg</span>.<br/>
<span class="id">rewrite</span><span class="id"> derive1E';</span><span class="id"> last</span><span class="id"> exact/differentiable_comp</span>.<br/>
<span class="id">rewrite</span><span class="id"> diff_comp</span><span class="id"> //</span><span class="id"> !derive1E'</span><span class="id"> //=</span><span class="id"> -[X</span><span class="gallina-kwd"> in</span><span class="id"> 'd</span> <span class="id"> _</span><span class="id"> _</span><span class="id"> X</span><span class="id"> =</span><span class="id"> _]mulr1</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> [LHS]linearZ</span><span class="id"> mulrC</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> trigger_derive</span> (<span class="id">R</span><span class="id"> :</span><span class="id"> realType</span>) (<span class="id">f</span><span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> R</span>)<span class="id"> x</span><span class="id"> x1</span><span class="id"> y1</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">is_derive</span><span class="id"> x</span> (<span class="id">1</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> f</span><span class="id"> x1</span><span class="id"> -&gt;</span><span class="id"> x1</span><span class="id"> =</span><span class="id"> y1</span><span class="id"> -&gt;</span><span class="id"> is_derive</span><span class="id"> x</span><span class="id"> 1</span><span class="id"> f</span><span class="id"> y1</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> Hi</span><span class="id"> &lt;-</span>. Qed.</div></details>

      <div class="footer"><hr/>Generated by <a href="https://github.com/yoshihiro503/coq2html/">a fork of coq2html</a></div>
    </div>
  </div>
    </main>
</body>
</html>
