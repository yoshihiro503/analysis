
<!DOCTYPE html>
<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Module mathcomp.reals.signed</title>
<meta name="description" content="Documentation of Coq module mathcomp.reals.signed" />
<link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.css">
<script src="https://cdn.jsdelivr.net/npm/markdown-it/dist/markdown-it.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/markdown-it-texmath/texmath.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/darkmode-js@1.5.7/lib/darkmode-js.min.js"></script>
<link href="coq2html.css" rel="stylesheet" type="text/css" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script type="text/javascript" src="coq2html.js"> </script>
</head>

<body onload="init()">

  <main>
    <div class="sidebar">
      <h2>Files</h2>
      
    </div>

  <div class="coq">

    <div class="content">
      <p><a href="./index.html">Top</a></p>
      <h1 class="title">Module mathcomp.reals.signed</h1>
<span class="vernacular">From</span><span class="id"> HB</span><span class="vernacular"> Require</span><span class="vernacular"> Import</span><span class="id"> structures</span>.<br/>
<span class="vernacular">From</span><span class="id"> Coq</span><span class="vernacular"> Require</span><span class="vernacular"> Import</span><span class="id"> ssreflect</span><span class="id"> ssrfun</span><span class="id"> ssrbool</span>.<br/>
<span class="vernacular">From</span><span class="id"> mathcomp</span><span class="vernacular"> Require</span><span class="vernacular"> Import</span><span class="id"> ssrnat</span><span class="id"> eqtype</span><span class="id"> choice</span><span class="id"> order</span><span class="id"> ssralg</span><span class="id"> ssrnum</span><span class="id"> ssrint</span>.<br/>
<span class="vernacular">From</span><span class="id"> mathcomp</span><span class="vernacular"> Require</span><span class="vernacular"> Import</span><span class="id"> mathcomp_extra</span>.<br/>
<br/>
<div class="ssrdoc md">
# Positive, non-negative numbers, etc.

This file develops tools to make the manipulation of numbers with a known
sign easier, thanks to canonical structures. This adds types like
{posnum R} for positive values in R, a notation e%:pos that infers the
positivity of expression e according to existing canonical instances and
%:num to cast back from type {posnum R} to R.
For instance, given x, y : {posnum R}, we have
((x%:num + y%:num) / 2)%:pos : {posnum R} automatically inferred.

## Types for values with known sign
```
   {posnum R} == interface type for elements in R that are positive; R
                 must have a zmodType structure.
                 Allows to solve automatically goals of the form x &gt; 0 if
                 x is canonically a {posnum R}. {posnum R} is canonically
                 stable by common operations. All positive natural numbers
                 ((n.+1)%:R) are also canonically in {posnum R}
   {nonneg R} == interface types for elements in R that are non-negative;
                 R must have a zmodType structure. Automatically solves
                 goals of the form x &gt;= 0. {nonneg R} is stable by
                 common operations. All natural numbers n%:R are also
                 canonically in {nonneg R}.
{compare x0 &amp; nz &amp; cond} == more generic type of values comparing to
                 x0 : T according to nz and cond (see below). T must have
                 a porderType structure. This type is shown to be a
                 porderType. It is also an orderTpe, as soon as T is a
                 numDomainType.
{num R &amp; nz &amp; cond} == {compare 0%R : R &amp; nz &amp; cond}. T must have a
                 zmodType structure.
       {= x0} == {compare x0 &amp; ?=0 &amp; =0}
   {= x0 : T} == same with an explicit type T
       {&gt; x0} == {compare x0 &amp; !=0 &amp; &gt;=0}
   {&gt; x0 : T} == same with an explicit type T
       {&lt; x0} == {compare x0 &amp; !=0 &amp; &lt;=0}
   {&lt; x0 : T} == same with an explicit type T
      {&gt;= x0} == {compare x0 &amp; ?=0 &amp; &gt;=0}
  {&gt;= x0 : T} == same with an explicit type T
      {&lt;= x0} == {compare x0 &amp; ?=0 &amp; &lt;=0}
  {&lt;= x0 : T} == same with an explicit type T
     {&gt;=&lt; x0} == {compare x0 &amp; ?=0 &amp; &gt;=&lt;0}
 {&gt;=&lt; x0 : T} == same with an explicit type T
      {&gt;&lt; x0} == {compare x0 &amp; !=0 &amp; &gt;=&lt;0}
  {&gt;&lt; x0 : T} == same with an explicit type T
      {!= x0} == {compare x0 &amp; !=0 &amp; &gt;?&lt;0}
  {!= x0 : T} == same with an explicit type T
      {?= x0} == {compare x0 &amp; ?=0 &amp; &gt;?&lt;0}
  {?= x0 : T} == same with an explicit type T
```

## Casts from/to values with known sign
```
       x%:pos == explicitly casts x to {posnum R}, triggers the inference
                 of a {posnum R} structure for x.
       x%:nng == explicitly casts x to {nonneg R}, triggers the inference
                 of a {nonneg R} structure for x.
       x%:sgn == explicitly casts x to the most precise known
                 {compare x0 &amp; nz &amp; cond} according to existing canonical
                 instances.
       x%:num == explicit cast from {compare x0 &amp; nz &amp; cond} to R. In
                 particular this works from {posnum R} and {nonneg R} to R.
    x%:posnum == explicit cast from {posnum R} to R.
    x%:nngnum == explicit cast from {nonneg R} to R.
```

## Nullity conditions nz
All nz above can be the following (in scope snum_nullity_scope delimited
by %snum_nullity)
```
          !=0 == to encode x != 0
          ?=0 == unknown nullity
```

## Reality conditions cond
All cond above can be the following (in scope snum_sign_scope delimited by
by %snum_sign)
```
           =0 == to encode x == 0
          &gt;=0 == to encode x &gt;= 0
          &lt;=0 == to encode x &lt;= 0
         &gt;=&lt;0 == to encode x &gt;=&lt; 0
         &gt;?&lt;0 == unknown reality
```

## Sign proofs
```
   [sgn of x] == proof that x is of sign inferred by x%:sgn
   [gt0 of x] == proof that x &gt; 0
   [lt0 of x] == proof that x &lt; 0
   [ge0 of x] == proof that x &gt;= 0
   [le0 of x] == proof that x &lt;= 0
  [cmp0 of x] == proof that 0 &gt;=&lt; x
  [neq0 of x] == proof that x != 0
```

## Constructors
```
  PosNum xgt0 == builds a {posnum R} from a proof xgt0 : x &gt; 0 where x : R
  NngNum xge0 == builds a {posnum R} from a proof xgt0 : x &gt;= 0 where x : R
  Signed.mk p == builds a {compare x0 &amp; nz &amp; cond} from a proof p that
                 some x satisfies sign conditions encoded by nz and cond
```

## Misc.
```
         !! x == triggers pretyping to fill the holes of the term x. The
                 main use case is to trigger typeclass inference in the
                 body of a ssreflect have := !! body.
                 Credits: Enrico Tassi.
```

A number of canonical instances are provided for common operations, if
your favorite operator is missing, look below for examples on how to add
the appropriate Canonical.

Canonical instances are also provided according to types, as a
fallback when no known operator appears in the expression. Look to
nat_snum below for an example on how to add your favorite type.
</div>
<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;{ 'compare' x0 &amp; nz &amp; cond }&quot;</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">at</span><span class="id"> level</span><span class="id"> 0,</span><span class="id"> x0</span><span class="gallina-kwd"> at</span><span class="id"> level</span><span class="id"> 200,</span><span class="id"> nz</span><span class="gallina-kwd"> at</span><span class="id"> level</span><span class="id"> 200,</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id">format</span> <span class="id">&quot;{ 'compare'  x0  &amp;  nz  &amp;  cond }&quot;</span>).<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;{ 'num' R &amp; nz &amp; cond }&quot;</span><br/>
&nbsp;&nbsp;(<span class="gallina-kwd">at</span><span class="id"> level</span><span class="id"> 0,</span><span class="id"> R</span><span class="gallina-kwd"> at</span><span class="id"> level</span><span class="id"> 200,</span><span class="id"> nz</span><span class="gallina-kwd"> at</span><span class="id"> level</span><span class="id"> 200,</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id">format</span> <span class="id">&quot;{ 'num'  R  &amp;  nz  &amp;  cond }&quot;</span>).<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;{ = x0 }&quot;</span> (<span class="gallina-kwd">at</span><span class="id"> level</span><span class="id"> 0,</span><span class="id"> format</span> <span class="id">&quot;{ =  x0 }&quot;</span>).<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;{ &gt; x0 }&quot;</span> (<span class="gallina-kwd">at</span><span class="id"> level</span><span class="id"> 0,</span><span class="id"> format</span> <span class="id">&quot;{ &gt;  x0 }&quot;</span>).<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;{ &lt; x0 }&quot;</span> (<span class="gallina-kwd">at</span><span class="id"> level</span><span class="id"> 0,</span><span class="id"> format</span> <span class="id">&quot;{ &lt;  x0 }&quot;</span>).<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;{ &gt;= x0 }&quot;</span> (<span class="gallina-kwd">at</span><span class="id"> level</span><span class="id"> 0,</span><span class="id"> format</span> <span class="id">&quot;{ &gt;=  x0 }&quot;</span>).<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;{ &lt;= x0 }&quot;</span> (<span class="gallina-kwd">at</span><span class="id"> level</span><span class="id"> 0,</span><span class="id"> format</span> <span class="id">&quot;{ &lt;=  x0 }&quot;</span>).<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;{ &gt;=&lt; x0 }&quot;</span> (<span class="gallina-kwd">at</span><span class="id"> level</span><span class="id"> 0,</span><span class="id"> format</span> <span class="id">&quot;{ &gt;=&lt;  x0 }&quot;</span>).<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;{ &gt;&lt; x0 }&quot;</span> (<span class="gallina-kwd">at</span><span class="id"> level</span><span class="id"> 0,</span><span class="id"> format</span> <span class="id">&quot;{ &gt;&lt;  x0 }&quot;</span>).<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;{ != x0 }&quot;</span> (<span class="gallina-kwd">at</span><span class="id"> level</span><span class="id"> 0,</span><span class="id"> format</span> <span class="id">&quot;{ !=  x0 }&quot;</span>).<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;{ ?= x0 }&quot;</span> (<span class="gallina-kwd">at</span><span class="id"> level</span><span class="id"> 0,</span><span class="id"> format</span> <span class="id">&quot;{ ?=  x0 }&quot;</span>).<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;{ = x0 : T }&quot;</span> (<span class="gallina-kwd">at</span><span class="id"> level</span><span class="id"> 0,</span><span class="id"> format</span> <span class="id">&quot;{ =  x0  :  T }&quot;</span>).<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;{ &gt; x0 : T }&quot;</span> (<span class="gallina-kwd">at</span><span class="id"> level</span><span class="id"> 0,</span><span class="id"> format</span> <span class="id">&quot;{ &gt;  x0  :  T }&quot;</span>).<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;{ &lt; x0 : T }&quot;</span> (<span class="gallina-kwd">at</span><span class="id"> level</span><span class="id"> 0,</span><span class="id"> format</span> <span class="id">&quot;{ &lt;  x0  :  T }&quot;</span>).<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;{ &gt;= x0 : T }&quot;</span> (<span class="gallina-kwd">at</span><span class="id"> level</span><span class="id"> 0,</span><span class="id"> format</span> <span class="id">&quot;{ &gt;=  x0  :  T }&quot;</span>).<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;{ &lt;= x0 : T }&quot;</span> (<span class="gallina-kwd">at</span><span class="id"> level</span><span class="id"> 0,</span><span class="id"> format</span> <span class="id">&quot;{ &lt;=  x0  :  T }&quot;</span>).<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;{ &gt;=&lt; x0 : T }&quot;</span> (<span class="gallina-kwd">at</span><span class="id"> level</span><span class="id"> 0,</span><span class="id"> format</span> <span class="id">&quot;{ &gt;=&lt;  x0  :  T }&quot;</span>).<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;{ &gt;&lt; x0 : T }&quot;</span> (<span class="gallina-kwd">at</span><span class="id"> level</span><span class="id"> 0,</span><span class="id"> format</span> <span class="id">&quot;{ &gt;&lt;  x0  :  T }&quot;</span>).<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;{ != x0 : T }&quot;</span> (<span class="gallina-kwd">at</span><span class="id"> level</span><span class="id"> 0,</span><span class="id"> format</span> <span class="id">&quot;{ !=  x0  :  T }&quot;</span>).<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;{ ?= x0 : T }&quot;</span> (<span class="gallina-kwd">at</span><span class="id"> level</span><span class="id"> 0,</span><span class="id"> format</span> <span class="id">&quot;{ ?=  x0  :  T }&quot;</span>).<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;=0&quot;</span> (<span class="gallina-kwd">at</span><span class="id"> level</span><span class="id"> 0,</span><span class="id"> format</span> <span class="id">&quot;=0&quot;</span>).<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;&gt;=0&quot;</span> (<span class="gallina-kwd">at</span><span class="id"> level</span><span class="id"> 0,</span><span class="id"> format</span> <span class="id">&quot;&gt;=0&quot;</span>).<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;&lt;=0&quot;</span> (<span class="gallina-kwd">at</span><span class="id"> level</span><span class="id"> 0,</span><span class="id"> format</span> <span class="id">&quot;&lt;=0&quot;</span>).<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;&gt;=&lt;0&quot;</span> (<span class="gallina-kwd">at</span><span class="id"> level</span><span class="id"> 0,</span><span class="id"> format</span> <span class="id">&quot;&gt;=&lt;0&quot;</span>).<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;&gt;?&lt;0&quot;</span> (<span class="gallina-kwd">at</span><span class="id"> level</span><span class="id"> 0,</span><span class="id"> format</span> <span class="id">&quot;&gt;?&lt;0&quot;</span>).<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;!=0&quot;</span> (<span class="gallina-kwd">at</span><span class="id"> level</span><span class="id"> 0,</span><span class="id"> format</span> <span class="id">&quot;!=0&quot;</span>).<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;?=0&quot;</span> (<span class="gallina-kwd">at</span><span class="id"> level</span><span class="id"> 0,</span><span class="id"> format</span> <span class="id">&quot;?=0&quot;</span>).<br/>
<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;x %:sgn&quot;</span> (<span class="gallina-kwd">at</span><span class="id"> level</span><span class="id"> 2,</span><span class="id"> format</span> <span class="id">&quot;x %:sgn&quot;</span>).<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;x %:num&quot;</span> (<span class="gallina-kwd">at</span><span class="id"> level</span><span class="id"> 2,</span><span class="id"> format</span> <span class="id">&quot;x %:num&quot;</span>).<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;x %:posnum&quot;</span> (<span class="gallina-kwd">at</span><span class="id"> level</span><span class="id"> 2,</span><span class="id"> format</span> <span class="id">&quot;x %:posnum&quot;</span>).<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;x %:nngnum&quot;</span> (<span class="gallina-kwd">at</span><span class="id"> level</span><span class="id"> 2,</span><span class="id"> format</span> <span class="id">&quot;x %:nngnum&quot;</span>).<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;[ 'sgn' 'of' x ]&quot;</span> (<span class="id">format</span> <span class="id">&quot;[ 'sgn' 'of'  x ]&quot;</span>).<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;[ 'gt0' 'of' x ]&quot;</span> (<span class="id">format</span> <span class="id">&quot;[ 'gt0' 'of'  x ]&quot;</span>).<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;[ 'lt0' 'of' x ]&quot;</span> (<span class="id">format</span> <span class="id">&quot;[ 'lt0' 'of'  x ]&quot;</span>).<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;[ 'ge0' 'of' x ]&quot;</span> (<span class="id">format</span> <span class="id">&quot;[ 'ge0' 'of'  x ]&quot;</span>).<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;[ 'le0' 'of' x ]&quot;</span> (<span class="id">format</span> <span class="id">&quot;[ 'le0' 'of'  x ]&quot;</span>).<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;[ 'cmp0' 'of' x ]&quot;</span> (<span class="id">format</span> <span class="id">&quot;[ 'cmp0' 'of'  x ]&quot;</span>).<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;[ 'neq0' 'of' x ]&quot;</span> (<span class="id">format</span> <span class="id">&quot;[ 'neq0' 'of'  x ]&quot;</span>).<br/>
<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;{ 'posnum' R }&quot;</span> (<span class="gallina-kwd">at</span><span class="id"> level</span><span class="id"> 0,</span><span class="id"> format</span> <span class="id">&quot;{ 'posnum'  R }&quot;</span>).<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;{ 'nonneg' R }&quot;</span> (<span class="gallina-kwd">at</span><span class="id"> level</span><span class="id"> 0,</span><span class="id"> format</span> <span class="id">&quot;{ 'nonneg'  R }&quot;</span>).<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;x %:pos&quot;</span> (<span class="gallina-kwd">at</span><span class="id"> level</span><span class="id"> 2,</span><span class="id"> format</span> <span class="id">&quot;x %:pos&quot;</span>).<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;x %:nng&quot;</span> (<span class="gallina-kwd">at</span><span class="id"> level</span><span class="id"> 2,</span><span class="id"> format</span> <span class="id">&quot;x %:nng&quot;</span>).<br/>
<br/>
<span class="vernacular">Reserved</span><span class="vernacular"> Notation</span> <span class="id">&quot;!! x&quot;</span> (<span class="gallina-kwd">at</span><span class="id"> level</span><span class="id"> 100,</span><span class="id"> only</span><span class="id"> parsing</span>).<br/>
<br/>
<span class="gallina-kwd">Set</span><span class="vernacular"> Implicit</span><span class="vernacular"> Arguments</span>.<br/>
<span class="vernacular">Unset</span><span class="vernacular"> Strict</span><span class="vernacular"> Implicit</span>.<br/>
<span class="vernacular">Unset</span><span class="vernacular"> Printing</span><span class="vernacular"> Implicit</span><span class="vernacular"> Defensive</span>.<br/>
<span class="vernacular">Import</span><span class="id"> Order</span>.<span class="id">TTheory</span><span class="id"> Order</span>.<span class="id">Syntax</span>.<br/>
<span class="vernacular">Import</span><span class="id"> GRing</span>.<span class="id">Theory</span><span class="id"> Num</span>.<span class="id">Theory</span>.<br/>
<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ring_scope</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> order_scope</span>.<br/>
<br/>
<span class="vernacular">Declare</span><span class="vernacular"> Scope</span><span class="id"> snum_scope</span>.<br/>
<span class="vernacular">Delimit</span><span class="vernacular"> Scope</span><span class="id"> snum_scope</span><span class="gallina-kwd"> with</span><span class="id"> snum</span>.<br/>
<span class="vernacular">Declare</span><span class="vernacular"> Scope</span><span class="id"> snum_sign_scope</span>.<br/>
<span class="vernacular">Delimit</span><span class="vernacular"> Scope</span><span class="id"> snum_sign_scope</span><span class="gallina-kwd"> with</span><span class="id"> snum_sign</span>.<br/>
<span class="vernacular">Declare</span><span class="vernacular"> Scope</span><span class="id"> snum_nullity_scope</span>.<br/>
<span class="vernacular">Delimit</span><span class="vernacular"> Scope</span><span class="id"> snum_nullity_scope</span><span class="gallina-kwd"> with</span><span class="id"> snum_nullity</span>.<br/>
<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;!! x&quot;</span><span class="id"> :=</span> (<span class="id">ltac:</span>(<span class="id">refine</span><span class="id"> x</span>)) (<span class="id">only</span><span class="id"> parsing</span>).<br/>
<span class="vernacular">Class</span><span class="id"> infer</span> (<span class="id">P</span><span class="id"> :</span><span class="gallina-kwd"> Prop</span>)<span class="id"> :=</span><span class="id"> Infer</span><span class="id"> :</span><span class="id"> P</span>.<br/>
<span class="id">#[global]</span><span class="vernacular"> Hint</span><span class="id"> Mode</span><span class="id"> infer</span><span class="id"> !</span><span class="id"> :</span><span class="id"> typeclass_instances</span>.<br/>
<span class="id">#[global]</span><span class="vernacular"> Hint</span><span class="id"> Extern</span><span class="id"> 0</span> (<span class="id">infer</span><span class="id"> _</span>)<span class="id"> =&gt;</span> (<span class="id">exact</span>)<span class="id"> :</span><span class="id"> typeclass_instances</span>.<br/>
<span class="vernacular">Lemma</span><span class="id"> inferP</span> (<span class="id">P</span><span class="id"> :</span><span class="gallina-kwd"> Prop</span>)<span class="id"> :</span><span class="id"> P</span><span class="id"> -&gt;</span><span class="id"> infer</span><span class="id"> P</span><br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> []</span>. Qed.</div></details>
<br/>
<span class="vernacular">Module</span><span class="vernacular"> Import</span><span class="id"> KnownSign</span>.<br/>
<span class="vernacular">Variant</span><span class="id"> nullity</span><span class="id"> :=</span><span class="id"> NonZero</span><span class="id"> |</span><span class="id"> MaybeZero</span>.<br/>
<span class="vernacular">Coercion</span><span class="id"> nullity_bool</span><span class="id"> nz</span><span class="id"> :=</span><span class="gallina-kwd"> if</span><span class="id"> nz</span><span class="id"> is</span><span class="id"> NonZero</span><span class="gallina-kwd"> then</span><span class="id"> true</span><span class="gallina-kwd"> else</span><span class="id"> false</span>.<br/>
<span class="vernacular">Definition</span><span class="id"> nz_of_bool</span><span class="id"> b</span><span class="id"> :=</span><span class="gallina-kwd"> if</span><span class="id"> b</span><span class="gallina-kwd"> then</span><span class="id"> NonZero</span><span class="gallina-kwd"> else</span><span class="id"> MaybeZero</span>.<br/>
<br/>
<span class="vernacular">Variant</span><span class="id"> sign</span><span class="id"> :=</span><span class="id"> EqZero</span><span class="id"> |</span><span class="id"> NonNeg</span><span class="id"> |</span><span class="id"> NonPos</span>.<br/>
<span class="vernacular">Variant</span><span class="id"> real</span><span class="id"> :=</span><span class="id"> Sign</span><span class="id"> of</span><span class="id"> sign</span><span class="id"> |</span><span class="id"> AnySign</span>.<br/>
<span class="vernacular">Variant</span><span class="id"> reality</span><span class="id"> :=</span><span class="id"> Real</span><span class="id"> of</span><span class="id"> real</span><span class="id"> |</span><span class="id"> Arbitrary</span>.<br/>
<br/>
<span class="vernacular">Definition</span><span class="id"> wider_nullity</span><span class="id"> xnz</span><span class="id"> ynz</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">match</span><span class="id"> xnz,</span><span class="id"> ynz</span><span class="gallina-kwd"> with</span><br/>
&nbsp;&nbsp;<span class="id">|</span><span class="id"> MaybeZero,</span><span class="id"> _</span><br/>
&nbsp;&nbsp;<span class="id">|</span><span class="id"> NonZero,</span><span class="id"> NonZero</span><span class="id"> =&gt;</span><span class="id"> true</span><br/>
&nbsp;&nbsp;<span class="id">|</span><span class="id"> NonZero,</span><span class="id"> MaybeZero</span><span class="id"> =&gt;</span><span class="id"> false</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">end</span>.<br/>
<span class="vernacular">Definition</span><span class="id"> wider_sign</span><span class="id"> xs</span><span class="id"> ys</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">match</span><span class="id"> xs,</span><span class="id"> ys</span><span class="gallina-kwd"> with</span><br/>
&nbsp;&nbsp;<span class="id">|</span><span class="id"> NonNeg,</span><span class="id"> NonNeg</span><span class="id"> |</span><span class="id"> NonNeg,</span><span class="id"> EqZero</span><br/>
&nbsp;&nbsp;<span class="id">|</span><span class="id"> NonPos,</span><span class="id"> NonPos</span><span class="id"> |</span><span class="id"> NonPos,</span><span class="id"> EqZero</span><br/>
&nbsp;&nbsp;<span class="id">|</span><span class="id"> EqZero,</span><span class="id"> EqZero</span><span class="id"> =&gt;</span><span class="id"> true</span><br/>
&nbsp;&nbsp;<span class="id">|</span><span class="id"> NonNeg,</span><span class="id"> NonPos</span><span class="id"> |</span><span class="id"> NonPos,</span><span class="id"> NonNeg</span><br/>
&nbsp;&nbsp;<span class="id">|</span><span class="id"> EqZero,</span><span class="id"> NonPos</span><span class="id"> |</span><span class="id"> EqZero,</span><span class="id"> NonNeg</span><span class="id"> =&gt;</span><span class="id"> false</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">end</span>.<br/>
<span class="vernacular">Definition</span><span class="id"> wider_real</span><span class="id"> xr</span><span class="id"> yr</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">match</span><span class="id"> xr,</span><span class="id"> yr</span><span class="gallina-kwd"> with</span><br/>
&nbsp;&nbsp;<span class="id">|</span><span class="id"> AnySign,</span><span class="id"> _</span><span class="id"> =&gt;</span><span class="id"> true</span><br/>
&nbsp;&nbsp;<span class="id">|</span><span class="id"> Sign</span><span class="id"> sx,</span><span class="id"> Sign</span><span class="id"> sy</span><span class="id"> =&gt;</span><span class="id"> wider_sign</span><span class="id"> sx</span><span class="id"> sy</span><br/>
&nbsp;&nbsp;<span class="id">|</span><span class="id"> Sign</span><span class="id"> _,</span><span class="id"> AnySign</span><span class="id"> =&gt;</span><span class="id"> false</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">end</span>.<br/>
<span class="vernacular">Definition</span><span class="id"> wider_reality</span><span class="id"> xr</span><span class="id"> yr</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">match</span><span class="id"> xr,</span><span class="id"> yr</span><span class="gallina-kwd"> with</span><br/>
&nbsp;&nbsp;<span class="id">|</span><span class="id"> Arbitrary,</span><span class="id"> _</span><span class="id"> =&gt;</span><span class="id"> true</span><br/>
&nbsp;&nbsp;<span class="id">|</span><span class="id"> Real</span><span class="id"> xr,</span><span class="id"> Real</span><span class="id"> yr</span><span class="id"> =&gt;</span><span class="id"> wider_real</span><span class="id"> xr</span><span class="id"> yr</span><br/>
&nbsp;&nbsp;<span class="id">|</span><span class="id"> Real</span><span class="id"> _,</span><span class="id"> Arbitrary</span><span class="id"> =&gt;</span><span class="id"> false</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">end</span>.<br/>
<span class="vernacular">End</span><span class="id"> KnownSign</span>.<br/>
<br/>
<span class="vernacular">Module</span><span class="id"> Signed</span>.<br/>
<span class="vernacular">Section</span><span class="id"> Signed</span>.<br/>
<span class="vernacular">Context</span> (<span class="id">disp</span><span class="id"> :</span><span class="id"> Order</span>.<span class="id">disp_t</span>) (<span class="id">T</span><span class="id"> :</span><span class="id"> porderType</span><span class="id"> disp</span>) (<span class="id">x0</span><span class="id"> :</span><span class="id"> T</span>).<br/>
<br/>
<span class="vernacular">Local</span><span class="vernacular"> Coercion</span><span class="id"> is_real</span><span class="id"> r</span><span class="id"> :=</span><span class="gallina-kwd"> if</span><span class="id"> r</span><span class="id"> is</span><span class="id"> Real</span><span class="id"> _</span><span class="gallina-kwd"> then</span><span class="id"> true</span><span class="gallina-kwd"> else</span><span class="id"> false</span>.<br/>
<span class="vernacular">Definition</span><span class="id"> reality_cond</span> (<span class="id">n</span><span class="id"> :</span><span class="id"> reality</span>) (<span class="id">x</span><span class="id"> :</span><span class="id"> T</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">match</span><span class="id"> n</span><span class="gallina-kwd"> with</span><br/>
&nbsp;&nbsp;<span class="id">|</span><span class="id"> Real</span> (<span class="id">Sign</span><span class="id"> EqZero</span>)<span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> ==</span><span class="id"> x0</span><br/>
&nbsp;&nbsp;<span class="id">|</span><span class="id"> Real</span> (<span class="id">Sign</span><span class="id"> NonNeg</span>)<span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> &gt;=</span><span class="id"> x0</span><br/>
&nbsp;&nbsp;<span class="id">|</span><span class="id"> Real</span> (<span class="id">Sign</span><span class="id"> NonPos</span>)<span class="id"> =&gt;</span><span class="id"> x</span><span class="id"> &lt;=</span><span class="id"> x0</span><br/>
&nbsp;&nbsp;<span class="id">|</span><span class="id"> Real</span><span class="id"> AnySign</span>      <span class="id"> =&gt;</span> (<span class="id">x0</span><span class="id"> &lt;=</span><span class="id"> x</span>)<span class="id"> ||</span> (<span class="id">x</span><span class="id"> &lt;=</span><span class="id"> x0</span>)<br/>
&nbsp;&nbsp;<span class="id">|</span><span class="id"> Arbitrary</span>         <span class="id"> =&gt;</span><span class="id"> true</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">end</span>.<br/>
<br/>
<span class="vernacular">Record</span><span class="id"> def</span> (<span class="id">nz</span><span class="id"> :</span><span class="id"> nullity</span>) (<span class="id">cond</span><span class="id"> :</span><span class="id"> reality</span>)<span class="id"> :=</span><span class="id"> Def</span><span class="id"> {</span><br/>
&nbsp;&nbsp;<span class="id">r</span><span class="id"> :&gt;</span><span class="id"> T;</span><br/>
&nbsp;&nbsp;<span class="id">#[canonical=no]</span><br/>
&nbsp;&nbsp;<span class="id">P</span><span class="id"> :</span> (<span class="id">nz</span><span class="id"> ==&gt;</span> (<span class="id">r</span><span class="id"> !=</span><span class="id"> x0</span>))<span class="id"> &amp;&amp;</span><span class="id"> reality_cond</span><span class="id"> cond</span><span class="id"> r</span><br/>
<span class="id">}</span>.<br/>
<br/>
<span class="vernacular">End</span><span class="id"> Signed</span>.<br/>
<br/>
<span class="vernacular">Notation</span><span class="id"> spec</span><span class="id"> x0</span><span class="id"> nz</span><span class="id"> cond</span><span class="id"> x</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;((<span class="id">nullity_bool</span><span class="id"> nz%snum_nullity</span><span class="id"> ==&gt;</span> (<span class="id">x</span><span class="id"> !=</span><span class="id"> x0</span>))<br/>
&nbsp;&nbsp;&nbsp;<span class="id">&amp;&amp;</span> (<span class="id">reality_cond</span><span class="id"> x0</span><span class="id"> cond%snum_sign</span><span class="id"> x</span>)).<br/>
<br/>
<span class="vernacular">Record</span><span class="id"> typ</span><span class="id"> d</span><span class="id"> nz</span><span class="id"> cond</span><span class="id"> :=</span><span class="id"> Typ</span><span class="id"> {</span><br/>
&nbsp;&nbsp;<span class="id">sort</span><span class="id"> :</span><span class="id"> porderType</span><span class="id"> d;</span><br/>
&nbsp;&nbsp;<span class="id">#[canonical=no]</span><br/>
&nbsp;&nbsp;<span class="id">sort_x0</span><span class="id"> :</span><span class="id"> sort;</span><br/>
&nbsp;&nbsp;<span class="id">#[canonical=no]</span><br/>
&nbsp;&nbsp;<span class="id">allP</span><span class="id"> :</span><span class="gallina-kwd"> forall</span><span class="id"> x</span><span class="id"> :</span><span class="id"> sort,</span><span class="id"> spec</span><span class="id"> sort_x0</span><span class="id"> nz</span><span class="id"> cond</span><span class="id"> x</span><br/>
<span class="id">}</span>.<br/>
<br/>
<span class="vernacular">Definition</span><span class="id"> mk</span><span class="id"> {d</span><span class="id"> T}</span><span class="id"> x0</span><span class="id"> nz</span><span class="id"> cond</span><span class="id"> r</span><span class="id"> P</span><span class="id"> :</span><span class="id"> @def</span><span class="id"> d</span><span class="id"> T</span><span class="id"> x0</span><span class="id"> nz</span><span class="id"> cond</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">@Def</span><span class="id"> d</span><span class="id"> T</span><span class="id"> x0</span><span class="id"> nz</span><span class="id"> cond</span><span class="id"> r</span><span class="id"> P</span>.<br/>
<br/>
<span class="vernacular">Definition</span><span class="id"> from</span><span class="id"> {d</span><span class="id"> T</span><span class="id"> x0</span><span class="id"> nz</span><span class="id"> cond}</span><br/>
&nbsp;&nbsp;<span class="id">{x</span><span class="id"> :</span><span class="id"> @def</span><span class="id"> d</span><span class="id"> T</span><span class="id"> x0</span><span class="id"> nz</span><span class="id"> cond}</span> (<span class="id">phx</span><span class="id"> :</span><span class="id"> phantom</span><span class="id"> T</span><span class="id"> x</span>)<span class="id"> :=</span><span class="id"> x</span>.<br/>
<br/>
<span class="vernacular">Definition</span><span class="id"> fromP</span><span class="id"> {d</span><span class="id"> T</span><span class="id"> x0</span><span class="id"> nz</span><span class="id"> cond}</span><br/>
&nbsp;&nbsp;<span class="id">{x</span><span class="id"> :</span><span class="id"> @def</span><span class="id"> d</span><span class="id"> T</span><span class="id"> x0</span><span class="id"> nz</span><span class="id"> cond}</span> (<span class="id">phx</span><span class="id"> :</span><span class="id"> phantom</span><span class="id"> T</span><span class="id"> x</span>)<span class="id"> :=</span><span class="id"> P</span><span class="id"> x</span>.<br/>
<br/>
<span class="vernacular">Module</span><span class="vernacular"> Exports</span>.<br/>
<span class="vernacular">Coercion</span><span class="id"> Sign</span><span class="id"> :</span><span class="id"> sign</span><span class="id"> &gt;-&gt;</span><span class="id"> real</span>.<br/>
<span class="vernacular">Coercion</span><span class="id"> Real</span><span class="id"> :</span><span class="id"> real</span><span class="id"> &gt;-&gt;</span><span class="id"> reality</span>.<br/>
<span class="vernacular">Coercion</span><span class="id"> is_real</span><span class="id"> :</span><span class="id"> reality</span><span class="id"> &gt;-&gt;</span><span class="id"> bool</span>.<br/>
<span class="vernacular">Bind</span><span class="vernacular"> Scope</span><span class="id"> snum_sign_scope</span><span class="gallina-kwd"> with</span><span class="id"> sign</span>.<br/>
<span class="vernacular">Bind</span><span class="vernacular"> Scope</span><span class="id"> snum_sign_scope</span><span class="gallina-kwd"> with</span><span class="id"> reality</span>.<br/>
<span class="vernacular">Bind</span><span class="vernacular"> Scope</span><span class="id"> snum_nullity_scope</span><span class="gallina-kwd"> with</span><span class="id"> nullity</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;=0&quot;</span><span class="id"> :=</span><span class="id"> EqZero</span><span class="id"> :</span><span class="id"> snum_sign_scope</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;&gt;=0&quot;</span><span class="id"> :=</span><span class="id"> NonNeg</span><span class="id"> :</span><span class="id"> snum_sign_scope</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;&lt;=0&quot;</span><span class="id"> :=</span><span class="id"> NonPos</span><span class="id"> :</span><span class="id"> snum_sign_scope</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;&gt;=&lt;0&quot;</span><span class="id"> :=</span><span class="id"> AnySign</span><span class="id"> :</span><span class="id"> snum_sign_scope</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;&gt;?&lt;0&quot;</span><span class="id"> :=</span><span class="id"> Arbitrary</span><span class="id"> :</span><span class="id"> snum_sign_scope</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;!=0&quot;</span><span class="id"> :=</span><span class="id"> NonZero</span><span class="id"> :</span><span class="id"> snum_nullity_scope</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;?=0&quot;</span><span class="id"> :=</span><span class="id"> MaybeZero</span><span class="id"> :</span><span class="id"> snum_nullity_scope</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;{ 'compare' x0 &amp; nz &amp; cond }&quot;</span><span class="id"> :=</span> (<span class="id">def</span><span class="id"> x0</span><span class="id"> nz</span><span class="id"> cond</span>)<span class="id"> :</span><span class="id"> type_scope</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;{ 'num' R &amp; nz &amp; cond }&quot;</span><span class="id"> :=</span> (<span class="id">def</span> (<span class="id">0%R</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> nz</span><span class="id"> cond</span>)<span class="id"> :</span><span class="id"> ring_scope</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;{ = x0 : T }&quot;</span><span class="id"> :=</span> (<span class="id">def</span> (<span class="id">x0</span><span class="id"> :</span><span class="id"> T</span>)<span class="id"> MaybeZero</span><span class="id"> EqZero</span>)<span class="id"> :</span><span class="id"> type_scope</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;{ &gt; x0 : T }&quot;</span><span class="id"> :=</span> (<span class="id">def</span> (<span class="id">x0</span><span class="id"> :</span><span class="id"> T</span>)<span class="id"> NonZero</span><span class="id"> NonNeg</span>)<span class="id"> :</span><span class="id"> type_scope</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;{ &lt; x0 : T }&quot;</span><span class="id"> :=</span> (<span class="id">def</span> (<span class="id">x0</span><span class="id"> :</span><span class="id"> T</span>)<span class="id"> NonZero</span><span class="id"> NonPos</span>)<span class="id"> :</span><span class="id"> type_scope</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;{ &gt;= x0 : T }&quot;</span><span class="id"> :=</span> (<span class="id">def</span> (<span class="id">x0</span><span class="id"> :</span><span class="id"> T</span>)<span class="id"> MaybeZero</span><span class="id"> NonNeg</span>)<span class="id"> :</span><span class="id"> type_scope</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;{ &lt;= x0 : T }&quot;</span><span class="id"> :=</span> (<span class="id">def</span> (<span class="id">x0</span><span class="id"> :</span><span class="id"> T</span>)<span class="id"> MaybeZero</span><span class="id"> NonPos</span>)<span class="id"> :</span><span class="id"> type_scope</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;{ &gt;&lt; x0 : T }&quot;</span><span class="id"> :=</span> (<span class="id">def</span> (<span class="id">x0</span><span class="id"> :</span><span class="id"> T</span>)<span class="id"> NonZero</span><span class="id"> Real</span>)<span class="id"> :</span><span class="id"> type_scope</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;{ &gt;=&lt; x0 : T }&quot;</span><span class="id"> :=</span> (<span class="id">def</span> (<span class="id">x0</span><span class="id"> :</span><span class="id"> T</span>)<span class="id"> MaybeZero</span><span class="id"> Real</span>)<span class="id"> :</span><span class="id"> type_scope</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;{ != x0 : T }&quot;</span><span class="id"> :=</span> (<span class="id">def</span> (<span class="id">x0</span><span class="id"> :</span><span class="id"> T</span>)<span class="id"> NonZero</span><span class="id"> Arbitrary</span>)<span class="id"> :</span><span class="id"> type_scope</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;{ ?= x0 : T }&quot;</span><span class="id"> :=</span> (<span class="id">def</span> (<span class="id">x0</span><span class="id"> :</span><span class="id"> T</span>)<span class="id"> MaybeZero</span><span class="id"> Arbitrary</span>)<span class="id"> :</span><span class="id"> type_scope</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;{ = x0 }&quot;</span><span class="id"> :=</span> (<span class="id">def</span><span class="id"> x0</span><span class="id"> MaybeZero</span><span class="id"> EqZero</span>)<span class="id"> :</span><span class="id"> type_scope</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;{ &gt; x0 }&quot;</span><span class="id"> :=</span> (<span class="id">def</span><span class="id"> x0</span><span class="id"> NonZero</span><span class="id"> NonNeg</span>)<span class="id"> :</span><span class="id"> type_scope</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;{ &lt; x0 }&quot;</span><span class="id"> :=</span> (<span class="id">def</span><span class="id"> x0</span><span class="id"> NonZero</span><span class="id"> NonPos</span>)<span class="id"> :</span><span class="id"> type_scope</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;{ &gt;= x0 }&quot;</span><span class="id"> :=</span> (<span class="id">def</span><span class="id"> x0</span><span class="id"> MaybeZero</span><span class="id"> NonNeg</span>)<span class="id"> :</span><span class="id"> type_scope</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;{ &lt;= x0 }&quot;</span><span class="id"> :=</span> (<span class="id">def</span><span class="id"> x0</span><span class="id"> MaybeZero</span><span class="id"> NonPos</span>)<span class="id"> :</span><span class="id"> type_scope</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;{ &gt;&lt; x0 }&quot;</span><span class="id"> :=</span> (<span class="id">def</span><span class="id"> x0</span><span class="id"> NonZero</span><span class="id"> Real</span>)<span class="id"> :</span><span class="id"> type_scope</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;{ &gt;=&lt; x0 }&quot;</span><span class="id"> :=</span> (<span class="id">def</span><span class="id"> x0</span><span class="id"> MaybeZero</span><span class="id"> Real</span>)<span class="id"> :</span><span class="id"> type_scope</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;{ != x0 }&quot;</span><span class="id"> :=</span> (<span class="id">def</span><span class="id"> x0</span><span class="id"> NonZero</span><span class="id"> Arbitrary</span>)<span class="id"> :</span><span class="id"> type_scope</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;{ ?= x0 }&quot;</span><span class="id"> :=</span> (<span class="id">def</span><span class="id"> x0</span><span class="id"> MaybeZero</span><span class="id"> Arbitrary</span>)<span class="id"> :</span><span class="id"> type_scope</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;x %:sgn&quot;</span><span class="id"> :=</span> (<span class="id">from</span> (<span class="id">Phantom</span><span class="id"> _</span><span class="id"> x</span>))<span class="id"> :</span><span class="id"> ring_scope</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;[ 'sgn' 'of' x ]&quot;</span><span class="id"> :=</span> (<span class="id">fromP</span> (<span class="id">Phantom</span><span class="id"> _</span><span class="id"> x</span>))<span class="id"> :</span><span class="id"> ring_scope</span>.<br/>
<span class="vernacular">Notation</span><span class="id"> num</span><span class="id"> :=</span><span class="id"> r</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;x %:num&quot;</span><span class="id"> :=</span> (<span class="id">r</span><span class="id"> x</span>)<span class="id"> :</span><span class="id"> ring_scope</span>.<br/>
<span class="vernacular">Definition</span><span class="id"> posnum</span> (<span class="id">R</span><span class="id"> :</span><span class="id"> numDomainType</span>)<span class="id"> of</span><span class="id"> phant</span><span class="id"> R</span><span class="id"> :=</span><span class="id"> {&gt;</span><span class="id"> 0%R</span><span class="id"> :</span><span class="id"> R}</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;{ 'posnum' R }&quot;</span><span class="id"> :=</span> (<span class="id">@posnum</span><span class="id"> _</span> (<span class="id">Phant</span><span class="id"> R</span>)) <span class="id"> :</span><span class="id"> ring_scope</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;x %:posnum&quot;</span><span class="id"> :=</span> (<span class="id">@num</span><span class="id"> _</span><span class="id"> _</span><span class="id"> 0%R</span><span class="id"> !=0</span><span class="id"> &gt;=0</span><span class="id"> x</span>)<span class="id"> :</span><span class="id"> ring_scope</span>.<br/>
<span class="vernacular">Definition</span><span class="id"> nonneg</span> (<span class="id">R</span><span class="id"> :</span><span class="id"> numDomainType</span>)<span class="id"> of</span><span class="id"> phant</span><span class="id"> R</span><span class="id"> :=</span><span class="id"> {&gt;=</span><span class="id"> 0%R</span><span class="id"> :</span><span class="id"> R}</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;{ 'nonneg' R }&quot;</span><span class="id"> :=</span> (<span class="id">@nonneg</span><span class="id"> _</span> (<span class="id">Phant</span><span class="id"> R</span>)) <span class="id"> :</span><span class="id"> ring_scope</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;x %:nngnum&quot;</span><span class="id"> :=</span> (<span class="id">@num</span><span class="id"> _</span><span class="id"> _</span><span class="id"> 0%R</span><span class="id"> ?=0</span><span class="id"> &gt;=0</span><span class="id"> x</span>)<span class="id"> :</span><span class="id"> ring_scope</span>.<br/>
<span class="vernacular">Arguments</span><span class="id"> r</span><span class="id"> {disp</span><span class="id"> T</span><span class="id"> x0</span><span class="id"> nz</span><span class="id"> cond}</span>.<br/>
<span class="vernacular">End</span><span class="vernacular"> Exports</span>.<br/>
<span class="vernacular">End</span><span class="id"> Signed</span>.<br/>
<span class="vernacular">Export</span><span class="id"> Signed</span>.<span class="vernacular">Exports</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> POrder</span>.<br/>
<span class="vernacular">Variables</span> (<span class="id">d</span><span class="id"> :</span><span class="id"> Order</span>.<span class="id">disp_t</span>) (<span class="id">T</span><span class="id"> :</span><span class="id"> porderType</span><span class="id"> d</span>).<br/>
<span class="vernacular">Variables</span> (<span class="id">x0</span><span class="id"> :</span><span class="id"> T</span>) (<span class="id">nz</span><span class="id"> :</span><span class="id"> nullity</span>) (<span class="id">cond</span><span class="id"> :</span><span class="id"> reality</span>).<br/>
<span class="vernacular">Local</span><span class="vernacular"> Notation</span><span class="id"> sT</span><span class="id"> :=</span><span class="id"> {compare</span><span class="id"> x0</span><span class="id"> &amp;</span><span class="id"> nz</span><span class="id"> &amp;</span><span class="id"> cond}</span>.<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> [isSub</span><span class="gallina-kwd"> for</span><span class="id"> @Signed</span>.<span class="id">r</span><span class="id"> d</span><span class="id"> T</span><span class="id"> x0</span><span class="id"> nz</span><span class="id"> cond]</span>.<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :</span><span class="id"> Order</span>.<span class="id">POrder</span><span class="id"> d</span><span class="id"> sT</span><span class="id"> :=</span><span class="id"> [POrder</span><span class="id"> of</span><span class="id"> sT</span><span class="gallina-kwd"> by</span><span class="id"> &lt;:]</span>.<br/>
<span class="vernacular">End</span><span class="id"> POrder</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> top_typ_subproof</span><span class="id"> d</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> porderType</span><span class="id"> d</span>) (<span class="id">x0</span><span class="id"> x</span><span class="id"> :</span><span class="id"> T</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">Signed</span>.<span class="id">spec</span><span class="id"> x0</span><span class="id"> ?=0</span><span class="id"> &gt;?&lt;0</span><span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> []</span>. Qed.</div></details>
<br/>
<span class="vernacular">Canonical</span><span class="id"> top_typ</span><span class="id"> d</span> (<span class="id">T</span><span class="id"> :</span><span class="id"> porderType</span><span class="id"> d</span>) (<span class="id">x0</span><span class="id"> :</span><span class="id"> T</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">Signed</span>.<span class="id">Typ</span> (<span class="id">top_typ_subproof</span><span class="id"> x0</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> real_domain_typ_subproof</span> (<span class="id">R</span><span class="id"> :</span><span class="id"> realDomainType</span>) (<span class="id">x</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">Signed</span>.<span class="id">spec</span><span class="id"> 0%R</span><span class="id"> ?=0</span><span class="id"> &gt;=&lt;0</span><span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> /=</span><span class="id"> -realE</span><span class="id"> num_real</span>. Qed.</div></details>
<br/>
<span class="vernacular">Canonical</span><span class="id"> real_domain_typ</span> (<span class="id">R</span><span class="id"> :</span><span class="id"> realDomainType</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">Signed</span>.<span class="id">Typ</span> (<span class="id">@real_domain_typ_subproof</span><span class="id"> R</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> real_field_typ_subproof</span> (<span class="id">R</span><span class="id"> :</span><span class="id"> realFieldType</span>) (<span class="id">x</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">Signed</span>.<span class="id">spec</span><span class="id"> 0%R</span><span class="id"> ?=0</span><span class="id"> &gt;=&lt;0</span><span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id"> exact:</span><span class="id"> real_domain_typ_subproof</span>. Qed.</div></details>
<br/>
<span class="vernacular">Canonical</span><span class="id"> real_field_typ</span> (<span class="id">R</span><span class="id"> :</span><span class="id"> realFieldType</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">Signed</span>.<span class="id">Typ</span> (<span class="id">@real_field_typ_subproof</span><span class="id"> R</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> nat_typ_subproof</span> (<span class="id">x</span><span class="id"> :</span><span class="id"> nat</span>)<span class="id"> :</span><span class="id"> Signed</span>.<span class="id">spec</span><span class="id"> 0%N</span><span class="id"> ?=0</span><span class="id"> &gt;=0</span><span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> []</span>. Qed.</div></details>
<br/>
<span class="vernacular">Canonical</span><span class="id"> nat_typ</span><span class="id"> :=</span><span class="id"> Signed</span>.<span class="id">Typ</span><span class="id"> nat_typ_subproof</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> typ_snum_subproof</span><span class="id"> d</span><span class="id"> nz</span><span class="id"> cond</span> (<span class="id">xt</span><span class="id"> :</span><span class="id"> Signed</span>.<span class="id">typ</span><span class="id"> d</span><span class="id"> nz</span><span class="id"> cond</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">x</span><span class="id"> :</span><span class="id"> Signed</span>.<span class="id">sort</span><span class="id"> xt</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">Signed</span>.<span class="id">spec</span> (<span class="id">Signed</span>.<span class="id">sort_x0</span><span class="id"> xt</span>)<span class="id"> nz</span><span class="id"> cond</span><span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move:</span><span class="id"> xt</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> []</span>. Qed.</div></details>
<br/>
<div class="doc">This adds _ &lt;- Signed.r ( typ_snum )
   to canonical projections (c.f., Print Canonical Projections
   Signed.r) meaning that if no other canonical instance (with a
   registered head symbol) is found, a canonical instance of
   Signed.typ, like the ones above, will be looked for. </div>
<span class="vernacular">Canonical</span><span class="id"> typ_snum</span><span class="id"> d</span><span class="id"> nz</span><span class="id"> cond</span> (<span class="id">xt</span><span class="id"> :</span><span class="id"> Signed</span>.<span class="id">typ</span><span class="id"> d</span><span class="id"> nz</span><span class="id"> cond</span>) (<span class="id">x</span><span class="id"> :</span><span class="id"> Signed</span>.<span class="id">sort</span><span class="id"> xt</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">Signed</span>.<span class="id">mk</span> (<span class="id">typ_snum_subproof</span><span class="id"> x</span>).<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<span class="vernacular">Class</span><span class="id"> unify</span><span class="id"> {T}</span><span class="id"> f</span> (<span class="id">x</span><span class="id"> y</span><span class="id"> :</span><span class="id"> T</span>)<span class="id"> :=</span><span class="id"> Unify</span><span class="id"> :</span><span class="id"> f</span><span class="id"> x</span><span class="id"> y</span><span class="id"> =</span><span class="id"> true</span>.<br/>
<span class="id">#[global]</span><span class="vernacular"> Hint</span><span class="id"> Mode</span><span class="id"> unify</span><span class="id"> -</span><span class="id"> -</span><span class="id"> -</span><span class="id"> +</span><span class="id"> :</span><span class="id"> typeclass_instances</span>.<br/>
<span class="vernacular">Class</span><span class="id"> unify'</span><span class="id"> {T}</span><span class="id"> f</span> (<span class="id">x</span><span class="id"> y</span><span class="id"> :</span><span class="id"> T</span>)<span class="id"> :=</span><span class="id"> Unify'</span><span class="id"> :</span><span class="id"> f</span><span class="id"> x</span><span class="id"> y</span><span class="id"> =</span><span class="id"> true</span>.<br/>
<span class="id">#[global]</span><span class="vernacular"> Instance</span><span class="id"> unify'P</span><span class="id"> {T}</span><span class="id"> f</span> (<span class="id">x</span><span class="id"> y</span><span class="id"> :</span><span class="id"> T</span>)<span class="id"> :</span><span class="id"> unify'</span><span class="id"> f</span><span class="id"> x</span><span class="id"> y</span><span class="id"> -&gt;</span><span class="id"> unify</span><span class="id"> f</span><span class="id"> x</span><span class="id"> y</span><span class="id"> :=</span><span class="id"> id</span>.<br/>
<span class="id">#[global]</span><br/>
<span class="vernacular">Hint</span><span class="id"> Extern</span><span class="id"> 0</span> (<span class="id">unify'</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span>)<span class="id"> =&gt;</span><span class="id"> vm_compute;</span><span class="id"> reflexivity</span><span class="id"> :</span><span class="id"> typeclass_instances</span>.<br/>
<br/>
<span class="vernacular">Notation</span><span class="id"> unify_nz</span><span class="id"> nzx</span><span class="id"> nzy</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;(<span class="id">unify</span><span class="id"> wider_nullity</span><span class="id"> nzx%snum_nullity</span><span class="id"> nzy%snum_nullity</span>).<br/>
<span class="vernacular">Notation</span><span class="id"> unify_r</span><span class="id"> rx</span><span class="id"> ry</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;(<span class="id">unify</span><span class="id"> wider_reality</span><span class="id"> rx%snum_sign</span><span class="id"> ry%snum_sign</span>).<br/>
<br/>
<span class="id">#[global]</span><span class="vernacular"> Instance</span><span class="id"> anysign_wider_real</span><span class="id"> sign</span><span class="id"> :</span><span class="id"> unify_r</span> (<span class="id">Real</span><span class="id"> AnySign</span>) (<span class="id">Real</span><span class="id"> sign</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> []</span>. Qed.</div></details>
<br/>
<span class="id">#[global]</span><span class="vernacular"> Instance</span><span class="id"> any_reality_wider_eq0</span><span class="id"> cond</span><span class="id"> :</span><span class="id"> unify_r</span><span class="id"> cond</span><span class="id"> =0</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> case:</span><span class="id"> cond</span><span class="id"> =&gt;</span><span class="id"> [[[]|]|]</span>. Qed.</div></details>
<br/>
<span class="vernacular">Section</span><span class="id"> Theory</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {d</span><span class="id"> :</span><span class="id"> Order</span>.<span class="id">disp_t}</span><span class="id"> {T</span><span class="id"> :</span><span class="id"> porderType</span><span class="id"> d}</span><span class="id"> {x0</span><span class="id"> :</span><span class="id"> T}</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {nz</span><span class="id"> :</span><span class="id"> nullity}</span><span class="id"> {cond</span><span class="id"> :</span><span class="id"> reality}</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Notation</span><span class="id"> sT</span><span class="id"> :=</span><span class="id"> {compare</span><span class="id"> x0</span><span class="id"> &amp;</span><span class="id"> nz</span><span class="id"> &amp;</span><span class="id"> cond}</span>.<br/>
<span class="vernacular">Implicit</span><span class="gallina-kwd"> Type</span><span class="id"> x</span><span class="id"> :</span><span class="id"> sT</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> signed_intro</span><span class="id"> {x}</span><span class="id"> :</span><span class="id"> x%:num</span><span class="id"> =</span><span class="id"> x%:num</span><span class="id"> :&gt;</span><span class="id"> T</span><br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> []</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> bottom</span><span class="id"> x</span><span class="id"> :</span><span class="id"> unify_nz</span><span class="id"> !=0</span><span class="id"> nz</span><span class="id"> -&gt;</span><span class="id"> unify_r</span><span class="id"> =0</span><span class="id"> cond</span><span class="id"> -&gt;</span><span class="id"> False</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd">by</span><span class="id"> move:</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> [x</span><span class="id"> /=</span><span class="id"> /andP[]];</span><span class="id"> move:</span><span class="id"> cond</span><span class="id"> nz</span><span class="id"> =&gt;</span><span class="id"> [[[]|]|]</span><span class="id"> []</span><span class="id"> //=</span><span class="id"> /[swap]</span><span class="id"> -&gt;</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> gt0</span><span class="id"> x</span><span class="id"> :</span><span class="id"> unify_nz</span><span class="id"> !=0</span><span class="id"> nz</span><span class="id"> -&gt;</span><span class="id"> unify_r</span><span class="id"> &gt;=0</span><span class="id"> cond</span><span class="id"> -&gt;</span><span class="id"> x0</span><span class="id"> &lt;</span><span class="id"> x%:num</span><span class="id"> :&gt;</span><span class="id"> T</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move:</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> [x</span><span class="id"> /=</span><span class="id"> /andP[]]</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> move:</span><span class="id"> cond</span><span class="id"> nz</span><span class="id"> =&gt;</span><span class="id"> [[[]|]|]</span><span class="id"> []</span><span class="id"> //=;</span><span class="id"> rewrite</span><span class="id"> lt_def</span><span class="id"> =&gt;</span><span class="id"> -&gt;</span><span class="id"> //</span><span class="id"> /eqP</span><span class="id"> -&gt;</span><span class="id"> /=</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> le0F</span><span class="id"> x</span><span class="id"> :</span><span class="id"> unify_nz</span><span class="id"> !=0</span><span class="id"> nz</span><span class="id"> -&gt;</span><span class="id"> unify_r</span><span class="id"> &gt;=0</span><span class="id"> cond</span><span class="id"> -&gt;</span><span class="id"> x%:num</span><span class="id"> &lt;=</span><span class="id"> x0</span><span class="id"> :&gt;</span><span class="id"> T</span><span class="id"> =</span><span class="id"> false</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> ?</span><span class="id"> ?;</span><span class="id"> rewrite</span><span class="id"> lt_geF//;</span><span class="id"> apply:</span><span class="id"> gt0</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> lt0</span><span class="id"> x</span><span class="id"> :</span><span class="id"> unify_nz</span><span class="id"> !=0</span><span class="id"> nz</span><span class="id"> -&gt;</span><span class="id"> unify_r</span><span class="id"> &lt;=0</span><span class="id"> cond</span><span class="id"> -&gt;</span><span class="id"> x%:num</span><span class="id"> &lt;</span><span class="id"> x0</span><span class="id"> :&gt;</span><span class="id"> T</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move:</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> [x</span><span class="id"> /=</span><span class="id"> /andP[]]</span>.<br/>
<span class="id">move:</span><span class="id"> cond</span><span class="id"> nz</span><span class="id"> =&gt;</span><span class="id"> [[[]|]|]</span><span class="id"> []</span><span class="id"> //=;</span><span class="id"> rewrite</span><span class="id"> lt_def</span><span class="id"> [x0</span><span class="id"> ==</span><span class="id"> _]eq_sym</span><span class="id"> =&gt;</span><span class="id"> -&gt;</span><span class="id"> //</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> /eqP</span><span class="id"> -&gt;</span><span class="id"> /=</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> ge0F</span><span class="id"> x</span><span class="id"> :</span><span class="id"> unify_nz</span><span class="id"> !=0</span><span class="id"> nz</span><span class="id"> -&gt;</span><span class="id"> unify_r</span><span class="id"> &lt;=0</span><span class="id"> cond</span><span class="id"> -&gt;</span><span class="id"> x0</span><span class="id"> &lt;=</span><span class="id"> x%:num</span><span class="id"> :&gt;</span><span class="id"> T</span><span class="id"> =</span><span class="id"> false</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> ?</span><span class="id"> ?;</span><span class="id"> rewrite</span><span class="id"> lt_geF//;</span><span class="id"> apply:</span><span class="id"> lt0</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> ge0</span><span class="id"> x</span><span class="id"> :</span><span class="id"> unify_r</span><span class="id"> &gt;=0</span><span class="id"> cond</span><span class="id"> -&gt;</span><span class="id"> x0</span><span class="id"> &lt;=</span><span class="id"> x%:num</span><span class="id"> :&gt;</span><span class="id"> T</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd">by</span><span class="id"> case:</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> [x</span><span class="id"> /=</span><span class="id"> /andP[]];</span><span class="id"> move:</span><span class="id"> cond</span><span class="id"> nz</span><span class="id"> =&gt;</span><span class="id"> [[[]|]|]</span><span class="id"> []</span><span class="id"> //=</span><span class="id"> _</span><span class="id"> /eqP</span><span class="id"> -&gt;</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> lt0F</span><span class="id"> x</span><span class="id"> :</span><span class="id"> unify_r</span><span class="id"> &gt;=0</span><span class="id"> cond</span><span class="id"> -&gt;</span><span class="id"> x%:num</span><span class="id"> &lt;</span><span class="id"> x0</span><span class="id"> :&gt;</span><span class="id"> T</span><span class="id"> =</span><span class="id"> false</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> ?;</span><span class="id"> rewrite</span><span class="id"> le_gtF//;</span><span class="id"> apply:</span><span class="id"> ge0</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> le0</span><span class="id"> x</span><span class="id"> :</span><span class="id"> unify_r</span><span class="id"> &lt;=0</span><span class="id"> cond</span><span class="id"> -&gt;</span><span class="id"> x0</span><span class="id"> &gt;=</span><span class="id"> x%:num</span><span class="id"> :&gt;</span><span class="id"> T</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd">by</span><span class="id"> case:</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> [x</span><span class="id"> /=</span><span class="id"> /andP[]];</span><span class="id"> move:</span><span class="id"> cond</span><span class="id"> nz</span><span class="id"> =&gt;</span><span class="id"> [[[]|]|]</span><span class="id"> []</span><span class="id"> //=</span><span class="id"> _</span><span class="id"> /eqP</span><span class="id"> -&gt;</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> gt0F</span><span class="id"> x</span><span class="id"> :</span><span class="id"> unify_r</span><span class="id"> &lt;=0</span><span class="id"> cond</span><span class="id"> -&gt;</span><span class="id"> x0</span><span class="id"> &lt;</span><span class="id"> x%:num</span><span class="id"> :&gt;</span><span class="id"> T</span><span class="id"> =</span><span class="id"> false</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> ?;</span><span class="id"> rewrite</span><span class="id"> le_gtF//;</span><span class="id"> apply:</span><span class="id"> le0</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> cmp0</span><span class="id"> x</span><span class="id"> :</span><span class="id"> unify_r</span> (<span class="id">Real</span><span class="id"> AnySign</span>)<span class="id"> cond</span><span class="id"> -&gt;</span> (<span class="id">x0</span><span class="id"> &gt;=&lt;</span><span class="id"> x%:num</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">case:</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> [x</span><span class="id"> /=</span><span class="id"> /andP[]]</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> move:</span><span class="id"> cond</span><span class="id"> nz</span><span class="id"> =&gt;</span><span class="id"> [[[]|]|]</span><span class="id"> []</span><span class="id"> //=</span><span class="id"> _;</span><br/>
&nbsp;&nbsp;<span class="id">do</span><span class="id"> ?[by</span><span class="id"> move=&gt;</span><span class="id"> /eqP</span><span class="id"> -&gt;;</span><span class="id"> rewrite</span><span class="id"> comparablexx];</span><br/>
&nbsp;&nbsp;<span class="id">move=&gt;</span><span class="id"> sx;</span><span class="id"> rewrite</span><span class="id"> /Order</span>.<span class="id">comparable</span><span class="id"> sx//</span><span class="id"> orbT</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> neq0</span><span class="id"> x</span><span class="id"> :</span><span class="id"> unify_nz</span><span class="id"> !=0</span><span class="id"> nz</span><span class="id"> -&gt;</span><span class="id"> x%:num</span><span class="id"> !=</span><span class="id"> x0</span><span class="id"> :&gt;</span><span class="id"> T</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> case:</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> [x</span><span class="id"> /=</span><span class="id"> /andP[]];</span><span class="id"> move:</span><span class="id"> cond</span><span class="id"> nz</span><span class="id"> =&gt;</span><span class="id"> [[[]|]|]</span><span class="id"> []</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> eq0F</span><span class="id"> x</span><span class="id"> :</span><span class="id"> unify_nz</span><span class="id"> !=0</span><span class="id"> nz</span><span class="id"> -&gt;</span><span class="id"> x%:num</span><span class="id"> ==</span><span class="id"> x0</span><span class="id"> :&gt;</span><span class="id"> T</span><span class="id"> =</span><span class="id"> false</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> /neq0-/</span>(_<span class="id"> x</span>)<span class="id">/negPf-&gt;</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> eq0</span><span class="id"> x</span><span class="id"> :</span><span class="id"> unify_r</span><span class="id"> =0</span><span class="id"> cond</span><span class="id"> -&gt;</span><span class="id"> x%:num</span><span class="id"> =</span><span class="id"> x0</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd">by</span><span class="id"> case:</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> [x</span><span class="id"> /=</span><span class="id"> /andP[_]];</span><span class="id"> move:</span><span class="id"> cond</span><span class="id"> nz</span><span class="id"> =&gt;</span><span class="id"> [[[]|]|]</span><span class="id"> []</span><span class="id"> //=</span><span class="id"> /eqP</span><span class="id"> -&gt;</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> widen_signed_subproof</span><span class="id"> x</span><span class="id"> nz'</span><span class="id"> cond'</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">unify_nz</span><span class="id"> nz'</span><span class="id"> nz</span><span class="id"> -&gt;</span><span class="id"> unify_r</span><span class="id"> cond'</span><span class="id"> cond</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">Signed</span>.<span class="id">spec</span><span class="id"> x0</span><span class="id"> nz'</span><span class="id"> cond'</span><span class="id"> x%:num</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">case:</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> [x</span><span class="id"> /=</span><span class="id"> /andP[]]</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> case:</span><span class="id"> cond</span><span class="id"> nz</span><span class="id"> cond'</span><span class="id"> nz'</span><span class="id"> =&gt;</span><span class="id"> [[[]|]|]</span><span class="id"> []</span><span class="id"> [[[]|]|]</span><span class="id"> []</span><span class="id"> //=</span><span class="id"> nz''</span><span class="id"> cond'';</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> ?nz''</span><span class="id"> ?cond''</span><span class="id"> ?orbT</span><span class="id"> //;</span><span class="id"> move:</span><span class="id"> cond''</span><span class="id"> nz''</span><span class="id"> =&gt;</span><span class="id"> /eqP</span><span class="id"> -&gt;;</span><span class="id"> rewrite</span><span class="id"> lexx</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Definition</span><span class="id"> widen_signed</span><span class="id"> x</span><span class="id"> nz'</span><span class="id"> cond'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">unz</span><span class="id"> :</span><span class="id"> unify_nz</span><span class="id"> nz'</span><span class="id"> nz</span>) (<span class="id">ucond</span><span class="id"> :</span><span class="id"> unify_r</span><span class="id"> cond'</span><span class="id"> cond</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">Signed</span>.<span class="id">mk</span> (<span class="id">widen_signed_subproof</span><span class="id"> x</span><span class="id"> unz</span><span class="id"> ucond</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> widen_signedE</span><span class="id"> x</span> (<span class="id">unz</span><span class="id"> :</span><span class="id"> unify_nz</span><span class="id"> nz</span><span class="id"> nz</span>) (<span class="id">ucond</span><span class="id"> :</span><span class="id"> unify_r</span><span class="id"> cond</span><span class="id"> cond</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">@widen_signed</span><span class="id"> x</span><span class="id"> nz</span><span class="id"> cond</span><span class="id"> unz</span><span class="id"> ucond</span><span class="id"> =</span><span class="id"> x</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id"> exact/val_inj</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> posE</span> (<span class="id">x</span><span class="id"> :</span><span class="id"> sT</span>) (<span class="id">unz</span><span class="id"> :</span><span class="id"> unify_nz</span><span class="id"> !=0</span><span class="id"> nz</span>) (<span class="id">ucond</span><span class="id"> :</span><span class="id"> unify_r</span><span class="id"> &gt;=0</span><span class="id"> cond</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;(<span class="id">widen_signed</span><span class="id"> x%:num%:sgn</span><span class="id"> unz</span><span class="id"> ucond</span>)<span class="id">%:num</span><span class="id"> =</span><span class="id"> x%:num</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> []</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> nngE</span> (<span class="id">x</span><span class="id"> :</span><span class="id"> sT</span>) (<span class="id">unz</span><span class="id"> :</span><span class="id"> unify_nz</span><span class="id"> ?=0</span><span class="id"> nz</span>) (<span class="id">ucond</span><span class="id"> :</span><span class="id"> unify_r</span><span class="id"> &gt;=0</span><span class="id"> cond</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;(<span class="id">widen_signed</span><span class="id"> x%:num%:sgn</span><span class="id"> unz</span><span class="id"> ucond</span>)<span class="id">%:num</span><span class="id"> =</span><span class="id"> x%:num</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> []</span>. Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> Theory</span>.<br/>
<br/>
<span class="vernacular">Arguments</span><span class="id"> bottom</span><span class="id"> {d</span><span class="id"> T</span><span class="id"> x0</span><span class="id"> nz</span><span class="id"> cond}</span><span class="id"> _</span><span class="id"> {_</span><span class="id"> _}</span>.<br/>
<span class="vernacular">Arguments</span><span class="id"> gt0</span><span class="id"> {d</span><span class="id"> T</span><span class="id"> x0</span><span class="id"> nz</span><span class="id"> cond}</span><span class="id"> _</span><span class="id"> {_</span><span class="id"> _}</span>.<br/>
<span class="vernacular">Arguments</span><span class="id"> le0F</span><span class="id"> {d</span><span class="id"> T</span><span class="id"> x0</span><span class="id"> nz</span><span class="id"> cond}</span><span class="id"> _</span><span class="id"> {_</span><span class="id"> _}</span>.<br/>
<span class="vernacular">Arguments</span><span class="id"> lt0</span><span class="id"> {d</span><span class="id"> T</span><span class="id"> x0</span><span class="id"> nz</span><span class="id"> cond}</span><span class="id"> _</span><span class="id"> {_</span><span class="id"> _}</span>.<br/>
<span class="vernacular">Arguments</span><span class="id"> ge0F</span><span class="id"> {d</span><span class="id"> T</span><span class="id"> x0</span><span class="id"> nz</span><span class="id"> cond}</span><span class="id"> _</span><span class="id"> {_</span><span class="id"> _}</span>.<br/>
<span class="vernacular">Arguments</span><span class="id"> ge0</span><span class="id"> {d</span><span class="id"> T</span><span class="id"> x0</span><span class="id"> nz</span><span class="id"> cond}</span><span class="id"> _</span><span class="id"> {_}</span>.<br/>
<span class="vernacular">Arguments</span><span class="id"> lt0F</span><span class="id"> {d</span><span class="id"> T</span><span class="id"> x0</span><span class="id"> nz</span><span class="id"> cond}</span><span class="id"> _</span><span class="id"> {_}</span>.<br/>
<span class="vernacular">Arguments</span><span class="id"> le0</span><span class="id"> {d</span><span class="id"> T</span><span class="id"> x0</span><span class="id"> nz</span><span class="id"> cond}</span><span class="id"> _</span><span class="id"> {_}</span>.<br/>
<span class="vernacular">Arguments</span><span class="id"> gt0F</span><span class="id"> {d</span><span class="id"> T</span><span class="id"> x0</span><span class="id"> nz</span><span class="id"> cond}</span><span class="id"> _</span><span class="id"> {_}</span>.<br/>
<span class="vernacular">Arguments</span><span class="id"> cmp0</span><span class="id"> {d</span><span class="id"> T</span><span class="id"> x0</span><span class="id"> nz</span><span class="id"> cond}</span><span class="id"> _</span><span class="id"> {_}</span>.<br/>
<span class="vernacular">Arguments</span><span class="id"> neq0</span><span class="id"> {d</span><span class="id"> T</span><span class="id"> x0</span><span class="id"> nz</span><span class="id"> cond}</span><span class="id"> _</span><span class="id"> {_}</span>.<br/>
<span class="vernacular">Arguments</span><span class="id"> eq0F</span><span class="id"> {d</span><span class="id"> T</span><span class="id"> x0</span><span class="id"> nz</span><span class="id"> cond}</span><span class="id"> _</span><span class="id"> {_}</span>.<br/>
<span class="vernacular">Arguments</span><span class="id"> eq0</span><span class="id"> {d</span><span class="id"> T</span><span class="id"> x0</span><span class="id"> nz</span><span class="id"> cond}</span><span class="id"> _</span><span class="id"> {_}</span>.<br/>
<span class="vernacular">Arguments</span><span class="id"> widen_signed</span><span class="id"> {d</span><span class="id"> T</span><span class="id"> x0</span><span class="id"> nz</span><span class="id"> cond}</span><span class="id"> _</span><span class="id"> {_</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _}</span>.<br/>
<span class="vernacular">Arguments</span><span class="id"> widen_signedE</span><span class="id"> {d</span><span class="id"> T</span><span class="id"> x0</span><span class="id"> nz</span><span class="id"> cond}</span><span class="id"> _</span><span class="id"> {_</span><span class="id"> _}</span>.<br/>
<span class="vernacular">Arguments</span><span class="id"> posE</span><span class="id"> {d</span><span class="id"> T</span><span class="id"> x0</span><span class="id"> nz</span><span class="id"> cond}</span><span class="id"> _</span><span class="id"> {_</span><span class="id"> _}</span>.<br/>
<span class="vernacular">Arguments</span><span class="id"> nngE</span><span class="id"> {d</span><span class="id"> T</span><span class="id"> x0</span><span class="id"> nz</span><span class="id"> cond}</span><span class="id"> _</span><span class="id"> {_</span><span class="id"> _}</span>.<br/>
<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;[ 'gt0' 'of' x ]&quot;</span><span class="id"> :=</span> (<span class="id">ltac:</span>(<span class="id">refine</span> (<span class="id">gt0</span><span class="id"> x%:sgn</span>))).<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;[ 'lt0' 'of' x ]&quot;</span><span class="id"> :=</span> (<span class="id">ltac:</span>(<span class="id">refine</span> (<span class="id">lt0</span><span class="id"> x%:sgn</span>))).<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;[ 'ge0' 'of' x ]&quot;</span><span class="id"> :=</span> (<span class="id">ltac:</span>(<span class="id">refine</span> (<span class="id">ge0</span><span class="id"> x%:sgn</span>))).<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;[ 'le0' 'of' x ]&quot;</span><span class="id"> :=</span> (<span class="id">ltac:</span>(<span class="id">refine</span> (<span class="id">le0</span><span class="id"> x%:sgn</span>))).<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;[ 'cmp0' 'of' x ]&quot;</span><span class="id"> :=</span> (<span class="id">ltac:</span>(<span class="id">refine</span> (<span class="id">cmp0</span><span class="id"> x%:sgn</span>))).<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;[ 'neq0' 'of' x ]&quot;</span><span class="id"> :=</span> (<span class="id">ltac:</span>(<span class="id">refine</span> (<span class="id">neq0</span><span class="id"> x%:sgn</span>))).<br/>
<br/>
<span class="id">#[global]</span><span class="vernacular"> Hint</span><span class="id"> Extern</span><span class="id"> 0</span> (<span class="id">is_true</span> (<span class="id">0%R</span><span class="id"> &lt;</span><span class="id"> _</span>)<span class="id">%O</span>)<span class="id"> =&gt;</span><span class="id"> solve</span><span class="id"> [apply:</span><span class="id"> gt0]</span><span class="id"> :</span><span class="id"> core</span>.<br/>
<span class="id">#[global]</span><span class="vernacular"> Hint</span><span class="id"> Extern</span><span class="id"> 0</span> (<span class="id">is_true</span> (_<span class="id"> &lt;</span><span class="id"> 0%R</span>)<span class="id">%O</span>)<span class="id"> =&gt;</span><span class="id"> solve</span><span class="id"> [apply:</span><span class="id"> lt0]</span><span class="id"> :</span><span class="id"> core</span>.<br/>
<span class="id">#[global]</span><span class="vernacular"> Hint</span><span class="id"> Extern</span><span class="id"> 0</span> (<span class="id">is_true</span> (<span class="id">0%R</span><span class="id"> &lt;=</span><span class="id"> _</span>)<span class="id">%O</span>)<span class="id"> =&gt;</span><span class="id"> solve</span><span class="id"> [apply:</span><span class="id"> ge0]</span><span class="id"> :</span><span class="id"> core</span>.<br/>
<span class="id">#[global]</span><span class="vernacular"> Hint</span><span class="id"> Extern</span><span class="id"> 0</span> (<span class="id">is_true</span> (_<span class="id"> &lt;=</span><span class="id"> 0%R</span>)<span class="id">%O</span>)<span class="id"> =&gt;</span><span class="id"> solve</span><span class="id"> [apply:</span><span class="id"> le0]</span><span class="id"> :</span><span class="id"> core</span>.<br/>
<span class="id">#[global]</span><span class="vernacular"> Hint</span><span class="id"> Extern</span><span class="id"> 0</span> (<span class="id">is_true</span> (_<span class="id"> \is</span><span class="id"> Num</span>.<span class="id">real</span>))<span class="id"> =&gt;</span><span class="id"> solve</span><span class="id"> [apply:</span><span class="id"> cmp0]</span><span class="id"> :</span><span class="id"> core</span>.<br/>
<span class="id">#[global]</span><span class="vernacular"> Hint</span><span class="id"> Extern</span><span class="id"> 0</span> (<span class="id">is_true</span> (<span class="id">0%R</span><span class="id"> &gt;=&lt;</span><span class="id"> _</span>)<span class="id">%O</span>)<span class="id"> =&gt;</span><span class="id"> solve</span><span class="id"> [apply:</span><span class="id"> cmp0]</span><span class="id"> :</span><span class="id"> core</span>.<br/>
<span class="id">#[global]</span><span class="vernacular"> Hint</span><span class="id"> Extern</span><span class="id"> 0</span> (<span class="id">is_true</span> (_<span class="id"> !=</span><span class="id"> 0%R</span>)<span class="id">%O</span>)<span class="id"> =&gt;</span><span class="id"> solve</span><span class="id"> [apply:</span><span class="id"> neq0]</span><span class="id"> :</span><span class="id"> core</span>.<br/>
<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;x %:pos&quot;</span><span class="id"> :=</span> (<span class="id">widen_signed</span><span class="id"> x%:sgn</span><span class="id"> :</span><span class="id"> {posnum</span><span class="id"> _}</span>) (<span class="id">only</span><span class="id"> parsing</span>)<br/>
&nbsp;&nbsp;<span class="id">:</span><span class="id"> ring_scope</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;x %:nng&quot;</span><span class="id"> :=</span> (<span class="id">widen_signed</span><span class="id"> x%:sgn</span><span class="id"> :</span><span class="id"> {nonneg</span><span class="id"> _}</span>) (<span class="id">only</span><span class="id"> parsing</span>)<br/>
&nbsp;&nbsp;<span class="id">:</span><span class="id"> ring_scope</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;x %:pos&quot;</span><span class="id"> :=</span> (<span class="id">@widen_signed</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">@Signed</span>.<span class="id">from</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">Phantom</span><span class="id"> _</span><span class="id"> x</span>))<span class="id"> !=0</span> (<span class="id">Real</span> (<span class="id">Sign</span><span class="id"> &gt;=0</span>))<span class="id"> _</span><span class="id"> _</span>)<br/>
&nbsp;&nbsp;(<span class="id">only</span><span class="id"> printing</span>)<span class="id"> :</span><span class="id"> ring_scope</span>.<br/>
<span class="vernacular">Notation</span> <span class="id">&quot;x %:nng&quot;</span><span class="id"> :=</span> (<span class="id">@widen_signed</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">@Signed</span>.<span class="id">from</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">Phantom</span><span class="id"> _</span><span class="id"> x</span>))<span class="id"> ?=0</span> (<span class="id">Real</span> (<span class="id">Sign</span><span class="id"> &gt;=0</span>))<span class="id"> _</span><span class="id"> _</span>)<br/>
&nbsp;&nbsp;(<span class="id">only</span><span class="id"> printing</span>)<span class="id"> :</span><span class="id"> ring_scope</span>.<br/>
<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> ring_scope</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> Order</span>.<br/>
<span class="vernacular">Variables</span> (<span class="id">R</span><span class="id"> :</span><span class="id"> numDomainType</span>) (<span class="id">nz</span><span class="id"> :</span><span class="id"> nullity</span>) (<span class="id">r</span><span class="id"> :</span><span class="id"> real</span>).<br/>
<span class="vernacular">Local</span><span class="vernacular"> Notation</span><span class="id"> nR</span><span class="id"> :=</span><span class="id"> {num</span><span class="id"> R</span><span class="id"> &amp;</span><span class="id"> nz</span><span class="id"> &amp;</span><span class="id"> r}</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> signed_le_total</span><span class="id"> :</span><span class="id"> total</span> (<span class="id">&lt;=%O</span><span class="id"> :</span><span class="id"> rel</span><span class="id"> nR</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> y;</span><span class="id"> apply:</span><span class="id"> real_comparable</span><span class="id"> =&gt;</span><span class="id"> /=</span>. Qed.</div></details>
<br/>
<span class="id">HB</span>.<span class="id">instance</span><span class="vernacular"> Definition</span><span class="id"> _</span><span class="id"> :=</span><span class="id"> Order</span>.<span class="id">POrder_isTotal</span>.<span class="id">Build</span><span class="id"> ring_display</span><span class="id"> nR</span><br/>
&nbsp;&nbsp;<span class="id">signed_le_total</span>.<br/>
<br/>
<span class="vernacular">End</span><span class="id"> Order</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> POrderStability</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {disp</span><span class="id"> :</span><span class="id"> Order</span>.<span class="id">disp_t}</span><span class="id"> {T</span><span class="id"> :</span><span class="id"> porderType</span><span class="id"> disp}</span><span class="id"> {x0</span><span class="id"> :</span><span class="id"> T}</span>.<br/>
<br/>
<span class="vernacular">Definition</span><span class="id"> min_nonzero_subdef</span> (<span class="id">xnz</span><span class="id"> ynz</span><span class="id"> :</span><span class="id"> nullity</span>) (<span class="id">xr</span><span class="id"> yr</span><span class="id"> :</span><span class="id"> reality</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">nz_of_bool</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">xnz</span><span class="id"> &amp;&amp;</span><span class="id"> ynz</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">||</span><span class="id"> xnz</span><span class="id"> &amp;&amp;</span><span class="id"> yr</span><span class="id"> &amp;&amp;</span><span class="gallina-kwd"> match</span><span class="id"> xr</span><span class="gallina-kwd"> with</span><span class="id"> Real</span> (<span class="id">Sign</span><span class="id"> &lt;=0</span>)<span class="id"> =&gt;</span><span class="id"> true</span><span class="id"> |</span><span class="id"> _</span><span class="id"> =&gt;</span><span class="id"> false</span><span class="gallina-kwd"> end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">||</span><span class="id"> ynz</span><span class="id"> &amp;&amp;</span><span class="gallina-kwd"> match</span><span class="id"> yr</span><span class="gallina-kwd"> with</span><span class="id"> Real</span> (<span class="id">Sign</span><span class="id"> &lt;=0</span>)<span class="id"> =&gt;</span><span class="id"> true</span><span class="id"> |</span><span class="id"> _</span><span class="id"> =&gt;</span><span class="id"> false</span><span class="gallina-kwd"> end</span>).<br/>
<span class="vernacular">Arguments</span><span class="id"> min_nonzero_subdef</span><span class="id"> /</span>.<br/>
<br/>
<span class="vernacular">Definition</span><span class="id"> min_reality_subdef</span> (<span class="id">xnz</span><span class="id"> ynz</span><span class="id"> :</span><span class="id"> nullity</span>) (<span class="id">xr</span><span class="id"> yr</span><span class="id"> :</span><span class="id"> reality</span>)<span class="id"> :</span><span class="id"> reality</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">match</span><span class="id"> xr,</span><span class="id"> yr</span><span class="gallina-kwd"> with</span><br/>
&nbsp;&nbsp;<span class="id">|</span><span class="id"> Real</span> (<span class="id">Sign</span><span class="id"> =0</span>)<span class="id">,</span><span class="id"> Real</span> (<span class="id">Sign</span><span class="id"> =0</span>)<br/>
&nbsp;&nbsp;<span class="id">|</span><span class="id"> Real</span> (<span class="id">Sign</span><span class="id"> =0</span>)<span class="id">,</span><span class="id"> Real</span> (<span class="id">Sign</span><span class="id"> &gt;=0</span>)<br/>
&nbsp;&nbsp;<span class="id">|</span><span class="id"> Real</span> (<span class="id">Sign</span><span class="id"> &gt;=0</span>)<span class="id">,</span><span class="id"> Real</span> (<span class="id">Sign</span><span class="id"> =0</span>)<span class="id"> =&gt;</span><span class="id"> =0</span><br/>
&nbsp;&nbsp;<span class="id">|</span><span class="id"> Real</span> (<span class="id">Sign</span><span class="id"> &gt;=0</span>)<span class="id">,</span><span class="id"> Real</span> (<span class="id">Sign</span><span class="id"> &gt;=0</span>)<span class="id"> =&gt;</span><span class="id"> &gt;=0</span><br/>
&nbsp;&nbsp;<span class="id">|</span><span class="id"> Real</span> (<span class="id">Sign</span><span class="id"> &lt;=0</span>)<span class="id">,</span><span class="id"> Real</span><span class="id"> _</span><br/>
&nbsp;&nbsp;<span class="id">|</span><span class="id"> Real</span><span class="id"> _,</span><span class="id"> Real</span> (<span class="id">Sign</span><span class="id"> &lt;=0</span>)<span class="id"> =&gt;</span><span class="id"> &lt;=0</span><br/>
&nbsp;&nbsp;<span class="id">|</span><span class="id"> Real</span><span class="id"> _,</span><span class="id"> Real</span><span class="id"> _</span><span class="id"> =&gt;</span><span class="id"> &gt;=&lt;0</span><br/>
&nbsp;&nbsp;<span class="id">|</span><span class="id"> _,</span><span class="id"> _</span><span class="id"> =&gt;</span><span class="id"> &gt;?&lt;0</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">end</span>.<br/>
<span class="vernacular">Arguments</span><span class="id"> min_reality_subdef</span><span class="id"> /</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> min_snum_subproof</span> (<span class="id">xnz</span><span class="id"> ynz</span><span class="id"> :</span><span class="id"> nullity</span>) (<span class="id">xr</span><span class="id"> yr</span><span class="id"> :</span><span class="id"> reality</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">x</span><span class="id"> :</span><span class="id"> {compare</span><span class="id"> x0</span><span class="id"> &amp;</span><span class="id"> xnz</span><span class="id"> &amp;</span><span class="id"> xr}</span>) (<span class="id">y</span><span class="id"> :</span><span class="id"> {compare</span><span class="id"> x0</span><span class="id"> &amp;</span><span class="id"> ynz</span><span class="id"> &amp;</span><span class="id"> yr}</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">rnz</span><span class="id"> :=</span><span class="id"> min_nonzero_subdef</span><span class="id"> xnz</span><span class="id"> ynz</span><span class="id"> xr</span><span class="id"> yr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">rrl</span><span class="id"> :=</span><span class="id"> min_reality_subdef</span><span class="id"> xnz</span><span class="id"> ynz</span><span class="id"> xr</span><span class="id"> yr</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">Signed</span>.<span class="id">spec</span><span class="id"> x0</span><span class="id"> rnz</span><span class="id"> rrl</span> (<span class="id">Order</span>.<span class="id">min</span><span class="id"> x%:num</span><span class="id"> y%:num</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> {}/rnz</span><span class="id"> {}/rrl;</span><span class="id"> apply/andP;</span><span class="id"> split</span>.<br/>
&nbsp;&nbsp;<span class="id">move:</span><span class="id"> xr</span><span class="id"> yr</span><span class="id"> xnz</span><span class="id"> ynz</span><span class="id"> x</span><span class="id"> y</span><span class="id"> =&gt;</span><span class="id"> [[[]|]|]</span><span class="id"> [[[]|]|]</span><span class="id"> []</span><span class="id"> []//=</span><span class="id"> x</span><span class="id"> y;</span><span class="id"> rewrite</span><span class="id"> /Order</span>.<span class="id">min;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span><span class="id"> ?[by</span><span class="id"> case:</span> (<span class="id">bottom</span><span class="id"> x</span>)<span class="id">|by</span><span class="id"> case:</span> (<span class="id">bottom</span><span class="id"> y</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">|by</span><span class="id"> case:</span><span class="id"> ifP;</span><span class="id"> rewrite</span><span class="id"> ?eq0F//</span><span class="id"> =&gt;</span><span class="id"> xlty;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">have</span><span class="id"> :=</span><span class="id"> !!</span><span class="id"> lt_trans</span><span class="id"> xlty</span> (<span class="id">lt0</span><span class="id"> y</span>)<span class="id">;</span><span class="id"> rewrite</span><span class="id"> lt_neqAle</span><span class="id"> =&gt;</span><span class="id"> /andP[]</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">|by</span><span class="id"> rewrite</span><span class="id"> ifT</span><span class="id"> ?eq0F//;</span><span class="id"> apply:</span><span class="id"> lt_le_trans</span> (<span class="id">ge0</span><span class="id"> y</span>)<span class="id">;</span><span class="id"> exact:</span><span class="id"> lt0</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">|by</span><span class="id"> have</span><span class="id"> :=</span><span class="id"> !!</span><span class="id"> le0</span><span class="id"> y;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> le_eqVlt</span><span class="id"> =&gt;</span><span class="id"> /predU1P[-&gt;|];</span><span class="id"> rewrite</span><span class="id"> ?lt0</span><span class="id"> ?eq0F//;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">case:</span><span class="id"> ifP</span><span class="id"> =&gt;</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> ?eq0F//</span><span class="id"> lt_neqAle</span><span class="id"> =&gt;</span><span class="id"> /andP[]]</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> /orP[x0ley|]</span><span class="id"> :=</span><span class="id"> !!</span><span class="id"> cmp0</span><span class="id"> y</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> ifT</span><span class="id"> ?eq0F//;</span><span class="id"> apply:</span><span class="id"> lt_le_trans</span><span class="id"> x0ley;</span><span class="id"> exact:</span><span class="id"> lt0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> le_eqVlt</span><span class="id"> =&gt;</span><span class="id"> /predU1P[-&gt;|];</span><span class="id"> rewrite</span><span class="id"> ?lt0</span><span class="id"> ?eq0F//</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> case:</span><span class="id"> ifP</span><span class="id"> =&gt;</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> ?eq0F//</span><span class="id"> lt_neqAle</span><span class="id"> =&gt;</span><span class="id"> /andP[]</span>.<br/>
<span class="id">move:</span><span class="id"> xr</span><span class="id"> yr</span><span class="id"> xnz</span><span class="id"> ynz</span><span class="id"> x</span><span class="id"> y</span><span class="id"> =&gt;</span><span class="id"> [[[]|]|]</span><span class="id"> [[[]|]|]</span><span class="id"> []</span><span class="id"> []//=</span><span class="id"> x</span><span class="id"> y;</span><br/>
&nbsp;&nbsp;<span class="id">do</span><span class="id"> ?[by</span><span class="id"> case:</span> (<span class="id">bottom</span><span class="id"> x</span>)<span class="id">|by</span><span class="id"> case:</span> (<span class="id">bottom</span><span class="id"> y</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">|by</span><span class="id"> apply:</span><span class="id"> comparable_minr;</span><span class="id"> exact:</span><span class="id"> cmp0</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">|by</span><span class="id"> rewrite</span><span class="id"> minEle;</span><span class="id"> case:</span><span class="id"> ifP;</span><span class="id"> rewrite</span><span class="id"> ge0</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">|by</span><span class="id"> rewrite</span><span class="id"> ?eq0</span><span class="id"> minEle</span><span class="id"> ?ge0</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">|by</span><span class="id"> rewrite</span><span class="id"> ?eq0</span><span class="id"> minElt;</span><span class="id"> case:</span><span class="id"> ifP;</span><span class="id"> rewrite</span><span class="id"> ?eq0//</span><span class="id"> lt0F</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">|by</span><span class="id"> rewrite</span><span class="id"> minEle;</span><span class="id"> case:</span><span class="id"> ifP</span><span class="id"> =&gt;</span><span class="id"> [xlty|];</span><span class="id"> rewrite</span><span class="id"> ?le0//;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span> (<span class="id">le_trans</span><span class="id"> xlty</span>)<span class="id">;</span><span class="id"> rewrite</span><span class="id"> le0</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">|by</span><span class="id"> have</span><span class="id"> /orP[x0ley|]</span><span class="id"> :=</span><span class="id"> !!</span><span class="id"> cmp0</span><span class="id"> y;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">[rewrite</span><span class="id"> minEle</span><span class="id"> ifT</span><span class="id"> ?le0//;</span><span class="id"> apply:</span><span class="id"> le_trans</span><span class="id"> x0ley;</span><span class="id"> exact:</span><span class="id"> le0</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">|rewrite</span><span class="id"> minEle;</span><span class="id"> case:</span><span class="id"> ifP</span><span class="id"> =&gt;</span><span class="id"> //;</span><span class="id"> exact:</span><span class="id"> le_trans]]</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Canonical</span><span class="id"> min_snum</span> (<span class="id">xnz</span><span class="id"> ynz</span><span class="id"> :</span><span class="id"> nullity</span>) (<span class="id">xr</span><span class="id"> yr</span><span class="id"> :</span><span class="id"> reality</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">x</span><span class="id"> :</span><span class="id"> {compare</span><span class="id"> x0</span><span class="id"> &amp;</span><span class="id"> xnz</span><span class="id"> &amp;</span><span class="id"> xr}</span>) (<span class="id">y</span><span class="id"> :</span><span class="id"> {compare</span><span class="id"> x0</span><span class="id"> &amp;</span><span class="id"> ynz</span><span class="id"> &amp;</span><span class="id"> yr}</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">Signed</span>.<span class="id">mk</span> (<span class="id">min_snum_subproof</span><span class="id"> x</span><span class="id"> y</span>).<br/>
<br/>
<span class="vernacular">Definition</span><span class="id"> max_nonzero_subdef</span> (<span class="id">xnz</span><span class="id"> ynz</span><span class="id"> :</span><span class="id"> nullity</span>) (<span class="id">xr</span><span class="id"> yr</span><span class="id"> :</span><span class="id"> reality</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">nz_of_bool</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">xnz</span><span class="id"> &amp;&amp;</span><span class="id"> ynz</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">||</span><span class="id"> xnz</span><span class="id"> &amp;&amp;</span><span class="gallina-kwd"> match</span><span class="id"> xr</span><span class="gallina-kwd"> with</span><span class="id"> Real</span> (<span class="id">Sign</span><span class="id"> &gt;=0</span>)<span class="id"> =&gt;</span><span class="id"> true</span><span class="id"> |</span><span class="id"> _</span><span class="id"> =&gt;</span><span class="id"> false</span><span class="gallina-kwd"> end</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">||</span><span class="id"> ynz</span><span class="id"> &amp;&amp;</span><span class="id"> xr</span><span class="id"> &amp;&amp;</span><span class="gallina-kwd"> match</span><span class="id"> yr</span><span class="gallina-kwd"> with</span><span class="id"> Real</span> (<span class="id">Sign</span><span class="id"> &gt;=0</span>)<span class="id"> =&gt;</span><span class="id"> true</span><span class="id"> |</span><span class="id"> _</span><span class="id"> =&gt;</span><span class="id"> false</span><span class="gallina-kwd"> end</span>).<br/>
<span class="vernacular">Arguments</span><span class="id"> max_nonzero_subdef</span><span class="id"> /</span>.<br/>
<br/>
<span class="vernacular">Definition</span><span class="id"> max_reality_subdef</span> (<span class="id">xnz</span><span class="id"> ynz</span><span class="id"> :</span><span class="id"> nullity</span>) (<span class="id">xr</span><span class="id"> yr</span><span class="id"> :</span><span class="id"> reality</span>)<span class="id"> :</span><span class="id"> reality</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">match</span><span class="id"> xr,</span><span class="id"> yr</span><span class="gallina-kwd"> with</span><br/>
&nbsp;&nbsp;<span class="id">|</span><span class="id"> Real</span> (<span class="id">Sign</span><span class="id"> =0</span>)<span class="id">,</span><span class="id"> Real</span> (<span class="id">Sign</span><span class="id"> =0</span>)<br/>
&nbsp;&nbsp;<span class="id">|</span><span class="id"> Real</span> (<span class="id">Sign</span><span class="id"> =0</span>)<span class="id">,</span><span class="id"> Real</span> (<span class="id">Sign</span><span class="id"> &lt;=0</span>)<br/>
&nbsp;&nbsp;<span class="id">|</span><span class="id"> Real</span> (<span class="id">Sign</span><span class="id"> &lt;=0</span>)<span class="id">,</span><span class="id"> Real</span> (<span class="id">Sign</span><span class="id"> =0</span>)<span class="id"> =&gt;</span><span class="id"> =0</span><br/>
&nbsp;&nbsp;<span class="id">|</span><span class="id"> Real</span> (<span class="id">Sign</span><span class="id"> &lt;=0</span>)<span class="id">,</span><span class="id"> Real</span> (<span class="id">Sign</span><span class="id"> &lt;=0</span>)<span class="id"> =&gt;</span><span class="id"> &lt;=0</span><br/>
&nbsp;&nbsp;<span class="id">|</span><span class="id"> Real</span> (<span class="id">Sign</span><span class="id"> &gt;=0</span>)<span class="id">,</span><span class="id"> Real</span><span class="id"> _</span><br/>
&nbsp;&nbsp;<span class="id">|</span><span class="id"> Real</span><span class="id"> _,</span><span class="id"> Real</span> (<span class="id">Sign</span><span class="id"> &gt;=0</span>)<span class="id"> =&gt;</span><span class="id"> &gt;=0</span><br/>
&nbsp;&nbsp;<span class="id">|</span><span class="id"> Real</span><span class="id"> _,</span><span class="id"> Real</span><span class="id"> _</span><span class="id"> =&gt;</span><span class="id"> &gt;=&lt;0</span><br/>
&nbsp;&nbsp;<span class="id">|</span><span class="id"> _,</span><span class="id"> _</span><span class="id"> =&gt;</span><span class="id"> &gt;?&lt;0</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">end</span>.<br/>
<span class="vernacular">Arguments</span><span class="id"> max_reality_subdef</span><span class="id"> /</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> max_snum_subproof</span> (<span class="id">xnz</span><span class="id"> ynz</span><span class="id"> :</span><span class="id"> nullity</span>) (<span class="id">xr</span><span class="id"> yr</span><span class="id"> :</span><span class="id"> reality</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">x</span><span class="id"> :</span><span class="id"> {compare</span><span class="id"> x0</span><span class="id"> &amp;</span><span class="id"> xnz</span><span class="id"> &amp;</span><span class="id"> xr}</span>) (<span class="id">y</span><span class="id"> :</span><span class="id"> {compare</span><span class="id"> x0</span><span class="id"> &amp;</span><span class="id"> ynz</span><span class="id"> &amp;</span><span class="id"> yr}</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">rnz</span><span class="id"> :=</span><span class="id"> max_nonzero_subdef</span><span class="id"> xnz</span><span class="id"> ynz</span><span class="id"> xr</span><span class="id"> yr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">rrl</span><span class="id"> :=</span><span class="id"> max_reality_subdef</span><span class="id"> xnz</span><span class="id"> ynz</span><span class="id"> xr</span><span class="id"> yr</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">Signed</span>.<span class="id">spec</span><span class="id"> x0</span><span class="id"> rnz</span><span class="id"> rrl</span> (<span class="id">Order</span>.<span class="id">max</span><span class="id"> x%:num</span><span class="id"> y%:num</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> {}/rnz</span><span class="id"> {}/rrl;</span><span class="id"> apply/andP;</span><span class="id"> split</span>.<br/>
&nbsp;&nbsp;<span class="id">move:</span><span class="id"> xr</span><span class="id"> yr</span><span class="id"> xnz</span><span class="id"> ynz</span><span class="id"> x</span><span class="id"> y</span><span class="id"> =&gt;</span><span class="id"> [[[]|]|]</span><span class="id"> [[[]|]|]</span><span class="id"> []</span><span class="id"> []//=</span><span class="id"> x</span><span class="id"> y;</span><span class="id"> rewrite</span><span class="id"> maxElt;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span><span class="id"> ?[by</span><span class="id"> case:</span> (<span class="id">bottom</span><span class="id"> x</span>)<span class="id">|by</span><span class="id"> case:</span> (<span class="id">bottom</span><span class="id"> y</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">|by</span><span class="id"> case:</span><span class="id"> ifP</span><span class="id"> =&gt;</span><span class="id"> [xlty|];</span><span class="id"> rewrite</span><span class="id"> ?eq0F//;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span><span class="id"> [suff</span><span class="id"> :</span> (<span class="id">x0</span><span class="id"> &lt;</span><span class="id"> y%:num</span>)<span class="id">%O</span><span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> lt_def</span><span class="id"> =&gt;</span><span class="id"> /andP[]];</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">apply:</span><span class="id"> le_lt_trans</span><span class="id"> xlty;</span><span class="id"> exact:</span><span class="id"> ge0</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">|by</span><span class="id"> rewrite</span><span class="id"> ifT</span><span class="id"> ?eq0F//;</span><span class="id"> apply:</span><span class="id"> le_lt_trans</span> (<span class="id">gt0</span><span class="id"> y</span>)<span class="id">;</span><span class="id"> exact:</span><span class="id"> le0</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">|by</span><span class="id"> have</span><span class="id"> :=</span><span class="id"> !!</span><span class="id"> ge0</span><span class="id"> x;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> le_eqVlt</span><span class="id"> =&gt;</span><span class="id"> /predU1P[&lt;-|];</span><span class="id"> rewrite</span><span class="id"> ?gt0</span><span class="id"> ?eq0F//;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">case:</span><span class="id"> ifP</span><span class="id"> =&gt;</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> ?eq0F//</span><span class="id"> lt_def</span><span class="id"> =&gt;</span><span class="id"> /andP[]]</span>.<br/>
&nbsp;&nbsp;<span class="id">have</span><span class="id"> /orP[|xlex0]</span><span class="id"> :=</span><span class="id"> !!</span><span class="id"> cmp0</span><span class="id"> x</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> le_eqVlt</span><span class="id"> =&gt;</span><span class="id"> /predU1P[&lt;-|];</span><span class="id"> rewrite</span><span class="id"> ?gt0</span><span class="id"> ?eq0F//</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> case:</span><span class="id"> ifP</span><span class="id"> =&gt;</span><span class="id"> _;</span><span class="id"> rewrite</span><span class="id"> ?eq0F//</span><span class="id"> lt_def</span><span class="id"> =&gt;</span><span class="id"> /andP[]</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> ifT</span><span class="id"> ?eq0F//;</span><span class="id"> apply:</span> (<span class="id">le_lt_trans</span><span class="id"> xlex0</span>)<span class="id">;</span><span class="id"> exact:</span><span class="id"> gt0</span>.<br/>
<span class="id">move:</span><span class="id"> xr</span><span class="id"> yr</span><span class="id"> xnz</span><span class="id"> ynz</span><span class="id"> x</span><span class="id"> y</span><span class="id"> =&gt;</span><span class="id"> [[[]|]|]</span><span class="id"> [[[]|]|]</span><span class="id"> []</span><span class="id"> []//=</span><span class="id"> x</span><span class="id"> y;</span><br/>
&nbsp;&nbsp;<span class="id">do</span><span class="id"> ?[by</span><span class="id"> case:</span> (<span class="id">bottom</span><span class="id"> x</span>)<span class="id">|by</span><span class="id"> case:</span> (<span class="id">bottom</span><span class="id"> y</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">|by</span><span class="id"> apply:</span><span class="id"> comparable_maxr;</span><span class="id"> exact:</span><span class="id"> cmp0</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">|by</span><span class="id"> rewrite</span><span class="id"> ?eq0</span><span class="id"> maxEle</span><span class="id"> ?le0</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">|by</span><span class="id"> rewrite</span><span class="id"> ?eq0</span><span class="id"> maxElt</span><span class="id"> ifF//</span><span class="id"> le_gtF//</span><span class="id"> le0</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">|by</span><span class="id"> rewrite</span><span class="id"> maxEle;</span><span class="id"> case:</span><span class="id"> ifP;</span><span class="id"> rewrite</span><span class="id"> ?ge0//;</span><span class="id"> exact/le_trans/ge0</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">|by</span><span class="id"> rewrite</span><span class="id"> maxElt;</span><span class="id"> case:</span><span class="id"> ifP</span><span class="id"> =&gt;</span><span class="id"> [xlty|];</span><span class="id"> rewrite</span><span class="id"> ?le0//</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">|by</span><span class="id"> have</span><span class="id"> /orP[|xlex0]</span><span class="id"> :=</span><span class="id"> !!</span><span class="id"> cmp0</span><span class="id"> x;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">[rewrite</span><span class="id"> maxEle;</span><span class="id"> case:</span><span class="id"> ifP</span><span class="id"> =&gt;</span><span class="id"> //</span><span class="id"> /[swap];</span><span class="id"> exact:</span><span class="id"> le_trans</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">|rewrite</span><span class="id"> maxEle</span><span class="id"> ifT</span><span class="id"> ?ge0//;</span><span class="id"> apply:</span> (<span class="id">le_trans</span><span class="id"> xlex0</span>)<span class="id">;</span><span class="id"> exact:</span><span class="id"> ge0]]</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Canonical</span><span class="id"> max_snum</span> (<span class="id">xnz</span><span class="id"> ynz</span><span class="id"> :</span><span class="id"> nullity</span>) (<span class="id">xr</span><span class="id"> yr</span><span class="id"> :</span><span class="id"> reality</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">x</span><span class="id"> :</span><span class="id"> {compare</span><span class="id"> x0</span><span class="id"> &amp;</span><span class="id"> xnz</span><span class="id"> &amp;</span><span class="id"> xr}</span>) (<span class="id">y</span><span class="id"> :</span><span class="id"> {compare</span><span class="id"> x0</span><span class="id"> &amp;</span><span class="id"> ynz</span><span class="id"> &amp;</span><span class="id"> yr}</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">Signed</span>.<span class="id">mk</span> (<span class="id">max_snum_subproof</span><span class="id"> x</span><span class="id"> y</span>).<br/>
<br/>
<span class="vernacular">End</span><span class="id"> POrderStability</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> NumDomainStability</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {R</span><span class="id"> :</span><span class="id"> numDomainType}</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> zero_snum_subproof</span><span class="id"> :</span><span class="id"> Signed</span>.<span class="id">spec</span><span class="id"> 0</span><span class="id"> ?=0</span><span class="id"> =0</span> (<span class="id">0</span><span class="id"> :</span><span class="id"> R</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id"> exact:</span><span class="id"> eqxx</span>. Qed.</div></details>
<br/>
<span class="vernacular">Canonical</span><span class="id"> zero_snum</span><span class="id"> :=</span><span class="id"> Signed</span>.<span class="id">mk</span><span class="id"> zero_snum_subproof</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> one_snum_subproof</span><span class="id"> :</span><span class="id"> Signed</span>.<span class="id">spec</span><span class="id"> 0</span><span class="id"> !=0</span><span class="id"> &gt;=0</span> (<span class="id">1</span><span class="id"> :</span><span class="id"> R</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> /=</span><span class="id"> oner_eq0</span><span class="id"> ler01</span>. Qed.</div></details>
<br/>
<span class="vernacular">Canonical</span><span class="id"> one_snum</span><span class="id"> :=</span><span class="id"> Signed</span>.<span class="id">mk</span><span class="id"> one_snum_subproof</span>.<br/>
<br/>
<span class="vernacular">Definition</span><span class="id"> opp_reality_subdef</span> (<span class="id">xnz</span><span class="id"> :</span><span class="id"> nullity</span>) (<span class="id">xr</span><span class="id"> :</span><span class="id"> reality</span>)<span class="id"> :</span><span class="id"> reality</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">match</span><span class="id"> xr</span><span class="gallina-kwd"> with</span><br/>
&nbsp;&nbsp;<span class="id">|</span><span class="id"> Real</span> (<span class="id">Sign</span><span class="id"> =0</span>)<span class="id"> =&gt;</span><span class="id"> =0</span><br/>
&nbsp;&nbsp;<span class="id">|</span><span class="id"> Real</span> (<span class="id">Sign</span><span class="id"> &gt;=0</span>)<span class="id"> =&gt;</span><span class="id"> &lt;=0</span><br/>
&nbsp;&nbsp;<span class="id">|</span><span class="id"> Real</span> (<span class="id">Sign</span><span class="id"> &lt;=0</span>)<span class="id"> =&gt;</span><span class="id"> &gt;=0</span><br/>
&nbsp;&nbsp;<span class="id">|</span><span class="id"> Real</span><span class="id"> AnySign</span>   <span class="id"> =&gt;</span><span class="id"> &gt;=&lt;0</span><br/>
&nbsp;&nbsp;<span class="id">|</span><span class="id"> Arbitrary</span>             <span class="id"> =&gt;</span><span class="id"> &gt;?&lt;0</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">end</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> opp_snum_subproof</span> (<span class="id">xnz</span><span class="id"> :</span><span class="id"> nullity</span>) (<span class="id">xr</span><span class="id"> :</span><span class="id"> reality</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">x</span><span class="id"> :</span><span class="id"> {num</span><span class="id"> R</span><span class="id"> &amp;</span><span class="id"> xnz</span><span class="id"> &amp;</span><span class="id"> xr}</span>) (<span class="id">r</span><span class="id"> :=</span><span class="id"> opp_reality_subdef</span><span class="id"> xnz</span><span class="id"> xr</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">Signed</span>.<span class="id">spec</span><span class="id"> 0</span><span class="id"> xnz</span><span class="id"> r</span> (<span class="id">-</span><span class="id"> x%:num</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> {}/r;</span><span class="id"> case:</span><span class="id"> xr</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> [[[]|]|]//=</span><span class="id"> [r]/=;</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> oppr_eq0</span><span class="id"> ?</span>(<span class="id">oppr_ge0,</span><span class="id"> oppr_le0</span>)<span class="id">//</span><span class="id"> orbC</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Canonical</span><span class="id"> opp_snum</span> (<span class="id">xnz</span><span class="id"> :</span><span class="id"> nullity</span>) (<span class="id">xr</span><span class="id"> :</span><span class="id"> reality</span>) (<span class="id">x</span><span class="id"> :</span><span class="id"> {num</span><span class="id"> R</span><span class="id"> &amp;</span><span class="id"> xnz</span><span class="id"> &amp;</span><span class="id"> xr}</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">Signed</span>.<span class="id">mk</span> (<span class="id">opp_snum_subproof</span><span class="id"> x</span>).<br/>
<br/>
<span class="vernacular">Definition</span><span class="id"> add_samesign_subdef</span> (<span class="id">xnz</span><span class="id"> ynz</span><span class="id"> :</span><span class="id"> nullity</span>) (<span class="id">xr</span><span class="id"> yr</span><span class="id"> :</span><span class="id"> reality</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">match</span><span class="id"> xr,</span><span class="id"> yr</span><span class="gallina-kwd"> with</span><br/>
&nbsp;&nbsp;<span class="id">|</span><span class="id"> Real</span> (<span class="id">Sign</span><span class="id"> &gt;=0</span>)<span class="id">,</span><span class="id"> Real</span> (<span class="id">Sign</span><span class="id"> =0</span>)<br/>
&nbsp;&nbsp;<span class="id">|</span><span class="id"> Real</span> (<span class="id">Sign</span><span class="id"> =0</span>)<span class="id">,</span><span class="id"> Real</span> (<span class="id">Sign</span><span class="id"> &gt;=0</span>)<br/>
&nbsp;&nbsp;<span class="id">|</span><span class="id"> Real</span> (<span class="id">Sign</span><span class="id"> &lt;=0</span>)<span class="id">,</span><span class="id"> Real</span> (<span class="id">Sign</span><span class="id"> =0</span>)<br/>
&nbsp;&nbsp;<span class="id">|</span><span class="id"> Real</span> (<span class="id">Sign</span><span class="id"> =0</span>)<span class="id">,</span><span class="id"> Real</span> (<span class="id">Sign</span><span class="id"> &lt;=0</span>)<br/>
&nbsp;&nbsp;<span class="id">|</span><span class="id"> Real</span> (<span class="id">Sign</span><span class="id"> =0</span>)<span class="id">,</span><span class="id"> Real</span> (<span class="id">Sign</span><span class="id"> =0</span>)<br/>
&nbsp;&nbsp;<span class="id">|</span><span class="id"> Real</span> (<span class="id">Sign</span><span class="id"> &gt;=0</span>)<span class="id">,</span><span class="id"> Real</span> (<span class="id">Sign</span><span class="id"> &gt;=0</span>)<br/>
&nbsp;&nbsp;<span class="id">|</span><span class="id"> Real</span> (<span class="id">Sign</span><span class="id"> &lt;=0</span>)<span class="id">,</span><span class="id"> Real</span> (<span class="id">Sign</span><span class="id"> &lt;=0</span>)<span class="id"> =&gt;</span><span class="id"> true</span><br/>
&nbsp;&nbsp;<span class="id">|</span><span class="id"> _,</span><span class="id"> _</span><span class="id"> =&gt;</span><span class="id"> false</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">end</span>.<br/>
<br/>
<span class="vernacular">Definition</span><span class="id"> add_nonzero_subdef</span> (<span class="id">xnz</span><span class="id"> ynz</span><span class="id"> :</span><span class="id"> nullity</span>) (<span class="id">xr</span><span class="id"> yr</span><span class="id"> :</span><span class="id"> reality</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">nz_of_bool</span> (<span class="id">add_samesign_subdef</span><span class="id"> xnz</span><span class="id"> ynz</span><span class="id"> xr</span><span class="id"> yr</span><span class="id"> &amp;&amp;</span> (<span class="id">xnz</span><span class="id"> ||</span><span class="id"> ynz</span>)).<br/>
<span class="vernacular">Arguments</span><span class="id"> add_nonzero_subdef</span><span class="id"> /</span>.<br/>
<br/>
<span class="vernacular">Definition</span><span class="id"> add_reality_subdef</span> (<span class="id">xnz</span><span class="id"> ynz</span><span class="id"> :</span><span class="id"> nullity</span>) (<span class="id">xr</span><span class="id"> yr</span><span class="id"> :</span><span class="id"> reality</span>)<span class="id"> :</span><span class="id"> reality</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">match</span><span class="id"> xr,</span><span class="id"> yr</span><span class="gallina-kwd"> with</span><br/>
&nbsp;&nbsp;<span class="id">|</span><span class="id"> Real</span> (<span class="id">Sign</span><span class="id"> =0</span>)<span class="id">,</span><span class="id"> Real</span> (<span class="id">Sign</span><span class="id"> =0</span>)<span class="id"> =&gt;</span><span class="id"> =0</span><br/>
&nbsp;&nbsp;<span class="id">|</span><span class="id"> Real</span> (<span class="id">Sign</span><span class="id"> &gt;=0</span>)<span class="id">,</span><span class="id"> Real</span> (<span class="id">Sign</span><span class="id"> =0</span>)<br/>
&nbsp;&nbsp;<span class="id">|</span><span class="id"> Real</span> (<span class="id">Sign</span><span class="id"> =0</span>)<span class="id">,</span><span class="id"> Real</span> (<span class="id">Sign</span><span class="id"> &gt;=0</span>)<br/>
&nbsp;&nbsp;<span class="id">|</span><span class="id"> Real</span> (<span class="id">Sign</span><span class="id"> &gt;=0</span>)<span class="id">,</span><span class="id"> Real</span> (<span class="id">Sign</span><span class="id"> &gt;=0</span>)<span class="id"> =&gt;</span><span class="id"> &gt;=0</span><br/>
&nbsp;&nbsp;<span class="id">|</span><span class="id"> Real</span> (<span class="id">Sign</span><span class="id"> &lt;=0</span>)<span class="id">,</span><span class="id"> Real</span> (<span class="id">Sign</span><span class="id"> =0</span>)<br/>
&nbsp;&nbsp;<span class="id">|</span><span class="id"> Real</span> (<span class="id">Sign</span><span class="id"> =0</span>)<span class="id">,</span><span class="id"> Real</span> (<span class="id">Sign</span><span class="id"> &lt;=0</span>)<br/>
&nbsp;&nbsp;<span class="id">|</span><span class="id"> Real</span> (<span class="id">Sign</span><span class="id"> &lt;=0</span>)<span class="id">,</span><span class="id"> Real</span> (<span class="id">Sign</span><span class="id"> &lt;=0</span>)<span class="id"> =&gt;</span><span class="id"> &lt;=0</span><br/>
&nbsp;&nbsp;<span class="id">|</span><span class="id"> Real</span><span class="id"> _,</span><span class="id"> Real</span><span class="id"> _</span><span class="id"> =&gt;</span><span class="id"> &gt;=&lt;0</span><br/>
&nbsp;&nbsp;<span class="id">|</span><span class="id"> _,</span><span class="id"> _</span><span class="id"> =&gt;</span><span class="id"> &gt;?&lt;0</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">end</span>.<br/>
<span class="vernacular">Arguments</span><span class="id"> add_reality_subdef</span><span class="id"> /</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> add_snum_subproof</span> (<span class="id">xnz</span><span class="id"> ynz</span><span class="id"> :</span><span class="id"> nullity</span>) (<span class="id">xr</span><span class="id"> yr</span><span class="id"> :</span><span class="id"> reality</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">x</span><span class="id"> :</span><span class="id"> {num</span><span class="id"> R</span><span class="id"> &amp;</span><span class="id"> xnz</span><span class="id"> &amp;</span><span class="id"> xr}</span>) (<span class="id">y</span><span class="id"> :</span><span class="id"> {num</span><span class="id"> R</span><span class="id"> &amp;</span><span class="id"> ynz</span><span class="id"> &amp;</span><span class="id"> yr}</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">rnz</span><span class="id"> :=</span><span class="id"> add_nonzero_subdef</span><span class="id"> xnz</span><span class="id"> ynz</span><span class="id"> xr</span><span class="id"> yr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">rrl</span><span class="id"> :=</span><span class="id"> add_reality_subdef</span><span class="id"> xnz</span><span class="id"> ynz</span><span class="id"> xr</span><span class="id"> yr</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">Signed</span>.<span class="id">spec</span><span class="id"> 0</span><span class="id"> rnz</span><span class="id"> rrl</span> (<span class="id">x%:num</span><span class="id"> +</span><span class="id"> y%:num</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> {}/rnz</span><span class="id"> {}/rrl;</span><span class="id"> apply/andP;</span><span class="id"> split</span>.<br/>
&nbsp;&nbsp;<span class="id">move:</span><span class="id"> xr</span><span class="id"> yr</span><span class="id"> xnz</span><span class="id"> ynz</span><span class="id"> x</span><span class="id"> y</span><span class="id"> =&gt;</span><span class="id"> [[[]|]|]</span><span class="id"> [[[]|]|]</span><span class="id"> []</span><span class="id"> []//=</span><span class="id"> x</span><span class="id"> y;</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> 1?addr_ss_eq0</span><span class="id"> ?</span>(<span class="id">eq0F,</span><span class="id"> ge0,</span><span class="id"> le0,</span><span class="id"> andbF,</span><span class="id"> orbT</span>).<br/>
<span class="id">have</span><span class="id"> addr_le0</span> (<span class="id">a</span><span class="id"> b</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span><span class="id"> a</span><span class="id"> &lt;=</span><span class="id"> 0</span><span class="id"> -&gt;</span><span class="id"> b</span><span class="id"> &lt;=</span><span class="id"> 0</span><span class="id"> -&gt;</span><span class="id"> a</span><span class="id"> +</span><span class="id"> b</span><span class="id"> &lt;=</span><span class="id"> 0</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -!oppr_ge0</span><span class="id"> opprD;</span><span class="id"> apply:</span><span class="id"> addr_ge0</span>.<br/>
<span class="id">move:</span><span class="id"> xr</span><span class="id"> yr</span><span class="id"> xnz</span><span class="id"> ynz</span><span class="id"> x</span><span class="id"> y</span><span class="id"> =&gt;</span><span class="id"> [[[]|]|]</span><span class="id"> [[[]|]|]</span><span class="id"> []</span><span class="id"> []//=</span><span class="id"> x</span><span class="id"> y;</span><br/>
&nbsp;&nbsp;<span class="id">do</span><span class="id"> ?[by</span><span class="id"> rewrite</span><span class="id"> addr_ge0|by</span><span class="id"> rewrite</span><span class="id"> addr_le0|by</span><span class="id"> rewrite</span><span class="id"> -realE</span><span class="id"> realD</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">|by</span><span class="id"> case:</span> (<span class="id">bottom</span><span class="id"> x</span>)<span class="id">|by</span><span class="id"> case:</span> (<span class="id">bottom</span><span class="id"> y</span>)<span class="id">|by</span><span class="id"> rewrite</span><span class="id"> !eq0</span><span class="id"> addr0]</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Canonical</span><span class="id"> add_snum</span> (<span class="id">xnz</span><span class="id"> ynz</span><span class="id"> :</span><span class="id"> nullity</span>) (<span class="id">xr</span><span class="id"> yr</span><span class="id"> :</span><span class="id"> reality</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">x</span><span class="id"> :</span><span class="id"> {num</span><span class="id"> R</span><span class="id"> &amp;</span><span class="id"> xnz</span><span class="id"> &amp;</span><span class="id"> xr}</span>) (<span class="id">y</span><span class="id"> :</span><span class="id"> {num</span><span class="id"> R</span><span class="id"> &amp;</span><span class="id"> ynz</span><span class="id"> &amp;</span><span class="id"> yr}</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">Signed</span>.<span class="id">mk</span> (<span class="id">add_snum_subproof</span><span class="id"> x</span><span class="id"> y</span>).<br/>
<br/>
<span class="vernacular">Definition</span><span class="id"> mul_nonzero_subdef</span> (<span class="id">xnz</span><span class="id"> ynz</span><span class="id"> :</span><span class="id"> nullity</span>) (<span class="id">xr</span><span class="id"> yr</span><span class="id"> :</span><span class="id"> reality</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">nz_of_bool</span> (<span class="id">xnz</span><span class="id"> &amp;&amp;</span><span class="id"> ynz</span>).<br/>
<span class="vernacular">Arguments</span><span class="id"> mul_nonzero_subdef</span><span class="id"> /</span>.<br/>
<br/>
<span class="vernacular">Definition</span><span class="id"> mul_reality_subdef</span> (<span class="id">xnz</span><span class="id"> ynz</span><span class="id"> :</span><span class="id"> nullity</span>) (<span class="id">xr</span><span class="id"> yr</span><span class="id"> :</span><span class="id"> reality</span>)<span class="id"> :</span><span class="id"> reality</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">match</span><span class="id"> xr,</span><span class="id"> yr</span><span class="gallina-kwd"> with</span><br/>
&nbsp;&nbsp;<span class="id">|</span><span class="id"> Real</span> (<span class="id">Sign</span><span class="id"> =0</span>)<span class="id">,</span><span class="id"> _</span><span class="id"> |</span><span class="id"> _,</span><span class="id"> Real</span> (<span class="id">Sign</span><span class="id"> =0</span>)<span class="id"> =&gt;</span><span class="id"> =0</span><br/>
&nbsp;&nbsp;<span class="id">|</span><span class="id"> Real</span> (<span class="id">Sign</span><span class="id"> &gt;=0</span>)<span class="id">,</span><span class="id"> Real</span> (<span class="id">Sign</span><span class="id"> &gt;=0</span>)<br/>
&nbsp;&nbsp;<span class="id">|</span><span class="id"> Real</span> (<span class="id">Sign</span><span class="id"> &lt;=0</span>)<span class="id">,</span><span class="id"> Real</span> (<span class="id">Sign</span><span class="id"> &lt;=0</span>)<span class="id"> =&gt;</span><span class="id"> &gt;=0</span><br/>
&nbsp;&nbsp;<span class="id">|</span><span class="id"> Real</span> (<span class="id">Sign</span><span class="id"> &gt;=0</span>)<span class="id">,</span><span class="id"> Real</span> (<span class="id">Sign</span><span class="id"> &lt;=0</span>)<br/>
&nbsp;&nbsp;<span class="id">|</span><span class="id"> Real</span> (<span class="id">Sign</span><span class="id"> &lt;=0</span>)<span class="id">,</span><span class="id"> Real</span> (<span class="id">Sign</span><span class="id"> &gt;=0</span>)<span class="id"> =&gt;</span><span class="id"> &lt;=0</span><br/>
&nbsp;&nbsp;<span class="id">|</span><span class="id"> Real</span><span class="id"> _,</span>         <span class="id"> Real</span><span class="id"> _</span>         <span class="id"> =&gt;</span><span class="id"> &gt;=&lt;0</span><br/>
&nbsp;&nbsp;<span class="id">|</span><span class="id"> _</span><span class="id"> ,</span><span class="id"> _</span>                           <span class="id"> =&gt;</span><span class="id"> &gt;?&lt;0</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">end</span>.<br/>
<span class="vernacular">Arguments</span><span class="id"> mul_reality_subdef</span><span class="id"> /</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> mul_snum_subproof</span> (<span class="id">xnz</span><span class="id"> ynz</span><span class="id"> :</span><span class="id"> nullity</span>) (<span class="id">xr</span><span class="id"> yr</span><span class="id"> :</span><span class="id"> reality</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">x</span><span class="id"> :</span><span class="id"> {num</span><span class="id"> R</span><span class="id"> &amp;</span><span class="id"> xnz</span><span class="id"> &amp;</span><span class="id"> xr}</span>) (<span class="id">y</span><span class="id"> :</span><span class="id"> {num</span><span class="id"> R</span><span class="id"> &amp;</span><span class="id"> ynz</span><span class="id"> &amp;</span><span class="id"> yr}</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">rnz</span><span class="id"> :=</span><span class="id"> mul_nonzero_subdef</span><span class="id"> xnz</span><span class="id"> ynz</span><span class="id"> xr</span><span class="id"> yr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">rrl</span><span class="id"> :=</span><span class="id"> mul_reality_subdef</span><span class="id"> xnz</span><span class="id"> ynz</span><span class="id"> xr</span><span class="id"> yr</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">Signed</span>.<span class="id">spec</span><span class="id"> 0</span><span class="id"> rnz</span><span class="id"> rrl</span> (<span class="id">x%:num</span><span class="id"> *</span><span class="id"> y%:num</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> {}/rnz</span><span class="id"> {}/rrl;</span><span class="id"> apply/andP;</span><span class="id"> split</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move:</span><span class="id"> xr</span><span class="id"> yr</span><span class="id"> xnz</span><span class="id"> ynz</span><span class="id"> x</span><span class="id"> y</span><span class="id"> =&gt;</span><span class="id"> [[[]|]|]</span><span class="id"> [[[]|]|]</span><span class="id"> []</span><span class="id"> []//</span><span class="id"> x</span><span class="id"> y;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> mulf_neq0</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> move:</span><span class="id"> xr</span><span class="id"> yr</span><span class="id"> xnz</span><span class="id"> ynz</span><span class="id"> x</span><span class="id"> y</span><span class="id"> =&gt;</span><span class="id"> [[[]|]|]</span><span class="id"> [[[]|]|]</span><span class="id"> []</span><span class="id"> []/=</span><span class="id"> x</span><span class="id"> y</span><span class="id"> //;</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id">do</span><span class="id"> ?[by</span><span class="id"> rewrite</span><span class="id"> mulr_ge0|by</span><span class="id"> rewrite</span><span class="id"> mulr_le0_ge0</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">|by</span><span class="id"> rewrite</span><span class="id"> mulr_ge0_le0|by</span><span class="id"> rewrite</span><span class="id"> mulr_le0|by</span><span class="id"> rewrite</span><span class="id"> -realE</span><span class="id"> realM</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">|by</span><span class="id"> case:</span> (<span class="id">bottom</span><span class="id"> x</span>)<span class="id">|by</span><span class="id"> case:</span> (<span class="id">bottom</span><span class="id"> y</span>)<span class="id">|by</span><span class="id"> rewrite</span><span class="id"> eq0</span><span class="id"> ?mulr0//</span><span class="id"> mul0r]</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Canonical</span><span class="id"> mul_snum</span> (<span class="id">xnz</span><span class="id"> ynz</span><span class="id"> :</span><span class="id"> nullity</span>) (<span class="id">xr</span><span class="id"> yr</span><span class="id"> :</span><span class="id"> reality</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">x</span><span class="id"> :</span><span class="id"> {num</span><span class="id"> R</span><span class="id"> &amp;</span><span class="id"> xnz</span><span class="id"> &amp;</span><span class="id"> xr}</span>) (<span class="id">y</span><span class="id"> :</span><span class="id"> {num</span><span class="id"> R</span><span class="id"> &amp;</span><span class="id"> ynz</span><span class="id"> &amp;</span><span class="id"> yr}</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">Signed</span>.<span class="id">mk</span> (<span class="id">mul_snum_subproof</span><span class="id"> x</span><span class="id"> y</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> natmul_snum_subproof</span> (<span class="id">xnz</span><span class="id"> nnz</span><span class="id"> :</span><span class="id"> nullity</span>) (<span class="id">xr</span><span class="id"> nr</span><span class="id"> :</span><span class="id"> reality</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">x</span><span class="id"> :</span><span class="id"> {num</span><span class="id"> R</span><span class="id"> &amp;</span><span class="id"> xnz</span><span class="id"> &amp;</span><span class="id"> xr}</span>) (<span class="id">n</span><span class="id"> :</span><span class="id"> {compare</span><span class="id"> 0%N</span><span class="id"> &amp;</span><span class="id"> nnz</span><span class="id"> &amp;</span><span class="id"> nr}</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">rnz</span><span class="id"> :=</span><span class="id"> mul_nonzero_subdef</span><span class="id"> xnz</span><span class="id"> nnz</span><span class="id"> xr</span><span class="id"> nr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">rrl</span><span class="id"> :=</span><span class="id"> mul_reality_subdef</span><span class="id"> xnz</span><span class="id"> nnz</span><span class="id"> xr</span><span class="id"> nr</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">Signed</span>.<span class="id">spec</span><span class="id"> 0</span><span class="id"> rnz</span><span class="id"> rrl</span> (<span class="id">x%:num</span><span class="id"> *+</span><span class="id"> n%:num</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> {}/rnz</span><span class="id"> {}/rrl;</span><span class="id"> apply/andP;</span><span class="id"> split</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move:</span><span class="id"> xr</span><span class="id"> nr</span><span class="id"> xnz</span><span class="id"> nnz</span><span class="id"> x</span><span class="id"> n</span><span class="id"> =&gt;</span><span class="id"> [[[]|]|]</span><span class="id"> [[[]|]|]</span><span class="id"> []</span><span class="id"> []//</span><span class="id"> x</span><span class="id"> n;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> mulrn_eq0//=</span><span class="id"> ?eq0F</span>.<br/>
<span class="id">move:</span><span class="id"> xr</span><span class="id"> nr</span><span class="id"> xnz</span><span class="id"> nnz</span><span class="id"> x</span><span class="id"> n</span><span class="id"> =&gt;</span><span class="id"> [[[]|]|]</span><span class="id"> [[[]|]|]</span><span class="id"> []</span><span class="id"> []/=</span><span class="id"> x</span><span class="id"> [[|n]//=</span><span class="id"> _]</span><span class="id"> //;</span><br/>
&nbsp;&nbsp;<span class="id">do</span><span class="id"> ?[by</span><span class="id"> case:</span> (<span class="id">bottom</span><span class="id"> x</span>)<span class="id">|by</span><span class="id"> case:</span> (<span class="id">bottom</span><span class="id"> n</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">|by</span><span class="id"> rewrite</span><span class="id"> mulrn_wge0|by</span><span class="id"> rewrite</span><span class="id"> mulrn_wle0|by</span><span class="id"> rewrite</span><span class="id"> eq0</span><span class="id"> mul0rn</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">|by</span><span class="id"> apply:</span><span class="id"> real_comparable;</span><span class="id"> rewrite</span><span class="id"> ?real0</span><span class="id"> ?realrMn]</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Canonical</span><span class="id"> natmul_snum</span> (<span class="id">xnz</span><span class="id"> nnz</span><span class="id"> :</span><span class="id"> nullity</span>) (<span class="id">xr</span><span class="id"> nr</span><span class="id"> :</span><span class="id"> reality</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">x</span><span class="id"> :</span><span class="id"> {num</span><span class="id"> R</span><span class="id"> &amp;</span><span class="id"> xnz</span><span class="id"> &amp;</span><span class="id"> xr}</span>) (<span class="id">n</span><span class="id"> :</span><span class="id"> {compare</span><span class="id"> 0%N</span><span class="id"> &amp;</span><span class="id"> nnz</span><span class="id"> &amp;</span><span class="id"> nr}</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">Signed</span>.<span class="id">mk</span> (<span class="id">natmul_snum_subproof</span><span class="id"> x</span><span class="id"> n</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> intmul_snum_subproof</span> (<span class="id">xnz</span><span class="id"> nnz</span><span class="id"> :</span><span class="id"> nullity</span>) (<span class="id">xr</span><span class="id"> nr</span><span class="id"> :</span><span class="id"> reality</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">x</span><span class="id"> :</span><span class="id"> {num</span><span class="id"> R</span><span class="id"> &amp;</span><span class="id"> xnz</span><span class="id"> &amp;</span><span class="id"> xr}</span>) (<span class="id">n</span><span class="id"> :</span><span class="id"> {num</span><span class="id"> int</span><span class="id"> &amp;</span><span class="id"> nnz</span><span class="id"> &amp;</span><span class="id"> nr}</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">rnz</span><span class="id"> :=</span><span class="id"> mul_nonzero_subdef</span><span class="id"> xnz</span><span class="id"> nnz</span><span class="id"> xr</span><span class="id"> nr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">rrl</span><span class="id"> :=</span><span class="id"> mul_reality_subdef</span><span class="id"> xnz</span><span class="id"> nnz</span><span class="id"> xr</span><span class="id"> nr</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">Signed</span>.<span class="id">spec</span><span class="id"> 0</span><span class="id"> rnz</span><span class="id"> rrl</span> (<span class="id">x%:num</span><span class="id"> *~</span><span class="id"> n%:num</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> {}/rnz</span><span class="id"> {}/rrl;</span><span class="id"> apply/andP;</span><span class="id"> split</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move:</span><span class="id"> xr</span><span class="id"> nr</span><span class="id"> xnz</span><span class="id"> nnz</span><span class="id"> x</span><span class="id"> n</span><span class="id"> =&gt;</span><span class="id"> [[[]|]|]</span><span class="id"> [[[]|]|]</span><span class="id"> []</span><span class="id"> []//</span><span class="id"> x</span><span class="id"> n;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> mulrz_neq0//=</span><span class="id"> ?neq0</span>.<br/>
<span class="id">move:</span><span class="id"> xr</span><span class="id"> nr</span><span class="id"> xnz</span><span class="id"> nnz</span><span class="id"> x</span><span class="id"> n</span><span class="id"> =&gt;</span><span class="id"> [[[]|]|]</span><span class="id"> [[[]|]|]</span><span class="id"> []</span><span class="id"> []/=</span><span class="id"> x</span><span class="id"> n</span><span class="id"> //;</span><br/>
&nbsp;&nbsp;<span class="id">do</span><span class="id"> ?[by</span><span class="id"> case:</span> (<span class="id">bottom</span><span class="id"> x</span>)<span class="id">|by</span><span class="id"> case:</span> (<span class="id">bottom</span><span class="id"> n</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">|by</span><span class="id"> rewrite</span><span class="id"> mulrz_ge0|by</span><span class="id"> rewrite</span><span class="id"> mulrz_le0_ge0|by</span><span class="id"> rewrite</span><span class="id"> eq0</span><span class="id"> mul0rz</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">|by</span><span class="id"> rewrite</span><span class="id"> mulrz_ge0_le0|by</span><span class="id"> rewrite</span><span class="id"> mulrz_le0|by</span><span class="id"> rewrite</span><span class="id"> eq0</span><span class="id"> mulr0z</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">|by</span><span class="id"> rewrite</span><span class="id"> -realE</span><span class="id"> rpredMz//;</span><span class="id"> apply:</span><span class="id"> cmp0]</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Canonical</span><span class="id"> intmul_snum</span> (<span class="id">xnz</span><span class="id"> nnz</span><span class="id"> :</span><span class="id"> nullity</span>) (<span class="id">xr</span><span class="id"> nr</span><span class="id"> :</span><span class="id"> reality</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">x</span><span class="id"> :</span><span class="id"> {num</span><span class="id"> R</span><span class="id"> &amp;</span><span class="id"> xnz</span><span class="id"> &amp;</span><span class="id"> xr}</span>) (<span class="id">n</span><span class="id"> :</span><span class="id"> {num</span><span class="id"> int</span><span class="id"> &amp;</span><span class="id"> nnz</span><span class="id"> &amp;</span><span class="id"> nr}</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">Signed</span>.<span class="id">mk</span> (<span class="id">intmul_snum_subproof</span><span class="id"> x</span><span class="id"> n</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> inv_snum_subproof</span> (<span class="id">xnz</span><span class="id"> :</span><span class="id"> nullity</span>) (<span class="id">xr</span><span class="id"> :</span><span class="id"> reality</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">x</span><span class="id"> :</span><span class="id"> {num</span><span class="id"> R</span><span class="id"> &amp;</span><span class="id"> xnz</span><span class="id"> &amp;</span><span class="id"> xr}</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">Signed</span>.<span class="id">spec</span><span class="id"> 0</span><span class="id"> xnz</span><span class="id"> xr</span> (<span class="id">x%:num^-1</span><span class="id"> :</span><span class="id"> R</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd">by</span><span class="id"> case:</span><span class="id"> xr</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> [[[]|]|]//=</span><span class="id"> [r]/=;</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> invr_eq0</span><span class="id"> ?</span>(<span class="id">invr_ge0,</span><span class="id"> invr_le0</span>)<span class="id"> ?realV</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Canonical</span><span class="id"> inv_snum</span> (<span class="id">xnz</span><span class="id"> :</span><span class="id"> nullity</span>) (<span class="id">xr</span><span class="id"> :</span><span class="id"> reality</span>) (<span class="id">x</span><span class="id"> :</span><span class="id"> {num</span><span class="id"> R</span><span class="id"> &amp;</span><span class="id"> xnz</span><span class="id"> &amp;</span><span class="id"> xr}</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">Signed</span>.<span class="id">mk</span> (<span class="id">inv_snum_subproof</span><span class="id"> x</span>).<br/>
<br/>
<span class="vernacular">Definition</span><span class="id"> exprn_nonzero_subdef</span> (<span class="id">xnz</span><span class="id"> nnz</span><span class="id"> :</span><span class="id"> nullity</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">xr</span><span class="id"> nr</span><span class="id"> :</span><span class="id"> reality</span>)<span class="id"> :</span><span class="id"> nullity</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">nz_of_bool</span> (<span class="id">xnz</span><span class="id"> ||</span><span class="gallina-kwd"> match</span><span class="id"> nr</span><span class="gallina-kwd"> with</span><span class="id"> Real</span> (<span class="id">Sign</span><span class="id"> =0</span>)<span class="id"> =&gt;</span><span class="id"> true</span><span class="id"> |</span><span class="id"> _</span><span class="id"> =&gt;</span><span class="id"> false</span><span class="gallina-kwd"> end</span>).<br/>
<span class="vernacular">Arguments</span><span class="id"> exprn_nonzero_subdef</span><span class="id"> /</span>.<br/>
<br/>
<span class="vernacular">Definition</span><span class="id"> exprn_reality_subdef</span> (<span class="id">xnz</span><span class="id"> nnz</span><span class="id"> :</span><span class="id"> nullity</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">xr</span><span class="id"> nr</span><span class="id"> :</span><span class="id"> reality</span>)<span class="id"> :</span><span class="id"> reality</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">match</span><span class="id"> xr,</span><span class="id"> nr</span><span class="gallina-kwd"> with</span><br/>
&nbsp;&nbsp;<span class="id">|</span><span class="id"> _,</span><span class="id"> Real</span> (<span class="id">Sign</span><span class="id"> =0</span>)<span class="id"> =&gt;</span><span class="id"> &gt;=0</span><br/>
&nbsp;&nbsp;<span class="id">|</span><span class="id"> Real</span> (<span class="id">Sign</span><span class="id"> =0</span>)<span class="id">,</span><span class="id"> _</span><span class="id"> =&gt;</span> (<span class="gallina-kwd">if</span><span class="id"> nnz</span><span class="gallina-kwd"> then</span><span class="id"> =0</span><span class="gallina-kwd"> else</span><span class="id"> &gt;=0</span>)<span class="id">%snum_sign</span><br/>
&nbsp;&nbsp;<span class="id">|</span><span class="id"> Real</span> (<span class="id">Sign</span><span class="id"> &gt;=0</span>)<span class="id">,</span><span class="id"> _</span><span class="id"> =&gt;</span><span class="id"> &gt;=0</span><br/>
&nbsp;&nbsp;<span class="id">|</span><span class="id"> Real</span><span class="id"> _,</span><span class="id"> _</span><span class="id"> =&gt;</span><span class="id"> &gt;=&lt;0</span><br/>
&nbsp;&nbsp;<span class="id">|</span><span class="id"> _,</span><span class="id"> _</span><span class="id"> =&gt;</span><span class="id"> &gt;?&lt;0</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">end</span>.<br/>
<span class="vernacular">Arguments</span><span class="id"> exprn_reality_subdef</span><span class="id"> /</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> exprn_snum_subproof</span> (<span class="id">xnz</span><span class="id"> nnz</span><span class="id"> :</span><span class="id"> nullity</span>) (<span class="id">xr</span><span class="id"> nr</span><span class="id"> :</span><span class="id"> reality</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">x</span><span class="id"> :</span><span class="id"> {num</span><span class="id"> R</span><span class="id"> &amp;</span><span class="id"> xnz</span><span class="id"> &amp;</span><span class="id"> xr}</span>) (<span class="id">n</span><span class="id"> :</span><span class="id"> {compare</span><span class="id"> 0%N</span><span class="id"> &amp;</span><span class="id"> nnz</span><span class="id"> &amp;</span><span class="id"> nr}</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">rnz</span><span class="id"> :=</span><span class="id"> exprn_nonzero_subdef</span><span class="id"> xnz</span><span class="id"> nnz</span><span class="id"> xr</span><span class="id"> nr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">rrl</span><span class="id"> :=</span><span class="id"> exprn_reality_subdef</span><span class="id"> xnz</span><span class="id"> nnz</span><span class="id"> xr</span><span class="id"> nr</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">Signed</span>.<span class="id">spec</span><span class="id"> 0</span><span class="id"> rnz</span><span class="id"> rrl</span> (<span class="id">x%:num</span><span class="id"> ^+</span><span class="id"> n%:num</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> {}/rnz</span><span class="id"> {}/rrl;</span><span class="id"> apply/andP;</span><span class="id"> split</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> move:</span><span class="id"> xr</span><span class="id"> nr</span><span class="id"> xnz</span><span class="id"> nnz</span><span class="id"> x</span><span class="id"> n</span><span class="id"> =&gt;</span><span class="id"> [[[]|]|]</span><span class="id"> [[[]|]|]</span><span class="id"> []</span><span class="id"> []//</span><span class="id"> x</span><span class="id"> n;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span><span class="id"> ?[by</span><span class="id"> case:</span> (<span class="id">bottom</span><span class="id"> x</span>)<span class="id">|by</span><span class="id"> case:</span> (<span class="id">bottom</span><span class="id"> n</span>)<span class="id">];</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> expf_eq0/=</span><span class="id"> ?eq0//</span><span class="id"> ?eq0F</span><span class="id"> ?andbF//</span>.<br/>
<span class="id">move:</span><span class="id"> xr</span><span class="id"> nr</span><span class="id"> xnz</span><span class="id"> nnz</span><span class="id"> x</span><span class="id"> n</span><span class="id"> =&gt;</span><span class="id"> [[[]|]|]</span><span class="id"> [[[]|]|]</span><span class="id"> []</span><span class="id"> []/=</span><span class="id"> x</span><span class="id"> [[|n]//=</span><span class="id"> _]</span><span class="id"> //;</span><br/>
&nbsp;&nbsp;<span class="id">do</span><span class="id"> ?[by</span><span class="id"> case:</span> (<span class="id">bottom</span><span class="id"> x</span>)<span class="id">|by</span><span class="id"> case:</span> (<span class="id">bottom</span><span class="id"> n</span>)<span class="id">|by</span><span class="id"> rewrite</span><span class="id"> [_</span><span class="id"> ||</span><span class="id"> _]realX</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">|by</span><span class="id"> rewrite</span><span class="id"> eq0</span><span class="id"> expr0n|exact:</span><span class="id"> exprn_ge0|by</span><span class="id"> rewrite</span><span class="id"> expr0</span><span class="id"> ler01]</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Canonical</span><span class="id"> exprn_snum</span> (<span class="id">xnz</span><span class="id"> nnz</span><span class="id"> :</span><span class="id"> nullity</span>) (<span class="id">xr</span><span class="id"> nr</span><span class="id"> :</span><span class="id"> reality</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">x</span><span class="id"> :</span><span class="id"> {num</span><span class="id"> R</span><span class="id"> &amp;</span><span class="id"> xnz</span><span class="id"> &amp;</span><span class="id"> xr}</span>) (<span class="id">n</span><span class="id"> :</span><span class="id"> {compare</span><span class="id"> 0%N</span><span class="id"> &amp;</span><span class="id"> nnz</span><span class="id"> &amp;</span><span class="id"> nr}</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">Signed</span>.<span class="id">mk</span> (<span class="id">exprn_snum_subproof</span><span class="id"> x</span><span class="id"> n</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> norm_snum_subproof</span><span class="id"> {V</span><span class="id"> :</span><span class="id"> normedZmodType</span><span class="id"> R}</span> (<span class="id">x</span><span class="id"> :</span><span class="id"> V</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">Signed</span>.<span class="id">spec</span><span class="id"> 0</span><span class="id"> ?=0</span><span class="id"> &gt;=0</span><span class="id"> `|x|</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> /=</span>. Qed.</div></details>
<br/>
<span class="vernacular">Canonical</span><span class="id"> norm_snum</span><span class="id"> {V</span><span class="id"> :</span><span class="id"> normedZmodType</span><span class="id"> R}</span> (<span class="id">x</span><span class="id"> :</span><span class="id"> V</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">Signed</span>.<span class="id">mk</span> (<span class="id">norm_snum_subproof</span><span class="id"> x</span>).<br/>
<br/>
<span class="vernacular">End</span><span class="id"> NumDomainStability</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> RcfStability</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {R</span><span class="id"> :</span><span class="id"> rcfType}</span>.<br/>
<br/>
<span class="vernacular">Definition</span><span class="id"> sqrt_nonzero_subdef</span> (<span class="id">xnz</span><span class="id"> :</span><span class="id"> nullity</span>) (<span class="id">xr</span><span class="id"> :</span><span class="id"> reality</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">if</span><span class="id"> xr</span><span class="id"> is</span><span class="id"> Real</span> (<span class="id">Sign</span><span class="id"> &gt;=0</span>)<span class="gallina-kwd"> then</span><span class="id"> xnz</span><span class="gallina-kwd"> else</span><span class="id"> MaybeZero</span>.<br/>
<span class="vernacular">Arguments</span><span class="id"> sqrt_nonzero_subdef</span><span class="id"> /</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> sqrt_snum_subproof</span><span class="id"> xnz</span><span class="id"> xr</span> (<span class="id">x</span><span class="id"> :</span><span class="id"> {num</span><span class="id"> R</span><span class="id"> &amp;</span><span class="id"> xnz</span><span class="id"> &amp;</span><span class="id"> xr}</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">nz</span><span class="id"> :=</span><span class="id"> sqrt_nonzero_subdef</span><span class="id"> xnz</span><span class="id"> xr</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">Signed</span>.<span class="id">spec</span><span class="id"> 0</span><span class="id"> nz</span><span class="id"> &gt;=0</span> (<span class="id">Num</span>.<span class="id">sqrt</span><span class="id"> x%:num</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> {}/nz;</span><span class="id"> case:</span><span class="id"> xnz</span><span class="id"> xr</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> -[[[]|]|]//=</span><span class="id"> x;</span><br/>
&nbsp;&nbsp;&nbsp;<span class="id">rewrite</span><span class="id"> /=</span><span class="id"> sqrtr_ge0//</span><span class="id"> andbT</span><span class="id"> sqrtr_eq0</span><span class="id"> le0F</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Canonical</span><span class="id"> sqrt_snum</span><span class="id"> xnz</span><span class="id"> xr</span> (<span class="id">x</span><span class="id"> :</span><span class="id"> {num</span><span class="id"> R</span><span class="id"> &amp;</span><span class="id"> xnz</span><span class="id"> &amp;</span><span class="id"> xr}</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">Signed</span>.<span class="id">mk</span> (<span class="id">sqrt_snum_subproof</span><span class="id"> x</span>).<br/>
<br/>
<span class="vernacular">End</span><span class="id"> RcfStability</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> NumClosedStability</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {R</span><span class="id"> :</span><span class="id"> numClosedFieldType}</span>.<br/>
<br/>
<span class="vernacular">Definition</span><span class="id"> sqrtC_reality_subdef</span> (<span class="id">xnz</span><span class="id"> :</span><span class="id"> nullity</span>) (<span class="id">xr</span><span class="id"> :</span><span class="id"> reality</span>)<span class="id"> :</span><span class="id"> reality</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">match</span><span class="id"> xr</span><span class="gallina-kwd"> with</span><br/>
&nbsp;&nbsp;<span class="id">|</span><span class="id"> Real</span> (<span class="id">Sign</span><span class="id"> =0</span>)<span class="id"> =&gt;</span><span class="id"> =0</span><br/>
&nbsp;&nbsp;<span class="id">|</span><span class="id"> Real</span> (<span class="id">Sign</span><span class="id"> &gt;=0</span>)<span class="id"> =&gt;</span><span class="id"> &gt;=0</span><br/>
&nbsp;&nbsp;<span class="id">|</span><span class="id"> _</span><span class="id"> =&gt;</span><span class="id"> &gt;?&lt;0</span><br/>
&nbsp;&nbsp;<span class="gallina-kwd">end</span>.<br/>
<span class="vernacular">Arguments</span><span class="id"> sqrtC_reality_subdef</span><span class="id"> /</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> sqrtC_snum_subproof</span><span class="id"> xnz</span><span class="id"> xr</span> (<span class="id">x</span><span class="id"> :</span><span class="id"> {num</span><span class="id"> R</span><span class="id"> &amp;</span><span class="id"> xnz</span><span class="id"> &amp;</span><span class="id"> xr}</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">r</span><span class="id"> :=</span><span class="id"> sqrtC_reality_subdef</span><span class="id"> xnz</span><span class="id"> xr</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">Signed</span>.<span class="id">spec</span><span class="id"> 0</span><span class="id"> xnz</span><span class="id"> r</span> (<span class="id">sqrtC</span><span class="id"> x%:num</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> {}/r;</span><span class="id"> apply/andP;</span><span class="id"> split</span>.<br/>
&nbsp;&nbsp;<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> sqrtC_eq0;</span><span class="id"> case:</span><span class="id"> xr</span><span class="id"> xnz</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> [[[]|]|]</span><span class="id"> []</span><span class="id"> /=</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> case:</span><span class="id"> xr</span><span class="id"> xnz</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> [[[]|]|]</span><span class="id"> []//=</span><span class="id"> x;</span><span class="id"> rewrite</span><span class="id"> ?sqrtC_ge0//</span><span class="id"> sqrtC_eq0</span><span class="id"> eq0</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Canonical</span><span class="id"> sqrtC_snum</span><span class="id"> xnz</span><span class="id"> xr</span> (<span class="id">x</span><span class="id"> :</span><span class="id"> {num</span><span class="id"> R</span><span class="id"> &amp;</span><span class="id"> xnz</span><span class="id"> &amp;</span><span class="id"> xr}</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">Signed</span>.<span class="id">mk</span> (<span class="id">sqrtC_snum_subproof</span><span class="id"> x</span>).<br/>
<br/>
<span class="vernacular">End</span><span class="id"> NumClosedStability</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> NatStability</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Open</span><span class="vernacular"> Scope</span><span class="id"> nat_scope</span>.<br/>
<span class="vernacular">Implicit</span><span class="gallina-kwd"> Type</span> (<span class="id">n</span><span class="id"> :</span><span class="id"> nat</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> zeron_snum_subproof</span><span class="id"> :</span><span class="id"> Signed</span>.<span class="id">spec</span><span class="id"> 0</span><span class="id"> ?=0</span><span class="id"> =0</span><span class="id"> 0</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> []</span>. Qed.</div></details>
<br/>
<span class="vernacular">Canonical</span><span class="id"> zeron_snum</span><span class="id"> :=</span><span class="id"> Signed</span>.<span class="id">mk</span><span class="id"> zeron_snum_subproof</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> succn_snum_subproof</span><span class="id"> n</span><span class="id"> :</span><span class="id"> Signed</span>.<span class="id">spec</span><span class="id"> 0</span><span class="id"> !=0</span><span class="id"> &gt;=0</span><span class="id"> n</span>.<span class="id">+1</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> []</span>. Qed.</div></details>
<br/>
<span class="vernacular">Canonical</span><span class="id"> succn_snum</span><span class="id"> n</span><span class="id"> :=</span><span class="id"> Signed</span>.<span class="id">mk</span> (<span class="id">succn_snum_subproof</span><span class="id"> n</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> double_snum_subproof</span><span class="id"> nz</span><span class="id"> r</span> (<span class="id">x</span><span class="id"> :</span><span class="id"> {compare</span><span class="id"> 0</span><span class="id"> &amp;</span><span class="id"> nz</span><span class="id"> &amp;</span><span class="id"> r}</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">Signed</span>.<span class="id">spec</span><span class="id"> 0</span><span class="id"> nz</span><span class="id"> r</span><span class="id"> x%:num</span>.<span class="id">*2</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span> <span class="id"> move:</span><span class="id"> nz</span><span class="id"> r</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> []</span><span class="id"> [[[]|]|]</span><span class="id"> [[|n]]</span>. Qed.</div></details>
<br/>
<span class="vernacular">Canonical</span><span class="id"> double_snum</span><span class="id"> nz</span><span class="id"> r</span><span class="id"> x</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">Signed</span>.<span class="id">mk</span> (<span class="id">@double_snum_subproof</span><span class="id"> nz</span><span class="id"> r</span><span class="id"> x</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> addn_snum_subproof</span> (<span class="id">xnz</span><span class="id"> ynz</span><span class="id"> :</span><span class="id"> nullity</span>) (<span class="id">xr</span><span class="id"> yr</span><span class="id"> :</span><span class="id"> reality</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">x</span><span class="id"> :</span><span class="id"> {compare</span><span class="id"> 0</span><span class="id"> &amp;</span><span class="id"> xnz</span><span class="id"> &amp;</span><span class="id"> xr}</span>) (<span class="id">y</span><span class="id"> :</span><span class="id"> {compare</span><span class="id"> 0</span><span class="id"> &amp;</span><span class="id"> ynz</span><span class="id"> &amp;</span><span class="id"> yr}</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">rnz</span><span class="id"> :=</span><span class="id"> add_nonzero_subdef</span><span class="id"> xnz</span><span class="id"> ynz</span><span class="id"> xr</span><span class="id"> yr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">rrl</span><span class="id"> :=</span><span class="id"> add_reality_subdef</span><span class="id"> xnz</span><span class="id"> ynz</span><span class="id"> xr</span><span class="id"> yr</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">Signed</span>.<span class="id">spec</span><span class="id"> 0</span><span class="id"> rnz</span><span class="id"> rrl</span> (<span class="id">x%:num</span><span class="id"> +</span><span class="id"> y%:num</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> {}/rnz</span><span class="id"> {}/rrl;</span><span class="id"> apply/andP;</span><span class="id"> split;</span><br/>
<span class="gallina-kwd">by</span><span class="id"> move:</span><span class="id"> xr</span><span class="id"> yr</span><span class="id"> xnz</span><span class="id"> ynz</span><span class="id"> x</span><span class="id"> y</span><span class="id"> =&gt;</span><span class="id"> [[[]|]|]</span><span class="id"> [[[]|]|]</span><span class="id"> []</span><span class="id"> []//=</span><span class="id"> [[|x]//=</span><span class="id"> _]</span><span class="id"> [[|y]]</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Canonical</span><span class="id"> addn_snum</span> (<span class="id">xnz</span><span class="id"> ynz</span><span class="id"> :</span><span class="id"> nullity</span>) (<span class="id">xr</span><span class="id"> yr</span><span class="id"> :</span><span class="id"> reality</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">x</span><span class="id"> :</span><span class="id"> {compare</span><span class="id"> 0</span><span class="id"> &amp;</span><span class="id"> xnz</span><span class="id"> &amp;</span><span class="id"> xr}</span>) (<span class="id">y</span><span class="id"> :</span><span class="id"> {compare</span><span class="id"> 0</span><span class="id"> &amp;</span><span class="id"> ynz</span><span class="id"> &amp;</span><span class="id"> yr}</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">Signed</span>.<span class="id">mk</span> (<span class="id">addn_snum_subproof</span><span class="id"> x</span><span class="id"> y</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> muln_snum_subproof</span> (<span class="id">xnz</span><span class="id"> ynz</span><span class="id"> :</span><span class="id"> nullity</span>) (<span class="id">xr</span><span class="id"> yr</span><span class="id"> :</span><span class="id"> reality</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">x</span><span class="id"> :</span><span class="id"> {compare</span><span class="id"> 0</span><span class="id"> &amp;</span><span class="id"> xnz</span><span class="id"> &amp;</span><span class="id"> xr}</span>) (<span class="id">y</span><span class="id"> :</span><span class="id"> {compare</span><span class="id"> 0</span><span class="id"> &amp;</span><span class="id"> ynz</span><span class="id"> &amp;</span><span class="id"> yr}</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">rnz</span><span class="id"> :=</span><span class="id"> mul_nonzero_subdef</span><span class="id"> xnz</span><span class="id"> ynz</span><span class="id"> xr</span><span class="id"> yr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">rrl</span><span class="id"> :=</span><span class="id"> mul_reality_subdef</span><span class="id"> xnz</span><span class="id"> ynz</span><span class="id"> xr</span><span class="id"> yr</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">Signed</span>.<span class="id">spec</span><span class="id"> 0</span><span class="id"> rnz</span><span class="id"> rrl</span> (<span class="id">x%:num</span><span class="id"> *</span><span class="id"> y%:num</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> {}/rnz</span><span class="id"> {}/rrl;</span><span class="id"> apply/andP;</span><span class="id"> split;</span><br/>
<span class="id">move:</span><span class="id"> xr</span><span class="id"> yr</span><span class="id"> xnz</span><span class="id"> ynz</span><span class="id"> x</span><span class="id"> y</span><span class="id"> =&gt;</span><span class="id"> [[[]|]|]</span><span class="id"> [[[]|]|]</span><span class="id"> []</span><span class="id"> []//=;</span><br/>
<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> [[|x]//=</span><span class="id"> _]</span><span class="id"> [[|y]//=</span><span class="id"> _];</span><span class="id"> rewrite</span><span class="id"> muln0</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Canonical</span><span class="id"> muln_snum</span> (<span class="id">xnz</span><span class="id"> ynz</span><span class="id"> :</span><span class="id"> nullity</span>) (<span class="id">xr</span><span class="id"> yr</span><span class="id"> :</span><span class="id"> reality</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">x</span><span class="id"> :</span><span class="id"> {compare</span><span class="id"> 0</span><span class="id"> &amp;</span><span class="id"> xnz</span><span class="id"> &amp;</span><span class="id"> xr}</span>) (<span class="id">y</span><span class="id"> :</span><span class="id"> {compare</span><span class="id"> 0</span><span class="id"> &amp;</span><span class="id"> ynz</span><span class="id"> &amp;</span><span class="id"> yr}</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">Signed</span>.<span class="id">mk</span> (<span class="id">muln_snum_subproof</span><span class="id"> x</span><span class="id"> y</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> expn_snum_subproof</span> (<span class="id">xnz</span><span class="id"> nnz</span><span class="id"> :</span><span class="id"> nullity</span>) (<span class="id">xr</span><span class="id"> nr</span><span class="id"> :</span><span class="id"> reality</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">x</span><span class="id"> :</span><span class="id"> {compare</span><span class="id"> 0</span><span class="id"> &amp;</span><span class="id"> xnz</span><span class="id"> &amp;</span><span class="id"> xr}</span>) (<span class="id">n</span><span class="id"> :</span><span class="id"> {compare</span><span class="id"> 0</span><span class="id"> &amp;</span><span class="id"> nnz</span><span class="id"> &amp;</span><span class="id"> nr}</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">rnz</span><span class="id"> :=</span><span class="id"> exprn_nonzero_subdef</span><span class="id"> xnz</span><span class="id"> nnz</span><span class="id"> xr</span><span class="id"> nr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">rrl</span><span class="id"> :=</span><span class="id"> exprn_reality_subdef</span><span class="id"> xnz</span><span class="id"> nnz</span><span class="id"> xr</span><span class="id"> nr</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">Signed</span>.<span class="id">spec</span><span class="id"> 0</span><span class="id"> rnz</span><span class="id"> rrl</span> (<span class="id">x%:num</span><span class="id"> ^</span><span class="id"> n%:num</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> {}/rnz</span><span class="id"> {}/rrl;</span><span class="id"> apply/andP;</span><span class="id"> split</span>.<br/>
&nbsp;&nbsp;<span class="id">move:</span><span class="id"> xr</span><span class="id"> nr</span><span class="id"> xnz</span><span class="id"> nnz</span><span class="id"> x</span><span class="id"> n</span><span class="id"> =&gt;</span><span class="id"> [[[]|]|]</span><span class="id"> [[[]|]|]</span><span class="id"> []</span><span class="id"> []//</span><span class="id"> x</span><span class="id"> n;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">do</span><span class="id"> ?[by</span><span class="id"> case:</span> (<span class="id">bottom</span><span class="id"> x</span>)<span class="id">|by</span><span class="id"> case:</span> (<span class="id">bottom</span><span class="id"> n</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id">|by</span><span class="id"> rewrite</span><span class="id"> ?eq0</span><span class="id"> ?expn0//</span><span class="id"> expn_eq0</span><span class="id"> ?eq0F]</span>.<br/>
<span class="id">move:</span><span class="id"> xr</span><span class="id"> nr</span><span class="id"> xnz</span><span class="id"> nnz</span><span class="id"> x</span><span class="id"> n</span><span class="id"> =&gt;</span><span class="id"> [[[]|]|]</span><span class="id"> [[[]|]|]</span><span class="id"> []</span><span class="id"> []/=</span><span class="id"> x</span><span class="id"> [[|n]//=</span><span class="id"> _]</span><span class="id"> //;</span><br/>
&nbsp;&nbsp;<span class="id">do</span><span class="id"> ?[by</span><span class="id"> case:</span> (<span class="id">bottom</span><span class="id"> x</span>)<span class="id">|by</span><span class="id"> case:</span> (<span class="id">bottom</span><span class="id"> n</span>)<span class="id">|by</span><span class="id"> rewrite</span><span class="id"> eq0</span><span class="id"> exp0n]</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Canonical</span><span class="id"> expn_snum</span> (<span class="id">xnz</span><span class="id"> nnz</span><span class="id"> :</span><span class="id"> nullity</span>) (<span class="id">xr</span><span class="id"> nr</span><span class="id"> :</span><span class="id"> reality</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">x</span><span class="id"> :</span><span class="id"> {compare</span><span class="id"> 0</span><span class="id"> &amp;</span><span class="id"> xnz</span><span class="id"> &amp;</span><span class="id"> xr}</span>) (<span class="id">n</span><span class="id"> :</span><span class="id"> {compare</span><span class="id"> 0</span><span class="id"> &amp;</span><span class="id"> nnz</span><span class="id"> &amp;</span><span class="id"> nr}</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">Signed</span>.<span class="id">mk</span> (<span class="id">expn_snum_subproof</span><span class="id"> x</span><span class="id"> n</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> minn_snum_subproof</span> (<span class="id">xnz</span><span class="id"> ynz</span><span class="id"> :</span><span class="id"> nullity</span>) (<span class="id">xr</span><span class="id"> yr</span><span class="id"> :</span><span class="id"> reality</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">x</span><span class="id"> :</span><span class="id"> {compare</span><span class="id"> 0</span><span class="id"> &amp;</span><span class="id"> xnz</span><span class="id"> &amp;</span><span class="id"> xr}</span>) (<span class="id">y</span><span class="id"> :</span><span class="id"> {compare</span><span class="id"> 0</span><span class="id"> &amp;</span><span class="id"> ynz</span><span class="id"> &amp;</span><span class="id"> yr}</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">rnz</span><span class="id"> :=</span><span class="id"> min_nonzero_subdef</span><span class="id"> xnz</span><span class="id"> ynz</span><span class="id"> xr</span><span class="id"> yr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">rrl</span><span class="id"> :=</span><span class="id"> min_reality_subdef</span><span class="id"> xnz</span><span class="id"> ynz</span><span class="id"> xr</span><span class="id"> yr</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">Signed</span>.<span class="id">spec</span><span class="id"> 0</span><span class="id"> rnz</span><span class="id"> rrl</span> (<span class="id">min</span><span class="id"> x%:num</span><span class="id"> y%:num</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> {}/rnz</span><span class="id"> {}/rrl;</span><span class="id"> apply/andP;</span><span class="id"> split;</span><br/>
<span class="gallina-kwd">by</span><span class="id"> move:</span><span class="id"> xr</span><span class="id"> yr</span><span class="id"> xnz</span><span class="id"> ynz</span><span class="id"> x</span><span class="id"> y</span><span class="id"> =&gt;</span><span class="id"> [[[]|]|]</span><span class="id"> [[[]|]|]</span><span class="id"> []</span><span class="id"> []//=</span><span class="id"> [[|x]//=</span><span class="id"> _]</span><span class="id"> [[|y]]</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Canonical</span><span class="id"> minn_snum</span> (<span class="id">xnz</span><span class="id"> ynz</span><span class="id"> :</span><span class="id"> nullity</span>) (<span class="id">xr</span><span class="id"> yr</span><span class="id"> :</span><span class="id"> reality</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">x</span><span class="id"> :</span><span class="id"> {compare</span><span class="id"> 0</span><span class="id"> &amp;</span><span class="id"> xnz</span><span class="id"> &amp;</span><span class="id"> xr}</span>) (<span class="id">y</span><span class="id"> :</span><span class="id"> {compare</span><span class="id"> 0</span><span class="id"> &amp;</span><span class="id"> ynz</span><span class="id"> &amp;</span><span class="id"> yr}</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">Signed</span>.<span class="id">mk</span> (<span class="id">minn_snum_subproof</span><span class="id"> x</span><span class="id"> y</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> maxn_snum_subproof</span> (<span class="id">xnz</span><span class="id"> ynz</span><span class="id"> :</span><span class="id"> nullity</span>) (<span class="id">xr</span><span class="id"> yr</span><span class="id"> :</span><span class="id"> reality</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">x</span><span class="id"> :</span><span class="id"> {compare</span><span class="id"> 0</span><span class="id"> &amp;</span><span class="id"> xnz</span><span class="id"> &amp;</span><span class="id"> xr}</span>) (<span class="id">y</span><span class="id"> :</span><span class="id"> {compare</span><span class="id"> 0</span><span class="id"> &amp;</span><span class="id"> ynz</span><span class="id"> &amp;</span><span class="id"> yr}</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">rnz</span><span class="id"> :=</span><span class="id"> max_nonzero_subdef</span><span class="id"> xnz</span><span class="id"> ynz</span><span class="id"> xr</span><span class="id"> yr</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">rrl</span><span class="id"> :=</span><span class="id"> max_reality_subdef</span><span class="id"> xnz</span><span class="id"> ynz</span><span class="id"> xr</span><span class="id"> yr</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">Signed</span>.<span class="id">spec</span><span class="id"> 0</span><span class="id"> rnz</span><span class="id"> rrl</span> (<span class="id">maxn</span><span class="id"> x%:num</span><span class="id"> y%:num</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">rewrite</span><span class="id"> {}/rnz</span><span class="id"> {}/rrl;</span><span class="id"> apply/andP;</span><span class="id"> split;</span><br/>
<span class="id">move:</span><span class="id"> xr</span><span class="id"> yr</span><span class="id"> xnz</span><span class="id"> ynz</span><span class="id"> x</span><span class="id"> y</span><span class="id"> =&gt;</span><span class="id"> [[[]|]|]</span><span class="id"> [[[]|]|]</span><span class="id"> []</span><span class="id"> []//=;</span><br/>
<span class="gallina-kwd">by</span><span class="id"> move=&gt;</span><span class="id"> [[|x]//=</span><span class="id"> _]</span><span class="id"> [[|y]//=</span><span class="id"> _];</span><span class="id"> rewrite</span><span class="id"> maxnSS</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Canonical</span><span class="id"> maxn_snum</span> (<span class="id">xnz</span><span class="id"> ynz</span><span class="id"> :</span><span class="id"> nullity</span>) (<span class="id">xr</span><span class="id"> yr</span><span class="id"> :</span><span class="id"> reality</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">x</span><span class="id"> :</span><span class="id"> {compare</span><span class="id"> 0</span><span class="id"> &amp;</span><span class="id"> xnz</span><span class="id"> &amp;</span><span class="id"> xr}</span>) (<span class="id">y</span><span class="id"> :</span><span class="id"> {compare</span><span class="id"> 0</span><span class="id"> &amp;</span><span class="id"> ynz</span><span class="id"> &amp;</span><span class="id"> yr}</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">Signed</span>.<span class="id">mk</span> (<span class="id">maxn_snum_subproof</span><span class="id"> x</span><span class="id"> y</span>).<br/>
<br/>
<span class="vernacular">End</span><span class="id"> NatStability</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> IntStability</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> Posz_snum_subproof</span> (<span class="id">xnz</span><span class="id"> :</span><span class="id"> nullity</span>) (<span class="id">xr</span><span class="id"> :</span><span class="id"> reality</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">x</span><span class="id"> :</span><span class="id"> {compare</span><span class="id"> 0%N</span><span class="id"> &amp;</span><span class="id"> xnz</span><span class="id"> &amp;</span><span class="id"> xr}</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">Signed</span>.<span class="id">spec</span><span class="id"> 0%Z</span><span class="id"> xnz</span><span class="id"> xr</span> (<span class="id">Posz</span><span class="id"> x%:num</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd">by</span><span class="id"> apply/andP;</span><span class="id"> split;</span><span class="id"> move:</span><span class="id"> xr</span><span class="id"> xnz</span><span class="id"> x</span><span class="id"> =&gt;</span><span class="id"> [[[]|]|]</span><span class="id"> []//=;</span><span class="id"> move=&gt;</span><span class="id"> [[|x]//=</span><span class="id"> _]</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">Canonical</span><span class="id"> Posz_snum</span> (<span class="id">xnz</span><span class="id"> :</span><span class="id"> nullity</span>) (<span class="id">xr</span><span class="id"> :</span><span class="id"> reality</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id">x</span><span class="id"> :</span><span class="id"> {compare</span><span class="id"> 0%N</span><span class="id"> &amp;</span><span class="id"> xnz</span><span class="id"> &amp;</span><span class="id"> xr}</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">Signed</span>.<span class="id">mk</span> (<span class="id">Posz_snum_subproof</span><span class="id"> x</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> Negz_snum_subproof</span> (<span class="id">n</span><span class="id"> :</span><span class="id"> nat</span>)<span class="id"> :</span><span class="id"> Signed</span>.<span class="id">spec</span><span class="id"> 0%Z</span><span class="id"> !=0</span><span class="id"> &lt;=0</span> (<span class="id">Negz</span><span class="id"> n</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> []</span>. Qed.</div></details>
<br/>
<span class="vernacular">Canonical</span><span class="id"> Negz_snum</span><span class="id"> n</span><span class="id"> :=</span><span class="id"> Signed</span>.<span class="id">mk</span> (<span class="id">Negz_snum_subproof</span><span class="id"> n</span>).<br/>
<br/>
<span class="vernacular">End</span><span class="id"> IntStability</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> Morph0</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {R</span><span class="id"> :</span><span class="id"> numDomainType}</span><span class="id"> {cond</span><span class="id"> :</span><span class="id"> reality}</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Notation</span><span class="id"> nR</span><span class="id"> :=</span><span class="id"> {num</span><span class="id"> R</span><span class="id"> &amp;</span><span class="id"> ?=0</span><span class="id"> &amp;</span><span class="id"> cond}</span>.<br/>
<span class="vernacular">Implicit</span><span class="id"> Types</span><span class="id"> x</span><span class="id"> y</span><span class="id"> :</span><span class="id"> nR</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Notation</span><span class="id"> num</span><span class="id"> :=</span> (<span class="id">@num</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">0</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> ?=0</span><span class="id"> cond</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> num_eq0</span><span class="id"> x</span><span class="id"> :</span> (<span class="id">x%:num</span><span class="id"> ==</span><span class="id"> 0</span>)<span class="id"> =</span> (<span class="id">x</span><span class="id"> ==</span> (<span class="id">widen_signed</span><span class="id"> 0%:sgn</span><span class="id"> :</span><span class="id"> nR</span>)).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> []</span>. Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> Morph0</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> Morph</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {d</span><span class="id"> :</span><span class="id"> Order</span>.<span class="id">disp_t}</span><span class="id"> {T</span><span class="id"> :</span><span class="id"> porderType</span><span class="id"> d}</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {x0</span><span class="id"> :</span><span class="id"> T}</span><span class="id"> {nz</span><span class="id"> :</span><span class="id"> nullity}</span><span class="id"> {cond</span><span class="id"> :</span><span class="id"> reality}</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Notation</span><span class="id"> sT</span><span class="id"> :=</span><span class="id"> {compare</span><span class="id"> x0</span><span class="id"> &amp;</span><span class="id"> nz</span><span class="id"> &amp;</span><span class="id"> cond}</span>.<br/>
<span class="vernacular">Implicit</span><span class="id"> Types</span><span class="id"> x</span><span class="id"> y</span><span class="id"> :</span><span class="id"> sT</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Notation</span><span class="id"> num</span><span class="id"> :=</span> (<span class="id">@num</span><span class="id"> _</span><span class="id"> _</span><span class="id"> x0</span><span class="id"> nz</span><span class="id"> cond</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> num_eq</span><span class="id"> :</span><span class="id"> {mono</span><span class="id"> num</span><span class="id"> :</span><span class="id"> x</span><span class="id"> y</span><span class="id"> /</span><span class="id"> x</span><span class="id"> ==</span><span class="id"> y}</span><br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> []</span>. Qed.</div></details>
<span class="vernacular">Lemma</span><span class="id"> num_le</span><span class="id"> :</span><span class="id"> {mono</span><span class="id"> num</span><span class="id"> :</span><span class="id"> x</span><span class="id"> y</span><span class="id"> /</span> (<span class="id">x</span><span class="id"> &lt;=</span><span class="id"> y</span>)<span class="id">%O}</span><br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> []</span>. Qed.</div></details>
<span class="vernacular">Lemma</span><span class="id"> num_lt</span><span class="id"> :</span><span class="id"> {mono</span><span class="id"> num</span><span class="id"> :</span><span class="id"> x</span><span class="id"> y</span><span class="id"> /</span> (<span class="id">x</span><span class="id"> &lt;</span><span class="id"> y</span>)<span class="id">%O}</span><br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> []</span>. Qed.</div></details>
<span class="vernacular">Lemma</span><span class="id"> num_min</span><span class="id"> :</span><span class="id"> {morph</span><span class="id"> num</span><span class="id"> :</span><span class="id"> x</span><span class="id"> y</span><span class="id"> /</span><span class="id"> Order</span>.<span class="id">min</span><span class="id"> x</span><span class="id"> y}</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> y;</span><span class="id"> rewrite</span><span class="id"> !minEle</span><span class="id"> num_le</span><span class="id"> -fun_if</span>. Qed.</div></details>
<span class="vernacular">Lemma</span><span class="id"> num_max</span><span class="id"> :</span><span class="id"> {morph</span><span class="id"> num</span><span class="id"> :</span><span class="id"> x</span><span class="id"> y</span><span class="id"> /</span><span class="id"> Order</span>.<span class="id">max</span><span class="id"> x</span><span class="id"> y}</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> x</span><span class="id"> y;</span><span class="id"> rewrite</span><span class="id"> !maxEle</span><span class="id"> num_le</span><span class="id"> -fun_if</span>. Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> Morph</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> MorphNum</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {R</span><span class="id"> :</span><span class="id"> numDomainType}</span><span class="id"> {nz</span><span class="id"> :</span><span class="id"> nullity}</span><span class="id"> {cond</span><span class="id"> :</span><span class="id"> reality}</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Notation</span><span class="id"> nR</span><span class="id"> :=</span><span class="id"> {num</span><span class="id"> R</span><span class="id"> &amp;</span><span class="id"> nz</span><span class="id"> &amp;</span><span class="id"> cond}</span>.<br/>
<span class="vernacular">Implicit</span><span class="id"> Types</span> (<span class="id">a</span><span class="id"> :</span><span class="id"> R</span>) (<span class="id">x</span><span class="id"> y</span><span class="id"> :</span><span class="id"> nR</span>).<br/>
<span class="vernacular">Local</span><span class="vernacular"> Notation</span><span class="id"> num</span><span class="id"> :=</span> (<span class="id">@num</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">0</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> nz</span><span class="id"> cond</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> num_abs_eq0</span><span class="id"> a</span><span class="id"> :</span> (<span class="id">`|a|%:nng</span><span class="id"> ==</span><span class="id"> 0%:nng</span>)<span class="id"> =</span> (<span class="id">a</span><span class="id"> ==</span><span class="id"> 0</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> -normr_eq0</span>. Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> MorphNum</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> MorphReal</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {R</span><span class="id"> :</span><span class="id"> numDomainType}</span><span class="id"> {nz</span><span class="id"> :</span><span class="id"> nullity}</span><span class="id"> {r</span><span class="id"> :</span><span class="id"> real}</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Notation</span><span class="id"> nR</span><span class="id"> :=</span><span class="id"> {num</span><span class="id"> R</span><span class="id"> &amp;</span><span class="id"> nz</span><span class="id"> &amp;</span><span class="id"> r}</span>.<br/>
<span class="vernacular">Implicit</span><span class="gallina-kwd"> Type</span><span class="id"> x</span><span class="id"> y</span><span class="id"> :</span><span class="id"> nR</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Notation</span><span class="id"> num</span><span class="id"> :=</span> (<span class="id">@num</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">0</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> nz</span><span class="id"> r</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> num_le_max</span><span class="id"> a</span><span class="id"> x</span><span class="id"> y</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">a</span><span class="id"> &lt;=</span><span class="id"> Num</span>.<span class="id">max</span><span class="id"> x%:num</span><span class="id"> y%:num</span><span class="id"> =</span> (<span class="id">a</span><span class="id"> &lt;=</span><span class="id"> x%:num</span>)<span class="id"> ||</span> (<span class="id">a</span><span class="id"> &lt;=</span><span class="id"> y%:num</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> -comparable_le_max//</span><span class="id"> real_comparable</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> num_ge_max</span><span class="id"> a</span><span class="id"> x</span><span class="id"> y</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">Num</span>.<span class="id">max</span><span class="id"> x%:num</span><span class="id"> y%:num</span><span class="id"> &lt;=</span><span class="id"> a</span><span class="id"> =</span> (<span class="id">x%:num</span><span class="id"> &lt;=</span><span class="id"> a</span>)<span class="id"> &amp;&amp;</span> (<span class="id">y%:num</span><span class="id"> &lt;=</span><span class="id"> a</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> -comparable_ge_max//</span><span class="id"> real_comparable</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> num_le_min</span><span class="id"> a</span><span class="id"> x</span><span class="id"> y</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">a</span><span class="id"> &lt;=</span><span class="id"> Num</span>.<span class="id">min</span><span class="id"> x%:num</span><span class="id"> y%:num</span><span class="id"> =</span> (<span class="id">a</span><span class="id"> &lt;=</span><span class="id"> x%:num</span>)<span class="id"> &amp;&amp;</span> (<span class="id">a</span><span class="id"> &lt;=</span><span class="id"> y%:num</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> -comparable_le_min//</span><span class="id"> real_comparable</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> num_ge_min</span><span class="id"> a</span><span class="id"> x</span><span class="id"> y</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">Num</span>.<span class="id">min</span><span class="id"> x%:num</span><span class="id"> y%:num</span><span class="id"> &lt;=</span><span class="id"> a</span><span class="id"> =</span> (<span class="id">x%:num</span><span class="id"> &lt;=</span><span class="id"> a</span>)<span class="id"> ||</span> (<span class="id">y%:num</span><span class="id"> &lt;=</span><span class="id"> a</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> -comparable_ge_min//</span><span class="id"> real_comparable</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> num_lt_max</span><span class="id"> a</span><span class="id"> x</span><span class="id"> y</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">a</span><span class="id"> &lt;</span><span class="id"> Num</span>.<span class="id">max</span><span class="id"> x%:num</span><span class="id"> y%:num</span><span class="id"> =</span> (<span class="id">a</span><span class="id"> &lt;</span><span class="id"> x%:num</span>)<span class="id"> ||</span> (<span class="id">a</span><span class="id"> &lt;</span><span class="id"> y%:num</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> -comparable_lt_max//</span><span class="id"> real_comparable</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> num_gt_max</span><span class="id"> a</span><span class="id"> x</span><span class="id"> y</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">Num</span>.<span class="id">max</span><span class="id"> x%:num</span> <span class="id"> y%:num</span><span class="id"> &lt;</span><span class="id"> a</span><span class="id"> =</span> (<span class="id">x%:num</span><span class="id"> &lt;</span><span class="id"> a</span>)<span class="id"> &amp;&amp;</span> (<span class="id">y%:num</span><span class="id"> &lt;</span><span class="id"> a</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> -comparable_gt_max//</span><span class="id"> real_comparable</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> num_lt_min</span><span class="id"> a</span><span class="id"> x</span><span class="id"> y</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">a</span><span class="id"> &lt;</span><span class="id"> Num</span>.<span class="id">min</span><span class="id"> x%:num</span><span class="id"> y%:num</span><span class="id"> =</span> (<span class="id">a</span><span class="id"> &lt;</span><span class="id"> x%:num</span>)<span class="id"> &amp;&amp;</span> (<span class="id">a</span><span class="id"> &lt;</span><span class="id"> y%:num</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> -comparable_lt_min//</span><span class="id"> real_comparable</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> num_gt_min</span><span class="id"> a</span><span class="id"> x</span><span class="id"> y</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">Num</span>.<span class="id">min</span><span class="id"> x%:num</span><span class="id"> y%:num</span><span class="id"> &lt;</span><span class="id"> a</span><span class="id"> =</span> (<span class="id">x%:num</span><span class="id"> &lt;</span><span class="id"> a</span>)<span class="id"> ||</span> (<span class="id">y%:num</span><span class="id"> &lt;</span><span class="id"> a</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> -comparable_gt_min//</span><span class="id"> real_comparable</span>. Qed.</div></details>
<br/>
<span class="vernacular">End</span><span class="id"> MorphReal</span>.<br/>
<span class="id">#[deprecated</span>(<span class="id">since=</span><span class="id">&quot;mathcomp-analysis 1.2.0&quot;</span><span class="id">,</span><span class="id"> note=</span><span class="id">&quot;renamed `num_le_max`&quot;</span>)<span class="id">]</span><br/>
<span class="vernacular">Notation</span><span class="id"> num_le_maxr</span><span class="id"> :=</span><span class="id"> num_le_max</span> (<span class="id">only</span><span class="id"> parsing</span>).<br/>
<span class="id">#[deprecated</span>(<span class="id">since=</span><span class="id">&quot;mathcomp-analysis 1.2.0&quot;</span><span class="id">,</span><span class="id"> note=</span><span class="id">&quot;renamed `num_ge_max`&quot;</span>)<span class="id">]</span><br/>
<span class="vernacular">Notation</span><span class="id"> num_le_maxl</span><span class="id"> :=</span><span class="id"> num_ge_max</span> (<span class="id">only</span><span class="id"> parsing</span>).<br/>
<span class="id">#[deprecated</span>(<span class="id">since=</span><span class="id">&quot;mathcomp-analysis 1.2.0&quot;</span><span class="id">,</span><span class="id"> note=</span><span class="id">&quot;renamed `num_le_min`&quot;</span>)<span class="id">]</span><br/>
<span class="vernacular">Notation</span><span class="id"> num_le_minr</span><span class="id"> :=</span><span class="id"> num_le_min</span> (<span class="id">only</span><span class="id"> parsing</span>).<br/>
<span class="id">#[deprecated</span>(<span class="id">since=</span><span class="id">&quot;mathcomp-analysis 1.2.0&quot;</span><span class="id">,</span><span class="id"> note=</span><span class="id">&quot;renamed `num_ge_min`&quot;</span>)<span class="id">]</span><br/>
<span class="vernacular">Notation</span><span class="id"> num_le_minl</span><span class="id"> :=</span><span class="id"> num_ge_min</span> (<span class="id">only</span><span class="id"> parsing</span>).<br/>
<span class="id">#[deprecated</span>(<span class="id">since=</span><span class="id">&quot;mathcomp-analysis 1.2.0&quot;</span><span class="id">,</span><span class="id"> note=</span><span class="id">&quot;renamed `num_lt_max`&quot;</span>)<span class="id">]</span><br/>
<span class="vernacular">Notation</span><span class="id"> num_lt_maxr</span><span class="id"> :=</span><span class="id"> num_lt_max</span> (<span class="id">only</span><span class="id"> parsing</span>).<br/>
<span class="id">#[deprecated</span>(<span class="id">since=</span><span class="id">&quot;mathcomp-analysis 1.2.0&quot;</span><span class="id">,</span><span class="id"> note=</span><span class="id">&quot;renamed `num_gt_max`&quot;</span>)<span class="id">]</span><br/>
<span class="vernacular">Notation</span><span class="id"> num_lt_maxl</span><span class="id"> :=</span><span class="id"> num_gt_max</span> (<span class="id">only</span><span class="id"> parsing</span>).<br/>
<span class="id">#[deprecated</span>(<span class="id">since=</span><span class="id">&quot;mathcomp-analysis 1.2.0&quot;</span><span class="id">,</span><span class="id"> note=</span><span class="id">&quot;renamed `num_lt_min`&quot;</span>)<span class="id">]</span><br/>
<span class="vernacular">Notation</span><span class="id"> num_lt_minr</span><span class="id"> :=</span><span class="id"> num_lt_min</span> (<span class="id">only</span><span class="id"> parsing</span>).<br/>
<span class="id">#[deprecated</span>(<span class="id">since=</span><span class="id">&quot;mathcomp-analysis 1.2.0&quot;</span><span class="id">,</span><span class="id"> note=</span><span class="id">&quot;renamed `num_gt_min`&quot;</span>)<span class="id">]</span><br/>
<span class="vernacular">Notation</span><span class="id"> num_lt_minl</span><span class="id"> :=</span><span class="id"> num_gt_min</span> (<span class="id">only</span><span class="id"> parsing</span>).<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> MorphGe0</span>.<br/>
<span class="vernacular">Context</span><span class="id"> {R</span><span class="id"> :</span><span class="id"> numDomainType}</span><span class="id"> {nz</span><span class="id"> :</span><span class="id"> nullity}</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Notation</span><span class="id"> nR</span><span class="id"> :=</span><span class="id"> {num</span><span class="id"> R</span><span class="id"> &amp;</span><span class="id"> ?=0</span><span class="id"> &amp;</span><span class="id"> &gt;=0}</span>.<br/>
<span class="vernacular">Implicit</span><span class="gallina-kwd"> Type</span><span class="id"> x</span><span class="id"> y</span><span class="id"> :</span><span class="id"> nR</span>.<br/>
<span class="vernacular">Local</span><span class="vernacular"> Notation</span><span class="id"> num</span><span class="id"> :=</span> (<span class="id">@num</span><span class="id"> _</span><span class="id"> _</span> (<span class="id">0</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> ?=0</span><span class="id"> &gt;=0</span>).<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> num_abs_le</span><span class="id"> a</span><span class="id"> x</span><span class="id"> :</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> a</span><span class="id"> -&gt;</span> (<span class="id">`|a|%:nng</span><span class="id"> &lt;=</span><span class="id"> x</span>)<span class="id"> =</span> (<span class="id">a</span><span class="id"> &lt;=</span><span class="id"> x%:num</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> a0;</span><span class="id"> rewrite</span><span class="id"> -num_le//=</span><span class="id"> ger0_norm</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> num_abs_lt</span><span class="id"> a</span><span class="id"> x</span><span class="id"> :</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> a</span><span class="id"> -&gt;</span> (<span class="id">`|a|%:nng</span><span class="id"> &lt;</span><span class="id"> x</span>)<span class="id"> =</span> (<span class="id">a</span><span class="id"> &lt;</span><span class="id"> x%:num</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> a0;</span><span class="id"> rewrite</span><span class="id"> -num_lt/=</span><span class="id"> ger0_norm</span>. Qed.</div></details>
<span class="vernacular">End</span><span class="id"> MorphGe0</span>.<br/>
<br/>
<span class="vernacular">Section</span><span class="id"> Posnum</span>.<br/>
<span class="vernacular">Context</span> (<span class="id">R</span><span class="id"> :</span><span class="id"> numDomainType</span>) (<span class="id">x</span><span class="id"> :</span><span class="id"> R</span>) (<span class="id">x_gt0</span><span class="id"> :</span><span class="id"> 0</span><span class="id"> &lt;</span><span class="id"> x</span>).<br/>
<span class="vernacular">Lemma</span><span class="id"> posnum_subdef</span><span class="id"> :</span> (<span class="id">x</span><span class="id"> !=</span><span class="id"> 0</span>)<span class="id"> &amp;&amp;</span> (<span class="id">0</span><span class="id"> &lt;=</span><span class="id"> x</span>)<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> -lt_def</span>. Qed.</div></details>
<span class="vernacular">Definition</span><span class="id"> PosNum</span><span class="id"> :</span><span class="id"> {posnum</span><span class="id"> R}</span><span class="id"> :=</span><span class="id"> @Signed</span>.<span class="id">mk</span><span class="id"> _</span><span class="id"> _</span><span class="id"> 0</span><span class="id"> !=0</span><span class="id"> &gt;=0</span><span class="id"> _</span><span class="id"> posnum_subdef</span>.<br/>
<span class="vernacular">End</span><span class="id"> Posnum</span>.<br/>
<span class="vernacular">Definition</span><span class="id"> NngNum</span> (<span class="id">R</span><span class="id"> :</span><span class="id"> numDomainType</span>) (<span class="id">x</span><span class="id"> :</span><span class="id"> R</span>) (<span class="id">x_ge0</span><span class="id"> :</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> x</span>)<span class="id"> :</span><span class="id"> {nonneg</span><span class="id"> R}</span><span class="id"> :=</span><br/>
&nbsp;&nbsp;(<span class="id">@Signed</span>.<span class="id">mk</span><span class="id"> _</span><span class="id"> _</span><span class="id"> 0</span><span class="id"> ?=0</span><span class="id"> &gt;=0</span><span class="id"> x</span><span class="id"> x_ge0</span>).<br/>
<br/>
<span class="vernacular">CoInductive</span><span class="id"> posnum_spec</span> (<span class="id">R</span><span class="id"> :</span><span class="id"> numDomainType</span>) (<span class="id">x</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">R</span><span class="id"> -&gt;</span><span class="id"> bool</span><span class="id"> -&gt;</span><span class="id"> bool</span><span class="id"> -&gt;</span><span class="id"> bool</span><span class="id"> -&gt;</span><span class="gallina-kwd"> Type</span><span class="id"> :=</span><br/>
<span class="id">|</span><span class="id"> IsPosnum</span> (<span class="id">p</span><span class="id"> :</span><span class="id"> {posnum</span><span class="id"> R}</span>)<span class="id"> :</span><span class="id"> posnum_spec</span><span class="id"> x</span> (<span class="id">p%:num</span>)<span class="id"> false</span><span class="id"> true</span><span class="id"> true</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> posnumP</span> (<span class="id">R</span><span class="id"> :</span><span class="id"> numDomainType</span>) (<span class="id">x</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span><span class="id"> 0</span><span class="id"> &lt;</span><span class="id"> x</span><span class="id"> -&gt;</span><br/>
&nbsp;&nbsp;<span class="id">posnum_spec</span><span class="id"> x</span><span class="id"> x</span> (<span class="id">x</span><span class="id"> ==</span><span class="id"> 0</span>) (<span class="id">0</span><span class="id"> &lt;=</span><span class="id"> x</span>) (<span class="id">0</span><span class="id"> &lt;</span><span class="id"> x</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="id">move=&gt;</span><span class="id"> x_gt0;</span><span class="id"> case:</span><span class="id"> real_ltgt0P</span> (<span class="id">x_gt0</span>)<span class="id"> =&gt;</span><span class="id"> [];</span><span class="id"> rewrite</span><span class="id"> ?gtr0_real</span><span class="id"> //</span><span class="id"> =&gt;</span><span class="id"> _</span><span class="id"> _</span>.<br/>
<span class="gallina-kwd">by</span><span class="id"> rewrite</span><span class="id"> -[x]/</span>(<span class="id">PosNum</span><span class="id"> x_gt0</span>)<span class="id">%:num;</span><span class="id"> constructor</span>.<br/>
Qed.</div></details>
<br/>
<span class="vernacular">CoInductive</span><span class="id"> nonneg_spec</span> (<span class="id">R</span><span class="id"> :</span><span class="id"> numDomainType</span>) (<span class="id">x</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span><span class="id"> R</span><span class="id"> -&gt;</span><span class="id"> bool</span><span class="id"> -&gt;</span><span class="gallina-kwd"> Type</span><span class="id"> :=</span><br/>
<span class="id">|</span><span class="id"> IsNonneg</span> (<span class="id">p</span><span class="id"> :</span><span class="id"> {nonneg</span><span class="id"> R}</span>)<span class="id"> :</span><span class="id"> nonneg_spec</span><span class="id"> x</span> (<span class="id">p%:num</span>)<span class="id"> true</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> nonnegP</span> (<span class="id">R</span><span class="id"> :</span><span class="id"> numDomainType</span>) (<span class="id">x</span><span class="id"> :</span><span class="id"> R</span>)<span class="id"> :</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> x</span><span class="id"> -&gt;</span><span class="id"> nonneg_spec</span><span class="id"> x</span><span class="id"> x</span> (<span class="id">0</span><span class="id"> &lt;=</span><span class="id"> x</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> move=&gt;</span><span class="id"> xge0;</span><span class="id"> rewrite</span><span class="id"> xge0</span><span class="id"> -[x]/</span>(<span class="id">NngNum</span><span class="id"> xge0</span>)<span class="id">%:num;</span><span class="id"> constructor</span>. Qed.</div></details>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<div class="doc">These proofs help integrate more arithmetic with signed.v. The issue is
    Terms like `0 &lt; 1-q` with subtraction don't work well. So we hide the
    subtractions behind `PosNum` and `NngNum` constructors, see sequences.v
    for examples. </div>
<span class="vernacular">Section</span><span class="id"> onem_signed</span>.<br/>
<span class="vernacular">Variable</span><span class="id"> R</span><span class="id"> :</span><span class="id"> numDomainType</span>.<br/>
<span class="vernacular">Implicit</span><span class="id"> Types</span><span class="id"> r</span><span class="id"> :</span><span class="id"> R</span>.<br/>
<br/>
<span class="vernacular">Lemma</span><span class="id"> onem_PosNum</span><span class="id"> r</span> (<span class="id">r1</span><span class="id"> :</span><span class="id"> r</span><span class="id"> &lt;</span><span class="id"> 1</span>)<span class="id"> :</span><span class="id"> `1-r</span><span class="id"> =</span> (<span class="id">PosNum</span> (<span class="id">onem_gt0</span><span class="id"> r1</span>))<span class="id">%:num</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> []</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> onemX_NngNum</span><span class="id"> r</span> (<span class="id">r1</span><span class="id"> :</span><span class="id"> r</span><span class="id"> &lt;=</span><span class="id"> 1</span>) (<span class="id">r0</span><span class="id"> :</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> r</span>)<span class="id"> n</span><span class="id"> :</span><br/>
&nbsp;&nbsp;<span class="id">`1-</span>(<span class="id">r</span><span class="id"> ^+</span><span class="id"> n</span>)<span class="id"> =</span> (<span class="id">NngNum</span> (<span class="id">onemX_ge0</span><span class="id"> n</span><span class="id"> r0</span><span class="id"> r1</span>))<span class="id">%:num</span>.<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> []</span>. Qed.</div></details>
<br/>
<span class="vernacular">Lemma</span><span class="id"> onem_nonneg_proof</span> (<span class="id">p</span><span class="id"> :</span><span class="id"> {nonneg</span><span class="id"> R}</span>)<span class="id"> :</span><span class="id"> p%:num</span><span class="id"> &lt;=</span><span class="id"> 1</span><span class="id"> -&gt;</span><span class="id"> 0</span><span class="id"> &lt;=</span><span class="id"> `1-</span>(<span class="id">p%:num</span>).<br/>
<details>
<summary class="toggleproof">Proof.</summary>
<div class="proofscript">
<span class="gallina-kwd"> by</span><span class="id"> rewrite</span><span class="id"> /onem/=</span><span class="id"> subr_ge0</span>. Qed.</div></details>
<br/>
<span class="vernacular">Definition</span><span class="id"> onem_nonneg</span> (<span class="id">p</span><span class="id"> :</span><span class="id"> {nonneg</span><span class="id"> R}</span>) (<span class="id">p1</span><span class="id"> :</span><span class="id"> p%:num</span><span class="id"> &lt;=</span><span class="id"> 1</span>)<span class="id"> :=</span><br/>
&nbsp;&nbsp;<span class="id">NngNum</span> (<span class="id">onem_nonneg_proof</span><span class="id"> p1</span>).<br/>
<br/>
<span class="vernacular">End</span><span class="id"> onem_signed</span>.<br/>

      <div class="footer"><hr/>Generated by <a href="https://github.com/yoshihiro503/coq2html/">a fork of coq2html</a></div>
    </div>
  </div>
    </main>
</body>
</html>
